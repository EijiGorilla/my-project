import{dI as E,bl as v,dH as $,cy as D,rW as b,rY as H,l as h,O as R,ds as P,S as L,ml as f,o3 as T,V,r1 as k,a9 as d,_ as m,d as w,e as O,ol as I,a6 as u}from"./index-DWB-5FUE.js";import{e as M,a as S}from"./visualizationUtils-BzAjRsx-.js";import{b as W}from"./settings-CZfS3037.js";import{R as y}from"./OutlineVisualElement-C3EW7Fgz.js";import{e as x}from"./GraphicState-CGHspYo1.js";import"./AnchorElementViewModel-B-3f1BWL.js";import"./createUtils-D7JaVCA5.js";import"./distanceOperator-BsZ_4jpZ.js";import"./Distance2DCalculator-CXhBP-8I-BFhVwdhl.js";import"./lineStippleUtils-CCavR4OV.js";import"./EngineVisualElement-qnowR1Tj.js";import"./VisualElement-D-WDjCmT.js";import"./LaserlinePath.glsl-BHACVTai.js";import"./line-CFlux7z3.js";import"./line-CnstwMgx.js";import"./triangulationUtils-Byt2__Pt.js";import"./deduplicate-DSX-pgTg.js";class z{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new W({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=E(this._highlightTask),this._highlightHandle=v(this._highlightHandle),this._visualElementHandle=v(this._visualElementHandle)}showHighlight(e){if(this.remove(),e==null||!c(e))return;const i=e.layer;this._highlightTask=$(async t=>{const s=await this._params.view.whenLayerView(i);D(t),b(s)&&(this._highlightHandle=s.highlight(e))})}showReshaping(e){if(this.remove(),e==null)return;const i=this._params.view,t=new y({view:i,geometry:c(e)?e.geometry:null,attached:!1,elevationInfo:H(e),renderOccluded:8,isDecoration:!0}),s=new x({graphic:e}),a=[h(()=>s.isDraped,r=>{t.isDraped=r}),s.on("changed",()=>{t.geometry=c(e)?e.geometry:null}),i.trackGraphicState(s),i.maskOccludee(e),R(t)];this._settings.visualElements.lineObjects.outline.apply(t),t.attached=!0,this._visualElementHandle=P(a)}}function c(o){return o.geometry!=null&&o.geometry.type==="polyline"}let p=class extends L{constructor(o){super(o),this._chartData=null,this._visualElements=[],this._update=e=>{const{chartData:i}=e;if(i==null)return this.remove();if(!i.refined)return;const t=this._visualElements,s=i.lines.filter(n=>n.viewVisualizationEnabled),a=s.length;for(;t.length>a;)t.pop().destroy();const r=f().profileLinesStyle3D;for(;t.length<a;){const n=new y({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:r.innerWidth,innerColor:r.innerColor,width:r.width,falloff:r.falloff,renderOccluded:r.renderOccluded,isDecoration:!0});t.push(n)}const l=e.spatialReference;for(let n=0;n<a;++n){const _=t[n],g=s[a-1-n];_.geometry=M(g,l),_.color=T(V.toUnitRGBA(g.color))}}}initialize(){const o=f().profileLinesUpdateThrottleMillis;let e=this._update;{const i=k(this._update,o);this.addHandles(i),e=i}this.addHandles([h(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),e,d)])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(o){this._chartData=o}_destroyVisualElements(){this._visualElements.forEach(o=>o.destroy()),this._visualElements.length=0}};m([w()],p.prototype,"view",void 0),m([w()],p.prototype,"_chartData",void 0),p=m([O("esri.widgets.ElevationProfile.support.ProfileLines3D")],p);class ie{constructor(e,i){this._handles=new I,this._inputRepresentation=new z({view:e}),this._hoveredPoints=new S({view:e}),this._profileLines=new p({view:e}),this._handles.add([h(()=>i.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),d),h(()=>{const{state:t,editable:s,highlightEnabled:a,viewModel:r}=i,l=r.input;return l&&(l.commitProperty("geometry"),l.commitProperty("layer")),{input:l,state:t,editable:s,highlightEnabled:a}},t=>this._updateInputRepresentation(t),d),h(()=>i.viewModel.chartData,t=>this._profileLines.update(t),d),h(()=>i.viewModel.input?.geometry,()=>{this._profileLines.remove()},d)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:e,state:i,editable:t,highlightEnabled:s}){const a=this._inputRepresentation;if(!s)return a.remove();i==="selected"?a.showHighlight(e):i!=="created"||t?a.remove():a.showReshaping(e)}}export{ie as ElevationProfileView3D};
