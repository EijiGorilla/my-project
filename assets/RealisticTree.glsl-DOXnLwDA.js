import{oM as l,yB as y,yC as b}from"./index-glGZSouV.js";import{h as _,Q as R,r as v,e as w,f as p,E as G,j as M}from"./HUDMaterial.glsl-1YPhCXtB.js";import{i as O,y as T}from"./memoryEstimations-DJrlv__L.js";import"./glsl-B5bJgrnA.js";import"./ShaderBuilder-CHbEafSK.js";import{i as x,m as j,v as E,J as V,_ as B}from"./DefaultMaterial-JAniTV-p.js";import"./OutputColorHighlightOID.glsl-BOzJFLXV.js";class U{constructor(t,r,e,s){this.material=t,this.buffer=r,this.numVertices=e,this.boundingInfo=s,this.bufferWriter=t.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+T}get renderGeometry(){return this}intersect(t,r,e,s,n,a,o,c){const u=this.bufferWriter,m=this.buffer;u.intersect(m,this.material.parameters,null,t,e,s,(f,d,S)=>g(f,d,S,t,r,a,o,n,c))}}class A{constructor(t){this.engineGeometry=t;const r=this.material,e=this.engineGeometry,s=e.attributes,n=e.boundingInfo,a=r.createBufferWriter(),o=a.layout,c=a.elementCount(s),u=o.createBuffer(c);a.write(null,null,s,null,u,0),this.renderGeometry=new U(r,u.buffer,c,n)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((t,r)=>t+O(r.data,r.indices),0)}intersect(t,r,e,s,n,a,o,c){const u=this.engineGeometry;this.material.intersect(u,t.transform.transform,t,e,s,(m,f,d)=>g(m,f,d,t,r,a,o,n,c))}}function g(i,t,r,e,s,n,a,o,c){if(i<0||s&&!s(e.rayBegin,e.rayEnd,i))return;const u=new y(n.layerViewUid,n.graphicUid(o),r,a,c);if((e.results.min.distance==null||i<e.results.min.distance)&&e.results.min.set(3,u,i,t,e.transform.transform),(e.results.max.distance==null||i>e.results.max.distance)&&e.results.max.set(3,u,i,t,e.transform.transform),e.options.store===2){const m=new b(e.results.min.ray);m.set(3,u,i,t,e.transform.transform),e.results.all.push(m)}}let P=class{constructor(t,r=null){this.geometry=t,this.textures=r}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}};class W{constructor(t,r,e){this.components=t,this.minScreenSpaceRadius=r,this.pivotOffset=e;const s=l(this.components.map(n=>n.geometry));this.numVertices=s.reduce((n,a)=>n+a.numVertices,0)}}class z{constructor(t){this.levels=t,this.levels.sort((r,e)=>r.minScreenSpaceRadius===e.minScreenSpaceRadius?r.numVertices-e.numVertices:r.minScreenSpaceRadius-e.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){const t=[];return this.levels.forEach(r=>r.components.forEach(e=>t.push(e.geometry.material))),l(t)}getTextures(){const t=new Array;return this.levels.forEach(r=>r.components.forEach(e=>{e.textures!=null&&t.push(...e.textures)})),l(t)}getGeometries(){const t=new Array;return this.levels.forEach(r=>r.components.forEach(e=>{t.push(e.geometry)})),l(t)}getEngineGeometries(){return this.getGeometries().map(t=>t.engineGeometry).filter(t=>t!=null)}computeUsedMemory(){const t=this.getGeometries(),r=this.getTextures(),e=t.reduce((s,n)=>s+n.computeUsedMemory(),0);return r.reduce((s,n)=>s+n.usedMemory,0)+e}}function F(i){switch(i){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function H(i,t){const r=(e,s,n=!1)=>new z(e.map(a=>{const o=s(a.tesselation);return n&&_(o),new W([new P(new A(o))],a.minScreenSpaceRadius)}));switch(i){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],e=>M(t,.5,e));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>G(t,1));case"cone":return r(h,e=>p(t,1,.5,e,!1),!0);case"inverted-cone":return r(h,e=>p(t,1,.5,e,!0),!0);case"cylinder":return r(h,e=>w(t,1,.5,e,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>v(t,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>R(t,1),!0);default:return}}const h=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}],K=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"})),N=Object.freeze(Object.defineProperty({__proto__:null,build:j,getRadius:E},Symbol.toStringTag,{value:"Module"})),X=Object.freeze(Object.defineProperty({__proto__:null,build:V},Symbol.toStringTag,{value:"Module"})),Y=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));export{X as D,Y as R,F as S,W as a,K as b,z as c,N as d,H as l,P as m,A as o};
