const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/statsWorker-DdwgBgmn.js","assets/utils-DBP7XkcT.js","assets/utils-DYy3hkCo.js","assets/utils-BeYCddXP.js","assets/ClassBreaksDefinition-Xi3pBlGD.js","assets/geometryEngineWorker-BkMQzpX8.js","assets/geometryEngineJSON-B_JiqPb-.js","assets/geometryEngineBase-BQTefT4Y.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/CSVSourceWorker-BF0_KlU1.js","assets/date-DCujAECq.js","assets/FeatureStore-B9kD8EQX.js","assets/BoundsStore-pNliSLaz.js","assets/timeSupport-BY8MNf47.js","assets/queryUtils-DGlpnbgM.js","assets/optimizedFeatureQueryEngineAdapter-oqjHWYWZ.js","assets/QueryEngine-79oyuwJ8.js","assets/WhereClauseCache-C9TusnxI.js","assets/WhereClause-DPd0c4y3.js","assets/QueryEngineCapabilities-DJC_YILC.js","assets/SnappingCandidate-DGkpYqI6.js","assets/FixedIntervalBinParameters-Bg1KAc6Y.js","assets/number-DJO5mqJa.js","assets/locationUtils-Dmms9J_U.js","assets/clientSideDefaults-CYAy0ce7.js","assets/EdgeProcessingWorker-Bu6LdHdK.js","assets/workerHelper-uuHep-kc.js","assets/bufferLayouts-CbMfYAca.js","assets/edgeProcessing-CO_rnkxe.js","assets/deduplicate-Cq3_qEzq.js","assets/ElevationSamplerWorker-D3zJeczH.js","assets/vertexSpaceConversion-CE3YEO58.js","assets/vec4-BIbNB-hd.js","assets/FeatureServiceSnappingSourceWorker-DJg1MH9B.js","assets/symbologySnappingCandidates-CYUXUYMm.js","assets/pbfQueryUtils-BunvEFEK.js","assets/pbf-BahQR_hU.js","assets/query-DfFF2S-t.js","assets/GeoJSONSourceWorker-BR-aTSD9.js","assets/geojson-DJXxqVgi.js","assets/sourceUtils-CA8kXT-N.js","assets/MemorySourceWorker-DeSEzWF7.js","assets/objectIdUtils-BmFjqQA3.js","assets/PBFDecoderWorker-DN1eBk3w.js","assets/FeaturePipelineWorker--ye76EEk.js","assets/AttributeStore-B1LKBv72.js","assets/Utils-BGdeph77.js","assets/BoundingBox-BZNgYOct.js","assets/UpdateTracking2D-ChYkGZqy.js","assets/FeatureStoreQueryAdapter-ByOUOX1i.js","assets/labelPoint-Bc4MVIMc.js","assets/constants-BBnGEY1d.js","assets/streamLayerUtils-DFlbJ4P1.js","assets/MeshWriterRegistry-BQfxIkqY.js","assets/rasterizingUtils-ux3F5X9k.js","assets/CIMSymbolHelper-D9Rcf7sr.js","assets/BidiEngine-BvER9tXK.js","assets/Rect-CUzevAry.js","assets/TexturedLineMeshWriter-CC4T6GYr.js","assets/TurboLine-DeLZWen7.js","assets/grouping-C9AJVtRI.js","assets/QueueProcessor-BOxRV2Gn.js","assets/FeatureMetadata-CBDghM1b.js","assets/SourceChunkStore-CbQyFaE0.js","assets/parquet-BBj23Edj.js","assets/operatorGeodeticDensify-6n8l79lY.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/normalizeUtilsSync-CBes_t8t.js","assets/FeatureSourceQueryInfo-Bi39G-pB.js","assets/ogcFeatureUtils-ZIEQVvSX.js","assets/FeatureIdInfo-iL5WjyEH.js","assets/StreamFeatureManager-dW6U2RU0.js","assets/CircularArray-CujHzHWW.js","assets/createConnection-x8vETnzR.js","assets/PointCloudWorker-CY-9nJcq.js","assets/PointCloudWorkerUtil-EiOAyR5C.js","assets/PointCloudUniqueValueRenderer-DVwQcn8e.js","assets/I3SBinaryReader-DmZ9_ikt.js","assets/RasterWorker-Bo2HqK07.js","assets/PixelBlock-BhBLtpZf.js","assets/RasterSymbolizer-Bi47KPdO.js","assets/vectorFieldUtils-C6XZkwIG.js","assets/rasterFunctionHelper-B5sCTGMY.js","assets/clipUtils-BIAyiuIl.js","assets/rasterProjectionHelper-aKnGAica.js","assets/PolynomialTransform-3p3w1xPa.js","assets/dataUtils-DnvoJOl7.js","assets/SceneLayerSnappingSourceWorker-39-LMSD4.js","assets/SceneLayerWorker-BIq_BA-n.js","assets/I3SMeshWorkerHandle-C3wn46sw.js","assets/WFSSourceWorker-DEkTM8lp.js","assets/wfsUtils-3FA_8EBI.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-CwR49X6k.js","assets/SourceLayerData--bRIPzxD.js","assets/StyleRepository-Bi_2Z24o.js","assets/Lyr3DWorker-DuyMdjnM.js","assets/Lyr3DModule-CtiGTn2k.js","assets/Feature3DPipelineWorker-DuaZE5WJ.js","assets/utils-CdmI4Gaz.js","assets/FlowWorker-BRmNeyb9.js","assets/loadUtils-CEKGCEvw.js","assets/FeatureTileDescriptor-DJq_VZzz.js","assets/ParquetSourceWorker-BUAHUELz.js","assets/parquetUtils-Blo37dyK.js","assets/PanoramicMeshWorker--Yx4WOkd.js","assets/projectOperator-BcyDhCTk.js","assets/operatorProject-CZlPm8BV.js","assets/projectOperator-7vW72XhM.js","assets/Popup-DQHf_0Z5.js","assets/AttachmentInfo-Bg2EdoQy.js","assets/featureUtils-PX6clf8X.js","assets/utils-B3sqNuxK.js","assets/cimSymbolUtils-BXs1V6r7.js","assets/executeQueryJSON-BMQOHX9q.js","assets/shared-DRztOKJD.js","assets/isImageryGraphicOrigin-Ccuhb4eK.js","assets/isImageryTileGraphicOrigin-ZR-gBf9D.js","assets/AnchorElementViewModel-DWLSNo4n.js","assets/symbolUtils-RcnHNVrZ.js","assets/ElevationLayer-CHiToBeZ.js","assets/ArcGISCachedService-PRVCdxXU.js","assets/TileInfoTilemapCache-BxEQPvpF.js","assets/LercDecoder-B0zMW60H.js","assets/portalLayers-BB5XGY1f.js","assets/associatedFeatureServiceUtils-CxJKQSzD.js","assets/fetchService-XZLVAyvm.js","assets/loadUtils-zDo-BqpT.js","assets/lazyLayerLoader-DuOZua5O.js","assets/arcgisLayers-Ccnnp-FF.js","assets/layersCreator-C-Zqm3pA.js","assets/arcadeUtils-BjeN_pz1.js","assets/arcade-DHasYH4A.js","assets/arcadeEnvironment-CDK2hX_o.js","assets/Dictionary-ClPbFmwB.js","assets/ImmutableArray-BPVd6ESQ.js","assets/Feature-TCRfUrnA.js","assets/aiServices-DuDTOiyH.js","assets/commonProperties-DHiB1uzW.js","assets/unitConversion-B3VapzRH.js","assets/hash-CcEbRgUF.js","assets/rasterFieldUtils-DBR_X-zK.js","assets/batchExec-BzvxyE3p.js","assets/webStyleSymbolUtils-C2Nim7cq.js","assets/devEnvironmentUtils-8WtPGj6h.js","assets/webglDeps-BVrk6yaw.js","assets/ShaderCompiler-G2XYGDs6.js","assets/programUtils-CwiKxPbA.js","assets/ProgramTemplate-DCmn23ms.js","assets/mapViewDeps-DPicuSt6.js","assets/FeatureCommandQueue-Cemx3ZhP.js","assets/GraphShaderModule-DMNhivnJ.js","assets/utils-DUZMUUeP.js","assets/heatmapTextureUtils-DpCTyQNZ.js","assets/WGLContainer-C3nFbxgI.js","assets/WGLBrushVTLSymbol-CkAOQRY8.js","assets/Container-suaxaRmX.js","assets/SDFHelper-Caz6XMkS.js","assets/OverrideHelper-DQZGOyKM.js","assets/callExpressionWithFeature-BRuBfPCm.js","assets/VTLMaterialManager-Diyp9F_8.js","assets/GridShader-DFWze0sD.js","assets/SymbolFader-CKyJSKhw.js","assets/VertexStream-DAXryNtv.js","assets/CIMResourceManager-BJDHrX6i.js","assets/utils-CXL1hy51.js","assets/utils-DDjZAYSk.js","assets/GraphicsView2D-B2A3loSr.js","assets/GraphicContainer-Cr1VQcmq.js","assets/AGraphicContainer-BbBV3w0J.js","assets/TechniqueInstance-jtY-0EIF.js","assets/TileContainer-B9igwlVb.js","assets/gridUtils-DVA6iHzf.js","assets/TileLayerView2D-CgHKFjXO.js","assets/imageUtils-CRYGnEZM.js","assets/BitmapTechnique-CLHYZtcl.js","assets/bitmapUtils-tWQlT6IX.js","assets/LayerView2D-C1Bs_SZq.js","assets/HighlightGraphicContainer-DaJy6NHw.js","assets/LayerView-DinLbObD.js","assets/RefreshableLayerView-C31b405b.js","assets/highlightUtils-e1O_WROV.js","assets/MapServiceLayerViewHelper-BuSn9mG_.js","assets/floorFilterUtils-DKzVzLpH.js","assets/sublayerUtils-BEQnBRaB.js","assets/popupUtils-Bz2hj6zP.js","assets/highlightOptionsUtils-BiLqICK5.js","assets/FeatureLayerView2D-BPPmDZNd.js","assets/timeSupport-DyIPzibm.js","assets/AttributeBinsFeatureSet-BftwPW-9.js","assets/AttributeBinsQuery-Ccy6qrx9.js","assets/featureServiceUtils-BRLn8Fnb.js","assets/constants-SxxbBSOD.js","assets/FeatureLayerView-Cr9eyVmf.js","assets/featurePopupQueryUtils-CiGMe800.js","assets/BaseDynamicLayerView2D-Vq5Kys-1.js","assets/BitmapContainer-Db6AW6u1.js","assets/ExportStrategy-idKf13sZ.js","assets/CatalogLayerView2D-DU0FhSjE.js","assets/CatalogLayerView-D4O-2Nuc.js","assets/CatalogDynamicGroupLayerView2D-papVuE0n.js","assets/CatalogDynamicGroupLayerView-CQboVP5A.js","assets/CatalogFootprintLayerView2D-1y4NZHUs.js","assets/CatalogFootprintLayerView-u4l6OFIP.js","assets/GeoRSSLayerView2D-CPao_myq.js","assets/GraphicsLayerView2D-DvIt1fKn.js","assets/GroupLayerView2D-C3nqbsY5.js","assets/GroupLayerView-Djg3gzC7.js","assets/ImageryLayerView2D-D3SwkNUU.js","assets/RasterVFDisplayObject-CdS9a7Xi.js","assets/utils-B4u0QAiY.js","assets/ImageryLayerView-C4CGvQSm.js","assets/ImageryTileLayerView2D-D2Cm3xIT.js","assets/multidimensionalUtils-DwiyZHPx.js","assets/datasetUtils-DdDUWBI2.js","assets/rasterUtils-edYDQqeL.js","assets/RawBlockCache-DDLhShnt.js","assets/ImageryTileLayerView-D6HEMKJG.js","assets/KMLLayerView2D-CJSBuVXM.js","assets/kmlUtils-Dmh_gPc8.js","assets/KnowledgeGraphLayerView2D-D0mj5CEe.js","assets/MapImageLayerView2D-B7JPa3dv.js","assets/MapImageLayerView-DVFOlY1p.js","assets/ExportImageParameters-8lCf-1a7.js","assets/MapNotesLayerView2D-CYGbfT7P.js","assets/MediaLayerView2D-BzKl29nJ.js","assets/perspectiveUtils-D9fAEA8E.js","assets/mediaLayerUtils-BJ-DU5EY.js","assets/OverlayContainer-BbF8QF8p.js","assets/MediaLayerView-CHnVIAUB.js","assets/OGCFeatureLayerView2D-Dm-_o3wr.js","assets/OGCFeatureLayerView-C5vgQn7-.js","assets/RouteLayerView2D-805qGTHh.js","assets/Stop-Bkuhy3Zk.js","assets/networkEnums-BkPruaSU.js","assets/StreamLayerView2D-DV3HB24W.js","assets/StreamLayerView-CC7ei2Qh.js","assets/SubtypeGroupLayerView2D-CU1nkNEY.js","assets/VectorTileLayerView2D-BHLUW6Sf.js","assets/TileInfoViewPOT-B9VmE20H.js","assets/VideoLayerView2D-Ly_R_5B6.js","assets/videoUtils-DMA8DzKq.js","assets/ControlPoint-Bf6r3myR.js","assets/WMSLayerView2D-BMGPKe6O.js","assets/WMSLayerView-DWW61Z1G.js","assets/ExportWMSImageParameters-DhUhi6yz.js","assets/WMTSLayerView2D-DeAAgTnu.js","assets/ElevationProfileAnalysisView2D-D81gziS9.js","assets/AnalysisView-Bovhdb7-.js","assets/ElevationProfileTool-6uNwuV5t.js","assets/createUtils-CV511-WG.js","assets/distanceOperator-C8bjU970.js","assets/Point2D-Bi0Egf5Y.js","assets/Distance2DCalculator-CXhBP-8I-411Apgem.js","assets/ProjectionTransformation-ClZqX0iZ.js","assets/Envelope2D-BTMj3ua4.js","assets/Transformation2D-IRVmmniT.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/apiConverter-FAIJemRK.js","assets/jsonConverter-DcnUJcMv.js","assets/simplifyOperator-DYwWIpEs.js","assets/operatorSimplify-DiY9DGd4.js","assets/ExclusiveOperationManager-ChjuBB6A.js","assets/apng-yIpN8Q5_.js","assets/Lyr3DWasmPerSceneView-C20Fb4Gd.js","assets/layersLoader-CvzHz3XW.js","assets/featureLayerUtils-S1DPo9w_.js","assets/utils-CIFh6gMc.js","assets/FeatureLayerSource-UPGgnQd3.js","assets/External-BzqVoqXw.js","assets/applyEditsUtils-BzA4Y9_u.js","assets/MeshTransform-IsxLVLUJ.js","assets/editingSupport-D04zAGj6.js","assets/QueryTask-CaslwijS.js","assets/executeForIds-B4K3rEPI.js","assets/queryAssociations-BfssiAr_.js","assets/Association-VLQfMtJL.js","assets/synthesizeAssociationGeometries-BIrCfA0R.js","assets/TileLayerView3D-D-Yn8w-1.js","assets/LayerView3D-UMV3wBm1.js","assets/TiledLayerView3D-BTjegRcn.js","assets/fetchTile-DmqPM07X.js","assets/SublayerPopupHighlightHelper3D-3cInshEs.js","assets/ImageHighlightHelper3D-Dz9_Zxfz.js","assets/ElevationLayerView3D-DfdnfO2y.js","assets/BaseDynamicLayerView3D-C2vu_sAf.js","assets/DynamicLayerView3D-BqlO5cwN.js","assets/SubView3D-nkxTyuzJ.js","assets/ImageMaterial.glsl-CjOKQK_o.js","assets/TriangleMaterial-OR2yZUrw.js","assets/DefaultLayouts-CE-gg6Xm.js","assets/BuildingSceneLayerView3D-pDLiHbgO.js","assets/BuildingComponentSublayer-BDBlyQ8m.js","assets/capabilities-Cs4k8cuT.js","assets/I3SIndexInfo-BRaE9shC.js","assets/I3SLayerDefinitions-K8vWTG6Z.js","assets/I3SUtil-jhlz9xvs.js","assets/BuildingGroupSublayer-BUvw7ROZ.js","assets/I3SMeshView3D-JXkSkF2s.js","assets/Transform-ZTqB-I0A.js","assets/projectBoundingSphere-CnUsH5oN.js","assets/I3SOverrides-BnVpRrzD.js","assets/resourceUtils-EPwdbnCf.js","assets/EllipsoidMode-B5XzmkLv.js","assets/SceneModification-BEB5V4bS.js","assets/ExtentSet-B6Zhwopb.js","assets/attributeUtils-Dc8--CBJ.js","assets/highlightUtils-L6kG0T6W.js","assets/I3SQueryFeatureAdapter-ON-4b_4B.js","assets/TemporalSceneLayerView-Bi1RDnrq.js","assets/I3SQueryFeatureStore-BKpa8w7D.js","assets/CatalogLayerView3D-BsVtQ0jz.js","assets/CatalogDynamicGroupLayerView3D-BgFbDwCt.js","assets/CatalogFootprintLayerView3D-HOsxDQbn.js","assets/FeatureLayerViewBase3D-CbGAWjkz.js","assets/HeatmapDensity.glsl-OZLT3Tin.js","assets/dehydratedFeatureComparison-ChW0RRjz.js","assets/queryForSymbologySnapping-_5oKjmps.js","assets/Graphics3DFeatureProcessor-DeIr6FiJ.js","assets/renderingInfoUtils-DW6LSwuP.js","assets/Graphics3DObjectStates-BQM6fHkd.js","assets/EventedSet-CkMu1URe.js","assets/CSVLayerView3D-BMAJgxpT.js","assets/DimensionLayerView3D-DIcFi97c.js","assets/LayerViewAnalysisViewManager-xDYrBLKL.js","assets/FeatureLayerView3D-C_D5GJec.js","assets/GaussianSplatLayerView3D-DX-ZPU6z.js","assets/tiles3DUtils-BHstSEAO.js","assets/GeoJSONLayerView3D-GhHo_V17.js","assets/GraphicsLayerView3D-Ci7VUdAs.js","assets/GraphicsProcessor-CZ15vLzl.js","assets/GroupLayerView3D-8yttFWTW.js","assets/ImageryLayerView3D-ClBB95Jk.js","assets/FlowSubView3D-BgsLe5Zp.js","assets/line-BVbfdbhk.js","assets/IntegratedMeshLayerView3D-CPBLhhvE.js","assets/IntegratedMesh3DTilesLayerView3D-DItK19IL.js","assets/LineOfSightLayerView3D-BqCeUoSC.js","assets/MapImageLayerView3D-Dy-N83Ed.js","assets/MediaLayerView3D-CSCLh6h8.js","assets/EditGeometryOperations-CyZHQtvA.js","assets/rotate-CQ-lGfeV.js","assets/curveOperationUtils-BdFGEFag.js","assets/SnappingManagerPool-DYCW3Nod.js","assets/allLayerSnapping-QhQT5ZYK.js","assets/OGCFeatureLayerView3D-CiT5oFCI.js","assets/PointCloudLayerView3D-CvREyq_M.js","assets/PopupSceneLayerView-BZNptcRw.js","assets/ViewshedLayerView3D-hJCOpwrX.js","assets/VoxelLayerView3D-BwIZ5W6r.js","assets/VoxelGraphic-KKbOt8HF.js","assets/RouteLayerView3D-CPRucA82.js","assets/SceneLayerView3D-Dqe0c3gM.js","assets/SceneLayerView-DFM413A2.js","assets/SceneLayerGraphicsView3D-DtuYSgu3.js","assets/StreamLayerView3D-D9Riprhz.js","assets/ImageryTileLayerView3D-DPtDIdnZ.js","assets/VectorTileLayerView3D-CmCkXO2U.js","assets/WFSLayerView3D-XWsNChNg.js","assets/WMSLayerView3D-BNEWB7a_.js","assets/WMTSLayerView3D--o5he7vv.js","assets/AreaMeasurementAnalysisView3D-bCRAjPp_.js","assets/AnalysisView3D-CbWooa24.js","assets/measurementUtils-IpZWjYKl.js","assets/ShadedColorMaterial.glsl-DwFmUACZ.js","assets/VisualElement-CldAuVAd.js","assets/ColorMaterial.glsl-DhiZQTdf.js","assets/Segment-DcJp9oJw.js","assets/TextOverlayItem-CSgCsCBx.js","assets/lineStippleUtils-CCavR4OV.js","assets/SnappingVisualizer3D-C3r_EqC8.js","assets/ExtendedLineVisualElement-B2bBoZT-.js","assets/EngineVisualElement-DDT5_CP8.js","assets/LaserlinePath.glsl-DVSgsMZN.js","assets/PointVisualElement-DAvzZR5B.js","assets/SnappingContext-BL54WqO-.js","assets/PointSnappingHint-BTrPaREG.js","assets/dragEventPipeline3D-CWO6gmw8.js","assets/InteractiveToolBase-DXolLRqO.js","assets/ToolIntersector-DPEtzqpc.js","assets/analysisViewUtils-Bc2rNKMY.js","assets/SnappingDragPipelineStep-CKiLgRo1.js","assets/SnappingOperation-CroAq5xQ.js","assets/DimensionAnalysisView3D-c8qu3ZIM.js","assets/LengthDimension-1xXx2DzM.js","assets/Factory-CT7f73gl.js","assets/VerticesVisualElement-D0U9QDpu.js","assets/LineMarker.glsl-CK1QDvXt.js","assets/DirectLineMeasurementAnalysisView3D-BWVW06gL.js","assets/ElevationProfileAnalysisView3D-BCyIyrn1.js","assets/settings-fUAcsuw1.js","assets/OutlineVisualElement-B6YEf-wV.js","assets/line-BsrlPBJX.js","assets/triangulationUtils-OXtOzKIe.js","assets/LineOfSightAnalysisView3D-BYB1LDtI.js","assets/featureReferenceUtils-69Dhux-Y.js","assets/LineOfSightAnalysisTarget-B32L6WEp.js","assets/IViewEvents-h1sCmc8C.js","assets/SliceAnalysisView3D-C6vMLYK5.js","assets/SlicePlane-CbG9YKBU.js","assets/SlicePlaneMaterial.glsl-KnXJuhc0.js","assets/sliceToolConfig-D5AaszEy.js","assets/RotateManipulator-Bf7xra4b.js","assets/ViewshedAnalysisView3D-D43jZsVu.js","assets/Viewshed-CPvQPK2C.js","assets/MoveManipulation-DbLnratB.js","assets/VolumeMeasurementAnalysisView3D-D3X5xhUY.js","assets/Graphics3DExtrudeSymbolLayer-DNleN2gm.js","assets/SketchTooltipInfo-BuEJ1dJE.js","assets/angularMeasurementUtils-CjE3sZvg.js","assets/TooltipInfoWithCoordinates-CFxzV-ei.js","assets/VoxelWasmPerSceneView-B0e9x6Ax.js","assets/Graphics3DSymbolLayerFactory-Cul0xCMl.js","assets/MeshComponent-BDkSxWPG.js","assets/meshProperties-DWLWd_LJ.js","assets/projectMeshVertexPositions-D8SNX3N3.js","assets/objectResourceUtils-BUfhIicr.js","assets/indexUtils-CAakT8KT.js","assets/LodRenderer-DLgFKhS5.js","assets/loader-Dbk35WsN.js","assets/TerrainTileTree3DDebugger-CAWlX8Gl.js","assets/TileTreeDebugger-CHxtOG7c.js","assets/EdgeView-pj6gTB9Y.js","assets/EdgeWorkerHandle-CJDgS8nI.js","assets/FeatureTileTree3DDebugger-DH4NQxso.js","assets/GraphicsView3D-CftG4XXW.js","assets/FocusAreasView-WjmUnNN_.js","assets/operatorDensify-BTI6qHWL.js","assets/FeatureTileTree3D-Bev61cEF.js","assets/SliceAnalysis-l07CHL0S.js","assets/lengthOperator-DNRmnrN5.js","assets/OperatorGeodeticLength-kxkWHgcE.js","assets/OperatorShapePreservingLength-DVQ95ekv.js","assets/SelfSnappingEngine-CRjJznmS.js","assets/GridSnappingEngine-yhyOyPAM.js","assets/FeatureSnappingEngine-9sqMlyKX.js","assets/geometryEngine-CBJkr_bA.js","assets/editingTools-Dg7qap7k.js","assets/SnappingVisualizer2D-Dc-a3QZS.js","assets/editPlaneUtils-CeueTuMD.js","assets/GraphicManipulator-0S_ApOXn.js","assets/drawUtils--d11VSlu.js","assets/editingTools-A7JRP1bO.js","assets/GraphicState-DhQUTkTU.js","assets/SelectedVertexTooltipInfo-ENZKFTQZ.js","assets/TranslateTooltipInfo-DxVDA0AM.js","assets/ExtentScaleTooltipInfo-D8Y5JAGr.js","assets/GraphicMover-BygXxGrz.js","assets/Box-B3s24YWD.js","assets/settings-Kw7fRE5h.js","assets/Reshape-BzOjVg77.js","assets/ElevationProfileView2D-C0ZtDvFl.js","assets/visualizationUtils-BV5eY2IG.js","assets/ElevationProfileView3D-w5oUT9ou.js","assets/index-DTyaIIOv.js","assets/index-KItPO4jS.js","assets/floating-ui-DmsTRvWV.js","assets/debounce-D0Dr7phT.js","assets/FloatingArrow-DkcsvxRy.js","assets/chartUtils-CBZlw9uE.js","assets/ResponsiveTheme-DFk3hFiD.js","assets/Theme-DxSv1Nsw.js","assets/chartUtilsAm5-DXVLZUYR.js","assets/Tooltip-CcGJixht.js","assets/DefaultTheme-D2354yCH.js","assets/LineSeries-aPg8COP0.js","assets/ColorSet-DTr9JV5-.js","assets/Tick-DVpfuod6.js","assets/Button-C0KNAi9I.js"])))=>i.map(i=>d[i]);
var hQe=Object.getPrototypeOf;var dQe=Reflect.get;var m0e=t=>{throw TypeError(t)};var $Y=(t,e,i)=>e.has(t)||m0e("Cannot "+i);var ns=(t,e,i)=>($Y(t,e,"read from private field"),i?i.call(t):e.get(t)),Up=(t,e,i)=>e.has(t)?m0e("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),Bp=(t,e,i,r)=>($Y(t,e,"write to private field"),r?r.call(t,i):e.set(t,i),i),kR=(t,e,i)=>($Y(t,e,"access private method"),i);var g0e=(t,e,i)=>dQe(hQe(t),i,e);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();var CY={exports:{}},LR={};var y0e;function pQe(){if(y0e)return LR;y0e=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(r,s,n){var a=null;if(n!==void 0&&(a=""+n),s.key!==void 0&&(a=""+s.key),"key"in s){n={};for(var o in s)o!=="key"&&(n[o]=s[o])}else n=s;return s=n.ref,{$$typeof:t,type:r,key:a,ref:s!==void 0?s:null,props:n}}return LR.Fragment=e,LR.jsx=i,LR.jsxs=i,LR}var v0e;function fQe(){return v0e||(v0e=1,CY.exports=pQe()),CY.exports}var Ew=fQe(),MY={exports:{}},Ti={};var _0e;function mQe(){if(_0e)return Ti;_0e=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),n=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),g=Symbol.iterator;function v(G){return G===null||typeof G!="object"?null:(G=g&&G[g]||G["@@iterator"],typeof G=="function"?G:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function T(G,le,de){this.props=G,this.context=le,this.refs=S,this.updater=de||_}T.prototype.isReactComponent={},T.prototype.setState=function(G,le){if(typeof G!="object"&&typeof G!="function"&&G!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,G,le,"setState")},T.prototype.forceUpdate=function(G){this.updater.enqueueForceUpdate(this,G,"forceUpdate")};function M(){}M.prototype=T.prototype;function E(G,le,de){this.props=G,this.context=le,this.refs=S,this.updater=de||_}var P=E.prototype=new M;P.constructor=E,x(P,T.prototype),P.isPureReactComponent=!0;var O=Array.isArray;function D(){}var L={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function j(G,le,de){var Se=de.ref;return{$$typeof:t,type:G,key:le,ref:Se!==void 0?Se:null,props:de}}function N(G,le){return j(G.type,le,G.props)}function B(G){return typeof G=="object"&&G!==null&&G.$$typeof===t}function U(G){var le={"=":"=0",":":"=2"};return"$"+G.replace(/[=:]/g,function(de){return le[de]})}var Q=/\/+/g;function H(G,le){return typeof G=="object"&&G!==null&&G.key!=null?U(""+G.key):le.toString(36)}function J(G){switch(G.status){case"fulfilled":return G.value;case"rejected":throw G.reason;default:switch(typeof G.status=="string"?G.then(D,D):(G.status="pending",G.then(function(le){G.status==="pending"&&(G.status="fulfilled",G.value=le)},function(le){G.status==="pending"&&(G.status="rejected",G.reason=le)})),G.status){case"fulfilled":return G.value;case"rejected":throw G.reason}}throw G}function Z(G,le,de,Se,je){var Be=typeof G;(Be==="undefined"||Be==="boolean")&&(G=null);var pt=!1;if(G===null)pt=!0;else switch(Be){case"bigint":case"string":case"number":pt=!0;break;case"object":switch(G.$$typeof){case t:case e:pt=!0;break;case d:return pt=G._init,Z(pt(G._payload),le,de,Se,je)}}if(pt)return je=je(G),pt=Se===""?"."+H(G,0):Se,O(je)?(de="",pt!=null&&(de=pt.replace(Q,"$&/")+"/"),Z(je,le,de,"",function(Bt){return Bt})):je!=null&&(B(je)&&(je=N(je,de+(je.key==null||G&&G.key===je.key?"":(""+je.key).replace(Q,"$&/")+"/")+pt)),le.push(je)),1;pt=0;var Dt=Se===""?".":Se+":";if(O(G))for(var at=0;at<G.length;at++)Se=G[at],Be=Dt+H(Se,at),pt+=Z(Se,le,de,Be,je);else if(at=v(G),typeof at=="function")for(G=at.call(G),at=0;!(Se=G.next()).done;)Se=Se.value,Be=Dt+H(Se,at++),pt+=Z(Se,le,de,Be,je);else if(Be==="object"){if(typeof G.then=="function")return Z(J(G),le,de,Se,je);throw le=String(G),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(G).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.")}return pt}function K(G,le,de){if(G==null)return G;var Se=[],je=0;return Z(G,Se,"","",function(Be){return le.call(de,Be,je++)}),Se}function ee(G){if(G._status===-1){var le=G._result;le=le(),le.then(function(de){(G._status===0||G._status===-1)&&(G._status=1,G._result=de)},function(de){(G._status===0||G._status===-1)&&(G._status=2,G._result=de)}),G._status===-1&&(G._status=0,G._result=le)}if(G._status===1)return G._result.default;throw G._result}var _e=typeof reportError=="function"?reportError:function(G){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var le=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof G=="object"&&G!==null&&typeof G.message=="string"?String(G.message):String(G),error:G});if(!window.dispatchEvent(le))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",G);return}console.error(G)},Ne={map:K,forEach:function(G,le,de){K(G,function(){le.apply(this,arguments)},de)},count:function(G){var le=0;return K(G,function(){le++}),le},toArray:function(G){return K(G,function(le){return le})||[]},only:function(G){if(!B(G))throw Error("React.Children.only expected to receive a single React element child.");return G}};return Ti.Activity=f,Ti.Children=Ne,Ti.Component=T,Ti.Fragment=i,Ti.Profiler=s,Ti.PureComponent=E,Ti.StrictMode=r,Ti.Suspense=l,Ti.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,Ti.__COMPILER_RUNTIME={__proto__:null,c:function(G){return L.H.useMemoCache(G)}},Ti.cache=function(G){return function(){return G.apply(null,arguments)}},Ti.cacheSignal=function(){return null},Ti.cloneElement=function(G,le,de){if(G==null)throw Error("The argument must be a React element, but you passed "+G+".");var Se=x({},G.props),je=G.key;if(le!=null)for(Be in le.key!==void 0&&(je=""+le.key),le)!F.call(le,Be)||Be==="key"||Be==="__self"||Be==="__source"||Be==="ref"&&le.ref===void 0||(Se[Be]=le[Be]);var Be=arguments.length-2;if(Be===1)Se.children=de;else if(1<Be){for(var pt=Array(Be),Dt=0;Dt<Be;Dt++)pt[Dt]=arguments[Dt+2];Se.children=pt}return j(G.type,je,Se)},Ti.createContext=function(G){return G={$$typeof:a,_currentValue:G,_currentValue2:G,_threadCount:0,Provider:null,Consumer:null},G.Provider=G,G.Consumer={$$typeof:n,_context:G},G},Ti.createElement=function(G,le,de){var Se,je={},Be=null;if(le!=null)for(Se in le.key!==void 0&&(Be=""+le.key),le)F.call(le,Se)&&Se!=="key"&&Se!=="__self"&&Se!=="__source"&&(je[Se]=le[Se]);var pt=arguments.length-2;if(pt===1)je.children=de;else if(1<pt){for(var Dt=Array(pt),at=0;at<pt;at++)Dt[at]=arguments[at+2];je.children=Dt}if(G&&G.defaultProps)for(Se in pt=G.defaultProps,pt)je[Se]===void 0&&(je[Se]=pt[Se]);return j(G,Be,je)},Ti.createRef=function(){return{current:null}},Ti.forwardRef=function(G){return{$$typeof:o,render:G}},Ti.isValidElement=B,Ti.lazy=function(G){return{$$typeof:d,_payload:{_status:-1,_result:G},_init:ee}},Ti.memo=function(G,le){return{$$typeof:u,type:G,compare:le===void 0?null:le}},Ti.startTransition=function(G){var le=L.T,de={};L.T=de;try{var Se=G(),je=L.S;je!==null&&je(de,Se),typeof Se=="object"&&Se!==null&&typeof Se.then=="function"&&Se.then(D,_e)}catch(Be){_e(Be)}finally{le!==null&&de.types!==null&&(le.types=de.types),L.T=le}},Ti.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},Ti.use=function(G){return L.H.use(G)},Ti.useActionState=function(G,le,de){return L.H.useActionState(G,le,de)},Ti.useCallback=function(G,le){return L.H.useCallback(G,le)},Ti.useContext=function(G){return L.H.useContext(G)},Ti.useDebugValue=function(){},Ti.useDeferredValue=function(G,le){return L.H.useDeferredValue(G,le)},Ti.useEffect=function(G,le){return L.H.useEffect(G,le)},Ti.useEffectEvent=function(G){return L.H.useEffectEvent(G)},Ti.useId=function(){return L.H.useId()},Ti.useImperativeHandle=function(G,le,de){return L.H.useImperativeHandle(G,le,de)},Ti.useInsertionEffect=function(G,le){return L.H.useInsertionEffect(G,le)},Ti.useLayoutEffect=function(G,le){return L.H.useLayoutEffect(G,le)},Ti.useMemo=function(G,le){return L.H.useMemo(G,le)},Ti.useOptimistic=function(G,le){return L.H.useOptimistic(G,le)},Ti.useReducer=function(G,le,de){return L.H.useReducer(G,le,de)},Ti.useRef=function(G){return L.H.useRef(G)},Ti.useState=function(G){return L.H.useState(G)},Ti.useSyncExternalStore=function(G,le,de){return L.H.useSyncExternalStore(G,le,de)},Ti.useTransition=function(){return L.H.useTransition()},Ti.version="19.2.3",Ti}var b0e;function tle(){return b0e||(b0e=1,MY.exports=mQe()),MY.exports}var gQe=tle(),EY={exports:{}},FR={},AY={exports:{}},OY={};var w0e;function yQe(){return w0e||(w0e=1,(function(t){function e(Z,K){var ee=Z.length;Z.push(K);e:for(;0<ee;){var _e=ee-1>>>1,Ne=Z[_e];if(0<s(Ne,K))Z[_e]=K,Z[ee]=Ne,ee=_e;else break e}}function i(Z){return Z.length===0?null:Z[0]}function r(Z){if(Z.length===0)return null;var K=Z[0],ee=Z.pop();if(ee!==K){Z[0]=ee;e:for(var _e=0,Ne=Z.length,G=Ne>>>1;_e<G;){var le=2*(_e+1)-1,de=Z[le],Se=le+1,je=Z[Se];if(0>s(de,ee))Se<Ne&&0>s(je,de)?(Z[_e]=je,Z[Se]=ee,_e=Se):(Z[_e]=de,Z[le]=ee,_e=le);else if(Se<Ne&&0>s(je,ee))Z[_e]=je,Z[Se]=ee,_e=Se;else break e}}return K}function s(Z,K){var ee=Z.sortIndex-K.sortIndex;return ee!==0?ee:Z.id-K.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var n=performance;t.unstable_now=function(){return n.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],u=[],d=1,f=null,g=3,v=!1,_=!1,x=!1,S=!1,T=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function P(Z){for(var K=i(u);K!==null;){if(K.callback===null)r(u);else if(K.startTime<=Z)r(u),K.sortIndex=K.expirationTime,e(l,K);else break;K=i(u)}}function O(Z){if(x=!1,P(Z),!_)if(i(l)!==null)_=!0,D||(D=!0,U());else{var K=i(u);K!==null&&J(O,K.startTime-Z)}}var D=!1,L=-1,F=5,j=-1;function N(){return S?!0:!(t.unstable_now()-j<F)}function B(){if(S=!1,D){var Z=t.unstable_now();j=Z;var K=!0;try{e:{_=!1,x&&(x=!1,M(L),L=-1),v=!0;var ee=g;try{t:{for(P(Z),f=i(l);f!==null&&!(f.expirationTime>Z&&N());){var _e=f.callback;if(typeof _e=="function"){f.callback=null,g=f.priorityLevel;var Ne=_e(f.expirationTime<=Z);if(Z=t.unstable_now(),typeof Ne=="function"){f.callback=Ne,P(Z),K=!0;break t}f===i(l)&&r(l),P(Z)}else r(l);f=i(l)}if(f!==null)K=!0;else{var G=i(u);G!==null&&J(O,G.startTime-Z),K=!1}}break e}finally{f=null,g=ee,v=!1}K=void 0}}finally{K?U():D=!1}}}var U;if(typeof E=="function")U=function(){E(B)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,H=Q.port2;Q.port1.onmessage=B,U=function(){H.postMessage(null)}}else U=function(){T(B,0)};function J(Z,K){L=T(function(){Z(t.unstable_now())},K)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Z){Z.callback=null},t.unstable_forceFrameRate=function(Z){0>Z||125<Z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<Z?Math.floor(1e3/Z):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_next=function(Z){switch(g){case 1:case 2:case 3:var K=3;break;default:K=g}var ee=g;g=K;try{return Z()}finally{g=ee}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(Z,K){switch(Z){case 1:case 2:case 3:case 4:case 5:break;default:Z=3}var ee=g;g=Z;try{return K()}finally{g=ee}},t.unstable_scheduleCallback=function(Z,K,ee){var _e=t.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?_e+ee:_e):ee=_e,Z){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=ee+Ne,Z={id:d++,callback:K,priorityLevel:Z,startTime:ee,expirationTime:Ne,sortIndex:-1},ee>_e?(Z.sortIndex=ee,e(u,Z),i(l)===null&&Z===i(u)&&(x?(M(L),L=-1):x=!0,J(O,ee-_e))):(Z.sortIndex=Ne,e(l,Z),_||v||(_=!0,D||(D=!0,U()))),Z},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(Z){var K=g;return function(){var ee=g;g=K;try{return Z.apply(this,arguments)}finally{g=ee}}}})(OY)),OY}var x0e;function vQe(){return x0e||(x0e=1,AY.exports=yQe()),AY.exports}var PY={exports:{}},Ml={};var S0e;function _Qe(){if(S0e)return Ml;S0e=1;var t=tle();function e(l){var u="https://react.dev/errors/"+l;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)u+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var r={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},s=Symbol.for("react.portal");function n(l,u,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:f==null?null:""+f,children:l,containerInfo:u,implementation:d}}var a=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,u){if(l==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Ml.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Ml.createPortal=function(l,u){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return n(l,u,null,d)},Ml.flushSync=function(l){var u=a.T,d=r.p;try{if(a.T=null,r.p=2,l)return l()}finally{a.T=u,r.p=d,r.d.f()}},Ml.preconnect=function(l,u){typeof l=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,r.d.C(l,u))},Ml.prefetchDNS=function(l){typeof l=="string"&&r.d.D(l)},Ml.preinit=function(l,u){if(typeof l=="string"&&u&&typeof u.as=="string"){var d=u.as,f=o(d,u.crossOrigin),g=typeof u.integrity=="string"?u.integrity:void 0,v=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;d==="style"?r.d.S(l,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:f,integrity:g,fetchPriority:v}):d==="script"&&r.d.X(l,{crossOrigin:f,integrity:g,fetchPriority:v,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Ml.preinitModule=function(l,u){if(typeof l=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var d=o(u.as,u.crossOrigin);r.d.M(l,{crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&r.d.M(l)},Ml.preload=function(l,u){if(typeof l=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var d=u.as,f=o(d,u.crossOrigin);r.d.L(l,d,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Ml.preloadModule=function(l,u){if(typeof l=="string")if(u){var d=o(u.as,u.crossOrigin);r.d.m(l,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else r.d.m(l)},Ml.requestFormReset=function(l){r.d.r(l)},Ml.unstable_batchedUpdates=function(l,u){return l(u)},Ml.useFormState=function(l,u,d){return a.H.useFormState(l,u,d)},Ml.useFormStatus=function(){return a.H.useHostTransitionStatus()},Ml.version="19.2.3",Ml}var T0e;function bQe(){if(T0e)return PY.exports;T0e=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),PY.exports=_Qe(),PY.exports}var $0e;function wQe(){if($0e)return FR;$0e=1;var t=vQe(),e=tle(),i=bQe();function r(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function n(h){var m=h,y=h;if(h.alternate)for(;m.return;)m=m.return;else{h=m;do m=h,(m.flags&4098)!==0&&(y=m.return),h=m.return;while(h)}return m.tag===3?y:null}function a(h){if(h.tag===13){var m=h.memoizedState;if(m===null&&(h=h.alternate,h!==null&&(m=h.memoizedState)),m!==null)return m.dehydrated}return null}function o(h){if(h.tag===31){var m=h.memoizedState;if(m===null&&(h=h.alternate,h!==null&&(m=h.memoizedState)),m!==null)return m.dehydrated}return null}function l(h){if(n(h)!==h)throw Error(r(188))}function u(h){var m=h.alternate;if(!m){if(m=n(h),m===null)throw Error(r(188));return m!==h?null:h}for(var y=h,w=m;;){var $=y.return;if($===null)break;var C=$.alternate;if(C===null){if(w=$.return,w!==null){y=w;continue}break}if($.child===C.child){for(C=$.child;C;){if(C===y)return l($),h;if(C===w)return l($),m;C=C.sibling}throw Error(r(188))}if(y.return!==w.return)y=$,w=C;else{for(var k=!1,V=$.child;V;){if(V===y){k=!0,y=$,w=C;break}if(V===w){k=!0,w=$,y=C;break}V=V.sibling}if(!k){for(V=C.child;V;){if(V===y){k=!0,y=C,w=$;break}if(V===w){k=!0,w=C,y=$;break}V=V.sibling}if(!k)throw Error(r(189))}}if(y.alternate!==w)throw Error(r(190))}if(y.tag!==3)throw Error(r(188));return y.stateNode.current===y?h:m}function d(h){var m=h.tag;if(m===5||m===26||m===27||m===6)return h;for(h=h.child;h!==null;){if(m=d(h),m!==null)return m;h=h.sibling}return null}var f=Object.assign,g=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),E=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),B=Symbol.iterator;function U(h){return h===null||typeof h!="object"?null:(h=B&&h[B]||h["@@iterator"],typeof h=="function"?h:null)}var Q=Symbol.for("react.client.reference");function H(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===Q?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case x:return"Fragment";case T:return"Profiler";case S:return"StrictMode";case O:return"Suspense";case D:return"SuspenseList";case j:return"Activity"}if(typeof h=="object")switch(h.$$typeof){case _:return"Portal";case E:return h.displayName||"Context";case M:return(h._context.displayName||"Context")+".Consumer";case P:var m=h.render;return h=h.displayName,h||(h=m.displayName||m.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case L:return m=h.displayName||null,m!==null?m:H(h.type)||"Memo";case F:m=h._payload,h=h._init;try{return H(h(m))}catch{}}return null}var J=Array.isArray,Z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},_e=[],Ne=-1;function G(h){return{current:h}}function le(h){0>Ne||(h.current=_e[Ne],_e[Ne]=null,Ne--)}function de(h,m){Ne++,_e[Ne]=h.current,h.current=m}var Se=G(null),je=G(null),Be=G(null),pt=G(null);function Dt(h,m){switch(de(Be,m),de(je,h),de(Se,null),m.nodeType){case 9:case 11:h=(h=m.documentElement)&&(h=h.namespaceURI)?zve(h):0;break;default:if(h=m.tagName,m=m.namespaceURI)m=zve(m),h=Nve(m,h);else switch(h){case"svg":h=1;break;case"math":h=2;break;default:h=0}}le(Se),de(Se,h)}function at(){le(Se),le(je),le(Be)}function Bt(h){h.memoizedState!==null&&de(pt,h);var m=Se.current,y=Nve(m,h.type);m!==y&&(de(je,h),de(Se,y))}function kt(h){je.current===h&&(le(Se),le(je)),pt.current===h&&(le(pt),PR._currentValue=ee)}var Lt,Xt;function Ge(h){if(Lt===void 0)try{throw Error()}catch(y){var m=y.stack.trim().match(/\n( *(at )?)/);Lt=m&&m[1]||"",Xt=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Lt+h+Xt}var Wt=!1;function Ze(h,m){if(!h||Wt)return"";Wt=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(m){var Fe=function(){throw Error()};if(Object.defineProperty(Fe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Fe,[])}catch(Te){var ve=Te}Reflect.construct(h,[],Fe)}else{try{Fe.call()}catch(Te){ve=Te}h.call(Fe.prototype)}}else{try{throw Error()}catch(Te){ve=Te}(Fe=h())&&typeof Fe.catch=="function"&&Fe.catch(function(){})}}catch(Te){if(Te&&ve&&typeof Te.stack=="string")return[Te.stack,ve.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var $=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");$&&$.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=w.DetermineComponentFrameRoot(),k=C[0],V=C[1];if(k&&V){var te=k.split(`
`),ye=V.split(`
`);for($=w=0;w<te.length&&!te[w].includes("DetermineComponentFrameRoot");)w++;for(;$<ye.length&&!ye[$].includes("DetermineComponentFrameRoot");)$++;if(w===te.length||$===ye.length)for(w=te.length-1,$=ye.length-1;1<=w&&0<=$&&te[w]!==ye[$];)$--;for(;1<=w&&0<=$;w--,$--)if(te[w]!==ye[$]){if(w!==1||$!==1)do if(w--,$--,0>$||te[w]!==ye[$]){var Ee=`
`+te[w].replace(" at new "," at ");return h.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",h.displayName)),Ee}while(1<=w&&0<=$);break}}}finally{Wt=!1,Error.prepareStackTrace=y}return(y=h?h.displayName||h.name:"")?Ge(y):""}function We(h,m){switch(h.tag){case 26:case 27:case 5:return Ge(h.type);case 16:return Ge("Lazy");case 13:return h.child!==m&&m!==null?Ge("Suspense Fallback"):Ge("Suspense");case 19:return Ge("SuspenseList");case 0:case 15:return Ze(h.type,!1);case 11:return Ze(h.type.render,!1);case 1:return Ze(h.type,!0);case 31:return Ge("Activity");default:return""}}function St(h){try{var m="",y=null;do m+=We(h,y),y=h,h=h.return;while(h);return m}catch(w){return`
Error generating stack: `+w.message+`
`+w.stack}}var vt=Object.prototype.hasOwnProperty,Nt=t.unstable_scheduleCallback,tt=t.unstable_cancelCallback,Qe=t.unstable_shouldYield,et=t.unstable_requestPaint,ht=t.unstable_now,ri=t.unstable_getCurrentPriorityLevel,Wi=t.unstable_ImmediatePriority,zi=t.unstable_UserBlockingPriority,ci=t.unstable_NormalPriority,or=t.unstable_LowPriority,tr=t.unstable_IdlePriority,Mi=t.log,Ei=t.unstable_setDisableYieldValue,ui=null,Ot=null;function Zt(h){if(typeof Mi=="function"&&Ei(h),Ot&&typeof Ot.setStrictMode=="function")try{Ot.setStrictMode(ui,h)}catch{}}var Jt=Math.clz32?Math.clz32:ir,Ni=Math.log,Nr=Math.LN2;function ir(h){return h>>>=0,h===0?32:31-(Ni(h)/Nr|0)|0}var Vi=256,Vr=262144,is=4194304;function Ds(h){var m=h&42;if(m!==0)return m;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return h&261888;case 262144:case 524288:case 1048576:case 2097152:return h&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function Ra(h,m,y){var w=h.pendingLanes;if(w===0)return 0;var $=0,C=h.suspendedLanes,k=h.pingedLanes;h=h.warmLanes;var V=w&134217727;return V!==0?(w=V&~C,w!==0?$=Ds(w):(k&=V,k!==0?$=Ds(k):y||(y=V&~h,y!==0&&($=Ds(y))))):(V=w&~C,V!==0?$=Ds(V):k!==0?$=Ds(k):y||(y=w&~h,y!==0&&($=Ds(y)))),$===0?0:m!==0&&m!==$&&(m&C)===0&&(C=$&-$,y=m&-m,C>=y||C===32&&(y&4194048)!==0)?m:$}function En(h,m){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&m)===0}function Xo(h,m){switch(h){case 1:case 2:case 4:case 8:case 64:return m+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pe(){var h=is;return is<<=1,(is&62914560)===0&&(is=4194304),h}function hi(h){for(var m=[],y=0;31>y;y++)m.push(h);return m}function ai(h,m){h.pendingLanes|=m,m!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function rs(h,m,y,w,$,C){var k=h.pendingLanes;h.pendingLanes=y,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=y,h.entangledLanes&=y,h.errorRecoveryDisabledLanes&=y,h.shellSuspendCounter=0;var V=h.entanglements,te=h.expirationTimes,ye=h.hiddenUpdates;for(y=k&~y;0<y;){var Ee=31-Jt(y),Fe=1<<Ee;V[Ee]=0,te[Ee]=-1;var ve=ye[Ee];if(ve!==null)for(ye[Ee]=null,Ee=0;Ee<ve.length;Ee++){var Te=ve[Ee];Te!==null&&(Te.lane&=-536870913)}y&=~Fe}w!==0&&lr(h,w,0),C!==0&&$===0&&h.tag!==0&&(h.suspendedLanes|=C&~(k&~m))}function lr(h,m,y){h.pendingLanes|=m,h.suspendedLanes&=~m;var w=31-Jt(m);h.entangledLanes|=m,h.entanglements[w]=h.entanglements[w]|1073741824|y&261930}function Us(h,m){var y=h.entangledLanes|=m;for(h=h.entanglements;y;){var w=31-Jt(y),$=1<<w;$&m|h[w]&m&&(h[w]|=m),y&=~$}}function it(h,m){var y=m&-m;return y=(y&42)!==0?1:Oo(y),(y&(h.suspendedLanes|m))!==0?0:y}function Oo(h){switch(h){case 2:h=1;break;case 8:h=4;break;case 32:h=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:h=128;break;case 268435456:h=134217728;break;default:h=0}return h}function Ko(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function gr(){var h=K.p;return h!==0?h:(h=window.event,h===void 0?32:l0e(h.type))}function Ia(h,m){var y=K.p;try{return K.p=h,m()}finally{K.p=y}}var rn=Math.random().toString(36).slice(2),Oi="__reactFiber$"+rn,ao="__reactProps$"+rn,kp="__reactContainer$"+rn,Kt="__reactEvents$"+rn,oy="__reactListeners$"+rn,Lp="__reactHandles$"+rn,ly="__reactResources$"+rn,wm="__reactMarker$"+rn;function Xc(h){delete h[Oi],delete h[ao],delete h[Kt],delete h[oy],delete h[Lp]}function ac(h){var m=h[Oi];if(m)return m;for(var y=h.parentNode;y;){if(m=y[kp]||y[Oi]){if(y=m.alternate,m.child!==null||y!==null&&y.child!==null)for(h=Hve(h);h!==null;){if(y=h[Oi])return y;h=Hve(h)}return m}h=y,y=h.parentNode}return null}function el(h){if(h=h[Oi]||h[kp]){var m=h.tag;if(m===5||m===6||m===13||m===31||m===26||m===27||m===3)return h}return null}function rr(h){var m=h.tag;if(m===5||m===26||m===27||m===6)return h.stateNode;throw Error(r(33))}function oo(h){var m=h[ly];return m||(m=h[ly]={hoistableStyles:new Map,hoistableScripts:new Map}),m}function ss(h){h[wm]=!0}var aa=new Set,Xu={};function $l(h,m){oc(h,m),oc(h+"Capture",m)}function oc(h,m){for(Xu[h]=m,h=0;h<m.length;h++)aa.add(m[h])}var Fp=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Da={},xm={};function Sm(h){return vt.call(xm,h)?!0:vt.call(Da,h)?!1:Fp.test(h)?xm[h]=!0:(Da[h]=!0,!1)}function zp(h,m,y){if(Sm(m))if(y===null)h.removeAttribute(m);else{switch(typeof y){case"undefined":case"function":case"symbol":h.removeAttribute(m);return;case"boolean":var w=m.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){h.removeAttribute(m);return}}h.setAttribute(m,""+y)}}function Tm(h,m,y){if(y===null)h.removeAttribute(m);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(m);return}h.setAttribute(m,""+y)}}function Y(h,m,y,w){if(w===null)h.removeAttribute(y);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(y);return}h.setAttributeNS(m,y,""+w)}}function fe(h){switch(typeof h){case"bigint":case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function qe(h){var m=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function Vt(h,m,y){var w=Object.getOwnPropertyDescriptor(h.constructor.prototype,m);if(!h.hasOwnProperty(m)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var $=w.get,C=w.set;return Object.defineProperty(h,m,{configurable:!0,get:function(){return $.call(this)},set:function(k){y=""+k,C.call(this,k)}}),Object.defineProperty(h,m,{enumerable:w.enumerable}),{getValue:function(){return y},setValue:function(k){y=""+k},stopTracking:function(){h._valueTracker=null,delete h[m]}}}}function Zi(h){if(!h._valueTracker){var m=qe(h)?"checked":"value";h._valueTracker=Vt(h,m,""+h[m])}}function bs(h){if(!h)return!1;var m=h._valueTracker;if(!m)return!0;var y=m.getValue(),w="";return h&&(w=qe(h)?h.checked?"true":"false":h.value),h=w,h!==y?(m.setValue(h),!0):!1}function ks(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}var oa=/[\n"\\]/g;function Cl(h){return h.replace(oa,function(m){return"\\"+m.charCodeAt(0).toString(16)+" "})}function z$(h,m,y,w,$,C,k,V){h.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?h.type=k:h.removeAttribute("type"),m!=null?k==="number"?(m===0&&h.value===""||h.value!=m)&&(h.value=""+fe(m)):h.value!==""+fe(m)&&(h.value=""+fe(m)):k!=="submit"&&k!=="reset"||h.removeAttribute("value"),m!=null?N$(h,k,fe(m)):y!=null?N$(h,k,fe(y)):w!=null&&h.removeAttribute("value"),$==null&&C!=null&&(h.defaultChecked=!!C),$!=null&&(h.checked=$&&typeof $!="function"&&typeof $!="symbol"),V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?h.name=""+fe(V):h.removeAttribute("name")}function WP(h,m,y,w,$,C,k,V){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(h.type=C),m!=null||y!=null){if(!(C!=="submit"&&C!=="reset"||m!=null)){Zi(h);return}y=y!=null?""+fe(y):"",m=m!=null?""+fe(m):y,V||m===h.value||(h.value=m),h.defaultValue=m}w=w??$,w=typeof w!="function"&&typeof w!="symbol"&&!!w,h.checked=V?h.checked:!!w,h.defaultChecked=!!w,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(h.name=k),Zi(h)}function N$(h,m,y){m==="number"&&ks(h.ownerDocument)===h||h.defaultValue===""+y||(h.defaultValue=""+y)}function $m(h,m,y,w){if(h=h.options,m){m={};for(var $=0;$<y.length;$++)m["$"+y[$]]=!0;for(y=0;y<h.length;y++)$=m.hasOwnProperty("$"+h[y].value),h[y].selected!==$&&(h[y].selected=$),$&&w&&(h[y].defaultSelected=!0)}else{for(y=""+fe(y),m=null,$=0;$<h.length;$++){if(h[$].value===y){h[$].selected=!0,w&&(h[$].defaultSelected=!0);return}m!==null||h[$].disabled||(m=h[$])}m!==null&&(m.selected=!0)}}function Ime(h,m,y){if(m!=null&&(m=""+fe(m),m!==h.value&&(h.value=m),y==null)){h.defaultValue!==m&&(h.defaultValue=m);return}h.defaultValue=y!=null?""+fe(y):""}function Dme(h,m,y,w){if(m==null){if(w!=null){if(y!=null)throw Error(r(92));if(J(w)){if(1<w.length)throw Error(r(93));w=w[0]}y=w}y==null&&(y=""),m=y}y=fe(m),h.defaultValue=y,w=h.textContent,w===y&&w!==""&&w!==null&&(h.value=w),Zi(h)}function V$(h,m){if(m){var y=h.firstChild;if(y&&y===h.lastChild&&y.nodeType===3){y.nodeValue=m;return}}h.textContent=m}var aYe=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kme(h,m,y){var w=m.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?w?h.setProperty(m,""):m==="float"?h.cssFloat="":h[m]="":w?h.setProperty(m,y):typeof y!="number"||y===0||aYe.has(m)?m==="float"?h.cssFloat=y:h[m]=(""+y).trim():h[m]=y+"px"}function Lme(h,m,y){if(m!=null&&typeof m!="object")throw Error(r(62));if(h=h.style,y!=null){for(var w in y)!y.hasOwnProperty(w)||m!=null&&m.hasOwnProperty(w)||(w.indexOf("--")===0?h.setProperty(w,""):w==="float"?h.cssFloat="":h[w]="");for(var $ in m)w=m[$],m.hasOwnProperty($)&&y[$]!==w&&kme(h,$,w)}else for(var C in m)m.hasOwnProperty(C)&&kme(h,C,m[C])}function wW(h){if(h.indexOf("-")===-1)return!1;switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oYe=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),lYe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function hz(h){return lYe.test(""+h)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":h}function cy(){}var xW=null;function SW(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var j$=null,U$=null;function Fme(h){var m=el(h);if(m&&(h=m.stateNode)){var y=h[ao]||null;e:switch(h=m.stateNode,m.type){case"input":if(z$(h,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),m=y.name,y.type==="radio"&&m!=null){for(y=h;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+Cl(""+m)+'"][type="radio"]'),m=0;m<y.length;m++){var w=y[m];if(w!==h&&w.form===h.form){var $=w[ao]||null;if(!$)throw Error(r(90));z$(w,$.value,$.defaultValue,$.defaultValue,$.checked,$.defaultChecked,$.type,$.name)}}for(m=0;m<y.length;m++)w=y[m],w.form===h.form&&bs(w)}break e;case"textarea":Ime(h,y.value,y.defaultValue);break e;case"select":m=y.value,m!=null&&$m(h,!!y.multiple,m,!1)}}}var TW=!1;function zme(h,m,y){if(TW)return h(m,y);TW=!0;try{var w=h(m);return w}finally{if(TW=!1,(j$!==null||U$!==null)&&(Xz(),j$&&(m=j$,h=U$,U$=j$=null,Fme(m),h)))for(m=0;m<h.length;m++)Fme(h[m])}}function ZP(h,m){var y=h.stateNode;if(y===null)return null;var w=y[ao]||null;if(w===null)return null;y=w[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(h=h.type,w=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!w;break e;default:h=!1}if(h)return null;if(y&&typeof y!="function")throw Error(r(231,m,typeof y));return y}var uy=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$W=!1;if(uy)try{var YP={};Object.defineProperty(YP,"passive",{get:function(){$W=!0}}),window.addEventListener("test",YP,YP),window.removeEventListener("test",YP,YP)}catch{$W=!1}var f_=null,CW=null,dz=null;function Nme(){if(dz)return dz;var h,m=CW,y=m.length,w,$="value"in f_?f_.value:f_.textContent,C=$.length;for(h=0;h<y&&m[h]===$[h];h++);var k=y-h;for(w=1;w<=k&&m[y-w]===$[C-w];w++);return dz=$.slice(h,1<w?1-w:void 0)}function pz(h){var m=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&m===13&&(h=13)):h=m,h===10&&(h=13),32<=h||h===13?h:0}function fz(){return!0}function Vme(){return!1}function Kc(h){function m(y,w,$,C,k){this._reactName=y,this._targetInst=$,this.type=w,this.nativeEvent=C,this.target=k,this.currentTarget=null;for(var V in h)h.hasOwnProperty(V)&&(y=h[V],this[V]=y?y(C):C[V]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?fz:Vme,this.isPropagationStopped=Vme,this}return f(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=fz)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=fz)},persist:function(){},isPersistent:fz}),m}var W1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mz=Kc(W1),JP=f({},W1,{view:0,detail:0}),cYe=Kc(JP),MW,EW,QP,gz=f({},JP,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:OW,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==QP&&(QP&&h.type==="mousemove"?(MW=h.screenX-QP.screenX,EW=h.screenY-QP.screenY):EW=MW=0,QP=h),MW)},movementY:function(h){return"movementY"in h?h.movementY:EW}}),jme=Kc(gz),uYe=f({},gz,{dataTransfer:0}),hYe=Kc(uYe),dYe=f({},JP,{relatedTarget:0}),AW=Kc(dYe),pYe=f({},W1,{animationName:0,elapsedTime:0,pseudoElement:0}),fYe=Kc(pYe),mYe=f({},W1,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),gYe=Kc(mYe),yYe=f({},W1,{data:0}),Ume=Kc(yYe),vYe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_Ye={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bYe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wYe(h){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(h):(h=bYe[h])?!!m[h]:!1}function OW(){return wYe}var xYe=f({},JP,{key:function(h){if(h.key){var m=vYe[h.key]||h.key;if(m!=="Unidentified")return m}return h.type==="keypress"?(h=pz(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?_Ye[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:OW,charCode:function(h){return h.type==="keypress"?pz(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?pz(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),SYe=Kc(xYe),TYe=f({},gz,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bme=Kc(TYe),$Ye=f({},JP,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:OW}),CYe=Kc($Ye),MYe=f({},W1,{propertyName:0,elapsedTime:0,pseudoElement:0}),EYe=Kc(MYe),AYe=f({},gz,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),OYe=Kc(AYe),PYe=f({},W1,{newState:0,oldState:0}),RYe=Kc(PYe),IYe=[9,13,27,32],PW=uy&&"CompositionEvent"in window,XP=null;uy&&"documentMode"in document&&(XP=document.documentMode);var DYe=uy&&"TextEvent"in window&&!XP,qme=uy&&(!PW||XP&&8<XP&&11>=XP),Gme=" ",Hme=!1;function Wme(h,m){switch(h){case"keyup":return IYe.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zme(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var B$=!1;function kYe(h,m){switch(h){case"compositionend":return Zme(m);case"keypress":return m.which!==32?null:(Hme=!0,Gme);case"textInput":return h=m.data,h===Gme&&Hme?null:h;default:return null}}function LYe(h,m){if(B$)return h==="compositionend"||!PW&&Wme(h,m)?(h=Nme(),dz=CW=f_=null,B$=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return qme&&m.locale!=="ko"?null:m.data;default:return null}}var FYe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yme(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m==="input"?!!FYe[h.type]:m==="textarea"}function Jme(h,m,y,w){j$?U$?U$.push(w):U$=[w]:j$=w,m=nN(m,"onChange"),0<m.length&&(y=new mz("onChange","change",null,y,w),h.push({event:y,listeners:m}))}var KP=null,eR=null;function zYe(h){Rve(h,0)}function yz(h){var m=rr(h);if(bs(m))return h}function Qme(h,m){if(h==="change")return m}var Xme=!1;if(uy){var RW;if(uy){var IW="oninput"in document;if(!IW){var Kme=document.createElement("div");Kme.setAttribute("oninput","return;"),IW=typeof Kme.oninput=="function"}RW=IW}else RW=!1;Xme=RW&&(!document.documentMode||9<document.documentMode)}function ege(){KP&&(KP.detachEvent("onpropertychange",tge),eR=KP=null)}function tge(h){if(h.propertyName==="value"&&yz(eR)){var m=[];Jme(m,eR,h,SW(h)),zme(zYe,m)}}function NYe(h,m,y){h==="focusin"?(ege(),KP=m,eR=y,KP.attachEvent("onpropertychange",tge)):h==="focusout"&&ege()}function VYe(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return yz(eR)}function jYe(h,m){if(h==="click")return yz(m)}function UYe(h,m){if(h==="input"||h==="change")return yz(m)}function BYe(h,m){return h===m&&(h!==0||1/h===1/m)||h!==h&&m!==m}var Ku=typeof Object.is=="function"?Object.is:BYe;function tR(h,m){if(Ku(h,m))return!0;if(typeof h!="object"||h===null||typeof m!="object"||m===null)return!1;var y=Object.keys(h),w=Object.keys(m);if(y.length!==w.length)return!1;for(w=0;w<y.length;w++){var $=y[w];if(!vt.call(m,$)||!Ku(h[$],m[$]))return!1}return!0}function ige(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function rge(h,m){var y=ige(h);h=0;for(var w;y;){if(y.nodeType===3){if(w=h+y.textContent.length,h<=m&&w>=m)return{node:y,offset:m-h};h=w}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=ige(y)}}function sge(h,m){return h&&m?h===m?!0:h&&h.nodeType===3?!1:m&&m.nodeType===3?sge(h,m.parentNode):"contains"in h?h.contains(m):h.compareDocumentPosition?!!(h.compareDocumentPosition(m)&16):!1:!1}function nge(h){h=h!=null&&h.ownerDocument!=null&&h.ownerDocument.defaultView!=null?h.ownerDocument.defaultView:window;for(var m=ks(h.document);m instanceof h.HTMLIFrameElement;){try{var y=typeof m.contentWindow.location.href=="string"}catch{y=!1}if(y)h=m.contentWindow;else break;m=ks(h.document)}return m}function DW(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m&&(m==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||m==="textarea"||h.contentEditable==="true")}var qYe=uy&&"documentMode"in document&&11>=document.documentMode,q$=null,kW=null,iR=null,LW=!1;function age(h,m,y){var w=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;LW||q$==null||q$!==ks(w)||(w=q$,"selectionStart"in w&&DW(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),iR&&tR(iR,w)||(iR=w,w=nN(kW,"onSelect"),0<w.length&&(m=new mz("onSelect","select",null,m,y),h.push({event:m,listeners:w}),m.target=q$)))}function Z1(h,m){var y={};return y[h.toLowerCase()]=m.toLowerCase(),y["Webkit"+h]="webkit"+m,y["Moz"+h]="moz"+m,y}var G$={animationend:Z1("Animation","AnimationEnd"),animationiteration:Z1("Animation","AnimationIteration"),animationstart:Z1("Animation","AnimationStart"),transitionrun:Z1("Transition","TransitionRun"),transitionstart:Z1("Transition","TransitionStart"),transitioncancel:Z1("Transition","TransitionCancel"),transitionend:Z1("Transition","TransitionEnd")},FW={},oge={};uy&&(oge=document.createElement("div").style,"AnimationEvent"in window||(delete G$.animationend.animation,delete G$.animationiteration.animation,delete G$.animationstart.animation),"TransitionEvent"in window||delete G$.transitionend.transition);function Y1(h){if(FW[h])return FW[h];if(!G$[h])return h;var m=G$[h],y;for(y in m)if(m.hasOwnProperty(y)&&y in oge)return FW[h]=m[y];return h}var lge=Y1("animationend"),cge=Y1("animationiteration"),uge=Y1("animationstart"),GYe=Y1("transitionrun"),HYe=Y1("transitionstart"),WYe=Y1("transitioncancel"),hge=Y1("transitionend"),dge=new Map,zW="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zW.push("scrollEnd");function Np(h,m){dge.set(h,m),$l(m,[h])}var vz=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)},ad=[],H$=0,NW=0;function _z(){for(var h=H$,m=NW=H$=0;m<h;){var y=ad[m];ad[m++]=null;var w=ad[m];ad[m++]=null;var $=ad[m];ad[m++]=null;var C=ad[m];if(ad[m++]=null,w!==null&&$!==null){var k=w.pending;k===null?$.next=$:($.next=k.next,k.next=$),w.pending=$}C!==0&&pge(y,$,C)}}function bz(h,m,y,w){ad[H$++]=h,ad[H$++]=m,ad[H$++]=y,ad[H$++]=w,NW|=w,h.lanes|=w,h=h.alternate,h!==null&&(h.lanes|=w)}function VW(h,m,y,w){return bz(h,m,y,w),wz(h)}function J1(h,m){return bz(h,null,null,m),wz(h)}function pge(h,m,y){h.lanes|=y;var w=h.alternate;w!==null&&(w.lanes|=y);for(var $=!1,C=h.return;C!==null;)C.childLanes|=y,w=C.alternate,w!==null&&(w.childLanes|=y),C.tag===22&&(h=C.stateNode,h===null||h._visibility&1||($=!0)),h=C,C=C.return;return h.tag===3?(C=h.stateNode,$&&m!==null&&($=31-Jt(y),h=C.hiddenUpdates,w=h[$],w===null?h[$]=[m]:w.push(m),m.lane=y|536870912),C):null}function wz(h){if(50<TR)throw TR=0,YZ=null,Error(r(185));for(var m=h.return;m!==null;)h=m,m=h.return;return h.tag===3?h.stateNode:null}var W$={};function ZYe(h,m,y,w){this.tag=h,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function eh(h,m,y,w){return new ZYe(h,m,y,w)}function jW(h){return h=h.prototype,!(!h||!h.isReactComponent)}function hy(h,m){var y=h.alternate;return y===null?(y=eh(h.tag,m,h.key,h.mode),y.elementType=h.elementType,y.type=h.type,y.stateNode=h.stateNode,y.alternate=h,h.alternate=y):(y.pendingProps=m,y.type=h.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=h.flags&65011712,y.childLanes=h.childLanes,y.lanes=h.lanes,y.child=h.child,y.memoizedProps=h.memoizedProps,y.memoizedState=h.memoizedState,y.updateQueue=h.updateQueue,m=h.dependencies,y.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},y.sibling=h.sibling,y.index=h.index,y.ref=h.ref,y.refCleanup=h.refCleanup,y}function fge(h,m){h.flags&=65011714;var y=h.alternate;return y===null?(h.childLanes=0,h.lanes=m,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=y.childLanes,h.lanes=y.lanes,h.child=y.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=y.memoizedProps,h.memoizedState=y.memoizedState,h.updateQueue=y.updateQueue,h.type=y.type,m=y.dependencies,h.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),h}function xz(h,m,y,w,$,C){var k=0;if(w=h,typeof h=="function")jW(h)&&(k=1);else if(typeof h=="string")k=KJe(h,y,Se.current)?26:h==="html"||h==="head"||h==="body"?27:5;else e:switch(h){case j:return h=eh(31,y,m,$),h.elementType=j,h.lanes=C,h;case x:return Q1(y.children,$,C,m);case S:k=8,$|=24;break;case T:return h=eh(12,y,m,$|2),h.elementType=T,h.lanes=C,h;case O:return h=eh(13,y,m,$),h.elementType=O,h.lanes=C,h;case D:return h=eh(19,y,m,$),h.elementType=D,h.lanes=C,h;default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case E:k=10;break e;case M:k=9;break e;case P:k=11;break e;case L:k=14;break e;case F:k=16,w=null;break e}k=29,y=Error(r(130,h===null?"null":typeof h,"")),w=null}return m=eh(k,y,m,$),m.elementType=h,m.type=w,m.lanes=C,m}function Q1(h,m,y,w){return h=eh(7,h,w,m),h.lanes=y,h}function UW(h,m,y){return h=eh(6,h,null,m),h.lanes=y,h}function mge(h){var m=eh(18,null,null,0);return m.stateNode=h,m}function BW(h,m,y){return m=eh(4,h.children!==null?h.children:[],h.key,m),m.lanes=y,m.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},m}var gge=new WeakMap;function od(h,m){if(typeof h=="object"&&h!==null){var y=gge.get(h);return y!==void 0?y:(m={value:h,source:m,stack:St(m)},gge.set(h,m),m)}return{value:h,source:m,stack:St(m)}}var Z$=[],Y$=0,Sz=null,rR=0,ld=[],cd=0,m_=null,Cm=1,Mm="";function dy(h,m){Z$[Y$++]=rR,Z$[Y$++]=Sz,Sz=h,rR=m}function yge(h,m,y){ld[cd++]=Cm,ld[cd++]=Mm,ld[cd++]=m_,m_=h;var w=Cm;h=Mm;var $=32-Jt(w)-1;w&=~(1<<$),y+=1;var C=32-Jt(m)+$;if(30<C){var k=$-$%5;C=(w&(1<<k)-1).toString(32),w>>=k,$-=k,Cm=1<<32-Jt(m)+$|y<<$|w,Mm=C+h}else Cm=1<<C|y<<$|w,Mm=h}function qW(h){h.return!==null&&(dy(h,1),yge(h,1,0))}function GW(h){for(;h===Sz;)Sz=Z$[--Y$],Z$[Y$]=null,rR=Z$[--Y$],Z$[Y$]=null;for(;h===m_;)m_=ld[--cd],ld[cd]=null,Mm=ld[--cd],ld[cd]=null,Cm=ld[--cd],ld[cd]=null}function vge(h,m){ld[cd++]=Cm,ld[cd++]=Mm,ld[cd++]=m_,Cm=m.id,Mm=m.overflow,m_=h}var tl=null,sn=null,Cr=!1,g_=null,ud=!1,HW=Error(r(519));function y_(h){var m=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw sR(od(m,h)),HW}function _ge(h){var m=h.stateNode,y=h.type,w=h.memoizedProps;switch(m[Oi]=h,m[ao]=w,y){case"dialog":hr("cancel",m),hr("close",m);break;case"iframe":case"object":case"embed":hr("load",m);break;case"video":case"audio":for(y=0;y<CR.length;y++)hr(CR[y],m);break;case"source":hr("error",m);break;case"img":case"image":case"link":hr("error",m),hr("load",m);break;case"details":hr("toggle",m);break;case"input":hr("invalid",m),WP(m,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0);break;case"select":hr("invalid",m);break;case"textarea":hr("invalid",m),Dme(m,w.value,w.defaultValue,w.children)}y=w.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||m.textContent===""+y||w.suppressHydrationWarning===!0||Lve(m.textContent,y)?(w.popover!=null&&(hr("beforetoggle",m),hr("toggle",m)),w.onScroll!=null&&hr("scroll",m),w.onScrollEnd!=null&&hr("scrollend",m),w.onClick!=null&&(m.onclick=cy),m=!0):m=!1,m||y_(h,!0)}function bge(h){for(tl=h.return;tl;)switch(tl.tag){case 5:case 31:case 13:ud=!1;return;case 27:case 3:ud=!0;return;default:tl=tl.return}}function J$(h){if(h!==tl)return!1;if(!Cr)return bge(h),Cr=!0,!1;var m=h.tag,y;if((y=m!==3&&m!==27)&&((y=m===5)&&(y=h.type,y=!(y!=="form"&&y!=="button")||uY(h.type,h.memoizedProps)),y=!y),y&&sn&&y_(h),bge(h),m===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(r(317));sn=Gve(h)}else if(m===31){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(r(317));sn=Gve(h)}else m===27?(m=sn,P_(h.type)?(h=mY,mY=null,sn=h):sn=m):sn=tl?dd(h.stateNode.nextSibling):null;return!0}function X1(){sn=tl=null,Cr=!1}function WW(){var h=g_;return h!==null&&(ru===null?ru=h:ru.push.apply(ru,h),g_=null),h}function sR(h){g_===null?g_=[h]:g_.push(h)}var ZW=G(null),K1=null,py=null;function v_(h,m,y){de(ZW,m._currentValue),m._currentValue=y}function fy(h){h._currentValue=ZW.current,le(ZW)}function YW(h,m,y){for(;h!==null;){var w=h.alternate;if((h.childLanes&m)!==m?(h.childLanes|=m,w!==null&&(w.childLanes|=m)):w!==null&&(w.childLanes&m)!==m&&(w.childLanes|=m),h===y)break;h=h.return}}function JW(h,m,y,w){var $=h.child;for($!==null&&($.return=h);$!==null;){var C=$.dependencies;if(C!==null){var k=$.child;C=C.firstContext;e:for(;C!==null;){var V=C;C=$;for(var te=0;te<m.length;te++)if(V.context===m[te]){C.lanes|=y,V=C.alternate,V!==null&&(V.lanes|=y),YW(C.return,y,h),w||(k=null);break e}C=V.next}}else if($.tag===18){if(k=$.return,k===null)throw Error(r(341));k.lanes|=y,C=k.alternate,C!==null&&(C.lanes|=y),YW(k,y,h),k=null}else k=$.child;if(k!==null)k.return=$;else for(k=$;k!==null;){if(k===h){k=null;break}if($=k.sibling,$!==null){$.return=k.return,k=$;break}k=k.return}$=k}}function Q$(h,m,y,w){h=null;for(var $=m,C=!1;$!==null;){if(!C){if(($.flags&524288)!==0)C=!0;else if(($.flags&262144)!==0)break}if($.tag===10){var k=$.alternate;if(k===null)throw Error(r(387));if(k=k.memoizedProps,k!==null){var V=$.type;Ku($.pendingProps.value,k.value)||(h!==null?h.push(V):h=[V])}}else if($===pt.current){if(k=$.alternate,k===null)throw Error(r(387));k.memoizedState.memoizedState!==$.memoizedState.memoizedState&&(h!==null?h.push(PR):h=[PR])}$=$.return}h!==null&&JW(m,h,y,w),m.flags|=262144}function Tz(h){for(h=h.firstContext;h!==null;){if(!Ku(h.context._currentValue,h.memoizedValue))return!0;h=h.next}return!1}function ex(h){K1=h,py=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function il(h){return wge(K1,h)}function $z(h,m){return K1===null&&ex(h),wge(h,m)}function wge(h,m){var y=m._currentValue;if(m={context:m,memoizedValue:y,next:null},py===null){if(h===null)throw Error(r(308));py=m,h.dependencies={lanes:0,firstContext:m},h.flags|=524288}else py=py.next=m;return y}var YYe=typeof AbortController<"u"?AbortController:function(){var h=[],m=this.signal={aborted:!1,addEventListener:function(y,w){h.push(w)}};this.abort=function(){m.aborted=!0,h.forEach(function(y){return y()})}},JYe=t.unstable_scheduleCallback,QYe=t.unstable_NormalPriority,ka={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function QW(){return{controller:new YYe,data:new Map,refCount:0}}function nR(h){h.refCount--,h.refCount===0&&JYe(QYe,function(){h.controller.abort()})}var aR=null,XW=0,X$=0,K$=null;function XYe(h,m){if(aR===null){var y=aR=[];XW=0,X$=tY(),K$={status:"pending",value:void 0,then:function(w){y.push(w)}}}return XW++,m.then(xge,xge),m}function xge(){if(--XW===0&&aR!==null){K$!==null&&(K$.status="fulfilled");var h=aR;aR=null,X$=0,K$=null;for(var m=0;m<h.length;m++)(0,h[m])()}}function KYe(h,m){var y=[],w={status:"pending",value:null,reason:null,then:function($){y.push($)}};return h.then(function(){w.status="fulfilled",w.value=m;for(var $=0;$<y.length;$++)(0,y[$])(m)},function($){for(w.status="rejected",w.reason=$,$=0;$<y.length;$++)(0,y[$])(void 0)}),w}var Sge=Z.S;Z.S=function(h,m){ave=ht(),typeof m=="object"&&m!==null&&typeof m.then=="function"&&XYe(h,m),Sge!==null&&Sge(h,m)};var tx=G(null);function KW(){var h=tx.current;return h!==null?h:Ls.pooledCache}function Cz(h,m){m===null?de(tx,tx.current):de(tx,m.pool)}function Tge(){var h=KW();return h===null?null:{parent:ka._currentValue,pool:h}}var eC=Error(r(460)),eZ=Error(r(474)),Mz=Error(r(542)),Ez={then:function(){}};function $ge(h){return h=h.status,h==="fulfilled"||h==="rejected"}function Cge(h,m,y){switch(y=h[y],y===void 0?h.push(m):y!==m&&(m.then(cy,cy),m=y),m.status){case"fulfilled":return m.value;case"rejected":throw h=m.reason,Ege(h),h;default:if(typeof m.status=="string")m.then(cy,cy);else{if(h=Ls,h!==null&&100<h.shellSuspendCounter)throw Error(r(482));h=m,h.status="pending",h.then(function(w){if(m.status==="pending"){var $=m;$.status="fulfilled",$.value=w}},function(w){if(m.status==="pending"){var $=m;$.status="rejected",$.reason=w}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw h=m.reason,Ege(h),h}throw rx=m,eC}}function ix(h){try{var m=h._init;return m(h._payload)}catch(y){throw y!==null&&typeof y=="object"&&typeof y.then=="function"?(rx=y,eC):y}}var rx=null;function Mge(){if(rx===null)throw Error(r(459));var h=rx;return rx=null,h}function Ege(h){if(h===eC||h===Mz)throw Error(r(483))}var tC=null,oR=0;function Az(h){var m=oR;return oR+=1,tC===null&&(tC=[]),Cge(tC,h,m)}function lR(h,m){m=m.props.ref,h.ref=m!==void 0?m:null}function Oz(h,m){throw m.$$typeof===g?Error(r(525)):(h=Object.prototype.toString.call(m),Error(r(31,h==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":h)))}function Age(h){function m(ce,oe){if(h){var ge=ce.deletions;ge===null?(ce.deletions=[oe],ce.flags|=16):ge.push(oe)}}function y(ce,oe){if(!h)return null;for(;oe!==null;)m(ce,oe),oe=oe.sibling;return null}function w(ce){for(var oe=new Map;ce!==null;)ce.key!==null?oe.set(ce.key,ce):oe.set(ce.index,ce),ce=ce.sibling;return oe}function $(ce,oe){return ce=hy(ce,oe),ce.index=0,ce.sibling=null,ce}function C(ce,oe,ge){return ce.index=ge,h?(ge=ce.alternate,ge!==null?(ge=ge.index,ge<oe?(ce.flags|=67108866,oe):ge):(ce.flags|=67108866,oe)):(ce.flags|=1048576,oe)}function k(ce){return h&&ce.alternate===null&&(ce.flags|=67108866),ce}function V(ce,oe,ge,De){return oe===null||oe.tag!==6?(oe=UW(ge,ce.mode,De),oe.return=ce,oe):(oe=$(oe,ge),oe.return=ce,oe)}function te(ce,oe,ge,De){var Qt=ge.type;return Qt===x?Ee(ce,oe,ge.props.children,De,ge.key):oe!==null&&(oe.elementType===Qt||typeof Qt=="object"&&Qt!==null&&Qt.$$typeof===F&&ix(Qt)===oe.type)?(oe=$(oe,ge.props),lR(oe,ge),oe.return=ce,oe):(oe=xz(ge.type,ge.key,ge.props,null,ce.mode,De),lR(oe,ge),oe.return=ce,oe)}function ye(ce,oe,ge,De){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==ge.containerInfo||oe.stateNode.implementation!==ge.implementation?(oe=BW(ge,ce.mode,De),oe.return=ce,oe):(oe=$(oe,ge.children||[]),oe.return=ce,oe)}function Ee(ce,oe,ge,De,Qt){return oe===null||oe.tag!==7?(oe=Q1(ge,ce.mode,De,Qt),oe.return=ce,oe):(oe=$(oe,ge),oe.return=ce,oe)}function Fe(ce,oe,ge){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return oe=UW(""+oe,ce.mode,ge),oe.return=ce,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case v:return ge=xz(oe.type,oe.key,oe.props,null,ce.mode,ge),lR(ge,oe),ge.return=ce,ge;case _:return oe=BW(oe,ce.mode,ge),oe.return=ce,oe;case F:return oe=ix(oe),Fe(ce,oe,ge)}if(J(oe)||U(oe))return oe=Q1(oe,ce.mode,ge,null),oe.return=ce,oe;if(typeof oe.then=="function")return Fe(ce,Az(oe),ge);if(oe.$$typeof===E)return Fe(ce,$z(ce,oe),ge);Oz(ce,oe)}return null}function ve(ce,oe,ge,De){var Qt=oe!==null?oe.key:null;if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return Qt!==null?null:V(ce,oe,""+ge,De);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case v:return ge.key===Qt?te(ce,oe,ge,De):null;case _:return ge.key===Qt?ye(ce,oe,ge,De):null;case F:return ge=ix(ge),ve(ce,oe,ge,De)}if(J(ge)||U(ge))return Qt!==null?null:Ee(ce,oe,ge,De,null);if(typeof ge.then=="function")return ve(ce,oe,Az(ge),De);if(ge.$$typeof===E)return ve(ce,oe,$z(ce,ge),De);Oz(ce,ge)}return null}function Te(ce,oe,ge,De,Qt){if(typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint")return ce=ce.get(ge)||null,V(oe,ce,""+De,Qt);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case v:return ce=ce.get(De.key===null?ge:De.key)||null,te(oe,ce,De,Qt);case _:return ce=ce.get(De.key===null?ge:De.key)||null,ye(oe,ce,De,Qt);case F:return De=ix(De),Te(ce,oe,ge,De,Qt)}if(J(De)||U(De))return ce=ce.get(ge)||null,Ee(oe,ce,De,Qt,null);if(typeof De.then=="function")return Te(ce,oe,ge,Az(De),Qt);if(De.$$typeof===E)return Te(ce,oe,ge,$z(oe,De),Qt);Oz(oe,De)}return null}function Pt(ce,oe,ge,De){for(var Qt=null,jr=null,Ut=oe,ji=oe=0,vr=null;Ut!==null&&ji<ge.length;ji++){Ut.index>ji?(vr=Ut,Ut=null):vr=Ut.sibling;var Ur=ve(ce,Ut,ge[ji],De);if(Ur===null){Ut===null&&(Ut=vr);break}h&&Ut&&Ur.alternate===null&&m(ce,Ut),oe=C(Ur,oe,ji),jr===null?Qt=Ur:jr.sibling=Ur,jr=Ur,Ut=vr}if(ji===ge.length)return y(ce,Ut),Cr&&dy(ce,ji),Qt;if(Ut===null){for(;ji<ge.length;ji++)Ut=Fe(ce,ge[ji],De),Ut!==null&&(oe=C(Ut,oe,ji),jr===null?Qt=Ut:jr.sibling=Ut,jr=Ut);return Cr&&dy(ce,ji),Qt}for(Ut=w(Ut);ji<ge.length;ji++)vr=Te(Ut,ce,ji,ge[ji],De),vr!==null&&(h&&vr.alternate!==null&&Ut.delete(vr.key===null?ji:vr.key),oe=C(vr,oe,ji),jr===null?Qt=vr:jr.sibling=vr,jr=vr);return h&&Ut.forEach(function(L_){return m(ce,L_)}),Cr&&dy(ce,ji),Qt}function si(ce,oe,ge,De){if(ge==null)throw Error(r(151));for(var Qt=null,jr=null,Ut=oe,ji=oe=0,vr=null,Ur=ge.next();Ut!==null&&!Ur.done;ji++,Ur=ge.next()){Ut.index>ji?(vr=Ut,Ut=null):vr=Ut.sibling;var L_=ve(ce,Ut,Ur.value,De);if(L_===null){Ut===null&&(Ut=vr);break}h&&Ut&&L_.alternate===null&&m(ce,Ut),oe=C(L_,oe,ji),jr===null?Qt=L_:jr.sibling=L_,jr=L_,Ut=vr}if(Ur.done)return y(ce,Ut),Cr&&dy(ce,ji),Qt;if(Ut===null){for(;!Ur.done;ji++,Ur=ge.next())Ur=Fe(ce,Ur.value,De),Ur!==null&&(oe=C(Ur,oe,ji),jr===null?Qt=Ur:jr.sibling=Ur,jr=Ur);return Cr&&dy(ce,ji),Qt}for(Ut=w(Ut);!Ur.done;ji++,Ur=ge.next())Ur=Te(Ut,ce,ji,Ur.value,De),Ur!==null&&(h&&Ur.alternate!==null&&Ut.delete(Ur.key===null?ji:Ur.key),oe=C(Ur,oe,ji),jr===null?Qt=Ur:jr.sibling=Ur,jr=Ur);return h&&Ut.forEach(function(uQe){return m(ce,uQe)}),Cr&&dy(ce,ji),Qt}function Ss(ce,oe,ge,De){if(typeof ge=="object"&&ge!==null&&ge.type===x&&ge.key===null&&(ge=ge.props.children),typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case v:e:{for(var Qt=ge.key;oe!==null;){if(oe.key===Qt){if(Qt=ge.type,Qt===x){if(oe.tag===7){y(ce,oe.sibling),De=$(oe,ge.props.children),De.return=ce,ce=De;break e}}else if(oe.elementType===Qt||typeof Qt=="object"&&Qt!==null&&Qt.$$typeof===F&&ix(Qt)===oe.type){y(ce,oe.sibling),De=$(oe,ge.props),lR(De,ge),De.return=ce,ce=De;break e}y(ce,oe);break}else m(ce,oe);oe=oe.sibling}ge.type===x?(De=Q1(ge.props.children,ce.mode,De,ge.key),De.return=ce,ce=De):(De=xz(ge.type,ge.key,ge.props,null,ce.mode,De),lR(De,ge),De.return=ce,ce=De)}return k(ce);case _:e:{for(Qt=ge.key;oe!==null;){if(oe.key===Qt)if(oe.tag===4&&oe.stateNode.containerInfo===ge.containerInfo&&oe.stateNode.implementation===ge.implementation){y(ce,oe.sibling),De=$(oe,ge.children||[]),De.return=ce,ce=De;break e}else{y(ce,oe);break}else m(ce,oe);oe=oe.sibling}De=BW(ge,ce.mode,De),De.return=ce,ce=De}return k(ce);case F:return ge=ix(ge),Ss(ce,oe,ge,De)}if(J(ge))return Pt(ce,oe,ge,De);if(U(ge)){if(Qt=U(ge),typeof Qt!="function")throw Error(r(150));return ge=Qt.call(ge),si(ce,oe,ge,De)}if(typeof ge.then=="function")return Ss(ce,oe,Az(ge),De);if(ge.$$typeof===E)return Ss(ce,oe,$z(ce,ge),De);Oz(ce,ge)}return typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint"?(ge=""+ge,oe!==null&&oe.tag===6?(y(ce,oe.sibling),De=$(oe,ge),De.return=ce,ce=De):(y(ce,oe),De=UW(ge,ce.mode,De),De.return=ce,ce=De),k(ce)):y(ce,oe)}return function(ce,oe,ge,De){try{oR=0;var Qt=Ss(ce,oe,ge,De);return tC=null,Qt}catch(Ut){if(Ut===eC||Ut===Mz)throw Ut;var jr=eh(29,Ut,null,ce.mode);return jr.lanes=De,jr.return=ce,jr}}}var sx=Age(!0),Oge=Age(!1),__=!1;function tZ(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function iZ(h,m){h=h.updateQueue,m.updateQueue===h&&(m.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function b_(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function w_(h,m,y){var w=h.updateQueue;if(w===null)return null;if(w=w.shared,(Qr&2)!==0){var $=w.pending;return $===null?m.next=m:(m.next=$.next,$.next=m),w.pending=m,m=wz(h),pge(h,null,y),m}return bz(h,w,m,y),wz(h)}function cR(h,m,y){if(m=m.updateQueue,m!==null&&(m=m.shared,(y&4194048)!==0)){var w=m.lanes;w&=h.pendingLanes,y|=w,m.lanes=y,Us(h,y)}}function rZ(h,m){var y=h.updateQueue,w=h.alternate;if(w!==null&&(w=w.updateQueue,y===w)){var $=null,C=null;if(y=y.firstBaseUpdate,y!==null){do{var k={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};C===null?$=C=k:C=C.next=k,y=y.next}while(y!==null);C===null?$=C=m:C=C.next=m}else $=C=m;y={baseState:w.baseState,firstBaseUpdate:$,lastBaseUpdate:C,shared:w.shared,callbacks:w.callbacks},h.updateQueue=y;return}h=y.lastBaseUpdate,h===null?y.firstBaseUpdate=m:h.next=m,y.lastBaseUpdate=m}var sZ=!1;function uR(){if(sZ){var h=K$;if(h!==null)throw h}}function hR(h,m,y,w){sZ=!1;var $=h.updateQueue;__=!1;var C=$.firstBaseUpdate,k=$.lastBaseUpdate,V=$.shared.pending;if(V!==null){$.shared.pending=null;var te=V,ye=te.next;te.next=null,k===null?C=ye:k.next=ye,k=te;var Ee=h.alternate;Ee!==null&&(Ee=Ee.updateQueue,V=Ee.lastBaseUpdate,V!==k&&(V===null?Ee.firstBaseUpdate=ye:V.next=ye,Ee.lastBaseUpdate=te))}if(C!==null){var Fe=$.baseState;k=0,Ee=ye=te=null,V=C;do{var ve=V.lane&-536870913,Te=ve!==V.lane;if(Te?(yr&ve)===ve:(w&ve)===ve){ve!==0&&ve===X$&&(sZ=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:V.tag,payload:V.payload,callback:null,next:null});e:{var Pt=h,si=V;ve=m;var Ss=y;switch(si.tag){case 1:if(Pt=si.payload,typeof Pt=="function"){Fe=Pt.call(Ss,Fe,ve);break e}Fe=Pt;break e;case 3:Pt.flags=Pt.flags&-65537|128;case 0:if(Pt=si.payload,ve=typeof Pt=="function"?Pt.call(Ss,Fe,ve):Pt,ve==null)break e;Fe=f({},Fe,ve);break e;case 2:__=!0}}ve=V.callback,ve!==null&&(h.flags|=64,Te&&(h.flags|=8192),Te=$.callbacks,Te===null?$.callbacks=[ve]:Te.push(ve))}else Te={lane:ve,tag:V.tag,payload:V.payload,callback:V.callback,next:null},Ee===null?(ye=Ee=Te,te=Fe):Ee=Ee.next=Te,k|=ve;if(V=V.next,V===null){if(V=$.shared.pending,V===null)break;Te=V,V=Te.next,Te.next=null,$.lastBaseUpdate=Te,$.shared.pending=null}}while(!0);Ee===null&&(te=Fe),$.baseState=te,$.firstBaseUpdate=ye,$.lastBaseUpdate=Ee,C===null&&($.shared.lanes=0),C_|=k,h.lanes=k,h.memoizedState=Fe}}function Pge(h,m){if(typeof h!="function")throw Error(r(191,h));h.call(m)}function Rge(h,m){var y=h.callbacks;if(y!==null)for(h.callbacks=null,h=0;h<y.length;h++)Pge(y[h],m)}var iC=G(null),Pz=G(0);function Ige(h,m){h=Sy,de(Pz,h),de(iC,m),Sy=h|m.baseLanes}function nZ(){de(Pz,Sy),de(iC,iC.current)}function aZ(){Sy=Pz.current,le(iC),le(Pz)}var th=G(null),hd=null;function x_(h){var m=h.alternate;de(la,la.current&1),de(th,h),hd===null&&(m===null||iC.current!==null||m.memoizedState!==null)&&(hd=h)}function oZ(h){de(la,la.current),de(th,h),hd===null&&(hd=h)}function Dge(h){h.tag===22?(de(la,la.current),de(th,h),hd===null&&(hd=h)):S_()}function S_(){de(la,la.current),de(th,th.current)}function ih(h){le(th),hd===h&&(hd=null),le(la)}var la=G(0);function Rz(h){for(var m=h;m!==null;){if(m.tag===13){var y=m.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||pY(y)||fY(y)))return m}else if(m.tag===19&&(m.memoizedProps.revealOrder==="forwards"||m.memoizedProps.revealOrder==="backwards"||m.memoizedProps.revealOrder==="unstable_legacy-backwards"||m.memoizedProps.revealOrder==="together")){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var my=0,Pi=null,ws=null,La=null,Iz=!1,rC=!1,nx=!1,Dz=0,dR=0,sC=null,eJe=0;function zn(){throw Error(r(321))}function lZ(h,m){if(m===null)return!1;for(var y=0;y<m.length&&y<h.length;y++)if(!Ku(h[y],m[y]))return!1;return!0}function cZ(h,m,y,w,$,C){return my=C,Pi=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Z.H=h===null||h.memoizedState===null?yye:TZ,nx=!1,C=y(w,$),nx=!1,rC&&(C=Lge(m,y,w,$)),kge(h),C}function kge(h){Z.H=mR;var m=ws!==null&&ws.next!==null;if(my=0,La=ws=Pi=null,Iz=!1,dR=0,sC=null,m)throw Error(r(300));h===null||Fa||(h=h.dependencies,h!==null&&Tz(h)&&(Fa=!0))}function Lge(h,m,y,w){Pi=h;var $=0;do{if(rC&&(sC=null),dR=0,rC=!1,25<=$)throw Error(r(301));if($+=1,La=ws=null,h.updateQueue!=null){var C=h.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}Z.H=vye,C=m(y,w)}while(rC);return C}function tJe(){var h=Z.H,m=h.useState()[0];return m=typeof m.then=="function"?pR(m):m,h=h.useState()[0],(ws!==null?ws.memoizedState:null)!==h&&(Pi.flags|=1024),m}function uZ(){var h=Dz!==0;return Dz=0,h}function hZ(h,m,y){m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~y}function dZ(h){if(Iz){for(h=h.memoizedState;h!==null;){var m=h.queue;m!==null&&(m.pending=null),h=h.next}Iz=!1}my=0,La=ws=Pi=null,rC=!1,dR=Dz=0,sC=null}function lc(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return La===null?Pi.memoizedState=La=h:La=La.next=h,La}function ca(){if(ws===null){var h=Pi.alternate;h=h!==null?h.memoizedState:null}else h=ws.next;var m=La===null?Pi.memoizedState:La.next;if(m!==null)La=m,ws=h;else{if(h===null)throw Pi.alternate===null?Error(r(467)):Error(r(310));ws=h,h={memoizedState:ws.memoizedState,baseState:ws.baseState,baseQueue:ws.baseQueue,queue:ws.queue,next:null},La===null?Pi.memoizedState=La=h:La=La.next=h}return La}function kz(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function pR(h){var m=dR;return dR+=1,sC===null&&(sC=[]),h=Cge(sC,h,m),m=Pi,(La===null?m.memoizedState:La.next)===null&&(m=m.alternate,Z.H=m===null||m.memoizedState===null?yye:TZ),h}function Lz(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return pR(h);if(h.$$typeof===E)return il(h)}throw Error(r(438,String(h)))}function pZ(h){var m=null,y=Pi.updateQueue;if(y!==null&&(m=y.memoCache),m==null){var w=Pi.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(m={data:w.data.map(function($){return $.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),y===null&&(y=kz(),Pi.updateQueue=y),y.memoCache=m,y=m.data[m.index],y===void 0)for(y=m.data[m.index]=Array(h),w=0;w<h;w++)y[w]=N;return m.index++,y}function gy(h,m){return typeof m=="function"?m(h):m}function Fz(h){var m=ca();return fZ(m,ws,h)}function fZ(h,m,y){var w=h.queue;if(w===null)throw Error(r(311));w.lastRenderedReducer=y;var $=h.baseQueue,C=w.pending;if(C!==null){if($!==null){var k=$.next;$.next=C.next,C.next=k}m.baseQueue=$=C,w.pending=null}if(C=h.baseState,$===null)h.memoizedState=C;else{m=$.next;var V=k=null,te=null,ye=m,Ee=!1;do{var Fe=ye.lane&-536870913;if(Fe!==ye.lane?(yr&Fe)===Fe:(my&Fe)===Fe){var ve=ye.revertLane;if(ve===0)te!==null&&(te=te.next={lane:0,revertLane:0,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null}),Fe===X$&&(Ee=!0);else if((my&ve)===ve){ye=ye.next,ve===X$&&(Ee=!0);continue}else Fe={lane:0,revertLane:ye.revertLane,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},te===null?(V=te=Fe,k=C):te=te.next=Fe,Pi.lanes|=ve,C_|=ve;Fe=ye.action,nx&&y(C,Fe),C=ye.hasEagerState?ye.eagerState:y(C,Fe)}else ve={lane:Fe,revertLane:ye.revertLane,gesture:ye.gesture,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},te===null?(V=te=ve,k=C):te=te.next=ve,Pi.lanes|=Fe,C_|=Fe;ye=ye.next}while(ye!==null&&ye!==m);if(te===null?k=C:te.next=V,!Ku(C,h.memoizedState)&&(Fa=!0,Ee&&(y=K$,y!==null)))throw y;h.memoizedState=C,h.baseState=k,h.baseQueue=te,w.lastRenderedState=C}return $===null&&(w.lanes=0),[h.memoizedState,w.dispatch]}function mZ(h){var m=ca(),y=m.queue;if(y===null)throw Error(r(311));y.lastRenderedReducer=h;var w=y.dispatch,$=y.pending,C=m.memoizedState;if($!==null){y.pending=null;var k=$=$.next;do C=h(C,k.action),k=k.next;while(k!==$);Ku(C,m.memoizedState)||(Fa=!0),m.memoizedState=C,m.baseQueue===null&&(m.baseState=C),y.lastRenderedState=C}return[C,w]}function Fge(h,m,y){var w=Pi,$=ca(),C=Cr;if(C){if(y===void 0)throw Error(r(407));y=y()}else y=m();var k=!Ku((ws||$).memoizedState,y);if(k&&($.memoizedState=y,Fa=!0),$=$.queue,vZ(Vge.bind(null,w,$,h),[h]),$.getSnapshot!==m||k||La!==null&&La.memoizedState.tag&1){if(w.flags|=2048,nC(9,{destroy:void 0},Nge.bind(null,w,$,y,m),null),Ls===null)throw Error(r(349));C||(my&127)!==0||zge(w,m,y)}return y}function zge(h,m,y){h.flags|=16384,h={getSnapshot:m,value:y},m=Pi.updateQueue,m===null?(m=kz(),Pi.updateQueue=m,m.stores=[h]):(y=m.stores,y===null?m.stores=[h]:y.push(h))}function Nge(h,m,y,w){m.value=y,m.getSnapshot=w,jge(m)&&Uge(h)}function Vge(h,m,y){return y(function(){jge(m)&&Uge(h)})}function jge(h){var m=h.getSnapshot;h=h.value;try{var y=m();return!Ku(h,y)}catch{return!0}}function Uge(h){var m=J1(h,2);m!==null&&su(m,h,2)}function gZ(h){var m=lc();if(typeof h=="function"){var y=h;if(h=y(),nx){Zt(!0);try{y()}finally{Zt(!1)}}}return m.memoizedState=m.baseState=h,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gy,lastRenderedState:h},m}function Bge(h,m,y,w){return h.baseState=y,fZ(h,ws,typeof w=="function"?w:gy)}function iJe(h,m,y,w,$){if(Vz(h))throw Error(r(485));if(h=m.action,h!==null){var C={payload:$,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){C.listeners.push(k)}};Z.T!==null?y(!0):C.isTransition=!1,w(C),y=m.pending,y===null?(C.next=m.pending=C,qge(m,C)):(C.next=y.next,m.pending=y.next=C)}}function qge(h,m){var y=m.action,w=m.payload,$=h.state;if(m.isTransition){var C=Z.T,k={};Z.T=k;try{var V=y($,w),te=Z.S;te!==null&&te(k,V),Gge(h,m,V)}catch(ye){yZ(h,m,ye)}finally{C!==null&&k.types!==null&&(C.types=k.types),Z.T=C}}else try{C=y($,w),Gge(h,m,C)}catch(ye){yZ(h,m,ye)}}function Gge(h,m,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(w){Hge(h,m,w)},function(w){return yZ(h,m,w)}):Hge(h,m,y)}function Hge(h,m,y){m.status="fulfilled",m.value=y,Wge(m),h.state=y,m=h.pending,m!==null&&(y=m.next,y===m?h.pending=null:(y=y.next,m.next=y,qge(h,y)))}function yZ(h,m,y){var w=h.pending;if(h.pending=null,w!==null){w=w.next;do m.status="rejected",m.reason=y,Wge(m),m=m.next;while(m!==w)}h.action=null}function Wge(h){h=h.listeners;for(var m=0;m<h.length;m++)(0,h[m])()}function Zge(h,m){return m}function Yge(h,m){if(Cr){var y=Ls.formState;if(y!==null){e:{var w=Pi;if(Cr){if(sn){t:{for(var $=sn,C=ud;$.nodeType!==8;){if(!C){$=null;break t}if($=dd($.nextSibling),$===null){$=null;break t}}C=$.data,$=C==="F!"||C==="F"?$:null}if($){sn=dd($.nextSibling),w=$.data==="F!";break e}}y_(w)}w=!1}w&&(m=y[0])}}return y=lc(),y.memoizedState=y.baseState=m,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zge,lastRenderedState:m},y.queue=w,y=fye.bind(null,Pi,w),w.dispatch=y,w=gZ(!1),C=SZ.bind(null,Pi,!1,w.queue),w=lc(),$={state:m,dispatch:null,action:h,pending:null},w.queue=$,y=iJe.bind(null,Pi,$,C,y),$.dispatch=y,w.memoizedState=h,[m,y,!1]}function Jge(h){var m=ca();return Qge(m,ws,h)}function Qge(h,m,y){if(m=fZ(h,m,Zge)[0],h=Fz(gy)[0],typeof m=="object"&&m!==null&&typeof m.then=="function")try{var w=pR(m)}catch(k){throw k===eC?Mz:k}else w=m;m=ca();var $=m.queue,C=$.dispatch;return y!==m.memoizedState&&(Pi.flags|=2048,nC(9,{destroy:void 0},rJe.bind(null,$,y),null)),[w,C,h]}function rJe(h,m){h.action=m}function Xge(h){var m=ca(),y=ws;if(y!==null)return Qge(m,y,h);ca(),m=m.memoizedState,y=ca();var w=y.queue.dispatch;return y.memoizedState=h,[m,w,!1]}function nC(h,m,y,w){return h={tag:h,create:y,deps:w,inst:m,next:null},m=Pi.updateQueue,m===null&&(m=kz(),Pi.updateQueue=m),y=m.lastEffect,y===null?m.lastEffect=h.next=h:(w=y.next,y.next=h,h.next=w,m.lastEffect=h),h}function Kge(){return ca().memoizedState}function zz(h,m,y,w){var $=lc();Pi.flags|=h,$.memoizedState=nC(1|m,{destroy:void 0},y,w===void 0?null:w)}function Nz(h,m,y,w){var $=ca();w=w===void 0?null:w;var C=$.memoizedState.inst;ws!==null&&w!==null&&lZ(w,ws.memoizedState.deps)?$.memoizedState=nC(m,C,y,w):(Pi.flags|=h,$.memoizedState=nC(1|m,C,y,w))}function eye(h,m){zz(8390656,8,h,m)}function vZ(h,m){Nz(2048,8,h,m)}function sJe(h){Pi.flags|=4;var m=Pi.updateQueue;if(m===null)m=kz(),Pi.updateQueue=m,m.events=[h];else{var y=m.events;y===null?m.events=[h]:y.push(h)}}function tye(h){var m=ca().memoizedState;return sJe({ref:m,nextImpl:h}),function(){if((Qr&2)!==0)throw Error(r(440));return m.impl.apply(void 0,arguments)}}function iye(h,m){return Nz(4,2,h,m)}function rye(h,m){return Nz(4,4,h,m)}function sye(h,m){if(typeof m=="function"){h=h();var y=m(h);return function(){typeof y=="function"?y():m(null)}}if(m!=null)return h=h(),m.current=h,function(){m.current=null}}function nye(h,m,y){y=y!=null?y.concat([h]):null,Nz(4,4,sye.bind(null,m,h),y)}function _Z(){}function aye(h,m){var y=ca();m=m===void 0?null:m;var w=y.memoizedState;return m!==null&&lZ(m,w[1])?w[0]:(y.memoizedState=[h,m],h)}function oye(h,m){var y=ca();m=m===void 0?null:m;var w=y.memoizedState;if(m!==null&&lZ(m,w[1]))return w[0];if(w=h(),nx){Zt(!0);try{h()}finally{Zt(!1)}}return y.memoizedState=[w,m],w}function bZ(h,m,y){return y===void 0||(my&1073741824)!==0&&(yr&261930)===0?h.memoizedState=m:(h.memoizedState=y,h=lve(),Pi.lanes|=h,C_|=h,y)}function lye(h,m,y,w){return Ku(y,m)?y:iC.current!==null?(h=bZ(h,y,w),Ku(h,m)||(Fa=!0),h):(my&42)===0||(my&1073741824)!==0&&(yr&261930)===0?(Fa=!0,h.memoizedState=y):(h=lve(),Pi.lanes|=h,C_|=h,m)}function cye(h,m,y,w,$){var C=K.p;K.p=C!==0&&8>C?C:8;var k=Z.T,V={};Z.T=V,SZ(h,!1,m,y);try{var te=$(),ye=Z.S;if(ye!==null&&ye(V,te),te!==null&&typeof te=="object"&&typeof te.then=="function"){var Ee=KYe(te,w);fR(h,m,Ee,nh(h))}else fR(h,m,w,nh(h))}catch(Fe){fR(h,m,{then:function(){},status:"rejected",reason:Fe},nh())}finally{K.p=C,k!==null&&V.types!==null&&(k.types=V.types),Z.T=k}}function nJe(){}function wZ(h,m,y,w){if(h.tag!==5)throw Error(r(476));var $=uye(h).queue;cye(h,$,m,ee,y===null?nJe:function(){return hye(h),y(w)})}function uye(h){var m=h.memoizedState;if(m!==null)return m;m={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gy,lastRenderedState:ee},next:null};var y={};return m.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gy,lastRenderedState:y},next:null},h.memoizedState=m,h=h.alternate,h!==null&&(h.memoizedState=m),m}function hye(h){var m=uye(h);m.next===null&&(m=h.alternate.memoizedState),fR(h,m.next.queue,{},nh())}function xZ(){return il(PR)}function dye(){return ca().memoizedState}function pye(){return ca().memoizedState}function aJe(h){for(var m=h.return;m!==null;){switch(m.tag){case 24:case 3:var y=nh();h=b_(y);var w=w_(m,h,y);w!==null&&(su(w,m,y),cR(w,m,y)),m={cache:QW()},h.payload=m;return}m=m.return}}function oJe(h,m,y){var w=nh();y={lane:w,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},Vz(h)?mye(m,y):(y=VW(h,m,y,w),y!==null&&(su(y,h,w),gye(y,m,w)))}function fye(h,m,y){var w=nh();fR(h,m,y,w)}function fR(h,m,y,w){var $={lane:w,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null};if(Vz(h))mye(m,$);else{var C=h.alternate;if(h.lanes===0&&(C===null||C.lanes===0)&&(C=m.lastRenderedReducer,C!==null))try{var k=m.lastRenderedState,V=C(k,y);if($.hasEagerState=!0,$.eagerState=V,Ku(V,k))return bz(h,m,$,0),Ls===null&&_z(),!1}catch{}if(y=VW(h,m,$,w),y!==null)return su(y,h,w),gye(y,m,w),!0}return!1}function SZ(h,m,y,w){if(w={lane:2,revertLane:tY(),gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},Vz(h)){if(m)throw Error(r(479))}else m=VW(h,y,w,2),m!==null&&su(m,h,2)}function Vz(h){var m=h.alternate;return h===Pi||m!==null&&m===Pi}function mye(h,m){rC=Iz=!0;var y=h.pending;y===null?m.next=m:(m.next=y.next,y.next=m),h.pending=m}function gye(h,m,y){if((y&4194048)!==0){var w=m.lanes;w&=h.pendingLanes,y|=w,m.lanes=y,Us(h,y)}}var mR={readContext:il,use:Lz,useCallback:zn,useContext:zn,useEffect:zn,useImperativeHandle:zn,useLayoutEffect:zn,useInsertionEffect:zn,useMemo:zn,useReducer:zn,useRef:zn,useState:zn,useDebugValue:zn,useDeferredValue:zn,useTransition:zn,useSyncExternalStore:zn,useId:zn,useHostTransitionStatus:zn,useFormState:zn,useActionState:zn,useOptimistic:zn,useMemoCache:zn,useCacheRefresh:zn};mR.useEffectEvent=zn;var yye={readContext:il,use:Lz,useCallback:function(h,m){return lc().memoizedState=[h,m===void 0?null:m],h},useContext:il,useEffect:eye,useImperativeHandle:function(h,m,y){y=y!=null?y.concat([h]):null,zz(4194308,4,sye.bind(null,m,h),y)},useLayoutEffect:function(h,m){return zz(4194308,4,h,m)},useInsertionEffect:function(h,m){zz(4,2,h,m)},useMemo:function(h,m){var y=lc();m=m===void 0?null:m;var w=h();if(nx){Zt(!0);try{h()}finally{Zt(!1)}}return y.memoizedState=[w,m],w},useReducer:function(h,m,y){var w=lc();if(y!==void 0){var $=y(m);if(nx){Zt(!0);try{y(m)}finally{Zt(!1)}}}else $=m;return w.memoizedState=w.baseState=$,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:$},w.queue=h,h=h.dispatch=oJe.bind(null,Pi,h),[w.memoizedState,h]},useRef:function(h){var m=lc();return h={current:h},m.memoizedState=h},useState:function(h){h=gZ(h);var m=h.queue,y=fye.bind(null,Pi,m);return m.dispatch=y,[h.memoizedState,y]},useDebugValue:_Z,useDeferredValue:function(h,m){var y=lc();return bZ(y,h,m)},useTransition:function(){var h=gZ(!1);return h=cye.bind(null,Pi,h.queue,!0,!1),lc().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,m,y){var w=Pi,$=lc();if(Cr){if(y===void 0)throw Error(r(407));y=y()}else{if(y=m(),Ls===null)throw Error(r(349));(yr&127)!==0||zge(w,m,y)}$.memoizedState=y;var C={value:y,getSnapshot:m};return $.queue=C,eye(Vge.bind(null,w,C,h),[h]),w.flags|=2048,nC(9,{destroy:void 0},Nge.bind(null,w,C,y,m),null),y},useId:function(){var h=lc(),m=Ls.identifierPrefix;if(Cr){var y=Mm,w=Cm;y=(w&~(1<<32-Jt(w)-1)).toString(32)+y,m="_"+m+"R_"+y,y=Dz++,0<y&&(m+="H"+y.toString(32)),m+="_"}else y=eJe++,m="_"+m+"r_"+y.toString(32)+"_";return h.memoizedState=m},useHostTransitionStatus:xZ,useFormState:Yge,useActionState:Yge,useOptimistic:function(h){var m=lc();m.memoizedState=m.baseState=h;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=y,m=SZ.bind(null,Pi,!0,y),y.dispatch=m,[h,m]},useMemoCache:pZ,useCacheRefresh:function(){return lc().memoizedState=aJe.bind(null,Pi)},useEffectEvent:function(h){var m=lc(),y={impl:h};return m.memoizedState=y,function(){if((Qr&2)!==0)throw Error(r(440));return y.impl.apply(void 0,arguments)}}},TZ={readContext:il,use:Lz,useCallback:aye,useContext:il,useEffect:vZ,useImperativeHandle:nye,useInsertionEffect:iye,useLayoutEffect:rye,useMemo:oye,useReducer:Fz,useRef:Kge,useState:function(){return Fz(gy)},useDebugValue:_Z,useDeferredValue:function(h,m){var y=ca();return lye(y,ws.memoizedState,h,m)},useTransition:function(){var h=Fz(gy)[0],m=ca().memoizedState;return[typeof h=="boolean"?h:pR(h),m]},useSyncExternalStore:Fge,useId:dye,useHostTransitionStatus:xZ,useFormState:Jge,useActionState:Jge,useOptimistic:function(h,m){var y=ca();return Bge(y,ws,h,m)},useMemoCache:pZ,useCacheRefresh:pye};TZ.useEffectEvent=tye;var vye={readContext:il,use:Lz,useCallback:aye,useContext:il,useEffect:vZ,useImperativeHandle:nye,useInsertionEffect:iye,useLayoutEffect:rye,useMemo:oye,useReducer:mZ,useRef:Kge,useState:function(){return mZ(gy)},useDebugValue:_Z,useDeferredValue:function(h,m){var y=ca();return ws===null?bZ(y,h,m):lye(y,ws.memoizedState,h,m)},useTransition:function(){var h=mZ(gy)[0],m=ca().memoizedState;return[typeof h=="boolean"?h:pR(h),m]},useSyncExternalStore:Fge,useId:dye,useHostTransitionStatus:xZ,useFormState:Xge,useActionState:Xge,useOptimistic:function(h,m){var y=ca();return ws!==null?Bge(y,ws,h,m):(y.baseState=h,[h,y.queue.dispatch])},useMemoCache:pZ,useCacheRefresh:pye};vye.useEffectEvent=tye;function $Z(h,m,y,w){m=h.memoizedState,y=y(w,m),y=y==null?m:f({},m,y),h.memoizedState=y,h.lanes===0&&(h.updateQueue.baseState=y)}var CZ={enqueueSetState:function(h,m,y){h=h._reactInternals;var w=nh(),$=b_(w);$.payload=m,y!=null&&($.callback=y),m=w_(h,$,w),m!==null&&(su(m,h,w),cR(m,h,w))},enqueueReplaceState:function(h,m,y){h=h._reactInternals;var w=nh(),$=b_(w);$.tag=1,$.payload=m,y!=null&&($.callback=y),m=w_(h,$,w),m!==null&&(su(m,h,w),cR(m,h,w))},enqueueForceUpdate:function(h,m){h=h._reactInternals;var y=nh(),w=b_(y);w.tag=2,m!=null&&(w.callback=m),m=w_(h,w,y),m!==null&&(su(m,h,y),cR(m,h,y))}};function _ye(h,m,y,w,$,C,k){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(w,C,k):m.prototype&&m.prototype.isPureReactComponent?!tR(y,w)||!tR($,C):!0}function bye(h,m,y,w){h=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(y,w),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(y,w),m.state!==h&&CZ.enqueueReplaceState(m,m.state,null)}function ax(h,m){var y=m;if("ref"in m){y={};for(var w in m)w!=="ref"&&(y[w]=m[w])}if(h=h.defaultProps){y===m&&(y=f({},y));for(var $ in h)y[$]===void 0&&(y[$]=h[$])}return y}function wye(h){vz(h)}function xye(h){console.error(h)}function Sye(h){vz(h)}function jz(h,m){try{var y=h.onUncaughtError;y(m.value,{componentStack:m.stack})}catch(w){setTimeout(function(){throw w})}}function Tye(h,m,y){try{var w=h.onCaughtError;w(y.value,{componentStack:y.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch($){setTimeout(function(){throw $})}}function MZ(h,m,y){return y=b_(y),y.tag=3,y.payload={element:null},y.callback=function(){jz(h,m)},y}function $ye(h){return h=b_(h),h.tag=3,h}function Cye(h,m,y,w){var $=y.type.getDerivedStateFromError;if(typeof $=="function"){var C=w.value;h.payload=function(){return $(C)},h.callback=function(){Tye(m,y,w)}}var k=y.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(h.callback=function(){Tye(m,y,w),typeof $!="function"&&(M_===null?M_=new Set([this]):M_.add(this));var V=w.stack;this.componentDidCatch(w.value,{componentStack:V!==null?V:""})})}function lJe(h,m,y,w,$){if(y.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(m=y.alternate,m!==null&&Q$(m,y,$,!0),y=th.current,y!==null){switch(y.tag){case 31:case 13:return hd===null?Kz():y.alternate===null&&Nn===0&&(Nn=3),y.flags&=-257,y.flags|=65536,y.lanes=$,w===Ez?y.flags|=16384:(m=y.updateQueue,m===null?y.updateQueue=new Set([w]):m.add(w),XZ(h,w,$)),!1;case 22:return y.flags|=65536,w===Ez?y.flags|=16384:(m=y.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([w])},y.updateQueue=m):(y=m.retryQueue,y===null?m.retryQueue=new Set([w]):y.add(w)),XZ(h,w,$)),!1}throw Error(r(435,y.tag))}return XZ(h,w,$),Kz(),!1}if(Cr)return m=th.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=$,w!==HW&&(h=Error(r(422),{cause:w}),sR(od(h,y)))):(w!==HW&&(m=Error(r(423),{cause:w}),sR(od(m,y))),h=h.current.alternate,h.flags|=65536,$&=-$,h.lanes|=$,w=od(w,y),$=MZ(h.stateNode,w,$),rZ(h,$),Nn!==4&&(Nn=2)),!1;var C=Error(r(520),{cause:w});if(C=od(C,y),SR===null?SR=[C]:SR.push(C),Nn!==4&&(Nn=2),m===null)return!0;w=od(w,y),y=m;do{switch(y.tag){case 3:return y.flags|=65536,h=$&-$,y.lanes|=h,h=MZ(y.stateNode,w,h),rZ(y,h),!1;case 1:if(m=y.type,C=y.stateNode,(y.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(M_===null||!M_.has(C))))return y.flags|=65536,$&=-$,y.lanes|=$,$=$ye($),Cye($,h,y,w),rZ(y,$),!1}y=y.return}while(y!==null);return!1}var EZ=Error(r(461)),Fa=!1;function rl(h,m,y,w){m.child=h===null?Oge(m,null,y,w):sx(m,h.child,y,w)}function Mye(h,m,y,w,$){y=y.render;var C=m.ref;if("ref"in w){var k={};for(var V in w)V!=="ref"&&(k[V]=w[V])}else k=w;return ex(m),w=cZ(h,m,y,k,C,$),V=uZ(),h!==null&&!Fa?(hZ(h,m,$),yy(h,m,$)):(Cr&&V&&qW(m),m.flags|=1,rl(h,m,w,$),m.child)}function Eye(h,m,y,w,$){if(h===null){var C=y.type;return typeof C=="function"&&!jW(C)&&C.defaultProps===void 0&&y.compare===null?(m.tag=15,m.type=C,Aye(h,m,C,w,$)):(h=xz(y.type,null,w,m,m.mode,$),h.ref=m.ref,h.return=m,m.child=h)}if(C=h.child,!LZ(h,$)){var k=C.memoizedProps;if(y=y.compare,y=y!==null?y:tR,y(k,w)&&h.ref===m.ref)return yy(h,m,$)}return m.flags|=1,h=hy(C,w),h.ref=m.ref,h.return=m,m.child=h}function Aye(h,m,y,w,$){if(h!==null){var C=h.memoizedProps;if(tR(C,w)&&h.ref===m.ref)if(Fa=!1,m.pendingProps=w=C,LZ(h,$))(h.flags&131072)!==0&&(Fa=!0);else return m.lanes=h.lanes,yy(h,m,$)}return AZ(h,m,y,w,$)}function Oye(h,m,y,w){var $=w.children,C=h!==null?h.memoizedState:null;if(h===null&&m.stateNode===null&&(m.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),w.mode==="hidden"){if((m.flags&128)!==0){if(C=C!==null?C.baseLanes|y:y,h!==null){for(w=m.child=h.child,$=0;w!==null;)$=$|w.lanes|w.childLanes,w=w.sibling;w=$&~C}else w=0,m.child=null;return Pye(h,m,C,y,w)}if((y&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},h!==null&&Cz(m,C!==null?C.cachePool:null),C!==null?Ige(m,C):nZ(),Dge(m);else return w=m.lanes=536870912,Pye(h,m,C!==null?C.baseLanes|y:y,y,w)}else C!==null?(Cz(m,C.cachePool),Ige(m,C),S_(),m.memoizedState=null):(h!==null&&Cz(m,null),nZ(),S_());return rl(h,m,$,y),m.child}function gR(h,m){return h!==null&&h.tag===22||m.stateNode!==null||(m.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.sibling}function Pye(h,m,y,w,$){var C=KW();return C=C===null?null:{parent:ka._currentValue,pool:C},m.memoizedState={baseLanes:y,cachePool:C},h!==null&&Cz(m,null),nZ(),Dge(m),h!==null&&Q$(h,m,w,!0),m.childLanes=$,null}function Uz(h,m){return m=qz({mode:m.mode,children:m.children},h.mode),m.ref=h.ref,h.child=m,m.return=h,m}function Rye(h,m,y){return sx(m,h.child,null,y),h=Uz(m,m.pendingProps),h.flags|=2,ih(m),m.memoizedState=null,h}function cJe(h,m,y){var w=m.pendingProps,$=(m.flags&128)!==0;if(m.flags&=-129,h===null){if(Cr){if(w.mode==="hidden")return h=Uz(m,w),m.lanes=536870912,gR(null,h);if(oZ(m),(h=sn)?(h=qve(h,ud),h=h!==null&&h.data==="&"?h:null,h!==null&&(m.memoizedState={dehydrated:h,treeContext:m_!==null?{id:Cm,overflow:Mm}:null,retryLane:536870912,hydrationErrors:null},y=mge(h),y.return=m,m.child=y,tl=m,sn=null)):h=null,h===null)throw y_(m);return m.lanes=536870912,null}return Uz(m,w)}var C=h.memoizedState;if(C!==null){var k=C.dehydrated;if(oZ(m),$)if(m.flags&256)m.flags&=-257,m=Rye(h,m,y);else if(m.memoizedState!==null)m.child=h.child,m.flags|=128,m=null;else throw Error(r(558));else if(Fa||Q$(h,m,y,!1),$=(y&h.childLanes)!==0,Fa||$){if(w=Ls,w!==null&&(k=it(w,y),k!==0&&k!==C.retryLane))throw C.retryLane=k,J1(h,k),su(w,h,k),EZ;Kz(),m=Rye(h,m,y)}else h=C.treeContext,sn=dd(k.nextSibling),tl=m,Cr=!0,g_=null,ud=!1,h!==null&&vge(m,h),m=Uz(m,w),m.flags|=4096;return m}return h=hy(h.child,{mode:w.mode,children:w.children}),h.ref=m.ref,m.child=h,h.return=m,h}function Bz(h,m){var y=m.ref;if(y===null)h!==null&&h.ref!==null&&(m.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(r(284));(h===null||h.ref!==y)&&(m.flags|=4194816)}}function AZ(h,m,y,w,$){return ex(m),y=cZ(h,m,y,w,void 0,$),w=uZ(),h!==null&&!Fa?(hZ(h,m,$),yy(h,m,$)):(Cr&&w&&qW(m),m.flags|=1,rl(h,m,y,$),m.child)}function Iye(h,m,y,w,$,C){return ex(m),m.updateQueue=null,y=Lge(m,w,y,$),kge(h),w=uZ(),h!==null&&!Fa?(hZ(h,m,C),yy(h,m,C)):(Cr&&w&&qW(m),m.flags|=1,rl(h,m,y,C),m.child)}function Dye(h,m,y,w,$){if(ex(m),m.stateNode===null){var C=W$,k=y.contextType;typeof k=="object"&&k!==null&&(C=il(k)),C=new y(w,C),m.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=CZ,m.stateNode=C,C._reactInternals=m,C=m.stateNode,C.props=w,C.state=m.memoizedState,C.refs={},tZ(m),k=y.contextType,C.context=typeof k=="object"&&k!==null?il(k):W$,C.state=m.memoizedState,k=y.getDerivedStateFromProps,typeof k=="function"&&($Z(m,y,k,w),C.state=m.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(k=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),k!==C.state&&CZ.enqueueReplaceState(C,C.state,null),hR(m,w,C,$),uR(),C.state=m.memoizedState),typeof C.componentDidMount=="function"&&(m.flags|=4194308),w=!0}else if(h===null){C=m.stateNode;var V=m.memoizedProps,te=ax(y,V);C.props=te;var ye=C.context,Ee=y.contextType;k=W$,typeof Ee=="object"&&Ee!==null&&(k=il(Ee));var Fe=y.getDerivedStateFromProps;Ee=typeof Fe=="function"||typeof C.getSnapshotBeforeUpdate=="function",V=m.pendingProps!==V,Ee||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(V||ye!==k)&&bye(m,C,w,k),__=!1;var ve=m.memoizedState;C.state=ve,hR(m,w,C,$),uR(),ye=m.memoizedState,V||ve!==ye||__?(typeof Fe=="function"&&($Z(m,y,Fe,w),ye=m.memoizedState),(te=__||_ye(m,y,te,w,ve,ye,k))?(Ee||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(m.flags|=4194308)):(typeof C.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=w,m.memoizedState=ye),C.props=w,C.state=ye,C.context=k,w=te):(typeof C.componentDidMount=="function"&&(m.flags|=4194308),w=!1)}else{C=m.stateNode,iZ(h,m),k=m.memoizedProps,Ee=ax(y,k),C.props=Ee,Fe=m.pendingProps,ve=C.context,ye=y.contextType,te=W$,typeof ye=="object"&&ye!==null&&(te=il(ye)),V=y.getDerivedStateFromProps,(ye=typeof V=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(k!==Fe||ve!==te)&&bye(m,C,w,te),__=!1,ve=m.memoizedState,C.state=ve,hR(m,w,C,$),uR();var Te=m.memoizedState;k!==Fe||ve!==Te||__||h!==null&&h.dependencies!==null&&Tz(h.dependencies)?(typeof V=="function"&&($Z(m,y,V,w),Te=m.memoizedState),(Ee=__||_ye(m,y,Ee,w,ve,Te,te)||h!==null&&h.dependencies!==null&&Tz(h.dependencies))?(ye||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(w,Te,te),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(w,Te,te)),typeof C.componentDidUpdate=="function"&&(m.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof C.componentDidUpdate!="function"||k===h.memoizedProps&&ve===h.memoizedState||(m.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||k===h.memoizedProps&&ve===h.memoizedState||(m.flags|=1024),m.memoizedProps=w,m.memoizedState=Te),C.props=w,C.state=Te,C.context=te,w=Ee):(typeof C.componentDidUpdate!="function"||k===h.memoizedProps&&ve===h.memoizedState||(m.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||k===h.memoizedProps&&ve===h.memoizedState||(m.flags|=1024),w=!1)}return C=w,Bz(h,m),w=(m.flags&128)!==0,C||w?(C=m.stateNode,y=w&&typeof y.getDerivedStateFromError!="function"?null:C.render(),m.flags|=1,h!==null&&w?(m.child=sx(m,h.child,null,$),m.child=sx(m,null,y,$)):rl(h,m,y,$),m.memoizedState=C.state,h=m.child):h=yy(h,m,$),h}function kye(h,m,y,w){return X1(),m.flags|=256,rl(h,m,y,w),m.child}var OZ={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function PZ(h){return{baseLanes:h,cachePool:Tge()}}function RZ(h,m,y){return h=h!==null?h.childLanes&~y:0,m&&(h|=sh),h}function Lye(h,m,y){var w=m.pendingProps,$=!1,C=(m.flags&128)!==0,k;if((k=C)||(k=h!==null&&h.memoizedState===null?!1:(la.current&2)!==0),k&&($=!0,m.flags&=-129),k=(m.flags&32)!==0,m.flags&=-33,h===null){if(Cr){if($?x_(m):S_(),(h=sn)?(h=qve(h,ud),h=h!==null&&h.data!=="&"?h:null,h!==null&&(m.memoizedState={dehydrated:h,treeContext:m_!==null?{id:Cm,overflow:Mm}:null,retryLane:536870912,hydrationErrors:null},y=mge(h),y.return=m,m.child=y,tl=m,sn=null)):h=null,h===null)throw y_(m);return fY(h)?m.lanes=32:m.lanes=536870912,null}var V=w.children;return w=w.fallback,$?(S_(),$=m.mode,V=qz({mode:"hidden",children:V},$),w=Q1(w,$,y,null),V.return=m,w.return=m,V.sibling=w,m.child=V,w=m.child,w.memoizedState=PZ(y),w.childLanes=RZ(h,k,y),m.memoizedState=OZ,gR(null,w)):(x_(m),IZ(m,V))}var te=h.memoizedState;if(te!==null&&(V=te.dehydrated,V!==null)){if(C)m.flags&256?(x_(m),m.flags&=-257,m=DZ(h,m,y)):m.memoizedState!==null?(S_(),m.child=h.child,m.flags|=128,m=null):(S_(),V=w.fallback,$=m.mode,w=qz({mode:"visible",children:w.children},$),V=Q1(V,$,y,null),V.flags|=2,w.return=m,V.return=m,w.sibling=V,m.child=w,sx(m,h.child,null,y),w=m.child,w.memoizedState=PZ(y),w.childLanes=RZ(h,k,y),m.memoizedState=OZ,m=gR(null,w));else if(x_(m),fY(V)){if(k=V.nextSibling&&V.nextSibling.dataset,k)var ye=k.dgst;k=ye,w=Error(r(419)),w.stack="",w.digest=k,sR({value:w,source:null,stack:null}),m=DZ(h,m,y)}else if(Fa||Q$(h,m,y,!1),k=(y&h.childLanes)!==0,Fa||k){if(k=Ls,k!==null&&(w=it(k,y),w!==0&&w!==te.retryLane))throw te.retryLane=w,J1(h,w),su(k,h,w),EZ;pY(V)||Kz(),m=DZ(h,m,y)}else pY(V)?(m.flags|=192,m.child=h.child,m=null):(h=te.treeContext,sn=dd(V.nextSibling),tl=m,Cr=!0,g_=null,ud=!1,h!==null&&vge(m,h),m=IZ(m,w.children),m.flags|=4096);return m}return $?(S_(),V=w.fallback,$=m.mode,te=h.child,ye=te.sibling,w=hy(te,{mode:"hidden",children:w.children}),w.subtreeFlags=te.subtreeFlags&65011712,ye!==null?V=hy(ye,V):(V=Q1(V,$,y,null),V.flags|=2),V.return=m,w.return=m,w.sibling=V,m.child=w,gR(null,w),w=m.child,V=h.child.memoizedState,V===null?V=PZ(y):($=V.cachePool,$!==null?(te=ka._currentValue,$=$.parent!==te?{parent:te,pool:te}:$):$=Tge(),V={baseLanes:V.baseLanes|y,cachePool:$}),w.memoizedState=V,w.childLanes=RZ(h,k,y),m.memoizedState=OZ,gR(h.child,w)):(x_(m),y=h.child,h=y.sibling,y=hy(y,{mode:"visible",children:w.children}),y.return=m,y.sibling=null,h!==null&&(k=m.deletions,k===null?(m.deletions=[h],m.flags|=16):k.push(h)),m.child=y,m.memoizedState=null,y)}function IZ(h,m){return m=qz({mode:"visible",children:m},h.mode),m.return=h,h.child=m}function qz(h,m){return h=eh(22,h,null,m),h.lanes=0,h}function DZ(h,m,y){return sx(m,h.child,null,y),h=IZ(m,m.pendingProps.children),h.flags|=2,m.memoizedState=null,h}function Fye(h,m,y){h.lanes|=m;var w=h.alternate;w!==null&&(w.lanes|=m),YW(h.return,m,y)}function kZ(h,m,y,w,$,C){var k=h.memoizedState;k===null?h.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:w,tail:y,tailMode:$,treeForkCount:C}:(k.isBackwards=m,k.rendering=null,k.renderingStartTime=0,k.last=w,k.tail=y,k.tailMode=$,k.treeForkCount=C)}function zye(h,m,y){var w=m.pendingProps,$=w.revealOrder,C=w.tail;w=w.children;var k=la.current,V=(k&2)!==0;if(V?(k=k&1|2,m.flags|=128):k&=1,de(la,k),rl(h,m,w,y),w=Cr?rR:0,!V&&h!==null&&(h.flags&128)!==0)e:for(h=m.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&Fye(h,y,m);else if(h.tag===19)Fye(h,y,m);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===m)break e;for(;h.sibling===null;){if(h.return===null||h.return===m)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}switch($){case"forwards":for(y=m.child,$=null;y!==null;)h=y.alternate,h!==null&&Rz(h)===null&&($=y),y=y.sibling;y=$,y===null?($=m.child,m.child=null):($=y.sibling,y.sibling=null),kZ(m,!1,$,y,C,w);break;case"backwards":case"unstable_legacy-backwards":for(y=null,$=m.child,m.child=null;$!==null;){if(h=$.alternate,h!==null&&Rz(h)===null){m.child=$;break}h=$.sibling,$.sibling=y,y=$,$=h}kZ(m,!0,y,null,C,w);break;case"together":kZ(m,!1,null,null,void 0,w);break;default:m.memoizedState=null}return m.child}function yy(h,m,y){if(h!==null&&(m.dependencies=h.dependencies),C_|=m.lanes,(y&m.childLanes)===0)if(h!==null){if(Q$(h,m,y,!1),(y&m.childLanes)===0)return null}else return null;if(h!==null&&m.child!==h.child)throw Error(r(153));if(m.child!==null){for(h=m.child,y=hy(h,h.pendingProps),m.child=y,y.return=m;h.sibling!==null;)h=h.sibling,y=y.sibling=hy(h,h.pendingProps),y.return=m;y.sibling=null}return m.child}function LZ(h,m){return(h.lanes&m)!==0?!0:(h=h.dependencies,!!(h!==null&&Tz(h)))}function uJe(h,m,y){switch(m.tag){case 3:Dt(m,m.stateNode.containerInfo),v_(m,ka,h.memoizedState.cache),X1();break;case 27:case 5:Bt(m);break;case 4:Dt(m,m.stateNode.containerInfo);break;case 10:v_(m,m.type,m.memoizedProps.value);break;case 31:if(m.memoizedState!==null)return m.flags|=128,oZ(m),null;break;case 13:var w=m.memoizedState;if(w!==null)return w.dehydrated!==null?(x_(m),m.flags|=128,null):(y&m.child.childLanes)!==0?Lye(h,m,y):(x_(m),h=yy(h,m,y),h!==null?h.sibling:null);x_(m);break;case 19:var $=(h.flags&128)!==0;if(w=(y&m.childLanes)!==0,w||(Q$(h,m,y,!1),w=(y&m.childLanes)!==0),$){if(w)return zye(h,m,y);m.flags|=128}if($=m.memoizedState,$!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),de(la,la.current),w)break;return null;case 22:return m.lanes=0,Oye(h,m,y,m.pendingProps);case 24:v_(m,ka,h.memoizedState.cache)}return yy(h,m,y)}function Nye(h,m,y){if(h!==null)if(h.memoizedProps!==m.pendingProps)Fa=!0;else{if(!LZ(h,y)&&(m.flags&128)===0)return Fa=!1,uJe(h,m,y);Fa=(h.flags&131072)!==0}else Fa=!1,Cr&&(m.flags&1048576)!==0&&yge(m,rR,m.index);switch(m.lanes=0,m.tag){case 16:e:{var w=m.pendingProps;if(h=ix(m.elementType),m.type=h,typeof h=="function")jW(h)?(w=ax(h,w),m.tag=1,m=Dye(null,m,h,w,y)):(m.tag=0,m=AZ(null,m,h,w,y));else{if(h!=null){var $=h.$$typeof;if($===P){m.tag=11,m=Mye(null,m,h,w,y);break e}else if($===L){m.tag=14,m=Eye(null,m,h,w,y);break e}}throw m=H(h)||h,Error(r(306,m,""))}}return m;case 0:return AZ(h,m,m.type,m.pendingProps,y);case 1:return w=m.type,$=ax(w,m.pendingProps),Dye(h,m,w,$,y);case 3:e:{if(Dt(m,m.stateNode.containerInfo),h===null)throw Error(r(387));w=m.pendingProps;var C=m.memoizedState;$=C.element,iZ(h,m),hR(m,w,null,y);var k=m.memoizedState;if(w=k.cache,v_(m,ka,w),w!==C.cache&&JW(m,[ka],y,!0),uR(),w=k.element,C.isDehydrated)if(C={element:w,isDehydrated:!1,cache:k.cache},m.updateQueue.baseState=C,m.memoizedState=C,m.flags&256){m=kye(h,m,w,y);break e}else if(w!==$){$=od(Error(r(424)),m),sR($),m=kye(h,m,w,y);break e}else for(h=m.stateNode.containerInfo,h.nodeType===9?h=h.body:h=h.nodeName==="HTML"?h.ownerDocument.body:h,sn=dd(h.firstChild),tl=m,Cr=!0,g_=null,ud=!0,y=Oge(m,null,w,y),m.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(X1(),w===$){m=yy(h,m,y);break e}rl(h,m,w,y)}m=m.child}return m;case 26:return Bz(h,m),h===null?(y=Jve(m.type,null,m.pendingProps,null))?m.memoizedState=y:Cr||(y=m.type,h=m.pendingProps,w=aN(Be.current).createElement(y),w[Oi]=m,w[ao]=h,sl(w,y,h),ss(w),m.stateNode=w):m.memoizedState=Jve(m.type,h.memoizedProps,m.pendingProps,h.memoizedState),null;case 27:return Bt(m),h===null&&Cr&&(w=m.stateNode=Wve(m.type,m.pendingProps,Be.current),tl=m,ud=!0,$=sn,P_(m.type)?(mY=$,sn=dd(w.firstChild)):sn=$),rl(h,m,m.pendingProps.children,y),Bz(h,m),h===null&&(m.flags|=4194304),m.child;case 5:return h===null&&Cr&&(($=w=sn)&&(w=VJe(w,m.type,m.pendingProps,ud),w!==null?(m.stateNode=w,tl=m,sn=dd(w.firstChild),ud=!1,$=!0):$=!1),$||y_(m)),Bt(m),$=m.type,C=m.pendingProps,k=h!==null?h.memoizedProps:null,w=C.children,uY($,C)?w=null:k!==null&&uY($,k)&&(m.flags|=32),m.memoizedState!==null&&($=cZ(h,m,tJe,null,null,y),PR._currentValue=$),Bz(h,m),rl(h,m,w,y),m.child;case 6:return h===null&&Cr&&((h=y=sn)&&(y=jJe(y,m.pendingProps,ud),y!==null?(m.stateNode=y,tl=m,sn=null,h=!0):h=!1),h||y_(m)),null;case 13:return Lye(h,m,y);case 4:return Dt(m,m.stateNode.containerInfo),w=m.pendingProps,h===null?m.child=sx(m,null,w,y):rl(h,m,w,y),m.child;case 11:return Mye(h,m,m.type,m.pendingProps,y);case 7:return rl(h,m,m.pendingProps,y),m.child;case 8:return rl(h,m,m.pendingProps.children,y),m.child;case 12:return rl(h,m,m.pendingProps.children,y),m.child;case 10:return w=m.pendingProps,v_(m,m.type,w.value),rl(h,m,w.children,y),m.child;case 9:return $=m.type._context,w=m.pendingProps.children,ex(m),$=il($),w=w($),m.flags|=1,rl(h,m,w,y),m.child;case 14:return Eye(h,m,m.type,m.pendingProps,y);case 15:return Aye(h,m,m.type,m.pendingProps,y);case 19:return zye(h,m,y);case 31:return cJe(h,m,y);case 22:return Oye(h,m,y,m.pendingProps);case 24:return ex(m),w=il(ka),h===null?($=KW(),$===null&&($=Ls,C=QW(),$.pooledCache=C,C.refCount++,C!==null&&($.pooledCacheLanes|=y),$=C),m.memoizedState={parent:w,cache:$},tZ(m),v_(m,ka,$)):((h.lanes&y)!==0&&(iZ(h,m),hR(m,null,null,y),uR()),$=h.memoizedState,C=m.memoizedState,$.parent!==w?($={parent:w,cache:w},m.memoizedState=$,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=$),v_(m,ka,w)):(w=C.cache,v_(m,ka,w),w!==$.cache&&JW(m,[ka],y,!0))),rl(h,m,m.pendingProps.children,y),m.child;case 29:throw m.pendingProps}throw Error(r(156,m.tag))}function vy(h){h.flags|=4}function FZ(h,m,y,w,$){if((m=(h.mode&32)!==0)&&(m=!1),m){if(h.flags|=16777216,($&335544128)===$)if(h.stateNode.complete)h.flags|=8192;else if(dve())h.flags|=8192;else throw rx=Ez,eZ}else h.flags&=-16777217}function Vye(h,m){if(m.type!=="stylesheet"||(m.state.loading&4)!==0)h.flags&=-16777217;else if(h.flags|=16777216,!t0e(m))if(dve())h.flags|=8192;else throw rx=Ez,eZ}function Gz(h,m){m!==null&&(h.flags|=4),h.flags&16384&&(m=h.tag!==22?pe():536870912,h.lanes|=m,cC|=m)}function yR(h,m){if(!Cr)switch(h.tailMode){case"hidden":m=h.tail;for(var y=null;m!==null;)m.alternate!==null&&(y=m),m=m.sibling;y===null?h.tail=null:y.sibling=null;break;case"collapsed":y=h.tail;for(var w=null;y!==null;)y.alternate!==null&&(w=y),y=y.sibling;w===null?m||h.tail===null?h.tail=null:h.tail.sibling=null:w.sibling=null}}function nn(h){var m=h.alternate!==null&&h.alternate.child===h.child,y=0,w=0;if(m)for(var $=h.child;$!==null;)y|=$.lanes|$.childLanes,w|=$.subtreeFlags&65011712,w|=$.flags&65011712,$.return=h,$=$.sibling;else for($=h.child;$!==null;)y|=$.lanes|$.childLanes,w|=$.subtreeFlags,w|=$.flags,$.return=h,$=$.sibling;return h.subtreeFlags|=w,h.childLanes=y,m}function hJe(h,m,y){var w=m.pendingProps;switch(GW(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nn(m),null;case 1:return nn(m),null;case 3:return y=m.stateNode,w=null,h!==null&&(w=h.memoizedState.cache),m.memoizedState.cache!==w&&(m.flags|=2048),fy(ka),at(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(h===null||h.child===null)&&(J$(m)?vy(m):h===null||h.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,WW())),nn(m),null;case 26:var $=m.type,C=m.memoizedState;return h===null?(vy(m),C!==null?(nn(m),Vye(m,C)):(nn(m),FZ(m,$,null,w,y))):C?C!==h.memoizedState?(vy(m),nn(m),Vye(m,C)):(nn(m),m.flags&=-16777217):(h=h.memoizedProps,h!==w&&vy(m),nn(m),FZ(m,$,h,w,y)),null;case 27:if(kt(m),y=Be.current,$=m.type,h!==null&&m.stateNode!=null)h.memoizedProps!==w&&vy(m);else{if(!w){if(m.stateNode===null)throw Error(r(166));return nn(m),null}h=Se.current,J$(m)?_ge(m):(h=Wve($,w,y),m.stateNode=h,vy(m))}return nn(m),null;case 5:if(kt(m),$=m.type,h!==null&&m.stateNode!=null)h.memoizedProps!==w&&vy(m);else{if(!w){if(m.stateNode===null)throw Error(r(166));return nn(m),null}if(C=Se.current,J$(m))_ge(m);else{var k=aN(Be.current);switch(C){case 1:C=k.createElementNS("http://www.w3.org/2000/svg",$);break;case 2:C=k.createElementNS("http://www.w3.org/1998/Math/MathML",$);break;default:switch($){case"svg":C=k.createElementNS("http://www.w3.org/2000/svg",$);break;case"math":C=k.createElementNS("http://www.w3.org/1998/Math/MathML",$);break;case"script":C=k.createElement("div"),C.innerHTML="<script><\/script>",C=C.removeChild(C.firstChild);break;case"select":C=typeof w.is=="string"?k.createElement("select",{is:w.is}):k.createElement("select"),w.multiple?C.multiple=!0:w.size&&(C.size=w.size);break;default:C=typeof w.is=="string"?k.createElement($,{is:w.is}):k.createElement($)}}C[Oi]=m,C[ao]=w;e:for(k=m.child;k!==null;){if(k.tag===5||k.tag===6)C.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===m)break e;for(;k.sibling===null;){if(k.return===null||k.return===m)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}m.stateNode=C;e:switch(sl(C,$,w),$){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}w&&vy(m)}}return nn(m),FZ(m,m.type,h===null?null:h.memoizedProps,m.pendingProps,y),null;case 6:if(h&&m.stateNode!=null)h.memoizedProps!==w&&vy(m);else{if(typeof w!="string"&&m.stateNode===null)throw Error(r(166));if(h=Be.current,J$(m)){if(h=m.stateNode,y=m.memoizedProps,w=null,$=tl,$!==null)switch($.tag){case 27:case 5:w=$.memoizedProps}h[Oi]=m,h=!!(h.nodeValue===y||w!==null&&w.suppressHydrationWarning===!0||Lve(h.nodeValue,y)),h||y_(m,!0)}else h=aN(h).createTextNode(w),h[Oi]=m,m.stateNode=h}return nn(m),null;case 31:if(y=m.memoizedState,h===null||h.memoizedState!==null){if(w=J$(m),y!==null){if(h===null){if(!w)throw Error(r(318));if(h=m.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(r(557));h[Oi]=m}else X1(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;nn(m),h=!1}else y=WW(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=y),h=!0;if(!h)return m.flags&256?(ih(m),m):(ih(m),null);if((m.flags&128)!==0)throw Error(r(558))}return nn(m),null;case 13:if(w=m.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if($=J$(m),w!==null&&w.dehydrated!==null){if(h===null){if(!$)throw Error(r(318));if($=m.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(r(317));$[Oi]=m}else X1(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;nn(m),$=!1}else $=WW(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=$),$=!0;if(!$)return m.flags&256?(ih(m),m):(ih(m),null)}return ih(m),(m.flags&128)!==0?(m.lanes=y,m):(y=w!==null,h=h!==null&&h.memoizedState!==null,y&&(w=m.child,$=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&($=w.alternate.memoizedState.cachePool.pool),C=null,w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(C=w.memoizedState.cachePool.pool),C!==$&&(w.flags|=2048)),y!==h&&y&&(m.child.flags|=8192),Gz(m,m.updateQueue),nn(m),null);case 4:return at(),h===null&&nY(m.stateNode.containerInfo),nn(m),null;case 10:return fy(m.type),nn(m),null;case 19:if(le(la),w=m.memoizedState,w===null)return nn(m),null;if($=(m.flags&128)!==0,C=w.rendering,C===null)if($)yR(w,!1);else{if(Nn!==0||h!==null&&(h.flags&128)!==0)for(h=m.child;h!==null;){if(C=Rz(h),C!==null){for(m.flags|=128,yR(w,!1),h=C.updateQueue,m.updateQueue=h,Gz(m,h),m.subtreeFlags=0,h=y,y=m.child;y!==null;)fge(y,h),y=y.sibling;return de(la,la.current&1|2),Cr&&dy(m,w.treeForkCount),m.child}h=h.sibling}w.tail!==null&&ht()>Jz&&(m.flags|=128,$=!0,yR(w,!1),m.lanes=4194304)}else{if(!$)if(h=Rz(C),h!==null){if(m.flags|=128,$=!0,h=h.updateQueue,m.updateQueue=h,Gz(m,h),yR(w,!0),w.tail===null&&w.tailMode==="hidden"&&!C.alternate&&!Cr)return nn(m),null}else 2*ht()-w.renderingStartTime>Jz&&y!==536870912&&(m.flags|=128,$=!0,yR(w,!1),m.lanes=4194304);w.isBackwards?(C.sibling=m.child,m.child=C):(h=w.last,h!==null?h.sibling=C:m.child=C,w.last=C)}return w.tail!==null?(h=w.tail,w.rendering=h,w.tail=h.sibling,w.renderingStartTime=ht(),h.sibling=null,y=la.current,de(la,$?y&1|2:y&1),Cr&&dy(m,w.treeForkCount),h):(nn(m),null);case 22:case 23:return ih(m),aZ(),w=m.memoizedState!==null,h!==null?h.memoizedState!==null!==w&&(m.flags|=8192):w&&(m.flags|=8192),w?(y&536870912)!==0&&(m.flags&128)===0&&(nn(m),m.subtreeFlags&6&&(m.flags|=8192)):nn(m),y=m.updateQueue,y!==null&&Gz(m,y.retryQueue),y=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),w=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(w=m.memoizedState.cachePool.pool),w!==y&&(m.flags|=2048),h!==null&&le(tx),null;case 24:return y=null,h!==null&&(y=h.memoizedState.cache),m.memoizedState.cache!==y&&(m.flags|=2048),fy(ka),nn(m),null;case 25:return null;case 30:return null}throw Error(r(156,m.tag))}function dJe(h,m){switch(GW(m),m.tag){case 1:return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 3:return fy(ka),at(),h=m.flags,(h&65536)!==0&&(h&128)===0?(m.flags=h&-65537|128,m):null;case 26:case 27:case 5:return kt(m),null;case 31:if(m.memoizedState!==null){if(ih(m),m.alternate===null)throw Error(r(340));X1()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 13:if(ih(m),h=m.memoizedState,h!==null&&h.dehydrated!==null){if(m.alternate===null)throw Error(r(340));X1()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 19:return le(la),null;case 4:return at(),null;case 10:return fy(m.type),null;case 22:case 23:return ih(m),aZ(),h!==null&&le(tx),h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 24:return fy(ka),null;case 25:return null;default:return null}}function jye(h,m){switch(GW(m),m.tag){case 3:fy(ka),at();break;case 26:case 27:case 5:kt(m);break;case 4:at();break;case 31:m.memoizedState!==null&&ih(m);break;case 13:ih(m);break;case 19:le(la);break;case 10:fy(m.type);break;case 22:case 23:ih(m),aZ(),h!==null&&le(tx);break;case 24:fy(ka)}}function vR(h,m){try{var y=m.updateQueue,w=y!==null?y.lastEffect:null;if(w!==null){var $=w.next;y=$;do{if((y.tag&h)===h){w=void 0;var C=y.create,k=y.inst;w=C(),k.destroy=w}y=y.next}while(y!==$)}}catch(V){us(m,m.return,V)}}function T_(h,m,y){try{var w=m.updateQueue,$=w!==null?w.lastEffect:null;if($!==null){var C=$.next;w=C;do{if((w.tag&h)===h){var k=w.inst,V=k.destroy;if(V!==void 0){k.destroy=void 0,$=m;var te=y,ye=V;try{ye()}catch(Ee){us($,te,Ee)}}}w=w.next}while(w!==C)}}catch(Ee){us(m,m.return,Ee)}}function Uye(h){var m=h.updateQueue;if(m!==null){var y=h.stateNode;try{Rge(m,y)}catch(w){us(h,h.return,w)}}}function Bye(h,m,y){y.props=ax(h.type,h.memoizedProps),y.state=h.memoizedState;try{y.componentWillUnmount()}catch(w){us(h,m,w)}}function _R(h,m){try{var y=h.ref;if(y!==null){switch(h.tag){case 26:case 27:case 5:var w=h.stateNode;break;case 30:w=h.stateNode;break;default:w=h.stateNode}typeof y=="function"?h.refCleanup=y(w):y.current=w}}catch($){us(h,m,$)}}function Em(h,m){var y=h.ref,w=h.refCleanup;if(y!==null)if(typeof w=="function")try{w()}catch($){us(h,m,$)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch($){us(h,m,$)}else y.current=null}function qye(h){var m=h.type,y=h.memoizedProps,w=h.stateNode;try{e:switch(m){case"button":case"input":case"select":case"textarea":y.autoFocus&&w.focus();break e;case"img":y.src?w.src=y.src:y.srcSet&&(w.srcset=y.srcSet)}}catch($){us(h,h.return,$)}}function zZ(h,m,y){try{var w=h.stateNode;DJe(w,h.type,y,m),w[ao]=m}catch($){us(h,h.return,$)}}function Gye(h){return h.tag===5||h.tag===3||h.tag===26||h.tag===27&&P_(h.type)||h.tag===4}function NZ(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||Gye(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.tag===27&&P_(h.type)||h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function VZ(h,m,y){var w=h.tag;if(w===5||w===6)h=h.stateNode,m?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(h,m):(m=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,m.appendChild(h),y=y._reactRootContainer,y!=null||m.onclick!==null||(m.onclick=cy));else if(w!==4&&(w===27&&P_(h.type)&&(y=h.stateNode,m=null),h=h.child,h!==null))for(VZ(h,m,y),h=h.sibling;h!==null;)VZ(h,m,y),h=h.sibling}function Hz(h,m,y){var w=h.tag;if(w===5||w===6)h=h.stateNode,m?y.insertBefore(h,m):y.appendChild(h);else if(w!==4&&(w===27&&P_(h.type)&&(y=h.stateNode),h=h.child,h!==null))for(Hz(h,m,y),h=h.sibling;h!==null;)Hz(h,m,y),h=h.sibling}function Hye(h){var m=h.stateNode,y=h.memoizedProps;try{for(var w=h.type,$=m.attributes;$.length;)m.removeAttributeNode($[0]);sl(m,w,y),m[Oi]=h,m[ao]=y}catch(C){us(h,h.return,C)}}var _y=!1,za=!1,jZ=!1,Wye=typeof WeakSet=="function"?WeakSet:Set,Po=null;function pJe(h,m){if(h=h.containerInfo,lY=pN,h=nge(h),DW(h)){if("selectionStart"in h)var y={start:h.selectionStart,end:h.selectionEnd};else e:{y=(y=h.ownerDocument)&&y.defaultView||window;var w=y.getSelection&&y.getSelection();if(w&&w.rangeCount!==0){y=w.anchorNode;var $=w.anchorOffset,C=w.focusNode;w=w.focusOffset;try{y.nodeType,C.nodeType}catch{y=null;break e}var k=0,V=-1,te=-1,ye=0,Ee=0,Fe=h,ve=null;t:for(;;){for(var Te;Fe!==y||$!==0&&Fe.nodeType!==3||(V=k+$),Fe!==C||w!==0&&Fe.nodeType!==3||(te=k+w),Fe.nodeType===3&&(k+=Fe.nodeValue.length),(Te=Fe.firstChild)!==null;)ve=Fe,Fe=Te;for(;;){if(Fe===h)break t;if(ve===y&&++ye===$&&(V=k),ve===C&&++Ee===w&&(te=k),(Te=Fe.nextSibling)!==null)break;Fe=ve,ve=Fe.parentNode}Fe=Te}y=V===-1||te===-1?null:{start:V,end:te}}else y=null}y=y||{start:0,end:0}}else y=null;for(cY={focusedElem:h,selectionRange:y},pN=!1,Po=m;Po!==null;)if(m=Po,h=m.child,(m.subtreeFlags&1028)!==0&&h!==null)h.return=m,Po=h;else for(;Po!==null;){switch(m=Po,C=m.alternate,h=m.flags,m.tag){case 0:if((h&4)!==0&&(h=m.updateQueue,h=h!==null?h.events:null,h!==null))for(y=0;y<h.length;y++)$=h[y],$.ref.impl=$.nextImpl;break;case 11:case 15:break;case 1:if((h&1024)!==0&&C!==null){h=void 0,y=m,$=C.memoizedProps,C=C.memoizedState,w=y.stateNode;try{var Pt=ax(y.type,$);h=w.getSnapshotBeforeUpdate(Pt,C),w.__reactInternalSnapshotBeforeUpdate=h}catch(si){us(y,y.return,si)}}break;case 3:if((h&1024)!==0){if(h=m.stateNode.containerInfo,y=h.nodeType,y===9)dY(h);else if(y===1)switch(h.nodeName){case"HEAD":case"HTML":case"BODY":dY(h);break;default:h.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((h&1024)!==0)throw Error(r(163))}if(h=m.sibling,h!==null){h.return=m.return,Po=h;break}Po=m.return}}function Zye(h,m,y){var w=y.flags;switch(y.tag){case 0:case 11:case 15:wy(h,y),w&4&&vR(5,y);break;case 1:if(wy(h,y),w&4)if(h=y.stateNode,m===null)try{h.componentDidMount()}catch(k){us(y,y.return,k)}else{var $=ax(y.type,m.memoizedProps);m=m.memoizedState;try{h.componentDidUpdate($,m,h.__reactInternalSnapshotBeforeUpdate)}catch(k){us(y,y.return,k)}}w&64&&Uye(y),w&512&&_R(y,y.return);break;case 3:if(wy(h,y),w&64&&(h=y.updateQueue,h!==null)){if(m=null,y.child!==null)switch(y.child.tag){case 27:case 5:m=y.child.stateNode;break;case 1:m=y.child.stateNode}try{Rge(h,m)}catch(k){us(y,y.return,k)}}break;case 27:m===null&&w&4&&Hye(y);case 26:case 5:wy(h,y),m===null&&w&4&&qye(y),w&512&&_R(y,y.return);break;case 12:wy(h,y);break;case 31:wy(h,y),w&4&&Qye(h,y);break;case 13:wy(h,y),w&4&&Xye(h,y),w&64&&(h=y.memoizedState,h!==null&&(h=h.dehydrated,h!==null&&(y=xJe.bind(null,y),UJe(h,y))));break;case 22:if(w=y.memoizedState!==null||_y,!w){m=m!==null&&m.memoizedState!==null||za,$=_y;var C=za;_y=w,(za=m)&&!C?xy(h,y,(y.subtreeFlags&8772)!==0):wy(h,y),_y=$,za=C}break;case 30:break;default:wy(h,y)}}function Yye(h){var m=h.alternate;m!==null&&(h.alternate=null,Yye(m)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(m=h.stateNode,m!==null&&Xc(m)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}var xn=null,eu=!1;function by(h,m,y){for(y=y.child;y!==null;)Jye(h,m,y),y=y.sibling}function Jye(h,m,y){if(Ot&&typeof Ot.onCommitFiberUnmount=="function")try{Ot.onCommitFiberUnmount(ui,y)}catch{}switch(y.tag){case 26:za||Em(y,m),by(h,m,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:za||Em(y,m);var w=xn,$=eu;P_(y.type)&&(xn=y.stateNode,eu=!1),by(h,m,y),ER(y.stateNode),xn=w,eu=$;break;case 5:za||Em(y,m);case 6:if(w=xn,$=eu,xn=null,by(h,m,y),xn=w,eu=$,xn!==null)if(eu)try{(xn.nodeType===9?xn.body:xn.nodeName==="HTML"?xn.ownerDocument.body:xn).removeChild(y.stateNode)}catch(C){us(y,m,C)}else try{xn.removeChild(y.stateNode)}catch(C){us(y,m,C)}break;case 18:xn!==null&&(eu?(h=xn,Uve(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,y.stateNode),yC(h)):Uve(xn,y.stateNode));break;case 4:w=xn,$=eu,xn=y.stateNode.containerInfo,eu=!0,by(h,m,y),xn=w,eu=$;break;case 0:case 11:case 14:case 15:T_(2,y,m),za||T_(4,y,m),by(h,m,y);break;case 1:za||(Em(y,m),w=y.stateNode,typeof w.componentWillUnmount=="function"&&Bye(y,m,w)),by(h,m,y);break;case 21:by(h,m,y);break;case 22:za=(w=za)||y.memoizedState!==null,by(h,m,y),za=w;break;default:by(h,m,y)}}function Qye(h,m){if(m.memoizedState===null&&(h=m.alternate,h!==null&&(h=h.memoizedState,h!==null))){h=h.dehydrated;try{yC(h)}catch(y){us(m,m.return,y)}}}function Xye(h,m){if(m.memoizedState===null&&(h=m.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{yC(h)}catch(y){us(m,m.return,y)}}function fJe(h){switch(h.tag){case 31:case 13:case 19:var m=h.stateNode;return m===null&&(m=h.stateNode=new Wye),m;case 22:return h=h.stateNode,m=h._retryCache,m===null&&(m=h._retryCache=new Wye),m;default:throw Error(r(435,h.tag))}}function Wz(h,m){var y=fJe(h);m.forEach(function(w){if(!y.has(w)){y.add(w);var $=SJe.bind(null,h,w);w.then($,$)}})}function tu(h,m){var y=m.deletions;if(y!==null)for(var w=0;w<y.length;w++){var $=y[w],C=h,k=m,V=k;e:for(;V!==null;){switch(V.tag){case 27:if(P_(V.type)){xn=V.stateNode,eu=!1;break e}break;case 5:xn=V.stateNode,eu=!1;break e;case 3:case 4:xn=V.stateNode.containerInfo,eu=!0;break e}V=V.return}if(xn===null)throw Error(r(160));Jye(C,k,$),xn=null,eu=!1,C=$.alternate,C!==null&&(C.return=null),$.return=null}if(m.subtreeFlags&13886)for(m=m.child;m!==null;)Kye(m,h),m=m.sibling}var Vp=null;function Kye(h,m){var y=h.alternate,w=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:tu(m,h),iu(h),w&4&&(T_(3,h,h.return),vR(3,h),T_(5,h,h.return));break;case 1:tu(m,h),iu(h),w&512&&(za||y===null||Em(y,y.return)),w&64&&_y&&(h=h.updateQueue,h!==null&&(w=h.callbacks,w!==null&&(y=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=y===null?w:y.concat(w))));break;case 26:var $=Vp;if(tu(m,h),iu(h),w&512&&(za||y===null||Em(y,y.return)),w&4){var C=y!==null?y.memoizedState:null;if(w=h.memoizedState,y===null)if(w===null)if(h.stateNode===null){e:{w=h.type,y=h.memoizedProps,$=$.ownerDocument||$;t:switch(w){case"title":C=$.getElementsByTagName("title")[0],(!C||C[wm]||C[Oi]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=$.createElement(w),$.head.insertBefore(C,$.querySelector("head > title"))),sl(C,w,y),C[Oi]=h,ss(C),w=C;break e;case"link":var k=Kve("link","href",$).get(w+(y.href||""));if(k){for(var V=0;V<k.length;V++)if(C=k[V],C.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&C.getAttribute("rel")===(y.rel==null?null:y.rel)&&C.getAttribute("title")===(y.title==null?null:y.title)&&C.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){k.splice(V,1);break t}}C=$.createElement(w),sl(C,w,y),$.head.appendChild(C);break;case"meta":if(k=Kve("meta","content",$).get(w+(y.content||""))){for(V=0;V<k.length;V++)if(C=k[V],C.getAttribute("content")===(y.content==null?null:""+y.content)&&C.getAttribute("name")===(y.name==null?null:y.name)&&C.getAttribute("property")===(y.property==null?null:y.property)&&C.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&C.getAttribute("charset")===(y.charSet==null?null:y.charSet)){k.splice(V,1);break t}}C=$.createElement(w),sl(C,w,y),$.head.appendChild(C);break;default:throw Error(r(468,w))}C[Oi]=h,ss(C),w=C}h.stateNode=w}else e0e($,h.type,h.stateNode);else h.stateNode=Xve($,w,h.memoizedProps);else C!==w?(C===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):C.count--,w===null?e0e($,h.type,h.stateNode):Xve($,w,h.memoizedProps)):w===null&&h.stateNode!==null&&zZ(h,h.memoizedProps,y.memoizedProps)}break;case 27:tu(m,h),iu(h),w&512&&(za||y===null||Em(y,y.return)),y!==null&&w&4&&zZ(h,h.memoizedProps,y.memoizedProps);break;case 5:if(tu(m,h),iu(h),w&512&&(za||y===null||Em(y,y.return)),h.flags&32){$=h.stateNode;try{V$($,"")}catch(Pt){us(h,h.return,Pt)}}w&4&&h.stateNode!=null&&($=h.memoizedProps,zZ(h,$,y!==null?y.memoizedProps:$)),w&1024&&(jZ=!0);break;case 6:if(tu(m,h),iu(h),w&4){if(h.stateNode===null)throw Error(r(162));w=h.memoizedProps,y=h.stateNode;try{y.nodeValue=w}catch(Pt){us(h,h.return,Pt)}}break;case 3:if(cN=null,$=Vp,Vp=oN(m.containerInfo),tu(m,h),Vp=$,iu(h),w&4&&y!==null&&y.memoizedState.isDehydrated)try{yC(m.containerInfo)}catch(Pt){us(h,h.return,Pt)}jZ&&(jZ=!1,eve(h));break;case 4:w=Vp,Vp=oN(h.stateNode.containerInfo),tu(m,h),iu(h),Vp=w;break;case 12:tu(m,h),iu(h);break;case 31:tu(m,h),iu(h),w&4&&(w=h.updateQueue,w!==null&&(h.updateQueue=null,Wz(h,w)));break;case 13:tu(m,h),iu(h),h.child.flags&8192&&h.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(Yz=ht()),w&4&&(w=h.updateQueue,w!==null&&(h.updateQueue=null,Wz(h,w)));break;case 22:$=h.memoizedState!==null;var te=y!==null&&y.memoizedState!==null,ye=_y,Ee=za;if(_y=ye||$,za=Ee||te,tu(m,h),za=Ee,_y=ye,iu(h),w&8192)e:for(m=h.stateNode,m._visibility=$?m._visibility&-2:m._visibility|1,$&&(y===null||te||_y||za||ox(h)),y=null,m=h;;){if(m.tag===5||m.tag===26){if(y===null){te=y=m;try{if(C=te.stateNode,$)k=C.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{V=te.stateNode;var Fe=te.memoizedProps.style,ve=Fe!=null&&Fe.hasOwnProperty("display")?Fe.display:null;V.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(Pt){us(te,te.return,Pt)}}}else if(m.tag===6){if(y===null){te=m;try{te.stateNode.nodeValue=$?"":te.memoizedProps}catch(Pt){us(te,te.return,Pt)}}}else if(m.tag===18){if(y===null){te=m;try{var Te=te.stateNode;$?Bve(Te,!0):Bve(te.stateNode,!1)}catch(Pt){us(te,te.return,Pt)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===h)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break e;for(;m.sibling===null;){if(m.return===null||m.return===h)break e;y===m&&(y=null),m=m.return}y===m&&(y=null),m.sibling.return=m.return,m=m.sibling}w&4&&(w=h.updateQueue,w!==null&&(y=w.retryQueue,y!==null&&(w.retryQueue=null,Wz(h,y))));break;case 19:tu(m,h),iu(h),w&4&&(w=h.updateQueue,w!==null&&(h.updateQueue=null,Wz(h,w)));break;case 30:break;case 21:break;default:tu(m,h),iu(h)}}function iu(h){var m=h.flags;if(m&2){try{for(var y,w=h.return;w!==null;){if(Gye(w)){y=w;break}w=w.return}if(y==null)throw Error(r(160));switch(y.tag){case 27:var $=y.stateNode,C=NZ(h);Hz(h,C,$);break;case 5:var k=y.stateNode;y.flags&32&&(V$(k,""),y.flags&=-33);var V=NZ(h);Hz(h,V,k);break;case 3:case 4:var te=y.stateNode.containerInfo,ye=NZ(h);VZ(h,ye,te);break;default:throw Error(r(161))}}catch(Ee){us(h,h.return,Ee)}h.flags&=-3}m&4096&&(h.flags&=-4097)}function eve(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var m=h;eve(m),m.tag===5&&m.flags&1024&&m.stateNode.reset(),h=h.sibling}}function wy(h,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)Zye(h,m.alternate,m),m=m.sibling}function ox(h){for(h=h.child;h!==null;){var m=h;switch(m.tag){case 0:case 11:case 14:case 15:T_(4,m,m.return),ox(m);break;case 1:Em(m,m.return);var y=m.stateNode;typeof y.componentWillUnmount=="function"&&Bye(m,m.return,y),ox(m);break;case 27:ER(m.stateNode);case 26:case 5:Em(m,m.return),ox(m);break;case 22:m.memoizedState===null&&ox(m);break;case 30:ox(m);break;default:ox(m)}h=h.sibling}}function xy(h,m,y){for(y=y&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var w=m.alternate,$=h,C=m,k=C.flags;switch(C.tag){case 0:case 11:case 15:xy($,C,y),vR(4,C);break;case 1:if(xy($,C,y),w=C,$=w.stateNode,typeof $.componentDidMount=="function")try{$.componentDidMount()}catch(ye){us(w,w.return,ye)}if(w=C,$=w.updateQueue,$!==null){var V=w.stateNode;try{var te=$.shared.hiddenCallbacks;if(te!==null)for($.shared.hiddenCallbacks=null,$=0;$<te.length;$++)Pge(te[$],V)}catch(ye){us(w,w.return,ye)}}y&&k&64&&Uye(C),_R(C,C.return);break;case 27:Hye(C);case 26:case 5:xy($,C,y),y&&w===null&&k&4&&qye(C),_R(C,C.return);break;case 12:xy($,C,y);break;case 31:xy($,C,y),y&&k&4&&Qye($,C);break;case 13:xy($,C,y),y&&k&4&&Xye($,C);break;case 22:C.memoizedState===null&&xy($,C,y),_R(C,C.return);break;case 30:break;default:xy($,C,y)}m=m.sibling}}function UZ(h,m){var y=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),h=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(h=m.memoizedState.cachePool.pool),h!==y&&(h!=null&&h.refCount++,y!=null&&nR(y))}function BZ(h,m){h=null,m.alternate!==null&&(h=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==h&&(m.refCount++,h!=null&&nR(h))}function jp(h,m,y,w){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)tve(h,m,y,w),m=m.sibling}function tve(h,m,y,w){var $=m.flags;switch(m.tag){case 0:case 11:case 15:jp(h,m,y,w),$&2048&&vR(9,m);break;case 1:jp(h,m,y,w);break;case 3:jp(h,m,y,w),$&2048&&(h=null,m.alternate!==null&&(h=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==h&&(m.refCount++,h!=null&&nR(h)));break;case 12:if($&2048){jp(h,m,y,w),h=m.stateNode;try{var C=m.memoizedProps,k=C.id,V=C.onPostCommit;typeof V=="function"&&V(k,m.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(te){us(m,m.return,te)}}else jp(h,m,y,w);break;case 31:jp(h,m,y,w);break;case 13:jp(h,m,y,w);break;case 23:break;case 22:C=m.stateNode,k=m.alternate,m.memoizedState!==null?C._visibility&2?jp(h,m,y,w):bR(h,m):C._visibility&2?jp(h,m,y,w):(C._visibility|=2,aC(h,m,y,w,(m.subtreeFlags&10256)!==0||!1)),$&2048&&UZ(k,m);break;case 24:jp(h,m,y,w),$&2048&&BZ(m.alternate,m);break;default:jp(h,m,y,w)}}function aC(h,m,y,w,$){for($=$&&((m.subtreeFlags&10256)!==0||!1),m=m.child;m!==null;){var C=h,k=m,V=y,te=w,ye=k.flags;switch(k.tag){case 0:case 11:case 15:aC(C,k,V,te,$),vR(8,k);break;case 23:break;case 22:var Ee=k.stateNode;k.memoizedState!==null?Ee._visibility&2?aC(C,k,V,te,$):bR(C,k):(Ee._visibility|=2,aC(C,k,V,te,$)),$&&ye&2048&&UZ(k.alternate,k);break;case 24:aC(C,k,V,te,$),$&&ye&2048&&BZ(k.alternate,k);break;default:aC(C,k,V,te,$)}m=m.sibling}}function bR(h,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var y=h,w=m,$=w.flags;switch(w.tag){case 22:bR(y,w),$&2048&&UZ(w.alternate,w);break;case 24:bR(y,w),$&2048&&BZ(w.alternate,w);break;default:bR(y,w)}m=m.sibling}}var wR=8192;function oC(h,m,y){if(h.subtreeFlags&wR)for(h=h.child;h!==null;)ive(h,m,y),h=h.sibling}function ive(h,m,y){switch(h.tag){case 26:oC(h,m,y),h.flags&wR&&h.memoizedState!==null&&eQe(y,Vp,h.memoizedState,h.memoizedProps);break;case 5:oC(h,m,y);break;case 3:case 4:var w=Vp;Vp=oN(h.stateNode.containerInfo),oC(h,m,y),Vp=w;break;case 22:h.memoizedState===null&&(w=h.alternate,w!==null&&w.memoizedState!==null?(w=wR,wR=16777216,oC(h,m,y),wR=w):oC(h,m,y));break;default:oC(h,m,y)}}function rve(h){var m=h.alternate;if(m!==null&&(h=m.child,h!==null)){m.child=null;do m=h.sibling,h.sibling=null,h=m;while(h!==null)}}function xR(h){var m=h.deletions;if((h.flags&16)!==0){if(m!==null)for(var y=0;y<m.length;y++){var w=m[y];Po=w,nve(w,h)}rve(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)sve(h),h=h.sibling}function sve(h){switch(h.tag){case 0:case 11:case 15:xR(h),h.flags&2048&&T_(9,h,h.return);break;case 3:xR(h);break;case 12:xR(h);break;case 22:var m=h.stateNode;h.memoizedState!==null&&m._visibility&2&&(h.return===null||h.return.tag!==13)?(m._visibility&=-3,Zz(h)):xR(h);break;default:xR(h)}}function Zz(h){var m=h.deletions;if((h.flags&16)!==0){if(m!==null)for(var y=0;y<m.length;y++){var w=m[y];Po=w,nve(w,h)}rve(h)}for(h=h.child;h!==null;){switch(m=h,m.tag){case 0:case 11:case 15:T_(8,m,m.return),Zz(m);break;case 22:y=m.stateNode,y._visibility&2&&(y._visibility&=-3,Zz(m));break;default:Zz(m)}h=h.sibling}}function nve(h,m){for(;Po!==null;){var y=Po;switch(y.tag){case 0:case 11:case 15:T_(8,y,m);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var w=y.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:nR(y.memoizedState.cache)}if(w=y.child,w!==null)w.return=y,Po=w;else e:for(y=h;Po!==null;){w=Po;var $=w.sibling,C=w.return;if(Yye(w),w===y){Po=null;break e}if($!==null){$.return=C,Po=$;break e}Po=C}}}var mJe={getCacheForType:function(h){var m=il(ka),y=m.data.get(h);return y===void 0&&(y=h(),m.data.set(h,y)),y},cacheSignal:function(){return il(ka).controller.signal}},gJe=typeof WeakMap=="function"?WeakMap:Map,Qr=0,Ls=null,ur=null,yr=0,cs=0,rh=null,$_=!1,lC=!1,qZ=!1,Sy=0,Nn=0,C_=0,lx=0,GZ=0,sh=0,cC=0,SR=null,ru=null,HZ=!1,Yz=0,ave=0,Jz=1/0,Qz=null,M_=null,lo=0,E_=null,uC=null,Ty=0,WZ=0,ZZ=null,ove=null,TR=0,YZ=null;function nh(){return(Qr&2)!==0&&yr!==0?yr&-yr:Z.T!==null?tY():gr()}function lve(){if(sh===0)if((yr&536870912)===0||Cr){var h=Vr;Vr<<=1,(Vr&3932160)===0&&(Vr=262144),sh=h}else sh=536870912;return h=th.current,h!==null&&(h.flags|=32),sh}function su(h,m,y){(h===Ls&&(cs===2||cs===9)||h.cancelPendingCommit!==null)&&(hC(h,0),A_(h,yr,sh,!1)),ai(h,y),((Qr&2)===0||h!==Ls)&&(h===Ls&&((Qr&2)===0&&(lx|=y),Nn===4&&A_(h,yr,sh,!1)),Am(h))}function cve(h,m,y){if((Qr&6)!==0)throw Error(r(327));var w=!y&&(m&127)===0&&(m&h.expiredLanes)===0||En(h,m),$=w?_Je(h,m):QZ(h,m,!0),C=w;do{if($===0){lC&&!w&&A_(h,m,0,!1);break}else{if(y=h.current.alternate,C&&!yJe(y)){$=QZ(h,m,!1),C=!1;continue}if($===2){if(C=m,h.errorRecoveryDisabledLanes&C)var k=0;else k=h.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){m=k;e:{var V=h;$=SR;var te=V.current.memoizedState.isDehydrated;if(te&&(hC(V,k).flags|=256),k=QZ(V,k,!1),k!==2){if(qZ&&!te){V.errorRecoveryDisabledLanes|=C,lx|=C,$=4;break e}C=ru,ru=$,C!==null&&(ru===null?ru=C:ru.push.apply(ru,C))}$=k}if(C=!1,$!==2)continue}}if($===1){hC(h,0),A_(h,m,0,!0);break}e:{switch(w=h,C=$,C){case 0:case 1:throw Error(r(345));case 4:if((m&4194048)!==m)break;case 6:A_(w,m,sh,!$_);break e;case 2:ru=null;break;case 3:case 5:break;default:throw Error(r(329))}if((m&62914560)===m&&($=Yz+300-ht(),10<$)){if(A_(w,m,sh,!$_),Ra(w,0,!0)!==0)break e;Ty=m,w.timeoutHandle=Vve(uve.bind(null,w,y,ru,Qz,HZ,m,sh,lx,cC,$_,C,"Throttled",-0,0),$);break e}uve(w,y,ru,Qz,HZ,m,sh,lx,cC,$_,C,null,-0,0)}}break}while(!0);Am(h)}function uve(h,m,y,w,$,C,k,V,te,ye,Ee,Fe,ve,Te){if(h.timeoutHandle=-1,Fe=m.subtreeFlags,Fe&8192||(Fe&16785408)===16785408){Fe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:cy},ive(m,C,Fe);var Pt=(C&62914560)===C?Yz-ht():(C&4194048)===C?ave-ht():0;if(Pt=tQe(Fe,Pt),Pt!==null){Ty=C,h.cancelPendingCommit=Pt(vve.bind(null,h,m,C,y,w,$,k,V,te,Ee,Fe,null,ve,Te)),A_(h,C,k,!ye);return}}vve(h,m,C,y,w,$,k,V,te)}function yJe(h){for(var m=h;;){var y=m.tag;if((y===0||y===11||y===15)&&m.flags&16384&&(y=m.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var w=0;w<y.length;w++){var $=y[w],C=$.getSnapshot;$=$.value;try{if(!Ku(C(),$))return!1}catch{return!1}}if(y=m.child,m.subtreeFlags&16384&&y!==null)y.return=m,m=y;else{if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function A_(h,m,y,w){m&=~GZ,m&=~lx,h.suspendedLanes|=m,h.pingedLanes&=~m,w&&(h.warmLanes|=m),w=h.expirationTimes;for(var $=m;0<$;){var C=31-Jt($),k=1<<C;w[C]=-1,$&=~k}y!==0&&lr(h,y,m)}function Xz(){return(Qr&6)===0?($R(0),!1):!0}function JZ(){if(ur!==null){if(cs===0)var h=ur.return;else h=ur,py=K1=null,dZ(h),tC=null,oR=0,h=ur;for(;h!==null;)jye(h.alternate,h),h=h.return;ur=null}}function hC(h,m){var y=h.timeoutHandle;y!==-1&&(h.timeoutHandle=-1,FJe(y)),y=h.cancelPendingCommit,y!==null&&(h.cancelPendingCommit=null,y()),Ty=0,JZ(),Ls=h,ur=y=hy(h.current,null),yr=m,cs=0,rh=null,$_=!1,lC=En(h,m),qZ=!1,cC=sh=GZ=lx=C_=Nn=0,ru=SR=null,HZ=!1,(m&8)!==0&&(m|=m&32);var w=h.entangledLanes;if(w!==0)for(h=h.entanglements,w&=m;0<w;){var $=31-Jt(w),C=1<<$;m|=h[$],w&=~C}return Sy=m,_z(),y}function hve(h,m){Pi=null,Z.H=mR,m===eC||m===Mz?(m=Mge(),cs=3):m===eZ?(m=Mge(),cs=4):cs=m===EZ?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,rh=m,ur===null&&(Nn=1,jz(h,od(m,h.current)))}function dve(){var h=th.current;return h===null?!0:(yr&4194048)===yr?hd===null:(yr&62914560)===yr||(yr&536870912)!==0?h===hd:!1}function pve(){var h=Z.H;return Z.H=mR,h===null?mR:h}function fve(){var h=Z.A;return Z.A=mJe,h}function Kz(){Nn=4,$_||(yr&4194048)!==yr&&th.current!==null||(lC=!0),(C_&134217727)===0&&(lx&134217727)===0||Ls===null||A_(Ls,yr,sh,!1)}function QZ(h,m,y){var w=Qr;Qr|=2;var $=pve(),C=fve();(Ls!==h||yr!==m)&&(Qz=null,hC(h,m)),m=!1;var k=Nn;e:do try{if(cs!==0&&ur!==null){var V=ur,te=rh;switch(cs){case 8:JZ(),k=6;break e;case 3:case 2:case 9:case 6:th.current===null&&(m=!0);var ye=cs;if(cs=0,rh=null,dC(h,V,te,ye),y&&lC){k=0;break e}break;default:ye=cs,cs=0,rh=null,dC(h,V,te,ye)}}vJe(),k=Nn;break}catch(Ee){hve(h,Ee)}while(!0);return m&&h.shellSuspendCounter++,py=K1=null,Qr=w,Z.H=$,Z.A=C,ur===null&&(Ls=null,yr=0,_z()),k}function vJe(){for(;ur!==null;)mve(ur)}function _Je(h,m){var y=Qr;Qr|=2;var w=pve(),$=fve();Ls!==h||yr!==m?(Qz=null,Jz=ht()+500,hC(h,m)):lC=En(h,m);e:do try{if(cs!==0&&ur!==null){m=ur;var C=rh;t:switch(cs){case 1:cs=0,rh=null,dC(h,m,C,1);break;case 2:case 9:if($ge(C)){cs=0,rh=null,gve(m);break}m=function(){cs!==2&&cs!==9||Ls!==h||(cs=7),Am(h)},C.then(m,m);break e;case 3:cs=7;break e;case 4:cs=5;break e;case 7:$ge(C)?(cs=0,rh=null,gve(m)):(cs=0,rh=null,dC(h,m,C,7));break;case 5:var k=null;switch(ur.tag){case 26:k=ur.memoizedState;case 5:case 27:var V=ur;if(k?t0e(k):V.stateNode.complete){cs=0,rh=null;var te=V.sibling;if(te!==null)ur=te;else{var ye=V.return;ye!==null?(ur=ye,eN(ye)):ur=null}break t}}cs=0,rh=null,dC(h,m,C,5);break;case 6:cs=0,rh=null,dC(h,m,C,6);break;case 8:JZ(),Nn=6;break e;default:throw Error(r(462))}}bJe();break}catch(Ee){hve(h,Ee)}while(!0);return py=K1=null,Z.H=w,Z.A=$,Qr=y,ur!==null?0:(Ls=null,yr=0,_z(),Nn)}function bJe(){for(;ur!==null&&!Qe();)mve(ur)}function mve(h){var m=Nye(h.alternate,h,Sy);h.memoizedProps=h.pendingProps,m===null?eN(h):ur=m}function gve(h){var m=h,y=m.alternate;switch(m.tag){case 15:case 0:m=Iye(y,m,m.pendingProps,m.type,void 0,yr);break;case 11:m=Iye(y,m,m.pendingProps,m.type.render,m.ref,yr);break;case 5:dZ(m);default:jye(y,m),m=ur=fge(m,Sy),m=Nye(y,m,Sy)}h.memoizedProps=h.pendingProps,m===null?eN(h):ur=m}function dC(h,m,y,w){py=K1=null,dZ(m),tC=null,oR=0;var $=m.return;try{if(lJe(h,$,m,y,yr)){Nn=1,jz(h,od(y,h.current)),ur=null;return}}catch(C){if($!==null)throw ur=$,C;Nn=1,jz(h,od(y,h.current)),ur=null;return}m.flags&32768?(Cr||w===1?h=!0:lC||(yr&536870912)!==0?h=!1:($_=h=!0,(w===2||w===9||w===3||w===6)&&(w=th.current,w!==null&&w.tag===13&&(w.flags|=16384))),yve(m,h)):eN(m)}function eN(h){var m=h;do{if((m.flags&32768)!==0){yve(m,$_);return}h=m.return;var y=hJe(m.alternate,m,Sy);if(y!==null){ur=y;return}if(m=m.sibling,m!==null){ur=m;return}ur=m=h}while(m!==null);Nn===0&&(Nn=5)}function yve(h,m){do{var y=dJe(h.alternate,h);if(y!==null){y.flags&=32767,ur=y;return}if(y=h.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!m&&(h=h.sibling,h!==null)){ur=h;return}ur=h=y}while(h!==null);Nn=6,ur=null}function vve(h,m,y,w,$,C,k,V,te){h.cancelPendingCommit=null;do tN();while(lo!==0);if((Qr&6)!==0)throw Error(r(327));if(m!==null){if(m===h.current)throw Error(r(177));if(C=m.lanes|m.childLanes,C|=NW,rs(h,y,C,k,V,te),h===Ls&&(ur=Ls=null,yr=0),uC=m,E_=h,Ty=y,WZ=C,ZZ=$,ove=w,(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?(h.callbackNode=null,h.callbackPriority=0,TJe(ci,function(){return Sve(),null})):(h.callbackNode=null,h.callbackPriority=0),w=(m.flags&13878)!==0,(m.subtreeFlags&13878)!==0||w){w=Z.T,Z.T=null,$=K.p,K.p=2,k=Qr,Qr|=4;try{pJe(h,m,y)}finally{Qr=k,K.p=$,Z.T=w}}lo=1,_ve(),bve(),wve()}}function _ve(){if(lo===1){lo=0;var h=E_,m=uC,y=(m.flags&13878)!==0;if((m.subtreeFlags&13878)!==0||y){y=Z.T,Z.T=null;var w=K.p;K.p=2;var $=Qr;Qr|=4;try{Kye(m,h);var C=cY,k=nge(h.containerInfo),V=C.focusedElem,te=C.selectionRange;if(k!==V&&V&&V.ownerDocument&&sge(V.ownerDocument.documentElement,V)){if(te!==null&&DW(V)){var ye=te.start,Ee=te.end;if(Ee===void 0&&(Ee=ye),"selectionStart"in V)V.selectionStart=ye,V.selectionEnd=Math.min(Ee,V.value.length);else{var Fe=V.ownerDocument||document,ve=Fe&&Fe.defaultView||window;if(ve.getSelection){var Te=ve.getSelection(),Pt=V.textContent.length,si=Math.min(te.start,Pt),Ss=te.end===void 0?si:Math.min(te.end,Pt);!Te.extend&&si>Ss&&(k=Ss,Ss=si,si=k);var ce=rge(V,si),oe=rge(V,Ss);if(ce&&oe&&(Te.rangeCount!==1||Te.anchorNode!==ce.node||Te.anchorOffset!==ce.offset||Te.focusNode!==oe.node||Te.focusOffset!==oe.offset)){var ge=Fe.createRange();ge.setStart(ce.node,ce.offset),Te.removeAllRanges(),si>Ss?(Te.addRange(ge),Te.extend(oe.node,oe.offset)):(ge.setEnd(oe.node,oe.offset),Te.addRange(ge))}}}}for(Fe=[],Te=V;Te=Te.parentNode;)Te.nodeType===1&&Fe.push({element:Te,left:Te.scrollLeft,top:Te.scrollTop});for(typeof V.focus=="function"&&V.focus(),V=0;V<Fe.length;V++){var De=Fe[V];De.element.scrollLeft=De.left,De.element.scrollTop=De.top}}pN=!!lY,cY=lY=null}finally{Qr=$,K.p=w,Z.T=y}}h.current=m,lo=2}}function bve(){if(lo===2){lo=0;var h=E_,m=uC,y=(m.flags&8772)!==0;if((m.subtreeFlags&8772)!==0||y){y=Z.T,Z.T=null;var w=K.p;K.p=2;var $=Qr;Qr|=4;try{Zye(h,m.alternate,m)}finally{Qr=$,K.p=w,Z.T=y}}lo=3}}function wve(){if(lo===4||lo===3){lo=0,et();var h=E_,m=uC,y=Ty,w=ove;(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?lo=5:(lo=0,uC=E_=null,xve(h,h.pendingLanes));var $=h.pendingLanes;if($===0&&(M_=null),Ko(y),m=m.stateNode,Ot&&typeof Ot.onCommitFiberRoot=="function")try{Ot.onCommitFiberRoot(ui,m,void 0,(m.current.flags&128)===128)}catch{}if(w!==null){m=Z.T,$=K.p,K.p=2,Z.T=null;try{for(var C=h.onRecoverableError,k=0;k<w.length;k++){var V=w[k];C(V.value,{componentStack:V.stack})}}finally{Z.T=m,K.p=$}}(Ty&3)!==0&&tN(),Am(h),$=h.pendingLanes,(y&261930)!==0&&($&42)!==0?h===YZ?TR++:(TR=0,YZ=h):TR=0,$R(0)}}function xve(h,m){(h.pooledCacheLanes&=m)===0&&(m=h.pooledCache,m!=null&&(h.pooledCache=null,nR(m)))}function tN(){return _ve(),bve(),wve(),Sve()}function Sve(){if(lo!==5)return!1;var h=E_,m=WZ;WZ=0;var y=Ko(Ty),w=Z.T,$=K.p;try{K.p=32>y?32:y,Z.T=null,y=ZZ,ZZ=null;var C=E_,k=Ty;if(lo=0,uC=E_=null,Ty=0,(Qr&6)!==0)throw Error(r(331));var V=Qr;if(Qr|=4,sve(C.current),tve(C,C.current,k,y),Qr=V,$R(0,!1),Ot&&typeof Ot.onPostCommitFiberRoot=="function")try{Ot.onPostCommitFiberRoot(ui,C)}catch{}return!0}finally{K.p=$,Z.T=w,xve(h,m)}}function Tve(h,m,y){m=od(y,m),m=MZ(h.stateNode,m,2),h=w_(h,m,2),h!==null&&(ai(h,2),Am(h))}function us(h,m,y){if(h.tag===3)Tve(h,h,y);else for(;m!==null;){if(m.tag===3){Tve(m,h,y);break}else if(m.tag===1){var w=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(M_===null||!M_.has(w))){h=od(y,h),y=$ye(2),w=w_(m,y,2),w!==null&&(Cye(y,w,m,h),ai(w,2),Am(w));break}}m=m.return}}function XZ(h,m,y){var w=h.pingCache;if(w===null){w=h.pingCache=new gJe;var $=new Set;w.set(m,$)}else $=w.get(m),$===void 0&&($=new Set,w.set(m,$));$.has(y)||(qZ=!0,$.add(y),h=wJe.bind(null,h,m,y),m.then(h,h))}function wJe(h,m,y){var w=h.pingCache;w!==null&&w.delete(m),h.pingedLanes|=h.suspendedLanes&y,h.warmLanes&=~y,Ls===h&&(yr&y)===y&&(Nn===4||Nn===3&&(yr&62914560)===yr&&300>ht()-Yz?(Qr&2)===0&&hC(h,0):GZ|=y,cC===yr&&(cC=0)),Am(h)}function $ve(h,m){m===0&&(m=pe()),h=J1(h,m),h!==null&&(ai(h,m),Am(h))}function xJe(h){var m=h.memoizedState,y=0;m!==null&&(y=m.retryLane),$ve(h,y)}function SJe(h,m){var y=0;switch(h.tag){case 31:case 13:var w=h.stateNode,$=h.memoizedState;$!==null&&(y=$.retryLane);break;case 19:w=h.stateNode;break;case 22:w=h.stateNode._retryCache;break;default:throw Error(r(314))}w!==null&&w.delete(m),$ve(h,y)}function TJe(h,m){return Nt(h,m)}var iN=null,pC=null,KZ=!1,rN=!1,eY=!1,O_=0;function Am(h){h!==pC&&h.next===null&&(pC===null?iN=pC=h:pC=pC.next=h),rN=!0,KZ||(KZ=!0,CJe())}function $R(h,m){if(!eY&&rN){eY=!0;do for(var y=!1,w=iN;w!==null;){if(h!==0){var $=w.pendingLanes;if($===0)var C=0;else{var k=w.suspendedLanes,V=w.pingedLanes;C=(1<<31-Jt(42|h)+1)-1,C&=$&~(k&~V),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(y=!0,Ave(w,C))}else C=yr,C=Ra(w,w===Ls?C:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(C&3)===0||En(w,C)||(y=!0,Ave(w,C));w=w.next}while(y);eY=!1}}function $Je(){Cve()}function Cve(){rN=KZ=!1;var h=0;O_!==0&&LJe()&&(h=O_);for(var m=ht(),y=null,w=iN;w!==null;){var $=w.next,C=Mve(w,m);C===0?(w.next=null,y===null?iN=$:y.next=$,$===null&&(pC=y)):(y=w,(h!==0||(C&3)!==0)&&(rN=!0)),w=$}lo!==0&&lo!==5||$R(h),O_!==0&&(O_=0)}function Mve(h,m){for(var y=h.suspendedLanes,w=h.pingedLanes,$=h.expirationTimes,C=h.pendingLanes&-62914561;0<C;){var k=31-Jt(C),V=1<<k,te=$[k];te===-1?((V&y)===0||(V&w)!==0)&&($[k]=Xo(V,m)):te<=m&&(h.expiredLanes|=V),C&=~V}if(m=Ls,y=yr,y=Ra(h,h===m?y:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),w=h.callbackNode,y===0||h===m&&(cs===2||cs===9)||h.cancelPendingCommit!==null)return w!==null&&w!==null&&tt(w),h.callbackNode=null,h.callbackPriority=0;if((y&3)===0||En(h,y)){if(m=y&-y,m===h.callbackPriority)return m;switch(w!==null&&tt(w),Ko(y)){case 2:case 8:y=zi;break;case 32:y=ci;break;case 268435456:y=tr;break;default:y=ci}return w=Eve.bind(null,h),y=Nt(y,w),h.callbackPriority=m,h.callbackNode=y,m}return w!==null&&w!==null&&tt(w),h.callbackPriority=2,h.callbackNode=null,2}function Eve(h,m){if(lo!==0&&lo!==5)return h.callbackNode=null,h.callbackPriority=0,null;var y=h.callbackNode;if(tN()&&h.callbackNode!==y)return null;var w=yr;return w=Ra(h,h===Ls?w:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),w===0?null:(cve(h,w,m),Mve(h,ht()),h.callbackNode!=null&&h.callbackNode===y?Eve.bind(null,h):null)}function Ave(h,m){if(tN())return null;cve(h,m,!0)}function CJe(){zJe(function(){(Qr&6)!==0?Nt(Wi,$Je):Cve()})}function tY(){if(O_===0){var h=X$;h===0&&(h=Vi,Vi<<=1,(Vi&261888)===0&&(Vi=256)),O_=h}return O_}function Ove(h){return h==null||typeof h=="symbol"||typeof h=="boolean"?null:typeof h=="function"?h:hz(""+h)}function Pve(h,m){var y=m.ownerDocument.createElement("input");return y.name=m.name,y.value=m.value,h.id&&y.setAttribute("form",h.id),m.parentNode.insertBefore(y,m),h=new FormData(h),y.parentNode.removeChild(y),h}function MJe(h,m,y,w,$){if(m==="submit"&&y&&y.stateNode===$){var C=Ove(($[ao]||null).action),k=w.submitter;k&&(m=(m=k[ao]||null)?Ove(m.formAction):k.getAttribute("formAction"),m!==null&&(C=m,k=null));var V=new mz("action","action",null,w,$);h.push({event:V,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(O_!==0){var te=k?Pve($,k):new FormData($);wZ(y,{pending:!0,data:te,method:$.method,action:C},null,te)}}else typeof C=="function"&&(V.preventDefault(),te=k?Pve($,k):new FormData($),wZ(y,{pending:!0,data:te,method:$.method,action:C},C,te))},currentTarget:$}]})}}for(var iY=0;iY<zW.length;iY++){var rY=zW[iY],EJe=rY.toLowerCase(),AJe=rY[0].toUpperCase()+rY.slice(1);Np(EJe,"on"+AJe)}Np(lge,"onAnimationEnd"),Np(cge,"onAnimationIteration"),Np(uge,"onAnimationStart"),Np("dblclick","onDoubleClick"),Np("focusin","onFocus"),Np("focusout","onBlur"),Np(GYe,"onTransitionRun"),Np(HYe,"onTransitionStart"),Np(WYe,"onTransitionCancel"),Np(hge,"onTransitionEnd"),oc("onMouseEnter",["mouseout","mouseover"]),oc("onMouseLeave",["mouseout","mouseover"]),oc("onPointerEnter",["pointerout","pointerover"]),oc("onPointerLeave",["pointerout","pointerover"]),$l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$l("onBeforeInput",["compositionend","keypress","textInput","paste"]),$l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var CR="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),OJe=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(CR));function Rve(h,m){m=(m&4)!==0;for(var y=0;y<h.length;y++){var w=h[y],$=w.event;w=w.listeners;e:{var C=void 0;if(m)for(var k=w.length-1;0<=k;k--){var V=w[k],te=V.instance,ye=V.currentTarget;if(V=V.listener,te!==C&&$.isPropagationStopped())break e;C=V,$.currentTarget=ye;try{C($)}catch(Ee){vz(Ee)}$.currentTarget=null,C=te}else for(k=0;k<w.length;k++){if(V=w[k],te=V.instance,ye=V.currentTarget,V=V.listener,te!==C&&$.isPropagationStopped())break e;C=V,$.currentTarget=ye;try{C($)}catch(Ee){vz(Ee)}$.currentTarget=null,C=te}}}}function hr(h,m){var y=m[Kt];y===void 0&&(y=m[Kt]=new Set);var w=h+"__bubble";y.has(w)||(Ive(m,h,2,!1),y.add(w))}function sY(h,m,y){var w=0;m&&(w|=4),Ive(y,h,w,m)}var sN="_reactListening"+Math.random().toString(36).slice(2);function nY(h){if(!h[sN]){h[sN]=!0,aa.forEach(function(y){y!=="selectionchange"&&(OJe.has(y)||sY(y,!1,h),sY(y,!0,h))});var m=h.nodeType===9?h:h.ownerDocument;m===null||m[sN]||(m[sN]=!0,sY("selectionchange",!1,m))}}function Ive(h,m,y,w){switch(l0e(m)){case 2:var $=sQe;break;case 8:$=nQe;break;default:$=bY}y=$.bind(null,m,y,h),$=void 0,!$W||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||($=!0),w?$!==void 0?h.addEventListener(m,y,{capture:!0,passive:$}):h.addEventListener(m,y,!0):$!==void 0?h.addEventListener(m,y,{passive:$}):h.addEventListener(m,y,!1)}function aY(h,m,y,w,$){var C=w;if((m&1)===0&&(m&2)===0&&w!==null)e:for(;;){if(w===null)return;var k=w.tag;if(k===3||k===4){var V=w.stateNode.containerInfo;if(V===$)break;if(k===4)for(k=w.return;k!==null;){var te=k.tag;if((te===3||te===4)&&k.stateNode.containerInfo===$)return;k=k.return}for(;V!==null;){if(k=ac(V),k===null)return;if(te=k.tag,te===5||te===6||te===26||te===27){w=C=k;continue e}V=V.parentNode}}w=w.return}zme(function(){var ye=C,Ee=SW(y),Fe=[];e:{var ve=dge.get(h);if(ve!==void 0){var Te=mz,Pt=h;switch(h){case"keypress":if(pz(y)===0)break e;case"keydown":case"keyup":Te=SYe;break;case"focusin":Pt="focus",Te=AW;break;case"focusout":Pt="blur",Te=AW;break;case"beforeblur":case"afterblur":Te=AW;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Te=jme;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Te=hYe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Te=CYe;break;case lge:case cge:case uge:Te=fYe;break;case hge:Te=EYe;break;case"scroll":case"scrollend":Te=cYe;break;case"wheel":Te=OYe;break;case"copy":case"cut":case"paste":Te=gYe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Te=Bme;break;case"toggle":case"beforetoggle":Te=RYe}var si=(m&4)!==0,Ss=!si&&(h==="scroll"||h==="scrollend"),ce=si?ve!==null?ve+"Capture":null:ve;si=[];for(var oe=ye,ge;oe!==null;){var De=oe;if(ge=De.stateNode,De=De.tag,De!==5&&De!==26&&De!==27||ge===null||ce===null||(De=ZP(oe,ce),De!=null&&si.push(MR(oe,De,ge))),Ss)break;oe=oe.return}0<si.length&&(ve=new Te(ve,Pt,null,y,Ee),Fe.push({event:ve,listeners:si}))}}if((m&7)===0){e:{if(ve=h==="mouseover"||h==="pointerover",Te=h==="mouseout"||h==="pointerout",ve&&y!==xW&&(Pt=y.relatedTarget||y.fromElement)&&(ac(Pt)||Pt[kp]))break e;if((Te||ve)&&(ve=Ee.window===Ee?Ee:(ve=Ee.ownerDocument)?ve.defaultView||ve.parentWindow:window,Te?(Pt=y.relatedTarget||y.toElement,Te=ye,Pt=Pt?ac(Pt):null,Pt!==null&&(Ss=n(Pt),si=Pt.tag,Pt!==Ss||si!==5&&si!==27&&si!==6)&&(Pt=null)):(Te=null,Pt=ye),Te!==Pt)){if(si=jme,De="onMouseLeave",ce="onMouseEnter",oe="mouse",(h==="pointerout"||h==="pointerover")&&(si=Bme,De="onPointerLeave",ce="onPointerEnter",oe="pointer"),Ss=Te==null?ve:rr(Te),ge=Pt==null?ve:rr(Pt),ve=new si(De,oe+"leave",Te,y,Ee),ve.target=Ss,ve.relatedTarget=ge,De=null,ac(Ee)===ye&&(si=new si(ce,oe+"enter",Pt,y,Ee),si.target=ge,si.relatedTarget=Ss,De=si),Ss=De,Te&&Pt)t:{for(si=PJe,ce=Te,oe=Pt,ge=0,De=ce;De;De=si(De))ge++;De=0;for(var Qt=oe;Qt;Qt=si(Qt))De++;for(;0<ge-De;)ce=si(ce),ge--;for(;0<De-ge;)oe=si(oe),De--;for(;ge--;){if(ce===oe||oe!==null&&ce===oe.alternate){si=ce;break t}ce=si(ce),oe=si(oe)}si=null}else si=null;Te!==null&&Dve(Fe,ve,Te,si,!1),Pt!==null&&Ss!==null&&Dve(Fe,Ss,Pt,si,!0)}}e:{if(ve=ye?rr(ye):window,Te=ve.nodeName&&ve.nodeName.toLowerCase(),Te==="select"||Te==="input"&&ve.type==="file")var jr=Qme;else if(Yme(ve))if(Xme)jr=UYe;else{jr=VYe;var Ut=NYe}else Te=ve.nodeName,!Te||Te.toLowerCase()!=="input"||ve.type!=="checkbox"&&ve.type!=="radio"?ye&&wW(ye.elementType)&&(jr=Qme):jr=jYe;if(jr&&(jr=jr(h,ye))){Jme(Fe,jr,y,Ee);break e}Ut&&Ut(h,ve,ye),h==="focusout"&&ye&&ve.type==="number"&&ye.memoizedProps.value!=null&&N$(ve,"number",ve.value)}switch(Ut=ye?rr(ye):window,h){case"focusin":(Yme(Ut)||Ut.contentEditable==="true")&&(q$=Ut,kW=ye,iR=null);break;case"focusout":iR=kW=q$=null;break;case"mousedown":LW=!0;break;case"contextmenu":case"mouseup":case"dragend":LW=!1,age(Fe,y,Ee);break;case"selectionchange":if(qYe)break;case"keydown":case"keyup":age(Fe,y,Ee)}var ji;if(PW)e:{switch(h){case"compositionstart":var vr="onCompositionStart";break e;case"compositionend":vr="onCompositionEnd";break e;case"compositionupdate":vr="onCompositionUpdate";break e}vr=void 0}else B$?Wme(h,y)&&(vr="onCompositionEnd"):h==="keydown"&&y.keyCode===229&&(vr="onCompositionStart");vr&&(qme&&y.locale!=="ko"&&(B$||vr!=="onCompositionStart"?vr==="onCompositionEnd"&&B$&&(ji=Nme()):(f_=Ee,CW="value"in f_?f_.value:f_.textContent,B$=!0)),Ut=nN(ye,vr),0<Ut.length&&(vr=new Ume(vr,h,null,y,Ee),Fe.push({event:vr,listeners:Ut}),ji?vr.data=ji:(ji=Zme(y),ji!==null&&(vr.data=ji)))),(ji=DYe?kYe(h,y):LYe(h,y))&&(vr=nN(ye,"onBeforeInput"),0<vr.length&&(Ut=new Ume("onBeforeInput","beforeinput",null,y,Ee),Fe.push({event:Ut,listeners:vr}),Ut.data=ji)),MJe(Fe,h,ye,y,Ee)}Rve(Fe,m)})}function MR(h,m,y){return{instance:h,listener:m,currentTarget:y}}function nN(h,m){for(var y=m+"Capture",w=[];h!==null;){var $=h,C=$.stateNode;if($=$.tag,$!==5&&$!==26&&$!==27||C===null||($=ZP(h,y),$!=null&&w.unshift(MR(h,$,C)),$=ZP(h,m),$!=null&&w.push(MR(h,$,C))),h.tag===3)return w;h=h.return}return[]}function PJe(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5&&h.tag!==27);return h||null}function Dve(h,m,y,w,$){for(var C=m._reactName,k=[];y!==null&&y!==w;){var V=y,te=V.alternate,ye=V.stateNode;if(V=V.tag,te!==null&&te===w)break;V!==5&&V!==26&&V!==27||ye===null||(te=ye,$?(ye=ZP(y,C),ye!=null&&k.unshift(MR(y,ye,te))):$||(ye=ZP(y,C),ye!=null&&k.push(MR(y,ye,te)))),y=y.return}k.length!==0&&h.push({event:m,listeners:k})}var RJe=/\r\n?/g,IJe=/\u0000|\uFFFD/g;function kve(h){return(typeof h=="string"?h:""+h).replace(RJe,`
`).replace(IJe,"")}function Lve(h,m){return m=kve(m),kve(h)===m}function xs(h,m,y,w,$,C){switch(y){case"children":typeof w=="string"?m==="body"||m==="textarea"&&w===""||V$(h,w):(typeof w=="number"||typeof w=="bigint")&&m!=="body"&&V$(h,""+w);break;case"className":Tm(h,"class",w);break;case"tabIndex":Tm(h,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":Tm(h,y,w);break;case"style":Lme(h,w,C);break;case"data":if(m!=="object"){Tm(h,"data",w);break}case"src":case"href":if(w===""&&(m!=="a"||y!=="href")){h.removeAttribute(y);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){h.removeAttribute(y);break}w=hz(""+w),h.setAttribute(y,w);break;case"action":case"formAction":if(typeof w=="function"){h.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(y==="formAction"?(m!=="input"&&xs(h,m,"name",$.name,$,null),xs(h,m,"formEncType",$.formEncType,$,null),xs(h,m,"formMethod",$.formMethod,$,null),xs(h,m,"formTarget",$.formTarget,$,null)):(xs(h,m,"encType",$.encType,$,null),xs(h,m,"method",$.method,$,null),xs(h,m,"target",$.target,$,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){h.removeAttribute(y);break}w=hz(""+w),h.setAttribute(y,w);break;case"onClick":w!=null&&(h.onclick=cy);break;case"onScroll":w!=null&&hr("scroll",h);break;case"onScrollEnd":w!=null&&hr("scrollend",h);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(r(61));if(y=w.__html,y!=null){if($.children!=null)throw Error(r(60));h.innerHTML=y}}break;case"multiple":h.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":h.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){h.removeAttribute("xlink:href");break}y=hz(""+w),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?h.setAttribute(y,""+w):h.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?h.setAttribute(y,""):h.removeAttribute(y);break;case"capture":case"download":w===!0?h.setAttribute(y,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?h.setAttribute(y,w):h.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?h.setAttribute(y,w):h.removeAttribute(y);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?h.removeAttribute(y):h.setAttribute(y,w);break;case"popover":hr("beforetoggle",h),hr("toggle",h),zp(h,"popover",w);break;case"xlinkActuate":Y(h,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":Y(h,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":Y(h,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":Y(h,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":Y(h,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":Y(h,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":Y(h,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":Y(h,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":Y(h,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":zp(h,"is",w);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=oYe.get(y)||y,zp(h,y,w))}}function oY(h,m,y,w,$,C){switch(y){case"style":Lme(h,w,C);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(r(61));if(y=w.__html,y!=null){if($.children!=null)throw Error(r(60));h.innerHTML=y}}break;case"children":typeof w=="string"?V$(h,w):(typeof w=="number"||typeof w=="bigint")&&V$(h,""+w);break;case"onScroll":w!=null&&hr("scroll",h);break;case"onScrollEnd":w!=null&&hr("scrollend",h);break;case"onClick":w!=null&&(h.onclick=cy);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Xu.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&($=y.endsWith("Capture"),m=y.slice(2,$?y.length-7:void 0),C=h[ao]||null,C=C!=null?C[y]:null,typeof C=="function"&&h.removeEventListener(m,C,$),typeof w=="function")){typeof C!="function"&&C!==null&&(y in h?h[y]=null:h.hasAttribute(y)&&h.removeAttribute(y)),h.addEventListener(m,w,$);break e}y in h?h[y]=w:w===!0?h.setAttribute(y,""):zp(h,y,w)}}}function sl(h,m,y){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":hr("error",h),hr("load",h);var w=!1,$=!1,C;for(C in y)if(y.hasOwnProperty(C)){var k=y[C];if(k!=null)switch(C){case"src":w=!0;break;case"srcSet":$=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,m));default:xs(h,m,C,k,y,null)}}$&&xs(h,m,"srcSet",y.srcSet,y,null),w&&xs(h,m,"src",y.src,y,null);return;case"input":hr("invalid",h);var V=C=k=$=null,te=null,ye=null;for(w in y)if(y.hasOwnProperty(w)){var Ee=y[w];if(Ee!=null)switch(w){case"name":$=Ee;break;case"type":k=Ee;break;case"checked":te=Ee;break;case"defaultChecked":ye=Ee;break;case"value":C=Ee;break;case"defaultValue":V=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(r(137,m));break;default:xs(h,m,w,Ee,y,null)}}WP(h,C,V,te,ye,k,$,!1);return;case"select":hr("invalid",h),w=k=C=null;for($ in y)if(y.hasOwnProperty($)&&(V=y[$],V!=null))switch($){case"value":C=V;break;case"defaultValue":k=V;break;case"multiple":w=V;default:xs(h,m,$,V,y,null)}m=C,y=k,h.multiple=!!w,m!=null?$m(h,!!w,m,!1):y!=null&&$m(h,!!w,y,!0);return;case"textarea":hr("invalid",h),C=$=w=null;for(k in y)if(y.hasOwnProperty(k)&&(V=y[k],V!=null))switch(k){case"value":w=V;break;case"defaultValue":$=V;break;case"children":C=V;break;case"dangerouslySetInnerHTML":if(V!=null)throw Error(r(91));break;default:xs(h,m,k,V,y,null)}Dme(h,w,$,C);return;case"option":for(te in y)y.hasOwnProperty(te)&&(w=y[te],w!=null)&&(te==="selected"?h.selected=w&&typeof w!="function"&&typeof w!="symbol":xs(h,m,te,w,y,null));return;case"dialog":hr("beforetoggle",h),hr("toggle",h),hr("cancel",h),hr("close",h);break;case"iframe":case"object":hr("load",h);break;case"video":case"audio":for(w=0;w<CR.length;w++)hr(CR[w],h);break;case"image":hr("error",h),hr("load",h);break;case"details":hr("toggle",h);break;case"embed":case"source":case"link":hr("error",h),hr("load",h);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ye in y)if(y.hasOwnProperty(ye)&&(w=y[ye],w!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,m));default:xs(h,m,ye,w,y,null)}return;default:if(wW(m)){for(Ee in y)y.hasOwnProperty(Ee)&&(w=y[Ee],w!==void 0&&oY(h,m,Ee,w,y,void 0));return}}for(V in y)y.hasOwnProperty(V)&&(w=y[V],w!=null&&xs(h,m,V,w,y,null))}function DJe(h,m,y,w){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var $=null,C=null,k=null,V=null,te=null,ye=null,Ee=null;for(Te in y){var Fe=y[Te];if(y.hasOwnProperty(Te)&&Fe!=null)switch(Te){case"checked":break;case"value":break;case"defaultValue":te=Fe;default:w.hasOwnProperty(Te)||xs(h,m,Te,null,w,Fe)}}for(var ve in w){var Te=w[ve];if(Fe=y[ve],w.hasOwnProperty(ve)&&(Te!=null||Fe!=null))switch(ve){case"type":C=Te;break;case"name":$=Te;break;case"checked":ye=Te;break;case"defaultChecked":Ee=Te;break;case"value":k=Te;break;case"defaultValue":V=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(r(137,m));break;default:Te!==Fe&&xs(h,m,ve,Te,w,Fe)}}z$(h,k,V,te,ye,Ee,C,$);return;case"select":Te=k=V=ve=null;for(C in y)if(te=y[C],y.hasOwnProperty(C)&&te!=null)switch(C){case"value":break;case"multiple":Te=te;default:w.hasOwnProperty(C)||xs(h,m,C,null,w,te)}for($ in w)if(C=w[$],te=y[$],w.hasOwnProperty($)&&(C!=null||te!=null))switch($){case"value":ve=C;break;case"defaultValue":V=C;break;case"multiple":k=C;default:C!==te&&xs(h,m,$,C,w,te)}m=V,y=k,w=Te,ve!=null?$m(h,!!y,ve,!1):!!w!=!!y&&(m!=null?$m(h,!!y,m,!0):$m(h,!!y,y?[]:"",!1));return;case"textarea":Te=ve=null;for(V in y)if($=y[V],y.hasOwnProperty(V)&&$!=null&&!w.hasOwnProperty(V))switch(V){case"value":break;case"children":break;default:xs(h,m,V,null,w,$)}for(k in w)if($=w[k],C=y[k],w.hasOwnProperty(k)&&($!=null||C!=null))switch(k){case"value":ve=$;break;case"defaultValue":Te=$;break;case"children":break;case"dangerouslySetInnerHTML":if($!=null)throw Error(r(91));break;default:$!==C&&xs(h,m,k,$,w,C)}Ime(h,ve,Te);return;case"option":for(var Pt in y)ve=y[Pt],y.hasOwnProperty(Pt)&&ve!=null&&!w.hasOwnProperty(Pt)&&(Pt==="selected"?h.selected=!1:xs(h,m,Pt,null,w,ve));for(te in w)ve=w[te],Te=y[te],w.hasOwnProperty(te)&&ve!==Te&&(ve!=null||Te!=null)&&(te==="selected"?h.selected=ve&&typeof ve!="function"&&typeof ve!="symbol":xs(h,m,te,ve,w,Te));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var si in y)ve=y[si],y.hasOwnProperty(si)&&ve!=null&&!w.hasOwnProperty(si)&&xs(h,m,si,null,w,ve);for(ye in w)if(ve=w[ye],Te=y[ye],w.hasOwnProperty(ye)&&ve!==Te&&(ve!=null||Te!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(r(137,m));break;default:xs(h,m,ye,ve,w,Te)}return;default:if(wW(m)){for(var Ss in y)ve=y[Ss],y.hasOwnProperty(Ss)&&ve!==void 0&&!w.hasOwnProperty(Ss)&&oY(h,m,Ss,void 0,w,ve);for(Ee in w)ve=w[Ee],Te=y[Ee],!w.hasOwnProperty(Ee)||ve===Te||ve===void 0&&Te===void 0||oY(h,m,Ee,ve,w,Te);return}}for(var ce in y)ve=y[ce],y.hasOwnProperty(ce)&&ve!=null&&!w.hasOwnProperty(ce)&&xs(h,m,ce,null,w,ve);for(Fe in w)ve=w[Fe],Te=y[Fe],!w.hasOwnProperty(Fe)||ve===Te||ve==null&&Te==null||xs(h,m,Fe,ve,w,Te)}function Fve(h){switch(h){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function kJe(){if(typeof performance.getEntriesByType=="function"){for(var h=0,m=0,y=performance.getEntriesByType("resource"),w=0;w<y.length;w++){var $=y[w],C=$.transferSize,k=$.initiatorType,V=$.duration;if(C&&V&&Fve(k)){for(k=0,V=$.responseEnd,w+=1;w<y.length;w++){var te=y[w],ye=te.startTime;if(ye>V)break;var Ee=te.transferSize,Fe=te.initiatorType;Ee&&Fve(Fe)&&(te=te.responseEnd,k+=Ee*(te<V?1:(V-ye)/(te-ye)))}if(--w,m+=8*(C+k)/($.duration/1e3),h++,10<h)break}}if(0<h)return m/h/1e6}return navigator.connection&&(h=navigator.connection.downlink,typeof h=="number")?h:5}var lY=null,cY=null;function aN(h){return h.nodeType===9?h:h.ownerDocument}function zve(h){switch(h){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Nve(h,m){if(h===0)switch(m){case"svg":return 1;case"math":return 2;default:return 0}return h===1&&m==="foreignObject"?0:h}function uY(h,m){return h==="textarea"||h==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.children=="bigint"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var hY=null;function LJe(){var h=window.event;return h&&h.type==="popstate"?h===hY?!1:(hY=h,!0):(hY=null,!1)}var Vve=typeof setTimeout=="function"?setTimeout:void 0,FJe=typeof clearTimeout=="function"?clearTimeout:void 0,jve=typeof Promise=="function"?Promise:void 0,zJe=typeof queueMicrotask=="function"?queueMicrotask:typeof jve<"u"?function(h){return jve.resolve(null).then(h).catch(NJe)}:Vve;function NJe(h){setTimeout(function(){throw h})}function P_(h){return h==="head"}function Uve(h,m){var y=m,w=0;do{var $=y.nextSibling;if(h.removeChild(y),$&&$.nodeType===8)if(y=$.data,y==="/$"||y==="/&"){if(w===0){h.removeChild($),yC(m);return}w--}else if(y==="$"||y==="$?"||y==="$~"||y==="$!"||y==="&")w++;else if(y==="html")ER(h.ownerDocument.documentElement);else if(y==="head"){y=h.ownerDocument.head,ER(y);for(var C=y.firstChild;C;){var k=C.nextSibling,V=C.nodeName;C[wm]||V==="SCRIPT"||V==="STYLE"||V==="LINK"&&C.rel.toLowerCase()==="stylesheet"||y.removeChild(C),C=k}}else y==="body"&&ER(h.ownerDocument.body);y=$}while(y);yC(m)}function Bve(h,m){var y=h;h=0;do{var w=y.nextSibling;if(y.nodeType===1?m?(y._stashedDisplay=y.style.display,y.style.display="none"):(y.style.display=y._stashedDisplay||"",y.getAttribute("style")===""&&y.removeAttribute("style")):y.nodeType===3&&(m?(y._stashedText=y.nodeValue,y.nodeValue=""):y.nodeValue=y._stashedText||""),w&&w.nodeType===8)if(y=w.data,y==="/$"){if(h===0)break;h--}else y!=="$"&&y!=="$?"&&y!=="$~"&&y!=="$!"||h++;y=w}while(y)}function dY(h){var m=h.firstChild;for(m&&m.nodeType===10&&(m=m.nextSibling);m;){var y=m;switch(m=m.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":dY(y),Xc(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}h.removeChild(y)}}function VJe(h,m,y,w){for(;h.nodeType===1;){var $=y;if(h.nodeName.toLowerCase()!==m.toLowerCase()){if(!w&&(h.nodeName!=="INPUT"||h.type!=="hidden"))break}else if(w){if(!h[wm])switch(m){case"meta":if(!h.hasAttribute("itemprop"))break;return h;case"link":if(C=h.getAttribute("rel"),C==="stylesheet"&&h.hasAttribute("data-precedence"))break;if(C!==$.rel||h.getAttribute("href")!==($.href==null||$.href===""?null:$.href)||h.getAttribute("crossorigin")!==($.crossOrigin==null?null:$.crossOrigin)||h.getAttribute("title")!==($.title==null?null:$.title))break;return h;case"style":if(h.hasAttribute("data-precedence"))break;return h;case"script":if(C=h.getAttribute("src"),(C!==($.src==null?null:$.src)||h.getAttribute("type")!==($.type==null?null:$.type)||h.getAttribute("crossorigin")!==($.crossOrigin==null?null:$.crossOrigin))&&C&&h.hasAttribute("async")&&!h.hasAttribute("itemprop"))break;return h;default:return h}}else if(m==="input"&&h.type==="hidden"){var C=$.name==null?null:""+$.name;if($.type==="hidden"&&h.getAttribute("name")===C)return h}else return h;if(h=dd(h.nextSibling),h===null)break}return null}function jJe(h,m,y){if(m==="")return null;for(;h.nodeType!==3;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!y||(h=dd(h.nextSibling),h===null))return null;return h}function qve(h,m){for(;h.nodeType!==8;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!m||(h=dd(h.nextSibling),h===null))return null;return h}function pY(h){return h.data==="$?"||h.data==="$~"}function fY(h){return h.data==="$!"||h.data==="$?"&&h.ownerDocument.readyState!=="loading"}function UJe(h,m){var y=h.ownerDocument;if(h.data==="$~")h._reactRetry=m;else if(h.data!=="$?"||y.readyState!=="loading")m();else{var w=function(){m(),y.removeEventListener("DOMContentLoaded",w)};y.addEventListener("DOMContentLoaded",w),h._reactRetry=w}}function dd(h){for(;h!=null;h=h.nextSibling){var m=h.nodeType;if(m===1||m===3)break;if(m===8){if(m=h.data,m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"||m==="F!"||m==="F")break;if(m==="/$"||m==="/&")return null}}return h}var mY=null;function Gve(h){h=h.nextSibling;for(var m=0;h;){if(h.nodeType===8){var y=h.data;if(y==="/$"||y==="/&"){if(m===0)return dd(h.nextSibling);m--}else y!=="$"&&y!=="$!"&&y!=="$?"&&y!=="$~"&&y!=="&"||m++}h=h.nextSibling}return null}function Hve(h){h=h.previousSibling;for(var m=0;h;){if(h.nodeType===8){var y=h.data;if(y==="$"||y==="$!"||y==="$?"||y==="$~"||y==="&"){if(m===0)return h;m--}else y!=="/$"&&y!=="/&"||m++}h=h.previousSibling}return null}function Wve(h,m,y){switch(m=aN(y),h){case"html":if(h=m.documentElement,!h)throw Error(r(452));return h;case"head":if(h=m.head,!h)throw Error(r(453));return h;case"body":if(h=m.body,!h)throw Error(r(454));return h;default:throw Error(r(451))}}function ER(h){for(var m=h.attributes;m.length;)h.removeAttributeNode(m[0]);Xc(h)}var pd=new Map,Zve=new Set;function oN(h){return typeof h.getRootNode=="function"?h.getRootNode():h.nodeType===9?h:h.ownerDocument}var $y=K.d;K.d={f:BJe,r:qJe,D:GJe,C:HJe,L:WJe,m:ZJe,X:JJe,S:YJe,M:QJe};function BJe(){var h=$y.f(),m=Xz();return h||m}function qJe(h){var m=el(h);m!==null&&m.tag===5&&m.type==="form"?hye(m):$y.r(h)}var fC=typeof document>"u"?null:document;function Yve(h,m,y){var w=fC;if(w&&typeof m=="string"&&m){var $=Cl(m);$='link[rel="'+h+'"][href="'+$+'"]',typeof y=="string"&&($+='[crossorigin="'+y+'"]'),Zve.has($)||(Zve.add($),h={rel:h,crossOrigin:y,href:m},w.querySelector($)===null&&(m=w.createElement("link"),sl(m,"link",h),ss(m),w.head.appendChild(m)))}}function GJe(h){$y.D(h),Yve("dns-prefetch",h,null)}function HJe(h,m){$y.C(h,m),Yve("preconnect",h,m)}function WJe(h,m,y){$y.L(h,m,y);var w=fC;if(w&&h&&m){var $='link[rel="preload"][as="'+Cl(m)+'"]';m==="image"&&y&&y.imageSrcSet?($+='[imagesrcset="'+Cl(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&($+='[imagesizes="'+Cl(y.imageSizes)+'"]')):$+='[href="'+Cl(h)+'"]';var C=$;switch(m){case"style":C=mC(h);break;case"script":C=gC(h)}pd.has(C)||(h=f({rel:"preload",href:m==="image"&&y&&y.imageSrcSet?void 0:h,as:m},y),pd.set(C,h),w.querySelector($)!==null||m==="style"&&w.querySelector(AR(C))||m==="script"&&w.querySelector(OR(C))||(m=w.createElement("link"),sl(m,"link",h),ss(m),w.head.appendChild(m)))}}function ZJe(h,m){$y.m(h,m);var y=fC;if(y&&h){var w=m&&typeof m.as=="string"?m.as:"script",$='link[rel="modulepreload"][as="'+Cl(w)+'"][href="'+Cl(h)+'"]',C=$;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=gC(h)}if(!pd.has(C)&&(h=f({rel:"modulepreload",href:h},m),pd.set(C,h),y.querySelector($)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(OR(C)))return}w=y.createElement("link"),sl(w,"link",h),ss(w),y.head.appendChild(w)}}}function YJe(h,m,y){$y.S(h,m,y);var w=fC;if(w&&h){var $=oo(w).hoistableStyles,C=mC(h);m=m||"default";var k=$.get(C);if(!k){var V={loading:0,preload:null};if(k=w.querySelector(AR(C)))V.loading=5;else{h=f({rel:"stylesheet",href:h,"data-precedence":m},y),(y=pd.get(C))&&gY(h,y);var te=k=w.createElement("link");ss(te),sl(te,"link",h),te._p=new Promise(function(ye,Ee){te.onload=ye,te.onerror=Ee}),te.addEventListener("load",function(){V.loading|=1}),te.addEventListener("error",function(){V.loading|=2}),V.loading|=4,lN(k,m,w)}k={type:"stylesheet",instance:k,count:1,state:V},$.set(C,k)}}}function JJe(h,m){$y.X(h,m);var y=fC;if(y&&h){var w=oo(y).hoistableScripts,$=gC(h),C=w.get($);C||(C=y.querySelector(OR($)),C||(h=f({src:h,async:!0},m),(m=pd.get($))&&yY(h,m),C=y.createElement("script"),ss(C),sl(C,"link",h),y.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},w.set($,C))}}function QJe(h,m){$y.M(h,m);var y=fC;if(y&&h){var w=oo(y).hoistableScripts,$=gC(h),C=w.get($);C||(C=y.querySelector(OR($)),C||(h=f({src:h,async:!0,type:"module"},m),(m=pd.get($))&&yY(h,m),C=y.createElement("script"),ss(C),sl(C,"link",h),y.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},w.set($,C))}}function Jve(h,m,y,w){var $=($=Be.current)?oN($):null;if(!$)throw Error(r(446));switch(h){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(m=mC(y.href),y=oo($).hoistableStyles,w=y.get(m),w||(w={type:"style",instance:null,count:0,state:null},y.set(m,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){h=mC(y.href);var C=oo($).hoistableStyles,k=C.get(h);if(k||($=$.ownerDocument||$,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(h,k),(C=$.querySelector(AR(h)))&&!C._p&&(k.instance=C,k.state.loading=5),pd.has(h)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},pd.set(h,y),C||XJe($,h,y,k.state))),m&&w===null)throw Error(r(528,""));return k}if(m&&w!==null)throw Error(r(529,""));return null;case"script":return m=y.async,y=y.src,typeof y=="string"&&m&&typeof m!="function"&&typeof m!="symbol"?(m=gC(y),y=oo($).hoistableScripts,w=y.get(m),w||(w={type:"script",instance:null,count:0,state:null},y.set(m,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,h))}}function mC(h){return'href="'+Cl(h)+'"'}function AR(h){return'link[rel="stylesheet"]['+h+"]"}function Qve(h){return f({},h,{"data-precedence":h.precedence,precedence:null})}function XJe(h,m,y,w){h.querySelector('link[rel="preload"][as="style"]['+m+"]")?w.loading=1:(m=h.createElement("link"),w.preload=m,m.addEventListener("load",function(){return w.loading|=1}),m.addEventListener("error",function(){return w.loading|=2}),sl(m,"link",y),ss(m),h.head.appendChild(m))}function gC(h){return'[src="'+Cl(h)+'"]'}function OR(h){return"script[async]"+h}function Xve(h,m,y){if(m.count++,m.instance===null)switch(m.type){case"style":var w=h.querySelector('style[data-href~="'+Cl(y.href)+'"]');if(w)return m.instance=w,ss(w),w;var $=f({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return w=(h.ownerDocument||h).createElement("style"),ss(w),sl(w,"style",$),lN(w,y.precedence,h),m.instance=w;case"stylesheet":$=mC(y.href);var C=h.querySelector(AR($));if(C)return m.state.loading|=4,m.instance=C,ss(C),C;w=Qve(y),($=pd.get($))&&gY(w,$),C=(h.ownerDocument||h).createElement("link"),ss(C);var k=C;return k._p=new Promise(function(V,te){k.onload=V,k.onerror=te}),sl(C,"link",w),m.state.loading|=4,lN(C,y.precedence,h),m.instance=C;case"script":return C=gC(y.src),($=h.querySelector(OR(C)))?(m.instance=$,ss($),$):(w=y,($=pd.get(C))&&(w=f({},y),yY(w,$)),h=h.ownerDocument||h,$=h.createElement("script"),ss($),sl($,"link",w),h.head.appendChild($),m.instance=$);case"void":return null;default:throw Error(r(443,m.type))}else m.type==="stylesheet"&&(m.state.loading&4)===0&&(w=m.instance,m.state.loading|=4,lN(w,y.precedence,h));return m.instance}function lN(h,m,y){for(var w=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),$=w.length?w[w.length-1]:null,C=$,k=0;k<w.length;k++){var V=w[k];if(V.dataset.precedence===m)C=V;else if(C!==$)break}C?C.parentNode.insertBefore(h,C.nextSibling):(m=y.nodeType===9?y.head:y,m.insertBefore(h,m.firstChild))}function gY(h,m){h.crossOrigin==null&&(h.crossOrigin=m.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=m.referrerPolicy),h.title==null&&(h.title=m.title)}function yY(h,m){h.crossOrigin==null&&(h.crossOrigin=m.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=m.referrerPolicy),h.integrity==null&&(h.integrity=m.integrity)}var cN=null;function Kve(h,m,y){if(cN===null){var w=new Map,$=cN=new Map;$.set(y,w)}else $=cN,w=$.get(y),w||(w=new Map,$.set(y,w));if(w.has(h))return w;for(w.set(h,null),y=y.getElementsByTagName(h),$=0;$<y.length;$++){var C=y[$];if(!(C[wm]||C[Oi]||h==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var k=C.getAttribute(m)||"";k=h+k;var V=w.get(k);V?V.push(C):w.set(k,[C])}}return w}function e0e(h,m,y){h=h.ownerDocument||h,h.head.insertBefore(y,m==="title"?h.querySelector("head > title"):null)}function KJe(h,m,y){if(y===1||m.itemProp!=null)return!1;switch(h){case"meta":case"title":return!0;case"style":if(typeof m.precedence!="string"||typeof m.href!="string"||m.href==="")break;return!0;case"link":if(typeof m.rel!="string"||typeof m.href!="string"||m.href===""||m.onLoad||m.onError)break;return m.rel==="stylesheet"?(h=m.disabled,typeof m.precedence=="string"&&h==null):!0;case"script":if(m.async&&typeof m.async!="function"&&typeof m.async!="symbol"&&!m.onLoad&&!m.onError&&m.src&&typeof m.src=="string")return!0}return!1}function t0e(h){return!(h.type==="stylesheet"&&(h.state.loading&3)===0)}function eQe(h,m,y,w){if(y.type==="stylesheet"&&(typeof w.media!="string"||matchMedia(w.media).matches!==!1)&&(y.state.loading&4)===0){if(y.instance===null){var $=mC(w.href),C=m.querySelector(AR($));if(C){m=C._p,m!==null&&typeof m=="object"&&typeof m.then=="function"&&(h.count++,h=uN.bind(h),m.then(h,h)),y.state.loading|=4,y.instance=C,ss(C);return}C=m.ownerDocument||m,w=Qve(w),($=pd.get($))&&gY(w,$),C=C.createElement("link"),ss(C);var k=C;k._p=new Promise(function(V,te){k.onload=V,k.onerror=te}),sl(C,"link",w),y.instance=C}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(y,m),(m=y.state.preload)&&(y.state.loading&3)===0&&(h.count++,y=uN.bind(h),m.addEventListener("load",y),m.addEventListener("error",y))}}var vY=0;function tQe(h,m){return h.stylesheets&&h.count===0&&dN(h,h.stylesheets),0<h.count||0<h.imgCount?function(y){var w=setTimeout(function(){if(h.stylesheets&&dN(h,h.stylesheets),h.unsuspend){var C=h.unsuspend;h.unsuspend=null,C()}},6e4+m);0<h.imgBytes&&vY===0&&(vY=62500*kJe());var $=setTimeout(function(){if(h.waitingForImages=!1,h.count===0&&(h.stylesheets&&dN(h,h.stylesheets),h.unsuspend)){var C=h.unsuspend;h.unsuspend=null,C()}},(h.imgBytes>vY?50:800)+m);return h.unsuspend=y,function(){h.unsuspend=null,clearTimeout(w),clearTimeout($)}}:null}function uN(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)dN(this,this.stylesheets);else if(this.unsuspend){var h=this.unsuspend;this.unsuspend=null,h()}}}var hN=null;function dN(h,m){h.stylesheets=null,h.unsuspend!==null&&(h.count++,hN=new Map,m.forEach(iQe,h),hN=null,uN.call(h))}function iQe(h,m){if(!(m.state.loading&4)){var y=hN.get(h);if(y)var w=y.get(null);else{y=new Map,hN.set(h,y);for(var $=h.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<$.length;C++){var k=$[C];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(y.set(k.dataset.precedence,k),w=k)}w&&y.set(null,w)}$=m.instance,k=$.getAttribute("data-precedence"),C=y.get(k)||w,C===w&&y.set(null,$),y.set(k,$),this.count++,w=uN.bind(this),$.addEventListener("load",w),$.addEventListener("error",w),C?C.parentNode.insertBefore($,C.nextSibling):(h=h.nodeType===9?h.head:h,h.insertBefore($,h.firstChild)),m.state.loading|=4}}var PR={$$typeof:E,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function rQe(h,m,y,w,$,C,k,V,te){this.tag=1,this.containerInfo=h,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=hi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=hi(0),this.hiddenUpdates=hi(null),this.identifierPrefix=w,this.onUncaughtError=$,this.onCaughtError=C,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=te,this.incompleteTransitions=new Map}function i0e(h,m,y,w,$,C,k,V,te,ye,Ee,Fe){return h=new rQe(h,m,y,k,te,ye,Ee,Fe,V),m=1,C===!0&&(m|=24),C=eh(3,null,null,m),h.current=C,C.stateNode=h,m=QW(),m.refCount++,h.pooledCache=m,m.refCount++,C.memoizedState={element:w,isDehydrated:y,cache:m},tZ(C),h}function r0e(h){return h?(h=W$,h):W$}function s0e(h,m,y,w,$,C){$=r0e($),w.context===null?w.context=$:w.pendingContext=$,w=b_(m),w.payload={element:y},C=C===void 0?null:C,C!==null&&(w.callback=C),y=w_(h,w,m),y!==null&&(su(y,h,m),cR(y,h,m))}function n0e(h,m){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var y=h.retryLane;h.retryLane=y!==0&&y<m?y:m}}function _Y(h,m){n0e(h,m),(h=h.alternate)&&n0e(h,m)}function a0e(h){if(h.tag===13||h.tag===31){var m=J1(h,67108864);m!==null&&su(m,h,67108864),_Y(h,67108864)}}function o0e(h){if(h.tag===13||h.tag===31){var m=nh();m=Oo(m);var y=J1(h,m);y!==null&&su(y,h,m),_Y(h,m)}}var pN=!0;function sQe(h,m,y,w){var $=Z.T;Z.T=null;var C=K.p;try{K.p=2,bY(h,m,y,w)}finally{K.p=C,Z.T=$}}function nQe(h,m,y,w){var $=Z.T;Z.T=null;var C=K.p;try{K.p=8,bY(h,m,y,w)}finally{K.p=C,Z.T=$}}function bY(h,m,y,w){if(pN){var $=wY(w);if($===null)aY(h,m,w,fN,y),c0e(h,w);else if(oQe($,h,m,y,w))w.stopPropagation();else if(c0e(h,w),m&4&&-1<aQe.indexOf(h)){for(;$!==null;){var C=el($);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var k=Ds(C.pendingLanes);if(k!==0){var V=C;for(V.pendingLanes|=2,V.entangledLanes|=2;k;){var te=1<<31-Jt(k);V.entanglements[1]|=te,k&=~te}Am(C),(Qr&6)===0&&(Jz=ht()+500,$R(0))}}break;case 31:case 13:V=J1(C,2),V!==null&&su(V,C,2),Xz(),_Y(C,2)}if(C=wY(w),C===null&&aY(h,m,w,fN,y),C===$)break;$=C}$!==null&&w.stopPropagation()}else aY(h,m,w,null,y)}}function wY(h){return h=SW(h),xY(h)}var fN=null;function xY(h){if(fN=null,h=ac(h),h!==null){var m=n(h);if(m===null)h=null;else{var y=m.tag;if(y===13){if(h=a(m),h!==null)return h;h=null}else if(y===31){if(h=o(m),h!==null)return h;h=null}else if(y===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;h=null}else m!==h&&(h=null)}}return fN=h,null}function l0e(h){switch(h){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ri()){case Wi:return 2;case zi:return 8;case ci:case or:return 32;case tr:return 268435456;default:return 32}default:return 32}}var SY=!1,R_=null,I_=null,D_=null,RR=new Map,IR=new Map,k_=[],aQe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function c0e(h,m){switch(h){case"focusin":case"focusout":R_=null;break;case"dragenter":case"dragleave":I_=null;break;case"mouseover":case"mouseout":D_=null;break;case"pointerover":case"pointerout":RR.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":IR.delete(m.pointerId)}}function DR(h,m,y,w,$,C){return h===null||h.nativeEvent!==C?(h={blockedOn:m,domEventName:y,eventSystemFlags:w,nativeEvent:C,targetContainers:[$]},m!==null&&(m=el(m),m!==null&&a0e(m)),h):(h.eventSystemFlags|=w,m=h.targetContainers,$!==null&&m.indexOf($)===-1&&m.push($),h)}function oQe(h,m,y,w,$){switch(m){case"focusin":return R_=DR(R_,h,m,y,w,$),!0;case"dragenter":return I_=DR(I_,h,m,y,w,$),!0;case"mouseover":return D_=DR(D_,h,m,y,w,$),!0;case"pointerover":var C=$.pointerId;return RR.set(C,DR(RR.get(C)||null,h,m,y,w,$)),!0;case"gotpointercapture":return C=$.pointerId,IR.set(C,DR(IR.get(C)||null,h,m,y,w,$)),!0}return!1}function u0e(h){var m=ac(h.target);if(m!==null){var y=n(m);if(y!==null){if(m=y.tag,m===13){if(m=a(y),m!==null){h.blockedOn=m,Ia(h.priority,function(){o0e(y)});return}}else if(m===31){if(m=o(y),m!==null){h.blockedOn=m,Ia(h.priority,function(){o0e(y)});return}}else if(m===3&&y.stateNode.current.memoizedState.isDehydrated){h.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}h.blockedOn=null}function mN(h){if(h.blockedOn!==null)return!1;for(var m=h.targetContainers;0<m.length;){var y=wY(h.nativeEvent);if(y===null){y=h.nativeEvent;var w=new y.constructor(y.type,y);xW=w,y.target.dispatchEvent(w),xW=null}else return m=el(y),m!==null&&a0e(m),h.blockedOn=y,!1;m.shift()}return!0}function h0e(h,m,y){mN(h)&&y.delete(m)}function lQe(){SY=!1,R_!==null&&mN(R_)&&(R_=null),I_!==null&&mN(I_)&&(I_=null),D_!==null&&mN(D_)&&(D_=null),RR.forEach(h0e),IR.forEach(h0e)}function gN(h,m){h.blockedOn===m&&(h.blockedOn=null,SY||(SY=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,lQe)))}var yN=null;function d0e(h){yN!==h&&(yN=h,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){yN===h&&(yN=null);for(var m=0;m<h.length;m+=3){var y=h[m],w=h[m+1],$=h[m+2];if(typeof w!="function"){if(xY(w||y)===null)continue;break}var C=el(y);C!==null&&(h.splice(m,3),m-=3,wZ(C,{pending:!0,data:$,method:y.method,action:w},w,$))}}))}function yC(h){function m(te){return gN(te,h)}R_!==null&&gN(R_,h),I_!==null&&gN(I_,h),D_!==null&&gN(D_,h),RR.forEach(m),IR.forEach(m);for(var y=0;y<k_.length;y++){var w=k_[y];w.blockedOn===h&&(w.blockedOn=null)}for(;0<k_.length&&(y=k_[0],y.blockedOn===null);)u0e(y),y.blockedOn===null&&k_.shift();if(y=(h.ownerDocument||h).$$reactFormReplay,y!=null)for(w=0;w<y.length;w+=3){var $=y[w],C=y[w+1],k=$[ao]||null;if(typeof C=="function")k||d0e(y);else if(k){var V=null;if(C&&C.hasAttribute("formAction")){if($=C,k=C[ao]||null)V=k.formAction;else if(xY($)!==null)continue}else V=k.action;typeof V=="function"?y[w+1]=V:(y.splice(w,3),w-=3),d0e(y)}}}function p0e(){function h(C){C.canIntercept&&C.info==="react-transition"&&C.intercept({handler:function(){return new Promise(function(k){return $=k})},focusReset:"manual",scroll:"manual"})}function m(){$!==null&&($(),$=null),w||setTimeout(y,20)}function y(){if(!w&&!navigation.transition){var C=navigation.currentEntry;C&&C.url!=null&&navigation.navigate(C.url,{state:C.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var w=!1,$=null;return navigation.addEventListener("navigate",h),navigation.addEventListener("navigatesuccess",m),navigation.addEventListener("navigateerror",m),setTimeout(y,100),function(){w=!0,navigation.removeEventListener("navigate",h),navigation.removeEventListener("navigatesuccess",m),navigation.removeEventListener("navigateerror",m),$!==null&&($(),$=null)}}}function TY(h){this._internalRoot=h}vN.prototype.render=TY.prototype.render=function(h){var m=this._internalRoot;if(m===null)throw Error(r(409));var y=m.current,w=nh();s0e(y,w,h,m,null,null)},vN.prototype.unmount=TY.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var m=h.containerInfo;s0e(h.current,2,null,h,null,null),Xz(),m[kp]=null}};function vN(h){this._internalRoot=h}vN.prototype.unstable_scheduleHydration=function(h){if(h){var m=gr();h={blockedOn:null,target:h,priority:m};for(var y=0;y<k_.length&&m!==0&&m<k_[y].priority;y++);k_.splice(y,0,h),y===0&&u0e(h)}};var f0e=e.version;if(f0e!=="19.2.3")throw Error(r(527,f0e,"19.2.3"));K.findDOMNode=function(h){var m=h._reactInternals;if(m===void 0)throw typeof h.render=="function"?Error(r(188)):(h=Object.keys(h).join(","),Error(r(268,h)));return h=u(m),h=h!==null?d(h):null,h=h===null?null:h.stateNode,h};var cQe={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Z,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _N=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_N.isDisabled&&_N.supportsFiber)try{ui=_N.inject(cQe),Ot=_N}catch{}}return FR.createRoot=function(h,m){if(!s(h))throw Error(r(299));var y=!1,w="",$=wye,C=xye,k=Sye;return m!=null&&(m.unstable_strictMode===!0&&(y=!0),m.identifierPrefix!==void 0&&(w=m.identifierPrefix),m.onUncaughtError!==void 0&&($=m.onUncaughtError),m.onCaughtError!==void 0&&(C=m.onCaughtError),m.onRecoverableError!==void 0&&(k=m.onRecoverableError)),m=i0e(h,1,!1,null,null,y,w,null,$,C,k,p0e),h[kp]=m.current,nY(h),new TY(m)},FR.hydrateRoot=function(h,m,y){if(!s(h))throw Error(r(299));var w=!1,$="",C=wye,k=xye,V=Sye,te=null;return y!=null&&(y.unstable_strictMode===!0&&(w=!0),y.identifierPrefix!==void 0&&($=y.identifierPrefix),y.onUncaughtError!==void 0&&(C=y.onUncaughtError),y.onCaughtError!==void 0&&(k=y.onCaughtError),y.onRecoverableError!==void 0&&(V=y.onRecoverableError),y.formState!==void 0&&(te=y.formState)),m=i0e(h,1,!0,m,y??null,w,$,te,C,k,V,p0e),m.context=r0e(null),y=m.current,w=nh(),w=Oo(w),$=b_(w),$.callback=null,w_(y,$,w),y=w,m.current.lanes=y,ai(m,y),Am(m),h[kp]=m.current,nY(h),new vN(m)},FR.version="19.2.3",FR}var C0e;function xQe(){if(C0e)return EY.exports;C0e=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),EY.exports=wQe(),EY.exports}var SQe=xQe();const Pn=(t,e,...i)=>{try{return t?.call(e,...i)}catch(r){console.error(r,t)}},_ee=async(t,e,...i)=>{try{return await t?.call(e,...i)}catch(r){console.error(r,t)}},ile=Symbol.for("controller"),TQe=t=>typeof t=="object"&&t!==null&&(ile in t||"hostConnected"in t||"hostDisconnected"in t||"hostUpdate"in t||"hostUpdated"in t),$Qe=t=>typeof t?.then=="function",CQe=t=>t.M.length;let oD;const eE=t=>{oD!==t&&(oD=t,queueMicrotask(()=>oD===t?oD=void 0:0))},nP=t=>oD;let qx=[];const WAe=t=>{if(t===void 0){qx=[];return}const e=qx.indexOf(t);qx=e===-1?[...qx,t]:qx.slice(0,e+1),queueMicrotask(()=>qx=[])},ZAe=()=>qx;let tE;const MQe=t=>{tE!==t&&(tE=t,queueMicrotask(()=>tE===t?tE=void 0:0))},EQe=()=>{const t=tE;return tE=void 0,t},AQe=async(t,e)=>{const i=rle(t);if(i===void 0)return t;if(await i.ready,typeof e=="function"){const r=i.watchExports(s=>e(s,r))}return i.exports},OQe=async t=>{const e=rle(t);return await e.ready,e},rle=t=>{const i=nP().manager.X(t);if(i!==void 0)return i;if(TQe(t))return t;const r=EQe();if(r!==void 0)return r};let bee=!1;const PQe=t=>{bee=!0;try{return t()}finally{bee=!1}};const k6=globalThis,sle=k6.ShadowRoot&&(k6.ShadyCSS===void 0||k6.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,nle=Symbol(),M0e=new WeakMap;let YAe=class{constructor(e,i,r){if(this._$cssResult$=!0,r!==nle)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=i}get styleSheet(){let e=this.o;const i=this.t;if(sle&&e===void 0){const r=i!==void 0&&i.length===1;r&&(e=M0e.get(i)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&M0e.set(i,e))}return e}toString(){return this.cssText}};const RQe=t=>new YAe(typeof t=="string"?t:t+"",void 0,nle),Sl=(t,...e)=>{const i=t.length===1?t[0]:e.reduce((r,s,n)=>r+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[n+1],t[0]);return new YAe(i,t,nle)},IQe=(t,e)=>{if(sle)t.adoptedStyleSheets=e.map(i=>i instanceof CSSStyleSheet?i:i.styleSheet);else for(const i of e){const r=document.createElement("style"),s=k6.litNonce;s!==void 0&&r.setAttribute("nonce",s),r.textContent=i.cssText,t.appendChild(r)}},E0e=sle?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let i="";for(const r of e.cssRules)i+=r.cssText;return RQe(i)})(t):t;const{is:DQe,defineProperty:kQe,getOwnPropertyDescriptor:LQe,getOwnPropertyNames:FQe,getOwnPropertySymbols:zQe,getPrototypeOf:NQe}=Object,I9=globalThis,A0e=I9.trustedTypes,VQe=A0e?A0e.emptyScript:"",jQe=I9.reactiveElementPolyfillSupport,c4=(t,e)=>t,wee={toAttribute(t,e){switch(e){case Boolean:t=t?VQe:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=t!==null;break;case Number:i=t===null?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch{i=null}}return i}},ale=(t,e)=>!DQe(t,e),O0e={attribute:!0,type:String,converter:wee,reflect:!1,useDefault:!1,hasChanged:ale};Symbol.metadata??=Symbol("metadata"),I9.litPropertyMetadata??=new WeakMap;let $M=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,i=O0e){if(i.state&&(i.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((i=Object.create(i)).wrapped=!0),this.elementProperties.set(e,i),!i.noAccessor){const r=Symbol(),s=this.getPropertyDescriptor(e,r,i);s!==void 0&&kQe(this.prototype,e,s)}}static getPropertyDescriptor(e,i,r){const{get:s,set:n}=LQe(this.prototype,e)??{get(){return this[i]},set(a){this[i]=a}};return{get:s,set(a){const o=s?.call(this);n?.call(this,a),this.requestUpdate(e,o,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??O0e}static _$Ei(){if(this.hasOwnProperty(c4("elementProperties")))return;const e=NQe(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(c4("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(c4("properties"))){const i=this.properties,r=[...FQe(i),...zQe(i)];for(const s of r)this.createProperty(s,i[s])}const e=this[Symbol.metadata];if(e!==null){const i=litPropertyMetadata.get(e);if(i!==void 0)for(const[r,s]of i)this.elementProperties.set(r,s)}this._$Eh=new Map;for(const[i,r]of this.elementProperties){const s=this._$Eu(i,r);s!==void 0&&this._$Eh.set(s,i)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const i=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const s of r)i.unshift(E0e(s))}else e!==void 0&&i.push(E0e(e));return i}static _$Eu(e,i){const r=i.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,i=this.constructor.elementProperties;for(const r of i.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return IQe(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,i,r){this._$AK(e,r)}_$ET(e,i){const r=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,r);if(s!==void 0&&r.reflect===!0){const n=(r.converter?.toAttribute!==void 0?r.converter:wee).toAttribute(i,r.type);this._$Em=e,n==null?this.removeAttribute(s):this.setAttribute(s,n),this._$Em=null}}_$AK(e,i){const r=this.constructor,s=r._$Eh.get(e);if(s!==void 0&&this._$Em!==s){const n=r.getPropertyOptions(s),a=typeof n.converter=="function"?{fromAttribute:n.converter}:n.converter?.fromAttribute!==void 0?n.converter:wee;this._$Em=s;const o=a.fromAttribute(i,n.type);this[s]=o??this._$Ej?.get(s)??o,this._$Em=null}}requestUpdate(e,i,r,s=!1,n){if(e!==void 0){const a=this.constructor;if(s===!1&&(n=this[e]),r??=a.getPropertyOptions(e),!((r.hasChanged??ale)(n,i)||r.useDefault&&r.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(a._$Eu(e,r))))return;this.C(e,i,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,i,{useDefault:r,reflect:s,wrapped:n},a){r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??i??this[e]),n!==!0||a!==void 0)||(this._$AL.has(e)||(this.hasUpdated||r||(i=void 0),this._$AL.set(e,i)),s===!0&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(i){Promise.reject(i)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[s,n]of this._$Ep)this[s]=n;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[s,n]of r){const{wrapped:a}=n,o=this[s];a!==!0||this._$AL.has(s)||o===void 0||this.C(s,void 0,n,o)}}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),this._$EO?.forEach(r=>r.hostUpdate?.()),this.update(i)):this._$EM()}catch(r){throw e=!1,this._$EM(),r}e&&this._$AE(i)}willUpdate(e){}_$AE(e){this._$EO?.forEach(i=>i.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(i=>this._$ET(i,this[i])),this._$EM()}updated(e){}firstUpdated(e){}};$M.elementStyles=[],$M.shadowRootOptions={mode:"open"},$M[c4("elementProperties")]=new Map,$M[c4("finalized")]=new Map,jQe?.({ReactiveElement:$M}),(I9.reactiveElementVersions??=[]).push("2.1.2");const ole=globalThis,P0e=t=>t,L8=ole.trustedTypes,R0e=L8?L8.createPolicy("lit-html",{createHTML:t=>t}):void 0,JAe="$lit$",tw=`lit$${Math.random().toFixed(9).slice(2)}$`,QAe="?"+tw,UQe=`<${QAe}>`,BT=document,m5=()=>BT.createComment(""),g5=t=>t===null||typeof t!="object"&&typeof t!="function",lle=Array.isArray,BQe=t=>lle(t)||typeof t?.[Symbol.iterator]=="function",RY=`[ 	
\f\r]`,zR=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,I0e=/-->/g,D0e=/>/g,cx=RegExp(`>|${RY}(?:([^\\s"'>=/]+)(${RY}*=${RY}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),k0e=/'/g,L0e=/"/g,XAe=/^(?:script|style|textarea|title)$/i,KAe=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),ni=KAe(1),xee=KAe(2),M0=Symbol.for("lit-noChange"),sr=Symbol.for("lit-nothing"),F0e=new WeakMap,tS=BT.createTreeWalker(BT,129);function eOe(t,e){if(!lle(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return R0e!==void 0?R0e.createHTML(e):e}const qQe=(t,e)=>{const i=t.length-1,r=[];let s,n=e===2?"<svg>":e===3?"<math>":"",a=zR;for(let o=0;o<i;o++){const l=t[o];let u,d,f=-1,g=0;for(;g<l.length&&(a.lastIndex=g,d=a.exec(l),d!==null);)g=a.lastIndex,a===zR?d[1]==="!--"?a=I0e:d[1]!==void 0?a=D0e:d[2]!==void 0?(XAe.test(d[2])&&(s=RegExp("</"+d[2],"g")),a=cx):d[3]!==void 0&&(a=cx):a===cx?d[0]===">"?(a=s??zR,f=-1):d[1]===void 0?f=-2:(f=a.lastIndex-d[2].length,u=d[1],a=d[3]===void 0?cx:d[3]==='"'?L0e:k0e):a===L0e||a===k0e?a=cx:a===I0e||a===D0e?a=zR:(a=cx,s=void 0);const v=a===cx&&t[o+1].startsWith("/>")?" ":"";n+=a===zR?l+UQe:f>=0?(r.push(u),l.slice(0,f)+JAe+l.slice(f)+tw+v):l+tw+(f===-2?o:v)}return[eOe(t,n+(t[i]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]};let See=class tOe{constructor({strings:e,_$litType$:i},r){let s;this.parts=[];let n=0,a=0;const o=e.length-1,l=this.parts,[u,d]=qQe(e,i);if(this.el=tOe.createElement(u,r),tS.currentNode=this.el.content,i===2||i===3){const f=this.el.content.firstChild;f.replaceWith(...f.childNodes)}for(;(s=tS.nextNode())!==null&&l.length<o;){if(s.nodeType===1){if(s.hasAttributes())for(const f of s.getAttributeNames())if(f.endsWith(JAe)){const g=d[a++],v=s.getAttribute(f).split(tw),_=/([.?@])?(.*)/.exec(g);l.push({type:1,index:n,name:_[2],strings:v,ctor:_[1]==="."?HQe:_[1]==="?"?WQe:_[1]==="@"?ZQe:k9}),s.removeAttribute(f)}else f.startsWith(tw)&&(l.push({type:6,index:n}),s.removeAttribute(f));if(XAe.test(s.tagName)){const f=s.textContent.split(tw),g=f.length-1;if(g>0){s.textContent=L8?L8.emptyScript:"";for(let v=0;v<g;v++)s.append(f[v],m5()),tS.nextNode(),l.push({type:2,index:++n});s.append(f[g],m5())}}}else if(s.nodeType===8)if(s.data===QAe)l.push({type:2,index:n});else{let f=-1;for(;(f=s.data.indexOf(tw,f+1))!==-1;)l.push({type:7,index:n}),f+=tw.length-1}n++}}static createElement(e,i){const r=BT.createElement("template");return r.innerHTML=e,r}};function nO(t,e,i=t,r){if(e===M0)return e;let s=r!==void 0?i._$Co?.[r]:i._$Cl;const n=g5(e)?void 0:e._$litDirective$;return s?.constructor!==n&&(s?._$AO?.(!1),n===void 0?s=void 0:(s=new n(t),s._$AT(t,i,r)),r!==void 0?(i._$Co??=[])[r]=s:i._$Cl=s),s!==void 0&&(e=nO(t,s._$AS(t,e.values),s,r)),e}let GQe=class{constructor(e,i){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:i},parts:r}=this._$AD,s=(e?.creationScope??BT).importNode(i,!0);tS.currentNode=s;let n=tS.nextNode(),a=0,o=0,l=r[0];for(;l!==void 0;){if(a===l.index){let u;l.type===2?u=new D9(n,n.nextSibling,this,e):l.type===1?u=new l.ctor(n,l.name,l.strings,this,e):l.type===6&&(u=new YQe(n,this,e)),this._$AV.push(u),l=r[++o]}a!==l?.index&&(n=tS.nextNode(),a++)}return tS.currentNode=BT,s}p(e){let i=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,i),i+=r.strings.length-2):r._$AI(e[i])),i++}},D9=class iOe{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,i,r,s){this.type=2,this._$AH=sr,this._$AN=void 0,this._$AA=e,this._$AB=i,this._$AM=r,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const i=this._$AM;return i!==void 0&&e?.nodeType===11&&(e=i.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,i=this){e=nO(this,e,i),g5(e)?e===sr||e==null||e===""?(this._$AH!==sr&&this._$AR(),this._$AH=sr):e!==this._$AH&&e!==M0&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):BQe(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==sr&&g5(this._$AH)?this._$AA.nextSibling.data=e:this.T(BT.createTextNode(e)),this._$AH=e}$(e){const{values:i,_$litType$:r}=e,s=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=See.createElement(eOe(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===s)this._$AH.p(i);else{const n=new GQe(s,this),a=n.u(this.options);n.p(i),this.T(a),this._$AH=n}}_$AC(e){let i=F0e.get(e.strings);return i===void 0&&F0e.set(e.strings,i=new See(e)),i}k(e){lle(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let r,s=0;for(const n of e)s===i.length?i.push(r=new iOe(this.O(m5()),this.O(m5()),this,this.options)):r=i[s],r._$AI(n),s++;s<i.length&&(this._$AR(r&&r._$AB.nextSibling,s),i.length=s)}_$AR(e=this._$AA.nextSibling,i){for(this._$AP?.(!1,!0,i);e!==this._$AB;){const r=P0e(e).nextSibling;P0e(e).remove(),e=r}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}},k9=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,i,r,s,n){this.type=1,this._$AH=sr,this._$AN=void 0,this.element=e,this.name=i,this._$AM=s,this.options=n,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=sr}_$AI(e,i=this,r,s){const n=this.strings;let a=!1;if(n===void 0)e=nO(this,e,i,0),a=!g5(e)||e!==this._$AH&&e!==M0,a&&(this._$AH=e);else{const o=e;let l,u;for(e=n[0],l=0;l<n.length-1;l++)u=nO(this,o[r+l],i,l),u===M0&&(u=this._$AH[l]),a||=!g5(u)||u!==this._$AH[l],u===sr?e=sr:e!==sr&&(e+=(u??"")+n[l+1]),this._$AH[l]=u}a&&!s&&this.j(e)}j(e){e===sr?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},HQe=class extends k9{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===sr?void 0:e}},WQe=class extends k9{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==sr)}},ZQe=class extends k9{constructor(e,i,r,s,n){super(e,i,r,s,n),this.type=5}_$AI(e,i=this){if((e=nO(this,e,i,0)??sr)===M0)return;const r=this._$AH,s=e===sr&&r!==sr||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,n=e!==sr&&(r===sr||s);s&&this.element.removeEventListener(this.name,this,r),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}},YQe=class{constructor(e,i,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=i,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){nO(this,e)}};const JQe={I:D9},QQe=ole.litHtmlPolyfillSupport;QQe?.(See,D9),(ole.litHtmlVersions??=[]).push("3.3.2");const XQe=(t,e,i)=>{const r=i?.renderBefore??e;let s=r._$litPart$;if(s===void 0){const n=i?.renderBefore??null;r._$litPart$=s=new D9(e.insertBefore(m5(),n),n,void 0,i??{})}return s._$AI(t),s};const cle=globalThis;let zE=class extends $M{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=XQe(i,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return M0}};zE._$litElement$=!0,zE.finalized=!0,cle.litElementHydrateSupport?.({LitElement:zE});const KQe=cle.litElementPolyfillSupport;KQe?.({LitElement:zE});(cle.litElementVersions??=[]).push("4.2.2");class y5{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}const eXe=(t,e)=>{const i=e/tXe;let r=0;const s=setInterval(()=>{r+=i,r>=e&&(clearInterval(s),t())},i);return s},tXe=4,iXe=(t,e,i)=>{const r=Object.keys(t),s=r.length;iE===void 0&&queueMicrotask(L9),iE??=new Map;let n=iE.get(t);return n===void 0&&(n={callbacks:[],keyCount:s},iE.set(t,n)),n.keyCount!==s&&(n.callbacks.forEach(a=>a(r)),n.callbacks=[],n.keyCount=s),n.callbacks.push(a=>{const o=u=>Pn(e,null,u),l=a[s];l===void 0?o(void 0):t[l]===i?o(l):o(void 0)}),i};let iE;const L9=()=>{iE?.forEach(({callbacks:t},e)=>{const i=Object.keys(e);t.forEach(r=>r(i))}),iE=void 0},ule=(t,e,i)=>{const r=t.manager;return r.V!==sr&&r.V!==i&&r.S(void 0,void 0),r.T.length===0&&queueMicrotask(()=>r.S(void 0,void 0)),r.V=i,r.T.push((s,n)=>Pn(e,void 0,i===n?s:void 0)),i},hle=(t=[nP(),...ZAe()],e,i)=>{const r=Array.isArray(t)?t:[t];let s=r.length+1;const n=a=>{s-=1,a!==void 0&&(s=Math.min(s,0)),s===0&&e(a)};r.forEach(a=>iXe(a,o=>n(o===void 0?void 0:{key:o,host:a,isReactive:!1}),i));for(const a of r)if("manager"in a&&a.manager.component===a){ule(a,o=>n(o===void 0?void 0:{key:o,host:a,isReactive:!0}),i);break}return i},dle=(t="",e={},i=nP())=>{const r={emit:s=>{t===""&&L9();const n=new CustomEvent(t,{detail:s,cancelable:!0,bubbles:!0,composed:!0,...e});return i.el.dispatchEvent(n),n}};return t===""&&hle(void 0,s=>t=s.key,r),r},$a=dle.bind(null,"");var rOe;rOe=ile;class ple{constructor(e){this.#e=[],this.#t=[],this.#i=[],this.#a=[],this.#o=[],this.#l=[],this.#h=[],this.#d=[],this.#c=[],this.#u=!1,this.P=new y5,this.connectedCalled=!1,this.loadedCalled=!1,this[rOe]=!0,this.#n=[];const i=this,r=e??nP();i.#r=r,i.ready=i.P.promise,i.#s=N0e(i),i.component=r,i.#r.addController(i),i.#r.manager===void 0||(WAe(i),queueMicrotask(()=>i.catchUpLifecycle()))}#e;#t;#i;#a;#o;#l;#h;#d;#c;#u;#r;catchUpLifecycle(){const{manager:e}=this.#r;e.connectedCalled&&!this.connectedCalled&&this.triggerConnected(),e.#u&&this.triggerLoad().then(()=>e.loadedCalled&&this.triggerLoaded()).catch(console.error)}#s;get exports(){return this.#s}set exports(e){const i=this.#s;i!==e&&(this.#s=e,this.#n.forEach(Pn),this.connectedCalled&&this.O!==!1&&this.#r.requestUpdate(this.O,i)),this.P.resolve(e)}setProvisionalExports(e,i=!0){this.#s=i?N0e(e):e,this.#n.forEach(Pn)}#n;watchExports(e){const i=()=>e(this.#s);return this.#n.push(i),()=>{this.#n.splice(this.#n.indexOf(i),1)}}get use(){return eE(this.#r),AQe}get useRef(){return eE(this.#r),OQe}get useRefSync(){return eE(this.#r),rle}controllerRemoved(){this.#r.el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(e){this.#e.push(e)}onDisconnected(e){this.#t.push(e)}onLoad(e){this.#i.push(e)}onLoaded(e){this.#a.push(e)}onUpdate(e){this.#o.push(e)}onUpdated(e){this.#l.push(e)}onDestroy(e){this.#h.push(e)}onLifecycle(e){this.#d.push(e),this.connectedCalled&&this.#r.el.isConnected&&this.#p(e)}triggerConnected(){const e=this;e.hostConnected&&Pn(e.hostConnected,e),e.#e.forEach(Pn),e.triggerLifecycle(),e.connectedCalled=!0}triggerDisconnected(){const e=this;e.hostDisconnected&&Pn(e.hostDisconnected,e),e.#t.forEach(Pn),e.#c.forEach(Pn),e.#c=[]}async triggerLoad(){if(this.#u)return;this.#u=!0;const e=this;e.hostLoad&&await _ee(e.hostLoad,e),this.#i.length>0&&await Promise.allSettled(this.#i.map(_ee)),this.P.resolve(this.#s)}triggerLoaded(){this.loadedCalled||(this.hostLoaded&&Pn(this.hostLoaded,this),this.#a.forEach(Pn),this.loadedCalled=!0)}triggerUpdate(e){this.hostUpdate&&Pn(this.hostUpdate,this,e),this.#o.forEach(z0e,e)}triggerUpdated(e){this.hostUpdated&&Pn(this.hostUpdated,this,e),this.#l.forEach(z0e,e)}triggerDestroy(){this.hostDestroy&&Pn(this.hostDestroy,this),this.#h.forEach(Pn)}triggerLifecycle(){this.hostLifecycle&&this.#p(()=>this.hostLifecycle()),this.#d.forEach(this.#p,this)}#p(e){eE(this.#r);const i=Pn(e);(Array.isArray(i)?i:[i]).forEach(s=>{typeof s=="function"?this.#c.push(s):typeof s=="object"&&typeof s.remove=="function"&&this.#c.push(s.remove)})}}function z0e(t){Pn(t,void 0,this)}const F9=ple,N0e=t=>{if(typeof t!="object"&&typeof t!="function"||t===null)return t;const e={get(r,s,n){if(!((s==="exports"||s==="_exports")&&s in r&&r[s]===i)&&(s in r||s in Promise.prototype||typeof s=="symbol"))return typeof r=="function"?r[s]:Reflect.get(r,s,n)}},i=new Proxy(t,e);return i},rXe=t=>t.replace(sXe,(e,i)=>`${i===0?"":"-"}${e.toLowerCase()}`),sXe=/[A-Z]+(?![a-z])|[A-Z]/gu,nXe=1,aXe=2,oXe=4,lXe=8,cXe=16,uXe=32,hXe=64,sOe=t=>{let e=t;for(;e=e.parentNode??e.host;)if(e?.constructor?.lumina){const i=e;return i.manager?.loadedCalled||(i.J??i._offspring).push(t),(i.I??i._postLoad).promise}return!1},V0e={};function nOe(){}const L6=Object.defineProperty,dXe=globalThis.HTMLElement??nOe;var xu,i0,yA,PL,Tee;const Rme=class Rme extends dXe{constructor(){var s;super();Up(this,PL);Up(this,xu);Up(this,i0);Up(this,yA);Bp(this,i0,{}),Bp(this,yA,[]),this.I=new y5,this.H=new y5,this.J=[];const i=this,r=i.constructor;i._offspring=i.J,i._postLoad=i.I,r.C?.forEach(n=>{Object.hasOwn(i,n)&&(ns(i,i0)[n]=i[n],delete i[n])}),r.A?kR(s=i,PL,Tee).call(s,{a:r.A}):r.B.then(async n=>{var a;await r.K.p,kR(a=i,PL,Tee).call(a,await(n.default?.then(o=>typeof o=="function"?{a:o}:o)??n))}).catch(n=>{i.H.reject(n),setTimeout(()=>{throw n})})}static F(){for(const i of this.C??[])L6(this.prototype,i,{configurable:!0,enumerable:!0,get(){return ns(this,i0)[i]},set(r){ns(this,i0)[i]=r}});for(const i of this.E??[])L6(this.prototype,i,{async value(...r){return ns(this,xu)||await this.H.promise,await ns(this,xu)[i](...r)},configurable:!0});for(const i of this.D??[])L6(this.prototype,i,{value(...r){return ns(this,xu)[i](...r)},configurable:!0})}get manager(){return ns(this,xu)?.manager}attributeChangedCallback(i,r,s){ns(this,xu)?.attributeChangedCallback(i,r,s),ns(this,xu)||ns(this,yA).push(i)}connectedCallback(){ns(this,xu)?ns(this,xu).connectedCallback?.():queueMicrotask(()=>this.G=sOe(this))}disconnectedCallback(){ns(this,xu)?.disconnectedCallback?.()}async componentOnReady(){return await this.H.promise,this}addController(){}requestUpdate(){ns(this,xu)?.requestUpdate()}};xu=new WeakMap,i0=new WeakMap,yA=new WeakMap,PL=new WeakSet,Tee=function(i){const r=this.constructor,s=r.L,n=ns(this,i0),a=Object.values(i).find(g=>g.L===s),o=`${s}--lazy`;let l=a;for(;l&&!Object.hasOwn(l,"lumina");)l=Object.getPrototypeOf(l);fXe(l),!r.A&&(r.A=a,customElements.define(o,a)),a.N=this;const d=document.createElement(o);a.N=void 0,Bp(this,xu,d),Bp(this,i0,d),ns(this,yA).forEach(g=>d.attributeChangedCallback(g,null,this.getAttribute(g))),Object.entries(n).forEach(pXe,d);const f=this.isConnected;(f||this.G)&&(d.connectedCallback?.(),f||d.disconnectedCallback())},Rme.lumina=!0;let j0e=Rme;function pXe([t,e]){this[t]=e}const fXe=t=>{const e=t.prototype,i=Element.prototype;Object.hasOwn(e,"isConnected")||(e.setAttribute=function(s,n){i.setAttribute.call(this.el,s,n)},e.removeAttribute=function(s){i.removeAttribute.call(this.el,s)},L6(e,"isConnected",{get(){return Reflect.get(i,"isConnected",this.el)}}))};const z9={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},DL=t=>(...e)=>({_$litDirective$:t,values:e});let kL=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,i,r){this._$Ct=e,this._$AM=i,this._$Ci=r}_$AS(e,i){return this.update(e,i)}update(e,i){return this.render(...i)}};const mXe=DL(class extends kL{constructor(t){if(super(t),t.type!==z9.ATTRIBUTE||t.name!=="class"||t.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(e=>t[e]).join(" ")+" "}update(t,[e]){if(this.st===void 0){this.st=new Set,t.strings!==void 0&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter(r=>r!=="")));for(const r in e)e[r]&&!this.nt?.has(r)&&this.st.add(r);return this.render(e)}const i=t.element.classList;for(const r of this.st)r in e||(i.remove(r),this.st.delete(r));for(const r in e){const s=!!e[r];s===this.st.has(r)||this.nt?.has(r)||(s?(i.add(r),this.st.add(r)):(i.remove(r),this.st.delete(r)))}return M0}});const aOe="important",gXe=" !"+aOe,yXe=DL(class extends kL{constructor(t){if(super(t),t.type!==z9.ATTRIBUTE||t.name!=="style"||t.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,i)=>{const r=t[i];return r==null?e:e+`${i=i.includes("-")?i:i.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`},"")}update(t,[e]){const{style:i}=t.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const r of this.ft)e[r]==null&&(this.ft.delete(r),r.includes("-")?i.removeProperty(r):i[r]=null);for(const r in e){const s=e[r];if(s!=null){this.ft.add(r);const n=typeof s=="string"&&s.endsWith(gXe);r.includes("-")||n?i.setProperty(r,n?s.slice(0,-11):s,n?aOe:""):i[r]=s}}return M0}});const{I:vXe}=JQe,U0e=t=>t,_Xe=t=>t.strings===void 0,B0e=()=>document.createComment(""),NR=(t,e,i)=>{const r=t._$AA.parentNode,s=e===void 0?t._$AB:e._$AA;if(i===void 0){const n=r.insertBefore(B0e(),s),a=r.insertBefore(B0e(),s);i=new vXe(n,a,t,t.options)}else{const n=i._$AB.nextSibling,a=i._$AM,o=a!==t;if(o){let l;i._$AQ?.(t),i._$AM=t,i._$AP!==void 0&&(l=t._$AU)!==a._$AU&&i._$AP(l)}if(n!==s||o){let l=i._$AA;for(;l!==n;){const u=U0e(l).nextSibling;U0e(r).insertBefore(l,s),l=u}}}return i},ux=(t,e,i=t)=>(t._$AI(e,i),t),bXe={},oOe=(t,e=bXe)=>t._$AH=e,wXe=t=>t._$AH,IY=t=>{t._$AR(),t._$AA.remove()};const u4=(t,e)=>{const i=t._$AN;if(i===void 0)return!1;for(const r of i)r._$AO?.(e,!1),u4(r,e);return!0},F8=t=>{let e,i;do{if((e=t._$AM)===void 0)break;i=e._$AN,i.delete(t),t=e}while(i?.size===0)},lOe=t=>{for(let e;e=t._$AM;t=e){let i=e._$AN;if(i===void 0)e._$AN=i=new Set;else if(i.has(t))break;i.add(t),TXe(e)}};function xXe(t){this._$AN!==void 0?(F8(this),this._$AM=t,lOe(this)):this._$AM=t}function SXe(t,e=!1,i=0){const r=this._$AH,s=this._$AN;if(s!==void 0&&s.size!==0)if(e)if(Array.isArray(r))for(let n=i;n<r.length;n++)u4(r[n],!1),F8(r[n]);else r!=null&&(u4(r,!1),F8(r));else u4(this,t)}const TXe=t=>{t.type==z9.CHILD&&(t._$AP??=SXe,t._$AQ??=xXe)};let $Xe=class extends kL{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,i,r){super._$AT(e,i,r),lOe(this),this.isConnected=e._$AU}_$AO(e,i=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),i&&(u4(this,e),F8(this))}setValue(e){if(_Xe(this._$Ct))this._$Ct._$AI(e,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=e,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}};const Jw=()=>new CXe;let CXe=class{};const DY=new WeakMap,_p=DL(class extends $Xe{render(t){return sr}update(t,[e]){const i=e!==this.G;return i&&this.G!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=e,this.ht=t.options?.host,this.rt(this.ct=t.element)),sr}rt(t){if(this.isConnected||(t=void 0),typeof this.G=="function"){const e=this.ht??globalThis;let i=DY.get(e);i===void 0&&(i=new WeakMap,DY.set(e,i)),i.get(this.G)!==void 0&&this.G.call(this.ht,void 0),i.set(this.G,t),t!==void 0&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){return typeof this.G=="function"?DY.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});class MXe extends F9{constructor(e){super(e),this.destroyed=!1,this.R=!1,this.V=sr,this.T=[],this.#i=new WeakMap,this.#t=e,this.exports=void 0,this.hasDestroy=$ee in e&&typeof e.destroy=="function",zE.prototype.addController.call(e,{hostConnected:()=>{if(this.destroyed){const i=e.el.localName;throw e.el.remove(),new Error(`The ${i} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${$ee} prop.`)}this.#e!==void 0&&clearTimeout(this.#e),L9();for(const i of e.M)"triggerConnected"in i?i.triggerConnected():Pn(i.hostConnected,i)},hostDisconnected:()=>{for(const i of e.M)"triggerDisconnected"in i?i.triggerDisconnected():Pn(i.hostDisconnected,i);this.hasDestroy&&!this.destroyed&&this.U()},hostUpdate:()=>{for(const i of e.M)"triggerUpdate"in i?i.triggerUpdate(this.Q):Pn(i.hostUpdate,i,this.Q)},hostUpdated:()=>{for(const i of e.M)"triggerUpdated"in i?i.triggerUpdated(this.Q):Pn(i.hostUpdated,i,this.Q);this.Q=void 0}}),queueMicrotask(()=>this.R=!0),eE(e)}#e;#t;async destroy(){if(!this.destroyed){this.#t.el.isConnected&&(this.hasDestroy=!1,this.#t.el.remove()),this.#e=void 0,this.destroyed=!0;for(const e of this.#t.M)"triggerDestroy"in e?e.triggerDestroy():Pn(e.hostDestroy,e);this.#t.M.splice(0)}}U(){if(this.#e!==void 0&&clearTimeout(this.#e),!this.#t.el.isConnected&&!this.#t.autoDestroyDisabled){const e=()=>{this.#t.destroy()};this.#e=eXe(e,EXe)}}S(e,i){const r=this.T;this.V=sr,this.T=[],r.forEach(s=>s(e,i))}#i;W(e,i){(typeof i=="object"&&i!==null||typeof i=="function")&&this.#i.set(i,e)}X(e){if(typeof e=="object"&&e!==null||typeof e=="function")return this.#i.get(e)}}let EXe=1e3;const $ee="autoDestroyDisabled";var wS,RL,IL,xS,Tg,sP,cOe,uOe;const f5=class f5 extends zE{constructor(){super();Up(this,sP);Up(this,wS);Up(this,RL);Up(this,IL);Up(this,xS);Up(this,Tg);this.M=[],this.manager=new MXe(this);const i=this,r=i.constructor,s=r.N,n=r.K.o,a=f5.prototype.shouldUpdate;Bp(i,xS,s?.H??new y5),i.I=s?.I??new y5,i.J=s?.J??[],i._offspring=i.J,i._postLoad=i.I,i.el=s??i,Bp(i,IL,i.enableUpdating),i.enableUpdating=nOe,i.shouldUpdate!==a&&(Bp(i,RL,i.shouldUpdate),i.shouldUpdate=a),n&&(Bp(i,wS,new Map),r.elementProperties.forEach((o,l)=>ns(i,wS).set(l,n())))}static finalizeStyles(i){const r=super.finalizeStyles(i),s=this.shadowRootOptions===V0e;return this.K?.commonStyles===void 0||s?r:[this.K.commonStyles,...r]}static createProperty(i,r){const s=typeof r=="number"?r:Array.isArray(r)?r[0]:0,n=Array.isArray(r)?r[1]:void 0,a=n?.hasChanged??ale,o={attribute:s&nXe&&typeof i=="string"?rXe(i):!1,reflect:!!(s&aXe),type:s&oXe?Boolean:s&lXe?Number:void 0,state:!!(s&cXe),readOnly:!!(s&uXe),noAccessor:!!(s&hXe),c:!1,...n,hasChanged(l,u){const d=a(l,u);return o.c=d,d}};super.createProperty(i,o)}static getPropertyDescriptor(i,r,s){const n=this.K,a=super.getPropertyDescriptor(i,r,s);return s.d=a,{...a,get(){return n.t?.(ns(this,wS).get(i)),a.get?.call(this)},set(o){const l=this.manager;if(s.readOnly&&!bee&&(l.R||l.connectedCalled))throw Error(`Cannot assign to read-only property "${i}" of ${this.el.localName}. Trying to assign "${o}"`);a.set.call(this,o??void 0),s.c&&ns(this,wS)?.get(i)?.notify(),l.T.length>0&&(L9(),l?.S(i,o))}}}connectedCallback(){if(this.el.hasAttribute("defer-hydration"))return;const i=this.constructor.K.c?.(()=>this.requestUpdate());Bp(this,Tg,i);const r=!this.manager.connectedCalled;super.connectedCallback(),r?queueMicrotask(()=>kR(this,sP,uOe).call(this).catch(s=>{ns(this,xS).reject(s),setTimeout(()=>{throw s})})):i&&this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),ns(this,Tg)?.destroy(),Bp(this,Tg,void 0)}createRenderRoot(){const i=this.el.shadowRoot,r=this.constructor,s=r.shadowRootOptions,a=i??(s===V0e?this.el:this.el.attachShadow(s));if(this.isConnected){const o=a.getRootNode();o.adoptedStyleSheets=[...o.adoptedStyleSheets,...r.elementStyles.map(l=>"styleSheet"in l?l.styleSheet:l)]}return a}shouldUpdate(i){var r;return this.manager.Q=i,((r=ns(this,RL))==null?void 0:r.call(this,i))??!0}update(i){ns(this,Tg)?kR(this,sP,cOe).call(this,i):super.update(i)}listen(i,r,s){const n=r?.bind(this)??r;this.manager.onLifecycle(()=>(this.el.addEventListener(i,n,s),()=>this.el.removeEventListener(i,n,s)))}listenOn(i,r,s,n){const a=s?.bind(this)??s;this.manager.onLifecycle(()=>(i.addEventListener(r,a,n),()=>i.removeEventListener(r,a,n)))}async componentOnReady(){return await ns(this,xS).promise,this}addController(i){this.M.push(i),!(ile in i)&&this.renderRoot&&this.el.isConnected&&i.hostConnected?.()}removeController(i){this.M.splice(this.M.indexOf(i),1),i.controllerRemoved?.()}};wS=new WeakMap,RL=new WeakMap,IL=new WeakMap,xS=new WeakMap,Tg=new WeakMap,sP=new WeakSet,cOe=function(i){try{ns(this,Tg).clear(),this.constructor.K.r(ns(this,Tg),()=>g0e(f5.prototype,this,"update").call(this,i))}catch(r){throw ns(this,Tg).clear(),r}},uOe=async function(){const i=this.el.G??sOe(this.el);i&&await i;const r=[];for(const n of this.M)"triggerLoad"in n?r.push(n.triggerLoad()):r.push(_ee(n.hostLoad,n));await Promise.all(r),await this.load?.(),this.manager.hasDestroy&&this.manager.onUpdate(n=>n.has($ee)&&this.manager.U()),ns(this,IL).call(this,!0),this.performUpdate(),this.I.resolve(),await Promise.resolve();const s=this.J.filter(n=>!n.manager?.loadedCalled);s.length&&await Promise.allSettled(s.map(async n=>await n.componentOnReady())),this.J.length=0,this.el.setAttribute(this.constructor.K.hydratedAttribute,"");for(const n of this.M)"triggerLoaded"in n?n.triggerLoaded():Pn(n.hostLoaded,n);this.loaded?.(),ns(this,xS).resolve()},f5.lumina=!0;let Wo=f5;const hOe=t=>{let e;const i=s=>{e=new URL(s,globalThis.location?.href||void 0).href},r={...t,getAssetPath(s){const n=new URL(s,e);return n.origin!==globalThis.location?.origin?n.href:n.pathname},setAssetPath:i,customElement(s,n){n.K=r,n.L=s,customElements.get(s)||customElements.define(s,n)}};return i(t.defaultAssetPath),r},Et=t=>typeof t=="object"&&t!=null?mXe(t):t,AXe=t=>typeof t=="object"&&t!=null?yXe(t):t,lD=sr;function dOe(t,e,i){i==null?t.removeAttribute(e):t.setAttribute(e,i)}const LL={toAttribute:t=>t===!0?"":t===!1?null:t},OXe="calcite-mode-auto",PXe="calcite-mode-dark",RXe={rtl:"calcite--rtl"},lsi={filter:250,nextTick:0,resize:150,reposition:100},csi=25;function q0e(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(PXe)||t.contains(OXe)&&e?"dark":"light",r=a=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:a}})),s=a=>{n!==a&&r(a),n=a};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",a=>s(a.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}const h4=globalThis.calciteConfig,usi=h4?.focusTrapStack||[],IXe=h4?.logLevel||"info",G0e="3.3.3",DXe="2025-10-08",kXe="7391af08e";function LXe(){if(h4&&h4.version)return;console.info(`Using Calcite Components ${G0e} [Date: ${DXe}, Revision: ${kXe}]`);const t=h4||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:G0e,writable:!1}),globalThis.calciteConfig=t}document.readyState==="interactive"?q0e():document.addEventListener("DOMContentLoaded",q0e,{once:!0});queueMicrotask(LXe);const FXe=hOe({defaultAssetPath:"https://js.arcgis.com/calcite-components/3.3.3/",hydratedAttribute:"calcite-hydrated"}),{customElement:ty,getAssetPath:pOe,setAssetPath:zXe}=FXe;function NXe(t){return t.map(e=>{let i="";for(let r=0;r<e;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const VXe=()=>NXe([2,1,1,1,3]);var jXe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Cee=jXe.join(","),fOe=typeof Element>"u",v5=fOe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,z8=!fOe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},N8=function t(e,i){var r;i===void 0&&(i=!0);var s=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),n=s===""||s==="true",a=n||i&&e&&t(e.parentNode);return a},UXe=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},mOe=function(e,i,r){if(N8(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(Cee));return i&&v5.call(e,Cee)&&s.unshift(e),s=s.filter(r),s},gOe=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var a=n.shift();if(!N8(a,!1))if(a.tagName==="SLOT"){var o=a.assignedElements(),l=o.length?o:a.children,u=t(l,!0,r);r.flatten?s.push.apply(s,u):s.push({scopeParent:a,candidates:u})}else{var d=v5.call(a,Cee);d&&r.filter(a)&&(i||!e.includes(a))&&s.push(a);var f=a.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(a),g=!N8(f,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(a));if(f&&g){var v=t(f===!0?a.children:f.children,!0,r);r.flatten?s.push.apply(s,v):s.push({scopeParent:a,candidates:v})}else n.unshift.apply(n,a.children)}}return s},yOe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},vOe=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||UXe(e))&&!yOe(e)?0:e.tabIndex},BXe=function(e,i){var r=vOe(e);return r<0&&i&&!yOe(e)?0:r},qXe=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},_Oe=function(e){return e.tagName==="INPUT"},GXe=function(e){return _Oe(e)&&e.type==="hidden"},HXe=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},WXe=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},ZXe=function(e){if(!e.name)return!0;var i=e.form||z8(e),r=function(o){return i.querySelectorAll('input[type="radio"][name="'+o+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(e.name));else try{s=r(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var n=WXe(s,e.form);return!n||n===e},YXe=function(e){return _Oe(e)&&e.type==="radio"},JXe=function(e){return YXe(e)&&!ZXe(e)},QXe=function(e){var i,r=e&&z8(e),s=(i=r)===null||i===void 0?void 0:i.host,n=!1;if(r&&r!==e){var a,o,l;for(n=!!((a=s)!==null&&a!==void 0&&(o=a.ownerDocument)!==null&&o!==void 0&&o.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var u,d,f;r=z8(s),s=(u=r)===null||u===void 0?void 0:u.host,n=!!((d=s)!==null&&d!==void 0&&(f=d.ownerDocument)!==null&&f!==void 0&&f.contains(s))}}return n},H0e=function(e){var i=e.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},XXe=function(e,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=v5.call(e,"details>summary:first-of-type"),a=n?e.parentElement:e;if(v5.call(a,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var o=e;e;){var l=e.parentElement,u=z8(e);if(l&&!l.shadowRoot&&s(l)===!0)return H0e(e);e.assignedSlot?e=e.assignedSlot:!l&&u!==e.ownerDocument?e=u.host:e=l}e=o}if(QXe(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return H0e(e);return!1},KXe=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return v5.call(i,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}i=i.parentElement}return!1},Mee=function(e,i){return!(i.disabled||N8(i)||GXe(i)||XXe(i,e)||HXe(i)||KXe(i))},W0e=function(e,i){return!(JXe(i)||vOe(i)<0||!Mee(e,i))},eKe=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},tKe=function t(e){var i=[],r=[];return e.forEach(function(s,n){var a=!!s.scopeParent,o=a?s.scopeParent:s,l=BXe(o,a),u=a?t(s.candidates):o;l===0?a?i.push.apply(i,u):i.push(o):r.push({documentOrder:n,tabIndex:l,item:s,isScope:a,content:u})}),r.sort(qXe).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},iKe=function(e,i){i=i||{};var r;return i.getShadowRoot?r=gOe([e],i.includeContainer,{filter:W0e.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:eKe}):r=mOe(e,i.includeContainer,W0e.bind(null,i)),tKe(r)},rKe=function(e,i){i=i||{};var r;return i.getShadowRoot?r=gOe([e],i.includeContainer,{filter:Mee.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=mOe(e,i.includeContainer,Mee.bind(null,i)),r};const bOe={getShadowRoot:!0};function wOe(t){const r=aP(t,"[dir]");return r?r.getAttribute("dir"):"ltr"}function N9(t){return t.getRootNode()}function hsi(t){const e=N9(t);return"host"in e?e:null}function xOe(t){return t.host||null}function fle(t,{selector:e,id:i}){if(!t)return null;t.assignedSlot&&(t=t.assignedSlot);const r=N9(t);return(i?"getElementById"in r?r.getElementById(i):null:e?r.querySelector(e):null)||fle(xOe(r),{selector:e,id:i})}function aP(t,e){return t?t.closest(e)||aP(xOe(N9(t)),e):null}function sKe(t){return typeof t?.setFocus=="function"}async function mle(t,e=!1,i="tabbable",r,s){return t?sKe(t)&&r!==t?t.setFocus(s):(i==="tabbable"?aKe:lKe)(t,e,s):void 0}function nKe(t,e){if(t)return iKe(t,{...bOe,includeContainer:e})[0]??t}function aKe(t,e,i){nKe(t,e)?.focus(i)}function oKe(t,e){if(t)return rKe(t,{...bOe,includeContainer:e})[0]??t}function lKe(t,e,i){oKe(t,e)?.focus(i)}function cKe(t,e){return t.filter(i=>i.matches(e))}function Eee(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e===""||e===!0)return t[i]}function uKe(t){return(!!t).toString()}function dsi(t){return gle(t)||pKe(t)}function hKe(t){return fKe(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function dKe(t){for(const e of t.childNodes)if(e.nodeType===Node.TEXT_NODE&&e.textContent?.trim()!==""||e.nodeType===Node.ELEMENT_NODE)return!0;return!1}function pKe(t){return!!hKe(t)}function fKe(t){return t.currentTarget.assignedNodes({flatten:!0})}function gle(t){return!!mKe(t).length}function mKe(t,e){return gKe(t.currentTarget,e)}function gKe(t,e){const i=t.assignedElements({flatten:!0});return e?cKe(i,e):i}function psi(t){return!!(t.isPrimary&&t.button===0)}function fsi(t){return t.detail===0}const msi=(t,e,i,r=!0,s=!0,n=!1)=>{const a=t.indexOf(e),o=a===0,l=a===t.length-1;r&&(i=i==="previous"&&o?"last":i==="next"&&l?"first":i);let u;return i==="previous"?u=t[a-1]||t[r?t.length-1:a]:i==="next"?u=t[a+1]||t[r?0:a]:i==="last"?u=t[t.length-1]:u=t[0],mle(u,s,"tabbable",n?u:void 0),u};function yKe(t,e){if(t.parentNode!==e.parentNode)return!1;const i=Array.from(t.parentNode.children);return i.indexOf(t)<i.indexOf(e)}async function gsi(t,e){return SOe(t,e,"animation")}async function vKe(t,e){return SOe(t,e,"transition")}function Z0e(t,e,i){const r=e==="transition"?"transitionProperty":"animationName";return t.getAnimations().find(s=>s[r]===i)}async function SOe(t,e,i){let r=Z0e(t,i,e);if(r||(await _Ke(),r=Z0e(t,i,e)),!!r)try{await r.finished}catch{}}async function _Ke(){await new Promise(t=>requestAnimationFrame(()=>t()))}function ysi(t){return t.endsWith("px")?parseFloat(t):t.endsWith("vw")?Y0e(parseFloat(t),window.innerWidth):t.endsWith("vh")?Y0e(parseFloat(t),window.innerHeight):0}function Y0e(t,e){return t*e/100}function _5(t,e,i){const r=bKe(t);return new r(e,i)}function bKe(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,s){return this.observedEntry.push({target:r,options:s}),super.observe(r,s)}unobserve(r){const s=this.observedEntry.filter(n=>n.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),s.forEach(n=>this.observe(n.target,n.options))}}return(function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver})()}function wKe(t,e,i,r){if(t&&(e&&t.unobserve(e),!!i)){if(t instanceof MutationObserver){t.observe(i,r);return}t.observe(i)}}const J0e=new Set,Q0e={trace:0,debug:1,info:2,warn:4,error:8,off:10};function xKe(t){return Q0e[t]>=Q0e[IXe]}function CM(t,...e){if(!xKe(t))return;console[t].call(this,"%ccalcite","background: #007AC2; color: #fff; border-radius: 4px; padding: 2px 4px;",...e)}let kY;const SKe={debug:t=>CM("debug",t),info:t=>CM("info",t),warn:t=>CM("warn",t),error:t=>CM("error",t),trace:t=>CM("trace",t),deprecated:TKe};function TKe(t,{component:e,name:i,suggested:r,removalVersion:s}){const n=`${t}:${t==="component"?"":e}${i}`;if(J0e.has(n))return;J0e.add(n);const a=Array.isArray(r);a&&!kY&&(kY=new Intl.ListFormat("en",{style:"long",type:"disjunction"}));const o=`[${i}] ${t} is deprecated and will be removed in ${s==="future"?"a future version":`v${s}`}.${r?` Use ${a?kY.format(r.map(l=>`"${l}"`)):`"${r}"`} instead.`:""}`;CM("warn",o)}const X0e={flipRtl:"flip-rtl",svg:"svg"},TOe={},LY={},$Oe={s:16,m:24,l:32};function COe({icon:t,scale:e}){const i=$Oe[e],r=MKe(t),s=r.charAt(r.length-1)==="F";return`${s?r.substring(0,r.length-1):r}${i}${s?"F":""}`}async function $Ke(t){const e=COe(t),i=MOe(e);if(i)return i;LY[e]||(LY[e]=fetch(pOe(`./assets/icon/${e}.json`)).then(s=>s.json()).catch(()=>(SKe.error(`${t.icon} (${t.scale}) icon failed to load`),"")));const r=await LY[e];return TOe[e]=r,r}function CKe(t){return MOe(COe(t))}function MOe(t){return TOe[t]}function MKe(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const s=/[a-z]/i;t=i.map((n,a)=>n.replace(s,function(l,u){return a===0&&u===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const EKe=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{display:inline-flex;color:var(--calcite-icon-color, var(--calcite-ui-icon-color, currentColor))}:host([scale=s]){inline-size:16px;block-size:16px;min-inline-size:16px;min-block-size:16px}:host([scale=m]){inline-size:24px;block-size:24px;min-inline-size:24px;min-block-size:24px}:host([scale=l]){inline-size:32px;block-size:32px;min-inline-size:32px;min-block-size:32px}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}`,x9=class x9 extends Wo{constructor(){super(...arguments),this.visible=!1,this.flipRtl=!1,this.icon=null,this.preload=!1,this.scale="m"}connectedCallback(){if(super.connectedCallback(),this.preload){this.visible=!0,this.loadIconPathData();return}this.visible||this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}willUpdate(e){(e.has("icon")&&(this.hasUpdated||this.icon!==null)||e.has("scale")&&(this.hasUpdated||this.scale!=="m"))&&this.loadIconPathData()}disconnectedCallback(){super.disconnectedCallback(),this.intersectionObserver?.disconnect(),this.intersectionObserver=null}async loadIconPathData(){const{icon:e,scale:i,visible:r}=this;if(!e||!r)return;const s={icon:e,scale:i},n=CKe(s)||await $Ke(s);e===this.icon&&(this.pathData=n)}waitUntilVisible(e){if(this.intersectionObserver=_5("intersection",i=>{i.forEach(r=>{r.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,e())})},{rootMargin:"50px"}),!this.intersectionObserver){e();return}this.intersectionObserver.observe(this.el)}render(){const{el:e,flipRtl:i,pathData:r,scale:s,textLabel:n}=this,a=wOe(e),o=$Oe[s],l=!!n,u=[].concat(r||"");return this.el.ariaHidden=uKe(!l),this.el.ariaLabel=l?n:null,this.el.role=l?"img":null,ni`<svg aria-hidden=true class=${Et({[X0e.flipRtl]:a==="rtl"&&i,[X0e.svg]:!0})} fill=currentColor height=100% viewBox=${`0 0 ${o} ${o}`} width=100% xmlns=http://www.w3.org/2000/svg>${u.map(d=>typeof d=="string"?xee`<path d=${d??sr} />`:xee`<path d=${d.d??sr} opacity=${("opacity"in d?d.opacity:1)??sr} />`)}</svg>`}};x9.properties={pathData:[16,{},{state:!0}],visible:[16,{},{state:!0}],flipRtl:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],preload:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],textLabel:1},x9.styles=EKe;let V8=x9;ty("calcite-icon",V8);const EOe=Object.freeze(Object.defineProperty({__proto__:null,Icon:V8},Symbol.toStringTag,{value:"Module"}));function AKe(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function AOe(t){t.target.disabled&&t.preventDefault()}const OOe=["mousedown","mouseup","click"];function POe(t){t.target.disabled&&(t.stopImmediatePropagation(),t.preventDefault())}const j8={capture:!0};function V9(t){if(t.disabled){t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),OKe(t);return}RKe(t),t.el.removeAttribute("aria-disabled")}function OKe(t){t.el.click=AKe,PKe(t.el)}function PKe(t){t.addEventListener("pointerdown",AOe,j8),OOe.forEach(e=>t.addEventListener(e,POe,j8))}function RKe(t){delete t.el.click,IKe(t.el)}function IKe(t){t.removeEventListener("pointerdown",AOe,j8),OOe.forEach(e=>t.removeEventListener(e,POe,j8))}const DKe={container:"interaction-container"},j9=({children:t,disabled:e})=>ni`<div class=${Et(DKe.container)} .inert=${e}>${t}</div>`;function kKe(t){return t==="Enter"||t===" "}const yle=["0","1","2","3","4","5","6","7","8","9"];function Aw(t){return t==="l"?"m":"s"}async function LKe(t){await t.componentOnReady(),await t.updateComplete}const U9=t=>(...e)=>{const i=ZAe(),r=new t(...e),s=r.exports;WAe(i.at(-1));const n=r.component.manager;n.W(r,s),r.watchExports(n.W.bind(n,r)),MQe(r);const a=[r.component,...i].reverse();return hle(a,o=>o===void 0?void 0:FKe(r,o,s),s)},FKe=(t,{host:e,key:i,isReactive:r},s)=>{const n=e,a=n[i]!==t.exports,o=n[i]!==s,l=s!==t.exports;if(a&&!o&&l&&(n[i]=t.exports),e===t.component){if(r){const f=t.component.manager;o&&f.W(t,n[i]),t.onUpdate(g=>{if(g.has(i)){const v=n[i];v!==t.exports&&f.W(t,v)}})}t.O=r?void 0:i}const d=t.component.constructor.elementProperties.get(i)?.readOnly;t.watchExports(()=>{n[i]!==t.exports&&(d?PQe(()=>{n[i]=t.exports}):n[i]=t.exports)})};function zKe(t,e){return t.assignedElements({flatten:!0}).filter(r=>r.matches(e))}const NKe=(t,e)=>{let i=t;for(;i;){if(i===e)return!0;if(!i.parentNode)return!1;i.parentNode instanceof ShadowRoot?i=i.parentNode.host:i=i.parentNode}return!1},ROe=(t,e,i)=>{const r=VKe(e).subscribe;return r(s=>{s.some(a=>NKe(t,a.target))&&i()})},FY={},VKe=t=>{const e=t.join(","),i=FY[e];if(i!==void 0)return i;const r=new Set,s=new MutationObserver(a=>r.forEach(o=>o(a)));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0});const n={subscribe:a=>(r.add(a),()=>{r.delete(a),r.size===0&&(s.disconnect(),FY[e]=void 0)})};return FY[e]=n,n},IOe=(t,e)=>{let i=t;for(;i;){const r=i.closest?.(e);if(r)return r;const s=i.getRootNode?.();if(s===globalThis.document)return;i=s.host}};function jKe(t){const e=IOe(t,".calcite-mode-dark, .calcite-mode-light, .calcite-mode-auto");return e?.classList.contains("calcite-mode-dark")||e?.classList.contains("calcite-mode-auto")&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}const DOe=(t,e,i)=>IOe(t,`[${e}]`)?.getAttribute(e)??i,UKe="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),BKe=new Set(UKe),U8="en",qKe={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},GKe=async(t,e,i="")=>{const r=`${e}/${i}`,s=`${r}${t}.json`;return zY[s]??(zY[s]=kOe(t,r)),await zY[s]},zY={},kOe=async(t,e)=>{const i=`${e}${t}.json`;try{const r=await fetch(i);if(r.ok)return await r.json()}catch(r){return console.error(r),{}}return t===U8?{}:await kOe(U8,e)},LOe=t=>{const e=DOe(t,"lang",globalThis.navigator?.language||U8);return{lang:e,t9nLocale:FOe(e)}},FOe=t=>{const[e,i]=t.split("-"),r=e.toLowerCase();let s=r;return i&&(s=`${r}-${i.toUpperCase()}`),s=qKe[s]??s,BKe.has(s)?s:i?FOe(r):U8},HKe=(t,e,i,r)=>{let s;const n=()=>WKe(t,e(),r).then(a=>{(s?.lang!==a.lang||s.t9nLocale!==a.t9nLocale||s.t9nStrings!==a.t9nStrings)&&i(a),s=a}).catch(console.error);return queueMicrotask(n),ROe(t,["lang"],n)},WKe=async(t,e,i=t.localName.split("-").slice(1).join("-"))=>{const{lang:r,t9nLocale:s}=LOe(t),n=`${e}/${i}/t9n`,o=i===null?{}:await GKe(s,n,"messages.");return{lang:r,t9nLocale:s,t9nStrings:o}},zOe=t=>NOe(void 0,t),vle=t=>e=>NOe(e,t);class ZKe extends ple{constructor(e,i){super(e);const r=this.exports;try{eE(this.component);const s=i(this.component,this),n=this.exports!==r;if($Qe(s)){n||this.setProvisionalExports(s);const a=s.then(o=>{this.exports=o,super.catchUpLifecycle()}).catch(o=>{this.P.reject(o),console.error(o)});this.onLoad(async()=>await a)}else(!n||s!==void 0)&&(this.exports=s),queueMicrotask(()=>super.catchUpLifecycle())}catch(s){this.P.reject(s),console.error(s)}}catchUpLifecycle(){}}const NOe=U9(ZKe),YKe=(t,e)=>new JKe(t,e);class JKe extends ple{#e;#t;#i;constructor(e,i){super(),this.#t=e,this.#i=i,this.#e=new MutationObserver(r=>{r.forEach(s=>{e.includes(s.attributeName)&&i.call(this.component,this.component.el.getAttribute(s.attributeName),s.oldValue,s.attributeName)})})}hostConnected(){this.#t.forEach(e=>{this.component.el.hasAttribute(e)&&this.#i.call(this.component,null,this.component.el.getAttribute(e),e)}),this.#e.observe(this.component.el,{attributes:!0,attributeOldValue:!0,attributeFilter:this.#t})}hostDisconnected(){this.#e.disconnect()}}const K0e="ltr",QKe=()=>zOe((t,e)=>{e.exports=K0e,e.onLifecycle(()=>{const i=()=>{const r=DOe(t.el,"dir",K0e);e.exports=r==="rtl"?"rtl":"ltr"};return i(),ROe(t.el,["dir"],i)})}),VOe=t=>(e={})=>zOe((i,r)=>{const s=LOe(i.el),n={_lang:s.lang,_t9nLocale:s.t9nLocale,_loading:!0},a=i;r.onLifecycle(()=>HKe(i.el,()=>t("./assets"),({t9nLocale:l,t9nStrings:u,lang:d})=>{const f={...u,_lang:d,_t9nLocale:l,_loading:!1};r.exports=f;const g=u.componentLabel;typeof g=="string"&&"label"in i&&i.label==null&&(i.label??=g),o(a.messageOverrides)},e.name));const o=l=>{const u=r.exports,d=u._original??u,f=jOe(d,l);l&&(f._original=d),r.exports=f};return"messageOverrides"in a&&r.onUpdate(l=>{l.has("messageOverrides")&&o(a.messageOverrides)}),e.blocking?(r.setProvisionalExports(n,!1),r.ready):n}),jOe=(t,e)=>{if(!e)return t;const i={...t};return Object.entries(e).forEach(([r,s])=>{typeof s=="object"?i[r]=jOe(t[r],s):i[r]=s??t[r]}),i},UOe=t=>KKe,XKe="arcgisPropertyChange",KKe=(...t)=>{const e=nP(),i=dle(XKe,void 0,e);let r=!0;return e.manager.onUpdated(s=>{if(r||!e.el.isConnected){r=!1;return}for(const n of t)s.has(n)&&i.emit({name:n})}),i};const FL=VOe(pOe);const zL=()=>vle((t,e)=>{let i;function r(){i?.abort()}return e.onLoad(()=>{t.listen("focus",()=>{i=new AbortController,t.el.addEventListener("focusout",r,{signal:i.signal})})}),e.onDisconnected(()=>{t.el.removeEventListener("focusout",r)}),async(s,n)=>{if(t.disabled)return;const a=tet(s());if(!a)return;const{target:o,includeContainer:l,strategy:u}=a,d=N9(t.el),f=d.activeElement;if(await LKe(t),!(f!==d.activeElement||i&&!i?.signal.aborted))return t.el.removeEventListener("focus",r),mle(o,l,u,t.el,n)}});function eet(t){return"target"in t&&("includeContainer"in t||"strategy"in t)}function tet(t){if(t)return eet(t)?t:{target:t}}const El={title:"title",close:"close",imageContainer:"image-container",chipIcon:"chip-icon",textSlotted:"text--slotted",container:"container",imageSlotted:"image--slotted",closable:"closable",multiple:"multiple",single:"single",selectable:"selectable",selectIcon:"select-icon",selectIconActive:"select-icon--active",nonInteractive:"non-interactive",isCircle:"is-circle",selected:"selected"},iet={image:"image"},bN={close:"x",checkedSingle:"circle-f",uncheckedMultiple:"square",checkedMultiple:"check-square-f"},ret=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-flex;cursor:default;border-radius:var(--calcite-chip-corner-radius, 9999px)}:host([closed]){display:none}:host([appearance=outline]) .container,:host([appearance=outline-fill]) .container{color:var(--calcite-chip-text-color, var(--calcite-color-text-1))}:host([appearance=outline]) .close,:host([appearance=outline-fill]) .close{color:var(--calcite-chip-close-icon-color, var(--calcite-close-icon-color, var(--calcite-color-text-3)))}:host([appearance=outline]):host([kind=brand]),:host([appearance=outline-fill]):host([kind=brand]){--calcite-internal-chip-border-color: var(--calcite-chip-border-color, var(--calcite-color-brand));--calcite-internal-chip-selectable-hover-border-color: var(--calcite-chip-border-color, var(--calcite-color-brand));--calcite-internal-chip-selectable-active-border-color: var( --calcite-chip-border-color, var(--calcite-color-brand) )}:host([appearance=outline]):host([kind=inverse]),:host([appearance=outline-fill]):host([kind=inverse]){--calcite-internal-chip-border-color: var(--calcite-chip-border-color, var(--calcite-color-border-inverse))}:host([appearance=outline]):host([kind=neutral]),:host([appearance=outline-fill]):host([kind=neutral]){--calcite-internal-chip-border-color: var(--calcite-chip-border-color, var(--calcite-color-border-1))}:host([appearance=outline]){--calcite-internal-chip-background-color: transparent}:host([appearance=outline-fill]){--calcite-internal-chip-background-color: var(--calcite-chip-background-color, var(--calcite-color-foreground-1))}:host([appearance=solid]){--calcite-internal-chip-border-color: transparent;--calcite-internal-chip-selectable-hover-border-color: transparent;--calcite-internal-chip-selectable-active-border-color: transparent}:host([appearance=solid]):host([kind=brand]) .container,:host([appearance=solid]):host([kind=inverse]) .container{color:var(--calcite-chip-text-color, var(--calcite-color-text-inverse))}:host([appearance=solid]):host([kind=brand]) .close,:host([appearance=solid]):host([kind=inverse]) .close{outline-color:var(--calcite-color-text-inverse)}:host([appearance=solid]):host([kind=brand]){--calcite-internal-chip-background-color: var(--calcite-chip-background-color, var(--calcite-color-brand))}:host([appearance=solid]):host([kind=inverse]){--calcite-internal-chip-background-color: var(--calcite-chip-background-color, var(--calcite-color-inverse))}:host([appearance=solid]):host([kind=inverse]) .close:hover{background-color:var(--calcite-color-inverse-hover)}:host([appearance=solid]):host([kind=inverse]) .close:active{background-color:var(--calcite-color-inverse-press)}:host([appearance=solid]):host([kind=neutral]){--calcite-internal-chip-background-color: var(--calcite-chip-background-color, var(--calcite-color-foreground-2))}:host([kind=neutral]) .container{color:var(--calcite-chip-text-color, var(--calcite-color-text-1))}:host([kind=neutral]) .close{color:var(--calcite-chip-close-icon-color, var(--calcite-close-icon-color, var(--calcite-color-text-3)))}:host([selected]) .select-icon{opacity:1}:host([appearance=solid]):host([kind=neutral]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-foreground-3);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-border-3)}:host([appearance=solid]):host([kind=inverse]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-inverse-hover);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-inverse-press)}:host([appearance=solid]):host([kind=brand]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-brand-hover);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-brand-press)}:host([appearance=outline-fill]):host([kind=neutral]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-foreground-2);--calcite-internal-chip-selectable-hover-border-color: var(--calcite-color-border-input);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-foreground-3);--calcite-internal-chip-selectable-active-border-color: var(--calcite-color-text-3)}:host([appearance=outline-fill]):host([kind=inverse]),:host([appearance=outline-fill]):host([kind=brand]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-foreground-2);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-foreground-3)}:host([appearance=outline]):host([kind=neutral]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-transparent-hover);--calcite-internal-chip-selectable-hover-border-color: var(--calcite-color-border-input);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-transparent-press);--calcite-internal-chip-selectable-active-border-color: var(--calcite-color-text-3)}:host([appearance=outline]):host([kind=inverse]),:host([appearance=outline]):host([kind=brand]){--calcite-internal-chip-selectable-hover-background-color: var(--calcite-color-transparent-hover);--calcite-internal-chip-selectable-active-background-color: var(--calcite-color-transparent-press)}:host([scale=s]) .container{--calcite-internal-chip-block-size: var(--calcite-size-sm, 1.5rem) ;--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-font-size: var(--calcite-font-size--2);--calcite-internal-chip-icon-size: var(--calcite-size-xs, 1rem) ;--calcite-internal-chip-icon-space: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-image-size: var(--calcite-spacing-xl, 1.25rem) ;--calcite-internal-chip-title-space: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-close-size: var(--calcite-size-xs, 1rem) }:host([scale=s]) .container:not(.closable).is-circle{--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px);--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-px)}:host([scale=s]) .container.image--slotted:has(.chip-icon),:host([scale=s]) .container.image--slotted.text--slotted,:host([scale=s]) .container.image--slotted.closable{--calcite-internal-chip-image-space-x-end: var(--calcite-spacing-xxs, .25rem) }:host([scale=s]) .container.image--slotted:not(.text--slotted,:has(.chip-icon)),:host([scale=s]) .container.image--slotted:not(.selectable){--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px)}:host([scale=s]) .container.selectable.single:not(.is-circle).image--slotted{--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px)}:host([scale=s]) .container.selectable.single:not(.is-circle).selected{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-none, 0)}:host([scale=s]) .container.selectable.single:not(.is-circle).selected.image--slotted{--calcite-internal-chip-select-space-x-end: .5rem ;--calcite-internal-chip-select-space-x-start: .125rem }:host([scale=s]) .container.multiple:not(.is-circle){--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=s]) .container.multiple:not(.is-circle).image--slotted{--calcite-internal-chip-select-space-x-end: .5rem ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px)}:host([scale=s]) .container.multiple:not(.is-circle).image--slotted:not(.text--slotted){--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xs, .375rem) }:host([scale=m]) .container{--calcite-internal-chip-block-size: var(--calcite-size-md, 2rem) ;--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-font-size: var(--calcite-font-size--1);--calcite-internal-chip-icon-size: var(--calcite-size-sm, 1.5rem) ;--calcite-internal-chip-icon-space: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-image-size: var(--calcite-size-sm, 1.5rem) ;--calcite-internal-chip-title-space: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-close-size: var(--calcite-size-sm, 1.5rem) }:host([scale=m]) .container:not(.closable).is-circle{--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-px);--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-px)}:host([scale=m]) .container.image--slotted:not(.is-circle){--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=m]) .container.image--slotted:has(.chip-icon),:host([scale=m]) .container.image--slotted.text--slotted,:host([scale=m]) .container.image--slotted.closable{--calcite-internal-chip-image-space-x-end: var(--calcite-spacing-xs, .375rem) }:host([scale=m]) .container.selectable.single:not(.is-circle).image--slotted{--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=m]) .container.selectable.single:not(.is-circle).selected{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-px);--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-none, 0)}:host([scale=m]) .container.selectable.single:not(.is-circle).selected.image--slotted{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xs, .375rem) }:host([scale=m]) .container.multiple:not(.is-circle){--calcite-internal-chip-select-space-x-end: .125rem ;--calcite-internal-chip-select-space-x-start: .125rem }:host([scale=m]) .container.multiple:not(.is-circle).image--slotted{--calcite-internal-chip-select-space-x-end: .5rem ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=m]) .container.closable:not(.is-circle){--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xxs, .25rem) }:host([scale=l]) .container{--calcite-internal-chip-block-size: 2.75rem ;--calcite-internal-chip-container-space-x-end: .5rem ;--calcite-internal-chip-container-space-x-start: .5rem ;--calcite-internal-chip-font-size: var(--calcite-font-size-0);--calcite-internal-chip-icon-size: var(--calcite-size-md, 2rem) ;--calcite-internal-chip-icon-space: .5rem ;--calcite-internal-chip-image-size: var(--calcite-size-md, 2rem) ;--calcite-internal-chip-title-space: .5rem ;--calcite-internal-close-size: var(--calcite-size-md, 2rem) }:host([scale=l]) .container:not(.closable).is-circle{--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=l]) .container.image--slotted:not(.is-circle){--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xs, .375rem) }:host([scale=l]) .container.image--slotted:has(.chip-icon),:host([scale=l]) .container.image--slotted.text--slotted,:host([scale=l]) .container.image--slotted.closable{--calcite-internal-chip-image-space-x-end: .5rem }:host([scale=l]) .container.selectable.single:not(.is-circle).image--slotted{--calcite-internal-chip-container-space-x-start: var(--calcite-spacing-xs, .375rem) }:host([scale=l]) .container.selectable.single:not(.is-circle).selected{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-none, 0)}:host([scale=l]) .container.selectable.single:not(.is-circle).selected.image--slotted{--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xs, .375rem) ;--calcite-internal-chip-select-space-x-start: .5rem }:host([scale=l]) .container.multiple:not(.is-circle){--calcite-internal-chip-container-space-x-start: .5rem ;--calcite-internal-chip-select-space-x-end: var(--calcite-spacing-xxs, .25rem) ;--calcite-internal-chip-select-space-x-start: var(--calcite-spacing-xxs, .25rem) }:host([scale=l]) .container.multiple:not(.is-circle).image--slotted{--calcite-internal-chip-select-space-x-end: .75rem }:host([scale=l]) .container.closable:not(.is-circle){--calcite-internal-chip-container-space-x-end: var(--calcite-spacing-xs, .375rem) }.container{box-sizing:border-box;display:inline-flex;block-size:100%;max-inline-size:100%;align-items:center;justify-content:center;font-weight:var(--calcite-font-weight-medium);outline-color:transparent;background-color:var(--calcite-internal-chip-background-color);border-color:var(--calcite-internal-chip-border-color);border-radius:var(--calcite-chip-corner-radius, 9999px);border-width:var(--calcite-border-width-sm);border-style:solid;font-size:var(--calcite-internal-chip-font-size, var(--calcite-font-size));padding-inline-start:var(--calcite-internal-chip-container-space-x-start);padding-inline-end:var(--calcite-internal-chip-container-space-x-end);block-size:var(--calcite-internal-chip-block-size, auto);inline-size:var(--calcite-internal-chip-inline-size, auto);min-inline-size:var(--calcite-internal-chip-block-size, auto)}.container:hover .select-icon--active{opacity:var(--calcite-opacity-full, 1)}.container.selectable{cursor:pointer}.container.selectable:hover{background-color:var(--calcite-internal-chip-selectable-hover-background-color);border-color:var(--calcite-internal-chip-selectable-hover-border-color)}.container.selectable:active{background-color:var(--calcite-internal-chip-selectable-active-background-color);border-color:var(--calcite-internal-chip-selectable-active-border-color)}.container:not(.non-interactive):focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(var(--calcite-spacing-base) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.container.text--slotted .title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.container:not(.text--slotted) .title,.container:not(.image--slotted) .image-container{display:none}.container.is-circle .chip-icon,.container.is-circle .image-container{padding:var(--calcite-spacing-none, 0)}.title{padding-inline:var(--calcite-internal-chip-title-space)}.image-container{display:inline-flex;overflow:hidden;align-items:center;justify-content:center;pointer-events:none;block-size:var(--calcite-internal-chip-image-size, var(--calcite-spacing-xxl, 1.5rem));inline-size:var(--calcite-internal-chip-image-size, var(--calcite-spacing-xxl, 1.5rem));padding-inline-start:var(--calcite-spacing-none, 0);padding-inline-end:var(--calcite-internal-chip-image-space-x-end, 0)}.chip-icon{position:relative;margin-block:0px;display:inline-flex;transition-timing-function:cubic-bezier(.4,0,.2,1);color:var(--calcite-chip-icon-color, var(--calcite-chip-text-color, var(--calcite-icon-color, currentColor)));padding-inline:var(--calcite-internal-chip-icon-space, var(--calcite-spacing-xs, .375rem))}.select-icon{align-self:center;justify-content:center;align-items:center;display:flex;inset-block-start:-1px;position:absolute;visibility:hidden;inline-size:auto;opacity:0;transition:opacity .15s ease-in-out,inline-size .15s ease-in-out;color:var(--calcite-chip-select-icon-color, currentColor)}.select-icon.select-icon--active{position:relative;visibility:visible;opacity:var(--calcite-opacity-half, .5);color:var(--calcite-chip-select-icon-color-press, var(--calcite-chip-select-icon-color-pressed, var(--calcite-chip-select-icon-color, currentColor)))}.multiple .select-icon{display:flex;align-items:center;justify-content:center}.multiple .select-icon,.single .select-icon--active{padding-inline-start:var(--calcite-internal-chip-select-space-x-start);padding-inline-end:var(--calcite-internal-chip-select-space-x-end);block-size:var(--calcite-internal-chip-icon-size, var(--calcite-spacing-xxl, 1.5rem));inline-size:var(--calcite-internal-chip-icon-size, var(--calcite-spacing-xxl, 1.5rem))}slot[name=image]::slotted(*){display:flex;block-size:100%;inline-size:100%;overflow:hidden;border-radius:50%}.close{margin:0;cursor:pointer;align-items:center;border-radius:50%;border-style:none;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;outline-color:transparent;background-color:var(--calcite-close-background-color, var(--calcite-color-transparent));-webkit-appearance:none;display:flex;align-content:center;justify-content:center;color:var(--calcite-chip-close-icon-color, var(--calcite-close-icon-color, currentColor));block-size:var(--calcite-internal-close-size, var(--calcite-spacing-xxl, 1.5rem));inline-size:var(--calcite-internal-close-size, var(--calcite-spacing-xxl, 1.5rem));padding:0}.close:hover,.close:focus{background-color:var(--calcite-close-background-color-hover, var(--calcite-color-transparent-hover))}.close:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(calc(-1 * var(--calcite-spacing-base)) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.close:active{background-color:var(--calcite-close-background-color-press, var(--calcite-color-transparent-press))}.close calcite-icon{color:inherit}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([hidden]){display:none}[hidden]{display:none}`,S9=class S9 extends Wo{constructor(){super(),this.closeButtonRef=Jw(),this.containerRef=Jw(),this.messages=FL(),this.focusSetter=zL()(this),this.hasImage=!1,this.hasText=!1,this.appearance="solid",this.closable=!1,this.closed=!1,this.closeOnDelete=!1,this.disabled=!1,this.iconFlipRtl=!1,this.interactive=!1,this.kind="neutral",this.scale="m",this.selected=!1,this.selectionMode="none",this.calciteChipClose=$a({cancelable:!1}),this.calciteChipSelect=$a({cancelable:!1}),this.calciteInternalChipKeyEvent=$a({cancelable:!1}),this.calciteInternalChipSelect=$a({cancelable:!1}),this.calciteInternalSyncSelectedChips=$a({cancelable:!1}),this.listen("keydown",this.keyDownHandler),this.listen("click",this.clickHandler)}async setFocus(e){return this.focusSetter(()=>{if(this.interactive)return this.containerRef.value;if(this.closable)return this.closeButtonRef.value},e)}async load(){this.updateHasText()}willUpdate(e){e.has("selected")&&this.hasUpdated&&this.watchSelected(this.selected)}updated(){V9(this)}loaded(){this.selectionMode!=="none"&&this.interactive&&this.selected&&this.handleSelectionPropertyChange(this.selected)}watchSelected(e){this.selectionMode!=="none"&&this.handleSelectionPropertyChange(e)}keyDownHandler(e){if(e.target===this.el)switch(e.key){case" ":case"Enter":this.handleEmittingEvent(),e.preventDefault();break;case"Backspace":case"Delete":this.closable&&!this.closed&&this.closeOnDelete&&(e.preventDefault(),this.close());break;case"ArrowRight":case"ArrowLeft":case"Home":case"End":this.calciteInternalChipKeyEvent.emit(e),e.preventDefault();break}}clickHandler(){!this.interactive&&this.closable&&mle(this.closeButtonRef.value)}handleDefaultSlotChange(){this.updateHasText()}close(){this.calciteChipClose.emit(),this.selected=!1,this.closed=!0}closeButtonKeyDownHandler(e){kKe(e.key)&&(e.preventDefault(),this.close())}updateHasText(){this.hasText=this.el.textContent.trim().length>0}handleSlotImageChange(e){this.hasImage=gle(e)}handleEmittingEvent(){this.interactive&&this.calciteChipSelect.emit()}handleSelectionPropertyChange(e){this.selectionMode==="single"&&this.calciteInternalSyncSelectedChips.emit(),!this.parentChipGroup.selectedItems.includes(this.el)&&e&&this.selectionMode!=="multiple"&&this.calciteInternalChipSelect.emit(),this.selectionMode!=="single"&&this.calciteInternalSyncSelectedChips.emit()}renderChipImage(){return ni`<div class=${Et(El.imageContainer)}><slot name=${iet.image} @slotchange=${this.handleSlotImageChange}></slot></div>`}renderSelectionIcon(){const e=this.selectionMode==="multiple"?this.selected?bN.checkedMultiple:bN.uncheckedMultiple:this.selected?bN.checkedSingle:void 0;return ni`<div class=${Et({[El.selectIcon]:!0,[El.selectIconActive]:this.selectionMode==="multiple"||this.selected})}>${e?ni`<calcite-icon .icon=${e} .scale=${Aw(this.scale)}></calcite-icon>`:null}</div>`}renderCloseButton(){return ni`<button .ariaLabel=${this.messages.dismissLabel} class=${Et(El.close)} @click=${this.close} @keydown=${this.closeButtonKeyDownHandler} .tabIndex=${this.disabled?-1:0} ${_p(this.closeButtonRef)}><calcite-icon .icon=${bN.close} .scale=${Aw(this.scale)}></calcite-icon></button>`}renderIcon(){return ni`<calcite-icon class=${Et(El.chipIcon)} .flipRtl=${this.iconFlipRtl} .icon=${this.icon} .scale=${Aw(this.scale)}></calcite-icon>`}render(){const{disabled:e}=this,i=e||!e&&!this.interactive,r=this.selectionMode==="multiple"&&this.interactive?"checkbox":this.selectionMode!=="none"&&this.interactive?"radio":this.interactive?"button":"img";return j9({disabled:e,children:ni`<div .ariaChecked=${this.selectionMode!=="none"&&this.interactive?this.selected:void 0} .ariaLabel=${this.label} class=${Et({[El.container]:!0,[El.textSlotted]:this.hasText,[El.imageSlotted]:this.hasImage,[El.selectable]:this.selectionMode!=="none",[El.multiple]:this.selectionMode==="multiple",[El.single]:this.selectionMode==="single"||this.selectionMode==="single-persist",[El.selected]:this.selected,[El.closable]:this.closable,[El.nonInteractive]:!this.interactive,[El.isCircle]:!this.closable&&!this.hasText&&(!this.icon||!this.hasImage)&&(this.selectionMode==="none"||!!this.selectionMode&&this.selectionMode!=="multiple"&&!this.selected)})} @click=${this.handleEmittingEvent} .role=${r} .tabIndex=${i?-1:0} ${_p(this.containerRef)}>${this.selectionMode!=="none"&&this.renderSelectionIcon()||""}${this.renderChipImage()}${this.icon&&this.renderIcon()||""}<span class=${Et(El.title)}><slot @slotchange=${this.handleDefaultSlotChange}></slot></span>${this.closable&&this.renderCloseButton()||""}</div>`})}};S9.properties={hasImage:[16,{},{state:!0}],hasText:[16,{},{state:!0}],appearance:[3,{},{reflect:!0}],closable:[7,{},{reflect:!0,type:Boolean}],closed:[7,{},{reflect:!0,type:Boolean}],closeOnDelete:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],interactive:[5,{},{type:Boolean}],kind:[3,{},{reflect:!0}],label:1,messageOverrides:[0,{},{attribute:!1}],parentChipGroup:[0,{},{attribute:!1}],scale:[3,{},{reflect:!0}],selected:[7,{},{reflect:!0,type:Boolean}],selectionMode:1,value:1},S9.styles=ret;let B8=S9;ty("calcite-chip",B8);const vsi=Object.freeze(Object.defineProperty({__proto__:null,Chip:B8},Symbol.toStringTag,{value:"Module"}));const e_e=DL(class extends kL{constructor(){super(...arguments),this.key=sr}render(t,e){return this.key=t,e}update(t,[e,i]){return e!==this.key&&(oOe(t),this.key=e),i}});const set=new RegExp("\\.(0+)?$"),net=new RegExp("0+$"),ds=class ds{constructor(e){if(e instanceof ds)return e;const[i,r]=pet(e).split(".").concat("");this.value=BigInt(i+r.padEnd(ds.DECIMALS,"0").slice(0,ds.DECIMALS))+BigInt(ds.ROUNDED&&r[ds.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace("-","").padStart(ds.DECIMALS+1,"0"),i=e.slice(0,-ds.DECIMALS),r=e.slice(-ds.DECIMALS).replace(net,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&s.unshift({type:"minusSign",value:e.minusSign}),r.length&&(s.push({type:"decimal",value:e.decimal}),r.split("").forEach(n=>s.push({type:"fraction",value:n}))),s}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,n=r.length?`${e.decimal}${r.split("").map(a=>e.numberFormatter.format(Number(a))).join("")}`:"";return`${s}${n}`}add(e){return ds.fromBigInt(this.value+new ds(e).value)}subtract(e){return ds.fromBigInt(this.value-new ds(e).value)}multiply(e){return ds._divRound(this.value*new ds(e).value,ds.SHIFT)}divide(e){return ds._divRound(this.value*ds.SHIFT,new ds(e).value)}};ds.DECIMALS=100,ds.ROUNDED=!0,ds.SHIFT=BigInt("1"+"0".repeat(ds.DECIMALS)),ds._divRound=(e,i)=>ds.fromBigInt(e/i+(ds.ROUNDED?e*BigInt(2)/i%BigInt(2):BigInt(0))),ds.fromBigInt=e=>Object.assign(Object.create(ds.prototype),{value:e,isNegative:e<BigInt(0)});let b5=ds;function _le(t){return!(!t||isNaN(Number(t)))}function _si(t){return!t||!fet(t)?"":q8(t,e=>{let i=!1;const r=e.split("").filter((s,n)=>s.match(/\./g)&&!i?(i=!0,!0):s.match(/-/g)&&n===0?!0:yle.includes(s)).join("");return _le(r)?new b5(r).toString():""})}const BOe=/^([-0])0+(?=\d)/,aet=/(?!^\.)\.$/,oet=/(?!^-)-/g,cet=/^-\b0\b\.?0*$/,uet=/0*$/,het=new Set(["e","E","-",",",".",...yle]),bsi=t=>{const e=Array.from(t).filter(i=>het.has(i)).join("");return q8(e,i=>{const r=i.replace(oet,"").replace(aet,"").replace(BOe,"$1");return _le(r)?cet.test(r)?r:det(r):i})};function det(t){const e=t.split(".")[1],i=new b5(t).toString(),[r,s]=i.split(".");return e&&s!==e?`${r}.${e}`:i}function q8(t,e){if(!t)return t;const i=t.toLowerCase().indexOf("e")+1;return i?t.replace(/[eE]*$/g,"").substring(0,i).concat(t.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,s)=>e(s===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e"):e(t)}function pet(t){const e=t.split(/[eE]/);if(e.length===1)return t;const i=+t;if(Number.isSafeInteger(i))return`${i}`;const r=t.charAt(0)==="-",s=+e[1],n=e[0].split("."),a=(r?n[0].substring(1):n[0])||"",o=n[1]||"",l=(f,g)=>{const v=Math.abs(g)-f.length,_=v>0?`${"0".repeat(v)}${f}`:f;return`${_.slice(0,g)}.${_.slice(g)}`},u=(f,g)=>{const v=g>f.length?`${f}${"0".repeat(g-f.length)}`:f;return`${v.slice(0,g)}.${v.slice(g)}`},d=s>0?`${a}${u(o,s)}`:`${l(a,s)}${o}`;return`${r?"-":""}${d.charAt(0)==="."?"0":""}${d.replace(set,"").replace(BOe,"")}`}function fet(t){return yle.some(e=>t.includes(e))}function wsi(t,e,i){const r=e.split(".")[1];if(r){const s=r.match(uet)[0];if(s&&i.delocalize(t).length!==e.length&&r.indexOf("e")===-1){const n=i.decimal;return t=t.includes(n)?t:`${t}${n}`,t.padEnd(t.length+s.length,i.localize("0"))}}return t}const G8="en",met=["ar","bg","bs","ca","cs","da","de","de-AT","de-CH","el",G8,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"];new Map(Object.entries({bg:{am:"..",pm:".."},bs:{am:"prijepodne",pm:"popodne"},ca:{am:"a.m.",pm:"p.m."},cs:{am:"dop.",pm:"odp."},es:{am:"a.m.",pm:"p.m."},"es-mx":{am:"a.m.",pm:"p.m."},"es-MX":{am:"a.m.",pm:"p.m."},fi:{am:"ap.",pm:"ip."},he:{am:"",pm:""},hu:{am:"de. ",pm:"du."},lt:{am:"priepiet",pm:"popiet"},lv:{am:"priekpusdien",pm:"pcpusdien"},mk:{am:".",pm:"."},no:{am:"a.m.",pm:"p.m."},nl:{am:"a.m.",pm:"p.m."},"pt-pt":{am:"da manh",pm:"da tarde"},"pt-PT":{am:"da manh",pm:"da tarde"},ro:{am:"a.m.",pm:"p.m."},sl:{am:"dop.",pm:"pop."},sv:{am:"fm",pm:"em"},th:{am:"",pm:""},tr:{am:"",pm:"S"},uk:{am:"",pm:""},vi:{am:"SA",pm:"CH"}}));const get=["arab","arabext","latn"],NY=[...met],qOe=t=>get.includes(t),VY=new Intl.NumberFormat().resolvedOptions().numberingSystem,GOe=VY==="arab"||!qOe(VY)?"latn":VY,yet=t=>qOe(t)?t:GOe;function vet(t){return t?NY.includes(t)?t:(t=t.toLowerCase(),t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(e,i,r)=>`${i}-${r.toUpperCase()}`),NY.includes(t)||(t=t.split("-")[0])),t==="nb"||t==="nn"?"no":t==="zh"?"zh-CN":NY.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),G8)):G8}class HOe{constructor(){this.delocalize=e=>this._numberFormatOptions?q8(e,i=>i.replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?q8(e,i=>_le(i.trim())?new b5(i.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):i):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=vet(e?.locale),e.numberingSystem=yet(e?.numberingSystem),!this._numberFormatOptions&&e.locale===G8&&e.numberingSystem===GOe&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const i=new Map(this._digits.map((s,n)=>[s,n])),r=new Intl.NumberFormat(this._numberFormatOptions.locale,{numberingSystem:this._numberFormatOptions.numberingSystem}).formatToParts(-123456789e-1);this._actualGroup=r.find(s=>s.type==="group").value,this._group=this._actualGroup.trim().length===0||this._actualGroup==" "?"":this._actualGroup,this._decimal=e.locale==="bs"||e.locale==="mk"?",":r.find(s=>s.type==="decimal").value,this._minusSign=r.find(s=>s.type==="minusSign").value,this._getDigitIndex=s=>i.get(s)}}const xsi=new HOe;function t_e(t){return t[t.openProp||"open"]}async function _et(t){await t.updateComplete,t_e(t)?t.onBeforeOpen():t.onBeforeClose(),await t.updateComplete,t.transitionEl&&await vKe(t.transitionEl,t.transitionProp),t_e(t)?t.onOpen():t.onClose()}const bet={brand:"lightbulb",danger:"exclamationMarkTriangle",info:"information",success:"checkCircle",warning:"exclamationMarkTriangle"};const jY={slow:14e3,medium:1e4,fast:6e3},wN={actionsEnd:"actions-end",title:"title",message:"message",link:"link"},fd={actionsEnd:"actions-end",close:"close",container:"container",containerActive:"container--active",dismissProgress:"dismiss-progress",icon:"icon",containerEmbedded:"container--embedded",queueCount:"queue-count",queueCountActive:"queue-count--active",textContainer:"text-container",focused:"focused"},wet=300;class xet{constructor(){this.registeredElements=[],this.queueTimeoutId=null}registerElement(e){const{registeredElements:i}=this;if(!i.includes(e)){switch(e.queue){case"immediate":i.unshift(e);break;case"next":i.splice(1,0,e);break;case"last":i.push(e);break}this.updateAlerts()}}unregisterElement(e){const{registeredElements:i}=this,r=i.indexOf(e);r!==-1&&i.splice(r,1),e.active=!1,this.updateAlerts()}updateAlerts(){window.clearTimeout(this.queueTimeoutId),this.queueTimeoutId=null,this.registeredElements.forEach((e,i)=>{e.openAlertCount=this.registeredElements.length,i===0?this.queueTimeoutId=window.setTimeout(()=>e.active=!0,wet):e.active=!1})}}const Tet=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{display:block;inline-size:var(--calcite-alert-width)}.container{pointer-events:none;position:fixed;z-index:var(--calcite-z-index-toast);margin-inline:auto;margin-block:0px;box-sizing:border-box;display:flex;inline-size:100%;min-inline-size:min-content;align-items:center;justify-content:center;text-align:start;opacity:0;--tw-shadow: 0 6px 20px -4px rgba(0, 0, 0, .1), 0 4px 12px -2px rgba(0, 0, 0, .08);--tw-shadow-colored: 0 6px 20px -4px var(--tw-shadow-color), 0 4px 12px -2px var(--tw-shadow-color);box-shadow:var(--calcite-alert-shadow, var(--tw-ring-offset-shadow, 0 0 rgba(0, 0, 0, 0)), var(--tw-ring-shadow, 0 0 rgba(0, 0, 0, 0)), var(--tw-shadow));background-color:var(--calcite-alert-background-color, var(--calcite-color-foreground-1));border-radius:var(--calcite-alert-corner-radius, var(--calcite-border-radius));border-block-start:0 solid transparent;border-inline:1px solid var(--calcite-color-border-3);border-block-end:1px solid var(--calcite-color-border-3);max-inline-size:calc(100% - var(--calcite-alert-offset-size, 2rem) * 2);transition:opacity var(--calcite-internal-animation-timing-slow) cubic-bezier(.215,.44,.42,.88),all var(--calcite-animation-timing) ease-in-out}.container--bottom,.container--top{inset-inline-end:0;inset-inline-start:0}.container[class*=bottom]{transform:translate3d(0,var(--calcite-alert-offset-size, 2rem),0);inset-block-end:var(--calcite-alert-offset-size, 2rem)}.container[class*=top]{transform:translate3d(0,calc(-1 * var(--calcite-alert-offset-size, 2rem)),0);inset-block-start:var(--calcite-alert-offset-size, 2rem)}.container[class*=start]{inset-inline-start:var(--calcite-alert-offset-size, 2rem);inset-inline-end:auto}.container[class*=end]{inset-inline-end:var(--calcite-alert-offset-size, 2rem);inset-inline-start:auto}.icon{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0;margin-block:auto;margin-inline-end:auto}.close{display:flex;cursor:pointer;align-items:center;justify-content:flex-end;align-self:stretch;border-style:none;background-color:transparent;color:var(--calcite-color-text-3);outline:2px solid transparent;outline-offset:2px;-webkit-appearance:none;border-start-end-radius:var(--calcite-alert-corner-radius, var(--calcite-border-radius));border-end-end-radius:var(--calcite-alert-corner-radius, var(--calcite-border-radius));outline-color:transparent}.close:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(calc(-1 * var(--calcite-spacing-base)) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.close:hover,.close:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-2)}.close:active{background-color:var(--calcite-color-foreground-3)}.queue-count{visibility:hidden;display:flex;min-inline-size:min-content;cursor:default;align-items:center;justify-content:space-around;align-self:stretch;overflow:hidden;text-align:center;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-2);opacity:0;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;border-inline:0 solid transparent;border-start-end-radius:0}.queue-count--active{visibility:visible;opacity:1}.dismiss-progress{position:absolute;display:block;inline-size:100%;overflow:hidden;inset-inline:0;inset-block-start:-2px;block-size:2px;border-radius:var(--calcite-border-radius) var(--calcite-border-radius) 0 0}.dismiss-progress:after{position:absolute;inset-block-start:0px;display:block;block-size:2px;content:"";background-color:var(--calcite-color-transparent-tint);inset-inline-end:0}.actions-end{display:flex;align-self:stretch}.text-container{box-sizing:border-box;display:flex;min-inline-size:0px;flex:1 1 auto;flex-direction:column;overflow-wrap:break-word}.footer{position:relative;display:flex;inline-size:auto;justify-content:flex-end;align-self:stretch;padding-block-start:1px;block-size:inherit}:host([scale=s]) slot[name=title]::slotted(*),:host([scale=s]) *::slotted([slot=title]){font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=s]) slot[name=message]::slotted(*),:host([scale=s]) *::slotted([slot=message]){font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) slot[name=link]::slotted(*),:host([scale=s]) *::slotted([slot=link]){font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) .queue-count{margin-inline:.5rem}:host([scale=s]) .container{--calcite-internal-alert-min-height: 3.5rem;inline-size:var(--calcite-alert-width, 40em)}:host([scale=s]) .close{padding:.75rem}:host([scale=s]) .icon{padding-inline-start:.75rem}:host([scale=s]) .text-container{padding-block:.5rem;padding-inline:.75rem .5rem}:host([scale=m]) slot[name=title]::slotted(*),:host([scale=m]) *::slotted([slot=title]){font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=m]) slot[name=message]::slotted(*),:host([scale=m]) *::slotted([slot=message]){font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) slot[name=link]::slotted(*),:host([scale=m]) *::slotted([slot=link]){font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) .queue-count{margin-inline:.75rem}:host([scale=m]) .container{--calcite-internal-alert-min-height: 4.1875rem;inline-size:var(--calcite-alert-width, 50em)}:host([scale=m]) .close{padding:1rem}:host([scale=m]) .icon{padding-inline-start:1rem}:host([scale=m]) .text-container{padding-block:.75rem;padding-inline:1rem .75rem}:host([scale=l]) slot[name=title]::slotted(*),:host([scale=l]) *::slotted([slot=title]){margin-block-end:.25rem;font-size:var(--calcite-font-size-1);line-height:1.375}:host([scale=l]) slot[name=message]::slotted(*),:host([scale=l]) *::slotted([slot=message]){font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) slot[name=link]::slotted(*),:host([scale=l]) *::slotted([slot=link]){font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) .queue-count{margin-inline:1rem}:host([scale=l]) .container{--calcite-internal-alert-min-height: 5.625rem;inline-size:var(--calcite-alert-width, 60em)}:host([scale=l]) .close{padding:1.25rem}:host([scale=l]) .icon{padding-inline-start:1.25rem}:host([scale=l]) .text-container{padding-block:1rem;padding-inline:1.25rem 1rem}:host([open]) .container--active{border-block-start-width:2px;opacity:1;pointer-events:initial}:host([open]) .container--active[class*=bottom]{transform:translate3d(0,calc(-1 * var(--calcite-alert-offset-size, 2rem)),inherit)}:host([open]) .container--active[class*=top]{transform:translate3d(0,var(--calcite-alert-offset-size, 2rem),inherit)}:host([auto-close])>.queue-count{border-inline-end:0 solid transparent}slot[name=title]::slotted(*),*::slotted([slot=title]){font-size:var(--calcite-font-size-0);line-height:1.375;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1)}slot[name=message]::slotted(*),*::slotted([slot=message]){margin:0;display:inline;font-size:var(--calcite-font-size--1);line-height:1.375;font-weight:var(--calcite-font-weight-normal);margin-inline-end:.5rem;color:var(--calcite-color-text-2)}slot[name=link]::slotted(*),*::slotted([slot=link]){display:inline-flex;color:var(--calcite-color-text-link)}:host([kind=brand]) .container{border-block-start-color:var(--calcite-color-brand)}:host([kind=brand]) .container .icon{color:var(--calcite-color-brand)}:host([kind=info]) .container{border-block-start-color:var(--calcite-color-status-info)}:host([kind=info]) .container .icon{color:var(--calcite-color-status-info)}:host([kind=danger]) .container{border-block-start-color:var(--calcite-color-status-danger)}:host([kind=danger]) .container .icon{color:var(--calcite-color-status-danger)}:host([kind=success]) .container{border-block-start-color:var(--calcite-color-status-success)}:host([kind=success]) .container .icon{color:var(--calcite-color-status-success)}:host([kind=warning]) .container{border-block-start-color:var(--calcite-color-status-warning)}:host([kind=warning]) .container .icon{color:var(--calcite-color-status-warning)}:host([auto-close-duration=fast]) .dismiss-progress:after{animation:dismissProgress 6s ease-out}:host(:hover[auto-close-duration=fast]) .dismiss-progress:after,:host(:focus[auto-close-duration=fast]) .dismiss-progress:after{animation-play-state:paused}:host([auto-close-duration=medium]) .dismiss-progress:after{animation:dismissProgress 10s ease-out}:host(:hover[auto-close-duration=medium]) .dismiss-progress:after,:host(:focus[auto-close-duration=medium]) .dismiss-progress:after{animation-play-state:paused}:host([auto-close-duration=slow]) .dismiss-progress:after{animation:dismissProgress 14s ease-out}:host(:hover[auto-close-duration=slow]) .dismiss-progress:after,:host(:focus[auto-close-duration=slow]) .dismiss-progress:after{animation-play-state:paused}.container.focused .dismiss-progress:after{animation-play-state:paused}@keyframes dismissProgress{0%{inline-size:0px;opacity:.75}to{inline-size:100%;opacity:1}}.container--embedded{position:absolute}:host([hidden]){display:none}[hidden]{display:none}:host([calcite-hydrated-hidden]){visibility:hidden!important;pointer-events:none}`,vC=new xet,T9=class T9 extends Wo{constructor(){super(...arguments),this.autoCloseTimeoutId=null,this.transitionProp="opacity",this.totalHoverTime=0,this.totalOpenTime=0,this.messages=FL(),this.focusSetter=zL()(this),this.hasEndActions=!1,this.isFocused=!1,this.numberStringFormatter=new HOe,this.active=!1,this.autoClose=!1,this.autoCloseDuration="medium",this.embedded=!1,this.iconFlipRtl=!1,this.kind="brand",this.open=!1,this.openAlertCount=0,this.placement="bottom",this.queue="last",this.scale="m",this.calciteAlertBeforeClose=$a({cancelable:!1}),this.calciteAlertBeforeOpen=$a({cancelable:!1}),this.calciteAlertClose=$a({cancelable:!1}),this.calciteAlertOpen=$a({cancelable:!1})}async setFocus(e){return this.focusSetter(()=>this.el,e)}connectedCallback(){super.connectedCallback(),this.open&&vC.registerElement(this.el),this.numberStringFormatter.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,signDisplay:"always"}}willUpdate(e){e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openHandler(),e.has("active")&&(this.hasUpdated||this.active!==!1)&&this.handleActiveChange(),e.has("autoCloseDuration")&&(this.hasUpdated||this.autoCloseDuration!=="medium")&&this.updateDuration(),e.has("queue")&&(this.hasUpdated||this.queue!=="last")&&this.handleQueueChange(),e.has("numberingSystem")&&this.numberingSystemChange(),e.has("messages")&&this.effectiveLocaleChange()}disconnectedCallback(){super.disconnectedCallback(),vC.unregisterElement(this.el),this.clearAutoCloseTimeout(),this.embedded=!1}handleActiveChange(){_et(this),this.clearAutoCloseTimeout(),this.active&&this.autoClose&&!this.autoCloseTimeoutId&&(this.initialOpenTime=Date.now(),this.autoCloseTimeoutId=window.setTimeout(()=>this.closeAlert(),jY[this.autoCloseDuration]))}openHandler(){this.open?vC.registerElement(this.el):vC.unregisterElement(this.el)}updateDuration(){this.autoClose&&this.autoCloseTimeoutId&&(this.clearAutoCloseTimeout(),this.autoCloseTimeoutId=window.setTimeout(()=>this.closeAlert(),jY[this.autoCloseDuration]))}handleQueueChange(){this.open&&(vC.unregisterElement(this.el),vC.registerElement(this.el))}handleKeyBoardFocus(){this.isFocused=!0,this.handleFocus()}handleKeyBoardBlur(){this.isFocused=!1,this.isHovered||this.handleBlur()}effectiveLocaleChange(){this.numberStringFormatter.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,signDisplay:"always"}}numberingSystemChange(){this.numberStringFormatter.numberFormatOptions={locale:this.messages._lang,numberingSystem:this.numberingSystem,signDisplay:"always"}}clearAutoCloseTimeout(){window.clearTimeout(this.autoCloseTimeoutId),this.autoCloseTimeoutId=null}setTransitionEl(e){e&&(this.transitionEl=e)}closeAlert(){this.open=!1,this.clearAutoCloseTimeout()}onBeforeOpen(){this.calciteAlertBeforeOpen.emit()}onOpen(){this.calciteAlertOpen.emit()}onBeforeClose(){this.calciteAlertBeforeClose.emit()}onClose(){this.calciteAlertClose.emit()}actionsEndSlotChangeHandler(e){this.hasEndActions=gle(e)}handleMouseOver(){this.isHovered=!0,this.handleFocus()}handleMouseLeave(){this.isHovered=!1,this.isFocused||this.handleBlur()}handleFocus(){this.clearAutoCloseTimeout(),this.totalOpenTime=Date.now()-this.initialOpenTime,this.lastMouseOverBegin=Date.now()}handleBlur(){const e=Date.now()-this.lastMouseOverBegin,i=jY[this.autoCloseDuration]-this.totalOpenTime+this.totalHoverTime;this.totalHoverTime=this.totalHoverTime?e+this.totalHoverTime:e,this.autoCloseTimeoutId=window.setTimeout(()=>this.closeAlert(),i)}render(){const{open:e,autoClose:i,label:r,placement:s,active:n,openAlertCount:a}=this,o=i?"alert":"alertdialog",l=!e,u=Eee(bet,this.icon,this.kind),d=a>1;return this.el.inert=l,this.el.ariaLabel=r,this.el.toggleAttribute("calcite-hydrated-hidden",l),this.el.role=o,ni`<div class=${Et({[fd.container]:!0,[fd.containerActive]:n,[`${fd.container}--${s}`]:!0,[fd.containerEmbedded]:this.embedded,[fd.focused]:this.isFocused})} @pointerenter=${this.autoClose&&this.autoCloseTimeoutId?this.handleMouseOver:null} @pointerleave=${this.autoClose?this.handleMouseLeave:null} ${_p(this.setTransitionEl)}>${u&&this.renderIcon(u)||""}<div class=${Et(fd.textContainer)} @focusin=${this.autoClose&&this.autoCloseTimeoutId?this.handleKeyBoardFocus:null} @focusout=${this.autoClose?this.handleKeyBoardBlur:null}><slot name=${wN.title}></slot><slot name=${wN.message}></slot><slot name=${wN.link}></slot></div>${this.renderActionsEnd()}${d?this.renderQueueCount():null}${this.renderCloseButton()}${e&&n&&i?ni`<div class=${Et(fd.dismissProgress)}></div>`:null}</div>`}renderCloseButton(){return e_e("close",ni`<button .ariaLabel=${this.messages.close} class=${Et(fd.close)} @click=${this.closeAlert} @focusin=${this.autoClose?this.handleKeyBoardFocus:null} @focusout=${this.autoClose?this.handleKeyBoardBlur:null} type=button><calcite-icon icon=x .scale=${Aw(this.scale)}></calcite-icon></button>`)}renderQueueCount(){const{openAlertCount:e}=this,i=e>2?e-1:1,r=this.numberStringFormatter.numberFormatter.format(i);return e_e("queue-count",ni`<div class=${Et({[fd.queueCount]:!0,[fd.queueCountActive]:e>1})}><calcite-chip .label=${r} .scale=${this.scale} .value=${r}>${r}</calcite-chip></div>`)}renderActionsEnd(){return ni`<div class=${Et(fd.actionsEnd)}><slot name=${wN.actionsEnd} @slotchange=${this.actionsEndSlotChangeHandler}></slot></div>`}renderIcon(e){return ni`<div class=${Et(fd.icon)}><calcite-icon .flipRtl=${this.iconFlipRtl} .icon=${e} .scale=${Aw(this.scale)}></calcite-icon></div>`}};T9.properties={hasEndActions:[16,{},{state:!0}],isFocused:[16,{},{state:!0}],numberStringFormatter:[16,{},{state:!0}],active:[5,{},{type:Boolean}],autoClose:[7,{},{reflect:!0,type:Boolean}],autoCloseDuration:[3,{},{reflect:!0}],embedded:[5,{},{type:Boolean}],icon:[3,{converter:LL},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],kind:[3,{},{reflect:!0}],label:1,messageOverrides:[0,{},{attribute:!1}],numberingSystem:[3,{},{reflect:!0}],open:[7,{},{reflect:!0,type:Boolean}],openAlertCount:[9,{},{type:Number}],placement:[3,{},{reflect:!0}],queue:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}]},T9.styles=Tet;let Aee=T9;ty("calcite-alert",Aee);const ble=Symbol.for(""),$et=t=>{if(t?.r===ble)return t?._$litStatic$},Ssi=t=>({_$litStatic$:t,r:ble}),H8=(t,...e)=>({_$litStatic$:e.reduce((i,r,s)=>i+(n=>{if(n._$litStatic$!==void 0)return n._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${n}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(r)+t[s+1],t[0]),r:ble}),i_e=new Map,Cet=t=>(e,...i)=>{const r=i.length;let s,n;const a=[],o=[];let l,u=0,d=!1;for(;u<r;){for(l=e[u];u<r&&(n=i[u],(s=$et(n))!==void 0);)l+=s+e[++u],d=!0;u!==r&&o.push(n),a.push(l),u++}if(u===r&&a.push(e[r]),d){const f=a.join("$$lit$$");(e=i_e.get(f))===void 0&&(a.raw=a,i_e.set(f,e=a)),i=o}return t(e,...i)},WOe=Cet(ni);const Met=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline}:host a,:host button{position:relative;display:flex;cursor:pointer;align-items:center;justify-content:center;border-radius:0;border-style:none;font-family:inherit;text-decoration:none;line-height:inherit;font-size:inherit;-webkit-appearance:none}:host a:hover,:host button:hover{text-decoration:none}:host a,:host button{transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform,background-size;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;outline-color:transparent}:host a:focus,:host button:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(var(--calcite-spacing-base) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}calcite-icon{inline-size:1em;block-size:1em;min-inline-size:unset;min-block-size:unset}.calcite-link--icon{vertical-align:middle;margin-block-start:-.25em}:host .calcite-link--icon.icon-start{margin-inline-end:.5rem}:host .calcite-link--icon.icon-end{margin-inline-start:.5rem}:host button,:host a{position:relative;display:inline;border-style:none;background-color:transparent;padding:0;color:var(--calcite-link-text-color, var(--calcite-color-text-link));line-height:inherit;white-space:initial;background-image:linear-gradient(currentColor,currentColor),linear-gradient(var(--calcite-color-brand-underline),var(--calcite-color-brand-underline));background-position-x:0%,100%;background-position-y:min(1.5em,100%);background-repeat:no-repeat,no-repeat;background-size:0% 1px,100% 1px}:host button:hover,:host button:focus,:host a:hover,:host a:focus{background-size:100% 1px,100% 1px}:host button:active,:host a:active{background-size:100% 2px,100% 2px}:host button.calcite--rtl,:host a.calcite--rtl{background-position:100% 100%,100% 100%}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([hidden]){display:none}[hidden]{display:none}`,xN={calciteLinkIcon:"calcite-link--icon",iconStart:"icon-start",iconEnd:"icon-end"},$9=class $9 extends Wo{constructor(){super(),this.childRef=Jw(),this.focusSetter=zL()(this),this.disabled=!1,this.download=!1,this.listen("click",this.clickHandler)}async setFocus(e){return this.focusSetter(()=>this.childRef.value,e)}updated(){V9(this)}clickHandler(e){this.disabled||e.isTrusted||this.childRef.value.click()}childElClickHandler(e){e.isTrusted||e.stopPropagation()}render(){const{download:e,el:i}=this,r=wOe(i),s=this.href?"a":"button",n=ni`<calcite-icon class=${Et({[xN.calciteLinkIcon]:!0,[xN.iconStart]:!0})} .flipRtl=${this.iconFlipRtl==="start"||this.iconFlipRtl==="both"} .icon=${this.iconStart} scale=s></calcite-icon>`,a=ni`<calcite-icon class=${Et({[xN.calciteLinkIcon]:!0,[xN.iconEnd]:!0})} .flipRtl=${this.iconFlipRtl==="end"||this.iconFlipRtl==="both"} .icon=${this.iconEnd} scale=s></calcite-icon>`,o=s==="button"?H8`button`:H8`a`,l=s==="button"?0:null;return this.el.role="presentation",j9({disabled:this.disabled,children:WOe`<${o} class=${Et({[RXe.rtl]:r==="rtl"})} download=${(s==="a"?e===!0||e===""?"":e||null:null)??lD} href=${(s==="a"&&this.href)??lD} @click=${this.childElClickHandler} rel=${(s==="a"&&this.rel)??lD} tabindex=${l} target=${(s==="a"&&this.target)??lD} ${_p(this.childRef)}>${ni`${this.iconStart?n:null}<slot></slot>${this.iconEnd?a:null}`}</${o}>`})}};$9.properties={disabled:[7,{},{reflect:!0,type:Boolean}],download:[3,{converter:LL},{reflect:!0}],href:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}],iconStart:[3,{},{reflect:!0}],rel:1,target:1},$9.styles=Met;let Oee=$9;ty("calcite-link",Oee);let cw;const al=globalThis;function ie(t){return typeof cw[t]=="function"?cw[t]=cw[t](al):cw[t]}cw=al.dojoConfig?.has||al.esriConfig?.has?{...al.dojoConfig?.has,...al.esriConfig?.has}:{},ie.add=(t,e,i,r)=>{(r||cw[t]===void 0)&&(cw[t]=e),i&&ie(t)},ie.cache=cw,ie.add("big-integer-warning-enabled",!0),ie.add("esri-deprecation-warnings",!0),ie.add("esri-tests-disable-screenshots",!1),ie.add("esri-tests-use-full-window",!1),ie.add("esri-tests-post-to-influx",!0),ie.add("esri-cim-animations-enable-status","enabled"),ie.add("esri-cim-animations-spotlight",!1),ie.add("esri-cim-animations-freeze-time",!1),(()=>{ie.add("host-webworker",al.WorkerGlobalScope!==void 0&&self instanceof al.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ie.add("host-browser",t),ie.add("host-node",!(typeof al.process!="object"||!al.process.versions?.node||!al.process.versions.v8)),ie.add("dom",t),ie("host-browser")){const e=navigator,i=e.userAgent,r=e.appVersion,s=parseFloat(r);if(ie.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ie.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ie.add("khtml",r.includes("Konqueror")?s:void 0),ie.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ie.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ie.add("webkit",!ie("wp")&&!ie("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ie.add("chrome",!ie("edge")&&!ie("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ie.add("android",!ie("wp")&&parseFloat(i.split("Android ")[1])||void 0),ie.add("safari",!r.includes("Safari")||ie("wp")||ie("chrome")||ie("android")||ie("edge")||ie("opr")?void 0:parseFloat(r.split("Version/")[1])),ie.add("mac",r.includes("Macintosh")),!ie("wp")&&/(iPhone|iPod|iPad)/.test(i)){const n=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",o=parseFloat(a.replace(/_/,".").replaceAll("_",""));ie.add(n,o),ie.add("ios",o)}ie("webkit")||(!i.includes("Gecko")||ie("wp")||ie("khtml")||ie("edge")||ie.add("mozilla",s),ie("mozilla")&&ie.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(al.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&ie.add("esri-mobile",e),i&&ie.add("esri-iPhone",i),ie.add("esri-geolocation",!!navigator.geolocation)}ie.add("esri-wasm","WebAssembly"in al),ie.add("esri-performance-mode-frames-between-render",20),ie.add("esri-force-performance-mode",!1),ie.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in al,e=al.crossOriginIsolated===!1;return t&&!e}),ie.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ie.add("esri-atomics","Atomics"in al),ie.add("esri-workers","Worker"in al),ie.add("web-feat:cache","caches"in al),ie.add("esri-workers-arraybuffer-transfer",!ie("safari")||Number(ie("safari"))>=12),ie.add("workers-pool-size",8),ie.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ie.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ie.add("featurelayer-fast-triangulation-enabled",!0),ie.add("featurelayer-animation-enabled",!0),ie.add("featurelayer-snapshot-enabled",!0),ie.add("featurelayer-snapshot-initial-tolerance",0),ie.add("featurelayer-snapshot-point-min-threshold",8e4),ie.add("featurelayer-snapshot-point-max-threshold",4e5),ie.add("featurelayer-snapshot-multipoint-min-threshold",2e4),ie.add("featurelayer-snapshot-multipoint-max-threshold",1e5),ie.add("featurelayer-snapshot-polygon-min-threshold",2e3),ie.add("featurelayer-snapshot-polygon-max-threshold",2e3),ie.add("featurelayer-snapshot-polyline-min-threshold",2e3),ie.add("featurelayer-snapshot-polyline-max-threshold",2e3),ie.add("featurelayer-snapshot-max-vertex-count",25e4),ie.add("featurelayer-snapshot-non-hosted-exceedslimit-enabled",!0),ie.add("featurelayer-snapshot-concurrency",4),ie.add("featurelayer-snapshot-coverage",.1),ie.add("featurelayer-query-max-depth",4),ie.add("featurelayer-query-pausing-enabled",!1),ie.add("featurelayer-query-tile-concurrency",4),ie.add("featurelayer-query-tile-max-features",6e5),ie.add("featurelayer-advanced-symbols",!1),ie.add("featurelayer-pbf",!0),ie.add("featurelayer-pbf-statistics",!1),ie.add("feature-layers-workers",!0),ie.add("feature-polyline-generalization-factor",1),ie.add("parquetlayer-full-query-feature-count",2e4),ie.add("parquetlayer-hittest-max-feature-count",1),ie.add("parquetlayer-persistence-enabled",!1),ie.add("mapview-transitions-duration",200),ie.add("mapview-essential-goto-duration",200),ie.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ie.add("mapserver-pbf-version-support",10.81),ie.add("mapservice-popup-identify-max-tolerance",20),ie.add("request-queue-concurrency-hosted",16),ie.add("request-queue-concurrency-non-hosted",4),ie.add("curve-densification-coarse-segments",128),ie.add("curve-densification-max-segments",2e3),ie.add("curve-densification-min-segments",3),ie.add("curve-densification-pixel-deviation",.5),ie.add("view-readyState-waiting-delay",1e3),ie.add("gradient-depth-bias",.01),ie.add("gradient-depth-epsilon",1e-8),ie.add("enable-feature:esri-compress-textures",!0),ie("host-webworker")||ie("host-browser")&&(ie.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ie.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function Tsi(t){}function Eet(t){return()=>t}function $si(t){return t}var $u;let Aet=($u=class{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*$u._m}getInt(){return this._seed=($u._a*this._seed+$u._c)%$u._m,this._seed}getFloat(){return this.getInt()/($u._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/$u._m*r}},$u._m=2147483647,$u._a=48271,$u._c=0,$u);const B9=1.5,Oet=1/B9,Pet=.5;function r_e(t,e){if(!e)return t;for(const i of e)t.push(i);return t}function ZOe(t){return t}function Ret(t,e=ZOe){if(!t||t.length===0)return;let i=t[0],r=e(i);for(let s=1;s<t.length;++s){const n=t[s],a=Number(e(n));a>r&&(r=a,i=n)}return i}function YOe(t,e=ZOe){return Ret(t,i=>-e(i))}function SS(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function JOe(t,e,i,r,s,n,a){if(t==null&&r==null)return!0;e=Math.max(0,e),s=Math.max(0,s),i=Math.max(0,i<0?(t?.length??0)+i:i),n=Math.max(0,n<0?(r?.length??0)+n:n);const o=i-e;if(t==null||r==null||o!==n-s)return!1;if(a){for(let l=0;l<o;l++)if(!a(t[e+l],r[s+l]))return!1}else for(let l=0;l<o;l++)if(t[e+l]!==r[s+l])return!1;return!0}function E0(t,e,i){return JOe(t,0,t?.length??0,e,0,e?.length??0,i)}function Iet(){return(t,e)=>{if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}}function Det(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function W8(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(a=>i(a,n))),s=t.filter(n=>!e.some(a=>i(a,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function ket(t){return t&&typeof t.length=="number"}function Let(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function Csi(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const o=s+Math.floor((n-s)/2);e>t[o]?s=o+1:n=o}const a=t[s];return i?e>=t[r-1]?-1:a===e?s:s-1:a===e?s:-1}let wle=class{constructor(){this.last=0}};const QOe=new wle;function w5(t,e,i,r){r=r||QOe;const s=Math.max(0,r.last-10);for(let a=s;a<i;++a)if(t[a]===e)return r.last=a,a;const n=Math.min(s,i);for(let a=0;a<n;++a)if(t[a]===e)return r.last=a,a;return-1}function Uc(t,e,i,r){const s=t.length,n=w5(t,e,s,r);if(n!==-1)return t[n]=t[s-1],t.pop(),e}const qp=new Set;function Fet(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;qp.clear();for(let o=0;o<r;++o)qp.add(e[o]);s=s||QOe;const a=Math.max(0,s.last-10);for(let o=a;o<i;++o)if(qp.has(t[o])&&(n?.push(t[o]),qp.delete(t[o]),t[o]=t[i-1],--i,--o,qp.size===0||i===0))return qp.clear(),i;for(let o=0;o<a;++o)if(qp.has(t[o])&&(n?.push(t[o]),qp.delete(t[o]),t[o]=t[i-1],--i,--o,qp.size===0||i===0))return qp.clear(),i;return qp.clear(),i}function q9(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}return t.length=i,t}function Esi(t,e,i){const r=t.length;if(e>=r)return t.slice();const s=xle(i),n=new Set,a=[];for(;a.length<e;){const o=Math.floor(s()*r);n.has(o)||(n.add(o),a.push(t[o]))}return a}function xle(t){return t?(s_e.seed=t,()=>s_e.getFloat()):Math.random}const s_e=new Aet;function XOe(t,e){if(!t)return t;const i=xle(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}function oP(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function wl(t,e){return t!=null}const zet=[];function cD(t){return t instanceof ArrayBuffer}function Sle(t){return t?.constructor?.name==="Int8Array"}function TS(t){return t?.constructor?.name==="Uint8Array"}function KOe(t){return t?.constructor?.name==="Uint8ClampedArray"}function Tle(t){return t?.constructor?.name==="Int16Array"}function G9(t){return t?.constructor?.name==="Uint16Array"}function $le(t){return t?.constructor?.name==="Int32Array"}function Cle(t){return t?.constructor?.name==="Uint32Array"}function ePe(t){return t?.constructor?.name==="Float16Array"}function NL(t){return t?.constructor?.name==="Float32Array"}function VL(t){return t?.constructor?.name==="Float64Array"}function lP(t){return"buffer"in t}const Hc=1024;function Asi(t){return VL(t)||NL(t)||$le(t)||Tle(t)||Sle(t)}function Osi(t){return VL(t)||NL(t)}function Psi(t){return VL(t)?179769e303:ePe(t)?65504:NL(t)?3402823e32:Cle(t)?4294967295:G9(t)?65535:TS(t)||KOe(t)?255:$le(t)?2147483647:Tle(t)?32767:Sle(t)?127:256}const Rsi=-32768,Isi=-2147483648,Xn=65535;function Dsi(t){return t}function Net(t,e){let i;for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function se(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=rPe(t);if(e!=null)return e;if(d4(t))return t.clone();if(tPe(t))return t.map(se);if(iPe(t))throw new Error("Trying to clone an unclonable Accessor instance");const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=se(t[r]);return i}function Pee(t,e){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const i=rPe(t);if(i!=null)return i;if(tPe(t)){let s=!0;const n=t.map(a=>{const o=Pee(a,e);return a!=null&&o==null&&(s=!1),o});return s?n:null}if(d4(t))return t.clone(e);if(t instanceof File||t instanceof Blob)return t;if(iPe(t))return null;const r=new(Object.getPrototypeOf(t)).constructor;for(const s of Object.getOwnPropertyNames(t)){const n=t[s],a=Pee(n);if(n!=null&&a==null)return null;r[s]=a}return r}function d4(t){return typeof t.clone=="function"}function tPe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function iPe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function n_e(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function rPe(t){if(Sle(t)||TS(t)||KOe(t)||Tle(t)||G9(t)||$le(t)||Cle(t)||NL(t)||VL(t))return t.slice();if(t instanceof Date)return new Date(t);if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,se(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(se(i));return e}return null}function Mle(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof t?.getTime=="function"&&typeof e?.getTime=="function"&&t.getTime()===e.getTime()||!1}function sPe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&E0(t,e):t instanceof Set?e instanceof Set&&jet(t,e):t instanceof Map?e instanceof Map&&Uet(t,e):!!n_e(t)&&n_e(e)&&Vet(t,e))}function Vet(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function jet(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function Uet(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function Ele(t,e,i=!1){return aPe(t,e,i)}function jL(t,e){if(e!=null)return e[t]||nPe(t.split("."),!1,e)}function ra(t,e,i){const r=t.split("."),s=r.pop(),n=nPe(r,!0,i);n&&s&&(n[s]=e)}function a_e(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(a_e(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(a_e(t[i],e[i]))return!0;return!1}return t!==e}function nPe(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function aPe(t,e,i){return e?Object.keys(e).reduce((r,s)=>{if(s==="__proto__")return r;let n=r[s],a=e[s];return n===a?r:n===void 0?(r[s]=se(a),r):(Array.isArray(a)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.slice():r[s]=[n]:r[s]=[],a&&(Array.isArray(a)||(a=[a]),i?a.forEach(o=>{n.includes(o)||n.push(o)}):r[s]=a.slice())):a&&typeof a=="object"?r[s]=aPe(n,a,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=a),r)},t||{}):t}function Bet(t,e){for(const i of Object.entries(t))if(e===i[1])return i[0]}function H9(t,e){return Object.values(t).includes(e)}const fr={apiKey:void 0,apiKeys:{scopes:[]},applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:62e3,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Ele(fr,globalThis.esriConfig,!0),delete fr.has),!fr.assetsPath){{const t="4.34";fr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}fr.defaultAssetsPath=fr.assetsPath}const qet=/\{([^}]+)\}/g;function o_e(t){return t??""}function Q0(t,e){return e?t.replaceAll(qet,typeof e=="object"?(i,r)=>o_e(jL(r,e)):(i,r)=>o_e(e(r))):t}function ksi(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e?.includes(i)?i:`\\${i}`)}function oPe(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let l_e;function Lsi(t){return l_e??=new DOMParser,l_e.parseFromString(t||"","text/html").body.innerText||""}function Fsi(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function Get(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const c_e={info:0,warn:1,error:2,none:3};var ga;let re=(ga=class{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,ga._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=ga.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,ga._loggers.get(e)||new ga({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!ga._throttlingDisabled){const s=Wet(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=ga._tickCounter)return;this._loggedMessages[e].set(s,ga._tickCounter),ga._scheduleTickCounterIncrement()}for(const s of fr.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",Het)}_matchLevel(e){const i=fr.log.level||"warn";return c_e[this._parentWithMember("level",i)]<=c_e[e]}static _scheduleTickCounterIncrement(){ga._tickCounterScheduled||(ga._tickCounterScheduled=!0,Promise.resolve().then(()=>{ga._tickCounter++,ga._tickCounterScheduled=!1}))}},ga._loggers=new Map,ga._tickCounter=0,ga._tickCounterScheduled=!1,ga._throttlingDisabled=!1,ga);function Het(t,e,...i){console[t](`[${e}]`,...i)}function Wet(...t){return oPe(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}const Zet={remove:()=>{}};function bi(t){return t?{remove(){t&&(t(),t=void 0)}}:Zet}function lPe(t){t.forEach(e=>e?.remove())}function Om(t){lPe(t),t.length=0}function Yu(t){return bi(()=>lPe(t))}function zsi(t){return bi(()=>t()?.remove())}function Yet(t){return bi(()=>t?.abort())}function W9(t){return bi(t!=null?()=>t.destroy():void 0)}function Jet(t){return typeof t=="object"&&!!t&&"remove"in t&&typeof t.remove=="function"}function Qet(t){Jet(t)&&t.remove()}function Nsi(t){return{[Symbol.dispose](){t.remove()}}}function xl(t){return t.__accessor__??null}function Xet(t,e){return t?.metadata?.[e]!=null}function F6(t,e,i){return i?Z8(t,e,{policy:i,path:""}):Z8(t,e,null)}function Z8(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;if(n==="__proto__")return r;let a=null,o="merge";if(i&&(a=i.path?`${i.path}.${s}`:s,o=i.policy(a)),o==="replace"||o==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=se(e[n]),r;let l=r[n],u=e[n];if(l===u)return r;if(Array.isArray(u)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.slice():r[n]=[l]:r[n]=[],u&&(Array.isArray(u)||(u=[u]),u.forEach(d=>{l.includes(d)||l.push(d)}));else if(u&&typeof u=="object")if(i){const d=i.path;i.path=a,r[n]=Z8(l,u,i),i.path=d}else r[n]=Z8(l,u,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=u);return r},t||{}):t}function cPe(t){return Array.isArray(t)?t:t.split(".")}function u_e(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function Ket(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...u_e(i));return e}return u_e(t)}function uPe(t,e,i,r){const s=Ket(e);if(s.length!==1){const n=s.map(a=>r(t,a,i));return Yu(n)}return r(t,s[0],i)}const fn={Dirty:1,Overridden:2,Computing:4,NonNullable:8,HasDefaultValue:16,DepTrackingInitialized:32,AutoTracked:64,ExplicitlyTracking:128};let Z9=class{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){this.accessed?.clear(),this.clear()}onAccessed(e){this._observer!=null&&e!==this._observer&&(this.accessed==null&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){this._observer!=null&&(this.clear(),this.accessed!=null&&(this._handles==null&&(this._handles=[]),this.accessed.forEach(e=>{this._handles.push(e.observe(this._observer))}),this.accessed.clear()))}clear(){if(this._handles!=null){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}};const Y8=new Z9,uD=[];let p4=Y8;function Mt(t){p4.onAccessed(t)}let z6=!1,N6=!1;function Gg(t,e,i){if(z6)return Ale(t,e,i);let r=null;return hPe(t),r=e.call(i),dPe(),r}function ett(t,e){return Gg(Y8,t,e)}function Ale(t,e,i){const r=z6;z6=!0,hPe(t);let s=null;try{s=e.call(i)}catch(n){N6&&re.getLogger("esri.core.accessorSupport.tracking").error(n)}return dPe(),z6=r,s}function hPe(t){p4=t,uD.push(t)}function dPe(){const t=uD.length;if(t>1){const e=uD.pop();p4=uD[t-2],e.onTrackingEnd()}else if(t===1){const e=uD.pop();p4=Y8,e.onTrackingEnd()}else p4=Y8}function pPe(t,e){if(e.flags&fn.DepTrackingInitialized)return;e.flags|=fn.DepTrackingInitialized;const i=N6;N6=!1,e.flags&fn.AutoTracked?Ale(e.trackingTarget,e.metadata.get,t):fPe(t,e),N6=i}const ttt=[];function fPe(t,e){e.flags&fn.ExplicitlyTracking||(e.flags|=fn.ExplicitlyTracking,Ale(e.trackingTarget,()=>{const i=e.metadata.dependsOn||ttt;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=cPe(r);for(let n=0,a=t;n<s.length&&a!=null&&typeof a=="object";++n)a=h_e(a,s[n],n!==s.length-1)}else h_e(t,r,!1)}),e.flags&=-129)}function h_e(t,e,i){const r=e.endsWith("?")?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=xl(t);if(s){const n=s.propertiesByName.get(r);n&&(Mt(n),pPe(t,n))}return i?t[r]:void 0}let itt=class{constructor(e,i){this._observers=e,this._observer=i}remove(){oP(this._observers,this._observer)}},mPe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return rtt;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let a=0;a<n;++a){const o=i[a];if(o.destroyed)s=!0;else if(o===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new itt(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const rtt=bi();let d$=class extends mPe{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}},stt=class{constructor(e,i){this._observable=new d$,this._value=e,this._equalityFunction=i}get value(){return Mt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function ta(t,e=sPe){return new stt(t,e)}let UL=class extends Z9{constructor(e){super(new ntt(e)),this._observer&&d_e.register(this,new WeakRef(this._observer),this)}destroy(){this._observer&&d_e.unregister(this._observer),this.accessed?.clear(),this.clear(),this._observer?.destroy()}},ntt=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=att}};const d_e=new FinalizationRegistry(t=>{t.deref()?.destroy()});function att(){}function gPe(){return new d$}function ott(t){return new UL(t)}function yPe(t){Mt(t)}function ltt(t,e){return Gg(t,e)}const ctt=Sl`:host{display:block;box-sizing:border-box;*,*:before,*:after{box-sizing:inherit}}:host([hidden]){display:none}:host(:not(arcgis-basemap-gallery-item,arcgis-layer-list-item,arcgis-print-custom-text-elements,arcgis-print-dpi-input,arcgis-print-export-button,arcgis-print-exported-link,arcgis-print-exports-panel,arcgis-print-format-select,arcgis-print-layout-advanced-options,arcgis-print-layout-panel,arcgis-print-main-panel,arcgis-print-map-only-advanced-options,arcgis-print-map-only-panel,arcgis-print-out-spatial-reference-input,arcgis-print-preview-input,arcgis-print-scale-section,arcgis-print-template-select,arcgis-print-template-selector,arcgis-labeled-switch,arcgis-measurement-content,arcgis-version-management-service-item,arcgis-version-management-version-item,arcgis-version-management-version-list,arcgis-version-management-version-properties,arcgis-video-player-action-bar,arcgis-video-player-actions-group,arcgis-video-player-controls-group,arcgis-video-player-metadata,arcgis-video-player-settings,arcgis-video-player-slider)){font-family:var(--calcite-font-family)}`,BL=hOe({defaultAssetPath:"https://js.arcgis.com/4.34/map-components/",hydratedAttribute:"hydrated",commonStyles:ctt}),{customElement:p$,getAssetPath:utt,setAssetPath:Wsi}=BL;BL.t=yPe;BL.o=gPe;BL.c=ott;BL.r=ltt;function Y9(t){return htt(t)||vPe(t)}function htt(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function vPe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function f$(t,e,i){if(!Y9(t))throw new TypeError("target is not a Evented or EventTarget object");return vPe(t)?dtt(t,e,i):t.on(e,i)}function dtt(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return bi(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),bi(()=>t.removeEventListener(e,i,r))}function J8(t,e,i){if(!Y9(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=f$(t,e,s=>{r.remove(),i.call(t,s)});return r}function cP(t,e){if(t==null)throw new Error(e??"value is None")}function Pe(t){return t?.destroy(),null}function jt(t){return t?.dispose(),null}function Xi(t){return t?.remove(),null}function Rs(t){return t?.abort(),null}function Lr(t){return t?.release(),null}function Ree(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function p_e(t,e){return t?.[e]}function ptt(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}function ftt(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return bi(()=>t.clearTimeout(r))}}}const m$=ftt(globalThis);function mtt(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(jL(r,e)??"").toString())}let _Pe=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&mtt(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},q=class bPe extends _Pe{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return se(i)}catch{return"[object]"}}))}}catch(e){throw re.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new bPe(e.name,e.message,e.details)}};q.prototype.type="error";function ti(t="Aborted"){return new q("AbortError",t)}function ct(t,e="Aborted"){if(sa(t))throw ti(e)}function gtt(t,e="Aborted"){if(t?.destroyed)throw ti(e)}function qL(t){return t instanceof AbortSignal?t:t?.signal??void 0}function sa(t){const e=qL(t);return e!=null&&e.aborted}function ml(t){if(Zr(t))throw t}function Iee(t){if(!Zr(t))throw t}function Mo(t,e){const i=qL(t);if(i!=null){if(!i.aborted)return J8(i,"abort",()=>e());e()}}function GL(t,e){const i=qL(t);if(i!=null)return ct(i),J8(i,"abort",()=>e(ti()))}function A0(t,e){return qL(e)==null?t:new Promise((i,r)=>{let s=Mo(e,()=>r(ti()));const n=()=>{s=Xi(s)};t.then(n,n),t.then(i,r)})}function Zr(t){return t?.name==="AbortError"}async function bp(t){try{return await t}catch(e){if(!Zr(e))throw e;return}}async function Ysi(t,e=re.getLogger("esri")){try{return await t}catch(i){Zr(i)||e.error(i)}}async function J9(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(a=>t[a]),s=await J9(r),n={};return i.map((a,o)=>n[a]=s[o]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function ytt(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function vtt(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function Q9(t,e=void 0,i){const r=new AbortController;return Mo(i,()=>r.abort()),new Promise((s,n)=>{let a=setTimeout(()=>{a=0,s(e)},t);Mo(r,()=>{a&&(clearTimeout(a),n(ti()))})})}function Jsi(t,e,i,r){const s=i&&"abort"in i?i:null;r!=null||s||(r=i);let n=setTimeout(()=>{n=0,s?.abort()},e);const a=()=>r||new q("promiseUtils:timeout","The wrapped promise did not resolve within "+e+" ms");return t.then(o=>{if(n===0)throw a();return clearTimeout(n),o},o=>{throw clearTimeout(n),n===0?a():o})}function _tt(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return Mo(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function Ea(t){return t&&typeof t.then=="function"}function Dee(t){return Ea(t)?t:Promise.resolve(t)}function HL(t,e=-1){let i,r,s,n,a=null;const o=(...l)=>{if(i){r=l,n&&n.reject(ti()),n=Eo();const g=n.promise;if(a){const v=a;a=null,v.abort()}return g}if(s=n||Eo(),n=null,e>0){const g=new AbortController;i=Dee(t(...l,g.signal));const v=i;Q9(e).then(()=>{i===v&&(n?g.abort():a=g)})}else i=1,i=Dee(t(...l));const u=()=>{const g=r;r=s=i=a=null,g!=null&&o(...g)},d=i,f=s;return d.then(u,u),d.then(f.resolve,f.reject),f.promise};return o}function Eo(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>m$.setTimeout(()=>r.reject(n),s),r.promise=i,r}function Qsi(t,e){return t.then(e,e)}function Xsi(t,e){e.then(t.resolve,t.reject)}async function f_e(t){await Promise.resolve(),ct(t)}function btt(t){return t?.release&&typeof t.release=="function"}function wtt(t){return t?.acquire&&typeof t.acquire=="function"}var jw;let Wc=(jw=class{constructor(e,i,r,s=1,n=0){this._creator=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n;for(let a=0;a<n;a++)this._pool[a]=this._creator();this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(jw.test.disabled)i=this._creator();else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=this._creator()}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):wtt(i)&&i.acquire(...e),i}release(e){e&&!jw.test.disabled&&(this._releaseFunction?this._releaseFunction(e):btt(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}},jw.test={disabled:!!ie("esri-tests-disable-memory-pools")},jw);function xtt(t){t.length=0}let Lc=class{constructor(e=50,i=50){this._pool=new Wc(()=>[],void 0,xtt,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return UY.acquire()}static release(e){return UY.release(e)}static prune(){UY.prune()}};const UY=new Lc(100);let wPe=class extends Wc{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const SN=[];function aO(t){SN.push(t),SN.length===1&&queueMicrotask(()=>{const e=SN.slice();SN.length=0;for(const i of e)i()})}let o0=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}push(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}set(e){e!=null&&(this._samples[this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};const Q8=(t,e,i,r)=>{let s=e,n=e;const a=i>>>1,o=t[s-1];for(;n<=a;){n=s<<1,n<i&&r(t[n-1],t[n])<0&&++n;const l=t[n-1];if(r(l,o)<=0)break;t[s-1]=l,s=n}t[s-1]=o},xPe=(t,e)=>t<e?-1:t>e?1:0;function Stt(t,e,i,r){i===void 0&&(i=t.length),r===void 0&&(r=xPe);for(let n=i>>>1;n>e;n--)Q8(t,n,i,r);const s=e+1;for(let n=i-1;n>e;n--){const a=t[e];t[e]=t[n],t[n]=a,Q8(t,s,n,r)}}function*SPe(t,e,i,r){i===void 0&&(i=t.length),r===void 0&&(r=xPe);for(let n=i>>>1;n>e;n--)Q8(t,n,i,r),yield;const s=e+1;for(let n=i-1;n>e;n--){const a=t[e];t[e]=t[n],t[n]=a,Q8(t,s,n,r),yield}}const Ttt=1.5,$tt=1.1;let Ai=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new wle,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>m_e(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,m_e(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=w5(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(w5(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=Fet(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){Stt(this.data,0,this.length,e)}iterableSort(e){return SPe(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)if(e.call(i,r[n]))return r[n]}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function m_e(t){t.data.length>Ttt*t.length&&(t.data.length=Math.floor(t.length*$tt))}function rni(t){return t}function TPe(t){return 1e3*t}function sni(t){return t}function Ole(t){return .001*t}let Ctt=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},Mtt=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},kee=0,Lee=0;const VR={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},Fee=["prepare","preRender","render","postRender","update","finish"],zee=[],Qw=new Ai;let Ett=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,$Pe()}};function Att(){$S!=null&&(cancelAnimationFrame($S),$S=requestAnimationFrame(Ple))}function $Pe(){$S==null&&(kee=performance.now(),$S=requestAnimationFrame(Ple))}const X8={frameTasks:Qw,willDispatch:!1,clearFrameTasks:Ott,dispatch:MPe,executeFrameTasks:Rtt,reschedule:Att};function uP(t){const e=new Mtt(t);return zee.push(e),X8.willDispatch||(X8.willDispatch=!0,aO(MPe)),e}function Hg(t){const e=new Ctt(t);return Qw.push(e),$Pe(),new Ett(e)}let $S=null;function Ott(t=!1){Qw.forAll(e=>{e.removed=!0}),t&&CPe()}function Ptt(t){Lee=Math.max(0,t)}function Ple(){const t=performance.now();$S=null,$S=Qw.some(i=>!i.paused&&!i.removed)?requestAnimationFrame(Ple):null,X8.executeFrameTasks(t)}function Rtt(t){const e=t-kee;kee=t;const i=Lee>0?Lee:1e3/60,r=Math.max(0,e-i);VR.time=t,VR.frameDuration=i-r;for(let s=0;s<Fee.length;s++){const n=performance.now(),a=Fee[s];Qw.forAll(o=>{o.paused||o.removed||(s===0&&o.ticks++,o.phases[a]&&(VR.elapsedFrameTime=performance.now()-t,VR.deltaTime=o.ticks===0?0:e,o.phases[a]?.call(o,VR)))}),Ltt[s].push(performance.now()-n)}CPe(),Ftt.push(performance.now()-t)}const hD=new Ai;function CPe(){Qw.forAll(t=>{t.removed&&hD.push(t)}),Qw.removeUnorderedMany(hD.data,hD.length),hD.clear()}function Itt(){Qw.prune(),hD.prune()}function MPe(){for(;zee.length;){const t=zee.shift();t.isActive&&t.callback()}X8.willDispatch=!1}function EPe(t=1,e){const i=Eo(),r=()=>{sa(e)?i.reject(ti()):t===0?i():(--t,aO(()=>r()))};return r(),i.promise}function Dtt(t){return EPe(1,t)}async function ktt(t){await Dtt(t),await new Promise(e=>requestAnimationFrame(()=>{t?.aborted||e()}))}const Ltt=Fee.map(t=>new o0(t)),Ftt=new o0("total");function rE(t,e){for(const i of t.values())if(e(i))return!0;return!1}function K8(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function g_e(t,e){return e!=null&&t.add(e),t}function Rle(t,e){const i=new Set;return K8(i,t),K8(i,e),i}function APe(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function lni(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function cni(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function ztt(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function Ntt(t,e){return ztt(Rle(t,e),APe(t,e))}let Vtt=0;const f4=0;function Gc(){return++Vtt}function OPe(t,e){const i=t.endsWith("?")?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=xl(e);return Xet(r,i)?r.get(i):e[i]}function PPe(t,e,i){if(t==null)return t;const r=OPe(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:PPe(r,e,i+1)}function WL(t,e,i=0){return typeof e!="string"||e.includes(".")?PPe(t,cPe(e),i):OPe(e,t)}function Vf(t,e){return WL(t,e)}function y_e(t,e){return WL(e,t)!==void 0}const Lh={INITIALIZING:0,CONSTRUCTING:1,CONSTRUCTED:2,DESTROYING:3,DESTROYED:4};let NE=!1;const eq=[];function RPe(t,e){let i=new UL(n),r=null,s=!1;function n(){if(!i||s)return;if(NE)return void kPe(n);const o=r;i.clear(),NE=!0,s=!0,r=Gg(i,t),s=!1,NE=!1,e(r,o),Ile()}function a(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=Gg(i,t),s=!1,bi(a)}function IPe(t,e){let i=new UL(s),r=null;function s(){e(r,a)}function n(){i&&(i.destroy(),i=null),r=null}function a(){return i?(i.clear(),r=Gg(i,t),r):null}return a(),bi(n)}function DPe(t,e){let i=!1,r=!1;const s=!!e?.sync;let n=new UL(()=>{i||r||(r=!0,s?a():queueMicrotask(a))});function a(){r=!1,n&&!i&&(NE?kPe(a):(n.clear(),NE=!0,i=!0,Gg(n,t),i=!1,NE=!1,Ile()))}function o(){n&&(n.destroy(),n=null)}return i=!0,Gg(n,t),i=!1,bi(o)}function kPe(t){eq.includes(t)||eq.unshift(t)}function Ile(){for(;eq.length;)eq.pop()()}var WS;let Dle=(WS=class{constructor(){this.uid=Gc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(0,e,i,r,s,n,Mle)}static acquireTracked(e,i,r,s){return this.pool.acquire(1,e,i,r,null,null,s)}notify(e,i){this.type===0?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,a,o){this.uid=Gc(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=a,this.equals=o}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Gc(),this.removed=!0}},WS.pool=new wPe(()=>new WS),WS);const V6=new Lc,v0=new Set;let tq;function iq(t){v0.delete(t),v0.add(t),LPe()}function LPe(){tq||(tq=uP(Btt))}function jtt(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function Utt(t){for(const e of v0.values())e.target===t&&(e.removed=!0)}function Btt(){let t=10;for(;tq&&t--;){tq=null;const e=qtt(),i=V6.acquire();for(const r of e){const s=r.uid;jtt(r),s===r.uid&&r.removed&&i.push(r)}for(const r of v0)r.removed&&(i.push(r),v0.delete(r));for(const r of i)Dle.pool.release(r);V6.release(i),V6.release(e),Nee.forEach(r=>r())}}function qtt(){const t=V6.acquire();t.length=v0.size;let e=0;for(const i of v0)t[e]=i,++e;return v0.clear(),t}const Nee=new Set;function FPe(t){return Nee.add(t),bi(()=>Nee.delete(t))}function Gtt(t,e,i){let r=uPe(t,e,i,(s,n,a)=>{let o,l,u=IPe(()=>WL(s,n),(d,f)=>{s.__accessor__?.lifecycle===Lh.DESTROYED||o&&o.uid!==l?r.remove():(o||(o=Dle.acquireUntracked(d,a,f,s,n),l=o.uid),iq(o))});return bi(()=>{u.remove(),o&&(o.uid!==l||o.removed||(o.removed=!0,iq(o)),o=null),r=u=null})});return r}function Htt(t,e,i){const r=uPe(t,e,i,(s,n,a)=>{let o=!1;return RPe(()=>WL(s,n),(l,u)=>{s.__accessor__.lifecycle!==Lh.DESTROYED?o||(o=!0,Mle(u,l)||a.call(s,l,u,n,s),o=!1):r.remove()})});return r}function Wtt(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==Lh.DESTROYED?r?Htt(t,e,i):Gtt(t,e,i):bi()}function Ztt(t,e,i){let r,s,n=IPe(t,(a,o)=>{r&&r.uid!==s?n.remove():(r||(r=Dle.acquireTracked(a,e,o,i),s=r.uid),iq(r))});return bi(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,iq(r)),r=null),n=null})}function Ytt(t,e,i){let r=!1;return RPe(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function Jtt(t,e,i=!1,r=sPe){return i?Ytt(t,e,r):Ztt(t,e,r)}function v_e(t){return rE(v0,e=>e.oldValue===t)}function X(t,e,i={}){return kle(t,e,i,zPe)}function vs(t,e,i={}){return kle(t,e,i,NPe)}function kle(t,e,i={},r){let s=null;const n=i.once?(a,o)=>{r(a)&&(Xi(s),e(a,o))}:(a,o)=>{r(a)&&e(a,o)};if(s=Jtt(t,n,i.sync,i.equals),i.initial){const a=t();n(a,a)}return s}function tn(t,e,i,r={}){let s=null,n=null,a=null;function o(){s&&n&&(n.remove(),r.onListenerRemove?.(s),s=null,n=null)}function l(d){r.once&&r.once&&Xi(a),i(d)}const u=X(t,(d,f)=>{o(),Y9(d)&&(s=d,n=f$(d,e,l),r.onListenerAdd?.(d))},{sync:r.sync,initial:!0});return a=bi(()=>{u.remove(),o()}),a}function qu(t,e){return Qtt(t,NPe,e)}function Qtt(t,e,i){if(sa(i))return Promise.reject(ti());const r=t();if(e?.(r))return Promise.resolve(r);let s=null;function n(){s=Xi(s)}return new Promise((a,o)=>{s=Yu([Mo(i,()=>{n(),o(ti())}),kle(t,l=>{n(),a(l)},{sync:!1,once:!0},e??zPe)])})}function zPe(t){return!0}function NPe(t){return!!t}function uni(t,e,i={}){let r=!1;const s=X(t,(n,a)=>{r||e(n,a)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}const Ht={sync:!0},Yt={initial:!0},bt={sync:!0,initial:!0};function c(t,e,i,r){var s=arguments.length,n=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n}function hni(t,e){return function(i,r){e(i,r,t)}}function dni(t,e,i,r){function s(n){return n instanceof i?n:new i(function(a){a(n)})}return new(i||(i=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function l(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):s(d.value).then(o,l)}u((r=r.apply(t,e||[])).next())})}function pni(t,e,i){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(i){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],i&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(n){return Promise.reject(n)}}),t.stack.push({value:e,dispose:r,async:i})}else i&&t.stack.push({async:!0});return e}var Xtt=typeof SuppressedError=="function"?SuppressedError:function(t,e,i){var r=new Error(i);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function fni(t){function e(n){t.error=t.hasError?new Xtt(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var i,r=0;function s(){for(;i=t.stack.pop();)try{if(!i.async&&r===1)return r=0,t.stack.push(i),Promise.resolve().then(s);if(i.dispose){var n=i.dispose.call(i.value);if(i.async)return r|=2,Promise.resolve(n).then(s,function(a){return e(a),s()})}else r|=1}catch(a){e(a)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}function Lf(t,e){for(const i of t.values())if(e(i))return!0;return!1}function Vee(t,e){for(const i of t.values())if(!e(i))return!1;return!0}function mni(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const[i,r]of t)if(!e.has(i)||r!==e.get(i))return!1;return!0}function gni(t,e){for(const i of t.values())if(e(i))return i;return null}function Fu(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function yni(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const CS=()=>re.getLogger("esri.core.accessorSupport.ensureTypes");function Ktt(t){if(t==null)return t;const e=new Date(t);return isNaN(e.getTime())?(CS().error("Accessor#set",`Invalid date value: '${t}', falling back to current date`),new Date):e}function eit(t){return t==null?t:!!t}function ZL(t){return t==null?t:t.toString()}function Fc(t,e=0){return t==null?t:(t=parseFloat(t),isNaN(t)?e:t)}function Lle(t){return t==null?t:Math.round(parseFloat(t))}function tit(t){return null}function iit(t,e){return i=>{let r=t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function VPe(t){return t?.constructor&&t.constructor.__accessorMetadata__!==void 0}function rq(t,e){return e!=null&&t&&!(e instanceof t)}function jPe(t){return t&&"isCollection"in t}function __e(t){return t?.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function rit(t,e){if(!e?.constructor||!jPe(e.constructor))return jee(t,e)?e:new t(e);const i=__e(t.prototype.itemType),r=__e(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(jee(t,e),e):new t(e):e}function jee(t,e){return!!VPe(e)&&(CS().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+X9(t)+"'"),!0)}function g$(t,e){return e==null?e:jPe(t)?rit(t,e):rq(t,e)?jee(t,e)?e:new t(e):e}function X9(t){return t?.prototype?.declaredClass||"unknown"}const sit=new WeakMap;function nit(t){switch(t){case Number:return e=>Fc(e);case vi:return Lle;case Boolean:return eit;case String:return ZL;case Date:return Ktt;case hP:return tit;default:return Fu(sit,t,()=>g$.bind(null,t))}}function en(t,e){const i=nit(t);return arguments.length===1?i:i(e)}function x5(t,e,i){return arguments.length===1?x5.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function ait(t,e){return arguments.length===1?x5(i=>en(t,i)):x5(i=>en(t,i),e)}function UPe(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>UPe(t,e-1,r)):t(i)}function sq(t,e,i){if(arguments.length===2)return n=>sq(t,e,n);if(!i)return i;i=UPe(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function oit(t,e,i){return arguments.length===2?sq(r=>en(t,r),e):sq(r=>en(t,r),e,i)}function BPe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function Uee(t,e){if(arguments.length===2)return Uee(t).call(null,e);const i=new Set,r=t.filter(o=>typeof o!="function"),s=t.filter(o=>typeof o=="function");for(const o of t)typeof o!="string"&&typeof o!="number"||i.add(o);let n=null,a=null;return(o,l)=>{if(o==null)return o;const u=typeof o,d=u==="string"||u==="number";return d&&(i.has(o)||s.some(f=>u==="string"&&f===String||u==="number"&&f===Number))||u==="object"&&s.some(f=>!rq(f,o))?o:(d&&r.length?(n||(n=r.map(f=>typeof f=="string"?`'${f}'`:`${f}`).join(", ")),CS().error("Accessor#set",`'${o}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof o=="object"&&s.length?(a||(a=s.map(f=>X9(f)).join(", ")),CS().error("Accessor#set",`'${o}' is not a valid value for this property, value must be one of ${a}`)):CS().error("Accessor#set",`'${o}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function sm(t,e){if(arguments.length===2)return sm(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const u=t.typeMap[l];i[l]=en(u),r.push(X9(u)),s.push(l)}const n=()=>`'${r.join("', '")}'`,a=()=>`'${s.join("', '")}'`,o=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!rq(t.base,l)||l==null)return l;const u=o(l)||t.defaultKeyValue,d=i[u];if(!d)return CS().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${a()})`),null;if(!rq(t.typeMap[u],l))return l;if(typeof t.key=="string"&&!VPe(l)){const f={};for(const g in l)g!==t.key&&(f[g]=l[g]);return d(f)}return d(l)}}let vi=class{},hP=class{};const bni={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function lit(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function qPe(t){switch(t.type){case"native":return en(t.value);case"array":return x5(qPe(t.value));case"one-of":return cit(t);default:return null}}function cit(t){let e=null;return(i,r)=>qee(i,t)?i:(e==null&&(e=Bee(t)),CS().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function Bee(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case vi:return"integer";case Date:return"date";case hP:return"null";default:return X9(t.value)}case"array":return`array of ${Bee(t.value)}`;case"one-of":{const e=t.values.map(i=>Bee(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function qee(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case vi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case hP:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!qee(i,e.value));case"one-of":return e.values.some(i=>qee(t,i))}}function dP(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=se(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function YL(t,e){const i=dP(t);let r=i[e];return r||(r=i[e]={}),r}function uit(t,e){return F6(t,e,dit)}const hit=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function dit(t){return hit.test(t)?"replace":"merge"}function nq(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))nq(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void nq(Vf(t,s),n,i)}const r=t.__accessor__;r!=null&&pit(e,r),t[e]=i}}function pit(t,e){if(ie("esri-unknown-property-errors")&&!fit(t,e))throw new q("set:unknown-property",mit(t,e))}function fit(t,e){return e.metadata[t]!=null}function mit(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}function p(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=YL(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&re.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,u=typeof n=="string"?null:n.overridable===!0;let d;s.dependsOn=[l],s.get=function(){let f=Vf(this,l);if(typeof f=="function"){d||(d=l.split(".").slice(0,-1).join("."));const g=Vf(this,d);g&&(f=f.bind(g))}return f},s.readOnly||(s.set=u?function(f){this._override(i,f)}:function(f){nq(this,l,f)})}const a=t.type,o=t.types;if(!s.cast){let l;a?l=git(a):o&&(l=Array.isArray(o)?x5(sm(o[0])):sm(o)),t.cast=yit(t.cast,l)}uit(s,t),t.range&&(s.cast=iit(s.cast,t.range))}}function Fle(t,e,i){const r=YL(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function git(t){let e=0,i=t;if(lit(t))return qPe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(BPe(r))return e===0?Uee(r):sq(Uee(r),e);if(e===1)return ait(r);if(e>1)return oit(r,e);const s=t;return s.from?s.from:en(s)}function yit(t,e){if(t||e)return t?e?(i,r)=>e(t(i,r),r):t:e}const GPe=Symbol("Accessor-beforeDestroy");function vit(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let Gu=class extends _Pe{constructor(e,i,r){super(e,i,r)}};Gu.prototype.type="warning";function HPe(t){return!!t&&t.prototype?.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}function _it(t,e){return zle(t,"any",e?.origin)}function aq(t,e){return zle(t,"read",e?.origin)}function WPe(t,e){return zle(t,"write",e?.origin)}function zle(t,e,i){let r=t?.json;if(r?.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}const Gee=()=>re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function b_e(t,e,i){t&&(!i&&!e.read||e.read?.reader||e.read?.enabled===!1||xit(t)&&ra("read.reader",pP(t),e))}function pP(t){const e=t.ndimArray??0;if(e>1)return wit(t);if(e===1)return w_e(t);if("type"in t&&YPe(t.type)){const i=t.type.prototype?.itemType?.Type,r=w_e(typeof i=="function"?{type:i}:{types:i});return(s,n,a)=>{const o=r(s,n,a);return o&&new t.type(o)}}return Nle(t)}function Nle(t){return"type"in t?bit(t.type):Sit(t.types)}function bit(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void Gee().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function ZPe(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>ZPe(t,s,i,r-1)):t(e,void 0,i)}function wit(t){const e=Nle(t),i=ZPe.bind(null,e),r=t.ndimArray??0;return(s,n,a)=>{if(s==null)return s;s=i(s,a,r);let o=r,l=s;for(;o>0&&Array.isArray(l);)o--,l=l[0];if(l!==void 0)for(let u=0;u<o;u++)s=[s];return s}}function w_e(t){const e=Nle(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const a=[];for(const o of i){const l=e(o,void 0,s);l!==void 0&&a.push(l)}return a}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function YPe(t){if(!HPe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?Vle(e.Type):JPe(e.Type))}function xit(t){return"types"in t?JPe(t.types):Vle(t.type)}function Vle(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||YPe(t))}function JPe(t){for(const e in t.typeMap)if(!Vle(t.typeMap[e]))return!1;return!0}function Sit(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,a)=>{if(s==null)return s;const o=typeof s;if(o!=="object")return void Gee().error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=$it(t));const l=t.key;if(typeof l!="string")return;const u=s[Tit(l,e,a)],d=u?e[u]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!d){const g=`Type '${u||"unknown"}' is not supported`;return a?.messages&&s&&a.messages.push(new Gu(`${i}:unsupported`,g,{definition:s,context:a})),void Gee().error(g)}const f=new d;return f.read(s,a),r?r(f):f}}function Tit(t,e,i){const r=Object.values(e)[0],s=dP(r.prototype)[t],n=aq(s,i),a=n?.read?.source;return a&&typeof a=="string"?a:t}function $it(t){const e={};for(const i in t.typeMap){const r=t.typeMap[i],s=dP(r.prototype);if(typeof t.key=="function")continue;const n=s[t.key];if(!n)continue;if(n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"){e[n.json.type[0]]=r;continue}const a=n.json?.write;if(!a?.writer){e[i]=r;continue}const o=a.target,l=typeof o=="string"?o:t.key,u={};a.writer(i,u,l),u[l]&&(e[u[l]]=r)}return e}function Cit(t){if(t.json||(t.json={}),S_e(t.json),T_e(t.json),x_e(t.json),t.json.origins)for(const e in t.json.origins)S_e(t.json.origins[e]),T_e(t.json.origins[e]),x_e(t.json.origins[e]);return!0}function x_e(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function S_e(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function T_e(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function $_e(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=t?.ndimArray??0;t&&(i===1||"type"in t&&HPe(t.type))?e.write.writer=Ait:i>1?e.write.writer=Oit(i):e.types?Array.isArray(e.types)?e.write.writer=Eit(e.types[0]):e.write.writer=Mit(e.types):e.write.writer=S5}function Mit(t){return(e,i,r,s)=>e?QPe(e,t,s)?S5(e,i,r,s):void 0:S5(e,i,r,s)}function QPe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i?.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new q(`${r}:unsupported`,s,{definition:t,context:i})),re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function Eit(t){return(e,i,r,s)=>!e||!Array.isArray(e)?S5(e,i,r,s):S5(e.filter(n=>QPe(n,t,s)),i,r,s)}function S5(t,e,i,r){ra(i,oq(t,r),e)}function oq(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?lq(t):t}function lq(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function Ait(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>oq(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[oq(t,r)],ra(i,s,e)}function XPe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>XPe(r,e,i-1)):oq(t,e)}function Oit(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=XPe(e,s,t);let a=t,o=n;for(;a>0&&Array.isArray(o);)a--,o=o[0];if(o!==void 0)for(let l=0;l<a;l++)n=[n]}ra(r,n,i)}}function Pit(t){const e=Rit(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],s=r.types?Iit(r):e;b_e(s,r,!1),r.types&&!r.write&&t.json.write?.enabled&&(r.write={...t.json.write}),$_e(s,r)}b_e(e,t.json,!0),$_e(e,t.json)}function Rit(t){return t.json.types?Hee(t.json):t.type?KPe(t):Hee(t)}function Iit(t){return t.type?KPe(t):Hee(t)}function KPe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!BPe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function Hee(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function Dit(t){Cit(t)&&(vit(t),Pit(t))}const BY=new Set,qY=new Set;function R(t){return e=>{t??="esri.core.Accessor",e.prototype.declaredClass=t,Lit(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!BY.has(s.initialize)&&(BY.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!qY.has(s.destroy)&&(qY.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);BY.clear(),qY.clear();const n=class extends e{constructor(...o){if(super(...o),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const u=this[GPe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){this.__accessor__.lifecycle=Lh.DESTROYING,l=!0,u.call(this);for(let d=0;d<r.length;d++)r[d].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=dP(e.prototype),n.prototype.declaredClass=t;const a=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:a,configurable:!0}),n}}function kit(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;i.mutable&&Mt(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function Lit(t){const e=t.prototype,i=dP(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];Dit(n),r[s]={enumerable:!0,configurable:!0,get:kit(s,n),set(a){const o=this.__accessor__;if(o!==void 0){if(o.mutable)return o.initialized&&n.readOnly?C_e("read-only",s):o.lifecycle===Lh.CONSTRUCTED&&n.constructOnly?C_e("construct-only",s):void o.set(s,a)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:a})}}}Object.defineProperties(t.prototype,r)}const C_e=(t,e)=>{re.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)},Fit="modulepreload",zit=function(t){return"/my-project/"+t},M_e={},W=function(e,i,r){let s=Promise.resolve();if(i&&i.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");s=l(i.map(u=>{if(u=zit(u),u in M_e)return;M_e[u]=!0;const d=u.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":Fit,d||(g.as="script"),g.crossOrigin="",g.href=u,o&&g.setAttribute("nonce",o),document.head.appendChild(g),d)return new Promise((v,_)=>{g.addEventListener("load",v),g.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${u}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})},E_e=new WeakMap;function Nit(t,e,i=!1){const r=` DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=E_e.get(t);s||(s=new Set,E_e.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}const cq="https://www.esriurl.com/";function Vit(t,e,i,r={}){ie("esri-deprecation-warnings")&&Xw(t,`This widget is deprecated. Use the ${e} component instead.`,{see:[`${e} component reference: ${cq}${i}/`,`Esri's move to web components: ${cq}components-transition-plan/`],replacement:`<${i}></${i}>`,warnOnce:!0,...r})}function jit(t,e,i,r={}){ie("esri-deprecation-warnings")&&Xw(t,`This view model is deprecated. Use the ${e} component directly instead.`,{see:[`${e} component reference: ${cq}${i}/`,`Esri's move to web components: ${cq}components-transition-plan/`],replacement:`<${i}></${i}>`,warnOnce:!0,...r})}function xni(t,e,i={}){ie("esri-deprecation-warnings")&&Xw(t,`Module: ${e}`,i)}function eRe(t,e,i={}){if(ie("esri-deprecation-warnings")){const{moduleName:r}=i;Xw(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function Wee(t,e,i={}){if(ie("esri-deprecation-warnings")){const{moduleName:r}=i;Xw(t,`Property: ${(r?r+"::":"")+e}`,i)}}function Uit(t,e,i={}){ie("esri-deprecation-warnings")&&Xw(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function Xw(t,e,i={}){if(ie("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:a}=i;let o=e;if(r&&(o+=`
	 Replacement: ${r}`),s&&(o+=`
	 Version: ${s}`),n)if(Array.isArray(n)){o+=`
	 See for more details:`;for(const l of n)o+=`
		${l}`}else o+=`
	 See ${n} for more details.`;Nit(t,o,a)}}function Sni(t){const e=[];return function*(){yield*e;let i,r=e.length;for(;!(i=t.next()).done;)for(e.push(i.value),yield i.value;++r<e.length;)yield e[r]}}function Bit(t,e){for(const i of t)if(i!=null&&e(i))return i}function oO(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let X0=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(oO(e)){const r=this._getOrCreateGroup(i);for(const s of e)O_e(s)&&r.push(s)}else O_e(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(TN(e))}remove(e){if(typeof e!="string"&&oO(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(A_e(this._getGroup(e)),this._groups.delete(TN(e)),this):this}removeAll(){return this._groups.forEach(A_e),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(TN(e),i),i}_getGroup(e){return this._groups.get(TN(e))}};function TN(t){return t||"_default_"}function A_e(t){for(const e of t)e instanceof X0?e.removeAll():e.remove()}function O_e(t){return t!=null&&(!!t.remove||t instanceof X0)}let P_e=class extends mPe{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this.trackingTarget=new Z9(this),this.flags=0,this.flags=fn.Dirty|(i.nonNullable?fn.NonNullable:0)|(i.hasOwnProperty("value")?fn.HasDefaultValue:0)|(i.get===void 0?fn.DepTrackingInitialized:0)|(i.dependsOn===void 0?fn.AutoTracked:0)}destroy(){this.flags&fn.Dirty&&this.onCommitted(),super.destroy(),this.trackingTarget.destroy()}getComputed(e){e.mutable&&Mt(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&fn.Computing||~s&fn.Dirty&&i.has(r))return n;this.flags|=fn.Computing;const a=e.host;let o;s&fn.AutoTracked?o=Gg(this.trackingTarget,this.metadata.get,a):(fPe(a,this),o=this.metadata.get.call(a)),this.flags|=fn.DepTrackingInitialized,i.set(r,o,1);const l=i.get(r);return l===n?this.flags&=-2:ett(this.commit,this),this.flags&=-5,l}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=-2,this.onCommitted()}onInvalidated(){~this.flags&fn.Overridden&&(this.flags|=fn.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}};const Zee=8;function l0(t){switch(t){case"defaults":return 0;case"service":return 2;case"portal-item":return 3;case"web-scene":return 4;case"web-map":return 5;case"link-chart":return 6;case"user":return 7;default:return null}}function T5(t){switch(t){case 0:return"defaults";case 2:return"service";case 3:return"portal-item";case 4:return"web-scene";case 5:return"web-map";case 6:return"link-chart";case 7:return"user"}}function qit(t){return T5(t)}let Git=class tRe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new tRe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,se(r))}),i}get(e){return this._values.get(e)}originOf(){return 7}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}isAtOrigin(e,i){return this.has(e)}isBelowOrigin(e,i){return!this.has(e)}forEach(e){this._values.forEach(e)}};function _C(t,e,i){return t!==void 0}function R_e(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&fn.NonNullable)||(r.lifecycle,!1))}let Hit=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=Lh.INITIALIZING,this.store=new Git,this.mutable=!0,this._origin=7;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new P_e(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=Lh.CONSTRUCTING}constructed(){this.lifecycle=Lh.CONSTRUCTED}destroy(){this.lifecycle=Lh.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==Lh.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(!_C(i))return;if(i.metadata.get)return i.getComputed(this);this.mutable&&Mt(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&fn.HasDefaultValue)return"defaults"}return T5(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(_C(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);_C(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!_C(s))return"";const n=new Z9,a=Gg(n,()=>s.metadata.get?.call(e));let o=`${r}${e.declaredClass.split(".").pop()}.${i}: ${a}
`;const l=n.accessed??new Set;if(l.size===0)return o;r+="  ";for(const u of l)u instanceof P_e&&(o+=`${r}${u.propertyName}: undefined
`);return o}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if(_C(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&fn.Overridden)}clearOrigin(e,i){const r=this.store,s=this.propertiesByName.get(e);if(!_C(s))return;const n=r.isAtOrigin(e,i)&&!(s.flags&fn.Overridden);r.delete(e,i),n&&s.notifyChange()}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&fn.Overridden&&(i.flags&=-3,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!R_e(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:a,value:o}=n;if(GY.release(n),!a)return;i=o}r.flags|=fn.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!R_e(r,e,i,this))return;const s=r.metadata.cast;if(s){const a=this._cast(s,i),{valid:o,value:l}=a;if(GY.release(a),!o)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=l0(e)}getDefaultOrigin(){return T5(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==Lh.INITIALIZING?this._origin:0;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;if(s.isAtOrigin(n,r)&&Mle(i,s.get(n))&&~e.flags&fn.Overridden)return;const a=s.isBelowOrigin(n,r)||s.isAtOrigin(n,r);a&&e.invalidate(),s.set(n,i,r),a&&e.commit(),pPe(this.host,e)}_cast(e,i){const r=GY.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},Wit=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const GY=new Wc(()=>new Wit);let Zit;function Yit(){return Zit}var I_e,D_e;function Jit(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const F_=Symbol("Accessor-Handles"),HY=Symbol("Accessor-Initialized");var Uw;let be=(Uw=class{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class a extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}dP(a.prototype);for(const o in e){const l=e[o];a.prototype[o]=typeof l=="function"?function(...u){const d=this.inherited;let f;this.inherited=function(...g){if(n.prototype[o])return n.prototype[o].apply(this,g)};try{f=l.apply(this,u)}catch(g){throw this.inherited=d,g}return this.inherited=d,f}:e[o]}for(const o in i){const l=Jit(i[o]);p(l)(a.prototype,o)}return R(r)(a)}static freeze(e){return e instanceof Uw?e.__accessor__.mutable=!1:Object.freeze(e),e}static isFrozen(e){return e instanceof Uw?!e.__accessor__.mutable:Object.isFrozen(e)}constructor(...e){if(this[I_e]=null,this[D_e]=!1,this.constructor===Uw)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new Hit(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=this.normalizeCtorArgs?.apply(this,e)??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[HY]=!0}initialize(){}[GPe](){this[F_]=Pe(this[F_])}destroy(){this.destroyed||(Utt(this),this.__accessor__.destroy(),Yit()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[HY]}get destroyed(){return this.__accessor__?.lifecycle===Lh.DESTROYED||!1}get destroying(){return this.__accessor__?.lifecycle===Lh.DESTROYING||!1}commitProperty(e){Vf(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return nq(this,e,i),this}watch(e,i,r){return eRe(re.getLogger(this),"`watch` is deprecated in favor of reactiveUtils.watch",{replacement:"reactiveUtils.watch",version:"4.32",see:"https://arcg.is/1vaqf42#watch",warnOnce:!0}),Wtt(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[F_]??=new X0).add(e,i)}removeHandles(e){this[F_]?.remove(e)}removeAllHandles(){this[F_]?.removeAll()}removeHandlesReference(e){this[F_]?.removeReference(e)}hasHandles(e){return this[F_]?.has(e)===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}},I_e=F_,D_e=HY,Uw);const Qit=Symbol("ClonableMixin"),nt=t=>{var s;var e;const i=t;let r=(s=class extends i{constructor(){super(...arguments),this[e]=!0}clone(n){const a=xl(this);cP(a,"unable to clone instance of non-accessor class");const o=a.metadata,l=a.store,u={},d=new Map;for(const g in o){const v=o[g],_=l?.originOf(g),x=v.clonable;if(v.readOnly||x===!1||_!==7&&_!==0&&_!==5&&_!==4)continue;const S=this[g];let T=null;if(typeof x=="function")T=x(S,n);else if(x==="reference")T=S;else if(T=Pee(S,n),S!=null&&T==null)continue;_===0?d.set(g,T):u[g]=T}const f=new(Object.getPrototypeOf(this)).constructor(u);if(d.size){const g=xl(f)?.store;if(g)for(const[v,_]of d)g.set(v,_,0)}return f}},e=Qit,s);return r=c([R("esri.core.Clonable")],r),r},E1=nt(be);let Gx=class extends E1{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};c([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gx.prototype,"row",void 0),c([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gx.prototype,"column",void 0),c([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gx.prototype,"rows",void 0),c([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gx.prototype,"columns",void 0),Gx=c([R("esri.CameraLayout")],Gx);const iRe=Gx,k_e=new Float32Array(1);function Xit(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Ce(t,e,i){return Math.min(Math.max(t,e),i)}function qT(t){return!(t&t-1)}function Ani(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Oni(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function yt(t,e,i){return t+(e-t)*i}function Kit(t,e){const i=-t*t/(2*e);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(i)}function Pni(t,e,i,r,s){return yt(r,s,(t-e)/(i-e))}function zt(t){return t*Math.PI/180}function to(t){return 180*t/Math.PI}function Rni(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Ao(t){return Math.acos(Ce(t,-1,1))}function Qh(t){return Math.asin(Ce(t,-1,1))}function yl(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}function rRe(t,e,i=1e-6){return!yl(t,e,i)&&t>e}function Yee(t,e,i=1e-6){return!yl(t,e,i)&&t<e}function ert(t,e,i=1e-6){return yl(t,e,i)||t>e}const uq=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function Jee(t){return uq.setFloat64(0,t),uq.getBigInt64(0)}function trt(t){return uq.setBigInt64(0,t),uq.getFloat64(0)}const j6=1000000n,irt=sRe(1);function sRe(t){const e=Jee(t=Math.abs(t)),i=trt(e<=j6?j6:e-j6);return Math.abs(t-i)}function rrt(t,e,i=irt){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&sRe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=Jee(t),s=Jee(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>j6)}function jle(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function srt(t){return nRe(Math.max(-Qee,Math.min(t,Qee)))}function nRe(t){return k_e[0]=t,k_e[0]}function lO(t,e,i){const r=Ce((i-t)/(e-t),0,1);return r*r*(3-2*r)}function Ini(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(yl(e,1)&&yl(i,1)&&yl(r,1))}function nrt(t,e){return(t%e+e)%e}const Qee=nRe(34028234663852886e22);function Dni(t,e,i){if(i===void 0||+i==0)return Math[t](e);if(e=+e,i=+i,isNaN(e)||typeof i!="number"||i%1!=0)return NaN;let r=e.toString().split("e");return r=(e=Math[t](+(r[0]+"e"+(r[1]?+r[1]-i:-i)))).toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+i:i))}let K9=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return L_e(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return Ce(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+Xee(this.range,e-i,r)}minimalMonotonic(e,i,r){return L_e(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function L_e(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=Xee(t,e-r):r>i&&(r-=Xee(t,r-i)),n&&r===i&&(r=e),r+s}function Xee(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const art=new K9(0,2*Math.PI),Kw=new K9(-Math.PI,Math.PI),JL=new K9(0,360);let ort=class aRe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new aRe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,se(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||r?.origin===i?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??7}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>this._values.get(r)?.origin===e)}set(e,i,r){if((r=this._normalizeOrigin(r))===0){const s=this._values.get(e);if(s?.origin!=null&&s.origin>r)return}this._values.set(e,new lrt(i,r))}delete(e,i){(i=this._normalizeOrigin(i))!=null&&this._values.get(e)?.origin!==i||this._values.delete(e)}has(e,i){return(i=this._normalizeOrigin(i))!=null?this._values.get(e)?.origin===i:this._values.has(e)}isAtOrigin(e,i){return i=this._normalizeOrigin(i),this.has(e,i)&&this.originOf(e)===i}isBelowOrigin(e,i){return i=this._normalizeOrigin(i),!this.has(e)||this.originOf(e)<i}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===0?e:7}},lrt=class{constructor(e,i){this.value=e,this.origin=i}};function oRe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),0)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),0)})}function crt(t,e,i){if(!t?.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.startsWith(e)&&y_e(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.startsWith(e)&&y_e(s,i))return!0;return!1}function urt(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function hrt(t,e,i,r,s){let n=aq(e[i],s);urt(n)&&(t[i]=!0);for(const a of Object.getOwnPropertyNames(e))n=aq(e[a],s),crt(n,i,r)&&(t[a]=!0)}function drt(t,e,i,r){const s=i.metadata,n=_it(s[e],r),a=n?.default;if(a===void 0)return;const o=typeof a=="function"?a.call(t,e,r):a;o!==void 0&&i.set(e,o)}const lRe={origin:"service"};function cRe(t,e,i=lRe){if(!e||typeof e!="object")return;const r=xl(t),s=r.metadata,n={};for(const a of Object.getOwnPropertyNames(e))hrt(n,s,a,e,i);r.setDefaultOrigin(i.origin);for(const a of Object.getOwnPropertyNames(n)){const o=aq(s[a],i).read,l=o?.source;let u;u=l&&typeof l=="string"?WL(e,l):e[a],o?.reader&&(u=o.reader.call(t,u,e,i)),u!==void 0&&r.set(a,u)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const a of Object.getOwnPropertyNames(s))n[a]||drt(t,a,r,i)}r.setDefaultOrigin("user")}function Ule(t,e,i,r=lRe){const s={...r,messages:[]};i(s),s.messages?.forEach(n=>{n.type!=="warning"||t.loaded?r?.messages&&r.messages.push(n):t.loadWarnings.push(n)})}function prt(t,e,i,r,s){const n={};return e.write?.writer?.call(t,r,n,i,s),n}function uRe(t,e,i,r,s,n){if(!r?.write)return!1;const a=Vf(t,i);if(!s&&r.write.overridePolicy){const o=r.write.overridePolicy.call(t,a,i,n??void 0);o!==void 0&&(s=o)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&n?.layerContainerType&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((a===null&&!s.allowNull&&!s.writerEnsuresNonNull||a===void 0)&&s.isRequired){const o=new q("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return o&&n?.messages?n.messages.push(o):o&&!n&&re.getLogger("esri.core.accessorSupport.write").error(o.name,o.message),!1}return!(a===void 0||a===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===0)&&frt(t,i,n,r,a)||!s.ignoreOrigin&&n?.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<l0(n.origin))}function frt(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const a=n.call(t,e,i??void 0);return E0(a,s)}return!1}return n===s}function mrt(t,e,i,r){const s=xl(t),n=s.metadata,a=WPe(n[e],r);return!!a&&uRe(t,s,e,a,i,r)}function hRe(t,e,i){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return F6(e,t.toJSON(i));const r=xl(t),s=r.metadata;for(const n in s){const a=WPe(s[n],i);if(!uRe(t,r,n,a,void 0,i))continue;const o=Vf(t,n),l=prt(t,a,a.write&&typeof a.write.target=="string"?a.write.target:n,o,i);Object.keys(l).length>0&&(e=F6(e,l),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>F6(e,l,()=>"replace-arrays"))),i?.writtenProperties&&i.writtenProperties.push({target:t,propName:n,oldOrigin:qit(r.store.originOf(n)),newOrigin:i.origin}))}return e}const iy=t=>{const e=t;let i=class extends e{constructor(...r){super(...r);const s=xl(this),n=s.store,a=new ort;s.store=a,oRe(s,n,a)}read(r,s){cRe(this,r,s)}write(r,s){return hRe(this,r??{},s)}toJSON(r){return this.write({},r)}static fromJSON(r,s){return grt.call(this,r,s)}};return i=c([R("esri.core.JSONSupport")],i),i.prototype.toJSON.isDefaultToJSON=!0,i};function grt(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}const ae=iy(be),yrt=Object.prototype.toString;function vrt(t){const e="__accessorMetadata__"in t?en(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return _rt.apply(this,i)}}function _rt(t,e,i,r){YL(t,e).cast=r}function brt(t){return(e,i)=>{YL(e,t).cast=e[i]}}function wi(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&yrt.call(t[0])==="[object Function]"?vrt(t[0]):t.length===1&&typeof t[0]=="string"?brt(t[0]):void 0}function Oe(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,a)=>{const o=n.constructor.prototype;r.forEach(l=>{const u=Fle(n,l,s);u.read&&typeof u.read=="object"||(u.read={}),u.read.reader=o[a],i&&(u.read.source=(u.read.source||[]).concat(i))})}}function Ie(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,a)=>{const o=n.constructor.prototype;for(const l of r){const u=Fle(n,l,s);u.write&&typeof u.write=="object"||(u.write={}),i&&(u.write.target=i),u.write.writer=o[a]}}}let ii=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=wrt(e),this.apiValues=F_e(this._apiToJSON),this.jsonValues=F_e(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const a=this.toJSON(r);a!==void 0&&ra(n,a,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?null:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function wrt(t){const e={};for(const i in t)e[t[i]]=i;return e}function F_e(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function so(){return function(t,e){return new ii(t,{ignoreUnknown:!0,...e})}}let Ble=class{constructor(e,i,r,s,n,a){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r,this.atmosphereHeight=s,this.scaleHeight=n;const o=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*o,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=a||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Ci=new Ble(6378137,1/298.257223563,3e5,1e5,.085,.006694379990137799),Xf=new Ble(3396190,1/169.8944472236118,23e4,6e4,.111),O0=new Ble(1737400,0,0,0,0);function $5(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}const xrt=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,Srt={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function z_e(t){const e=t?.match(xrt);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,a=null,o=null;const{devext:l,qaext:u,www:d}=Srt;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:o}=l);break;case"qa":({customBaseUrl:a,portalHostname:o}=u);break;default:return null}else({customBaseUrl:a,portalHostname:o}=d);else switch(i.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:o}=l);break;case"qaext":({customBaseUrl:a,portalHostname:o}=u);break;case"www":({customBaseUrl:a,portalHostname:o}=d);break;default:return null}return{customBaseUrl:a,isPortal:!1,portalHostname:o,urlKey:n}}function dRe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function pRe(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}function fRe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function Trt(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const $rt=()=>re.getLogger("esri.core.urlUtils"),fP=fr.request,N_e="esri/config: esriConfig.request.proxyUrl is not set.",mRe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,gRe=/^\s*http:/i,Crt=/^\s*https:/i,Mrt=/^\s*file:/i,yRe=/:\d+$/,Ert=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,Art=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),Ort=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let Ow=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(Art);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(Ort),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const $N={},Prt=new Ow(fr.applicationUrl);let Hl=Prt;const Rrt=Irt();let qle=Rrt;const Gle=()=>Hl,Vni=()=>qle;function Irt(){const t=Hl.path,e=t.slice(0,t.lastIndexOf("/")+1);return`${`${Hl.scheme}://${Hl.host}${Hl.port!=null?`:${Hl.port}`:""}`}${e}`}function kn(t){if(!t)return null;const e={path:null,query:null},i=new Ow(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.slice(0,r),e.query=Hle(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.slice(0,e.path.length-(i.fragment.length+1)))),e}function Hle(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,a;s<0?(n=decodeURIComponent(r),a=""):(n=decodeURIComponent(r.slice(0,s)),a=decodeURIComponent(r.slice(s+1)));let o=i[n];typeof o=="string"&&(o=i[n]=[o]),Array.isArray(o)?o.push(a):i[n]=a}return i}function cO(t,e){return t?Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e?.[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(a=>$5(a)?s+encodeURIComponent(JSON.stringify(a)):s+encodeURIComponent(a)).join("&"):$5(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function vRe(t=!1){let e,i=fP.proxyUrl;if(typeof t=="string"){e=TRe(t);const r=e7(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw $rt().warn(N_e),new q("urlUtils:proxy-not-set",N_e);return e&&ete()&&(i=Qle(i)),kn(i)}function jni(t,e=!1){const i=e7(t);let r,s;if(i){const n=Wle(i.proxyUrl);r=n.path,s=n.query?Hle(n.query):null}else if(e){const n=vRe(t);r=n.path,s=n.query}if(r){const n=kn(t);t=r+"?"+n.path;const a=cO({...s,...n.query});a&&(t=`${t}?${a}`)}return t}const jR={path:"",query:""};function Wle(t){const e=t.indexOf("?");return e!==-1?(jR.path=t.slice(0,e),jR.query=t.slice(e+1)):(jR.path=t,jR.query=null),jR}function _Re(t){return t=(t=dq(t=Brt(t=Wle(t).path),!0)).toLowerCase()}function Drt(t){const e={proxyUrl:t.proxyUrl,urlPrefix:_Re(t.urlPrefix)},i=fP.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const a=i[n].urlPrefix;if(r.startsWith(a)){if(r.length===a.length)return-1;s=n;break}a.startsWith(r)&&(s=n+1)}return i.splice(s,0,e),s}function e7(t){const e=fP.proxyRules,i=_Re(t);for(let r=0;r<e.length;r++)if(i.startsWith(e[r].urlPrefix))return e[r]}function bRe(t,e){if(!t||!e)return!1;t=hq(t),e=hq(e);const i=z_e(t),r=z_e(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&Ng(t,e,!0)}function wRe(t,e){return t=hq(t),e=hq(e),dq(t)===dq(e)}function hq(t){const e=(t=pp(t)).indexOf("/sharing");return e>0?t.slice(0,e):t.replace(/\/+$/,"")}function Kee(t,e=fP.interceptors){const i=r=>r instanceof RegExp?r.test(t):typeof r=="string"?t.startsWith(r):r==null;if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function Ng(t,e,i=!1){if(!t||!e)return!1;const r=ite(t),s=ite(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function Zle(t){if(typeof t=="string"){if(!Nu(t))return!0;t=ite(t)}if(Ng(t,Hl))return!0;const e=fP.trustedServers||[];for(let i=0;i<e.length;i++){const r=krt(e[i]);for(let s=0;s<r.length;s++)if(Ng(t,r[s]))return!0}return!1}function krt(t){return $N[t]||(Jle(t)||Wg(t)?$N[t]=[new Ow(ku(t))]:$N[t]=[new Ow(`http://${t}`),new Ow(`https://${t}`)]),$N[t]}function ku(t,e=qle,i){return Wg(t)?i?.preserveProtocolRelative?t:Hl.scheme==="http"&&Hl.authority===Hh(t).slice(2)?`http:${t}`:`https:${t}`:Jle(t)?t:Xh(t.startsWith("/")?jrt(e):e,t)}function Yle(t,e=qle,i){if(t==null||!Nu(t))return t;const r=pp(t),s=r.toLowerCase(),n=pp(e).toLowerCase().replace(/\/+$/,""),a=i?pp(i).toLowerCase().replace(/\/+$/,""):null;if(a&&!n.startsWith(a))return t;const o=(f,g,v)=>(v=f.indexOf(g,v))===-1?f.length:v;let l=o(s,"/",s.indexOf("//")+2),u=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(u=l+1,l!==s.length);)l=o(s,"/",l+1);if(u===-1||a&&u<a.length)return t;t=r.slice(u);const d=n.slice(u-1).replaceAll(/[^/]+/g,"").length;if(d>0)for(let f=0;f<d;f++)t=`../${t}`;else t=`./${t}`;return t}function pp(t){return t=Hrt(t=Grt(t=qrt(t=ku(t=t.trim()))))}function Xh(...t){const e=t.filter(wl);if(!e?.length)return;const i=[];if(Nu(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),Nrt(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0].startsWith("/")&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Hh(t,e=!1){if(t==null||e1(t)||mm(t))return null;let i=t.indexOf("://");if(i===-1&&Wg(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=dq(t,!0)),t}function Nu(t){return Wg(t)||Jle(t)}function e1(t){return t!=null&&t.startsWith("blob:")}function mm(t){return t!=null&&t.startsWith("data:")}function xRe(t){const e=GT(t);return e?.isBase64?fRe(e.data):null}function Uni(t){return Trt(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const Lrt=/^data:(.*?)(;base64)?,(.*)$/;function GT(t){const e=t.match(Lrt);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function SRe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function Frt(t){return(await fetch(t)).blob()}function Bni(t){const e=xRe(t);if(!e)return null;const i=GT(t);return new Blob([e],{type:i.mediaType})}function Wg(t){return t!=null&&t.startsWith("/")&&t[1]==="/"}function Jle(t){return t!=null&&mRe.test(t)}function TRe(t){return t!=null&&Crt.test(t)||Hl.scheme==="https"&&Wg(t)}function zrt(t){return t!=null&&gRe.test(t)||Hl.scheme==="http"&&Wg(t)}function Nrt(t){return t!=null&&Mrt.test(t)}function Qle(t){return Wg(t)?`https:${t}`:t.replace(gRe,"https:")}function Vrt(){return Hl.scheme==="http"}function ete(){return Hl.scheme==="https"}function dq(t,e=!1){return Wg(t)?t.slice(2):(t=t.replace(mRe,""),e&&t.length>1&&t.startsWith("/")&&t[1]==="/"&&(t=t.slice(2)),t)}function jrt(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function Urt(t){let e=0;if(Nu(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function qni(t,e){if(!t)return"";const i=kn(t).path.replace(/\/+$/,""),r=i.slice(i.lastIndexOf("/")+1);if(!e?.length)return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function Brt(t){return t.endsWith("/")?t:`${t}/`}function $Re(t){return t.replace(/\/+$/,"")}function qrt(t){if(/^https?:\/\//i.test(t)){const e=Wle(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function Grt(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function Hrt(t){const e=fP.httpsDomains;if(!zrt(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),yRe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return Vrt()&&r===Hl.authority&&!Ert.test(t)||(ete()&&r===Hl.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||ete()&&!e7(t))&&(t=Qle(t)),t}function tte(t,e,i){if(!(e&&i&&t&&Nu(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),a=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,a).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(a)}`}function CRe(t,e){const i=new URL(t);return i.host=e,i.port&&!yRe.test(e)&&(i.port=""),i.toString()}function Wrt(t){return new URL(t).host}function ite(t){return typeof t=="string"?new Ow(ku(t)):(t.scheme||(t.scheme=Hl.scheme),t)}function MRe(t){return Zrt.test(t)}function ERe(t,e){const i=kn(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function Xle(t,e,i){const r=kn(t),s=r.query||{};return s[e]=String(i),`${r.path}?${cO(s)}`}function WY(t,e){if(!e)return t;const i=kn(t),r=i.query||{};for(const[n,a]of Object.entries(e))a!=null&&(r[n]=a);const s=cO(r);return s?`${i.path}?${s}`:i.path}function Kle(t){if(t==null)return null;const e=t.match(ARe);return e?e[2]:null}function V_e(t){if(t==null)return null;const e=t.match(ARe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function Gni(t){return typeof t=="string"?GT(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(GT(r.result)),r.onerror=s=>i(s)})}const ARe=/([^.]*)\.([^/]*)$/,Zrt=/(^data:image\/svg|\.svg$)/i,ORe="20251114",PRe="ec088c999de2dac6fb9478a47da1bad775545540";Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");const ece="4.34";let nr,tce=ece;function Hni(t){nr=t}function Wni(t){const e=nr?.findCredential(t);return e?.token?Xle(t,"token",e.token):t}tce="4.34.8",ie("host-webworker")||globalThis.$arcgis||Object.defineProperty(globalThis,"$arcgis",{configurable:!1,enumerable:!0,writable:!1,value:{}}),ie("host-webworker");function y$(t,e){const i=e?.url?.path;if(t&&i&&(t=ku(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=Yle(t,e.portalItem.itemUrl);r!=null&&r.startsWith(Yrt)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return(t=rte(t,e?.portal))&&i7.test(t)?ice(t):t}function HT(t,e,i=0){if((t=t&&i7.test(t)?kRe(t):t)==null)return t;!Nu(t)&&e?.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=ku(t);if(e){const s=e.verifyItemRelativeUrls?.rootPath||e.url?.path;if(s){const n=rte(s,e.portal),a=rte(r,e.portal);r=Yle(a,n,n),r!=null&&r!==a&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=DRe(r,e?.portal),Nu(r)&&(r=pp(r)),e?.resources&&e?.portalItem&&!Nu(r)&&!mm(r)&&i===0&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function t7(t,e,i){return y$(t,i)}function WT(t,e,i,r){const s=HT(t,r);s!==void 0&&(e[i]=s)}const i7=/\/items\/([^/]+)\/resources\/(.*)/,Yrt="./resources/";function RRe(t){return(t?.match(i7)??null)?.[1]??null}function IRe(t){const e=t?.match(i7)??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:a,extension:o}=V_e(i);return{prefix:null,filename:a,extension:o}}const{path:s,extension:n}=V_e(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function DRe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?tte(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function rte(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=Gle();return Ng(r,`${r.scheme}://${i}`)?tte(t,e.portalHostname,i):tte(t,i,e.portalHostname)}function ice(t){if(!t)return t||null;let e=t;return e&&nr&&!nr.findCredential(e)&&(e=pRe(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function kRe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&nr&&!nr.findCredential(e)&&(e=pRe(e)),e}const Jrt=Object.freeze(Object.defineProperty({__proto__:null,ensureMainOnlineDomain:DRe,fromCDNUrl:kRe,fromJSON:y$,itemIdFromResourceUrl:RRe,prefixAndFilenameFromResourceUrl:IRe,read:t7,toCDNUrl:ice,toJSON:HT,write:WT},Symbol.toStringTag,{value:"Module"})),LRe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},FRe=Object.values(LRe),zRe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${FRe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Qrt=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${FRe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Xrt=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function Zni(t){return zRe.test(t)}function Zg(t){if(t==null)return null;const e=kn(t),i=e?.path.match(zRe)||e?.path.match(Qrt);if(!i)return null;const[,r,s,n,a]=i,o=s.indexOf("/");return{title:rce(o!==-1?s.slice(o+1):s),serverType:LRe[n.toLowerCase()],sublayer:a!=null&&a!==""?parseInt(a,10):null,url:{path:r}}}function Krt(t){const e=kn(t).path.match(Xrt);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function rce(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function est(t,e){const i=[];if(t){const r=Zg(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=rce(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function pq(t){let e=Hh(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")||/^[a-z\d-]+\.svcs[a-z\d-]*\./.test(e)))}function tst(t,e){return t&&$Re(ERe(t,e))}function ist(t){let{url:e}=t;if(!e)return{url:e};e=ERe(e,t.logger);const i=kn(e),r=Zg(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=Krt(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:$Re(e),layerId:s}}function rst(t,e,i,r,s){WT(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=Xh(r.url,i,t.layerId.toString()))}function Yni(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}function sst(t){if(!t)return!1;const e=new Ow(ku(t)),i=e.authority?.toLowerCase();return i==="server.arcgisonline.com"||i==="services.arcgisonline.com"}const nst=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function sce(t){if(!nce(t))return null;const e=r=>r instanceof RegExp?r.test(t):typeof r=="string"&&t.startsWith(r),i=fr.apiKeys;if(Array.isArray(i.scopes)){for(const r of i.scopes)if(Array.isArray(r.urls)){if(r.urls.some(e))return r.token}else if(e(r.urls))return r.token}return i.basemapStyles&&/^https?:\/\/(i?basemaps|basemapstyles)-api\.arcgis\.com\//i.test(t)?i.basemapStyles:fr.apiKey&&/^https?:\/\/.+\.arcgis\.com(\/|$)/i.test(t)?fr.apiKey:null}function ste(){return fr.apiKey!=null||fr.apiKeys.basemapStyles!=null}function ast(t,e){return e?nce(t):sce(t)!=null}function nce(t){const e=Hh(t,!0);return!!e&&!nst.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function NRe(t,e,i=!1,r){return new Promise((s,n)=>{if(sa(r))return void n(j_e());let a=()=>{u(),n(new Error(`Unable to load ${e}`))},o=async()=>{const d=t;try{await d.decode()}catch{}u(),s(d)},l=()=>{if(!t)return;const d=t;u(),d.src="",n(j_e())};const u=()=>{t&&(t.removeEventListener("error",a),t.removeEventListener("load",o),a=null,o=null,t=null,r?.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e))};r?.addEventListener("abort",l),t.addEventListener("error",a),t.addEventListener("load",o)})}function j_e(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const VRe="Timeout exceeded";function ost(){return new Error(VRe)}function Jni(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===VRe}function lst(t){fr.request.crossOriginNoCorsDomains||(fr.request.crossOriginNoCorsDomains={});const e=fr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Hh(i)??""]=0:(e[Hh("http://"+i)??""]=0,e[Hh("https://"+i)??""]=0)}function cst(t){const e=fr.request.crossOriginNoCorsDomains;if(e){let i=Hh(t);if(i)return i=i.toLowerCase(),!Ng(i,Gle())&&e[i]<Date.now()-36e5}return!1}async function ust(t){const e=kn(t);t=e.path,e.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}const i=fr.request.crossOriginNoCorsDomains,r=Hh(t);i&&r&&(i[r.toLowerCase()]=Date.now())}const nte=new Map;function hst(t,e){const i=e?.preferredHost;if(!i||Ng(t,`https://${i}`,!0))return;const r=Zg(t);if(!r||r.serverType!=="FeatureServer"||dRe(t))return;const s=r.url.path.toLowerCase();nte.has(s)||nte.set(s,i)}function U_e(t){const e=Zg(t)?.url.path.toLowerCase();if(!e)return t;const i=nte.get(e);return i?CRe(t,i):t}async function Si(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=Hle(e.query.toString().replaceAll("+"," ")));const i=mm(t),r=e1(t);r||i||(t=pp(t));const s={url:t,requestOptions:{...e}},n=v=>({data:v,getAllHeaders:uO,getHeader:uO,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),a=Kee(t,Jd.internalInterceptors);if(a){const v=await q_e(a,s);if(v!=null)return n(v)}let o=Kee(t);if(o){const v=await q_e(o,s);if(v!=null)return n(v);o.after||o.error||(o=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(ie("host-webworker")||ie("host-node")))throw Kf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw Kf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Kf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await gst(),fq)return fq.execute(t,e);const l=new AbortController,u=Mo(e,()=>l.abort()),d={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:o,params:s,redoRequest:!1,useIdentity:Jd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},f=e.useRequestQueue?wst(d):ote(d),g=await f.finally(()=>u?.remove());return o?.after?.(g),g}let fq,jRe=!1;const Jd=fr.request,URe="FormData"in globalThis,dst=new Set([499,498,403,401]),pst=new Set(["COM_0056","COM_0057","SB_0008"]),fst=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],uO=()=>null,mq=Symbol();function mst(t){const e=Hh(t);e&&!Si._corsServers.includes(e)&&Si._corsServers.push(e)}function B_e(t){const e=Hh(t);return!e||e.endsWith(".arcgis.com")||Si._corsServers.includes(e)||Zle(e)}function Kf(t,e,i,r){let s;const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:uO,getHeader:uO,ssl:!1};if(e instanceof q)return e.details?(e.details=se(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const a=r&&(()=>Array.from(r.headers)),o=r&&(d=>r.headers.get(d)),l=r?.status,u=e.message;u&&(s=u),a&&o&&(n.getAllHeaders=a,n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?(n.messages=[e.details],s??=e.details):(n.messages=e.details,s??=n.messages?.[0]),n.raw=mq in e?e[mq]:e}return s??="Error",Zr(e)?ti():new q(t,s,n)}async function gst(){ie("host-webworker")&&(!fq&&globalThis.invokeStaticMessage?fq=await W(()=>import("./request-BjXlHgqt.js"),[]):jRe=!0)}async function ate(){nr||await W(()=>import("./IdentityManager-DxgB9y7h.js"),[])}async function yst(t){const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,a=null;if(URe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(a=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},keepalive:i.keepAlive??!1,method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Jd.priority,redirect:"follow",signal:r},(n||a)&&(t.fetchOptions.body=n||a),(jRe||i.authMode==="anonymous")&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||i.query?.token||n?.get("token")),!t.hasToken){const o=sce(e);o&&(i.query??={},i.query.token=o,t.hasToken=!0)}if(t.useIdentity&&!t.hasToken&&!t.credential&&!t.credentialToken&&!BRe(e)&&!sa(r)){let o;i.authMode==="immediate"?(await ate(),o=await nr.getCredential(e,{signal:r})):i.authMode==="no-prompt"?(await ate(),o=await nr.getCredential(e,{prompt:!1,signal:r}).catch(()=>{})):nr&&(o=nr.findCredential(e)),o&&(t.credential=o,t.credentialToken=o.token,t.useSSL=!!o.ssl)}}function BRe(t){return fst.some(e=>e.test(t))}async function vst(t){let e=t.params.url,i=U_e(e);const r=t.params.requestOptions,s=t.fetchOptions??{},n=e1(e)||mm(e),a=r.responseType||"json",o=n?0:r.timeout!=null?r.timeout:Jd.timeout;let l=!1;if(!n){t.useSSL&&(e=Qle(e));let v={...r.query};t.credentialToken&&(v.token=t.credentialToken);let _=cO(v);ie("esri-url-encodes-apostrophe")&&(_=_.replaceAll("'","%27"));const x=i.length+1+_.length;let S;l=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||x>Jd.maxUrlLength;const T=r.useProxy||!!e7(e);if(T){const M=vRe(e);S=M.path,!l&&S.length+1+x>Jd.maxUrlLength&&(l=!0),M.query&&(v={...M.query,...v})}if(s.method==="HEAD"&&(l||T)){if(l)throw x>Jd.maxUrlLength?Kf("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Kf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(T)throw Kf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}l?(s.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=WY(e,v):(s.body=cO(v),s.headers||(s.headers={}),s.headers["Content-Type"]="application/x-www-form-urlencoded")):e=WY(e,v),T&&(t.useProxy=!0,e=`${S}?${e}`),v.token&&URe&&s.body instanceof FormData&&!dRe(e)&&s.body.set("token",v.token),r.hasOwnProperty("withCredentials")?t.withCredentials=r.withCredentials:Ng(e,Gle())||(Zle(e)||nr&&nr.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(s.credentials="include",cst(e)&&await ust(l?WY(e,v):e)),i=U_e(e)}let u,d,f=0,g=!1;o>0&&(f=setTimeout(()=>{g=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")d=s,d.url=i,r.signal?d.signal=r.signal:delete d.signal;else if(r.responseType!=="image"||s.cache!=="default"||s.keepalive||s.method!=="GET"||l||_st(r.headers)||!n&&!t.useProxy&&Jd.proxyUrl&&!B_e(e)){if(Si._beforeFetch&&await Si._beforeFetch(e,s),u=await fetch(i,s),Si._afterFetch&&await Si._afterFetch(u),t.useProxy||mst(e),r.responseType==="native")d=u;else if(s.method!=="HEAD")if(u.ok){switch(a){case"array-buffer":d=await u.arrayBuffer();break;case"blob":case"image":d=await u.blob();break;default:d=await u.text()}if(f&&(clearTimeout(f),f=0),a==="json"||a==="xml"||a==="document")if(d)switch(a){case"json":d=JSON.parse(d);break;case"xml":d=G_e(d,"application/xml");break;case"document":d=G_e(d,"text/html")}else d=null;if(d){if(a==="array-buffer"||a==="blob"){const v=u.headers.get("Content-Type");if(v&&/application\/json|text\/plain/i.test(v)&&d[a==="blob"?"size":"byteLength"]<=750)try{const _=await new Response(d).json();_.error&&(d=_)}catch{}}a==="image"&&d instanceof Blob&&(d=await H_e(URL.createObjectURL(d),t,!0))}}else{d=await u.text();try{d=JSON.parse(d)}catch{}}}else d=await H_e(i,t)}catch(v){if(v.name==="AbortError")throw g?ost():ti("Request canceled");if(!(!u&&v instanceof TypeError&&Jd.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||B_e(e))throw v;t.redoRequest=!0,Drt({proxyUrl:Jd.proxyUrl,urlPrefix:Hh(e)??""})}finally{f&&clearTimeout(f)}return[u,d]}async function q_e(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=Kf("request:interceptor",s,e)}if((r instanceof Error||r instanceof q)&&(i=Kf("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function _st(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function G_e(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}Si._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Si._beforeFetch=void 0,Si._afterFetch=void 0;const bst=new Map;async function wst(t){const e=Sst(t.params.url);if(!e)return ote(t);const{QueueProcessor:i}=await W(()=>import("./QueueProcessor-BOxRV2Gn.js"),[]);return Fu(bst,e.origin,()=>{const s=e.isHosted?ie("request-queue-concurrency-hosted"):ie("request-queue-concurrency-non-hosted");return new i({concurrency:s,process:n=>{if(sa(n.params.requestOptions))throw Kf("",ti("Request canceled"),n.params);return ote(n)}})}).push(t)}async function ote(t){let e,i;await yst(t);try{do[e,i]=await vst(t);while(!await xst(t,e,i))}catch(n){const a=Kf("request:server",n,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(a),a}const r=t.params.url;if(i)if(/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&i.user?.username&&!Zle(r)){const n=Hh(r,!0);n&&Jd.trustedServers.push(n)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&lst(i.authorizedCrossOriginNoCorsDomains)}else(t.params.requestOptions.responseType||"json")==="json"&&hst(r,i);const s=t.credential;if(s&&nr){let a=nr.findServerInfo(s.server)?.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const o=nr.findCredential(a,s.userId);o&&nr._getIdenticalSvcIdx(a,o)===-1&&o.resources.unshift(a)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):uO,getHeader:e?n=>e.headers.get(n):uO,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function xst(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[mq]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[mq]=i,s;let a,o=null;s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a?.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&dst.has(n)&&!BRe(t.params.url)&&(n!==403||(!a||!pst.has(a))&&(o==null||o===2&&t.credentialToken))){await ate();try{const u=await nr.getCredential(t.params.url,{error:Kf("request:server",s,t.params),credential:t.credential,prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=u}}if(s)throw s;return!0}function H_e(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Jd.priority,s.src=t,NRe(s,t,i,r)}function Sst(t){let e,i;return typeof t=="string"?(e=Hh(t,!0),i=pq(t)):(e=t.origin,i=pq(t.toString())),e==null?null:{origin:e,isHosted:i}}function Tst(t,e){return Si(Qs(t),e)}function Qs(t){if(!fr.assetsPath)throw re.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new q("assets:path-not-set","config.assetsPath is not set");return Xh(fr.assetsPath,t)}let ZY,ne=null;function ace(){return!!ne}function $st(){return!!ie("esri-wasm")}function qRe(){return ZY||(ZY=W(async()=>{const{default:t}=await import("./pe-wasm-B87Q3u4k.js");return{default:t}},[]).then(({default:t})=>t({locateFile:e=>Qs(`esri/geometry/support/${e}`)})).then(t=>{JRe(t)}),ZY)}const U6={geogToProj(t,e,i){ne.ensureCache.prepare();const r=ZT(i),s=i===r,n=ne.ensureFloat64(r),a=ne._pe_geog_to_proj(ne.getPointer(t),e,n);return a&&t1(i,e,n,s),a},projGeog(t,e,i,r){switch(r){case In.PE_TRANSFORM_P_TO_G:return U6.projToGeog(t,e,i);case In.PE_TRANSFORM_G_TO_P:return U6.geogToProj(t,e,i)}return 0},projToGeog:(t,e,i)=>U6.projToGeogCenter(t,e,i,0),projToGeogCenter(t,e,i,r){ne.ensureCache.prepare();const s=ZT(i),n=i===s,a=ne.ensureFloat64(s),o=ne._pe_proj_to_geog_center(ne.getPointer(t),e,a,r);return o&&t1(i,e,a,n),o}};let In=class Rr{static init(){Rr.PE_BUFFER_MAX=ne.PeDefs.prototype.PE_BUFFER_MAX,Rr.PE_NAME_MAX=ne.PeDefs.prototype.PE_NAME_MAX,Rr.PE_MGRS_MAX=ne.PeDefs.prototype.PE_MGRS_MAX,Rr.PE_USNG_MAX=ne.PeDefs.prototype.PE_USNG_MAX,Rr.PE_DD_MAX=ne.PeDefs.prototype.PE_DD_MAX,Rr.PE_DDM_MAX=ne.PeDefs.prototype.PE_DDM_MAX,Rr.PE_DMS_MAX=ne.PeDefs.prototype.PE_DMS_MAX,Rr.PE_UTM_MAX=ne.PeDefs.prototype.PE_UTM_MAX,Rr.PE_PARM_MAX=ne.PeDefs.prototype.PE_PARM_MAX,Rr.PE_TYPE_NONE=ne.PeDefs.prototype.PE_TYPE_NONE,Rr.PE_TYPE_GEOGCS=ne.PeDefs.prototype.PE_TYPE_GEOGCS,Rr.PE_TYPE_PROJCS=ne.PeDefs.prototype.PE_TYPE_PROJCS,Rr.PE_TYPE_GEOGTRAN=ne.PeDefs.prototype.PE_TYPE_GEOGTRAN,Rr.PE_TYPE_COORDSYS=ne.PeDefs.prototype.PE_TYPE_COORDSYS,Rr.PE_TYPE_UNIT=ne.PeDefs.prototype.PE_TYPE_UNIT,Rr.PE_TYPE_LINUNIT=ne.PeDefs.prototype.PE_TYPE_LINUNIT,Rr.PE_STR_OPTS_NONE=ne.PeDefs.prototype.PE_STR_OPTS_NONE,Rr.PE_STR_AUTH_NONE=ne.PeDefs.prototype.PE_STR_AUTH_NONE,Rr.PE_STR_AUTH_TOP=ne.PeDefs.prototype.PE_STR_AUTH_TOP,Rr.PE_STR_NAME_CANON=ne.PeDefs.prototype.PE_STR_NAME_CANON,Rr.PE_STR_FMT_WKT=ne.PeDefs.prototype.PE_STR_FMT_WKT,Rr.PE_STR_FMT_WKT2=ne.PeDefs.prototype.PE_STR_FMT_WKT2,Rr.PE_PARM_X0=ne.PeDefs.prototype.PE_PARM_X0,Rr.PE_PARM_ND=ne.PeDefs.prototype.PE_PARM_ND,Rr.PE_TRANSFORM_1_TO_2=ne.PeDefs.prototype.PE_TRANSFORM_1_TO_2,Rr.PE_TRANSFORM_2_TO_1=ne.PeDefs.prototype.PE_TRANSFORM_2_TO_1,Rr.PE_TRANSFORM_P_TO_G=ne.PeDefs.prototype.PE_TRANSFORM_P_TO_G,Rr.PE_TRANSFORM_G_TO_P=ne.PeDefs.prototype.PE_TRANSFORM_G_TO_P,Rr.PE_HORIZON_RECT=ne.PeDefs.prototype.PE_HORIZON_RECT,Rr.PE_HORIZON_POLY=ne.PeDefs.prototype.PE_HORIZON_POLY,Rr.PE_HORIZON_LINE=ne.PeDefs.prototype.PE_HORIZON_LINE,Rr.PE_HORIZON_DELTA=ne.PeDefs.prototype.PE_HORIZON_DELTA}},GRe=null;const W_e={},Z_e={},Y_e=t=>{const e=t.getType();switch(e){case In.PE_TYPE_GEOGCS:t=ne.castObject(t,ne.PeGeogcs);break;case In.PE_TYPE_PROJCS:t=ne.castObject(t,ne.PeProjcs);break;case In.PE_TYPE_GEOGTRAN:t=ne.castObject(t,ne.PeGeogtran);break;default:e&In.PE_TYPE_UNIT&&(t=ne.castObject(t,ne.PeUnit))}return t},MM={initialize(){ne.PeFactory.prototype.initialize(null)},coordsys:t=>MM.factoryByType(In.PE_TYPE_COORDSYS,t),factoryByType(t,e){let i=null,r=W_e[t];if(r||(r={},W_e[t]=r),r.hasOwnProperty(String(e))&&(i=r[e],ne.compare(i,ne.NULL)&&(i=null)),!i){const s=ne.PeFactory.prototype.factoryByType(t,e);ne.compare(s,ne.NULL)||(i=Y_e(s),r[e]=i)}return i},fromString(t,e){let i=null,r=Z_e[t];if(r||(r={},Z_e[t]=r),r.hasOwnProperty(e)&&(i=r[e],ne.compare(i,ne.NULL)&&(i=null)),!i){const s=ne.PeFactory.prototype.fromString(t,e);ne.compare(s,ne.NULL)||(i=Y_e(s),r[e]=i)}return i},geogcs:t=>MM.factoryByType(In.PE_TYPE_GEOGCS,t),geogtran:t=>MM.factoryByType(In.PE_TYPE_GEOGTRAN,t),getCode:t=>ne.PeFactory.prototype.getCode(t),projcs:t=>MM.factoryByType(In.PE_TYPE_PROJCS,t),unit:t=>MM.factoryByType(In.PE_TYPE_UNIT,t)};let J_e,HRe=null;const oce={PE_GTLIST_OPTS_COMMON:0,init(){oce.PE_GTLIST_OPTS_COMMON=ne.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,J_e=ne._pe_getPeGTlistExtendedEntrySize()},getGTlist(t,e,i,r,s,n){let a=null;const o=new ne.PeInteger(n);try{const l=ne.PeGTlistExtended.prototype.getGTlist(t,e,i,r,s,o);if((n=o.val)&&(a=[l],n>1)){const u=ne.getPointer(l);for(let d=1;d<n;d++)a.push(ne.wrapPointer(u+J_e*d,ne.PeGTlistExtendedEntry))}}finally{ne.destroy(o)}return a}},Cst={destroy(t){if(t?.length){for(const e of t)bf(e),e.getEntries().forEach(i=>{bf(i);const r=i.getGeogtran();bf(r),r.getParameters().forEach(bf),[r.getGeogcs1(),r.getGeogcs2()].forEach(s=>{bf(s);const n=s.getDatum();bf(n),bf(n.getSpheroid()),bf(s.getPrimem()),bf(s.getUnit())})});ne.PeGTlistExtendedEntry.prototype.Delete(t[0])}}},Mst={geogToGeog(t,e,i,r,s){ne.ensureCache.prepare();const n=ZT(i),a=i===n,o=ne.ensureFloat64(n);let l=0;r&&(l=ne.ensureFloat64(r));const u=ne._pe_geog_to_geog(ne.getPointer(t),e,o,l,s);return u&&t1(i,e,o,a),u}},Est={geodesicCoordinate(t,e,i,r,s,n,a,o){ne.PeLineType.prototype.geodesic_coordinate(t,e,i,r,s,n,a,o)},geodeticCoordinate(t,e,i,r,s,n,a,o,l){ne.PeLineType.prototype.geodetic_coordinate(t,e,i,r,s,n,a,o,l)},geodeticDistance(t,e,i,r,s,n,a,o,l,u){ne.PeLineType.prototype.geodetic_distance(t,e,i,r,s,n,a,o,l,u)},greatEllipticDistance(t,e,i,r,s,n,a,o,l){ne.PeLineType.prototype.great_elliptic_distance(t,e,i,r,s,n,a,o,l)}},Ast={phiToEta:(t,e)=>ne.PeMath.prototype.phi_to_eta(t,e),etaToPhi:(t,e)=>ne.PeMath.prototype.eta_to_phi(t,e),phiToPhig:(t,e)=>ne.PeMath.prototype.phi_to_phig(t,e),q:(t,e,i)=>ne.PeMath.prototype.q(t,e,i),q90:(t,e)=>ne.PeMath.prototype.q90(t,e)},YY=(t,e,i,r,s,n)=>{let a,o;switch(ne.ensureCache.prepare(),t){case"dd":a=ne._pe_geog_to_dd,o=In.PE_DD_MAX;break;case"ddm":a=ne._pe_geog_to_ddm,o=In.PE_DDM_MAX;break;case"dms":a=ne._pe_geog_to_dms,o=In.PE_DMS_MAX}let l=0;e&&(l=ne.getPointer(e));const u=ZT(r),d=ne.ensureFloat64(u),f=r7(i,o),g=a(l,i,d,s,ne.ensureInt32(f));if(g)for(let v=0;v<i;v++)n[v]=ne.UTF8ToString(f[v]);return g},JY=(t,e,i,r,s)=>{let n;switch(ne.ensureCache.prepare(),t){case"dd":n=ne._pe_dd_to_geog;break;case"ddm":n=ne._pe_ddm_to_geog;break;case"dms":n=ne._pe_dms_to_geog}let a=0;e&&(a=ne.getPointer(e));const o=r.map(f=>ne.ensureString(f)),l=ne.ensureInt32(o),u=ne.ensureFloat64(new Array(2*i)),d=n(a,i,l,u);return d&&t1(s,i,u),d},Ost={geogToDms:(t,e,i,r,s)=>YY("dms",t,e,i,r,s),dmsToGeog:(t,e,i,r)=>JY("dms",t,e,i,r),geogToDdm:(t,e,i,r,s)=>YY("ddm",t,e,i,r,s),ddmToGeog:(t,e,i,r)=>JY("ddm",t,e,i,r),geogToDd:(t,e,i,r,s)=>YY("dd",t,e,i,r,s),ddToGeog:(t,e,i,r)=>JY("dd",t,e,i,r)};let WRe=class EM{static init(){EM.PE_MGRS_STYLE_NEW=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,EM.PE_MGRS_STYLE_OLD=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,EM.PE_MGRS_STYLE_AUTO=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,EM.PE_MGRS_180_ZONE_1_PLUS=ne.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,EM.PE_MGRS_ADD_SPACES=ne.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}static geogToMgrsExtended(e,i,r,s,n,a,o){ne.ensureCache.prepare();let l=0;e&&(l=ne.getPointer(e));const u=ZT(r),d=ne.ensureFloat64(u),f=r7(i,In.PE_MGRS_MAX),g=ne.ensureInt32(f),v=ne._pe_geog_to_mgrs_extended(l,i,d,s,n,a,g);if(v)for(let _=0;_<i;_++)o[_]=ne.UTF8ToString(f[_]);return v}static mgrsToGeogExtended(e,i,r,s,n){ne.ensureCache.prepare();let a=0;e&&(a=ne.getPointer(e));const o=r.map(f=>ne.ensureString(f)),l=ne.ensureInt32(o),u=ne.ensureFloat64(new Array(2*i)),d=ne._pe_mgrs_to_geog_extended(a,i,l,s,u);return d&&t1(n,i,u),d}};const Pst={geogToUsng(t,e,i,r,s,n,a){ne.ensureCache.prepare();let o=0;t&&(o=ne.getPointer(t));const l=ZT(i),u=ne.ensureFloat64(l),d=r7(e,In.PE_MGRS_MAX),f=ne.ensureInt32(d),g=ne._pe_geog_to_usng(o,e,u,r,s,n,f);if(g)for(let v=0;v<e;v++)a[v]=ne.UTF8ToString(d[v]);return g},usngToGeog(t,e,i,r){ne.ensureCache.prepare();let s=0;t&&(s=ne.getPointer(t));const n=i.map(u=>ne.ensureString(u)),a=ne.ensureInt32(n),o=ne.ensureFloat64(new Array(2*e)),l=ne._pe_usng_to_geog(s,e,a,o);return l&&t1(r,e,o),l}};let ZRe=class B6{static init(){B6.PE_UTM_OPTS_NONE=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,B6.PE_UTM_OPTS_ADD_SPACES=ne.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,B6.PE_UTM_OPTS_NS=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NS}static geogToUtm(e,i,r,s,n){ne.ensureCache.prepare();let a=0;e&&(a=ne.getPointer(e));const o=ZT(r),l=ne.ensureFloat64(o),u=r7(i,In.PE_UTM_MAX),d=ne.ensureInt32(u),f=ne._pe_geog_to_utm(a,i,l,s,d);if(f)for(let g=0;g<i;g++)n[g]=ne.UTF8ToString(u[g]);return f}static utmToGeog(e,i,r,s,n){ne.ensureCache.prepare();let a=0;e&&(a=ne.getPointer(e));const o=r.map(f=>ne.ensureString(f)),l=ne.ensureInt32(o),u=ne.ensureFloat64(new Array(2*i)),d=ne._pe_utm_to_geog(a,i,l,s,u);return d&&t1(n,i,u),d}};var Cu;let YRe=(Cu=class{static init(){Cu.PE_PCSINFO_OPTION_NONE=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,Cu.PE_PCSINFO_OPTION_DOMAIN=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,Cu.PE_POLE_OUTSIDE_BOUNDARY=ne.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,Cu.PE_POLE_POINT=ne.PePCSInfo.prototype.PE_POLE_POINT}static generate(e,i=Cu.PE_PCSINFO_OPTION_DOMAIN){let r=null,s=null;return Cu.cache.has(e)&&(s=Cu.cache.get(e),s[i]&&(r=s[i])),r||(r=ne.PePCSInfo.prototype.generate(e,i),s||(s=[],Cu.cache.set(e,s)),s[i]=r),r}},Cu.cache=new Map,Cu);const Rst={versionString:()=>ne.PeVersion.prototype.version_string()};function JRe(t){function e(n,a,o){n[a]=o(n[a])}ne=t,In.init(),oce.init(),WRe.init(),ZRe.init(),YRe.init(),GRe=class extends ne.PeDouble{constructor(n=NaN){super(n)}destroy(){ne.destroy(this)}[Symbol.dispose](){this.destroy()}},HRe=class extends ne.PeGCSExtent{destroy(){ne.destroy(this)}[Symbol.dispose](){this.destroy()}};const i=[ne.PeAngunit,ne.PeDatum,ne.PeGeogcs,ne.PeGeogtran,ne.PeObject,ne.PeParameter,ne.PePrimem,ne.PeProjcs,ne.PeSpheroid,ne.PeUnit];for(const n of i)e(n.prototype,"getName",a=>function(){return a.call(this,new Array(In.PE_NAME_MAX))});for(const n of[ne.PeGeogtran,ne.PeProjcs])e(n.prototype,"getParameters",a=>function(){const o=new Array(In.PE_PARM_MAX);let l=a.call(this);for(let u=0;u<o.length;u++){const d=ne.getValue(l,"*");o[u]=d?ne.wrapPointer(d,ne.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return o});e(ne.PeHorizon.prototype,"getCoord",n=>function(a=!1){const o=this.getSize();if(!o)return null;const l=[];return t1(l,o,n.call(this),a),l}),e(ne.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const a=ne._pe_getPeGTlistExtendedGTsSize();return function(){let o=null;const l=n.call(this);if(!ne.compare(l,ne.NULL)){o=[l];const u=this.getSteps();if(u>1){const d=ne.getPointer(l);for(let f=1;f<u;f++)o.push(ne.wrapPointer(d+a*f,ne.PeGTlistExtendedGTs))}}return o}});const r=ne._pe_getPeHorizonSize(),s=n=>function(){let a=this._cache;if(a||(a=new Map,this._cache=a),a.has(n))return a.get(n);let o=null;const l=n.call(this);if(!ne.compare(l,ne.NULL)){o=[l];const u=l.getNump();if(u>1){const d=ne.getPointer(l);for(let f=1;f<u;f++)o.push(ne.wrapPointer(d+r*f,ne.PeHorizon))}}return a.set(n,o),o};e(ne.PeProjcs.prototype,"horizonGcsGenerate",s),e(ne.PeProjcs.prototype,"horizonPcsGenerate",s),ne.PeObject.prototype.toString=function(n=In.PE_STR_OPTS_NONE){ne.ensureCache.prepare();const a=ne.getPointer(this),o=ne.ensureInt8(new Array(In.PE_BUFFER_MAX));return ne.UTF8ToString(ne._pe_object_to_string_ext(a,n,o))},ne.PeGeogcs.prototype.destroy=function(){this.Delete(),bf(this),this.ptr=0},ne.PeGeogcs.prototype[Symbol.dispose]=function(){this.destroy()},ne.PeProjcs.prototype.destroy=function(){this.Delete(),bf(this),this.ptr=0},ne.PeProjcs.prototype[Symbol.dispose]=function(){this.destroy()}}function bf(t){if(!t)return;const e=ne.getClass(t);if(!e)return;const i=ne.getCache(e);if(!i)return;const r=ne.getPointer(t);r&&delete i[r]}function r7(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(ne.ensureInt8(r));return i}function ZT(t){return ArrayBuffer.isView(t)?t:Array.isArray(t[0])?t.flat():t}function t1(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=ne.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=ne.getValue(i,"double"),t[n][1]=ne.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}const Ist=Object.freeze(Object.defineProperty({__proto__:null,PeCSTransformations:U6,PeDefs:In,get PeDouble(){return GRe},PeFactory:MM,get PeGCSExtent(){return HRe},PeGTTransformations:Mst,PeGTlistExtended:oce,PeGTlistExtendedEntry:Cst,PeLineType:Est,PeMath:Ast,PeNotationDms:Ost,PeNotationMgrs:WRe,PeNotationUsng:Pst,PeNotationUtm:ZRe,PePCSInfo:YRe,PeVersion:Rst,_init:JRe,get _pe(){return ne},isLoaded:ace,isSupported:$st,load:qRe},Symbol.toStringTag,{value:"Module"}));let b;const z={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,10592:0,10594:0,10596:0,10598:0,10601:0,10603:0,10626:0,10632:0,10641:0,10665:0,10674:0,10744:0,10745:0,10759:0,10773:0,10802:0,10820:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,65061:2,65062:2,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1,103978:2,103979:0,103980:2,103981:0};for(b=2e3;b<=2045;b++)z[b]=0;for(b=2056;b<=2065;b++)z[b]=0;for(b=2067;b<=2135;b++)z[b]=0;for(b=2137;b<=2154;b++)z[b]=0;for(b=2161;b<=2170;b++)z[b]=0;for(b=2172;b<=2193;b++)z[b]=0;for(b=2195;b<=2198;b++)z[b]=0;for(b=2200;b<=2203;b++)z[b]=0;for(b=2205;b<=2217;b++)z[b]=0;for(b=2222;b<=2224;b++)z[b]=1;for(b=2225;b<=2250;b++)z[b]=2;for(b=2251;b<=2253;b++)z[b]=1;for(b=2257;b<=2264;b++)z[b]=2;for(b=2274;b<=2279;b++)z[b]=2;for(b=2280;b<=2282;b++)z[b]=1;for(b=2283;b<=2289;b++)z[b]=2;for(b=2290;b<=2292;b++)z[b]=0;for(b=2308;b<=2313;b++)z[b]=0;for(b=2315;b<=2491;b++)z[b]=0;for(b=2494;b<=2866;b++)z[b]=0;for(b=2867;b<=2869;b++)z[b]=1;for(b=2870;b<=2888;b++)z[b]=2;for(b=2891;b<=2895;b++)z[b]=2;for(b=2896;b<=2898;b++)z[b]=1;for(b=2902;b<=2908;b++)z[b]=2;for(b=2915;b<=2920;b++)z[b]=2;for(b=2921;b<=2923;b++)z[b]=1;for(b=2924;b<=2930;b++)z[b]=2;for(b=2931;b<=2962;b++)z[b]=0;for(b=2964;b<=2968;b++)z[b]=2;for(b=2969;b<=2973;b++)z[b]=0;for(b=2975;b<=2991;b++)z[b]=0;for(b=2995;b<=3051;b++)z[b]=0;for(b=3054;b<=3079;b++)z[b]=0;for(b=3081;b<=3088;b++)z[b]=0;for(b=3092;b<=3101;b++)z[b]=0;for(b=3106;b<=3138;b++)z[b]=0;for(b=3146;b<=3151;b++)z[b]=0;for(b=3153;b<=3166;b++)z[b]=0;for(b=3168;b<=3172;b++)z[b]=0;for(b=3174;b<=3203;b++)z[b]=0;for(b=3294;b<=3358;b++)z[b]=0;for(b=3367;b<=3403;b++)z[b]=0;for(b=3408;b<=3416;b++)z[b]=0;for(b=3417;b<=3438;b++)z[b]=2;for(b=3441;b<=3446;b++)z[b]=2;for(b=3447;b<=3450;b++)z[b]=0;for(b=3451;b<=3459;b++)z[b]=2;for(b=3460;b<=3478;b++)z[b]=0;for(b=3554;b<=3559;b++)z[b]=0;for(b=3560;b<=3570;b++)z[b]=2;for(b=3571;b<=3581;b++)z[b]=0;for(b=3594;b<=3597;b++)z[b]=0;for(b=3601;b<=3604;b++)z[b]=0;for(b=3637;b<=3639;b++)z[b]=0;for(b=3665;b<=3667;b++)z[b]=0;for(b=3693;b<=3695;b++)z[b]=0;for(b=3701;b<=3727;b++)z[b]=0;for(b=3728;b<=3739;b++)z[b]=2;for(b=3740;b<=3751;b++)z[b]=0;for(b=3753;b<=3760;b++)z[b]=2;for(b=3761;b<=3773;b++)z[b]=0;for(b=3775;b<=3777;b++)z[b]=0;for(b=3779;b<=3781;b++)z[b]=0;for(b=3783;b<=3785;b++)z[b]=0;for(b=3788;b<=3791;b++)z[b]=0;for(b=3797;b<=3802;b++)z[b]=0;for(b=3814;b<=3816;b++)z[b]=0;for(b=3825;b<=3829;b++)z[b]=0;for(b=3832;b<=3841;b++)z[b]=0;for(b=3844;b<=3852;b++)z[b]=0;for(b=3873;b<=3885;b++)z[b]=0;for(b=3890;b<=3893;b++)z[b]=0;for(b=3907;b<=3912;b++)z[b]=0;for(b=3942;b<=3950;b++)z[b]=0;for(b=3968;b<=3970;b++)z[b]=0;for(b=3973;b<=3976;b++)z[b]=0;for(b=3986;b<=3989;b++)z[b]=0;for(b=3994;b<=3997;b++)z[b]=0;for(b=4048;b<=4051;b++)z[b]=0;for(b=4056;b<=4063;b++)z[b]=0;for(b=4093;b<=4096;b++)z[b]=0;for(b=4390;b<=4398;b++)z[b]=0;for(b=4399;b<=4413;b++)z[b]=2;for(b=4418;b<=4433;b++)z[b]=2;for(b=4455;b<=4457;b++)z[b]=2;for(b=4484;b<=4489;b++)z[b]=0;for(b=4491;b<=4554;b++)z[b]=0;for(b=4568;b<=4589;b++)z[b]=0;for(b=4652;b<=4656;b++)z[b]=0;for(b=4766;b<=4800;b++)z[b]=0;for(b=5014;b<=5016;b++)z[b]=0;for(b=5069;b<=5072;b++)z[b]=0;for(b=5105;b<=5130;b++)z[b]=0;for(b=5167;b<=5188;b++)z[b]=0;for(b=5253;b<=5259;b++)z[b]=0;for(b=5269;b<=5275;b++)z[b]=0;for(b=5292;b<=5311;b++)z[b]=0;for(b=5329;b<=5331;b++)z[b]=0;for(b=5343;b<=5349;b++)z[b]=0;for(b=5355;b<=5357;b++)z[b]=0;for(b=5387;b<=5389;b++)z[b]=0;for(b=5459;b<=5463;b++)z[b]=0;for(b=5479;b<=5482;b++)z[b]=0;for(b=5518;b<=5520;b++)z[b]=0;for(b=5530;b<=5539;b++)z[b]=0;for(b=5550;b<=5552;b++)z[b]=0;for(b=5562;b<=5583;b++)z[b]=0;for(b=5623;b<=5625;b++)z[b]=2;for(b=5631;b<=5639;b++)z[b]=0;for(b=5649;b<=5653;b++)z[b]=0;for(b=5663;b<=5680;b++)z[b]=0;for(b=5682;b<=5685;b++)z[b]=0;for(b=5875;b<=5877;b++)z[b]=0;for(b=5896;b<=5899;b++)z[b]=0;for(b=5921;b<=5940;b++)z[b]=0;for(b=6050;b<=6125;b++)z[b]=0;for(b=6244;b<=6275;b++)z[b]=0;for(b=6328;b<=6348;b++)z[b]=0;for(b=6350;b<=6356;b++)z[b]=0;for(b=6366;b<=6372;b++)z[b]=0;for(b=6381;b<=6387;b++)z[b]=0;for(b=6393;b<=6404;b++)z[b]=0;for(b=6480;b<=6483;b++)z[b]=0;for(b=6511;b<=6514;b++)z[b]=0;for(b=6579;b<=6581;b++)z[b]=0;for(b=6619;b<=6624;b++)z[b]=0;for(b=6625;b<=6627;b++)z[b]=2;for(b=6628;b<=6632;b++)z[b]=0;for(b=6634;b<=6637;b++)z[b]=0;for(b=6669;b<=6692;b++)z[b]=0;for(b=6707;b<=6709;b++)z[b]=0;for(b=6720;b<=6723;b++)z[b]=0;for(b=6732;b<=6738;b++)z[b]=0;for(b=6931;b<=6933;b++)z[b]=0;for(b=6956;b<=6959;b++)z[b]=0;for(b=7005;b<=7007;b++)z[b]=0;for(b=7057;b<=7070;b++)z[b]=2;for(b=7074;b<=7082;b++)z[b]=0;for(b=7109;b<=7118;b++)z[b]=0;for(b=7119;b<=7127;b++)z[b]=1;for(b=7374;b<=7376;b++)z[b]=0;for(b=7528;b<=7586;b++)z[b]=0;for(b=7587;b<=7645;b++)z[b]=2;for(b=7692;b<=7696;b++)z[b]=0;for(b=7755;b<=7787;b++)z[b]=0;for(b=7791;b<=7795;b++)z[b]=0;for(b=7799;b<=7801;b++)z[b]=0;for(b=7803;b<=7805;b++)z[b]=0;for(b=7825;b<=7831;b++)z[b]=0;for(b=7845;b<=7859;b++)z[b]=0;for(b=8013;b<=8032;b++)z[b]=0;for(b=8065;b<=8068;b++)z[b]=1;for(b=8518;b<=8529;b++)z[b]=2;for(b=8533;b<=8536;b++)z[b]=2;for(b=8538;b<=8540;b++)z[b]=2;for(b=8677;b<=8679;b++)z[b]=0;for(b=8836;b<=8840;b++)z[b]=0;for(b=8857;b<=8859;b++)z[b]=0;for(b=8908;b<=8910;b++)z[b]=0;for(b=9154;b<=9159;b++)z[b]=0;for(b=9205;b<=9218;b++)z[b]=0;for(b=9271;b<=9273;b++)z[b]=0;for(b=9295;b<=9297;b++)z[b]=0;for(b=9356;b<=9360;b++)z[b]=0;for(b=9404;b<=9407;b++)z[b]=0;for(b=9476;b<=9482;b++)z[b]=0;for(b=9487;b<=9494;b++)z[b]=0;for(b=9697;b<=9699;b++)z[b]=0;for(b=9821;b<=9865;b++)z[b]=0;for(b=10285;b<=10291;b++)z[b]=0;for(b=10314;b<=10317;b++)z[b]=0;for(b=10448;b<=10465;b++)z[b]=0;for(b=10726;b<=10729;b++)z[b]=0;for(b=10731;b<=10733;b++)z[b]=0;for(b=11114;b<=11118;b++)z[b]=0;for(b=20004;b<=20032;b++)z[b]=0;for(b=20047;b<=20049;b++)z[b]=0;for(b=20062;b<=20092;b++)z[b]=0;for(b=20135;b<=20138;b++)z[b]=0;for(b=20248;b<=20258;b++)z[b]=0;for(b=20348;b<=20358;b++)z[b]=0;for(b=20436;b<=20440;b++)z[b]=0;for(b=20822;b<=20824;b++)z[b]=0;for(b=20904;b<=20932;b++)z[b]=0;for(b=20934;b<=20936;b++)z[b]=0;for(b=21004;b<=21032;b++)z[b]=0;for(b=21035;b<=21037;b++)z[b]=0;for(b=21095;b<=21097;b++)z[b]=0;for(b=21148;b<=21150;b++)z[b]=0;for(b=21207;b<=21264;b++)z[b]=0;for(b=21307;b<=21364;b++)z[b]=0;for(b=21413;b<=21423;b++)z[b]=0;for(b=21453;b<=21463;b++)z[b]=0;for(b=21473;b<=21483;b++)z[b]=0;for(b=21780;b<=21782;b++)z[b]=0;for(b=21891;b<=21894;b++)z[b]=0;for(b=21896;b<=21899;b++)z[b]=0;for(b=22171;b<=22177;b++)z[b]=0;for(b=22181;b<=22187;b++)z[b]=0;for(b=22191;b<=22197;b++)z[b]=0;for(b=22207;b<=22222;b++)z[b]=0;for(b=22229;b<=22232;b++)z[b]=0;for(b=22234;b<=22236;b++)z[b]=0;for(b=22243;b<=22250;b++)z[b]=0;for(b=22262;b<=22265;b++)z[b]=0;for(b=22307;b<=22322;b++)z[b]=0;for(b=22348;b<=22357;b++)z[b]=0;for(b=22407;b<=22422;b++)z[b]=0;for(b=22462;b<=22465;b++)z[b]=0;for(b=22521;b<=22525;b++)z[b]=0;for(b=22607;b<=22622;b++)z[b]=0;for(b=22641;b<=22646;b++)z[b]=0;for(b=22648;b<=22657;b++)z[b]=0;for(b=22707;b<=22722;b++)z[b]=0;for(b=22762;b<=22765;b++)z[b]=0;for(b=22807;b<=22822;b++)z[b]=0;for(b=22991;b<=22994;b++)z[b]=0;for(b=23028;b<=23038;b++)z[b]=0;for(b=23301;b<=23333;b++)z[b]=2;for(b=23830;b<=23853;b++)z[b]=0;for(b=23866;b<=23872;b++)z[b]=0;for(b=23877;b<=23884;b++)z[b]=0;for(b=23886;b<=23894;b++)z[b]=0;for(b=23946;b<=23948;b++)z[b]=0;for(b=24311;b<=24313;b++)z[b]=0;for(b=24342;b<=24347;b++)z[b]=0;for(b=24370;b<=24374;b++)z[b]=10;for(b=24375;b<=24381;b++)z[b]=0;for(b=24718;b<=24721;b++)z[b]=0;for(b=24817;b<=24821;b++)z[b]=0;for(b=24877;b<=24882;b++)z[b]=0;for(b=24891;b<=24893;b++)z[b]=0;for(b=25391;b<=25395;b++)z[b]=0;for(b=25828;b<=25838;b++)z[b]=0;for(b=26191;b<=26195;b++)z[b]=0;for(b=26391;b<=26393;b++)z[b]=0;for(b=26701;b<=26722;b++)z[b]=0;for(b=26729;b<=26799;b++)z[b]=2;for(b=26801;b<=26803;b++)z[b]=2;for(b=26811;b<=26813;b++)z[b]=2;for(b=26847;b<=26870;b++)z[b]=2;for(b=26891;b<=26899;b++)z[b]=0;for(b=26901;b<=26923;b++)z[b]=0;for(b=26929;b<=26946;b++)z[b]=0;for(b=26948;b<=26998;b++)z[b]=0;for(b=27037;b<=27040;b++)z[b]=0;for(b=27205;b<=27232;b++)z[b]=0;for(b=27258;b<=27260;b++)z[b]=0;for(b=27391;b<=27398;b++)z[b]=0;for(b=27561;b<=27564;b++)z[b]=0;for(b=27571;b<=27574;b++)z[b]=0;for(b=27581;b<=27584;b++)z[b]=0;for(b=27591;b<=27594;b++)z[b]=0;for(b=27700;b<=27707;b++)z[b]=0;for(b=28191;b<=28193;b++)z[b]=0;for(b=28348;b<=28358;b++)z[b]=0;for(b=28402;b<=28432;b++)z[b]=0;for(b=28462;b<=28492;b++)z[b]=0;for(b=29118;b<=29122;b++)z[b]=0;for(b=29168;b<=29172;b++)z[b]=0;for(b=29177;b<=29185;b++)z[b]=0;for(b=29187;b<=29195;b++)z[b]=0;for(b=29900;b<=29903;b++)z[b]=0;for(b=30161;b<=30179;b++)z[b]=0;for(b=30491;b<=30494;b++)z[b]=0;for(b=30729;b<=30732;b++)z[b]=0;for(b=31251;b<=31259;b++)z[b]=0;for(b=31265;b<=31268;b++)z[b]=0;for(b=31275;b<=31279;b++)z[b]=0;for(b=31281;b<=31297;b++)z[b]=0;for(b=31461;b<=31469;b++)z[b]=0;for(b=31491;b<=31495;b++)z[b]=0;for(b=31917;b<=31922;b++)z[b]=0;for(b=31965;b<=32e3;b++)z[b]=0;for(b=32001;b<=32003;b++)z[b]=2;for(b=32005;b<=32031;b++)z[b]=2;for(b=32033;b<=32060;b++)z[b]=2;for(b=32064;b<=32067;b++)z[b]=2;for(b=32074;b<=32077;b++)z[b]=2;for(b=32081;b<=32086;b++)z[b]=0;for(b=32107;b<=32130;b++)z[b]=0;for(b=32133;b<=32159;b++)z[b]=0;for(b=32164;b<=32167;b++)z[b]=2;for(b=32180;b<=32199;b++)z[b]=0;for(b=32201;b<=32260;b++)z[b]=0;for(b=32301;b<=32360;b++)z[b]=0;for(b=32401;b<=32460;b++)z[b]=0;for(b=32501;b<=32560;b++)z[b]=0;for(b=32601;b<=32662;b++)z[b]=0;for(b=32664;b<=32667;b++)z[b]=2;for(b=32701;b<=32761;b++)z[b]=0;for(b=53001;b<=53004;b++)z[b]=0;for(b=53008;b<=53019;b++)z[b]=0;for(b=53021;b<=53032;b++)z[b]=0;for(b=53034;b<=53037;b++)z[b]=0;for(b=53042;b<=53046;b++)z[b]=0;for(b=53074;b<=53080;b++)z[b]=0;for(b=54001;b<=54004;b++)z[b]=0;for(b=54008;b<=54019;b++)z[b]=0;for(b=54021;b<=54032;b++)z[b]=0;for(b=54034;b<=54037;b++)z[b]=0;for(b=54042;b<=54046;b++)z[b]=0;for(b=54048;b<=54053;b++)z[b]=0;for(b=54074;b<=54080;b++)z[b]=0;for(b=54090;b<=54096;b++)z[b]=0;for(b=54098;b<=54101;b++)z[b]=0;for(b=65161;b<=65163;b++)z[b]=0;for(b=102001;b<=102040;b++)z[b]=0;for(b=102042;b<=102063;b++)z[b]=0;for(b=102065;b<=102067;b++)z[b]=0;for(b=102070;b<=102117;b++)z[b]=0;for(b=102122;b<=102216;b++)z[b]=0;for(b=102221;b<=102377;b++)z[b]=0;for(b=102382;b<=102388;b++)z[b]=0;for(b=102389;b<=102398;b++)z[b]=2;for(b=102399;b<=102444;b++)z[b]=0;for(b=102445;b<=102447;b++)z[b]=2;for(b=102448;b<=102458;b++)z[b]=0;for(b=102459;b<=102468;b++)z[b]=2;for(b=102469;b<=102499;b++)z[b]=0;for(b=102500;b<=102519;b++)z[b]=1;for(b=102520;b<=102524;b++)z[b]=0;for(b=102525;b<=102529;b++)z[b]=2;for(b=102530;b<=102588;b++)z[b]=0;for(b=102590;b<=102598;b++)z[b]=0;for(b=102601;b<=102603;b++)z[b]=0;for(b=102605;b<=102628;b++)z[b]=0;for(b=102629;b<=102646;b++)z[b]=2;for(b=102648;b<=102700;b++)z[b]=2;for(b=102701;b<=102703;b++)z[b]=0;for(b=102707;b<=102730;b++)z[b]=2;for(b=102733;b<=102758;b++)z[b]=2;for(b=102767;b<=102900;b++)z[b]=0;for(b=102901;b<=102933;b++)z[b]=2;for(b=102934;b<=102950;b++)z[b]=13;for(b=102951;b<=102963;b++)z[b]=0;for(b=102965;b<=102969;b++)z[b]=0;for(b=102971;b<=102973;b++)z[b]=0;for(b=102975;b<=102989;b++)z[b]=0;for(b=102990;b<=102992;b++)z[b]=1;for(b=102997;b<=103002;b++)z[b]=0;for(b=103003;b<=103008;b++)z[b]=2;for(b=103009;b<=103011;b++)z[b]=0;for(b=103012;b<=103014;b++)z[b]=2;for(b=103019;b<=103021;b++)z[b]=0;for(b=103022;b<=103024;b++)z[b]=2;for(b=103029;b<=103031;b++)z[b]=0;for(b=103032;b<=103034;b++)z[b]=2;for(b=103065;b<=103068;b++)z[b]=0;for(b=103074;b<=103076;b++)z[b]=0;for(b=103077;b<=103079;b++)z[b]=1;for(b=103080;b<=103082;b++)z[b]=0;for(b=103083;b<=103085;b++)z[b]=2;for(b=103090;b<=103093;b++)z[b]=0;for(b=103097;b<=103099;b++)z[b]=0;for(b=103100;b<=103102;b++)z[b]=2;for(b=103107;b<=103109;b++)z[b]=0;for(b=103110;b<=103112;b++)z[b]=2;for(b=103113;b<=103116;b++)z[b]=0;for(b=103117;b<=103120;b++)z[b]=2;for(b=103153;b<=103157;b++)z[b]=0;for(b=103158;b<=103162;b++)z[b]=2;for(b=103163;b<=103165;b++)z[b]=0;for(b=103166;b<=103168;b++)z[b]=1;for(b=103169;b<=103171;b++)z[b]=2;for(b=103186;b<=103188;b++)z[b]=0;for(b=103189;b<=103191;b++)z[b]=2;for(b=103192;b<=103195;b++)z[b]=0;for(b=103196;b<=103199;b++)z[b]=2;for(b=103200;b<=103224;b++)z[b]=0;for(b=103225;b<=103227;b++)z[b]=1;for(b=103232;b<=103237;b++)z[b]=0;for(b=103238;b<=103243;b++)z[b]=2;for(b=103244;b<=103246;b++)z[b]=0;for(b=103247;b<=103249;b++)z[b]=2;for(b=103254;b<=103256;b++)z[b]=0;for(b=103257;b<=103259;b++)z[b]=2;for(b=103264;b<=103266;b++)z[b]=0;for(b=103267;b<=103269;b++)z[b]=2;for(b=103300;b<=103375;b++)z[b]=0;for(b=103381;b<=103383;b++)z[b]=0;for(b=103384;b<=103386;b++)z[b]=1;for(b=103387;b<=103389;b++)z[b]=0;for(b=103390;b<=103392;b++)z[b]=2;for(b=103397;b<=103399;b++)z[b]=0;for(b=103400;b<=103471;b++)z[b]=2;for(b=103476;b<=103478;b++)z[b]=0;for(b=103479;b<=103481;b++)z[b]=2;for(b=103486;b<=103488;b++)z[b]=0;for(b=103489;b<=103491;b++)z[b]=2;for(b=103492;b<=103495;b++)z[b]=0;for(b=103496;b<=103499;b++)z[b]=2;for(b=103528;b<=103543;b++)z[b]=0;for(b=103544;b<=103548;b++)z[b]=2;for(b=103549;b<=103551;b++)z[b]=0;for(b=103552;b<=103554;b++)z[b]=1;for(b=103555;b<=103557;b++)z[b]=2;for(b=103558;b<=103560;b++)z[b]=0;for(b=103571;b<=103573;b++)z[b]=0;for(b=103574;b<=103576;b++)z[b]=2;for(b=103577;b<=103580;b++)z[b]=0;for(b=103581;b<=103583;b++)z[b]=2;for(b=103595;b<=103694;b++)z[b]=0;for(b=103696;b<=103699;b++)z[b]=0;for(b=103700;b<=103793;b++)z[b]=2;for(b=103794;b<=103890;b++)z[b]=0;for(b=103891;b<=103896;b++)z[b]=2;for(b=103900;b<=103971;b++)z[b]=2;for(b=103972;b<=103977;b++)z[b]=0;for(b=112e3;b<=112101;b++)z[b]=0;const QRe=[102100,102113,3857,3785,900913],Dst=[104905,104971],kst=[104903],Lst=[4326,...QRe,...Dst,...kst],C5=[-20037508342788905e-9,20037508342788905e-9],lte=[-20037508342787e-6,20037508342787e-6],QY={wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:C5,origin:lte,dx:1e-5},XRe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:C5,origin:lte,dx:1e-5},102100:QY,3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:C5,origin:lte,dx:1e-5},3857:QY,4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},900913:QY,104903:{wkTemplate:'GEOGCS["GCS_Moon_2000",DATUM["D_Moon_2000",SPHEROID["Moon_2000_IAU_IAG",1737400,0,AUTHORITY["ESRI","107903"]],AUTHORITY["ESRI","106903"]],PRIMEM["Reference_Meridian",0,AUTHORITY["ESRI","108900"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["ESRI","104903"]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function zr(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||Kh(t)&&Kh(e))return!0;const a=t.latestWkid;if(a!=null&&r===a)return!0;const o=e.latestWkid;return o!=null&&i===o}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function Xl(t){const e=t?.wkid;return e!=null&&e>=2e3&&XRe[e]||null}function gq(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function A1(t){if(!jh(t))return!1;const{wkid:e}=t;if(e)return z[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function QL(t){return!(XL(t)||KL(t))}function P0(t){return t?.wkid===4326}function Qni(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function M5(t){return t?.wkid===4490}function Kh(t){const e=t?.wkid;return e!=null&&e>=2e3&&QRe.includes(e)}function E5(t){return t?.wkid===32662}function hO(t){return t===104971||t===104905}function XL(t){return hO(t?.wkid)}function dO(t){return t===104903}function KL(t){return dO(t?.wkid)}function Fst(t){const e=t?.wkid;return e!=null&&e>=2e3&&Lst.includes(e)}function jh(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const KRe={wkid:4326,wkt:Q0(XRe[4326].wkTemplate,{Central_Meridian:"0.0"})},eIe={wkid:102100,latestWkid:3857},zst={wkid:32662};function lce(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const tIe=lce(Ci),s7=lce(Xf),n7=lce(O0),iIe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Ci.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},Nst=s7.wkt.toUpperCase(),Vst=n7.wkt.toUpperCase();function xr(t){if(t!=null&&jh(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(hO(e))return Xf;const r=i?.toUpperCase();if(i&&r===Nst)return Xf;if(dO(e)||r&&r===Vst)return O0}return Ci}const rIe=Math.cos(Math.PI/16/16);function Xni(t){return hO(t)?Xf:dO(t)?O0:Ci}function A5(t){return zr(t,tIe)}function i1(t){return A5(t)||zr(t,s7)||zr(t,n7)}const cce=39.37,jst=Ci.radius*Math.PI/200,sIe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,pO=z,nIe=/UNIT\[([^\]]+)]/i,Ust=new Set([4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104025,104026,104139,104140]),Bst=so()({millimeter:"millimeters",centimeter:"centimeters",meter:"meters",meter_german:"german-meters",kilometer:"kilometers",decimeter:"decimeters",micrometer:"micrometers",nanometer:"nanometers","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",fathom:"fathoms",nautical_mile:"nautical-miles",chain_us:"us-chains",link_us:"us-links",mile_us:"us-miles",yard_clarke:"clarke-yards",chain_clarke:"clarke-chains",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",link_sears:"sears-links",yard_benoit_1895_a:"benoit-1895-a-yards",foot_benoit_1895_a:"benoit-1895-a-feet",chain_benoit_1895_a:"benoit-1895-a-chains",link_benoit_1895_a:"benoit-1895-a-links",yard_benoit_1895_b:"benoit-1895-b-yards",foot_benoit_1895_b:"benoit-1895-b-feet",chain_benoit_1895_b:"benoit-1895-b-chains",link_benoit_1895_b:"benoit-1895-b-links",foot_1865:"1865-feet",foot_indian:"indian-feet",foot_indian_1937:"indian-1937-feet",foot_indian_1962:"indian-1962-feet",foot_indian_1975:"indian-1975-feet",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",yard_indian_1962:"indian-1962-yards",yard_indian_1975:"indian-1975-yards",statute_mile:"statute-miles",foot_gold_coast:"gold-coast-feet",foot_british_1936:"british-1936-feet",yard:"yards",chain:"chains",link:"links",yard_sears_1922_truncated:"sears-1922-truncated-yards",foot_sears_1922_truncated:"sears-1922-truncated-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains",link_sears_1922_truncated:"sears-1922-truncated-links",yard_us:"us-yards",inch:"inches",inch_us:"us-inches",rod:"rods",rod_us:"us-rods",nautical_mile_us:"us-nautical-miles",nautical_mile_uk:"uk-nautical-miles",smoot:"smoots",vara_tx:"tx-vara",point:"points"}),Gp=t=>t*t,z_=t=>t*t*t,O5={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},meters:{inBaseUnits:1},feet:{inBaseUnits:.3048},"us-feet":{inBaseUnits:.3048006096012192},"clarke-feet":{inBaseUnits:.3047972654},fathoms:{inBaseUnits:1.8288},"nautical-miles":{inBaseUnits:1852},"german-meters":{inBaseUnits:1.0000135965},"us-chains":{inBaseUnits:20.11684023368047},"us-links":{inBaseUnits:.2011684023368047},"us-miles":{inBaseUnits:1609.347218694438},kilometers:{inBaseUnits:1e3},"clarke-yards":{inBaseUnits:.9143917962},"clarke-chains":{inBaseUnits:20.1166195164},"clarke-links":{inBaseUnits:.201166195164},"sears-yards":{inBaseUnits:.9143984146160287},"sears-feet":{inBaseUnits:.3047994715386762},"sears-chains":{inBaseUnits:20.11676512155263},"sears-links":{inBaseUnits:.2011676512155263},"benoit-1895-a-yards":{inBaseUnits:.9143992},"benoit-1895-a-feet":{inBaseUnits:.3047997333333333},"benoit-1895-a-chains":{inBaseUnits:20.1167824},"benoit-1895-a-links":{inBaseUnits:.201167824},"benoit-1895-b-yards":{inBaseUnits:.9143992042898124},"benoit-1895-b-feet":{inBaseUnits:.3047997347632708},"benoit-1895-b-chains":{inBaseUnits:20.11678249437587},"benoit-1895-b-links":{inBaseUnits:.2011678249437587},"1865-feet":{inBaseUnits:.3048008333333334},"indian-feet":{inBaseUnits:.3047995102481469},"indian-1937-feet":{inBaseUnits:.30479841},"indian-1962-feet":{inBaseUnits:.3047996},"indian-1975-feet":{inBaseUnits:.3047995},"indian-yards":{inBaseUnits:.9143985307444408},"indian-1937-yards":{inBaseUnits:.91439523},"indian-1962-yards":{inBaseUnits:.9143988},"indian-1975-yards":{inBaseUnits:.9143985},miles:{inBaseUnits:1609.344},"statute-miles":{inBaseUnits:1609.344},"gold-coast-feet":{inBaseUnits:.3047997101815088},"british-1936-feet":{inBaseUnits:.3048007491},yards:{inBaseUnits:.9144},chains:{inBaseUnits:20.1168},links:{inBaseUnits:.201168},"sears-1922-truncated-yards":{inBaseUnits:.914398},"sears-1922-truncated-feet":{inBaseUnits:.3047993333333334},"sears-1922-truncated-chains":{inBaseUnits:20.116756},"sears-1922-truncated-links":{inBaseUnits:.20116756},"us-yards":{inBaseUnits:.9144018288036576},decimeters:{inBaseUnits:.1},inches:{inBaseUnits:.0254},"us-inches":{inBaseUnits:.0254000508001016},rods:{inBaseUnits:5.0292},"us-rods":{inBaseUnits:5.029210058420118},"us-nautical-miles":{inBaseUnits:1853.248},"uk-nautical-miles":{inBaseUnits:1853.184},smoots:{inBaseUnits:1.7018},"tx-vara":{inBaseUnits:.8466683600033867},points:{inBaseUnits:.0003527777777777778},micrometers:{inBaseUnits:1e-6},nanometers:{inBaseUnits:1e-9},"50-kilometers":{inBaseUnits:5e4},"150-kilometers":{inBaseUnits:15e4}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Gp(.001)},"square-centimeters":{inBaseUnits:Gp(.01)},"square-decimeters":{inBaseUnits:Gp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Gp(1e3)},"square-inches":{inBaseUnits:Gp(.0254)},"square-feet":{inBaseUnits:Gp(.3048)},"square-yards":{inBaseUnits:Gp(.9144)},"square-miles":{inBaseUnits:Gp(1609.344)},"square-nautical-miles":{inBaseUnits:Gp(1852)},"square-us-feet":{inBaseUnits:Gp(1200/3937)},acres:{inBaseUnits:.0015625*Gp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*z_(.001)},"cubic-centimeters":{inBaseUnits:1e3*z_(.01)},"cubic-decimeters":{inBaseUnits:1e3*z_(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*z_(1e3)},"cubic-inches":{inBaseUnits:1e3*z_(.0254)},"cubic-feet":{inBaseUnits:1e3*z_(.3048)},"cubic-yards":{inBaseUnits:1e3*z_(.9144)},"cubic-miles":{inBaseUnits:1e3*z_(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},qst=(()=>{const t={};for(const e in O5)for(const i in O5[e].units)t[i]=e;return t})();function Gst(t,e,i){return t*O5[i].units[e].inBaseUnits}function Hst(t,e,i){return t/O5[i].units[e].inBaseUnits}const Wst=["inches","feet","yards","miles","nautical-miles","us-feet","millimeters","centimeters","decimeters","meters","kilometers"],Zst=["metric","imperial"],P5=[...Zst,...Wst],Yst=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function Jst(t){return t==="imperial"||t==="metric"}function r1(t){const e=qst[t];if(!e)throw new Error("unknown type");return e}function Q_e(t,e=null){return e=e||r1(t),O5[e].baseUnit===t}function yi(t,e,i){if(e===i)return t;const r=r1(e);if(r!==r1(i))throw new Error("incompatible units");const s=Q_e(e,r)?t:Gst(t,e,r);return Q_e(i,r)?s:Hst(s,i,r)}function Kni(t,e,i,r=!1){if(!r&&A1(e))throw new Error("Unable to convert from an angular unit to a linear unit.");const s=v$(e);return s!==i&&(t=s?yi(t,s,i):yi(t*=Yr(e),"meters",i)),t}function eai(t,e,i,r=!1){if(!r&&A1(i))throw new Error("Unable to convert from a linear unit to an angular unit.");const s=v$(i);return e!==s&&(t=s?yi(t,e,s):yi(t,e,"meters")/Yr(i)),t}function Qst(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function tai(t){return Qst(t)}function iai(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function Xst(t,e,i){switch(i){case"metric":return uce(t,e);case"imperial":return dce(t,e);default:return i}}function Kst(t,e,i){switch(i){case"metric":return hce(t,e);case"imperial":return pce(t,e);default:return i}}function uce(t,e){const i=yi(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function hce(t,e){const i=yi(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function dce(t,e){const i=yi(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function pce(t,e){const i=yi(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function aIe(t,e){const i=yi(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function oIe(t,e){const i=yi(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function rai(t,e,i){switch(i){case"metric":return aIe(t,e);case"imperial":return oIe(t,e);default:return i}}function lIe(t,e){const i=yi(t,e,"cubic-meters");return Math.abs(i)<3e8?"cubic-meters":"cubic-kilometers"}function cIe(t,e){const i=yi(t,e,"cubic-feet");return Math.abs(i)<1e8?"cubic-feet":"cubic-miles"}function sai(t,e,i){switch(i){case"metric":return lIe(t,e);case"imperial":return cIe(t,e);default:return i}}function ent(t,e,i){return yi(t,e,"meters")/(i*Math.PI/180)}function fce(t){return Bst.fromJSON(t.toLowerCase())||null}function ed(t){if(t!=null&&!QL(t))return 1;const e=Yr(t);return e>1e5?1:e}function uIe(t){return Yr(t)>=xr(t).metersPerDegree?"meters":v$(t)}function Yr(t,e=Ci.metersPerDegree){return tnt(t,!0)??e}function tnt(t,e=!1){const i=t?.wkid??null,r=t?.wkt2??t?.wkt??null;let s=null;if(i){if(hO(i))return Xf.metersPerDegree;if(dO(i))return O0.metersPerDegree;s=pO.values[pO[i]],!s&&e&&Ust.has(i)&&(s=jst)}else r&&(mIe(r)?s=K_e(sIe.exec(r),s):fIe(r)&&(s=K_e(nIe.exec(r),s)));return s}function X_e(t){return A1(t)?1:Yr(t)}function K_e(t,e){return t?.[1]?hIe(t[1]):e}function hIe(t){return parseFloat(t.split(",")[1])}function v$(t){const e=t?.wkid??null,i=t?.wkt2??t?.wkt??null;let r=null;if(e)r=pO.units[pO[e]];else if(i){const s=mIe(i)?sIe:fIe(i)?nIe:null;if(s){const n=s.exec(i);n?.[1]&&(r=snt(n[1]))}}return r!=null?fce(r):null}function dIe(t){const e=v$(t);return e!=null&&P5.includes(e)?e:null}function pIe(t){const e=uIe(t);return e!=null&&P5.includes(e)?e:null}function int(t){const e=v$(t);return e==null?null:Yst.get(e)}function fIe(t){return/^GEOCCS/i.test(t)}function mIe(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const rnt=1e-7;function snt(t){let i=/[\\"']([^\\"']+)/.exec(t)?.[1];if(!i||!fce(i)){const r=hIe(t);i=null;const s=pO.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<rnt){i=pO.units[n];break}}return i}function nnt(t){const e=v$(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"fathoms":case"nautical-miles":case"us-chains":case"us-links":case"us-miles":case"clarke-yards":case"clarke-chains":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"sears-links":case"benoit-1895-a-yards":case"benoit-1895-a-feet":case"benoit-1895-a-chains":case"benoit-1895-a-links":case"benoit-1895-b-yards":case"benoit-1895-b-feet":case"benoit-1895-b-chains":case"benoit-1895-b-links":case"1865-feet":case"indian-feet":case"indian-1937-feet":case"indian-1962-feet":case"indian-1975-feet":case"indian-yards":case"indian-1937-yards":case"indian-1962-yards":case"indian-1975-yards":case"statute-miles":case"gold-coast-feet":case"british-1936-feet":case"yards":case"chains":case"links":case"sears-1922-truncated-yards":case"sears-1922-truncated-feet":case"sears-1922-truncated-chains":case"sears-1922-truncated-links":case"us-yards":case"inches":case"us-inches":case"rods":case"us-rods":case"us-nautical-miles":case"uk-nautical-miles":case"smoots":case"tx-vara":case"points":return"imperial";case"millimeters":case"centimeters":case"meters":case"german-meters":case"kilometers":case"decimeters":case"micrometers":case"nanometers":case"50-kilometers":case"150-kilometers":return"metric"}return null}const ant={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},ont={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},lnt={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},cnt=so()(ant),unt=so()(ont),nai=so()(lnt);var qm,Pg;let Me=(Pg=class extends ae{static fromJSON(e){if(!e)return null;if(e?.wkid===102100)return qm.WebMercator;if(e?.wkid===4326)return qm.WGS84;const i=new qm;return i.read(e),i}constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return P0(this)}get isWebMercator(){return Kh(this)}get isGeographic(){return A1(this)}get isWrappable(){return Fst(this)}get metersPerUnit(){return Yr(this)}get unit(){return v$(this)||(this.isGeographic?"degrees":null)}writeWkt(e,i){this.wkid||(i.wkt=e)}clone(){if(this===qm.WGS84)return new qm(KRe);if(this===qm.WebMercator)return new qm(eIe);const e=new qm;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(e.wkt=this.wkt),this.wkt2!=null&&(e.wkt2=this.wkt2)),this.imageCoordinateSystem&&(e.imageCoordinateSystem=se(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:i,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:s}=e.imageCoordinateSystem,n=this.imageCoordinateSystem;return i==null||s?JSON.stringify(n)===JSON.stringify(e.imageCoordinateSystem):r?n.id===i&&n.referenceServiceName===r:n.id===i}return zr(this,e)}toJSON(e){return this.write(void 0,e)}},qm=Pg,Pg.GCS_NAD_1927=null,Pg.WGS84=null,Pg.WebMercator=null,Pg.PlateCarree=null,Pg);c([p({readOnly:!0})],Me.prototype,"isWGS84",null),c([p({readOnly:!0})],Me.prototype,"isWebMercator",null),c([p({readOnly:!0})],Me.prototype,"isGeographic",null),c([p({readOnly:!0})],Me.prototype,"isWrappable",null),c([p({type:vi,json:{write:!0}})],Me.prototype,"latestWkid",void 0),c([p({readOnly:!0})],Me.prototype,"metersPerUnit",null),c([p({readOnly:!0})],Me.prototype,"unit",null),c([p({type:vi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Me.prototype,"wkid",void 0),c([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Me.prototype,"wkt",void 0),c([Ie("wkt"),Ie("web-scene","wkt")],Me.prototype,"writeWkt",null),c([p({type:String,json:{write:!1}})],Me.prototype,"wkt2",void 0),c([p({type:vi,json:{write:!0}})],Me.prototype,"vcsWkid",void 0),c([p({type:vi,json:{write:!0}})],Me.prototype,"latestVcsWkid",void 0),c([p()],Me.prototype,"imageCoordinateSystem",void 0),Me=qm=c([R("esri.geometry.SpatialReference")],Me),Me.prototype.toJSON.isDefaultToJSON=!0,Me.GCS_NAD_1927=be.freeze(new Me({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'})),Me.WGS84=be.freeze(new Me(KRe)),Me.WebMercator=be.freeze(new Me(eIe)),Me.PlateCarree=be.freeze(new Me(zst));let Qa=class extends ae{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Me.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Me)return e;if(e!=null){const r=new Me;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};c([p()],Qa.prototype,"type",void 0),c([p({readOnly:!0})],Qa.prototype,"cache",null),c([p({readOnly:!0})],Qa.prototype,"extent",null),c([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qa.prototype,"hasM",void 0),c([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qa.prototype,"hasZ",void 0),c([p({type:Me,json:{write:!0},value:Me.WGS84})],Qa.prototype,"spatialReference",void 0),c([Oe("spatialReference")],Qa.prototype,"readSpatialReference",null),Qa=c([R("esri.geometry.Geometry")],Qa);function fO(t){if(t&&typeof t=="object"&&"type"in t&&t.type==="mesh")throw new q("internal:mesh","Mesh geometries are not supported for this operation")}function hnt(t){t.forEach(fO)}const dnt=57.29577951308232,pnt=.017453292519943;function ebe(t){return t*dnt}function tbe(t){return t*pnt}function ibe(t){return t/Ci.radius}function cte(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Ci.radius))}function ute(t){return t.wkid!=null||t.wkt!=null}const XY=[0,0];function yq(t,e,i,r,s){const n=t,a=s;if(a.spatialReference=i,"x"in n&&"x"in a)[a.x,a.y]=e(n.x,n.y,XY,r);else if("xmin"in n&&"xmin"in a)[a.xmin,a.ymin]=e(n.xmin,n.ymin,XY,r),[a.xmax,a.ymax]=e(n.xmax,n.ymax,XY,r);else if("paths"in n&&"paths"in a||"rings"in n&&"rings"in a){const o="paths"in n?n.paths:n.rings,l=[];let u;for(let d=0;d<o.length;d++){const f=o[d];u=[],l.push(u);for(let g=0;g<f.length;g++)u.push(e(f[g][0],f[g][1],[0,0],r)),f[g].length>2&&u[g].push(f[g][2]),f[g].length>3&&u[g].push(f[g][3])}"paths"in a?a.paths=l:a.rings=l}else if("points"in n&&"points"in a){const o=n.points,l=[];for(let u=0;u<o.length;u++)l[u]=e(o[u][0],o[u][1],[0,0],r),o[u].length>2&&l[u].push(o[u][2]),o[u].length>3&&l[u].push(o[u][3]);a.points=l}return s}function q6(t,e){const i=t&&(ute(t)?t:t.spatialReference),r=e&&(ute(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!zr(r,i)||Kh(r)&&P0(i)||Kh(i)&&P0(r))}function eF(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(ute(e)?e:e.spatialReference);return q6(i,r)?zr(i,r)?se(t):Kh(r)?yq(t,sE,Me.WebMercator,!1,se(t)):P0(r)?yq(t,a7,Me.WGS84,!1,se(t)):null:null}function sE(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=tbe(e);return i[0]=tbe(t)*Ci.radius,i[1]=Ci.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function a7(t,e,i=[0,0],r=!1){if(t===C5[0])i[0]=-180;else if(t===C5[1])i[0]=180;else{const s=ebe(t/Ci.radius);i[0]=r?s:s-360*Math.floor((s+180)/360)}return i[1]=ebe(Math.PI/2-2*Math.atan(Math.exp(-e/Ci.radius))),i}function _0(t,e=!1,i=se(t)){return fO(t),fO(i),yq(t,sE,Me.WebMercator,e,i)}function iS(t,e=!1,i=se(t)){return fO(t),fO(i),yq(t,a7,Me.WGS84,e,i)}function gIe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function fnt(t){return yIe(t,vIe)?.[0]??null}function mnt(t){return yIe(t,vIe)?.[1]??null}function yIe({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(Kh(i))return a7(t,e,r);if(A1(i))return r[0]=t,r[1]=e,r}return null}const vIe=[0,0];var G6;const KY=[0,0];function rbe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Ue=G6=class extends Qa{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",be.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Me(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)re.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)re.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s?.isWebMercator){const o=sE(n.longitude,n.latitude,KY);t=o[0],e=o[1]}}}else rbe(i)?(s=i,i=null):rbe(r)&&(s=r,r=null);const a={x:t,y:e};return a.x==null&&a.y!=null?re.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):a.y==null&&a.x!=null&&re.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(a.spatialReference=s),i!=null&&(a.z=i),r!=null&&(a.m=r),a}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return mnt(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",sE(i,t,KY)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return fnt(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",sE(t,e,KY)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new G6;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return G6.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:a,m:o}=t;let{x:l,y:u,spatialReference:d}=t;if(!n.equals(d))if(n.isWebMercator&&d.isWGS84)[l,u]=sE(l,u),d=n;else{if(!n.isWGS84||!d.isWebMercator)return!1;[l,u]=a7(l,u),d=n}return e===l&&i===u&&r===a&&s===o&&n.wkid===d.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Xl(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return gIe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};c([p({readOnly:!0})],Ue.prototype,"cache",null),c([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ue.prototype,"hasM",null),c([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ue.prototype,"hasZ",null),c([p({type:Number})],Ue.prototype,"latitude",null),c([p({type:Number})],Ue.prototype,"longitude",null),c([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),wi(t=>isNaN(t)?t:Fc(t))],Ue.prototype,"x",void 0),c([Ie("x")],Ue.prototype,"writeX",null),c([Oe("x")],Ue.prototype,"readX",null),c([p({type:Number,json:{write:!0}})],Ue.prototype,"y",void 0),c([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ue.prototype,"z",void 0),c([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ue.prototype,"m",void 0),Ue=G6=c([R("esri.geometry.Point")],Ue),Ue.prototype.toJSON.isDefaultToJSON=!0;let Gm=class extends nt(ae){constructor(...e){super(...e),this.position=new Ue([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new iRe}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=Fc(e.x||0),n.y=Fc(e.y||0),n.z=e.hasZ?Fc(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new Ue;return r.read(e,i),r.x=Fc(r.x||0),r.y=Fc(r.y||0),r.z=r.hasZ?Fc(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};c([p({type:Ue,json:{write:{isRequired:!0}}})],Gm.prototype,"position",void 0),c([Ie("position")],Gm.prototype,"writePosition",null),c([Oe("position")],Gm.prototype,"readPosition",null),c([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),wi(t=>JL.normalize(Fc(t)))],Gm.prototype,"heading",void 0),c([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),wi(t=>Ce(Fc(t),-180,180))],Gm.prototype,"tilt",void 0),c([p({type:Number,nonNullable:!0,json:{default:55,write:!0}}),wi(t=>Ce(Fc(t,55),1,170))],Gm.prototype,"fov",void 0),c([p({type:iRe,nonNullable:!0,json:{read:!1,write:!1}})],Gm.prototype,"layout",void 0),Gm=c([R("esri.Camera")],Gm);const tc=Gm,eJ=[0,0];function tF(t,e){return e!=null&&hl(t,e.x,e.y,e.z)}function lai(t,e){if(!e.points?.length)return!1;for(const i of e.points)if(!mO(t,i))return!1;return!0}function gnt(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:a,zmax:o}=e;return t.hasZ&&e.hasZ?hl(t,i,r,s)&&hl(t,i,a,s)&&hl(t,n,a,s)&&hl(t,n,r,s)&&hl(t,i,r,o)&&hl(t,i,a,o)&&hl(t,n,a,o)&&hl(t,n,r,o):hl(t,i,r)&&hl(t,i,a)&&hl(t,n,a)&&hl(t,n,r)}function mO(t,e){return hl(t,e[0],e[1])}function ynt(t,e){return hl(t,e[0],e[1],e[2])}function hl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function mce(t,e){return eJ[1]=e.y,eJ[0]=e.x,vnt(t,eJ)}function vnt(t,e){return gce(t.rings,e)}function gce(t,e){if(!t||t.length<1)return!1;if(_nt(t))return sbe(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=sbe(i,t[r],e);return i}function _nt(t){return!Array.isArray(t[0][0])}function sbe(t,e,i){const[r,s]=i;let n=t,a=0;for(let o=0,l=e.length;o<l;o++){a++,a===l&&(a=0);const[u,d]=e[o],[f,g]=e[a];(d<s&&g>=s||g<s&&d>=s)&&u+(s-d)/(g-d)*(f-u)<r&&(n=!n)}return n}function bnt(t,e){return tF(t,e)}function wnt(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function xnt(t,e){const{points:i,hasZ:r}=e,s=r?ynt:mO;for(const n of i)if(s(t,n))return!0;return!1}const YT=[0,0],JT=[0,0],QT=[0,0],XT=[0,0],Snt=[YT,JT,QT,XT],_Ie=[[QT,YT],[YT,JT],[JT,XT],[XT,QT]];function Tnt(t,e){return $nt(t,e.rings)}function $nt(t,e){YT[0]=t.xmin,YT[1]=t.ymax,JT[0]=t.xmax,JT[1]=t.ymax,QT[0]=t.xmin,QT[1]=t.ymin,XT[0]=t.xmax,XT[1]=t.ymin;for(const i of Snt)if(gce(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(mO(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(mO(t,n)||bIe(r,n,_Ie))return!0;r=n}}return!1}function Cnt(t,e){YT[0]=t.xmin,YT[1]=t.ymax,JT[0]=t.xmax,JT[1]=t.ymax,QT[0]=t.xmin,QT[1]=t.ymin,XT[0]=t.xmax,XT[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(mO(t,s))return!0;for(let n=1;n<r.length;n++){const a=r[n];if(mO(t,a)||bIe(s,a,_Ie))return!0;s=a}}return!1}const Ro=[0,0];function Mnt(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],a=i[s+1];for(let o=e+1;o<t.length;o++)for(let l=0;l<t[o].length-1;l++){const u=t[o][l],d=t[o][l+1];if(hte(n,a,u,d,Ro)&&!(Ro[0]===n[0]&&Ro[1]===n[1]||Ro[0]===u[0]&&Ro[1]===u[1]||Ro[0]===a[0]&&Ro[1]===a[1]||Ro[0]===d[0]&&Ro[1]===d[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const a=i[s],o=i[s+1];for(let l=s+2;l<n;l++){const u=i[l],d=i[l+1];if(hte(a,o,u,d,Ro)&&!(Ro[0]===a[0]&&Ro[1]===a[1]||Ro[0]===u[0]&&Ro[1]===u[1]||Ro[0]===o[0]&&Ro[1]===o[1]||Ro[0]===d[0]&&Ro[1]===d[1]))return!0}}}return!1}function bIe(t,e,i){for(let r=0;r<i.length;r++)if(hte(t,e,i[r][0],i[r][1]))return!0;return!1}function hte(t,e,i,r,s){const[n,a]=t,[o,l]=e,[u,d]=i,[f,g]=r,v=f-u,_=n-u,x=o-n,S=g-d,T=a-d,M=l-a,E=S*x-v*M;if(E===0)return!1;const P=(v*T-S*_)/E,O=(x*T-M*_)/E;return P>=0&&P<=1&&O>=0&&O<=1&&(s&&(s[0]=n+P*(o-n),s[1]=a+P*(l-a)),!0)}function Ent(t){switch(t){case"esriGeometryEnvelope":case"extent":return wnt;case"esriGeometryMultipoint":case"multipoint":return xnt;case"esriGeometryPoint":case"point":return bnt;case"esriGeometryMultiPatch":case"multipatch":case"esriGeometryPolygon":case"polygon":return Tnt;case"esriGeometryPolyline":case"polyline":return Cnt}}var af;function Ant(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function N_(t,e,i){return e==null?i:i==null?e:t(e,i)}let It=af=class extends Qa{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return Ant(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Me.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??Me.WGS84}}static fromPoint(t){return new af({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Ue({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new af;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&q6(e,i)&&(t=e.isWebMercator?_0(t):iS(t,!0)),t.type==="point"?tF(this,t):t.type==="extent"&&gnt(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&q6(e,i)&&(t=e.isWebMercator?_0(t):iS(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!zr(e,i)&&q6(e,i)&&(t=e.isWebMercator?_0(t):iS(t,!0)),Ent(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=N_(Math.min,this.zmin,t.zmin),this.zmax=N_(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=N_(Math.min,this.mmin,t.mmin),this.mmax=N_(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=N_(Math.max,this.zmin,t.zmin),this.zmax=N_(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=N_(Math.max,this.mmin,t.mmin),this.mmax=N_(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Xl(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?iS(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=tJ(r.x,t).x),this.spatialReference=new Me(Q0((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??Xl(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let a=!0,o=!0;return n.forEach(l=>{l.hasZ||(a=!1),l.hasM||(o=!1)}),{rings:n.map(l=>{const u=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(a){const d=(l.zmax-l.zmin)/2;for(let f=0;f<u.length;f++)u[f].push(d)}if(o){const d=(l.mmax-l.mmin)/2;for(let f=0;f<u.length;f++)u[f].push(d)}return u}),hasZ:a,hasM:o,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:a}=this,o=this.width,l=this.xmin,u=this.xmax;let d;t=t||Xl(a);const[f,g]=t.valid;d=tJ(this.xmin,t);const v=d.x,_=d.frameId;d=tJ(this.xmax,t);const x=d.x,S=d.frameId,T=v===x&&o>0;if(o>2*g){const M=new af(l<u?v:x,s,g,n,a),E=new af(f,s,l<u?x:v,n,a),P=new af(0,s,g,n,a),O=new af(f,s,0,n,a),D=[],L=[];M.contains(P)&&D.push(_),M.contains(O)&&L.push(_),E.contains(P)&&D.push(S),E.contains(O)&&L.push(S);for(let F=_+1;F<S;F++)D.push(F),L.push(F);e.push({extent:M,frameIds:[_]},{extent:E,frameIds:[S]},{extent:P,frameIds:D},{extent:O,frameIds:L})}else v>x||T?e.push({extent:new af(v,s,g,n,a),frameIds:[_]},{extent:new af(f,s,x,n,a),frameIds:[S]}):e.push({extent:new af(v,s,x,n,a),frameIds:[_]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function tJ(t,e){const[i,r]=e.valid,s=2*r;let n,a=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,a=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,a=-n),{x:t,frameId:a}}c([p({readOnly:!0})],It.prototype,"cache",null),c([p({readOnly:!0})],It.prototype,"center",null),c([p({readOnly:!0})],It.prototype,"extent",null),c([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],It.prototype,"hasM",null),c([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],It.prototype,"hasZ",null),c([p({readOnly:!0})],It.prototype,"height",null),c([p({readOnly:!0})],It.prototype,"width",null),c([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],It.prototype,"xmin",void 0),c([p({type:Number,json:{write:!0}})],It.prototype,"ymin",void 0),c([p({type:Number,json:{origins:{"web-scene":{write:!1}},read:t=>t??void 0,write:{overridePolicy(){return{enabled:this.hasM}}}}})],It.prototype,"mmin",void 0),c([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],It.prototype,"zmin",void 0),c([p({type:Number,json:{write:!0}})],It.prototype,"xmax",void 0),c([p({type:Number,json:{write:!0}})],It.prototype,"ymax",void 0),c([p({type:Number,json:{origins:{"web-scene":{write:!1}},read:t=>t??void 0,write:{overridePolicy(){return{enabled:this.hasM}}}}})],It.prototype,"mmax",void 0),c([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],It.prototype,"zmax",void 0),It=af=c([R("esri.geometry.Extent")],It),It.prototype.toJSON.isDefaultToJSON=!0;function fi(t=Dnt){return[t[0],t[1],t[2],t[3]]}function cai(t){return[t[0],t[1],t[2],t[3]]}function O1(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function o7(t,e,i,r,s=fi()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function yce(t,e=fi()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function iF(t,e,i=new It){return i.xmin=t[0],i.ymin=t[1],i.xmax=t[2],i.ymax=t[3],i.spatialReference=e,i}function zh(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Ont(t,e){e<t[0]&&(t[0]=e),e>t[2]&&(t[2]=e)}function Pnt(t,e){e<t[1]&&(t[1]=e),e>t[3]&&(t[3]=e)}function VE(t,e,i){if(e!=null)if("length"in e)fte(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else O1(i,t)}function iJ(t,e,i=t){const r=e.length;let s=t[0],n=t[1],a=t[2],o=t[3];for(let l=0;l<r;l++){const u=e[l];s=Math.min(s,u[0]),n=Math.min(n,u[1]),a=Math.max(a,u[0]),o=Math.max(o,u[1])}return i[0]=s,i[1]=n,i[2]=a,i[3]=o,i}function dte(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function So(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Zl(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function uai(t){return So(t)*Zl(t)}function vq(t){return So(t)>0&&Zl(t)>0}function wIe(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function hai(t){const e=So(t),i=Zl(t);return Math.sqrt(e*e+i*i)}function Rnt(t,e){return gO(t,e[0],e[1])}function nbe(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const a=.5*(t[1]+t[3]),o=.5*(t[3]-t[1]),l=Math.abs(e[1]-a);if(l>i+o)return!1;if(s<n||l<o)return!0;const u=s-n,d=l-o;return u*u+d*d<=i*i}function dai(t,e,i){const r=t[0],s=t[1],n=t[2],a=t[3],{x:o,y:l}=e,{x:u,y:d}=i,f=(S,T)=>(d-l)*S+(o-u)*T+(u*l-o*d)<0,g=f(r,a),v=f(n,a),_=f(n,s),x=f(r,s);return!(g===v&&v===_&&_===x&&x===g||o<r&&u<r||o>n&&u>n||l>a&&d>a||l<s&&d<s)}function pai(t,e){return!!t&&gO(t,e.x,e.y)}function gO(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function vce(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function fai(t,e,i){return Math.max(e[0],t[0])-i<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])-i<=Math.min(e[3],t[3])}function rF(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function pte(t,e,i){if(e==null)return O1(i,t);const r=e[0],s=e[1],n=e[2],a=e[3];return i[0]=Ce(t[0],r,n),i[1]=Ce(t[1],s,a),i[2]=Ce(t[2],r,n),i[3]=Ce(t[3],s,a),i}function mai(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-So(t)/2,0),n=Math.max(Math.abs(e[1]-r)-Zl(t)/2,0);return Math.sqrt(s*s+n*n)}function _q(t,e,i,r){return r??=t,r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function R0(t){return t?O1(t,mte):fi(mte)}function fte(t){return t!=null&&t.length===4}function Int(t){return!(So(t)!==0&&isFinite(t[0])||Zl(t)!==0&&isFinite(t[1]))}function MS(t,e){return fte(t)&&fte(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const gai=[-1/0,-1/0,1/0,1/0],mte=[1/0,1/0,-1/0,-1/0],Dnt=[0,0,0,0];function knt(t,e,i){return e!=null&&(i?i.contains(t[0],t[2],e[0])&&i.contains(t[0],t[2],e[2])&&e[1]>t[1]&&e[3]<t[3]:rF(t,e))}function abe(t,e,i){return t!=null&&(i?(i.contains(e[0],e[2],t[0])||i.contains(e[0],e[2],t[2])||i.contains(t[0],t[2],e[0]))&&!(t[1]>e[3]||t[3]<e[1]):vce(t,e))}let _ce=1e-6;function _n(){return _ce}function Lnt(t){_ce=t}const sF=Math.random,Fnt=Math.PI/180,znt=180/Math.PI;function nF(t){return t*Fnt}function Nnt(t){return t*znt}function Vnt(t,e){return Math.abs(t-e)<=_ce*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:sF,equals:Vnt,getEpsilon:_n,setEpsilon:Lnt,toDegree:Nnt,toRadian:nF},Symbol.toStringTag,{value:"Module"}));function na(t,e){return t[0]=e[0],t[1]=e[1],t}function oi(t,e,i){return t[0]=e,t[1]=i,t}function bg(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Os(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function xIe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function SIe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function jnt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Unt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Bnt(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function qnt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function Gnt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Nh(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function em(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function nm(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function I0(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function yO(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function D0(t){const e=t[0],i=t[1];return e*e+i*i}function bce(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Hnt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function vO(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function dn(t,e){return t[0]*e[0]+t[1]*e[1]}function TIe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Ou(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function Wnt(t,e=1){const i=2*sF()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function Znt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function $g(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function H6(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function Ynt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function $Ie(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],a=Math.sin(r),o=Math.cos(r);return t[0]=s*o-n*a+i[0],t[1]=s*a+n*o+i[1],t}function Jnt(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let a=i*i+r*r;a>0&&(a=1/Math.sqrt(a));let o=s*s+n*n;o>0&&(o=1/Math.sqrt(o));const l=(i*s+r*n)*a*o;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Qnt(t){return"vec2("+t[0]+", "+t[1]+")"}function bq(t,e){return t[0]===e[0]&&t[1]===e[1]}function l7(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],a=_n();return Math.abs(i-s)<=a*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=a*Math.max(1,Math.abs(r),Math.abs(n))}function Xnt(t,e,i,r,s){let n=e[0]-i[0],a=e[1]-i[1];const o=(r[0]*n+r[1]*a)*(s-1);return n=r[0]*o,a=r[1]*o,t[0]=e[0]+n,t[1]=e[1]+a,t}const Knt=yO,c7=Os,eat=xIe,tat=SIe,iat=nm,rat=I0,sat=D0;Object.freeze(Object.defineProperty({__proto__:null,add:bg,angle:Jnt,ceil:jnt,copy:na,cross:TIe,dist:iat,distance:nm,div:tat,divide:SIe,dot:dn,equals:l7,exactEquals:bq,floor:Unt,inverse:Hnt,len:Knt,length:yO,lerp:Ou,max:qnt,min:Bnt,mul:eat,multiply:xIe,negate:bce,normalize:vO,projectAndScale:Xnt,random:Wnt,rotate:$Ie,round:Gnt,scale:Nh,scaleAndAdd:em,set:oi,sqrDist:rat,sqrLen:sat,squaredDistance:I0,squaredLength:D0,str:Qnt,sub:c7,subtract:Os,transformMat2:Znt,transformMat2d:$g,transformMat3:H6,transformMat4:Ynt},Symbol.toStringTag,{value:"Module"}));function Hv(t,e,i,r){return t[0]=e[0]*(1-r)+i[0]*r,t[1]=e[1]*(1-r)+i[1]*r,t}function Bc(t,e){return I0(t,e)}function yai(t,e,i){const r=Bc(e,i);if(r===0)return Bc(e,t);const s=(e[0]-t[0])*(i[1]-t[1])-(e[1]-t[1])*(i[0]-t[0]);return s*s/r}function nat(t,e,i,r,s){const[n,a]=e,[o,l]=i,[u,d]=r,[f,g]=s,v=(n-o)*(d-g)-(a-l)*(u-f);if(v===0)return null;const _=(n*l-a*o)*(u-f)-(n-o)*(u*g-d*f),x=(n*l-a*o)*(d-g)-(a-l)*(u*g-d*f);return t[0]=_/v,t[1]=x/v,t}const jf=2*Math.PI;function ES(t,e){const i=Math.atan2(t,e);return i<0?i+jf:i}function CIe(t){return Math.abs(t)%jf}function obe(t){const e=CIe(t);return e<Math.PI?e:jf-e}function u7(t,e){return{min:Math.min(t,e),max:Math.max(t,e)}}function MIe(t,e,i,r){if(yl(CIe(t-e),0))return i?[t,t]:[t,r?t-jf:t+jf];const[s,n]=r?[t-jf,t]:[t,t+jf];return[t,aF({min:s,max:n},e)]}function aF({min:t,max:e},i){let r;return r=e-i,r>=jf?(r-=r%jf,i+r):(r=i-t,r>=jf?(r-=r%jf,i-r):i)}function aat(t,e){const i=aF(t,e);return i>t.min&&i<t.max?i:obe(i-t.min)<obe(i-t.max)?t.min:t.max}function EIe(t,e,i,r=10){return e.map(s=>{let n=s;for(let a=0;a<r;a++){const[o,l,u,d,f,g]=i(n),v=t[0]-o,_=t[1]-l,x=-u,S=-d;n+=-(2*v*x+2*_*S)/(2*x*x+2*v*-f+2*S*S+2*_*-g||1e-6)}return n})}const oat=[0,0];function AIe(t){const e=1-t,i=e*e,r=t*t;return[i*e,3*t*i,3*r*e,r*t]}function gte(t,e,i,r,s){const[n,a,o,l]=AIe(s);return[t[0]*n+e[0]*a+i[0]*o+r[0]*l,t[1]*n+e[1]*a+i[1]*o+r[1]*l]}function lbe(t,e,i,r,s){const[n,a,o,l]=AIe(s);return t*n+e*a+i*o+r*l}function vai(t,e,i){const r=t,[s,n,a]=e.b;return gte(r,n,a,s,i)}function lat(t,e,i){const r=t,[s,n,a]=e.b,o=Hv([0,0],r,n,i),l=Hv(oat,n,a,i),u=Hv([0,0],a,s,i),d=Hv([0,0],o,l,i),f=Hv([0,0],l,u,i);return[{b:[Hv([],d,f,i),o,d]},{b:[[...s],f,u]}]}function _ai(t,e,i){const r=t,[s,n,a]=e.b,o=EIe(i,[.1,.5,.9],f=>{const g=1-f,[v,_]=gte(r,n,a,s,f);return[v,_,3*g*g*(n[0]-r[0])+6*g*f*(a[0]-n[0])+3*f*f*(s[0]-a[0]),3*g*g*(n[1]-r[1])+6*g*f*(a[1]-n[1])+3*f*f*(s[1]-a[1]),6*g*(a[0]-2*n[0]+r[0])+6*f*(s[0]-2*a[0]+n[0]),6*g*(a[1]-2*n[1]+r[1])+6*f*(s[1]-2*a[1]+n[1])]}).map(f=>Math.min(1,Math.max(0,f)));o.push(0,1);let l=1/0;const u=o.map(f=>{const g=gte(r,n,a,s,f),[v,_]=g,x=i[0]-v,S=i[1]-_,T=Math.sqrt(x*x+S*S);return l=Math.min(T,l),{t:f,curvePoint:g,distance:T}}),d=[];for(const f of u){const{t:g,distance:v}=f;jle(v,l)&&!d.some(({t:_})=>yl(_,g))&&d.push(f)}return d}function cat(t,e,i){const r=e,[s,n,a]=i.b;if(zh(t,r),zh(t,s),gO(t,n[0],n[1])&&gO(t,a[0],a[1]))return t;for(const o of cbe(r[0],n[0],a[0],s[0]))o>0&&o<1&&Ont(t,lbe(r[0],n[0],a[0],s[0],o));for(const o of cbe(r[1],n[1],a[1],s[1]))o>0&&o<1&&Pnt(t,lbe(r[1],n[1],a[1],s[1],o));return t}function cbe(t,e,i,r){const s=3*(3*(e-i)-t+r),n=6*(t-2*e+i),a=3*(e-t);if(s===0)return n!==0?[-a/n]:[];const o=Math.sqrt(n*n-4*s*a);return[(-n+o)/(2*s),(-n-o)/(2*s)]}function bai(t,e,i){let s=0,n=[e];for(let a=0;a<16;a++){let o=t;const l=[];for(const d of n)l.push(...lat(o,d,.5)),o=d.b[0];n=l,o=t,s=0;let u=0;for(const d of n){const[f,g,v]=d.b,_=Math.sqrt(Bc(o,f));s+=(_+(Math.sqrt(Bc(o,g))+Math.sqrt(Bc(g,v))+Math.sqrt(Bc(v,f))))/2,u+=_,o=f}if(s-u<i)return s}return s}function uat(t,e,i){const[r,s]=t,[n,a]=e,[o,l]=i,[u,d]=[n-r,a-s];let f=u*(o-r)+d*(l-s);f/=u**2+d**2,f=Ce(f,0,1);const g=Hv([0,0],t,e,f);return{t:f,curvePoint:g,distance:Math.sqrt(Bc(g,i))}}let OIe=class{constructor(e,i,r,s,n,a){this.cx=e,this.cy=i,this.radius=r,this.thetaStart=s,this.thetaEnd=n,this.isInvalid=a}get startPoint(){const{cx:e,cy:i,radius:r,thetaStart:s}=this;return[e+r*Math.cos(s),i+r*Math.sin(s)]}get endPoint(){const{cx:e,cy:i,radius:r,thetaEnd:s}=this;return[e+r*Math.cos(s),i+r*Math.sin(s)]}};function wq(t,e){const{cx:i,cy:r,radius:s}=t;return[i+s*Math.cos(e),r+s*Math.sin(e)]}function W6(t,e){if(t.isInvalid)return Hv([0,0],t.startPoint,t.endPoint,e);const{thetaStart:i,thetaEnd:r}=t;return wq(t,i*(1-e)+r*e)}function xai(t,e){if(t.isInvalid)return uat(t.startPoint,t.endPoint,e);const{cx:i,cy:r,thetaStart:s,thetaEnd:n}=t,[a,o]=e,l=aat(u7(s,n),Math.atan2(o-r,a-i)),u=wq(t,l);return{t:(l-s)/(n-s),curvePoint:u,distance:Math.sqrt(Bc(e,u))}}function ube(t,e){if(e.isInvalid)return zh(t,e.startPoint),zh(t,e.endPoint),t;const{cx:i,cy:r,radius:s,thetaStart:n,thetaEnd:a}=e;zh(t,wq(e,n)),zh(t,wq(e,a));const o=u7(n,a),l=Math.PI/2;let u=0;for(const d of[[i+s,r],[i,r+s],[i-s,r],[i,r-s]])u=aF(o,u),u>o.min&&u<o.max&&zh(t,d),u+=l;return t}function Sai(t){if(t.isInvalid)return 2*t.radius;const{radius:e,thetaStart:i,thetaEnd:r}=t;return e*Math.abs(r-i)}function P1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function hat(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function b0(t,e,i,r,s,n,a,o,l,u){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=a,t[6]=o,t[7]=l,t[8]=u,t}function oF(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function R1(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function _$(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],u=e[7],d=e[8],f=d*a-o*u,g=-d*n+o*l,v=u*n-a*l;let _=i*f+r*g+s*v;return _?(_=1/_,t[0]=f*_,t[1]=(-d*r+s*u)*_,t[2]=(o*r-s*a)*_,t[3]=g*_,t[4]=(d*i-s*l)*_,t[5]=(-o*i+s*n)*_,t[6]=v*_,t[7]=(-u*i+r*l)*_,t[8]=(a*i-r*n)*_,t):null}function dat(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],u=e[7],d=e[8];return t[0]=a*d-o*u,t[1]=s*u-r*d,t[2]=r*o-s*a,t[3]=o*l-n*d,t[4]=i*d-s*l,t[5]=s*n-i*o,t[6]=n*u-a*l,t[7]=r*l-i*u,t[8]=i*a-r*n,t}function Z6(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],l=t[7],u=t[8];return e*(u*n-a*l)+i*(-u*s+a*o)+r*(l*s-n*o)}function KT(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=e[6],d=e[7],f=e[8],g=i[0],v=i[1],_=i[2],x=i[3],S=i[4],T=i[5],M=i[6],E=i[7],P=i[8];return t[0]=g*r+v*a+_*u,t[1]=g*s+v*o+_*d,t[2]=g*n+v*l+_*f,t[3]=x*r+S*a+T*u,t[4]=x*s+S*o+T*d,t[5]=x*n+S*l+T*f,t[6]=M*r+E*a+P*u,t[7]=M*s+E*o+P*d,t[8]=M*n+E*l+P*f,t}function s1(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=e[6],d=e[7],f=e[8],g=i[0],v=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=a,t[4]=o,t[5]=l,t[6]=g*r+v*a+u,t[7]=g*s+v*o+d,t[8]=g*n+v*l+f,t}function lF(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=e[6],d=e[7],f=e[8],g=Math.sin(i),v=Math.cos(i);return t[0]=v*r+g*a,t[1]=v*s+g*o,t[2]=v*n+g*l,t[3]=v*a-g*r,t[4]=v*o-g*s,t[5]=v*l-g*n,t[6]=u,t[7]=d,t[8]=f,t}function cF(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function pat(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function fat(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function mat(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function gat(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function yat(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function R5(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=i+i,o=r+r,l=s+s,u=i*a,d=r*a,f=r*o,g=s*a,v=s*o,_=s*l,x=n*a,S=n*o,T=n*l;return t[0]=1-f-_,t[3]=d-T,t[6]=g+S,t[1]=d+T,t[4]=1-u-_,t[7]=v-x,t[2]=g-S,t[5]=v+x,t[8]=1-u-f,t}function PIe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],a=e[5],o=e[6],l=e[8],u=e[9],d=e[10],f=d*a-o*u,g=-d*n+o*l,v=u*n-a*l,_=i*f+r*g+s*v;if(!_)return null;const x=1/_;return t[0]=f*x,t[1]=(-d*r+s*u)*x,t[2]=(o*r-s*a)*x,t[3]=g*x,t[4]=(d*i-s*l)*x,t[5]=(-o*i+s*n)*x,t[6]=v*x,t[7]=(-u*i+r*l)*x,t[8]=(a*i-r*n)*x,t}function RIe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],u=e[7],d=e[8],f=e[9],g=e[10],v=e[11],_=e[12],x=e[13],S=e[14],T=e[15],M=i*o-r*a,E=i*l-s*a,P=i*u-n*a,O=r*l-s*o,D=r*u-n*o,L=s*u-n*l,F=d*x-f*_,j=d*S-g*_,N=d*T-v*_,B=f*S-g*x,U=f*T-v*x,Q=g*T-v*S;let H=M*Q-E*U+P*B+O*N-D*j+L*F;return H?(H=1/H,t[0]=(o*Q-l*U+u*B)*H,t[1]=(l*N-a*Q-u*j)*H,t[2]=(a*U-o*N+u*F)*H,t[3]=(s*U-r*Q-n*B)*H,t[4]=(i*Q-s*N+n*j)*H,t[5]=(r*N-i*U-n*F)*H,t[6]=(x*L-S*D+T*O)*H,t[7]=(S*P-_*L-T*E)*H,t[8]=(_*D-x*P+T*M)*H,t):null}function vat(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function _at(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function bat(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function wat(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function IIe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function xat(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function Sat(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function Tat(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function $at(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],u=t[7],d=t[8],f=e[0],g=e[1],v=e[2],_=e[3],x=e[4],S=e[5],T=e[6],M=e[7],E=e[8],P=_n();return Math.abs(i-f)<=P*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(r-g)<=P*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(s-v)<=P*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(n-_)<=P*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-x)<=P*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-S)<=P*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(l-T)<=P*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(u-M)<=P*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(d-E)<=P*Math.max(1,Math.abs(d),Math.abs(E))}function Cat(t){const e=_n(),i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],u=t[7],d=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+a*a+u*u))<=e&&Math.abs(1-(s*s+o*o+d*d))<=e}const Mat=KT,Eat=IIe;Object.freeze(Object.defineProperty({__proto__:null,add:wat,adjoint:dat,copy:hat,determinant:Z6,equals:$at,exactEquals:Tat,frob:bat,fromMat2d:yat,fromMat4:P1,fromQuat:R5,fromRotation:mat,fromScaling:gat,fromTranslation:fat,identity:oF,invert:_$,isOrthoNormal:Cat,mul:Mat,multiply:KT,multiplyScalar:xat,multiplyScalarAndAdd:Sat,normalFromMat4:RIe,normalFromMat4Legacy:PIe,projection:vat,rotate:lF,scale:cF,scaleByVec2:pat,set:b0,str:_at,sub:Eat,subtract:IIe,translate:s1,transpose:R1},Symbol.toStringTag,{value:"Module"}));function Jr(){return[1,0,0,0,1,0,0,0,1]}function DIe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function kIe(t,e,i,r,s,n,a,o,l){return[t,e,i,r,s,n,a,o,l]}const b$=Jr();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:b$,clone:DIe,create:Jr,fromValues:kIe},Symbol.toStringTag,{value:"Module"}));const bC=Jr();function Aat(t,e,i){const[r,s]=t,[n,a]=e,[o,l]=i;b0(bC,r,n,o,s,a,l,1,1,1);const u=Z6(bC),d=4*u/(Bc(t,e)+Bc(e,i)+Bc(i,t));if(!isFinite(d)||Math.abs(d)<1e-8)return null;const f=r**2+s**2,g=n**2+a**2,v=o**2+l**2;b0(bC,f,g,v,s,a,l,1,1,1);const _=Z6(bC);return b0(bC,f,g,v,r,n,o,1,1,1),[_/u*.5,Z6(bC)/u*-.5]}function LIe(t,e){const[i,r]=e.c,s=Aat(t,r,i),n=s==null,a=s??Hv([],t,i,.5),[o,l]=t,[u,d]=r,[f,g]=i,[v,_]=a,x=o-v,S=l-_,T=Math.sqrt(x*x+S*S),M=ES(l-_,o-v),E=ES(d-_,u-v);let P=ES(g-_,f-v);return(E-M)*(P-E)<0&&(P+=2*Math.sign(M-P)*Math.PI),new OIe(v,_,T,M,P,n)}function Tai(t,e,i){const r=W6(t,i/2),s=W6(t,i),n=W6(t,(i+1)/2);return[{c:[s,r]},{c:[[...e.c[0]],n]}]}function $ai(t,e){const[i]=e.c,{cx:r,cy:s,thetaStart:n,thetaEnd:a,radius:o,isInvalid:l}=LIe(t,e);return{a:[i,[r,s],Math.abs(a-n)<Math.PI?1:0,n>a?1:0,l?n:0,o,l?0:1]}}function Cai(t){return"curveRings"in t&&!!t.curveRings?.length||"curvePaths"in t&&!!t.curvePaths?.length}function Mai(t){return"curveRings"in t?t.curveRings:t.curvePaths}function wce(t){return"b"in t}function xce(t){return"c"in t}function h7(t){return Array.isArray(t)}function Eai(t){return"a"in t}function FIe(t){return"a"in t&&t.a.length===4}function Oat(t){return"a"in t&&t.a.length===7}function rJ(t){return h7(t)?t:wce(t)?t.b[0]:xce(t)?t.c[0]:t.a[0]}function Pat(t){if(wce(t)){const[e,i,r]=t.b;return{b:[[...e],[...i],[...r]]}}if(xce(t)){const[e,i]=t.c;return{c:[[...e],[...i]]}}if(h7(t))return[...t];if(FIe(t)){const[e,i,r,s]=t.a;return{a:[[...e],[...i],r,s]}}if(Oat(t)){const[e,i,r,s,n,a,o]=t.a;return{a:[[...e],[...i],r,s,n,a,o]}}return t}function Rat(t,e){const[i,r,s,n]=e.a,[a,o]=t,[l,u]=i,[d,f]=r,g=a-d,v=o-f,_=Math.sqrt(g*g+v*v),x=l-d,S=u-f,T=Math.sqrt(x*x+S*S),M=_===0||T===0||!jle(_,T),E=_,[P,O]=MIe(ES(o-f,a-d),Math.atan2(u-f,l-d),s,n);return new OIe(d,f,E,P,O,M)}function Aai(t,e,i){const{cx:r,cy:s,thetaStart:n,thetaEnd:a}=t,[o,l,u,d]=e.a,f=n*(1-i)+a*i;return[{a:[W6(t,i),[r,s],Math.abs(f-n)<Math.PI?1:0,d]},{a:[[...o],[r,s],Math.abs(a-f)<Math.PI?1:0,d]}]}let Iat=class{constructor(e,i,r,s,n,a,o,l,u){this.cx=e,this.cy=i,this.a=r,this.b=s,this.cosR=n,this.sinR=a,this.u1=o,this.u2=l,this.isInvalid=u}};function Sce(t,e){const[i,r,s,n,a,o,l]=e.a,[u,d]=t,[f,g]=i,[v,_]=r,x=o*l,S=Math.cos(a),T=Math.sin(a),[M,E]=MIe(ES(1/x*(d-_)*S-1/x*(u-v)*T,1/o*(d-_)*T+1/o*(u-v)*S),Math.atan2(1/x*(g-_)*S-1/x*(f-v)*T,1/o*(g-_)*T+1/o*(f-v)*S),s,n);return new Iat(v,_,o,x,S,T,M,E,o===0||x===0)}function I5(t,e){const{a:i,b:r,cosR:s,sinR:n,cx:a,cy:o}=t,l=Math.cos(e),u=Math.sin(e);return[i*l*s-r*u*n+a,i*l*n+r*u*s+o]}function AM(t,e){const{u1:i,u2:r}=t;return I5(t,i*(1-e)+r*e)}function Pai(t,e,i){if(i<0||i>1)return[];if(i===0||i===1)return[Pat(e)];const[r,[s,n],a,o,l,u,d]=e.a,{u1:f,u2:g}=t,v=f*(1-i)+g*i;return[{a:[[...AM(t,i)],[s,n],Math.abs(v-f)<Math.PI?1:0,o,l,u,d]},{a:[[...r],[s,n],Math.abs(g-v)<Math.PI?1:0,o,l,u,d]}]}function Rai(t,e){const{a:i,b:r,cosR:s,sinR:n,u1:a,u2:o}=t,l=Math.PI/6,u=EIe(e,[1*l,2*l,4*l,5*l,7*l,8*l,10*l,11*l],x=>{const S=Math.cos(x),T=Math.sin(x),[M,E]=I5(t,x);return[M,E,-i*s*T-r*n*S,-i*n*T+r*s*S,-i*s*S+r*n*T,-i*n*S-r*s*T]}),d=u7(a,o),f=new Set(u.map(x=>aF(d,x)).filter(x=>x>d.min&&x<d.max));f.add(a),f.add(o);let g,v,_=1/0;for(const x of f){const S=I5(t,x),[T,M]=S,E=e[0]-T,P=e[1]-M,O=E*E+P*P;O<_&&(g=(x-a)/(o-a),v=S,_=O)}return{t:g,curvePoint:v,distance:Math.sqrt(_)}}function Dat(t,e,i){const r=Sce(e,i),{a:s,b:n,u1:a,u2:o,cosR:l,sinR:u,isInvalid:d}=r,f=i.a[0];if(zh(t,e),zh(t,f),d)return t;const g=Math.atan2(-n*u,s*l),v=g+Math.PI,_=Math.atan2(n*l,s*u),x=_+Math.PI,S=u7(a,o);for(const T of[g,v,_,x].map(M=>aF(S,M)))T>S.min&&T<S.max&&zh(t,I5(r,T));return t}function Iai(t,e,i){const[r,s,n,a,o,l,u]=e.a,d=Sce(t,e),{u1:f,u2:g,isInvalid:v}=d,_=g-f;if(v)return Math.sqrt(Bc(t,r));const x=14,S=[0,0];let T=0,M=[AM(d,0),AM(d,.25),AM(d,.5),AM(d,.75),AM(d,1)];for(let E=0;E<x;E++){const P=M.length-1,O=_/(2*P),D=[];for(let F=0;F<P;F++)D.push(M[F]),D.push(I5(d,f+(2*F+1)*O));D.push(M[M.length-1]),M=D,T=0;let L=0;for(let F=1;F<M.length;F++){const j=M[F-1],N=M[F];if(T+=Math.sqrt(Bc(j,N)),F>1){const B=M[F-2],U=nat(S,B,j,s,N);L+=U?Math.sqrt(Bc(j,U)):Math.abs(N[0]-j[0])+Math.abs(N[1]-j[1])}else L+=T}if(L-T<i)return T}return T}const hbe=Jr(),CN=Jr(),dbe=Jr(),V_=Jr();function Dai(t,e,i){const[r,s,n,a,o,l,u]=e.a,d=Sce(t,e),{cosR:f,sinR:g,a:v,b:_,cx:x,cy:S}=d,T=H6([0,0],r,i),M=H6([0,0],s,i),E=i[0]*i[4]<0?1-a:a;{const P=v*v*g*g+_*_*f*f,O=2*(_*_-v*v)*g*f,D=v*v*f*f+_*_*g*g,L=-2*P*x-O*S,F=-O*x-2*D*S;b0(hbe,P,O/2,L/2,O/2,D,F/2,L/2,F/2,P*x*x+O*x*S+D*S*S-v*v*_*_)}if(_$(CN,i),CN==null){const P=H6([0,0],t,i);return{a:[T,M,n,a,ES(T[1],T[0]),Math.sqrt(Bc(T,P))/2,0]}}R1(dbe,CN),KT(V_,KT(V_,dbe,hbe),CN);{const P=V_[0],O=2*V_[1],D=V_[4],L=2*V_[2],F=2*V_[5],j=O*O-4*P*D,N=2*(P*F*F+D*L*L-O*L*F+j*V_[8]),B=Math.sqrt((P-D)**2+O*O),U=-Math.sqrt(N*(P+D+B))/j,Q=-Math.sqrt(N*(P+D-B))/j;return{a:[T,M,n,E,.5*ES(-O,D-P),U,Q/U]}}}function kat(t,e,i){if(h7(i))return zh(t,e),zh(t,i),t;if(wce(i))return cat(t,e,i);if(xce(i)){const r=LIe(e,i);return ube(t,r)}if(FIe(i)){const r=Rat(e,i);return ube(t,r)}return Dat(t,e,i)}function zIe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function NIe(t){return t.points!==void 0}function VIe(t){return t.x!==void 0&&t.y!==void 0}function jIe(t){return t.paths!==void 0}function UIe(t){return t.rings!==void 0}function BIe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const uw=BIe(Math.min),hw=BIe(Math.max);function kai(t,e){return jIe(e)?_O(t,e.curvePaths??e.paths,!1,!1)??t:UIe(e)?_O(t,e.curveRings??e.rings,!1,!1)??t:NIe(e)?Tce(t,e.points,!1,!1,!1,!1):zIe(e)?qIe(t,e):(VIe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function Lai(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=Lat(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return fi([e,r,i,s])}function Lat(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return fi([e,r,i,s])}function Fai(t,e){return jIe(e)?_O(t,e.curvePaths??e.paths,!0,!1)??t:UIe(e)?_O(t,e.curveRings??e.rings,!0,!1)??t:NIe(e)?Tce(t,e.points,!0,!1,!0,!1):zIe(e)?qIe(t,e,!0,!1,!0,!1):(VIe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function _O(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,a,o,l,[u,d]=rJ(e[0][0]),f=u,g=d;for(let v=0;v<e.length;v++){const _=e[v];for(let x=0;x<_.length;x++){const S=rJ(_[x]),[T,M]=S;if(u=uw(u,T),d=uw(d,M),f=hw(f,T),g=hw(g,M),i&&S.length>2){const D=S[2];n=uw(n,D),a=hw(a,D)}if(r&&S.length>s){const D=S[s];o=uw(n,D),l=hw(a,D)}const E=_[x];if(h7(E)||x<1)continue;const P=rJ(_[x-1]),O=o7(u,d,f,g);[u,d,f,g]=kat(O,P,E)}}return i?r?(t[0]=u,t[1]=d,t[2]=n,t[3]=o,t[4]=f,t[5]=g,t[6]=a,t[7]=l,t.length=8,t):(t[0]=u,t[1]=d,t[2]=n,t[3]=f,t[4]=g,t[5]=a,t.length=6,t):r?(t[0]=u,t[1]=d,t[2]=o,t[3]=f,t[4]=g,t[5]=l,t.length=6,t):(t[0]=u,t[1]=d,t[2]=f,t[3]=g,t.length=4,t)}function qIe(t,e,i,r,s,n){const a=e.xmin,o=e.xmax,l=e.ymin,u=e.ymax;let d=e.zmin,f=e.zmax,g=e.mmin,v=e.mmax;return s?(d=d||0,f=f||0,n?(g=g||0,v=v||0,t[0]=a,t[1]=l,t[2]=d,t[3]=g,t[4]=o,t[5]=u,t[6]=f,t[7]=v,t):(t[0]=a,t[1]=l,t[2]=d,t[3]=o,t[4]=u,t[5]=f,t)):n?(g=g||0,v=v||0,t[0]=a,t[1]=l,t[2]=g,t[3]=o,t[4]=u,t[5]=v,t):(t[0]=a,t[1]=l,t[2]=o,t[3]=u,t)}function Tce(t,e,i,r,s,n){const a=i?3:2,o=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let u,d,f,g,[v,_]=e[0],[x,S]=e[0];for(let T=0;T<e.length;T++){const M=e[T],[E,P]=M;if(v=uw(v,E),_=uw(_,P),x=hw(x,E),S=hw(S,P),l&&M.length>2){const O=M[2];u=uw(u,O),d=hw(d,O)}if(o&&M.length>a){const O=M[a];f=uw(u,O),g=hw(d,O)}}return s?(u=u||0,d=d||0,n?(f=f||0,g=g||0,t[0]=v,t[1]=_,t[2]=u,t[3]=f,t[4]=x,t[5]=S,t[6]=d,t[7]=g,t):(t[0]=v,t[1]=_,t[2]=u,t[3]=x,t[4]=S,t[5]=d,t)):n?(f=f||0,g=g||0,t[0]=v,t[1]=_,t[2]=f,t[3]=x,t[4]=S,t[5]=g,t):(t[0]=v,t[1]=_,t[2]=x,t[3]=S,t)}function Fat(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function zat(t){return t.points!==void 0}function Nat(t){return t.x!==void 0&&t.y!==void 0}function Vat(t){return t.paths!==void 0}function jat(t){return t.rings!==void 0}const $ce=[];function GIe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function HIe(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function WIe(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function ZIe(t,e,i,r,s,n,a,o){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:a,mmax:o}}function Cce(t,e=!1,i=!1){return e?i?ZIe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):HIe(t[0],t[1],t[2],t[3],t[4],t[5]):i?WIe(t[0],t[1],t[2],t[3],t[4],t[5]):GIe(t[0],t[1],t[2],t[3])}function zai(t){return t?Fat(t)?t:Nat(t)?Uat(t):jat(t)?JIe(t):Vat(t)?QIe(t):zat(t)?YIe(t):null:null}function YIe(t){const{hasZ:e,hasM:i,points:r}=t,s=Tce($ce,r,e??!1,i??!1,e??!1,i??!1);return s?Cce(s,e,i):null}function Uat(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?ZIe(e,i,r,s,e,i,r,s):HIe(e,i,r,e,i,r):n?WIe(e,i,s,e,i,s):GIe(e,i,e,i)}function JIe(t){const{hasZ:e,hasM:i,rings:r,curveRings:s}=t,n=_O($ce,s??r,e??!1,i??!1);return n?Cce(n,e,i):null}function QIe(t){const{hasZ:e,hasM:i,paths:r,curvePaths:s}=t,n=_O($ce,s??r,e??!1,i??!1);return n?Cce(n,e,i):null}function bO(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var yte;function Bat(t){if(!t)return;let{points:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??=[],e?.at(0)?.length){case 4:r??=!0,i??=!0;break;case 3:r??=i!==!0,i??=!r;break;default:r??=!1,i??=!1}return s??=Me.WGS84,{...t,hasM:i,hasZ:r,points:e,spatialReference:s}}let Ho=yte=class extends Qa{constructor(t){super(Bat(t)),this.points=[],this.type="multipoint"}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=YIe(this);return t?new It({...t,spatialReference:this.spatialReference}):null}writePoints(t,e){e.points=se(this.points)}clone(){const{points:t,spatialReference:e,hasM:i,hasZ:r}=this;return new yte({points:se(t),spatialReference:e.clone(),hasM:i,hasZ:r})}addPoint(t){return bO(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new Ue(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Ue(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(bO(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};c([p({readOnly:!0})],Ho.prototype,"cache",null),c([p({readOnly:!0})],Ho.prototype,"extent",null),c([p({type:[[Number]],json:{write:{isRequired:!0}}})],Ho.prototype,"points",void 0),c([Ie("points")],Ho.prototype,"writePoints",null),Ho=yte=c([R("esri.geometry.Multipoint")],Ho),Ho.prototype.toJSON.isDefaultToJSON=!0;function Nai(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function qat(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function pbe(t){if(!t)return null;if(Array.isArray(t))return t;const e=t.hasZ,i=t.hasM;if(t.type==="point")return i&&e?[t.x,t.y,t.z,t.m]:e?[t.x,t.y,t.z]:i?[t.x,t.y,t.m]:[t.x,t.y];if(t.type==="polygon")return t.rings.slice();if(t.type==="polyline")return t.paths.slice();if(t.type==="multipoint")return t.points.map(r=>[r]);if(t.type==="extent"){const r=t.clone().normalize();if(!r)return null;let s=!1,n=!1;return r.forEach(a=>{a.hasZ&&(s=!0),a.hasM&&(n=!0)}),r.map(a=>{const o=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(s&&a.hasZ){const l=.5*(a.zmax-a.zmin);for(let u=0;u<o.length;u++)o[u].push(l)}if(n&&a.hasM){const l=.5*(a.mmax-a.mmin);for(let u=0;u<o.length;u++)o[u].push(l)}return o})}return null}function d7(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function XIe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function Gat(t,e,i,r){return Hat(t,e,i[r],i[r+1])}function Hat(t,e,i,r){const[s,n]=e,[a,o]=i,[l,u]=r,d=l-a,f=u-o,g=d*d+f*f,v=(s-a)*d+(n-o)*f,_=Math.min(1,Math.max(0,v/g));return t[0]=a+d*_,t[1]=o+f*_,t}function Wat(t,e,i,r,s,n){let a=i,o=r,l=s-a,u=n-o;if(l!==0||u!==0){const d=((t-a)*l+(e-o)*u)/(l*l+u*u);d>1?(a=s,o=n):d>0&&(a+=l*d,o+=u*d)}return l=t-a,u=e-o,l*l+u*u}function KIe(t,e){return XIe(t,e,.5)}function eDe(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=d7(t[r],t[r+1]);return i}function tDe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=d7(t[s],t[s+1]);if(e-r<n){const a=(e-r)/n;return XIe(t[s],t[s+1],a)}r+=n}return t[i-1]}function p7(t,e=0,i=1){let r=0;const s=t.length;let n=t[0];for(let a=1;a<s;a++){const o=t[a];r+=(o[e]-n[e])*(o[i]+n[i]),n=o}if(iDe(t)){const a=t[0];r+=(a[e]-n[e])*(a[i]+n[i])}return r>=0}function iDe(t){const e=t.length;return e>0&&!E0(t[0],t[e-1])}function Vai(t){"rings"in t&&(rDe(t),Zat(t))}function rDe(t){if("rings"in t)for(const e of t.rings)iDe(e)&&e.push(e[0].slice())}function Zat(t){if(!("rings"in t)||t.rings.length===0||p7(t.rings[0]))return!1;for(const e of t.rings)e.reverse();return!0}function jai(t){return t.type!=="polygon"&&t.type!=="polyline"||Yat(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function Yat(t,e){const i=Xl(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const a of t){let o=1/0,l=-1/0;for(const d of a){const f=sDe(d[0],r,s);o=Math.min(o,f),l=Math.max(l,f),d[0]=f}const u=l-o;n-u<u&&a.forEach(d=>{d[0]<0&&(d[0]+=n)})}}function sDe(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function Uai(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function Bai(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function Jat(t){return aDe(t.rings,t.hasZ??!1)}function nDe(t){const e=Jat(t);if(!e)return null;const{hasZ:i,spatialReference:r}=t,[s,n,a]=e;return isNaN(s)||isNaN(n)||i&&isNaN(a)?null:{x:s,y:n,z:i?a:void 0,spatialReference:r}}function aDe(t,e){if(!t?.length)return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,a=t.length;n<a;n++){const o=oDe(t[n],e,s);o&&r.push(o)}if(r.sort((n,a)=>{let o=n[2]-a[2];return o===0&&e&&(o=n[4]-a[4]),o}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?Qat(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function oDe(t,e,i){let r=0,s=0,n=0,a=0,o=0;const l=t.length?t[0][0]:0,u=t.length?t[0][1]:0,d=t.length&&e?t[0][2]:0;for(let g=0;g<t.length;g++){const v=t[g],_=t[(g+1)%t.length],[x,S,T]=v,M=x-l,E=S-u,[P,O,D]=_,L=P-l,F=O-u,j=M*F-L*E;if(a+=j,r+=(M+L)*j,s+=(E+F)*j,e&&v.length>2&&_.length>2){const N=T-d,B=D-d,U=M*B-L*N;n+=(N+B)*U,o+=U}x<i[0]&&(i[0]=x),x>i[1]&&(i[1]=x),S<i[2]&&(i[2]=S),S>i[3]&&(i[3]=S),e&&(T<i[4]&&(i[4]=T),T>i[5]&&(i[5]=T))}if(a>0&&(a*=-1),o>0&&(o*=-1),!a)return null;a*=.5,o*=.5;const f=[r/(6*a)+l,s/(6*a)+u,a];return e&&(i[4]===i[5]||o===0?(f[3]=(i[4]+i[5])/2,f[4]=0):(f[3]=n/(6*o)+d,f[4]=o)),f}function qai(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,a=t.pathSize?t.y:0;for(let o=0;o<t.pathSize;o++){t.seekInPath(o);const l=[t.x,t.y];t.seekInPath((o+1)%t.pathSize);const u=[t.x,t.y],[d,f]=l,g=d-n,v=f-a,[_,x]=u,S=_-n,T=x-a,M=g*T-S*v;s+=M,i+=(g+S)*M,r+=(v+T)*M,d<e[0]&&(e[0]=d),d>e[1]&&(e[1]=d),f<e[2]&&(e[2]=f),f>e[3]&&(e[3]=f)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+a,s]):null}function Qat(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,a=0,o=0;for(let l=0,u=t.length;l<u-1;l++){const d=t[l],f=t[l+1];if(d&&f){i[0]=d[0],i[1]=d[1],r[0]=f[0],r[1]=f[1],e&&d.length>2&&f.length>2&&(i[2]=d[2],r[2]=f[2]);const g=d7(i,r);if(g){s+=g;const v=KIe(d,f);n+=g*v[0],a+=g*v[1],e&&v.length>2&&(o+=g*v[2])}}}return s>0?e?[n/s,a/s,o/s]:[n/s,a/s]:t.length?t[0]:null}function Xat(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const a=oDe(qat(t),t.hasZ,n);a&&s.push(a)}if(s.sort((a,o)=>{let l=a[2]-o[2];return l===0&&e&&(l=a[4]-o[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const a=t.pathSize?Kat(t):null;if(!a)return null;r[0]=a[0],r[1]=a[1],e&&a.length>2&&(r[2]=a[2])}return r}function Kat(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,a=0,o=0;if(t.nextPoint()){let l=t.x,u=t.y,d=t.z;for(;t.nextPoint();){const f=t.x,g=t.y,v=t.z;i[0]=l,i[1]=u,r[0]=f,r[1]=g,e&&(i[2]=d,r[2]=v);const _=d7(i,r);if(_){s+=_;const x=KIe(i,r);n+=_*x[0],a+=_*x[1],e&&x.length>2&&(o+=_*x[2])}l=f,u=g,d=v}}return s>0?e?[n/s,a/s,o/s]:[n/s,a/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const eot=1e-6;function Gai(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<eot){const s=Xat(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)iot(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const tot=1/3;function iot(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,a=i.x-r,o=i.y-s,l=0,u=0;for(;i.nextPoint();)l=i.x-r,u=i.y-s,n=.5*tot*(l*o-u*a),t[0]+=n*(a+l),t[1]+=n*(o+u),a=l,o=u;const d=i.getCurrentRingArea(),f=[r,s];return f[0]-=e[0],f[1]-=e[1],f[0]*=d,f[1]*=d,t[0]+=f[0],t[1]+=f[1],t}var Y6;function fbe(t){return!Array.isArray(t[0])}function rot(t){return typeof t[0]?.[0]=="number"}function sot(t){if(!t)return;let{rings:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??=[],rot(e)&&(e=[e]),e[0]?.[0]?.length){case 4:r??=!0,i??=!0;break;case 3:r??=i!==!0,i??=!r;break;default:r??=!1,i??=!1}return s??=Me.WGS84,{...t,hasM:i,hasZ:r,rings:e,spatialReference:s}}let Wr=Y6=class extends Qa{static fromExtent(t){const e=t.clone().normalize(),{spatialReference:i}=t;let r=!1,s=!1;for(const a of e)a.hasZ&&(r=!0),a.hasM&&(s=!0);const n={rings:e.map(a=>{const o=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(r&&a.hasZ){const l=a.zmin+.5*(a.zmax-a.zmin);for(let u=0;u<o.length;u++)o[u].push(l)}if(s&&a.hasM){const l=a.mmin+.5*(a.mmax-a.mmin);for(let u=0;u<o.length;u++)o[u].push(l)}return o}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new Y6(n)}constructor(t){super(sot(t)),this.curveRings=void 0,this.rings=[],this.type="polygon"}get cache(){return this.commitProperty("curveRings"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("rings"),this.commitProperty("spatialReference"),{}}get centroid(){Wee(re.getLogger(this),"centroid",{replacement:"Please use centroidOperator.execute() instead.",version:"4.34",warnOnce:!0});const t=nDe(this);return t?Ue.fromJSON(t):null}writeCurveRings(t,e){e.curveRings=se(t)}get extent(){const t=JIe(this),{spatialReference:e}=this;return t?new It({...t,spatialReference:e}):null}get isSelfIntersecting(){return Wee(re.getLogger(this),"isSelfIntersecting",{replacement:"Please use simplifyOperator.isSimple() instead.",version:"4.33",warnOnce:!0}),Mnt(this.rings)}writeRings(t,e){e.rings=se(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(fbe(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("rings"),this}clone(){const t=new Y6;return t.spatialReference=this.spatialReference,t.rings=se(this.rings),t.curveRings=se(this.curveRings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,a,o],[l,u,d,f])=>s===l&&n===u&&(a==null&&d==null||a===d)&&(o==null&&f==null||o===f);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],a=t.rings[s];if(!E0(n,a,r))return!1}return!0}contains(t){if(!t)return!1;const e=eF(t,this.spatialReference);return mce(this,e??t)}isClockwise(t){const e=fbe(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return p7(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new Ue(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Ue(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Ue(i[0],i[1],i[2],i[3],this.spatialReference):new Ue(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(bO(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Ue(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new Ue(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(bO(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};c([p({readOnly:!0})],Wr.prototype,"cache",null),c([p({readOnly:!0})],Wr.prototype,"centroid",null),c([p({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],Wr.prototype,"curveRings",void 0),c([Ie("curveRings")],Wr.prototype,"writeCurveRings",null),c([p({readOnly:!0})],Wr.prototype,"extent",null),c([p({readOnly:!0})],Wr.prototype,"isSelfIntersecting",null),c([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Wr.prototype,"rings",void 0),c([Ie("rings")],Wr.prototype,"writeRings",null),Wr=Y6=c([R("esri.geometry.Polygon")],Wr),Wr.prototype.toJSON.isDefaultToJSON=!0;var vte;function not(t){return!Array.isArray(t[0])}function aot(t){return typeof t[0]?.[0]=="number"}function oot(t){if(!t)return;let{paths:e,hasM:i,hasZ:r,spatialReference:s}=t;switch(e??=[],aot(e)&&(e=[e]),e[0]?.[0]?.length){case 4:r??=!0,i??=!0;break;case 3:r??=i!==!0,i??=!r;break;default:r??=!1,i??=!1}return s??=Me.WGS84,{...t,hasM:i,hasZ:r,paths:e,spatialReference:s}}let gs=vte=class extends Qa{constructor(t){super(oot(t)),this.curvePaths=void 0,this.paths=[],this.type="polyline"}get cache(){return this.commitProperty("curvePaths"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("paths"),this.commitProperty("spatialReference"),{}}writeCurvePaths(t,e){e.curvePaths=se(t)}get extent(){const t=QIe(this),{spatialReference:e}=this;return t?new It({...t,spatialReference:e}):null}writePaths(t,e){e.paths=se(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(not(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.slice();return this.notifyChange("paths"),this}clone(){const t=new vte;return t.spatialReference=this.spatialReference,t.paths=se(this.paths),t.curvePaths=se(this.curvePaths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new Ue(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Ue(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Ue(i[0],i[1],i[2],i[3],this.spatialReference):new Ue(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(bO(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new Ue(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Ue(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(bO(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};c([p({readOnly:!0})],gs.prototype,"cache",null),c([p({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],gs.prototype,"curvePaths",void 0),c([Ie("curvePaths")],gs.prototype,"writeCurvePaths",null),c([p({readOnly:!0})],gs.prototype,"extent",null),c([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],gs.prototype,"paths",void 0),c([Ie("paths")],gs.prototype,"writePaths",null),gs=vte=c([R("esri.geometry.Polyline")],gs),gs.prototype.toJSON.isDefaultToJSON=!0;function lDe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Mce(t){return t.points!==void 0}function Ece(t){return t.x!==void 0&&t.y!==void 0}function Ace(t){return t.paths!==void 0||t.curvePaths!==void 0}function AS(t){return t.rings!==void 0||t.curveRings!==void 0}function wp(t){return t==null?null:t instanceof Qa?t:Ece(t)?Ue.fromJSON(t):Ace(t)?gs.fromJSON(t):AS(t)?Wr.fromJSON(t):Mce(t)?Ho.fromJSON(t):lDe(t)?It.fromJSON(t):null}function mP(t){return t?Ece(t)?"esriGeometryPoint":Ace(t)?"esriGeometryPolyline":AS(t)?"esriGeometryPolygon":lDe(t)?"esriGeometryEnvelope":Mce(t)?"esriGeometryMultipoint":null:null}const lot={esriGeometryPoint:Ue,esriGeometryPolyline:gs,esriGeometryPolygon:Wr,esriGeometryEnvelope:It,esriGeometryMultipoint:Ho,esriGeometryMultiPatch:Wr};function cot(t){return t&&lot[t]||null}const cDe=so()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),mbe=so()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),gP={base:Qa,key:"type",typeMap:{extent:It,multipoint:Ho,point:Ue,polyline:gs,polygon:Wr}};function Hai(t){return t.type==="point"}function Wai(t){return t.type==="multipoint"}function Zai(t){return t.type==="polygon"}function Yai(t){return t.type==="polyline"}var _te;let pb=_te=class extends ae{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new _te({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};c([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:sJ}}}}})],pb.prototype,"rotation",void 0),c([wi("rotation")],pb.prototype,"castRotation",null),c([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:sJ}}}}})],pb.prototype,"scale",void 0),c([p({types:gP,json:{read:wp,write:!0,origins:{"web-scene":{read:wp,write:{overridePolicy:sJ}}}}})],pb.prototype,"targetGeometry",void 0),c([p({type:tc,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],pb.prototype,"camera",void 0),pb=_te=c([R("esri.Viewpoint")],pb);const ys=pb;function sJ(){return{enabled:!this.camera}}const w$=t=>{const e=t;class i extends e{constructor(){super(...arguments),this._listenersMap=null}clearEvents(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clearEvents()}emit(s,n){let a=this._listenersMap?.get(s);if(!a)return!1;let o=!1;for(const l of a.slice()){const u="deref"in l?l.deref():l;u?u?.call(this,n):o=!0}return o&&(a=a.filter(l=>!("deref"in l)||l.deref()!=null),this._listenersMap.set(s,a)),a.length>0}on(s,n){if(Array.isArray(s)){const o=s.map(l=>this.on(l,n));return Yu(o)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const a=this._listenersMap.get(s)||[];return a.push(n),this._listenersMap.set(s,a),bi(()=>{const o=this._listenersMap?.get(s),l=o?.indexOf(n)??-1;l>=0&&o.splice(l,1)})}once(s,n){const a=this.on(s,o=>{a.remove(),("deref"in n?n.deref():n)?.call(null,o)});return a}hasEventListener(s){const n=this._listenersMap?.get(s);return n!=null&&n.length>0}}return i},Oce=w$(class{}),gm=Oce,Ju=w$(be);function Pce(t){return(e,i)=>{e[i]=t}}var Zy;let uot=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},hot=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const md=new Wc(()=>new uot,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function gbe(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function nJ(t){return t?t instanceof Ub?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function aJ(t){if(t?.length)return t[0]}function dot(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function uDe(t,e,i,r){e&&e.forEach((s,n,a)=>{t.push(s),uDe(t,i.call(r,s,n,a),i,r)})}const j_=new Set,U_=new Set,B_=new Set,oJ=new Map;let pot=0,Ub=Zy=class extends Ju{static ofType(t){if(!t)return Zy;if(oJ.has(t))return oJ.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends Zy{};return c([Pce({Type:t,ensureType:typeof t=="function"?en(t):sm(t)})],i.prototype,"itemType",void 0),i=c([R(`esri.core.Collection<${e}>`)],i),oJ.set(t,i),i}static isCollection(t){return t!=null&&t instanceof Zy}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new d$,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:pot++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Zy?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),super.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return Mt(this._observable),this._items}set items(t){this._emitBeforeChanges(1)||(this._splice(0,this.length,nJ(t)),this._emitAfterChanges(1))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:super.hasEventListener(t))}on(t,e){if(this.destroyed)return bi();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),bi(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return super.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{i()?.call(null,s),r.remove()});return r}add(t,e){if(Mt(this._observable),this._emitBeforeChanges(1))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(1),this}addMany(t,e=this._items.length){if(Mt(this._observable),!t?.length)return this;if(this._emitBeforeChanges(1))return this;const i=this.getNextIndex(e);return this._splice(i,0,nJ(t)),this._emitAfterChanges(1),this}at(t){if(Mt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Mt(this._observable),!this.length||this._emitBeforeChanges(2))return[];const t=this._removeAllRaw();return this._emitAfterChanges(2),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Mt(this._observable),this._createNewInstance({items:this._items.map(se)})}concat(...t){Mt(this._observable);const e=t.map(nJ);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Mt(this._observable),!this.length||this._emitBeforeChanges(2))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(2)}destroyAll(){this.drain(gbe)}destroyMany(t){const e=this.removeMany(t);return e.forEach(gbe),e}every(t,e){return Mt(this._observable),this._items.every(t,e)}filter(t,e){Mt(this._observable);const i=arguments.length===2?this._items.filter(t,e):this._items.filter(t);return this._createNewInstance({items:i})}find(t,e){return Mt(this._observable),this._items.find(t,e)}findIndex(t,e){return Mt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Mt(this._observable);const i=[];return uDe(i,this,t,e),new Zy(i)}forEach(t,e){return Mt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Mt(this._observable),this._items[t]}getNextIndex(t){Mt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Mt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Mt(this._observable),this._items.indexOf(t,e)}join(t=","){return Mt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Mt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Mt(this._observable);const i=this._items.map(t,e);return new Zy({items:i})}reorder(t,e=this.length-1){Mt(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(4))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(4)}return t}}pop(){if(Mt(this._observable),!this.length||this._emitBeforeChanges(2))return;const t=aJ(this._splice(this.length-1,1));return this._emitAfterChanges(2),t}push(...t){return Mt(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,t),this._emitAfterChanges(1)),this.length}reduce(t,e){Mt(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Mt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Mt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Mt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(2))return;const e=aJ(this._splice(t,1));return this._emitAfterChanges(2),e}removeMany(t){if(Mt(this._observable),!t?.length||this._emitBeforeChanges(2))return[];const e=t instanceof Zy?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const a=e[n],o=i.indexOf(a);if(o>-1){const l=1+dot(e,i,n+1,o+1),u=this._splice(o,l);u&&u.length>0&&r.push.apply(r,u),n+=l-1}}return this._emitAfterChanges(2),r}reverse(){if(Mt(this._observable),this._emitBeforeChanges(4))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(4),this}shift(){if(Mt(this._observable),!this.length||this._emitBeforeChanges(2))return;const t=aJ(this._splice(0,1));return this._emitAfterChanges(2),t}slice(t=0,e=this.length){return Mt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Mt(this._observable),this._items.some(t,e)}sort(t){if(Mt(this._observable),!this.length||this._emitBeforeChanges(4)||!this._requiresSort(t))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(4),this}_requiresSort(t=(e,i)=>e===i?0:e<i?-1:1){const e=this.length-1;for(let i=0;i<e;i++)if(t(this.items[i],this.items[i+1])>0)return!0;return!1}splice(t,e,...i){Mt(this._observable),arguments.length===1&&(e=this.length),e??=0;const r=(e?2:0)|(i.length?1:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return Mt(this._observable),this._items.slice()}toJSON(t){return Mt(this._observable),this.toArray().map(e=>$5(e)?e.toJSON(t):e)}toLocaleString(){return Mt(this._observable),this._items.toLocaleString()}toString(){return Mt(this._observable),this._items.toString()}unshift(...t){return Mt(this._observable),!t.length||this._emitBeforeChanges(1)||(this._splice(0,0,t),this._emitAfterChanges(1)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=uP(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(a=r.splice(t,e),this.hasEventListener("before-remove")){const o=md.acquire();o.target=this,o.cancellable=!0;for(let l=0,u=a.length;l<u;l++)n=a[l],o.reset(n),this.emit("before-remove",o),o.defaultPrevented&&(a.splice(l,1),r.splice(t,0,n),t+=1,l-=1,u-=1);md.release(o)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const o=md.acquire();o.target=this,o.cancellable=!1;const l=a.length;for(let u=0;u<l;u++)o.reset(a[u]),this.emit("after-remove",o);md.release(o)}}if(i?.length){if(s){const d=[];for(const f of i){const g=s.ensureType(f);g==null&&f!=null||d.push(g)}i=d}const o=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),u=t===this.length;if(o||l){const d=md.acquire();d.target=this,d.cancellable=!0;const f=md.acquire();f.target=this,f.cancellable=!1;for(const g of i)o?(d.reset(g),this.emit("before-add",d),d.defaultPrevented||(u?r.push(g):r.splice(t++,0,g),this._set("length",r.length),l&&(f.reset(g),this.emit("after-add",f)))):(u?r.push(g):r.splice(t++,0,g),this._set("length",r.length),f.reset(g),this.emit("after-add",f));md.release(f),md.release(d)}else{if(u)for(const d of i)r.push(d);else r.splice(t,0,...i);this._set("length",r.length)}}if((i?.length||a?.length)&&this._notifyChangeEvent(i,a),this.hasEventListener("after-splice")){const o=new hot(this,i,a,t,e);this.emit("after-splice",o)}return a}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=md.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,md.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=md.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),md.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;j_.clear(),U_.clear(),B_.clear();for(const{added:l,removed:u}of i){if(l)if(B_.size===0&&U_.size===0)for(const d of l)j_.add(d);else for(const d of l)U_.has(d)?(B_.add(d),U_.delete(d)):B_.has(d)||j_.add(d);if(u)if(B_.size===0&&j_.size===0)for(const d of u)U_.add(d);else for(const d of u)j_.has(d)?j_.delete(d):(B_.delete(d),U_.add(d))}const r=Lc.acquire();j_.forEach(l=>{r.push(l)});const s=Lc.acquire();U_.forEach(l=>{s.push(l)});const n=this._items,a=e.items,o=Lc.acquire();if(B_.forEach(l=>{a.indexOf(l)!==n.indexOf(l)&&o.push(l)}),e.listeners&&(r.length||s.length||o.length)){const l={target:this,added:r,removed:s,moved:o},u=e.listeners.length;for(let d=0;d<u;d++){const f=e.listeners[d];f.removed||f.callback.call(this,l)}}Lc.release(r),Lc.release(s),Lc.release(o)}j_.clear(),U_.clear(),B_.clear()}};c([p()],Ub.prototype,"_updating",void 0),c([p()],Ub.prototype,"length",void 0),c([p()],Ub.prototype,"items",null),c([p({readOnly:!0})],Ub.prototype,"updating",null),Ub=Zy=c([R("esri.core.Collection")],Ub);const ke=Ub;let op=class extends ke{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(DPe(()=>this._refresh(),Ht))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections?.();if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i)}_createNewInstance(e){return new ke(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const a of n)e=this._processCollection(e,a);else e=this._processCollection(e,n)}}return e}};c([p()],op.prototype,"getCollections",void 0),c([p()],op.prototype,"getChildrenFunction",void 0),c([p()],op.prototype,"itemFilterFunction",void 0),op=c([R("esri.core.CollectionFlattener")],op);let wO=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new d$,this._items=new Set}get length(){return Mt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Mt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Mt(this._observable),yield*this._items}};const hDe=new FinalizationRegistry(t=>{t.close()});function fot(t,e){hDe.register(t,e,e)}function mot(t){hDe.unregister(t)}function dDe(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let a,o;const l=n[n.length-1];return got(l)&&(a=l.signal,o=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:o,signal:a})}})}function got(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const yot={statsWorker:()=>W(()=>import("./statsWorker-DdwgBgmn.js"),__vite__mapDeps([0,1,2,3,4])),geometryEngineWorker:()=>W(()=>import("./geometryEngineWorker-BkMQzpX8.js"),__vite__mapDeps([5,6,7,8])),arcadeGeometryOperatorsWorker:()=>W(()=>import("./operatorsWorker-U6R_ArL4.js"),[]),CSVSourceWorker:()=>W(()=>import("./CSVSourceWorker-BF0_KlU1.js"),__vite__mapDeps([9,10,11,12,13,14,15,16,17,18,19,1,2,3,4,20,21,22,23,24])),EdgeProcessingWorker:()=>W(()=>import("./EdgeProcessingWorker-Bu6LdHdK.js"),__vite__mapDeps([25,26,27,28,29])),ElevationSamplerWorker:()=>W(()=>import("./ElevationSamplerWorker-D3zJeczH.js"),__vite__mapDeps([30,31,32])),FeatureServiceSnappingSourceWorker:()=>W(()=>import("./FeatureServiceSnappingSourceWorker-DJg1MH9B.js"),__vite__mapDeps([33,11,12,13,14,15,16,17,18,19,1,2,3,4,20,21,34,35,36,37])),GaussianSplatSortWorker:()=>W(()=>import("./GaussianSplatSortWorker-CkystscD.js"),[]),GeoJSONSourceWorker:()=>W(()=>import("./GeoJSONSourceWorker-BR-aTSD9.js"),__vite__mapDeps([38,11,12,13,14,15,16,17,18,19,1,2,3,4,20,21,39,10,24,40])),LercWorker:()=>W(()=>import("./LercWorker-FGvnDzyM.js"),[]),MemorySourceWorker:()=>W(()=>import("./MemorySourceWorker-DeSEzWF7.js"),__vite__mapDeps([41,42,11,12,13,14,15,16,17,18,19,1,2,3,4,20,21,24,40,10])),PBFDecoderWorker:()=>W(()=>import("./PBFDecoderWorker-DN1eBk3w.js"),__vite__mapDeps([43,35,36])),FeaturePipelineWorker:()=>W(()=>import("./FeaturePipelineWorker--ye76EEk.js"),__vite__mapDeps([44,45,46,47,48,49,50,51,14,13,52,53,54,55,56,57,58,59,60,61,15,16,17,18,19,1,2,3,4,20,21,62,63,64,65,66,67,68,69,39,10,24,40,37,35,36,70,71,72,73])),PointCloudWorker:()=>W(()=>import("./PointCloudWorker-CY-9nJcq.js"),__vite__mapDeps([74,75,76,77])),RasterWorker:()=>W(()=>import("./RasterWorker-Bo2HqK07.js"),__vite__mapDeps([78,79,80,8,81,82,83,84,85,86])),SceneLayerSnappingSourceWorker:()=>W(()=>import("./SceneLayerSnappingSourceWorker-39-LMSD4.js"),__vite__mapDeps([87,28,29,27])),SceneLayerWorker:()=>W(()=>import("./SceneLayerWorker-BIq_BA-n.js"),__vite__mapDeps([88,89])),WFSSourceWorker:()=>W(()=>import("./WFSSourceWorker-DEkTM8lp.js"),__vite__mapDeps([90,11,12,13,14,15,16,17,18,19,1,2,3,4,20,21,39,10,40,91,92])),WorkerTileHandler:()=>W(()=>import("./WorkerTileHandler-CwR49X6k.js"),__vite__mapDeps([93,57,36,59,94,95,56])),Lyr3DWorker:()=>W(()=>import("./Lyr3DWorker-DuyMdjnM.js"),__vite__mapDeps([96,97])),Feature3DPipelineWorker:()=>W(()=>import("./Feature3DPipelineWorker-DuaZE5WJ.js"),__vite__mapDeps([98,16,17,18,13,14,19,1,2,3,4,20,21,99,37,35,36])),TextureCompressionWorker:()=>W(()=>import("./TextureCompressionWorker-Bvr7sv0T.js"),[]),FlowWorker:()=>W(()=>import("./FlowWorker-BRmNeyb9.js"),__vite__mapDeps([100,86,101,102])),ParquetSourceWorker:()=>W(()=>import("./ParquetSourceWorker-BUAHUELz.js"),__vite__mapDeps([103,61,16,17,18,13,14,19,1,2,3,4,20,21,24,104,23,64,49,50,63,62])),PanoramicMeshWorker:()=>W(()=>import("./PanoramicMeshWorker--Yx4WOkd.js"),__vite__mapDeps([105,79]))},pDe="worker:port-closed",w0={HANDSHAKE:0,OPEN:1,OPENED:2,RESPONSE:3,INVOKE:4,ABORT:5,CLOSE:6,OPEN_PORT:7,ON:8};let vot=0;function fDe(){return vot++}function _ot(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function xq(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function mDe(t,e,i,r){if(e.type===w0.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==w0.INVOKE&&e.type!==w0.RESPONSE)return void t.postMessage(e);let s;_ot(i)?(s=ybe(i.transferList),e.data=i.result):(s=ybe(r),e.data=i),s?t.postMessage(e,s):t.postMessage(e)}function D5(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function ybe(t){if(!t?.length)return null;if(ie("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!bot(i));return e.length?e:null}function bot(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}async function eoi(t){try{return await t}catch(e){const i=e?.name===pDe;if(!(Zr(e)||i))throw e;return}}const{CLOSE:MN,ABORT:bte,INVOKE:vbe,RESPONSE:UR,OPEN_PORT:_be,ON:bbe}=w0,wot=2;let xot=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===bte?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}};var Xd;let xO=(Xd=class{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new Xd(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),Xd.clients.set(n,s),r.port2}static loadWorker(e){const i=yot[e];return i?i():Promise.resolve(null)}constructor(e,i,r,s){this._port=e,this._jobQueue=r,this._lowPriorityJobQueue=s,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new xot(n=>this._onInvokeMessage(n)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:MN}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r?.signal,n=r?.transferList;if(!this._port)return Promise.reject(new q(pDe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const a=fDe();return new Promise((o,l)=>{if(sa(s))return this._processWork(),void l(ti());const u=Mo(s,()=>{const f=this._outJobs.get(a);f&&(this._outJobs.delete(a),this._processWork(),Xi(f.abortHandle),this._post({type:bte,jobId:a}),l(ti()))}),d={resolve:o,reject:l,abortHandle:u,debugInfo:e};this._outJobs.set(a,d),this._post({type:vbe,jobId:a,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return dDe(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:bbe,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),bi(()=>{r.port1.postMessage({type:MN}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:_be,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=wot)return;const e=this._jobQueue?.pop()??this._lowPriorityJobQueue?.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Xi(e.abortHandle),e.reject(ti(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null,this._onMessage=null,this._channel=null,this._jobQueue=void 0,this._invokeQueue=void 0,this._lowPriorityJobQueue=void 0}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=D5(e);if(r)switch(r.type){case UR:this._onResponseMessage(r);break;case vbe:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case bte:this._onAbortMessage(r);break;case MN:this._onCloseMessage();break;case _be:this._onOpenPortMessage(r);break;case bbe:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&Xd.clients.get(this)===e&&e.destroy(),Xd.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,a=n?new AbortController:null,o=this._inJobs;let l,u=this._client,d=u[i];try{if(!d&&i&&i.includes(".")){const f=i.split(".");for(let g=0;g<f.length-1;g++)u=u[f[g]],d=u[f[g+1]]}if(typeof d!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:a?a.signal:null}),l=d.apply(u,s)}catch(f){return void this._post({type:UR,jobId:r,error:xq(f)})}Ea(l)?(o.set(r,{controller:a,promise:l}),l.then(f=>{o.has(r)&&(o.delete(r),this._post({type:UR,jobId:r},f))},f=>{o.has(r)&&(o.delete(r),Zr(f)||this._post({type:UR,jobId:r,error:xq(f||{message:`Error encountered at method ${i}`})}))})):this._post({type:UR,jobId:r},l)}_onOpenPortMessage(e){new Xd(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=f$(e.port,"message",n=>{D5(n)?.type===MN&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const a=n.get(i);n.delete(i),this._processWork(),Xi(a.abortHandle),r?a.reject(q.fromJSON(JSON.parse(r))):a.resolve(s)}_post(e,i,r){return mDe(this._port,e,i,r)}},Xd.kernelInfo={buildDate:ORe,fullVersion:tce,revision:PRe},Xd.clients=new Map,Xd),Sot=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new wO,this._ongoingLowPriorityJobsQueue=new wO}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,i){return new Promise((r,s)=>{let n=!0;const a=o=>{ct(i.signal),n&&(n=!1,o())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let o=0;o<e.length;++o){const l=e[o];Ea(l)?this._clientPromises[o]=l.then(u=>(this._clients[o]=new xO(u,i,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),a(r),this._clients[o]),()=>(a(s),null)):(this._clients[o]=new xO(l,i,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),this._clientPromises[o]=Promise.resolve(this._clients[o]),a(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const a=this._clientPromises[n];s[n]=a.then(o=>o?.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(ti(`Worker closing, aborting job calling '${e.methodName}'`));for(;e=this._ongoingLowPriorityJobsQueue.pop();)e.resolver.reject(ti(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,mot(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=Eo();(r?.priority==="low"?this._ongoingLowPriorityJobsQueue:this._ongoingJobsQueue).push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const a=this._clients[n];a?a.jobAdded():this._clientPromises[n].then(o=>o?.jobAdded())}return s.promise}createInvokeProxy(e){return dDe(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>Yu(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r===0&&e(i)})})}get test(){}};const Tot={async request(t,e){const i=t.options,r=i.responseType;i.signal=e?.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&Kee(t.url)?.after?r:"array-buffer";const s=await Si(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch(s.requestOptions?.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}};let m4;const $ot=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale,wte=globalThis.document?.documentElement;function gDe(){const t=wte?.getAttribute("lang"),e=globalThis.navigator?.language;return $ot??t??e??"en"}function Vu(){return m4===void 0&&(m4=gDe()),m4}const Cot=/^(?<language>[a-z]{2,3})(?:-(?<extlang>[a-z]{3}))?(?:-[A-Z][a-z]{3})?(?:-(?<region>[A-Z]{2}|\d{3}))?(?:-.*)?$/;function Rce(t=Vu()){return vDe(t)?.language}function yDe(t=Vu()){const e=vDe(t);return e?.language&&e?.extlang?t.replace(`${e.language}-`,""):t}function vDe(t=Vu()){return Cot.exec(t)?.groups}const J6=[];function Ice(t){return J6.push(t),bi(()=>{J6.splice(J6.indexOf(t),1)})}const Q6=[];function Dce(t){return Q6.push(t),bi(()=>Q6.splice(Q6.indexOf(t),1))}function wbe(){const t=gDe();m4!==t&&([...Q6].forEach(e=>e(t)),m4=t,[...J6].forEach(e=>e(t)))}globalThis.addEventListener?.("languagechange",wbe),wte&&new MutationObserver(()=>{wbe()}).observe(wte,{attributeFilter:["lang"]});const xp="system",n1="unknown",a1="UTC",Mot=Intl.DateTimeFormat().resolvedOptions().timeZone,xbe=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class x$ extends Error{}class Eot extends x${constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Aot extends x${constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Oot extends x${constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class nE extends x${}class _De extends x${constructor(e){super(`Invalid unit ${e}`)}}class Nl extends x${}class q_ extends x${constructor(){super("Zone is an abstract class")}}const dt="numeric",am="short",Wh="long",Sq={year:dt,month:dt,day:dt},bDe={year:dt,month:am,day:dt},Pot={year:dt,month:am,day:dt,weekday:am},wDe={year:dt,month:Wh,day:dt},xDe={year:dt,month:Wh,day:dt,weekday:Wh},SDe={hour:dt,minute:dt},TDe={hour:dt,minute:dt,second:dt},$De={hour:dt,minute:dt,second:dt,timeZoneName:am},CDe={hour:dt,minute:dt,second:dt,timeZoneName:Wh},MDe={hour:dt,minute:dt,hourCycle:"h23"},EDe={hour:dt,minute:dt,second:dt,hourCycle:"h23"},ADe={hour:dt,minute:dt,second:dt,hourCycle:"h23",timeZoneName:am},ODe={hour:dt,minute:dt,second:dt,hourCycle:"h23",timeZoneName:Wh},PDe={year:dt,month:dt,day:dt,hour:dt,minute:dt},RDe={year:dt,month:dt,day:dt,hour:dt,minute:dt,second:dt},IDe={year:dt,month:am,day:dt,hour:dt,minute:dt},DDe={year:dt,month:am,day:dt,hour:dt,minute:dt,second:dt},Rot={year:dt,month:am,day:dt,weekday:am,hour:dt,minute:dt},kDe={year:dt,month:Wh,day:dt,hour:dt,minute:dt,timeZoneName:am},LDe={year:dt,month:Wh,day:dt,hour:dt,minute:dt,second:dt,timeZoneName:am},FDe={year:dt,month:Wh,day:dt,weekday:Wh,hour:dt,minute:dt,timeZoneName:Wh},zDe={year:dt,month:Wh,day:dt,weekday:Wh,hour:dt,minute:dt,second:dt,timeZoneName:Wh};class S${get type(){throw new q_}get name(){throw new q_}get ianaName(){return this.name}get isUniversal(){throw new q_}offsetName(e,i){throw new q_}formatOffset(e,i){throw new q_}offset(e){throw new q_}equals(e){throw new q_}get isValid(){throw new q_}}let lJ=null;class f7 extends S${static get instance(){return lJ===null&&(lJ=new f7),lJ}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return YDe(e,i,r)}formatOffset(e,i){return g4(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}const xte=new Map;function Iot(t){let e=xte.get(t);return e===void 0&&(e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),xte.set(t,e)),e}const Dot={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function kot(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,a,o,l,u,d]=r;return[a,s,n,o,l,u,d]}function Lot(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:a}=i[s],o=Dot[n];n==="era"?r[o]=a:gi(o)||(r[o]=parseInt(a,10))}return r}const cJ=new Map;class Hu extends S${static create(e){let i=cJ.get(e);return i===void 0&&cJ.set(e,i=new Hu(e)),i}static resetCache(){cJ.clear(),xte.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Hu.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return YDe(e,i,r,this.name)}formatOffset(e,i){return g4(this.offset(e),i)}offset(e){if(!this.valid)return NaN;const i=new Date(e);if(isNaN(i))return NaN;const r=Iot(this.name);let[s,n,a,o,l,u,d]=r.formatToParts?Lot(r,i):kot(r,i);o==="BC"&&(s=-Math.abs(s)+1);const g=g7({year:s,month:n,day:a,hour:l===24?0:l,minute:u,second:d,millisecond:0});let v=+i;const _=v%1e3;return v-=_>=0?_:1e3+_,(g-v)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Sbe={};function Fot(t,e={}){const i=JSON.stringify([t,e]);let r=Sbe[i];return r||(r=new Intl.ListFormat(t,e),Sbe[i]=r),r}const Ste=new Map;function Tte(t,e={}){const i=JSON.stringify([t,e]);let r=Ste.get(i);return r===void 0&&(r=new Intl.DateTimeFormat(t,e),Ste.set(i,r)),r}const $te=new Map;function zot(t,e={}){const i=JSON.stringify([t,e]);let r=$te.get(i);return r===void 0&&(r=new Intl.NumberFormat(t,e),$te.set(i,r)),r}const Cte=new Map;function Not(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=Cte.get(s);return n===void 0&&(n=new Intl.RelativeTimeFormat(t,e),Cte.set(s,n)),n}let dD=null;function Vot(){return dD||(dD=new Intl.DateTimeFormat().resolvedOptions().locale,dD)}const Mte=new Map;function NDe(t){let e=Mte.get(t);return e===void 0&&(e=new Intl.DateTimeFormat(t).resolvedOptions(),Mte.set(t,e)),e}const Ete=new Map;function jot(t){let e=Ete.get(t);if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,"minimalDays"in e||(e={...VDe,...e}),Ete.set(t,e)}return e}function Uot(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=Tte(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=Tte(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:a}=r;return[s,n,a]}}function Bot(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function qot(t){const e=[];for(let i=1;i<=12;i++){const r=gt.utc(2009,i,1);e.push(t(r))}return e}function Got(t){const e=[];for(let i=1;i<=7;i++){const r=gt.utc(2016,11,13+i);e.push(t(r))}return e}function EN(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function Hot(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||NDe(t.locale).numberingSystem==="latn"}class Wot{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...a}=r;if(!i||Object.keys(a).length>0){const o={useGrouping:!1,...r};r.padTo>0&&(o.minimumIntegerDigits=r.padTo),this.inf=zot(e,o)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):Nce(e,3);return Za(i,this.padTo)}}}class Zot{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const a=-1*(e.offset/60),o=a>=0?`Etc/GMT+${a}`:`Etc/GMT${a}`;e.offset!==0&&Hu.create(o).valid?(s=o,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=Tte(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Yot{constructor(e,i,r){this.opts={style:"long",...r},!i&&WDe()&&(this.rtf=Not(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):ylt(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const VDe={firstDay:1,minimalDays:4,weekend:[6,7]};class os{static fromOpts(e){return os.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const a=e||Qn.defaultLocale,o=a||(n?"en-US":Vot()),l=i||Qn.defaultNumberingSystem,u=r||Qn.defaultOutputCalendar,d=Ote(s)||Qn.defaultWeekSettings;return new os(o,l,u,d,a)}static resetCache(){dD=null,Ste.clear(),$te.clear(),Cte.clear(),Mte.clear(),Ete.clear()}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return os.create(e,i,r,s)}constructor(e,i,r,s,n){const[a,o,l]=Uot(e);this.locale=a,this.numberingSystem=i||o||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=Bot(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Hot(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:os.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,Ote(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return EN(this,e,XDe,()=>{const r=this.intl==="ja"||this.intl.startsWith("ja-");i&=!r;const s=i?{month:e,day:"numeric"}:{month:e},n=i?"format":"standalone";if(!this.monthsCache[n][e]){const a=r?o=>this.dtFormatter(o,s).format():o=>this.extract(o,s,"month");this.monthsCache[n][e]=qot(a)}return this.monthsCache[n][e]})}weekdays(e,i=!1){return EN(this,e,tke,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=Got(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return EN(this,void 0,()=>ike,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[gt.utc(2016,11,13,9),gt.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return EN(this,e,rke,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[gt.utc(-40,1,1),gt.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),a=n.find(o=>o.type.toLowerCase()===r);return a?a.value:null}numberFormatter(e={}){return new Wot(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new Zot(e,this.intl,i)}relFormatter(e={}){return new Yot(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Fot(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||NDe(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:ZDe()?jot(this.locale):VDe}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let uJ=null;class Xa extends S${static get utcInstance(){return uJ===null&&(uJ=new Xa(0)),uJ}static instance(e){return e===0?Xa.utcInstance:new Xa(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Xa(y7(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${g4(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${g4(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return g4(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Jot extends S${constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function iw(t,e){if(gi(t)||t===null)return e;if(t instanceof S$)return t;if(ilt(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?f7.instance:i==="utc"||i==="gmt"?Xa.utcInstance:Xa.parseSpecifier(i)||Hu.create(t)}else return Pw(t)?Xa.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new Jot(t)}const kce={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},Tbe={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Qot=kce.hanidec.replace(/[\[|\]]/g,"").split("");function Xot(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(kce.hanidec)!==-1)e+=Qot.indexOf(t[i]);else for(const s in Tbe){const[n,a]=Tbe[s];r>=n&&r<=a&&(e+=r-n)}}return parseInt(e,10)}else return e}const Ate=new Map;function Kot(){Ate.clear()}function Hp({numberingSystem:t},e=""){const i=t||"latn";let r=Ate.get(i);r===void 0&&(r=new Map,Ate.set(i,r));let s=r.get(e);return s===void 0&&(s=new RegExp(`${kce[i]}${e}`),r.set(e,s)),s}let $be=()=>Date.now(),Cbe="system",Mbe=null,Ebe=null,Abe=null,Obe=60,Pbe,Rbe=null;class Qn{static get now(){return $be}static set now(e){$be=e}static set defaultZone(e){Cbe=e}static get defaultZone(){return iw(Cbe,f7.instance)}static get defaultLocale(){return Mbe}static set defaultLocale(e){Mbe=e}static get defaultNumberingSystem(){return Ebe}static set defaultNumberingSystem(e){Ebe=e}static get defaultOutputCalendar(){return Abe}static set defaultOutputCalendar(e){Abe=e}static get defaultWeekSettings(){return Rbe}static set defaultWeekSettings(e){Rbe=Ote(e)}static get twoDigitCutoffYear(){return Obe}static set twoDigitCutoffYear(e){Obe=e%100}static get throwOnInvalid(){return Pbe}static set throwOnInvalid(e){Pbe=e}static resetCaches(){os.resetCache(),Hu.resetCache(),gt.resetCache(),Kot()}}class Uf{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const jDe=[0,31,59,90,120,151,181,212,243,273,304,334],UDe=[0,31,60,91,121,152,182,213,244,274,305,335];function cp(t,e){return new Uf("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Lce(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function BDe(t,e,i){return i+(uF(t)?UDe:jDe)[e-1]}function qDe(t,e){const i=uF(t)?UDe:jDe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function Fce(t,e){return(t-e+7)%7+1}function Tq(t,e=4,i=1){const{year:r,month:s,day:n}=t,a=BDe(r,s,n),o=Fce(Lce(r,s,n),i);let l=Math.floor((a-o+14-e)/7),u;return l<1?(u=r-1,l=k5(u,e,i)):l>k5(r,e,i)?(u=r+1,l=1):u=r,{weekYear:u,weekNumber:l,weekday:o,...v7(t)}}function Ibe(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,a=Fce(Lce(r,1,e),i),o=jE(r);let l=s*7+n-a-7+e,u;l<1?(u=r-1,l+=jE(u)):l>o?(u=r+1,l-=jE(r)):u=r;const{month:d,day:f}=qDe(u,l);return{year:u,month:d,day:f,...v7(t)}}function hJ(t){const{year:e,month:i,day:r}=t,s=BDe(e,i,r);return{year:e,ordinal:s,...v7(t)}}function Dbe(t){const{year:e,ordinal:i}=t,{month:r,day:s}=qDe(e,i);return{year:e,month:r,day:s,...v7(t)}}function kbe(t,e){if(!gi(t.localWeekday)||!gi(t.localWeekNumber)||!gi(t.localWeekYear)){if(!gi(t.weekday)||!gi(t.weekNumber)||!gi(t.weekYear))throw new nE("Cannot mix locale-based week fields with ISO-based week fields");return gi(t.localWeekday)||(t.weekday=t.localWeekday),gi(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),gi(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function elt(t,e=4,i=1){const r=m7(t.weekYear),s=up(t.weekNumber,1,k5(t.weekYear,e,i)),n=up(t.weekday,1,7);return r?s?n?!1:cp("weekday",t.weekday):cp("week",t.weekNumber):cp("weekYear",t.weekYear)}function tlt(t){const e=m7(t.year),i=up(t.ordinal,1,jE(t.year));return e?i?!1:cp("ordinal",t.ordinal):cp("year",t.year)}function GDe(t){const e=m7(t.year),i=up(t.month,1,12),r=up(t.day,1,$q(t.year,t.month));return e?i?r?!1:cp("day",t.day):cp("month",t.month):cp("year",t.year)}function HDe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=up(e,0,23)||e===24&&i===0&&r===0&&s===0,a=up(i,0,59),o=up(r,0,59),l=up(s,0,999);return n?a?o?l?!1:cp("millisecond",s):cp("second",r):cp("minute",i):cp("hour",e)}function gi(t){return typeof t>"u"}function Pw(t){return typeof t=="number"}function m7(t){return typeof t=="number"&&t%1===0}function ilt(t){return typeof t=="string"}function rlt(t){return Object.prototype.toString.call(t)==="[object Date]"}function WDe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function ZDe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function slt(t){return Array.isArray(t)?t:[t]}function Lbe(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function nlt(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function SO(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ote(t){if(t==null)return null;if(typeof t!="object")throw new Nl("Week settings must be an object");if(!up(t.firstDay,1,7)||!up(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!up(e,1,7)))throw new Nl("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function up(t,e,i){return m7(t)&&t>=e&&t<=i}function alt(t,e){return t-e*Math.floor(t/e)}function Za(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function Bb(t){if(!(gi(t)||t===null||t===""))return parseInt(t,10)}function hx(t){if(!(gi(t)||t===null||t===""))return parseFloat(t)}function zce(t){if(!(gi(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Nce(t,e,i="round"){const r=10**e;switch(i){case"expand":return t>0?Math.ceil(t*r)/r:Math.floor(t*r)/r;case"trunc":return Math.trunc(t*r)/r;case"round":return Math.round(t*r)/r;case"floor":return Math.floor(t*r)/r;case"ceil":return Math.ceil(t*r)/r;default:throw new RangeError(`Value rounding ${i} is out of range`)}}function uF(t){return t%4===0&&(t%100!==0||t%400===0)}function jE(t){return uF(t)?366:365}function $q(t,e){const i=alt(e-1,12)+1,r=t+(e-i)/12;return i===2?uF(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function g7(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function Fbe(t,e,i){return-Fce(Lce(t,1,e),i)+e-1}function k5(t,e=4,i=1){const r=Fbe(t,e,i),s=Fbe(t+1,e,i);return(jE(t)-r+s)/7}function Pte(t){return t>99?t:t>Qn.twoDigitCutoffYear?1900+t:2e3+t}function YDe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const a={timeZoneName:e,...n},o=new Intl.DateTimeFormat(i,a).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return o?o.value:null}function y7(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function JDe(t){const e=Number(t);if(typeof t=="boolean"||t===""||!Number.isFinite(e))throw new Nl(`Invalid unit value ${t}`);return e}function Cq(t,e){const i={};for(const r in t)if(SO(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=JDe(s)}return i}function g4(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Za(i,2)}:${Za(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Za(i,2)}${Za(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function v7(t){return nlt(t,["hour","minute","second","millisecond"])}const olt=["January","February","March","April","May","June","July","August","September","October","November","December"],QDe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],llt=["J","F","M","A","M","J","J","A","S","O","N","D"];function XDe(t){switch(t){case"narrow":return[...llt];case"short":return[...QDe];case"long":return[...olt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const KDe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],eke=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],clt=["M","T","W","T","F","S","S"];function tke(t){switch(t){case"narrow":return[...clt];case"short":return[...eke];case"long":return[...KDe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const ike=["AM","PM"],ult=["Before Christ","Anno Domini"],hlt=["BC","AD"],dlt=["B","A"];function rke(t){switch(t){case"narrow":return[...dlt];case"short":return[...hlt];case"long":return[...ult];default:return null}}function plt(t){return ike[t.hour<12?0:1]}function flt(t,e){return tke(e)[t.weekday-1]}function mlt(t,e){return XDe(e)[t.month-1]}function glt(t,e){return rke(e)[t.year<0?0:1]}function ylt(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const f=t==="days";switch(e){case 1:return f?"tomorrow":`next ${s[t][0]}`;case-1:return f?"yesterday":`last ${s[t][0]}`;case 0:return f?"today":`this ${s[t][0]}`}}const a=Object.is(e,-0)||e<0,o=Math.abs(e),l=o===1,u=s[t],d=r?l?u[1]:u[2]||u[1]:l?s[t][0]:t;return a?`${o} ${d} ago`:`in ${o} ${d}`}function zbe(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const vlt={D:Sq,DD:bDe,DDD:wDe,DDDD:xDe,t:SDe,tt:TDe,ttt:$De,tttt:CDe,T:MDe,TT:EDe,TTT:ADe,TTTT:ODe,f:PDe,ff:IDe,fff:kDe,ffff:FDe,F:RDe,FF:DDe,FFF:LDe,FFFF:zDe};class Wl{static create(e,i={}){return new Wl(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let a=0;a<e.length;a++){const o=e.charAt(a);o==="'"?((r.length>0||s)&&n.push({literal:s||/^\s+$/.test(r),val:r===""?"'":r}),i=null,r="",s=!s):s||o===i?r+=o:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=o,i=o)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return vlt[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0,r=void 0){if(this.opts.forceSimple)return Za(e,i);const s={...this.opts};return i>0&&(s.padTo=i),r&&(s.signDisplay=r),this.loc.numberFormatter(s).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(v,_)=>this.loc.extract(e,v,_),a=v=>e.isOffsetFixed&&e.offset===0&&v.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,v.format):"",o=()=>r?plt(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(v,_)=>r?mlt(e,v):n(_?{month:v}:{month:v,day:"numeric"},"month"),u=(v,_)=>r?flt(e,v):n(_?{weekday:v}:{weekday:v,month:"long",day:"numeric"},"weekday"),d=v=>{const _=Wl.macroTokenToFormatOpts(v);return _?this.formatWithSystemDefault(e,_):v},f=v=>r?glt(e,v):n({era:v},"era"),g=v=>{switch(v){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return a({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return a({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return u("short",!0);case"cccc":return u("long",!0);case"ccccc":return u("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return u("short",!1);case"EEEE":return u("long",!1);case"EEEEE":return u("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return f("short");case"GG":return f("long");case"GGGGG":return f("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return d(v)}};return zbe(Wl.parseFormat(i),g)}formatDurationFromString(e,i){const r=this.opts.signMode==="negativeLargestOnly"?-1:1,s=d=>{switch(d[0]){case"S":return"milliseconds";case"s":return"seconds";case"m":return"minutes";case"h":return"hours";case"d":return"days";case"w":return"weeks";case"M":return"months";case"y":return"years";default:return null}},n=(d,f)=>g=>{const v=s(g);if(v){const _=f.isNegativeDuration&&v!==f.largestUnit?r:1;let x;return this.opts.signMode==="negativeLargestOnly"&&v!==f.largestUnit?x="never":this.opts.signMode==="all"?x="always":x="auto",this.num(d.get(v)*_,g.length,x)}else return g},a=Wl.parseFormat(i),o=a.reduce((d,{literal:f,val:g})=>f?d:d.concat(g),[]),l=e.shiftTo(...o.map(s).filter(d=>d)),u={isNegativeDuration:l<0,largestUnit:Object.keys(l.values)[0]};return zbe(a,n(l,u))}}const ske=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function yP(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function vP(...t){return e=>t.reduce(([i,r,s],n)=>{const[a,o,l]=n(e,s);return[{...i,...a},o||r,l]},[{},null,1]).slice(0,2)}function _P(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function nke(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=Bb(e[i+s]);return[r,null,i+s]}}const ake=/(?:([Zz])|([+-]\d\d)(?::?(\d\d))?)/,_lt=`(?:${ake.source}?(?:\\[(${ske.source})\\])?)?`,Vce=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,oke=RegExp(`${Vce.source}${_lt}`),jce=RegExp(`(?:[Tt]${oke.source})?`),blt=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,wlt=/(\d{4})-?W(\d\d)(?:-?(\d))?/,xlt=/(\d{4})-?(\d{3})/,Slt=nke("weekYear","weekNumber","weekDay"),Tlt=nke("year","ordinal"),$lt=/(\d{4})-(\d\d)-(\d\d)/,lke=RegExp(`${Vce.source} ?(?:${ake.source}|(${ske.source}))?`),Clt=RegExp(`(?: ${lke.source})?`);function UE(t,e,i){const r=t[e];return gi(r)?i:Bb(r)}function Mlt(t,e){return[{year:UE(t,e),month:UE(t,e+1,1),day:UE(t,e+2,1)},null,e+3]}function bP(t,e){return[{hours:UE(t,e,0),minutes:UE(t,e+1,0),seconds:UE(t,e+2,0),milliseconds:zce(t[e+3])},null,e+4]}function hF(t,e){const i=!t[e]&&!t[e+1],r=y7(t[e+1],t[e+2]),s=i?null:Xa.instance(r);return[{},s,e+3]}function dF(t,e){const i=t[e]?Hu.create(t[e]):null;return[{},i,e+1]}const Elt=RegExp(`^T?${Vce.source}$`),Alt=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Olt(t){const[e,i,r,s,n,a,o,l,u]=t,d=e[0]==="-",f=l&&l[0]==="-",g=(v,_=!1)=>v!==void 0&&(_||v&&d)?-v:v;return[{years:g(hx(i)),months:g(hx(r)),weeks:g(hx(s)),days:g(hx(n)),hours:g(hx(a)),minutes:g(hx(o)),seconds:g(hx(l),l==="-0"),milliseconds:g(zce(u),f)}]}const Plt={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Uce(t,e,i,r,s,n,a){const o={year:e.length===2?Pte(Bb(e)):Bb(e),month:QDe.indexOf(i)+1,day:Bb(r),hour:Bb(s),minute:Bb(n)};return a&&(o.second=Bb(a)),t&&(o.weekday=t.length>3?KDe.indexOf(t)+1:eke.indexOf(t)+1),o}const Rlt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Ilt(t){const[,e,i,r,s,n,a,o,l,u,d,f]=t,g=Uce(e,s,r,i,n,a,o);let v;return l?v=Plt[l]:u?v=0:v=y7(d,f),[g,new Xa(v)]}function Dlt(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const klt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Llt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Flt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Nbe(t){const[,e,i,r,s,n,a,o]=t;return[Uce(e,s,r,i,n,a,o),Xa.utcInstance]}function zlt(t){const[,e,i,r,s,n,a,o]=t;return[Uce(e,o,i,r,s,n,a),Xa.utcInstance]}const Nlt=yP(blt,jce),Vlt=yP(wlt,jce),jlt=yP(xlt,jce),Ult=yP(oke),cke=vP(Mlt,bP,hF,dF),Blt=vP(Slt,bP,hF,dF),qlt=vP(Tlt,bP,hF,dF),Glt=vP(bP,hF,dF);function Hlt(t){return _P(t,[Nlt,cke],[Vlt,Blt],[jlt,qlt],[Ult,Glt])}function Wlt(t){return _P(Dlt(t),[Rlt,Ilt])}function Zlt(t){return _P(t,[klt,Nbe],[Llt,Nbe],[Flt,zlt])}function Ylt(t){return _P(t,[Alt,Olt])}const Jlt=vP(bP);function Qlt(t){return _P(t,[Elt,Jlt])}const Xlt=yP($lt,Clt),Klt=yP(lke),ect=vP(bP,hF,dF);function tct(t){return _P(t,[Xlt,cke],[Klt,ect])}const Vbe="Invalid Duration",uke={weeks:{days:7,hours:168,minutes:10080,seconds:10080*60,milliseconds:10080*60*1e3},days:{hours:24,minutes:1440,seconds:1440*60,milliseconds:1440*60*1e3},hours:{minutes:60,seconds:3600,milliseconds:3600*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},ict={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:2184*60,seconds:2184*60*60,milliseconds:2184*60*60*1e3},months:{weeks:4,days:30,hours:720,minutes:720*60,seconds:720*60*60,milliseconds:720*60*60*1e3},...uke},gd=146097/400,wC=146097/4800,rct={years:{quarters:4,months:12,weeks:gd/7,days:gd,hours:gd*24,minutes:gd*24*60,seconds:gd*24*60*60,milliseconds:gd*24*60*60*1e3},quarters:{months:3,weeks:gd/28,days:gd/4,hours:gd*24/4,minutes:gd*24*60/4,seconds:gd*24*60*60/4,milliseconds:gd*24*60*60*1e3/4},months:{weeks:wC/7,days:wC,hours:wC*24,minutes:wC*24*60,seconds:wC*24*60*60,milliseconds:wC*24*60*60*1e3},...uke},rS=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],sct=rS.slice(0).reverse();function Cy(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new kr(r)}function hke(t,e){let i=e.milliseconds??0;for(const r of sct.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function jbe(t,e){const i=hke(t,e)<0?-1:1;rS.reduceRight((r,s)=>{if(gi(e[s]))return r;if(r){const n=e[r]*i,a=t[s][r],o=Math.floor(n/a);e[s]+=o*i,e[r]-=o*a*i}return s},null),rS.reduce((r,s)=>{if(gi(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function Ube(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class kr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?rct:ict;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||os.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return kr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new Nl(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new kr({values:Cq(e,kr.normalizeUnit),loc:os.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(Pw(e))return kr.fromMillis(e);if(kr.isDuration(e))return e;if(typeof e=="object")return kr.fromObject(e);throw new Nl(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=Ylt(e);return r?kr.fromObject(r,i):kr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=Qlt(e);return r?kr.fromObject(r,i):kr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new Nl("need to specify a reason the Duration is invalid");const r=e instanceof Uf?e:new Uf(e,i);if(Qn.throwOnInvalid)throw new Oot(r);return new kr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new _De(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Wl.create(this.loc,r).formatDurationFromString(this,e):Vbe}toHuman(e={}){if(!this.isValid)return Vbe;const i=e.showZeros!==!1,r=rS.map(s=>{const n=this.values[s];return gi(n)||n===0&&!i?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:s.slice(0,-1)}).format(n)}).filter(s=>s);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Nce(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},gt.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?hke(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=kr.fromDurationLike(e),r={};for(const s of rS)(SO(i.values,s)||SO(this.values,s))&&(r[s]=i.get(s)+this.get(s));return Cy(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=kr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=JDe(e(this.values[r],r));return Cy(this,{values:i},!0)}get(e){return this[kr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...Cq(e,kr.normalizeUnit)};return Cy(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const a={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return Cy(this,a)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return jbe(this.matrix,e),Cy(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Ube(this.normalize().shiftToAll().toObject());return Cy(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(a=>kr.normalizeUnit(a));const i={},r={},s=this.toObject();let n;for(const a of rS)if(e.indexOf(a)>=0){n=a;let o=0;for(const u in r)o+=this.matrix[u][a]*r[u],r[u]=0;Pw(s[a])&&(o+=s[a]);const l=Math.trunc(o);i[a]=l,r[a]=(o*1e3-l*1e3)/1e3}else Pw(s[a])&&(r[a]=s[a]);for(const a in r)r[a]!==0&&(i[n]+=a===n?r[a]:r[a]/this.matrix[n][a]);return jbe(this.matrix,i),Cy(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return Cy(this,{values:e},!0)}removeZeros(){if(!this.isValid)return this;const e=Ube(this.values);return Cy(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of rS)if(!i(this.values[r],e.values[r]))return!1;return!0}}const xC="Invalid Interval";function nct(t,e){return!t||!t.isValid?Wn.invalid("missing or invalid start"):!e||!e.isValid?Wn.invalid("missing or invalid end"):e<t?Wn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Wn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new Nl("need to specify a reason the Interval is invalid");const r=e instanceof Uf?e:new Uf(e,i);if(Qn.throwOnInvalid)throw new Aot(r);return new Wn({invalid:r})}static fromDateTimes(e,i){const r=BR(e),s=BR(i),n=nct(r,s);return n??new Wn({start:r,end:s})}static after(e,i){const r=kr.fromDurationLike(i),s=BR(e);return Wn.fromDateTimes(s,s.plus(r))}static before(e,i){const r=kr.fromDurationLike(i),s=BR(e);return Wn.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,a;try{n=gt.fromISO(r,i),a=n.isValid}catch{a=!1}let o,l;try{o=gt.fromISO(s,i),l=o.isValid}catch{l=!1}if(a&&l)return Wn.fromDateTimes(n,o);if(a){const u=kr.fromISO(s,i);if(u.isValid)return Wn.after(n,u)}else if(l){const u=kr.fromISO(r,i);if(u.isValid)return Wn.before(o,u)}}return Wn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i?.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?Wn.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(BR).filter(a=>this.contains(a)).sort((a,o)=>a.toMillis()-o.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const a=i[n]||this.e,o=+a>+this.e?this.e:a;r.push(Wn.fromDateTimes(s,o)),s=o,n+=1}return r}splitBy(e){const i=kr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const a=[];for(;r<this.e;){const o=this.start.plus(i.mapUnits(l=>l*s));n=+o>+this.e?this.e:o,a.push(Wn.fromDateTimes(r,n)),r=n,s+=1}return a}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:Wn.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Wn.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],a)=>n?n.overlaps(a)||n.abutsStart(a)?[s,n.union(a)]:[s.concat([n]),a]:[s,a],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),a=Array.prototype.concat(...n),o=a.sort((l,u)=>l.time-u.time);for(const l of o)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Wn.fromDateTimes(i,l.time)),i=null);return Wn.merge(s)}difference(...e){return Wn.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:xC}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=Sq,i={}){return this.isValid?Wl.create(this.s.loc.clone(i),e).formatInterval(this):xC}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:xC}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:xC}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:xC}toFormat(e,{separator:i="  "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:xC}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):kr.invalid(this.invalidReason)}mapEndpoints(e){return Wn.fromDateTimes(e(this.s),e(this.e))}}class AN{static hasDST(e=Qn.defaultZone){const i=gt.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Hu.isValidZone(e)}static normalizeZone(e){return iw(e,Qn.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||os.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||os.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||os.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||os.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||os.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||os.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||os.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return os.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return os.create(i,null,"gregory").eras(e)}static features(){return{relative:WDe(),localeWeek:ZDe()}}}function Bbe(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(kr.fromMillis(r).as("days"))}function act(t,e,i){const r=[["years",(l,u)=>u.year-l.year],["quarters",(l,u)=>u.quarter-l.quarter+(u.year-l.year)*4],["months",(l,u)=>u.month-l.month+(u.year-l.year)*12],["weeks",(l,u)=>{const d=Bbe(l,u);return(d-d%7)/7}],["days",Bbe]],s={},n=t;let a,o;for(const[l,u]of r)i.indexOf(l)>=0&&(a=l,s[l]=u(t,e),o=n.plus(s),o>e?(s[l]--,t=n.plus(s),t>e&&(o=t,s[l]--,t=n.plus(s))):t=o);return[t,s,o,a]}function oct(t,e,i,r){let[s,n,a,o]=act(t,e,i);const l=e-s,u=i.filter(f=>["hours","minutes","seconds","milliseconds"].indexOf(f)>=0);u.length===0&&(a<e&&(a=s.plus({[o]:1})),a!==s&&(n[o]=(n[o]||0)+l/(a-s)));const d=kr.fromObject(n,r);return u.length>0?kr.fromMillis(l,r).shiftTo(...u).plus(d):d}const lct="missing Intl.DateTimeFormat.formatToParts support";function Xr(t,e=i=>i){return{regex:t,deser:([i])=>e(Xot(i))}}const cct="",dke=`[ ${cct}]`,pke=new RegExp(dke,"g");function uct(t){return t.replace(/\./g,"\\.?").replace(pke,dke)}function qbe(t){return t.replace(/\./g,"").replace(pke," ").toLowerCase()}function Wp(t,e){return t===null?null:{regex:RegExp(t.map(uct).join("|")),deser:([i])=>t.findIndex(r=>qbe(i)===qbe(r))+e}}function Gbe(t,e){return{regex:t,deser:([,i,r])=>y7(i,r),groups:e}}function ON(t){return{regex:t,deser:([e])=>e}}function hct(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function dct(t,e){const i=Hp(e),r=Hp(e,"{2}"),s=Hp(e,"{3}"),n=Hp(e,"{4}"),a=Hp(e,"{6}"),o=Hp(e,"{1,2}"),l=Hp(e,"{1,3}"),u=Hp(e,"{1,6}"),d=Hp(e,"{1,9}"),f=Hp(e,"{2,4}"),g=Hp(e,"{4,6}"),v=S=>({regex:RegExp(hct(S.val)),deser:([T])=>T,literal:!0}),x=(S=>{if(t.literal)return v(S);switch(S.val){case"G":return Wp(e.eras("short"),0);case"GG":return Wp(e.eras("long"),0);case"y":return Xr(u);case"yy":return Xr(f,Pte);case"yyyy":return Xr(n);case"yyyyy":return Xr(g);case"yyyyyy":return Xr(a);case"M":return Xr(o);case"MM":return Xr(r);case"MMM":return Wp(e.months("short",!0),1);case"MMMM":return Wp(e.months("long",!0),1);case"L":return Xr(o);case"LL":return Xr(r);case"LLL":return Wp(e.months("short",!1),1);case"LLLL":return Wp(e.months("long",!1),1);case"d":return Xr(o);case"dd":return Xr(r);case"o":return Xr(l);case"ooo":return Xr(s);case"HH":return Xr(r);case"H":return Xr(o);case"hh":return Xr(r);case"h":return Xr(o);case"mm":return Xr(r);case"m":return Xr(o);case"q":return Xr(o);case"qq":return Xr(r);case"s":return Xr(o);case"ss":return Xr(r);case"S":return Xr(l);case"SSS":return Xr(s);case"u":return ON(d);case"uu":return ON(o);case"uuu":return Xr(i);case"a":return Wp(e.meridiems(),0);case"kkkk":return Xr(n);case"kk":return Xr(f,Pte);case"W":return Xr(o);case"WW":return Xr(r);case"E":case"c":return Xr(i);case"EEE":return Wp(e.weekdays("short",!1),1);case"EEEE":return Wp(e.weekdays("long",!1),1);case"ccc":return Wp(e.weekdays("short",!0),1);case"cccc":return Wp(e.weekdays("long",!0),1);case"Z":case"ZZ":return Gbe(new RegExp(`([+-]${o.source})(?::(${r.source}))?`),2);case"ZZZ":return Gbe(new RegExp(`([+-]${o.source})(${r.source})?`),2);case"z":return ON(/[a-z_+-/]{1,256}?/i);case" ":return ON(/[^\S\n\r]/);default:return v(S)}})(t)||{invalidReason:lct};return x.token=t,x}const pct={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function fct(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let a=r;r==="hour"&&(e.hour12!=null?a=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?a="hour12":a="hour24":a=i.hour12?"hour12":"hour24");let o=pct[a];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function mct(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function gct(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const a in i)if(SO(i,a)){const o=i[a],l=o.groups?o.groups+1:1;!o.literal&&o.token&&(s[o.token.val[0]]=o.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function yct(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return gi(t.z)||(i=Hu.create(t.z)),gi(t.Z)||(i||(i=new Xa(t.Z)),r=t.Z),gi(t.q)||(t.M=(t.q-1)*3+1),gi(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),gi(t.u)||(t.S=zce(t.u)),[Object.keys(t).reduce((n,a)=>{const o=e(a);return o&&(n[o]=t[a]),n},{}),i,r]}let dJ=null;function vct(){return dJ||(dJ=gt.fromMillis(1555555555555)),dJ}function _ct(t,e){if(t.literal)return t;const i=Wl.macroTokenToFormatOpts(t.val),r=yke(i,e);return r==null||r.includes(void 0)?t:r}function fke(t,e){return Array.prototype.concat(...t.map(i=>_ct(i,e)))}class mke{constructor(e,i){if(this.locale=e,this.format=i,this.tokens=fke(Wl.parseFormat(i),e),this.units=this.tokens.map(r=>dct(r,e)),this.disqualifyingUnit=this.units.find(r=>r.invalidReason),!this.disqualifyingUnit){const[r,s]=mct(this.units);this.regex=RegExp(r,"i"),this.handlers=s}}explainFromTokens(e){if(this.isValid){const[i,r]=gct(e,this.regex,this.handlers),[s,n,a]=r?yct(r):[null,null,void 0];if(SO(r,"a")&&SO(r,"H"))throw new nE("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:i,matches:r,result:s,zone:n,specificOffset:a}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function gke(t,e,i){return new mke(t,i).explainFromTokens(e)}function bct(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:a}=gke(t,e,i);return[r,s,n,a]}function yke(t,e){if(!t)return null;const r=Wl.create(e,t).dtFormatter(vct()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(a=>fct(a,t,n))}const pJ="Invalid DateTime",Hbe=864e13;function pD(t){return new Uf("unsupported zone",`the zone "${t.name}" is not supported`)}function fJ(t){return t.weekData===null&&(t.weekData=Tq(t.c)),t.weekData}function mJ(t){return t.localWeekData===null&&(t.localWeekData=Tq(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function dx(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new gt({...i,...e,old:i})}function vke(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function PN(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function X6(t,e,i){return vke(g7(t),e,i)}function Wbe(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,$q(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},a=kr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),o=g7(n);let[l,u]=vke(o,i,t.zone);return a!==0&&(l+=a,u=t.zone.offset(l)),{ts:l,o:u}}function SC(t,e,i,r,s,n){const{setZone:a,zone:o}=i;if(t&&Object.keys(t).length!==0||e){const l=e||o,u=gt.fromObject(t,{...i,zone:l,specificOffset:n});return a?u:u.setZone(o)}else return gt.invalid(new Uf("unparsable",`the input "${s}" can't be parsed as ${r}`))}function RN(t,e,i=!0){return t.isValid?Wl.create(os.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function gJ(t,e,i){const r=t.c.year>9999||t.c.year<0;let s="";if(r&&t.c.year>=0&&(s+="+"),s+=Za(t.c.year,r?6:4),i==="year")return s;if(e){if(s+="-",s+=Za(t.c.month),i==="month")return s;s+="-"}else if(s+=Za(t.c.month),i==="month")return s;return s+=Za(t.c.day),s}function Zbe(t,e,i,r,s,n,a){let o=!i||t.c.millisecond!==0||t.c.second!==0,l="";switch(a){case"day":case"month":case"year":break;default:if(l+=Za(t.c.hour),a==="hour")break;if(e){if(l+=":",l+=Za(t.c.minute),a==="minute")break;o&&(l+=":",l+=Za(t.c.second))}else{if(l+=Za(t.c.minute),a==="minute")break;o&&(l+=Za(t.c.second))}if(a==="second")break;o&&(!r||t.c.millisecond!==0)&&(l+=".",l+=Za(t.c.millisecond,3))}return s&&(t.isOffsetFixed&&t.offset===0&&!n?l+="Z":t.o<0?(l+="-",l+=Za(Math.trunc(-t.o/60)),l+=":",l+=Za(Math.trunc(-t.o%60))):(l+="+",l+=Za(Math.trunc(t.o/60)),l+=":",l+=Za(Math.trunc(t.o%60)))),n&&(l+="["+t.zone.ianaName+"]"),l}const _ke={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},wct={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},xct={ordinal:1,hour:0,minute:0,second:0,millisecond:0},K6=["year","month","day","hour","minute","second","millisecond"],Sct=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Tct=["year","ordinal","hour","minute","second","millisecond"];function eU(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new _De(t);return e}function Ybe(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return eU(t)}}function $ct(t){if(fD===void 0&&(fD=Qn.now()),t.type!=="iana")return t.offset(fD);const e=t.name;let i=Rte.get(e);return i===void 0&&(i=t.offset(fD),Rte.set(e,i)),i}function Jbe(t,e){const i=iw(e.zone,Qn.defaultZone);if(!i.isValid)return gt.invalid(pD(i));const r=os.fromObject(e);let s,n;if(gi(t.year))s=Qn.now();else{for(const l of K6)gi(t[l])&&(t[l]=_ke[l]);const a=GDe(t)||HDe(t);if(a)return gt.invalid(a);const o=$ct(i);[s,n]=X6(t,o,i)}return new gt({ts:s,zone:i,loc:r,o:n})}function Qbe(t,e,i){const r=gi(i.round)?!0:i.round,s=gi(i.rounding)?"trunc":i.rounding,n=(o,l)=>(o=Nce(o,r||i.calendary?0:2,i.calendary?"round":s),e.loc.clone(i).relFormatter(i).format(o,l)),a=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return n(a(i.unit),i.unit);for(const o of i.units){const l=a(o);if(Math.abs(l)>=1)return n(l,o)}return n(t>e?-0:0,i.units[i.units.length-1])}function Xbe(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}let fD;const Rte=new Map;class gt{constructor(e){const i=e.zone||Qn.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Uf("invalid input"):null)||(i.isValid?null:pD(i));this.ts=gi(e.ts)?Qn.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const o=Pw(e.o)&&!e.old?e.o:i.offset(this.ts);s=PN(this.ts,o),r=Number.isNaN(s.year)?new Uf("invalid input"):null,s=r?null:s,n=r?null:o}this._zone=i,this.loc=e.loc||os.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new gt({})}static local(){const[e,i]=Xbe(arguments),[r,s,n,a,o,l,u]=i;return Jbe({year:r,month:s,day:n,hour:a,minute:o,second:l,millisecond:u},e)}static utc(){const[e,i]=Xbe(arguments),[r,s,n,a,o,l,u]=i;return e.zone=Xa.utcInstance,Jbe({year:r,month:s,day:n,hour:a,minute:o,second:l,millisecond:u},e)}static fromJSDate(e,i={}){const r=rlt(e)?e.valueOf():NaN;if(Number.isNaN(r))return gt.invalid("invalid input");const s=iw(i.zone,Qn.defaultZone);return s.isValid?new gt({ts:r,zone:s,loc:os.fromObject(i)}):gt.invalid(pD(s))}static fromMillis(e,i={}){if(Pw(e))return e<-Hbe||e>Hbe?gt.invalid("Timestamp out of range"):new gt({ts:e,zone:iw(i.zone,Qn.defaultZone),loc:os.fromObject(i)});throw new Nl(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(Pw(e))return new gt({ts:e*1e3,zone:iw(i.zone,Qn.defaultZone),loc:os.fromObject(i)});throw new Nl("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=iw(i.zone,Qn.defaultZone);if(!r.isValid)return gt.invalid(pD(r));const s=os.fromObject(i),n=Cq(e,Ybe),{minDaysInFirstWeek:a,startOfWeek:o}=kbe(n,s),l=Qn.now(),u=gi(i.specificOffset)?r.offset(l):i.specificOffset,d=!gi(n.ordinal),f=!gi(n.year),g=!gi(n.month)||!gi(n.day),v=f||g,_=n.weekYear||n.weekNumber;if((v||d)&&_)throw new nE("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(g&&d)throw new nE("Can't mix ordinal dates with month/day");const x=_||n.weekday&&!v;let S,T,M=PN(l,u);x?(S=Sct,T=wct,M=Tq(M,a,o)):d?(S=Tct,T=xct,M=hJ(M)):(S=K6,T=_ke);let E=!1;for(const N of S){const B=n[N];gi(B)?E?n[N]=T[N]:n[N]=M[N]:E=!0}const P=x?elt(n,a,o):d?tlt(n):GDe(n),O=P||HDe(n);if(O)return gt.invalid(O);const D=x?Ibe(n,a,o):d?Dbe(n):n,[L,F]=X6(D,u,r),j=new gt({ts:L,zone:r,o:F,loc:s});return n.weekday&&v&&e.weekday!==j.weekday?gt.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${j.toISO()}`):j.isValid?j:gt.invalid(j.invalid)}static fromISO(e,i={}){const[r,s]=Hlt(e);return SC(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=Wlt(e);return SC(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=Zlt(e);return SC(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(gi(e)||gi(i))throw new Nl("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,a=os.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[o,l,u,d]=bct(a,e,i);return d?gt.invalid(d):SC(o,l,r,`format ${i}`,e,u)}static fromString(e,i,r={}){return gt.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=tct(e);return SC(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new Nl("need to specify a reason the DateTime is invalid");const r=e instanceof Uf?e:new Uf(e,i);if(Qn.throwOnInvalid)throw new Eot(r);return new gt({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=yke(e,os.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return fke(Wl.parseFormat(e),os.fromObject(i)).map(s=>s.val).join("")}static resetCache(){fD=void 0,Rte.clear()}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?fJ(this).weekYear:NaN}get weekNumber(){return this.isValid?fJ(this).weekNumber:NaN}get weekday(){return this.isValid?fJ(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?mJ(this).weekday:NaN}get localWeekNumber(){return this.isValid?mJ(this).weekNumber:NaN}get localWeekYear(){return this.isValid?mJ(this).weekYear:NaN}get ordinal(){return this.isValid?hJ(this.c).ordinal:NaN}get monthShort(){return this.isValid?AN.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?AN.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?AN.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?AN.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=g7(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),a=this.zone.offset(r-s*i),o=this.zone.offset(r-n*i);if(a===o)return[this];const l=r-a*i,u=r-o*i,d=PN(l,a),f=PN(u,o);return d.hour===f.hour&&d.minute===f.minute&&d.second===f.second&&d.millisecond===f.millisecond?[dx(this,{ts:l}),dx(this,{ts:u})]:[this]}get isInLeapYear(){return uF(this.year)}get daysInMonth(){return $q(this.year,this.month)}get daysInYear(){return this.isValid?jE(this.year):NaN}get weeksInWeekYear(){return this.isValid?k5(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?k5(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=Wl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(Xa.instance(e),i)}toLocal(){return this.setZone(Qn.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=iw(e,Qn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),a=this.toObject();[s]=X6(a,n,e)}return dx(this,{ts:s,zone:e})}else return gt.invalid(pD(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return dx(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=Cq(e,Ybe),{minDaysInFirstWeek:r,startOfWeek:s}=kbe(i,this.loc),n=!gi(i.weekYear)||!gi(i.weekNumber)||!gi(i.weekday),a=!gi(i.ordinal),o=!gi(i.year),l=!gi(i.month)||!gi(i.day),u=o||l,d=i.weekYear||i.weekNumber;if((u||a)&&d)throw new nE("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&a)throw new nE("Can't mix ordinal dates with month/day");let f;n?f=Ibe({...Tq(this.c,r,s),...i},r,s):gi(i.ordinal)?(f={...this.toObject(),...i},gi(i.day)&&(f.day=Math.min($q(f.year,f.month),f.day))):f=Dbe({...hJ(this.c),...i});const[g,v]=X6(f,this.o,this.zone);return dx(this,{ts:g,o:v})}plus(e){if(!this.isValid)return this;const i=kr.fromDurationLike(e);return dx(this,Wbe(this,i))}minus(e){if(!this.isValid)return this;const i=kr.fromDurationLike(e).negate();return dx(this,Wbe(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=kr.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:a}=this;a<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?Wl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):pJ}toLocaleString(e=Sq,i={}){return this.isValid?Wl.create(this.loc.clone(i),e).formatDateTime(this):pJ}toLocaleParts(e={}){return this.isValid?Wl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1,precision:a="milliseconds"}={}){if(!this.isValid)return null;a=eU(a);const o=e==="extended";let l=gJ(this,o,a);return K6.indexOf(a)>=3&&(l+="T"),l+=Zbe(this,o,i,r,s,n,a),l}toISODate({format:e="extended",precision:i="day"}={}){return this.isValid?gJ(this,e==="extended",eU(i)):null}toISOWeekDate(){return RN(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:a="extended",precision:o="milliseconds"}={}){return this.isValid?(o=eU(o),(s&&K6.indexOf(o)>=3?"T":"")+Zbe(this,a==="extended",i,e,r,n,o)):null}toRFC2822(){return RN(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return RN(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?gJ(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),RN(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():pJ}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return kr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=slt(i).map(kr.normalizeUnit),a=e.valueOf()>this.valueOf(),o=a?this:e,l=a?e:this,u=oct(o,l,n,s);return a?u.negate():u}diffNow(e="milliseconds",i={}){return this.diff(gt.now(),e,i)}until(e){return this.isValid?Wn.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||gt.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Qbe(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Qbe(e.base||gt.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(gt.isDateTime))throw new Nl("min requires all arguments be DateTimes");return Lbe(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(gt.isDateTime))throw new Nl("max requires all arguments be DateTimes");return Lbe(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,a=os.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return gke(a,e,i)}static fromStringExplain(e,i,r={}){return gt.fromFormatExplain(e,i,r)}static buildFormatParser(e,i={}){const{locale:r=null,numberingSystem:s=null}=i,n=os.fromOpts({locale:r,numberingSystem:s,defaultToEN:!0});return new mke(n,e)}static fromFormatParser(e,i,r={}){if(gi(e)||gi(i))throw new Nl("fromFormatParser requires an input string and a format parser");const{locale:s=null,numberingSystem:n=null}=r,a=os.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});if(!a.equals(i.locale))throw new Nl(`fromFormatParser called with a locale of ${a}, but the format parser was created for ${i.locale}`);const{result:o,zone:l,specificOffset:u,invalidReason:d}=i.explainFromTokens(e);return d?gt.invalid(d):SC(o,l,r,`format ${i.format}`,e,u)}static get DATE_SHORT(){return Sq}static get DATE_MED(){return bDe}static get DATE_MED_WITH_WEEKDAY(){return Pot}static get DATE_FULL(){return wDe}static get DATE_HUGE(){return xDe}static get TIME_SIMPLE(){return SDe}static get TIME_WITH_SECONDS(){return TDe}static get TIME_WITH_SHORT_OFFSET(){return $De}static get TIME_WITH_LONG_OFFSET(){return CDe}static get TIME_24_SIMPLE(){return MDe}static get TIME_24_WITH_SECONDS(){return EDe}static get TIME_24_WITH_SHORT_OFFSET(){return ADe}static get TIME_24_WITH_LONG_OFFSET(){return ODe}static get DATETIME_SHORT(){return PDe}static get DATETIME_SHORT_WITH_SECONDS(){return RDe}static get DATETIME_MED(){return IDe}static get DATETIME_MED_WITH_SECONDS(){return DDe}static get DATETIME_MED_WITH_WEEKDAY(){return Rot}static get DATETIME_FULL(){return kDe}static get DATETIME_FULL_WITH_SECONDS(){return LDe}static get DATETIME_HUGE(){return FDe}static get DATETIME_HUGE_WITH_SECONDS(){return zDe}}function BR(t){if(gt.isDateTime(t))return t;if(t&&t.valueOf&&Pw(t.valueOf()))return gt.fromJSDate(t);if(t&&typeof t=="object")return gt.fromObject(t);throw new Nl(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const Cct="shortOffset";function Mct(t){return"timeZoneIANA"in t}function Ect(t){return t.startsWith("UTC")}function Mq(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?tU(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?Act(i):null}}}}}function tU(t,e=xp){return t?Mct(t)?t.timeZoneIANA:Oct(t,e):e}function Act(t){return{timeZoneIANA:t}}function Oct(t,e=xp){if(!t||!xbe.has(t.timeZone))return e;const i=xbe.get(t.timeZone);return Ect(t.timeZone)||t.respectsDaylightSaving?i:Pct(i)}function Pct(t){const e=gt.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${Xa.instance(-i).formatOffset(0,"narrow")}`}function roi(t,e,i,r,s){if(e&&s==="date")return{timeZone:a1,timeZoneName:void 0};const n=r.hour,a=i===n1;return{timeZone:a?s==="timestamp-offset"?void 0:t??a1:i,timeZoneName:a&&n?Cct:void 0}}function Rct(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));return t===xp||t===n1||e.has(t.toLowerCase())||i.has(t.toLowerCase())}const Ict={dateStyle:void 0,year:void 0,month:void 0,day:void 0,weekday:void 0},Dct={timeStyle:void 0,hour12:void 0,hourCycle:void 0,hour:void 0,minute:void 0,second:void 0},bke={timeZone:a1},Pm={year:"numeric",month:"numeric",day:"numeric"},qR={year:"numeric",month:"long",day:"numeric"},GR={year:"numeric",month:"short",day:"numeric"},HR={year:"numeric",month:"long",weekday:"long",day:"numeric"},qb={hour:"numeric",minute:"numeric"},Hx={...qb,second:"numeric"},wke={hourCycle:"h23"},WR={...qb,...wke},ZR={...Hx,...wke},xke={"short-date":Pm,"short-date-short-time":{...Pm,...qb},"short-date-short-time-24":{...Pm,...WR},"short-date-long-time":{...Pm,...Hx},"short-date-long-time-24":{...Pm,...ZR},"short-date-le":Pm,"short-date-le-short-time":{...Pm,...qb},"short-date-le-short-time-24":{...Pm,...WR},"short-date-le-long-time":{...Pm,...Hx},"short-date-le-long-time-24":{...Pm,...ZR},"long-month-day-year":qR,"long-month-day-year-short-time":{...qR,...qb},"long-month-day-year-short-time-24":{...qR,...WR},"long-month-day-year-long-time":{...qR,...Hx},"long-month-day-year-long-time-24":{...qR,...ZR},"day-short-month-year":GR,"day-short-month-year-short-time":{...GR,...qb},"day-short-month-year-short-time-24":{...GR,...WR},"day-short-month-year-long-time":{...GR,...Hx},"day-short-month-year-long-time-24":{...GR,...ZR},"long-date":HR,"long-date-short-time":{...HR,...qb},"long-date-short-time-24":{...HR,...WR},"long-date-long-time":{...HR,...Hx},"long-date-long-time-24":{...HR,...ZR},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":qb,"long-time":Hx},kct=so()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Ske={ar:"ar-u-nu-latn-ca-gregory",nn:"no-NN"},Lct=new Intl.DateTimeFormat("bs",{month:"long"}).formatToParts(new Date(2025,2)),Fct=Lct.find(({type:t})=>t==="month")?.value.toLowerCase();function Tke(){const t=Rce();return(t&&Ske[t])??yDe()}Fct!=="mart"&&(Ske.bs="sr-Latn-CS");let Ite=new WeakMap;const _7=xke["short-date-short-time"];function zct(t){let e=Ite.get(t);if(!e){const i=Tke(),r=Bce(t.timeZone??xp),s={...t,timeZone:r};e=new Intl.DateTimeFormat(i,s),Ite.set(t,e)}return e}function Nct(t){return xke[t]}function soi(t){const{dateStyle:e,timeStyle:i,hour12:r,year:s,month:n}=t,a={};return e?a.dateStyle=e:s&&(a.year=s,a.month=n||void 0),i&&!a.year&&(a.timeStyle=i,a.hour12=r==="auto"?void 0:r==="always"),a}function o1(t,e=_7){return zct(e).format(t)}function noi(t,e=_7){return o1(new Date(t),{...e,...bke,...Dct})}function aoi(t,e=_7){return o1(new Date(`1970-01-01T${t}Z`),{...e,...bke,...Ict})}function ooi(t,e=_7){if(e.timeZone)return o1(new Date(t),e);const i=gt.fromISO(t,{setZone:!0}),r=i.offset===0?a1:e.timeZone,s={...e,timeZone:r};return i.toLocaleString(s,{locale:Tke()})}function Bce(t){switch(t){case xp:return Mot;case n1:return a1;default:return t}}Dce(()=>{Ite=new WeakMap});const Vct={ar:"ar-u-nu-latn",bs:"sr-Latn-CS",nn:"no-NN"};let iU=new WeakMap,$ke={};function Dte(t){const e=t||$ke;if(!iU.has(e)){const i=Rce(),r=i&&Vct[i]||yDe();iU.set(e,new Intl.NumberFormat(r,t))}return iU.get(e)}function loi(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function coi(t){const{minimumFractionDigits:e,maximumFractionDigits:i,useGrouping:r}=t;return{minimumFractionDigits:e,maximumFractionDigits:i,useGrouping:r==="auto"?"auto":r==="always"}}function k0(t,e){return Object.is(t,-0)&&(t=0),Dte(e).format(t)}function uoi(t,e=Vu()){if(!t)return null;let i=Kbe.get(e);if(!i){const r=Dte().formatToParts(12345.6),s=[...Dte({useGrouping:!1}).format(9876543210)].reverse(),n=new Map(s.map((f,g)=>[f,g])),a=new RegExp(`[${r.find(f=>f.type==="group")?.value}]`,"g"),o=new RegExp(`[${r.find(f=>f.type==="decimal")?.value}]`),l=new RegExp(`[${s.join("")}]`,"g"),u=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,d=/[-\u2212\u2013\u2014\u2015]/g;i=f=>{if((f=f.trim().replaceAll(a,"").replace(o,".").replace(l,v=>String(n.get(v))).replaceAll(u,"").replaceAll(d,"-"))==="")return null;const g=Number(f);return isNaN(g)?null:g},Kbe.set(e,i)}return i(t)}Dce(()=>{iU=new WeakMap,$ke={}});const Kbe=new Map,Cke=()=>re.getLogger("esri.intl.substitute");function jct(t,e,i={}){const{format:r={}}=i;return Q0(t,s=>Uct(s,e,r))}function Uct(t,e,i){let r,s;const n=t.indexOf(":");if(n===-1?r=t.trim():(r=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!r)return"";const a=jL(r,e);if(a==null)return"";const o=(s?i?.[s]:null)??i?.[r];return o?Bct(a,o):s?qct(a,s):qce(a)}function Bct(t,e){switch(e.type){case"date":return o1(t,e.intlOptions);case"number":return k0(t,e.intlOptions);default:return Cke().warn("missing format descriptor for key {key}"),qce(t)}}function qct(t,e){switch(e.toLowerCase()){case"dateformat":return o1(t);case"numberformat":return k0(t);default:return Cke().warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?o1(t):/^numberformat/i.test(e)?k0(t):qce(t)}}function qce(t){switch(typeof t){case"string":return t;case"number":return k0(t);case"boolean":return""+t;default:return t instanceof Date?o1(t):""}}const Mke={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Gct(t){return t in Mke}function ewe(t){if(Gct(t)){const e=Mke[t];return e===!0?t:e}return null}const mD=[],BE=new Map;function twe(t){for(const e of BE.keys())Ake(t.pattern,e)&&BE.delete(e)}function Hct(t){return mD.includes(t)||(twe(t),mD.unshift(t)),bi(()=>{const e=mD.indexOf(t);e>-1&&(mD.splice(e,1),twe(t))})}async function Gce(t){const e=Vu();BE.has(t)||BE.set(t,Wct(t,e));const i=BE.get(t);return i&&await Zct.add(i),i}function Eke(t){const e=Rce(t);return e?ewe(t)??ewe(e):null}async function Wct(t,e){const i=[];for(const r of mD)if(Ake(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new q("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new q("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Ake(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}Dce(()=>{BE.clear()});const Zct=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Eo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function Yct(t,e,i,r){const s=e.exec(i);if(!s)throw new q("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",a=s[2],o=Eke(r),l=`${n}${a}.json`,u=o?`${n}${a}_${o}.json`:l;let d;try{d=await iwe(t(u))}catch(f){if(u===l)throw new q("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f});try{d=await iwe(t(l))}catch(g){throw new q("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:g})}}return d}async function iwe(t){if(rwe.fetchBundleAsset!=null)return rwe.fetchBundleAsset(t);const e=await Si(t,{responseType:"text"});return JSON.parse(e.data)}let Jct=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return Yct(this.getAssetUrl,this.matcher,e,i)}};function Qct(t){return new Jct(t)}const rwe={};Hct(Qct({pattern:"esri/",location:Qs}));const swe={};function Xct(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages?.slice()||[],paths:{...swe.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=swe.baseUrl),e}let Kct=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},rU=class{constructor(){this._dispatcher=new Kct,this._workerPostMessage({type:w0.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){aO(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){aO(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=D5(e);if(i&&i.type===w0.OPEN){const{modulePath:r,jobId:s}=i;let n=await xO.loadWorker(r);n||(n=await import(r));const a=xO.connect(n);this._workerPostMessage({type:w0.OPENED,jobId:s,data:a})}}};const kte=()=>re.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:eut}=w0,tut='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}).finally(()=>{t&&t.removeEventListener("abort",s)})}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://esriurl.com/using-local-assets.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(e=>e||new Promise(e=>{require([o.modulePath],e)})).then(t)}):"System"in self&&"function"==typeof System.import?System.import(workerPath).then(e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath))).then(e=>e||System.import(o.modulePath)).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(e=>e||import(o.modulePath)).then(t)}):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let IN,DN;const nwe="Failed to create Worker. Fallback to execute module in main thread";async function iut(){if(!ie("esri-workers"))return awe(new rU);if(!IN&&!DN)try{const e=tut.split("{CONFIGURATION}").join(rut());IN=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){DN=e||{}}let t;if(IN)try{t=new Worker(IN,{name:"esri-worker-"+sut++})}catch{kte().warn(nwe,DN),t=new rU}else kte().warn(nwe,DN),t=new rU;return awe(t)}async function awe(t){return new Promise(e=>{function i(s){const n=D5(s);n&&n.type===eut&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),kte().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new rU).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function rut(){let t;if(fr.default!=null){const s={...fr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(fr));t.assetsPath=ku(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?ku(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Vu(),t.has={"esri-csp-restrictions":ie("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ie("esri-2d-update-debug"),"esri-2d-log-updating":ie("esri-2d-log-updating"),"featurelayer-pbf":ie("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":ie("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":ie("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ie("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ie("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":ie("featurelayer-query-max-depth"),"featurelayer-query-tile-max-features":ie("featurelayer-query-tile-max-features"),"featurelayer-query-tile-concurrency":ie("featurelayer-query-tile-concurrency"),"featurelayer-query-pausing-enabled":ie("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-concurrency":ie("featurelayer-snapshot-concurrency"),"featurelayer-snapshot-enabled":ie("featurelayer-snapshot-enabled"),"parquetlayer-full-query-feature-count":ie("parquetlayer-full-query-feature-count"),"esri-atomics":ie("esri-atomics"),"esri-shared-array-buffer":ie("esri-shared-array-buffer"),"esri-tiles-debug":ie("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ie("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ie("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=ku(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=ku(t.workers.workerPath):t.workers.workerPath=ku(Qs("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=fr.workers.loaderConfig,i=Xct({baseUrl:e?.baseUrl,locale:Vu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:ORe,fullVersion:tce,revision:PRe}})}let sut=0;const{ABORT:owe,INVOKE:nut,OPEN:aut,OPENED:out,RESPONSE:YR}=w0;let lut=class Oke{static async create(e){const i=await iut();return new Oke(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),re.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=fDe();return new Promise((n,a)=>{const o={resolve:n,reject:a,abortHandle:GL(r,()=>{this._outJobs.delete(s),this._post({type:owe,jobId:s})})};this._outJobs.set(s,o),this._post({type:aut,jobId:s,modulePath:e})})}_onMessage(e){const i=D5(e);if(i)switch(i.type){case out:this._onOpenedMessage(i);break;case YR:this._onResponseMessage(i);break;case owe:this._onAbortMessage(i);break;case nut:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,a=n?new AbortController:null,o=this._inJobs,l=Tot[i];let u;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);u=l.call(null,s,{signal:a?a.signal:null})}catch(d){return void this._post({type:YR,jobId:r,error:xq(d)})}Ea(u)?(o.set(r,{controller:a,promise:u}),u.then(d=>{o.has(r)&&(o.delete(r),this._post({type:YR,jobId:r},d))},d=>{o.has(r)&&(o.delete(r),d||(d={message:"Error encountered at method"+i}),Zr(d)||this._post({type:YR,jobId:r,error:xq(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:YR,jobId:r},u)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Xi(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Xi(n.abortHandle),r?n.reject(q.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return mDe(this.worker,e,i,r)}};const lwe=ie("host-browser")?Math.min(navigator.hardwareConcurrency-1,ie("workers-pool-size")??8):0;let sS=ie("esri-mobile")?Math.min(lwe,3):lwe;sS||(sS=ie("safari")&&ie("mac")?7:2);let cwe=0;const sU=[];function Pke(){Ike()}async function kN(t,e){const i=new Sot,{registryTarget:r,...s}=e;return await i.open(t,s),r&&fot(r,i),i}async function Rke(t,e={}){if(typeof t!="string")throw new q("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(ie("host-webworker")&&!ie("esri-workers")&&(i="local"),i==="local"){let r=await xO.loadWorker(t);r||(r=await import(t)),ct(e.signal);const s=e.client||r;return kN([xO.connect(r,e.schedule)],{...e,client:s})}if(await Ike(),ct(e.signal),i==="dedicated"){const r=cwe++%sS;return kN([await sU[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,sS);if(r<sS){const s=new Array(r);for(let n=0;n<r;++n){const a=cwe++%sS;s[n]=sU[a].open(t,e)}return kN(s,e)}}return kN(sU.map(r=>r.open(t,e)),e)}let LN=null;async function Ike(){if(LN)return LN;new AbortController;const t=[];for(let e=0;e<sS;e++){const i=lut.create(e).then(r=>(sU[e]=r,r));t.push(i)}return LN=Promise.all(t),LN}function ju(t,e,i=ke){return e||(e=new i),e===t||e.destroyed||(e.removeAll(),cut(t)?e.addMany(t):t&&e.add(t)),e}function b7(t){return t}function cut(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}let y4=class extends ke{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){this.destroyed||e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ke.ofType(this.itemType.Type))(e):new ke(e)}};function L5(t,e){return{type:t,cast:b7,set(i){const r=ju(i,this._get(e),t);r&&!r.destroyed&&(r.owner=this),this._set(e,r)}}}c([p()],y4.prototype,"owner",null),y4=c([R("esri.core.support.OwningCollection")],y4);function I(){return[0,0,0]}function Tr(t){return[t[0],t[1],t[2]]}function Ye(t,e,i){return[t,e,i]}function l1(t,e,i){return[t,e,i]}function F5(t,e=I()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function c1(){return I()}function nS(){return Ye(1,1,1)}function Dke(){return Ye(1,0,0)}function kke(){return Ye(0,1,0)}function Hce(){return Ye(0,0,1)}const Aa=c1(),Wce=nS(),Zce=Dke(),Yce=kke(),L0=Hce();Object.freeze(Object.defineProperty({__proto__:null,ONES:Wce,UNIT_X:Zce,UNIT_Y:Yce,UNIT_Z:L0,ZEROS:Aa,clone:Tr,create:I,freeze:l1,fromArray:F5,fromValues:Ye,ones:nS,unitX:Dke,unitY:kke,unitZ:Hce,zeros:c1},Symbol.toStringTag,{value:"Module"}));var Lte;let OM=Lte=class extends be{constructor(t){super(t),this.isInverse=!1,this.wkt=null,this.wkid=null}getInverse(){return new Lte({isInverse:!this.isInverse,wkid:this.wkid,wkt:this.wkt})}};c([p()],OM.prototype,"isInverse",void 0),c([p()],OM.prototype,"wkt",void 0),c([p()],OM.prototype,"wkid",void 0),OM=Lte=c([R("esri.geometry.operators.support.GeographicTransformationStep")],OM);var Fte;let v4=Fte=class extends be{constructor(t){super(t),this.steps=[]}getInverse(){const t=new Fte;for(let e=this.steps.length-1;e>=0;e--){const i=this.steps[e];t.steps.push(i.getInverse())}return t}};c([p({type:[OM],nonNullable:!0})],v4.prototype,"steps",void 0),v4=Fte=c([R("esri.geometry.operators.support.GeographicTransformation")],v4);const Rc=Math.PI/180,uut=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,G_=Ci.radius,Zp=Ci.eccentricitySquared,hut={a1:G_*Zp,a2:G_*Zp*G_*Zp,a3:G_*Zp*Zp/2,a4:G_*Zp*G_*Zp*2.5,a5:G_*Zp+G_*Zp*Zp/2,a6:1-Zp},dut={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Ci.radius,f:Ci.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:O0.radius,f:O0.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Xf.radius,f:Xf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Xf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}},gD={2:{5:Zs,7:null,9:null,10:Zs,1:HE,6:null,8:null,0:null,3:OS,11:PS,2:Zs,4:IS},5:{5:Zs,7:null,9:null,10:Zs,1:HE,6:null,8:null,0:null,3:OS,11:PS,2:Zs,4:IS},7:{5:null,7:Zs,9:null,10:Zs,1:null,6:Nte,8:null,0:null,3:null,11:null,2:null,4:null},9:{5:null,7:null,9:Zs,10:Zs,1:null,6:null,8:zte,0:null,3:null,11:null,2:null,4:null},3:{5:qE,7:null,9:null,10:qE,1:Fke,6:null,8:null,0:null,3:Zs,11:Nke,2:qE,4:zke},4:{5:DS,7:null,9:null,10:DS,1:Uke,6:null,8:null,0:null,3:Bke,11:fut,2:DS,4:Zs},1:{5:RS,7:null,9:null,10:RS,1:Zs,6:null,8:null,0:null,3:Vke,11:mut,2:RS,4:jke},6:{5:null,7:jte,9:null,10:jte,1:null,6:Zs,8:null,0:null,3:null,11:null,2:null,4:null},8:{5:null,7:null,9:Vte,10:Vte,1:null,6:null,8:Zs,0:null,3:null,11:null,2:null,4:null},0:{5:null,7:null,9:null,10:null,1:null,6:null,8:null,0:Zs,3:null,11:null,2:null,4:null},10:{5:Zs,7:Zs,9:Zs,10:Zs,1:HE,6:Nte,8:zte,0:null,3:OS,11:PS,2:Zs,4:IS},11:{5:GE,7:null,9:null,10:GE,1:gut,6:null,8:null,0:null,3:yut,11:Zs,2:GE,4:vut}};function e$(t,e){return Lke(t,e)?.projector}function Lke(t,e){if(t==null||e==null)return null;if(My.source.spatialReference===t&&My.dest.spatialReference===e)return My;const i=uwe(t,My.source),r=uwe(e,My.dest);return i===0&&r===0?zr(t,e)?My.projector=Zs:My.projector=null:My.projector=gD[i][r],My}function moi(t,e){switch(e$(t,e)){case Zs:return"copy3";case HE:return"wgs84ToSphericalECEF";case OS:return"wgs84ToWebMercator";case PS:return"wgs84ToPlateCarree";case IS:return"wgs84ToWGS84ECEF";case qE:return"webMercatorToWGS84";case Fke:return"webMercatorToSphericalECEF";case zke:return"webMercatorToWGS84ECEF";case Nke:return"webMercatorToPlateCarree";case DS:return"wgs84ECEFToWGS84";case Uke:return"wgs84ECEFToSphericalECEF";case Bke:return"wgs84ECEFToWebMercator";case RS:return"sphericalECEFToWGS84";case Vke:return"sphericalECEFToWebMercator";case jte:return"sphericalMarsPCPFToMars2000";case Vte:return"sphericalMoonPCPFToMoon2000";case jke:return"sphericalECEFToWGS84ECEF";case Nte:return"mars2000ToSphericalPCPF";case zte:return"moon2000ToSphericalPCPF";default:return null}}function uwe(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Yr(t,1)),A5(t)?e.spatialReferenceId=1:P0(t)?e.spatialReferenceId=2:Kh(t)?e.spatialReferenceId=3:E5(t)?e.spatialReferenceId=11:t.wkt===iIe.wkt?e.spatialReferenceId=4:t.wkid===4490?e.spatialReferenceId=5:t.wkt===s7.wkt?e.spatialReferenceId=6:t.wkt===n7.wkt?e.spatialReferenceId=8:XL(t)?e.spatialReferenceId=7:KL(t)?e.spatialReferenceId=9:e.spatialReferenceId=0):0}function Zs(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function qE(t,e,i,r){i[r]=$O*(t[e]/kS),i[r+1]=$O*(qke-2*Math.atan(Math.exp(-t[e+1]/kS))),i[r+2]=t[e+2]}function Fke(t,e,i,r){const s=t[e]/kS,n=qke-2*Math.atan(Math.exp(-t[e+1]/kS)),a=kS+t[e+2],o=Math.cos(n)*a;i[r]=Math.cos(s)*o,i[r+1]=Math.sin(s)*o,i[r+2]=Math.sin(n)*a}function zke(t,e,i,r){qE(t,e,i,r),IS(i,r,i,r)}function put(t,e,i,r,s){const n=.4999999*Math.PI,a=Ce(TO*t[e+1],-n,n),o=Math.sin(a);i[r++]=TO*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+o)/(1-o)),i[r]=t[e+2]}function OS(t,e,i,r){put(t,e,i,r,Ci)}function PS(t,e,i,r){i[r]=t[e]*hwe,i[r+1]=t[e+1]*hwe,i[r+2]=t[e+2]}function GE(t,e,i,r){i[r]=t[e]*dwe,i[r+1]=t[e+1]*dwe,i[r+2]=t[e+2]}function Nke(t,e,i,r){qE(t,e,i,r),PS(i,r,i,r)}function fut(t,e,i,r){DS(t,e,i,r),PS(i,r,i,r)}function mut(t,e,i,r){RS(t,e,i,r),PS(i,r,i,r)}function gut(t,e,i,r){GE(t,e,i,r),HE(i,r,i,r)}function yut(t,e,i,r){GE(t,e,i,r),OS(i,r,i,r)}function vut(t,e,i,r){GE(t,e,i,r),IS(i,r,i,r)}function Jce(t,e,i,r,s){const n=s+t[e+2],a=TO*t[e+1],o=TO*t[e],l=Math.cos(a)*n;i[r]=Math.cos(o)*l,i[r+1]=Math.sin(o)*l,i[r+2]=Math.sin(a)*n}function zte(t,e,i,r){Jce(t,e,i,r,O0.radius)}function Nte(t,e,i,r){Jce(t,e,i,r,Xf.radius)}function HE(t,e,i,r){Jce(t,e,i,r,Ci.radius)}function Qce(t,e,i,r,s){const n=t[e],a=t[e+1],o=t[e+2],l=Math.sqrt(n*n+a*a+o*o),u=Qh(o/(l===0?1:l)),d=Math.atan2(a,n);i[r++]=$O*d,i[r++]=$O*u,i[r]=l-s}function Vte(t,e,i,r){Qce(t,e,i,r,O0.radius)}function jte(t,e,i,r){Qce(t,e,i,r,Xf.radius)}function RS(t,e,i,r){Qce(t,e,i,r,Ci.radius)}function Vke(t,e,i,r){RS(t,e,i,r),OS(i,r,i,r)}function jke(t,e,i,r){RS(t,e,i,r),IS(i,r,i,r)}function _ut(t,e,i,r,s){const n=TO*t[e],a=TO*t[e+1],o=t[e+2],l=Math.sin(a),u=Math.cos(a),d=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(d+o)*u*Math.cos(n),i[r++]=(d+o)*u*Math.sin(n),i[r++]=(d*(1-s.eccentricitySquared)+o)*l}function IS(t,e,i,r){_ut(t,e,i,r,Ci)}function DS(t,e,i,r){const s=hut,n=t[e],a=t[e+1],o=t[e+2];let l,u,d,f,g,v,_,x,S,T,M,E,P,O,D,L,F,j,N,B,U;l=Math.abs(o),u=n*n+a*a,d=Math.sqrt(u),f=u+o*o,g=Math.sqrt(f),B=Math.atan2(a,n),v=o*o/f,_=u/f,O=s.a2/g,D=s.a3-s.a4/g,_>.3?(x=l/g*(1+_*(s.a1+O+v*D)/g),N=Math.asin(x),T=x*x,S=Math.sqrt(1-T)):(S=d/g*(1-v*(s.a5-O-_*D)/g),N=Math.acos(S),T=1-S*S,x=Math.sqrt(T)),M=1-Ci.eccentricitySquared*T,E=Ci.radius/Math.sqrt(M),P=s.a6*E,O=d-E*S,D=l-P*x,F=S*O+x*D,L=S*D-x*O,j=L/(P/M+F),N+=j,U=F+L*j/2,o<0&&(N=-N),i[r++]=$O*B,i[r++]=$O*N,i[r]=U}function Uke(t,e,i,r){DS(t,e,i,r),HE(i,r,i,r)}function Bke(t,e,i,r){DS(t,e,i,r),OS(i,r,i,r)}const My={source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:Zs},TO=zt(1),$O=to(1),qke=.5*Math.PI,kS=Ci.radius,hwe=kS*Math.PI/180,dwe=180/(kS*Math.PI);function io(t,e,i,r,s,n,a=Math.floor(t.length/3)){const o=e$(e,s);if(o==null)return!1;if(o===Zs){if(t===r&&i===n)return!0;const u=i+3*a;for(let d=i,f=n;d<u;d++,f++)r[f]=t[d];return!0}const l=i+3*a;for(let u=i,d=n;u<l;u+=3,d+=3)o(t,u,r,d);return!0}const goi=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:io},Symbol.toStringTag,{value:"Module"}));function pwe(t,e,i,r,s,n){return FN[0]=t,FN[1]=e,FN[2]=i,io(FN,r,0,s,n,0)}const FN=I();function Gke(t,e,i){if(e==null||i==null||i.vcsWkid||zr(e,i)||i1(e)||i1(i))return null;const r=ed(e)/ed(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>but(s,r);case"polyline":case"esriGeometryPolyline":return s=>xut(s,r);case"polygon":case"esriGeometryPolygon":return s=>wut(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>Sut(s,r);case"extent":case"esriGeometryEnvelope":return s=>Tut(s,r);default:return null}}function but(t,e){t?.z!=null&&(t.z*=e)}function wut(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function xut(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function Sut(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function Tut(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let _4=null,z5=null,N5=null,CO=null,Ute={};const Xce=new d$;function ry(){return!!(z5?.isLoaded()&&N5?.isLoaded()&&CO?.isLoaded())}function Hke(){return!!ry()||(Mt(Xce),F0(),!1)}function rw(t,e){return!t||!e||Zc(t,e)||Hke()}function Wke(t,e){return!Zc(t,e)&&!ry()}async function F0(t){_4==null&&(_4=Promise.all([W(()=>import("./projectOperator-BcyDhCTk.js"),__vite__mapDeps([106,107,66])).then(e=>(z5=e,z5.load())),W(()=>import("./projectOperator-7vW72XhM.js"),__vite__mapDeps([108,107,66])).then(e=>(N5=e,N5.load())),W(()=>import("./geographicTransformationUtils-DgDOeYif.js"),[]).then(e=>(CO=e,CO.load()))])),await _4,ct(t),Xce.notify()}function Pa(t,e,i){return Array.isArray(t)?t.length===0?[]:(hnt(t),Bte(t,t[0].spatialReference,e,i)):(fO(t),Bte([t],t.spatialReference,e,i)[0])}function Bte(t,e,i,r){if(e==null||i==null)return t;if(Zc(e,i,r))return t.map(s=>b4(s,e,i));if(r?.geographicTransformation==null&&A5(e))return t.map(s=>b4(s,e,Me.WGS84)).map(s=>u1(s,i));if(r?.geographicTransformation==null&&A5(i))return t.map(s=>u1(s,Me.WGS84)).map(s=>b4(s,Me.WGS84,i));if(!ry())throw new Yke;if(!r?.geographicTransformation){if(r?.extendedParams)r={...r,geographicTransformation:CO.getTransformation(e,i,r.areaOfInterestExtent)||new v4};else if(!r?.areaOfInterestExtent){const s=$ut(e,i);let n=Ute[s];n||(n=CO.getTransformation(e,i)||new v4,Ute[s]=n),r={geographicTransformation:n}}}return t[0].spatialReference||(t[0].spatialReference=e),t[0]instanceof Qa?z5.executeMany(t,i,r):N5.executeMany(t,i,r)}function $ut(t,e){return[t.wkid?.toString()??"-1",t.wkt?.toString()??"",t.wkt2?.toString()??"",e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??""].join()}function Cut(t,e){const i=Zke([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function Zke(t,e){if(!ry()){for(const i of t)if(i!=null&&!zr(i.spatialReference,e)&&jh(i.spatialReference)&&jh(e)&&!Zc(i.spatialReference,e))return Mt(Xce),{pending:F0(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:zr(i.spatialReference,e)?i:jh(i.spatialReference)&&jh(e)?u1(i,e):null)}}let Yke=class extends q{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function Mut(){_4=null,z5=null,N5=null,CO=null,Ute={}}const Eut={get loadPromise(){return _4}};function u1(t,e){try{const i=Pa(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=Gke(i.type,t.spatialReference,e);return r?.(i),i}catch(i){if(!(i instanceof Yke))throw i;return null}}async function z0(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await om(r,e,null,i),u1(t,e)}function Zc(t,e,i){return!(i?.areaOfInterestExtent||i?.extendedParams||i?.geographicTransformation)&&(!!zr(t,e)||jh(t)&&jh(e)&&!!e$(t,e))}function Aut(t,e){if(zr(t,e))return!0;if(!jh(t)||!jh(e))return!1;const i=P0(t)||Kh(t)||M5(t),r=P0(e)||Kh(e)||M5(e);return i&&r}async function om(t,e,i,r){if(ry())return f_e(r);if(Array.isArray(t)){for(const{source:s,dest:n,options:a}of t)if(s&&n&&!Zc(s,n,a))return F0(r)}else if(t&&e&&!Zc(t,e,i))return F0(r);return f_e(r)}function b4(t,e,i){return t?"x"in t?Qke(t,e,new Ue,i,0):"xmin"in t?i4e(t,e,new It,i,0):"rings"in t?t4e(t,e,new Wr,i,0):"paths"in t?Kke(t,e,new gs,i,0):"points"in t?Xke(t,e,new Ho,i,0):null:null}function Jke(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&Qke(t,t.spatialReference,e,i,r)!=null}function Qke(t,e,i,r,s){Vl[0]=t.x,Vl[1]=t.y;const n=t.z;return Vl[2]=n!==void 0?n:s,io(Vl,e,0,Vl,r,0)?(i.x=Vl[0],i.y=Vl[1],i.spatialReference=r,n!==void 0||i1(r)?(i.z=Vl[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function Out(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&Xke(t,t.spatialReference,e,i,r)!=null}function Xke(t,e,i,r,s){const{points:n,hasZ:a,hasM:o}=t,l=[],u=n.length,d=[];for(const g of n)d.push(g[0],g[1],a?g[2]:s);if(!io(d,e,0,d,r,0,u))return null;const f=a||i1(r);for(let g=0;g<u;++g){const v=3*g,_=d[v],x=d[v+1];f&&o?l.push([_,x,d[v+2],n[g][3]]):f?l.push([_,x,d[v+2]]):o?l.push([_,x,n[g][2]]):l.push([_,x])}return i.points=l,i.spatialReference=r,i.hasZ=a,i.hasM=o,i}function Put(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&Kke(t,t.spatialReference,e,i,r)!=null}function Kke(t,e,i,r,s){const{paths:n,hasZ:a,hasM:o}=t,l=[];if(!r4e(n,a??!1,o??!1,e,l,r,s))return null;const u=a||i1(r);return i.paths=l,i.spatialReference=r,i.hasZ=u,i.hasM=o,i}function e4e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&t4e(t,t.spatialReference,e,i,r)!=null}function t4e(t,e,i,r,s){const{rings:n,hasZ:a,hasM:o}=t,l=[];if(!r4e(n,a??!1,o??!1,e,l,r,s))return null;const u=a||i1(r);return i.rings=l,i.spatialReference=r,i.hasZ=u,i.hasM=o,i}function Rut(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&i4e(t,t.spatialReference,e,i,r)!=null}function i4e(t,e,i,r,s){const{xmin:n,ymin:a,xmax:o,ymax:l,hasZ:u,hasM:d}=t,f=u?t.zmin:s;if(!pwe(n,a,f,e,Vl,r))return null;const g=u||i1(r);i.xmin=Vl[0],i.ymin=Vl[1],g&&(i.zmin=Vl[2]);const v=u?t.zmax:s;return pwe(o,l,v,e,Vl,r)?(i.xmax=Vl[0],i.ymax=Vl[1],g&&(i.zmax=Vl[2]),d&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function r4e(t,e,i,r,s,n,a=0){const o=new Array;for(const d of t)for(const f of d)o.push(f[0],f[1],e?f[2]:a);if(!io(o,r,0,o,n,0))return!1;let l=0;s.length=0;const u=e||i1(n);for(const d of t){const f=new Array;for(const g of d)u&&i?f.push([o[l++],o[l++],o[l++],g[3]]):u?f.push([o[l++],o[l++],o[l++]]):i?(f.push([o[l++],o[l++],g[2]]),l++):(f.push([o[l++],o[l++]]),l++);s.push(f)}return!0}const Vl=I(),voi=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:Zc,initializeProjection:om,isEqualBaseGCS:Aut,isLoaded:ry,isLoadedOrLoad:Hke,isLoadedOrLoadFor:rw,load:F0,project:Pa,projectExtent:Rut,projectMany:Bte,projectMultipoint:Out,projectOrLoad:Cut,projectOrLoadMany:Zke,projectPoint:Jke,projectPolygon:e4e,projectPolyline:Put,projectWithZConversion:z0,projectWithoutEngine:b4,requiresLoad:Wke,test:Eut,tryProjectWithZConversion:u1,unload:Mut},Symbol.toStringTag,{value:"Module"}));var qte,vA;let ba=(vA=class extends ae{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new qte({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}},qte=vA,vA);c([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],ba.prototype,"cols",void 0),c([p({type:vi,json:{write:!0}})],ba.prototype,"level",void 0),c([p({type:String,json:{write:!0}})],ba.prototype,"levelValue",void 0),c([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],ba.prototype,"origin",void 0),c([p({type:Number,json:{write:!0}})],ba.prototype,"resolution",void 0),c([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],ba.prototype,"rows",void 0),c([p({type:Number,json:{write:!0}})],ba.prototype,"scale",void 0),ba=qte=c([R("esri.layers.support.LOD")],ba);let pF=class s4e{constructor(e,i,r,s=fi()){this._level=e,this._row=i,this._col=r,this.extent=s}get id(){return this._id??=`${this.level}/${this.row}/${this.col}`,this._id}get level(){return this._level}set level(e){this._level=e,this._id=null}get row(){return this._row}set row(e){this._row=e,this._id=null}get col(){return this._col}set col(e){this._col=e,this._id=null}toJSON(){return{level:this._level,row:this._row,col:this._col,extent:this.extent}}static fromJSON(e){return new s4e(e.level,e.row,e.col,e.extent)}};var PM;const fwe=new ii({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});var _A;let _o=(_A=class extends ae{static create(e={}){const{resolutionFactor:i=1,scales:r,size:s=256,spatialReference:n=Me.WebMercator,numLODs:a=24}=e;if(!jh(n)){const g=[];if(r)for(let v=0;v<r.length;v++){const _=r[v];g.push(new ba({level:v,scale:_,resolution:_}))}else{let v=5e-4;for(let _=a-1;_>=0;_--)g.unshift(new ba({level:_,scale:v,resolution:v})),v*=2}return new PM({dpi:96,lods:g,origin:new Ue(0,0,n),size:[s,s],spatialReference:n})}const o=Xl(n),l=e.origin?new Ue({x:e.origin.x,y:e.origin.y,spatialReference:n}):new Ue(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),u=96,d=1/(Yr(n)*39.37*u),f=[];if(r)for(let g=0;g<r.length;g++){const v=r[g],_=v*d;f.push(new ba({level:g,scale:v,resolution:_}))}else{let g=A1(n)?512/s*5916575275917094e-7:256/s*591657527591555e-6;const v=Math.ceil(a/i);f.push(new ba({level:0,scale:g,resolution:g*d}));for(let _=1;_<v;_++){const x=g/2**i,S=x*d;f.push(new ba({level:_,scale:x,resolution:S})),g=x}}return new PM({dpi:u,lods:f,origin:l,size:[s,s],spatialReference:n})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:i}=this;if(e&&i){const r=Xl(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-i.x)<=r.dx}return!1}readOrigin(e,i){return Ue.fromJSON({spatialReference:i.spatialReference,...e})}set lods(e){let i=0,r=0;const s=[],n=this._levelToLOD={};e&&(i=-1/0,r=1/0,e.forEach(a=>{s.push(a.scale),i=a.scale>i?a.scale:i,r=a.scale<r?a.scale:r,n[a.level]=a})),this._set("scales",s),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,i){return[i.cols,i.rows]}writeSize(e,i){i.cols=e[0],i.rows=e[1]}zoomToScale(e){const i=this.scales;if(e<=0)return i[0];if(e>=i.length-1)return i[i.length-1];const r=Math.floor(e),s=r+1;return i[r]/(i[r]/i[s])**(e-r)}scaleToZoom(e){const i=this.scales,r=i.length-1;let s=0;for(;s<r;s++){const n=i[s],a=i[s+1];if(n<=e)return s;if(a===e)return s+1;if(n>e&&a<e)return s+Math.log(n/e)/Math.log(n/a)}return s}tileAt(e,i,r,s){const n=this.lodAt(e);if(!n)return null;let a,o;if(typeof i=="number")a=i,o=r;else if(zr(i.spatialReference,this.spatialReference))a=i.x,o=i.y,s=r;else{const d=eF(i,this.spatialReference);if(d==null)return null;a=d.x,o=d.y,s=r}const l=n.resolution*this.size[0],u=n.resolution*this.size[1];return s??=new pF(0,0,0),s.level=e,s.row=Math.floor((this.origin.y-o)/u+.001),s.col=Math.floor((a-this.origin.x)/l+.001),this.updateTileInfo(s),s}updateTileInfo(e,i=0){if(!("extent"in e))return!1;let r=this.lodAt(e.level);if(!r&&i===1){const o=this.lods[this.lods.length-1];o.level<e.level&&(r=o)}if(!r)return!1;const s=e.level-r.level,n=r.resolution*this.size[0]/2**s,a=r.resolution*this.size[1]/2**s;return e.extent[0]=this.origin.x+e.col*n,e.extent[1]=this.origin.y-(e.row+1)*a,e.extent[2]=e.extent[0]+n,e.extent[3]=e.extent[1]+a,!0}upsampleTile(e){const i=this._upsampleLevels[e.level];return!(!i||i.parentLevel===-1)&&(e.level=i.parentLevel,e.row=Math.floor(e.row/i.factor+.001),e.col=Math.floor(e.col/i.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,i){const r=this.lodAt(i.level);if(r==null)return null;const{resolution:s}=r,n=s*this.size[0],a=s*this.size[1];return e[0]=this.origin.x+i.col*n,e[1]=this.origin.y-(i.row+1)*a,e[2]=e[0]+n,e[3]=e[1]+a,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return PM.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||this.size[0]===256&&e===512)return null;const i=(this.size[0]===512&&e===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&i===0)return this;const r=[],s=this.lods.length-i;for(let n=0;n<s;n++){const a=n+i,{scale:o,resolution:l}=a>=0?this.lods[a]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};r.push(new ba({level:n,scale:o,resolution:l}))}return new PM({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let i=null;for(let r=0;r<e.length;r++){const s=e[r];this._upsampleLevels[s.level]={parentLevel:i?i.level:-1,factor:i?i.resolution/s.resolution:0},i=s}}},PM=_A,_A);c([p({type:Number,json:{write:!0}})],_o.prototype,"compressionQuality",void 0),c([p({type:Number,json:{write:!0}})],_o.prototype,"dpi",void 0),c([p({type:String,json:{read:fwe.read,write:fwe.write,origins:{"web-scene":{read:!1,write:!1}}}})],_o.prototype,"format",void 0),c([p({readOnly:!0})],_o.prototype,"isWrappable",null),c([p({type:Ue,json:{write:!0}})],_o.prototype,"origin",void 0),c([Oe("origin")],_o.prototype,"readOrigin",null),c([p({type:[ba],value:null,json:{write:!0}})],_o.prototype,"lods",null),c([p({readOnly:!0})],_o.prototype,"scales",void 0),c([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],_o.prototype,"size",void 0),c([Oe("size",["rows","cols"])],_o.prototype,"readSize",null),c([Ie("size",{cols:{type:vi},rows:{type:vi}})],_o.prototype,"writeSize",null),c([p({type:Me,json:{write:!0}})],_o.prototype,"spatialReference",void 0),_o=PM=c([R("esri.layers.support.TileInfo")],_o);let h1=class extends y4{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(re.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};h1=c([R("esri.support.AnalysesCollection")],h1);const nU={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},yJ={xsmall:544,small:768,medium:992,large:1200};function Iut(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function vJ(t,e){return e?nU[t].valueToClassName[e].split(" "):[]}const n4e=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=yJ}initialize(){this.addHandles(X(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Yt))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(r){if(r!==this._get("breakpoints")){if(!Iut(r)){const s=JSON.stringify(yJ,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s),r=yJ}this._set("breakpoints",{...r})}}_updateClassNames(){if(!this.container)return;const r=Lc.acquire(),s=Lc.acquire();let n,a=!1;for(n in nU){const o=this[n],l=nU[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==l&&(a=!0,this[n]=l,vJ(n,o).forEach(u=>s.push(u)),vJ(n,l).forEach(u=>r.push(u)))}a&&(this._applyClassNameChanges(r,s),Lc.release(r),Lc.release(s))}_applyClassNameChanges(r,s){const n=this.container;n&&(s.forEach(a=>n.classList.remove(a)),r.forEach(a=>n.classList.add(a)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let s;for(s in nU)vJ(s,this[s]).forEach(n=>r.classList.remove(n))}};return c([p()],i.prototype,"breakpoints",null),c([p()],i.prototype,"orientation",void 0),c([p()],i.prototype,"widthBreakpoint",void 0),c([p()],i.prototype,"heightBreakpoint",void 0),i=c([R("esri.views.BreakpointsOwner")],i),i};function w7(t){return typeof t=="string"?document.getElementById(t):t??null}function mwe(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let tm=class extends be{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,X)}addWhen(e,i,r={}){return this._installWatch(e,i,r,vs)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([tn(e,"after-changes",this._createSyncUpdatingCallback(),Ht),tn(e,"change",i,{onListenerAdd:r?a=>i({added:a.toArray(),removed:[]}):void 0,onListenerRemove:s?a=>i({added:[],removed:a.toArray()}):void 0})],n),bi(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(bi(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(zN)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const a=s(e,i,r);return this.addHandles(a,n),bi(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=X(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(zN),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(uP(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(zN))}),zN)}}};c([p({readOnly:!0})],tm.prototype,"updating",void 0),tm=c([R("esri.core.support.UpdatingHandles")],tm);const zN=-42;var Eq=function(){return Eq=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Eq.apply(this,arguments)},Gte={exports:{}},Fn={},Hte={exports:{}},T$={};function a4e(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function Dut(t,e,i){}function kut(t,e,i){}var Lut=/javascript\s*\:/img;function Fut(t,e){return Lut.test(e)?"":e}T$.whiteList=a4e();T$.getDefaultWhiteList=a4e;T$.onAttr=Dut;T$.onIgnoreAttr=kut;T$.safeAttrValue=Fut;var zut={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},JR=zut;function Nut(t,e){t=JR.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,a="";function o(){if(!r){var d=JR.trim(t.slice(s,n)),f=d.indexOf(":");if(f!==-1){var g=JR.trim(d.slice(0,f)),v=JR.trim(d.slice(f+1));if(g){var _=e(s,a.length,g,v,d);_&&(a+=_+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var u=t.indexOf("*/",n+2);if(u===-1)break;n=u+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||o():l===`
`&&o()}return JR.trim(a)}var Vut=Nut,NN=T$,jut=Vut;function gwe(t){return t==null}function Uut(t){var e={};for(var i in t)e[i]=t[i];return e}function o4e(t){t=Uut(t||{}),t.whiteList=t.whiteList||NN.whiteList,t.onAttr=t.onAttr||NN.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||NN.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||NN.safeAttrValue,this.options=t}o4e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,a=i.safeAttrValue,o=jut(t,function(l,u,d,f,g){var v=r[d],_=!1;if(v===!0?_=v:typeof v=="function"?_=v(f):v instanceof RegExp&&(_=v.test(f)),_!==!0&&(_=!1),f=a(d,f),!!f){var x={position:u,sourcePosition:l,source:g,isWhite:_};if(_){var S=s(d,f,x);return gwe(S)?d+":"+f:S}else{var S=n(d,f,x);if(!gwe(S))return S}}});return o};var But=o4e;(function(t,e){var i=T$,r=But;function s(a,o){var l=new r(o);return l.process(a)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(Hte,Hte.exports);var Kce=Hte.exports,eue={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},qut=Kce.FilterCSS,Gut=Kce.getDefaultWhiteList,Aq=eue;function l4e(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var c4e=new qut;function Hut(t,e,i){}function Wut(t,e,i){}function Zut(t,e,i){}function Yut(t,e,i){}function u4e(t){return t.replace(Qut,"&lt;").replace(Xut,"&gt;")}function Jut(t,e,i,r){if(i=g4e(i),e==="href"||e==="src"){if(i=Aq.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(VN.lastIndex=0,VN.test(i))return""}else if(e==="style"){if(ywe.lastIndex=0,ywe.test(i)||(vwe.lastIndex=0,vwe.test(i)&&(VN.lastIndex=0,VN.test(i))))return"";r!==!1&&(r=r||c4e,i=r.process(i))}return i=y4e(i),i}var Qut=/</g,Xut=/>/g,Kut=/"/g,eht=/&quot;/g,tht=/&#([a-zA-Z0-9]*);?/gim,iht=/&colon;?/gim,rht=/&newline;?/gim,VN=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,ywe=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,vwe=/u\s*r\s*l\s*\(.*/gi;function h4e(t){return t.replace(Kut,"&quot;")}function d4e(t){return t.replace(eht,'"')}function p4e(t){return t.replace(tht,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function f4e(t){return t.replace(iht,":").replace(rht," ")}function m4e(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return Aq.trim(e)}function g4e(t){return t=d4e(t),t=p4e(t),t=f4e(t),t=m4e(t),t}function y4e(t){return t=h4e(t),t=u4e(t),t}function sht(){return""}function nht(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(a){return i?!0:Aq.indexOf(t,a)!==-1}var s=[],n=!1;return{onIgnoreTag:function(a,o,l){if(r(a))if(l.isClosing){var u="[/removed]",d=l.position+u.length;return s.push([n!==!1?n:l.position,d]),n=!1,u}else return n||(n=l.position),"[removed]";else return e(a,o,l)},remove:function(a){var o="",l=0;return Aq.forEach(s,function(u){o+=a.slice(l,u[0]),l=u[1]}),o+=a.slice(l),o}}}function aht(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function oht(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}Fn.whiteList=l4e();Fn.getDefaultWhiteList=l4e;Fn.onTag=Hut;Fn.onIgnoreTag=Wut;Fn.onTagAttr=Zut;Fn.onIgnoreTagAttr=Yut;Fn.safeAttrValue=Jut;Fn.escapeHtml=u4e;Fn.escapeQuote=h4e;Fn.unescapeQuote=d4e;Fn.escapeHtmlEntities=p4e;Fn.escapeDangerHtml5Entities=f4e;Fn.clearNonPrintableCharacter=m4e;Fn.friendlyAttrValue=g4e;Fn.escapeAttrValue=y4e;Fn.onIgnoreTagStripAll=sht;Fn.StripTagBody=nht;Fn.stripCommentTag=aht;Fn.stripBlankChar=oht;Fn.cssFilter=c4e;Fn.getDefaultCSSWhiteList=Gut;var x7={},Gb=eue;function lht(t){var e=Gb.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=Gb.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function cht(t){return t.slice(0,2)==="</"}function uht(t,e,i){var r="",s=0,n=!1,a=!1,o=0,l=t.length,u="",d="";e:for(o=0;o<l;o++){var f=t.charAt(o);if(n===!1){if(f==="<"){n=o;continue}}else if(a===!1){if(f==="<"){r+=i(t.slice(s,o)),n=o,s=o;continue}if(f===">"){r+=i(t.slice(s,n)),d=t.slice(n,o+1),u=lht(d),r+=e(n,r.length,u,d,cht(d)),s=o+1,n=!1;continue}if(f==='"'||f==="'")for(var g=1,v=t.charAt(o-g);v.trim()===""||v==="=";){if(v==="="){a=f;continue e}v=t.charAt(o-++g)}}else if(f===a){a=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r}var hht=/[^a-zA-Z0-9\\_:.-]/gim;function dht(t,e){var i=0,r=0,s=[],n=!1,a=t.length;function o(g,v){if(g=Gb.trim(g),g=g.replace(hht,"").toLowerCase(),!(g.length<1)){var _=e(g,v||"");_&&s.push(_)}}for(var l=0;l<a;l++){var u=t.charAt(l),d,f;if(n===!1&&u==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:fht(t,l+1);continue}if(n!==!1&&l===r){if(f=t.indexOf(u,l+1),f===-1)break;d=Gb.trim(t.slice(r+1,f)),o(n,d),n=!1,l=f,i=l+1;continue}if(/\s|\n|\t/.test(u))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(f=pht(t,l),f===-1){d=Gb.trim(t.slice(i,l)),o(d),n=!1,i=l+1;continue}else{l=f-1;continue}else if(f=mht(t,l-1),f===-1){d=Gb.trim(t.slice(i,l)),d=_we(d),o(n,d),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?o(t.slice(i)):o(n,_we(Gb.trim(t.slice(i))))),Gb.trim(s.join(" "))}function pht(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function fht(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function mht(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function ght(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function _we(t){return ght(t)?t.substr(1,t.length-2):t}x7.parseTag=uht;x7.parseAttr=dht;var yht=Kce.FilterCSS,Tf=Fn,v4e=x7,vht=v4e.parseTag,_ht=v4e.parseAttr,aU=eue;function jN(t){return t==null}function bht(t){var e=aU.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=aU.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=aU.trim(t.slice(0,-1))),{html:t,closing:i}}function wht(t){var e={};for(var i in t)e[i]=t[i];return e}function xht(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function _4e(t){t=wht(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Tf.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=xht(t.whiteList||t.allowList):t.whiteList=Tf.whiteList,t.onTag=t.onTag||Tf.onTag,t.onTagAttr=t.onTagAttr||Tf.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Tf.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Tf.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Tf.safeAttrValue,t.escapeHtml=t.escapeHtml||Tf.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new yht(t.css))}_4e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,a=i.onTagAttr,o=i.onIgnoreTagAttr,l=i.safeAttrValue,u=i.escapeHtml,d=e.cssFilter;i.stripBlankChar&&(t=Tf.stripBlankChar(t)),i.allowCommentTag||(t=Tf.stripCommentTag(t));var f=!1;i.stripIgnoreTagBody&&(f=Tf.StripTagBody(i.stripIgnoreTagBody,n),n=f.onIgnoreTag);var g=vht(t,function(v,_,x,S,T){var M={sourcePosition:v,position:_,isClosing:T,isWhite:Object.prototype.hasOwnProperty.call(r,x)},E=s(x,S,M);if(!jN(E))return E;if(M.isWhite){if(M.isClosing)return"</"+x+">";var P=bht(S),O=r[x],D=_ht(P.html,function(L,F){var j=aU.indexOf(O,L)!==-1,N=a(x,L,F,j);return jN(N)?j?(F=l(x,L,F,d),F?L+'="'+F+'"':L):(N=o(x,L,F,j),jN(N)?void 0:N):N});return S="<"+x,D&&(S+=" "+D),P.closing&&(S+=" /"),S+=">",S}else return E=n(x,S,M),jN(E)?u(S):E},u);return f&&(g=f.remove(g)),g};var Sht=_4e;(function(t,e){var i=Fn,r=x7,s=Sht;function n(o,l){var u=new s(l);return u.process(o)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,(function(){for(var o in i)e[o]=i[o];for(var l in r)e[l]=r[l]})();function a(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=t.exports)})(Gte,Gte.exports);var TC=Gte.exports,Tht=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},b4e=(function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],del:["style"],details:["open","style"],div:["align","aria-hidden","aria-label","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["aria-hidden","aria-label","style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=Eq(Eq({},TC.getDefaultCSSWhiteList()),{"align-items":!0,"align-self":!0,flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,float:!0,gap:!0,grid:!0,"grid-area":!0,"grid-auto-columns":!0,"grid-auto-flow":!0,"grid-auto-rows":!0,"grid-column":!0,"grid-column-end":!0,"grid-column-start":!0,"grid-row":!0,"grid-row-end":!0,"grid-row-start":!0,"grid-template":!0,"grid-template-areas":!0,"grid-template-columns":!0,"grid-template-rows":!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"line-height":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,a,o,l){return n==="a"&&a==="href"||(n==="img"||n==="source")&&a==="src"?r.sanitizeUrl(o):TC.safeAttrValue(n,a,o,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var a=e.css.whiteList;a!=null&&e.css instanceof Object&&Object.keys(a).forEach(function(o){return s.css.whiteList[o]=a[o]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new TC.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),a=e==="/",o=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return a||o||l?TC.escapeAttrValue(e):!n&&!s?TC.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):TC.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(o,l){var u=r.validate(l,i);return u.isValid?o.concat([l]):(s=!0,o.concat([u.sanitized]))},[]);else if(Tht(e)){var a=Object.keys(e);n=a.reduce(function(o,l){var u=e[l],d=r.validate(u,i);return d.isValid?o[l]=u:(s=!0,o[l]=d.sanitized),o},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t})();const $ht=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],Cht=$ht.reduce((t,e)=>(t[e]=[],t),{}),Mht=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],w4e=new b4e({whiteList:Cht,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(Mht.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0),Eht=new b4e({whiteList:{br:[]},stripIgnoreTag:!0,escapeHtml:t=>t},!1),x4e="http://www.w3.org/",S7=`${x4e}2000/svg`,S4e=`${x4e}1999/xlink`;let bwe=[],tue=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},iue=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),T4e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},Aht=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(iue(t[r],e))return r}return-1},_J=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let a=0;a<t.length;a++)if(a!==e){let o=t[a];if(iue(o,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},Oht=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},Wte=[],Zte=!1,$4e=t=>{(t.children||[]).forEach($4e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},wwe=()=>{Zte=!1,Wte.forEach($4e),Wte.length=0},xwe=t=>{Wte.push(t),Zte||(Zte=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(wwe,{timeout:16}):setTimeout(wwe,16))},Swe=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),xwe(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),xwe(t))},Pht=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let a=0;a<n;a++){let o=s[a],l=e[o];if(o==="className")throw new Error('Property "className" is not supported, use "class".');if(o==="class")Jte(t,l,!0);else if(o==="classes"){let u=Object.keys(l),d=u.length;for(let f=0;f<d;f++){let g=u[f];l[g]&&t.classList.add(g)}}else if(o==="styles"){let u=Object.keys(l),d=u.length;for(let f=0;f<d;f++){let g=u[f],v=l[g];v&&(T4e(v),i.styleApplyer(t,g,v))}}else if(o!=="key"&&l!=null){let u=typeof l;u==="function"?(o.lastIndexOf("on",0)===0&&(r&&(l=r(o,l,t,e)),o==="oninput"&&(function(){let d=l;l=function(f){d.apply(this,[f]),f.target["oninput-value"]=f.target.value}})()),t[o]=l):i.namespace===S7?o==="href"?t.setAttributeNS(S4e,o,l):t.setAttribute(o,l):u==="string"&&o!=="value"?o==="innerHTML"?t[o]=w4e.sanitize(l):Yte(t)&&o in t?t[o]=l:t.setAttribute(o,l):t[o]=l}}};function Yte(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let Oq,Rht=(t,e,i)=>{if(e)for(let r of e)w4(r,t,void 0,i)},C4e=(t,e,i)=>{Rht(t,e.children,i),e.text&&(t.textContent=e.text),Pht(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},w4=(t,e,i,r)=>{let s,n=0,a=t.vnodeSelector,o=e.ownerDocument;if(a==="")s=t.domNode=o.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=a.length;++l){let u=a.charAt(l);if(l===a.length||u==="."||u==="#"){let d=a.charAt(n-1),f=a.slice(n,l);d==="."?s.classList.add(f):d==="#"?s.id=f:(f==="svg"&&(r=tue(r,{namespace:S7})),r.namespace!==void 0?s=t.domNode=o.createElementNS(r.namespace,f):(s=t.domNode=t.domNode||o.createElement(f),f==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}C4e(s,t,r)}},Jte=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},Iht=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),a=n.length;for(let o=0;o<a;o++){let l=n[o],u=i[l],d=e[l];if(l==="class")d!==u&&(Jte(t,d,!1),Jte(t,u,!0));else if(l==="classes"){let f=t.classList,g=Object.keys(u),v=g.length;for(let _=0;_<v;_++){let x=g[_],S=!!u[x];S!==!!d[x]&&(s=!0,S?f.add(x):f.remove(x))}}else if(l==="styles"){let f=Object.keys(u),g=f.length;for(let v=0;v<g;v++){let _=f[v],x=u[_];x!==d[_]&&(s=!0,x?(T4e(x),r.styleApplyer(t,_,x)):r.styleApplyer(t,_,""))}}else if(u||typeof d!="string"||(u=""),l!=="value"||Yte(t)){if(u!==d){let f=typeof u;f==="function"&&r.eventHandlerInterceptor||(r.namespace===S7?l==="href"?t.setAttributeNS(S4e,l,u):t.setAttribute(l,u):f==="string"?l==="innerHTML"?t[l]=w4e.sanitize(u):l==="role"&&u===""?t.removeAttribute(l):Yte(t)&&l in t?t[l]=u:t.setAttribute(l,u):t[l]!==u&&(t[l]=u),s=!0)}}else{let f=t[l];f!==u&&(t["oninput-value"]?f===t["oninput-value"]:u!==d)&&(t[l]=u,t["oninput-value"]=void 0),u!==d&&(s=!0)}}return s},Dht=(t,e,i,r,s)=>{if(i===r)return!1;r=r||bwe;let n,a=(i=i||bwe).length,o=r.length,l=0,u=0,d=!1;for(;u<o;){let f=l<a?i[l]:void 0,g=r[u];if(f!==void 0&&iue(f,g))d=Oq(f,g,s)||d,l++;else{let v=Aht(i,g,l+1);if(v>=0){for(n=l;n<v;n++)Swe(i[n]),_J(i,n,t,"removed");d=Oq(i[v],g,s)||d,l=v+1}else w4(g,e,l<a?i[l].domNode:void 0,s),Oht(g),_J(r,u,t,"added")}u++}if(a>l)for(n=l;n<a;n++)Swe(i[n]),_J(i,n,t,"removed");return d};Oq=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let a=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(a,r),e.domNode=a,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=tue(i,{namespace:S7})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=Dht(e,r,t.children,e.children,i)||n,n=Iht(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let UN=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,Oq(r,i,e)},domNode:t.domNode});const kht={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let yD=t=>tue(kht,t),dw={append:(t,e,i)=>(i=yD(i),w4(e,t,void 0,i),UN(e,i)),insertBefore:(t,e,i)=>(i=yD(i),w4(e,t.parentNode,t,i),UN(e,i)),merge:(t,e,i)=>(i=yD(i),e.domNode=t,C4e(t,e,i),UN(e,i)),replace:(t,e,i)=>(i=yD(i),w4(e,t.parentNode,t,i),t.parentNode.removeChild(t),UN(e,i))},M4e,Lht=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};M4e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let Fht=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?M4e(i.children,s=>s.domNode===r):void 0}),i},zht=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),a=Lht(s.currentTarget,n.domNode);a.reverse();let o,l=Fht(n.getLastRender(),a);return t.scheduleRender(),l&&(o=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),o};return(s,n,a,o)=>r},Twe=t=>{let e,i,r=yD(t),s=r.performanceLogger,n=!0,a=!1,o=[],l=[],u=(f,g,v)=>{let _,x=()=>_;r.eventHandlerInterceptor=zht(e,x,s),_=f(g,v(),r),o.push(_),l.push(v)},d=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let f=0;f<o.length;f++){let g=l[f]();s("rendered",void 0),o[f].update(g),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:d,scheduleRender:()=>{i||a||(i=requestAnimationFrame(d))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),a=!0},resume:()=>{a=!1,n=!0,e.scheduleRender()},append:(f,g)=>{u(dw.append,f,g)},insertBefore:(f,g)=>{u(dw.insertBefore,f,g)},merge:(f,g)=>{u(dw.merge,f,g)},replace:(f,g)=>{u(dw.replace,f,g)},detach:f=>{for(let g=0;g<l.length;g++)if(l[g]===f)return l.splice(g,1),o.splice(g,1)[0];throw new Error("renderFunction was not found")}},e},fb=class extends be{constructor(){super(...arguments),this.items=new ke,this._watchUpdatingTracking=new tm,this._callbacks=new Map,this._projector=Twe(),this._hiddenProjector=Twe()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const a={left:0,top:0,right:0,bottom:0};if(s?.domNode){const o=s.domNode.getBoundingClientRect();a.left=o.left,a.top=o.top,a.right=o.right,a.bottom=o.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return a}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!i?.disableDecorations;if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};c([p({readOnly:!0})],fb.prototype,"surface",void 0),c([p({readOnly:!0})],fb.prototype,"items",void 0),c([p({readOnly:!0})],fb.prototype,"needsRender",null),c([p({readOnly:!0})],fb.prototype,"_watchUpdatingTracking",void 0),c([p({readOnly:!0})],fb.prototype,"updating",null),fb=c([R("esri.views.overlay.ViewOverlay")],fb);const $we=fb,bJ=[0,0];function Nht(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return bJ[0]=i.left+(e?.pageXOffset??0),bJ[1]=i.top+(e?.pageYOffset??0),bJ}function Cwe(t){t&&(t.textContent="",t.parentNode&&t.parentNode.removeChild(t))}function Vht(t){const e=document.createElement("div");return t.appendChild(e),e}const $C=16,QR=750,jht=512,Uht=2,E4e=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this._freqInfo={freq:$C,time:QR},this._overlayRenderTaskHandle=null,this.aria={},this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([X(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),X(()=>this.navigating,s=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",s.toString())}),X(()=>[this.aria,this.surface],()=>this._updateAria(),{initial:!0})])}initialize(){const r=this;this.addHandles([X(()=>this.ui,(s,n)=>this._handleUIChange(s,n),Yt),r.on("focus",()=>this.notifyChange("focused")),r.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui?.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(r){const s=this._get("container"),n=w7(r);if(n||typeof r!="string"||re.getLogger(this).error("#container",`element with id '${r}' not found`),s===n)return;if(this._stopMeasuring(),s&&(s.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Cwe(this.root),this._set("root",null)),this.userContent&&(mwe(this.userContent,s),Cwe(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const a=document.createElement("div");a.className="esri-view-user-storage",mwe(n,a),n.appendChild(a),this._set("userContent",a);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,o.appendChild(l),this._set("surface",l);const u=new $we;o.appendChild(u.surface),this._set("overlay",u),this.addHandles(X(()=>u.needsRender,d=>{d&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Hg({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Xi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}set ui(r){const s=this._get("ui");s!==r&&s?.destroy(),this._set("ui",r)}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(r,s,n){const a=this.position;return r-=a?a[0]:0,s-=a?a[1]:0,n?(n[0]=r,n[1]=s):n=[r,s],n}containerToPage(r,s,n){const a=this.position;return r+=a?a[0]:0,s+=a?a[1]:0,n?(n[0]=r,n[1]=s):n=[r,s],n}_updateAria(){const{surface:r,aria:s}=this;r&&(r.ariaLabelledByElements=s?.labelledByElements??null,r.ariaDescribedByElements=s?.describedByElements??null,r.ariaLabel=s?.label??null,r.ariaDescription=s?.description??null)}_handleUIChange(r,s){this.removeHandles("ui"),s&&s!==r&&s.destroy(),r&&(r.view=this,this.addHandles(X(()=>this.root,n=>{r.container=n?Vht(n):null},Yt),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=$C,r.time=QR;const s=Hg({prepare:o=>{const l=this._measure(),u=this._freqInfo;if(u.time+=o.deltaTime,l&&(u.freq=$C,this._get("resizing")||this._set("resizing",!0)),u.time<u.freq)return;u.time=0;const d=this._position();u.freq=d||l?$C:Math.min(QR,u.freq*Uht),!l&&u.freq>=jht&&(s.pause(),this._get("resizing")&&this._set("resizing",!1))}}),n=new ResizeObserver(o=>{r.freq=$C,r.time=QR,s.resume()});this.container!=null&&n.observe(this.container);const a=bi(()=>n.disconnect());this.addHandles([f$(window,"resize",()=>{r.freq=$C,r.time=QR,s.resume()}),a,s],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,s=r?r.clientWidth:0,n=r?r.clientHeight:0;if(s===0||n===0)return this.suspended||this._set("suspended",!0),!1;const a=this.width,o=this.height;return s===a&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",s),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:a,oldHeight:o,width:s,height:n}),!0)}_position(){const r=this.container,s=this.position,n=r&&Nht(r);return!!n&&(!s||n[0]!==s[0]||n[1]!==s[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return c([p()],i.prototype,"aria",void 0),c([p()],i.prototype,"container",null),c([p({readOnly:!0})],i.prototype,"focused",null),c([p({readOnly:!0})],i.prototype,"height",void 0),c([p()],i.prototype,"messagesCommon",void 0),c([p({type:$we})],i.prototype,"overlay",void 0),c([p({readOnly:!0})],i.prototype,"position",void 0),c([p({readOnly:!0})],i.prototype,"resizing",void 0),c([p({readOnly:!0})],i.prototype,"root",void 0),c([p({value:null,readOnly:!0})],i.prototype,"size",null),c([p({readOnly:!0})],i.prototype,"surface",void 0),c([p({readOnly:!0})],i.prototype,"suspended",void 0),c([p({nonNullable:!0})],i.prototype,"ui",null),c([p({readOnly:!0})],i.prototype,"userContent",void 0),c([p({readOnly:!0})],i.prototype,"width",void 0),c([p()],i.prototype,"widthBreakpoint",void 0),i=c([R("esri.views.DOMContainer")],i),i};function rue(t,e,i){return J9(t.map((r,s)=>e.apply(i,[r,s])))}async function Bht(t,e,i){return(await J9(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function sue(t){return{ok:!0,value:t}}function nue(t){return{ok:!1,error:t}}function qht(t){return t!=null&&t.ok===!0?t.value:null}function Ght(t){return t!=null&&t.ok===!1?t.error:null}async function Sp(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return sue(await t)}catch(e){return nue(e)}}async function Hht(t){try{return sue(await t)}catch(e){return ml(e),nue(e)}}function xoi(t){if(t.ok===!0)return t.value;throw t.error}function sc(t,e){return new mb(t,e)}let mb=class extends be{get value(){return qht(this._result)}get error(){return Ght(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Rs(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=sue(s),this._cleanup()},s=>{this._result=nue(s),this._cleanup()}),this._abortHandle=Mo(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Xi(this._abortHandle),this._abortController=null}};c([p()],mb.prototype,"value",null),c([p()],mb.prototype,"error",null),c([p()],mb.prototype,"finished",null),c([p()],mb.prototype,"promise",void 0),c([p()],mb.prototype,"_result",void 0),mb=c([R("esri.core.asyncUtils.ReactiveTask")],mb);const BN="popup",Mwe="manual";function Vg(t){return t!=null&&"open"in t&&"declaredClass"in t}function N0(t){return!!t&&t.tagName.toLowerCase()==="arcgis-popup"&&"open"in t}function Wht(t,e,i){const[r,s,n]=e;if(i){const[a,o,l]=i;a&&Vg(o)&&(o.view=null,a.remove(o,BN),o!==s&&s&&o.destroy()),a&&l&&N0(l)&&(l.view=null,a.remove(l,BN),l!==n&&n&&l.remove())}r&&Vg(s)&&(s.view=t,r.add(s,{key:BN,position:Mwe,internal:!0})),r&&n&&N0(n)&&(n.view=t,r.add(n,{key:BN,position:Mwe,internal:!0}))}async function Zht(t,e){const{popup:i,popupElement:r}=t;Vg(i)?await qN(i,null,e):r&&N0(r)?await qN(null,r,e):e?.defer(async()=>{await t.setupPopup();const{popup:s,popupElement:n}=t;Vg(s)&&!t.destroyed&&t.ready&&t.popupEnabled?await qN(s,null,e):n&&N0(n)&&await qN(null,n,e)})}function Yht(t,e){const{popup:i,popupElement:r}=t;if(Vg(i))return i.open(e);r&&N0(r)&&r.open(e)}function Jht(t,e){Vg(t)&&t.close(),e&&N0(e)&&(e.visible=!1)}async function qN(t,e,i){if(Vg(t)){const r=await t.viewModel.handleViewClick(i);return void(r?.promises?.length?t.open(r):t.visible&&t.close())}if(e&&N0(e)){const r=await e.handleViewClick(i);r?.promises?.length?e.open(r):e.visible&&(e.visible=!1)}}const Qht=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,Xht="screenUtils.toPt: input not recognized!",A4e=96;function d1(t){return t?t/72*A4e:0}function Tp(t){return t?72*t/A4e:0}function mr(t){if(typeof t=="string"){const e=t.match(Qht);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.startsWith("-"),n=r==="px"?Tp(i):i;return s?-n:n}return console.warn(Xht),null}return t}function ia(t=0,e=0){return{x:t,y:e}}function Toi(t){return t?ia(t.x,t.y):null}function yn(t=0,e=0){return[t,e]}function T7(t=0,e=0){return[t,e]}function Dg(t=0,e=0,i=0){return[t,e,i]}function $oi(t){return t}function Coi(t){return t}function Moi(t){return t}function Ff(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}const O4e=ie("mac")?"Meta":"Control",Kht=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),edt=t=>Kht.has(t);let tdt=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},_s=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new tdt(e,s):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=d=>{const f=this._incoming[d.match.eventType];if(f){const g=f.indexOf(d);f.splice(g,1),a(),this._manager&&this._manager.updateDependencies()}},l=new idt(n,r,{onPause:o,onRemove:o,onResume:d=>{const f=this._incoming[d.match.eventType];f&&!f.includes(d)&&(f.push(d),a(),this._manager&&this._manager.updateDependencies())}});let u=this._incoming[n.eventType];return u||(u=[],this._incoming[n.eventType]=u),u.push(l),a(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new rdt(e,{onEmit:(r,s,n,a)=>{this._manager?.emit(r.eventType,s,n,a)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const i=this._incoming[e.type];if(i){for(const r of i)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}},idt=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},rdt=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},sdt=class extends _s{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this._id=null,this.registerIncoming("pointer-move",i=>this._update(i.data))}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s,native:{pointerId:n}}=e;i===this._value&&this._x===r&&this._y===s&&this._id===n||(this._value=i,this._x=r,this._y=s,this._id=n,this._onChange(n,i,r,s))}},ndt=class extends _s{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=ta(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},V0=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new wPe(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=FPe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)v_e(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)s=r.pool.acquire(),r.acquired.push(s);return LPe(),s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)v_e(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}},adt=class{constructor(){this.id=0,this.type="mouse",this.location=ia()}},zd=class extends be{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=O4e,this._propertiesPool=new V0({latestPointerInfo:()=>new adt},this),this._latestPointerInfo=void 0,this._paused=!1,this._testTimestamp=void 0}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get latestPointerInfo(){return this._latestPointerInfo}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=Br.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const a=s.handlers[n];this._handlers.push(a),a.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,l,u,d,f)=>{this._emitInputEvent(a.priorityIndex+1,o,l,u,f,d)},setPointerCapture:(o,l)=>{this._setPointerCapture(s,a,o,l)},setEventCallback:o=>{a.eventCallback=o},setUninstallCallback:o=>{a.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):re.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const a of s.handler.outgoingEventTypes)if(e.has(a)){n=!0;break}}if(n)for(const a of s.handler.incomingEventMatches){e.add(a.eventType);for(const o of a.keyModifiers)edt(o)||i.add(o)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r,s){const n=this._latestPointerInfo;if(n==null||n.id!==e||n.type!==i||n.location.x!==r||n.location.y!==s){const a=this._propertiesPool.get("latestPointerInfo");a.id=e,a.type=i,a.location.x=r,a.location.y=s,this._latestPointerInfo=a}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this._testTimestamp??i.native?.timestamp,s=i.native?.cancelable;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{r||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),r=!0)},n=(o,l)=>{l&&!this._activeKeyModifiers.has(o)?(s(),this._activeKeyModifiers.add(o)):!l&&this._activeKeyModifiers.has(o)&&(s(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=i.key;this._keyModifiers.has(o)&&n(o,e==="key-down")}const a=i.native;n("Alt",!!a?.altKey),n("Control",!!a?.ctrlKey),n("Ctrl",!!a?.ctrlKey),n("Shift",!!a?.shiftKey),n("Meta",!!a?.metaKey),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new sdt((e,i,r,s)=>this._setLatestPointer(e,i,r,s)),this._multiTouchHandler=new ndt,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Br.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Br.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,a=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,a),s?(a.add(n),a.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):a.has(n)&&(a.delete(n),a.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,a){const o=s??this._currentPropagation?.timestamp??performance.now(),l=n??!1,u={event:new odt(i,r,o,a||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(u):this._doNewPropagation(u)}_doNewPropagation(e){this._currentPropagation={events:new wO,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:i,priorityIndex:r}=e.events.pop(),s=i.data?.eventId;if(!(s!=null&&this._stoppedPropagationEventIds.has(s)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&e.currentHandler.eventCallback?.(i),i.shouldStopPropagation()){s!=null&&this._stoppedPropagationEventIds.add(s);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new wO;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(a=>s.keyModifiers.includes(a));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get test(){}};c([p({readOnly:!0})],zd.prototype,"hasPendingInputs",null),c([p({constructOnly:!0})],zd.prototype,"eventSource",void 0),c([p({constructOnly:!0})],zd.prototype,"recognizers",void 0),c([p()],zd.prototype,"multiTouchActive",null),c([p()],zd.prototype,"_latestPointerInfo",void 0),c([p()],zd.prototype,"latestPointerInfo",null),c([p()],zd.prototype,"_paused",void 0),c([p({readOnly:!0})],zd.prototype,"updating",null),zd=c([R("esri.views.input.InputManager")],zd);let odt=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return!!(1&this._propagationState)}defer(e){this._propagationState|=2;const i=(r,s)=>{this._propagationState&=-3;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};const Br={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},P4e=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([X(()=>[this.ui,this.popup,this.popupElement],([r,s,n],a)=>{const[o,l,u]=a??[];Wht(this,[r,s,n],[o,l,u])},bt),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&Zht(this,r)},Br.WIDGET)]),qu(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>W(()=>import("./Popup-DQHf_0Z5.js").then(r=>r.P),__vite__mapDeps([109,110,111,2,112,113,114,37,35,36,115,116,117,52,118,119])))}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(Vg(this.popup))return this.popup.open(r);if(this.popupElement&&N0(this.popupElement))this.popupElement.open(r).catch(()=>{});else try{if(await this.setupPopup(),!this.popup)return void re.getLogger(this).error(new q("view:null-popup","Popup is null and can't be opened"));Yht(this,r)}catch{}}closePopup(){this._popupSetupTask?.abort(),Jht(this.popup,this.popupElement)}async fetchPopupFeatures(r,s){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(r,s),s)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!Vg(this.popup))return this._popupSetupTask=sc(async r=>{if(!this.popupEnabled||!N0(this.popupElement))if(this.dependencies.popup&&typeof this.dependencies.popup=="function")await this.dependencies.popup(),ct(r),customElements.get("arcgis-popup")||re.getLogger(this).error(new q("view:undefined-popup-element","`arcgis-popup` custom element is undefined and can't be opened")),this.popupElement=document.createElement("arcgis-popup");else{const{default:s}=await W(()=>import("./Popup-DQHf_0Z5.js").then(a=>a.P),__vite__mapDeps([109,110,111,2,112,113,114,37,35,36,115,116,117,52,118,119]));if(ct(r),!this.popup||Vg(this.popup))return;const n=this.popup;if("open"in n||"close"in n){const{open:a,close:o,...l}=n;this.popup=new s({...l})}else this.popup=new s(n)}}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:r,hits:s},n){const a=[],o=[];let l=!1;const u=_tt(n,ie("popup-view-fetch-timeout")??cdt),d=v=>{const _=new ldt(v);return o.push(_),a.push(_.promise),_},f=v=>{const _=o.at(-1);return _&&_.layerView===v&&!l?_:d(v)};for(const v of s)"graphic"in v?(f(v.layerView).graphics.push(v.graphic),l=!1):(a.push(v.layerView.fetchPopupFeaturesAtLocation(v.mapPoint,u)),l=!0);o.forEach(v=>v.resolve(u));const g=ytt(a).then(v=>v.filter(_=>!!_).flat());return{pendingFeatures:a,allGraphicsPromise:g,location:r}}async _getPopupHits(r,s){const{hits:n,location:a}=await this.popupHitTest(r);ct(s);const o=[];for(const l of n)if("graphic"in l){if(this._isValidPopupGraphic(l.graphic,s)){const u=this._isValidPopupGraphicsLayerView(l.layerView)?l.layerView:void 0;o.push({graphic:l.graphic,layerView:u})}}else this._isValidPopupLocationLayerView(l.layerView)&&o.push({mapPoint:l.mapPoint,layerView:l.layerView});return{hits:o,location:a}}_isValidPopupGraphic(r,s){return r&&!!r.getEffectivePopupTemplate(s?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(r){return!r||(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesFromGraphics"in r}_isValidPopupLocationLayerView(r){return(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesAtLocation"in r}};return c([p()],i.prototype,"popup",void 0),c([p()],i.prototype,"popupElement",void 0),c([p()],i.prototype,"popupEnabled",void 0),i=c([R("esri.views.PopupView")],i),i};let ldt=class{constructor(e){this.layerView=e,this._resolver=Eo(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(a=>(n=a,null)).then(a=>{a?s.resolve(a):s.reject(n)}),s.promise}};const cdt=5e3;let udt=class{constructor(){this._resolver=Eo(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=1,this._cleanUp()},()=>{this._status=2,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===1}isRejected(){return this._status===2}isFulfilled(){return this._status!==0}abort(){this._resolver.reject(ti())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Eo(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||Zr(s)||this._resolver.reject(s)}),e.resolve()}};const fF=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this._promiseProps=new udt,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,s){return this._promiseProps.promise.then(()=>this).then(r,s)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}addResolvingTask(r){r&&!this._promiseProps.isFulfilled()&&(this.addHandles(Yet(r)),this._promiseProps.addResolvingPromise(r.promise))}};return i=c([R("esri.core.Promise")],i),i},aue=fF(be),hdt="not-loaded",ddt="loading",pdt="failed",Ewe="loaded",$7=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(s=>{const n=this.load.bind(this);this.load=a=>{const o=new Promise((l,u)=>{const d=GL(a,u);this.destroyed&&u(new q("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(l,u).finally(()=>{d&&d.remove()})});if(this.loadStatus===hdt){this._set("loadStatus",ddt);const l=this._loadController=new AbortController;n({signal:l.signal})}return s(),o}})),this.when(()=>{this._set("loadStatus",Ewe),this._loadController=null},s=>{this.destroyed||(this._set("loadStatus",pdt),this._set("loadError",s),this._loadController=null)})}destroy(){this._loadController&&(this._loadController=Rs(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Ewe}get loadWarnings(){return this._get("loadWarnings")}load(r){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new q("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return c([p({readOnly:!0})],i.prototype,"loaded",null),c([p({readOnly:!0})],i.prototype,"loadError",void 0),c([p({clonable:!1})],i.prototype,"loadStatus",void 0),c([p({type:[Gu],readOnly:!0})],i.prototype,"loadWarnings",null),i=c([R("esri.core.Loadable")],i),i},$$=$7(aue);function Qte(t){return!(!t||!t.load)}async function mF(t,e){return await t.load(),fdt(t,e)}async function fdt(t,e){const i=[],r=(...n)=>{for(const a of n)a!=null&&(Array.isArray(a)?r(...a):ke.isCollection(a)?a.forEach(o=>r(o)):Qte(a)&&i.push(a))};e(r);let s=null;if(await Bht(i,async n=>{const a=await Sp(mdt(n)?n.loadAll():n.load());a.ok!==!1||s||(s=a)}),s)throw s.error;return t}function mdt(t){return"loadAll"in t&&typeof t.loadAll=="function"}let vD;function gdt(){vD=void 0}function ydt(t){return vD&&!vD.destroyed||(vD=t()),vD}var Xte;const vdt=new ii({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Jn=Xte=class extends be{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new Xte({categories:this.categories?se(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(a=>Array.isArray(a)?JSON.stringify(a):a));let r="";if(this.extent){const a=eF(this.extent,Me.WGS84);a!=null&&(r=`${a.xmin},${a.ymin},${a.xmax},${a.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(a=>vdt.toJSON(a.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};c([p()],Jn.prototype,"categories",void 0),c([p()],Jn.prototype,"disableExtraQuery",void 0),c([p({type:It})],Jn.prototype,"extent",void 0),c([p()],Jn.prototype,"filter",void 0),c([p()],Jn.prototype,"num",void 0),c([p()],Jn.prototype,"query",void 0),c([p()],Jn.prototype,"sortField",void 0),c([p()],Jn.prototype,"sortOrder",null),c([p()],Jn.prototype,"start",void 0),Jn=Xte=c([R("esri.portal.PortalQueryParams")],Jn);var Kte;let Hn=Kte=class extends ae{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e&&this.portal?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){const t=this.portal?.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new Kte({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=en(Jn,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Jn,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Jn,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new Jn({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new Jn({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s?.categorySchema;return n?.length?n:[]}):[])}};c([p()],Hn.prototype,"access",void 0),c([p({type:Date})],Hn.prototype,"created",void 0),c([p()],Hn.prototype,"description",void 0),c([p()],Hn.prototype,"id",void 0),c([p()],Hn.prototype,"isInvitationOnly",void 0),c([p({type:Date})],Hn.prototype,"modified",void 0),c([p()],Hn.prototype,"owner",void 0),c([p()],Hn.prototype,"portal",void 0),c([p()],Hn.prototype,"snippet",void 0),c([p()],Hn.prototype,"sortField",void 0),c([p()],Hn.prototype,"sortOrder",void 0),c([p()],Hn.prototype,"sourceJSON",void 0),c([p()],Hn.prototype,"tags",void 0),c([p()],Hn.prototype,"thumbnail",void 0),c([p({readOnly:!0})],Hn.prototype,"thumbnailUrl",null),c([p()],Hn.prototype,"title",void 0),c([p({readOnly:!0})],Hn.prototype,"url",null),Hn=Kte=c([R("esri.portal.PortalGroup")],Hn);let Wx=class extends be{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};c([p()],Wx.prototype,"nextQueryParams",void 0),c([p()],Wx.prototype,"queryParams",void 0),c([p()],Wx.prototype,"results",void 0),c([p()],Wx.prototype,"total",void 0),Wx=c([R("esri.portal.PortalQueryResult")],Wx);let Yy=class extends ae{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new q("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};c([p({type:Date})],Yy.prototype,"created",void 0),c([p()],Yy.prototype,"id",void 0),c([p()],Yy.prototype,"portal",void 0),c([p()],Yy.prototype,"title",void 0),c([p({readOnly:!0})],Yy.prototype,"url",null),c([p()],Yy.prototype,"username",void 0),Yy=c([R("esri.portal.PortalFolder")],Yy);var eie;let as=eie=class extends ae{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.id=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.id}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.id}`:null}addItem(t){const e=t&&t.item,i=t?.data,r=t?.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(a=>(e.id=a.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.slice();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},a=await this.portal.request(i,n);for(const o of a.results){const l=t.find(f=>o.itemId===f.id),u=o.success;let d=null;u?(l.id=null,l.portal=null):o.error&&(d=new q("portal:delete-item-failed",o.error.message,o.error)),r.push({item:l,success:u,error:d})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=Yy.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=Hn.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??={};let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await W(()=>Promise.resolve().then(()=>R4e),void 0),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s?.items?(n=s.items.map(a=>{const o=i.fromJSON(a);return o.portal=this.portal,o}),await Promise.all(n.map(a=>a.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new Hn({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new q("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new q("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new eie({sourceJSON:t});return e.read(t),e}};c([p()],as.prototype,"access",void 0),c([p({type:Date})],as.prototype,"created",void 0),c([p()],as.prototype,"culture",void 0),c([p()],as.prototype,"description",void 0),c([p()],as.prototype,"email",void 0),c([p()],as.prototype,"favGroupId",void 0),c([p()],as.prototype,"fullName",void 0),c([p()],as.prototype,"id",void 0),c([p({type:Date})],as.prototype,"modified",void 0),c([p()],as.prototype,"orgId",void 0),c([p()],as.prototype,"portal",void 0),c([p()],as.prototype,"preferredView",void 0),c([p()],as.prototype,"privileges",void 0),c([p()],as.prototype,"region",void 0),c([p()],as.prototype,"role",void 0),c([p()],as.prototype,"roleId",void 0),c([p()],as.prototype,"sourceJSON",void 0),c([p()],as.prototype,"thumbnail",void 0),c([p({readOnly:!0})],as.prototype,"thumbnailUrl",null),c([p()],as.prototype,"units",void 0),c([p({readOnly:!0})],as.prototype,"userContentUrl",null),c([p({readOnly:!0})],as.prototype,"url",null),c([p()],as.prototype,"username",void 0),c([p()],as.prototype,"userLicenseTypeId",void 0),c([p()],as.prototype,"userType",void 0),as=eie=c([R("esri.portal.PortalUser")],as);var gh;let XR;const Awe={PortalGroup:()=>Promise.resolve({default:Hn}),PortalItem:()=>W(()=>Promise.resolve().then(()=>R4e),void 0),PortalUser:()=>Promise.resolve({default:as})};var Rg;let ze=(Rg=class extends iy($$){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.g3DTilesGalleryGroupQuery=null,this.g3dTilesEnabled=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=fr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){Owe.unregister(this),this.defaultBasemap=Pe(this.defaultBasemap),this.defaultDevBasemap=Pe(this.defaultDevBasemap),this.defaultVectorBasemap=Pe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Xi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const i of e)fr.request.trustedServers.includes(i)||fr.request.trustedServers.push(i);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=this.user?.orgId,i=!e||this.canSearchPublic;return this.id&&!i?` AND orgid:${this.id}`:null}get hasAPIKey(){return ast(this.restUrl)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get loaded(){return super.loaded}get restUrl(){let e=this.url;if(e){const i=e.indexOf("/sharing");e=i>0?e.slice(0,i):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,i=this.thumbnail;return e&&i?this._normalizeSSL(e+"/portals/self/resources/"+i):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let i=null;return e&&(i=as.fromJSON(e),i.portal=this),i}load(e){const i=W(async()=>{const{default:r}=await Promise.resolve().then(()=>Ydt);return{default:r}},void 0).then(({default:r})=>{ct(e),XR=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,e)).then(r=>{if(!this.hasAPIKey&&nr){const s=nr;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==gh.AUTH_MODE_AUTO&&this.authMode!==gh.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",_dt(new WeakRef(this))),Owe.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),i=(await W(async()=>{const{default:r}=await import("./ElevationLayer-CHiToBeZ.js");return{default:r}},__vite__mapDeps([120,121,122,123]))).default;return e?e.map(r=>new i({id:r.id,url:r.url})):[]}async fetchBasemaps(e,i){const r=await this._fetchBasemaps(e,i);if(i?.include3d===!0&&this.use3dBasemaps!==!1){const s=await this._fetchBasemaps3D(e,i);r.unshift(...s)}return r}async fetchDefault3DBasemap(e){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||this.default3DBasemapQuery==="none")return null;const i=new Jn;i.query=this.default3DBasemapQuery,i.disableExtraQuery=!0;const r=(await this.queryItems(i,e)).results.find(s=>s.type==="Web Scene");return r?new XR({portalItem:r}):null}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then(i=>i.categorySchema):sa(e)?Promise.reject(ti()):Promise.resolve([])}async fetchClassificationSchema(e){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",e).then(i=>i.classificationSchema):null}fetchFeaturedGroups(e){const i=this.featuredGroups,r=new Jn({num:100,sortField:"title"});if(i?.length){const s=[];for(const n of i)s.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=s.join(" OR "),this.queryGroups(r,e).then(n=>n.results)}return sa(e)?Promise.reject(ti()):Promise.resolve([])}fetchRegions(e){const i=this.user?.culture||this.culture||Vu();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:i}})}fetchSettings(e){const i=this.user?.culture||this.culture||Vu();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:i}})}static getDefault(){return ydt(()=>new gh)}queryGroups(e,i){return this.queryPortal("/community/groups",e,"PortalGroup",i)}queryItems(e,i){return this.queryPortal("/search",e,"PortalItem",i)}queryUsers(e,i){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",i)}fetchSelf(e=this.authMode,i=!1,r){const s=this.restUrl+"/portals/self",n={authMode:e,query:{culture:Vu().toLowerCase()},withCredentials:!0,...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),i&&(n.query.default=!0),this.request(s,n)}queryPortal(e,i,r,s){const n=en(Jn,i),a=o=>this.request(this.restUrl+e,{...n.toRequestOptions(this),...s}).then(l=>{const u=n.clone();return u.start=l.nextStart,new Wx({nextQueryParams:u,queryParams:n,total:l.total,results:gh._resultsToTypedArray(o,{portal:this},l,s)})}).then(l=>Promise.all(l.results.map(u=>typeof u.when=="function"?u.when():l)).then(()=>l,u=>(ml(u),l)));return r&&Awe[r]?Awe[r]().then(({default:o})=>(ct(s),a(o))):a()}signIn(){if(this.hasAPIKey)return this.load().then(()=>{if(!this.user)throw new q("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")});if(this.authMode===gh.AUTH_MODE_ANONYMOUS||this.authMode===gh.AUTH_MODE_NO_PROMPT&&!nr)return Promise.reject(new q("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=i=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(i||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=i,this.fetchSelf("immediate"))):this.user&&this.credential===i?null:(this.credential=i,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return nr?nr.getCredential(this.restUrl,{prompt:this.authMode!==gh.AUTH_MODE_NO_PROMPT}).then(i=>e(i)):e(this.credential)}normalizeUrl(e){const i=this.credential?.token;return this._normalizeSSL(i?e+(e.includes("?")?"&":"?")+"token="+i:e)}requestToTypedArray(e,i,r){return this.request(e,i).then(s=>{const n=gh._resultsToTypedArray(r,{portal:this},s);return Promise.all(n.map(a=>typeof a.when=="function"?a.when():s)).then(()=>n,()=>n)})}request(e,i={}){const r={f:"json",...i.query},{authMode:s=this.authMode===gh.AUTH_MODE_ANONYMOUS||this.authMode===gh.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:n=null,cacheBust:a=!1,method:o="auto",responseType:l="json",signal:u}=i,d={authMode:s,body:n,cacheBust:a,method:o,query:r,responseType:l,timeout:0,signal:u};return i.withCredentials&&(d.withCredentials=!0),Si(this._normalizeSSL(e),d).then(f=>f.data)}toJSON(){throw new q("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new gh({sourceJSON:e})}_getHelperService(e){const i=this.helperServices?.[e];if(!i)throw new q("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return i}async _fetchBasemaps(e,i){const r=new Jn;r.query=e||(ste()?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const s=await this.queryGroups(r,i);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const a=await n.queryItems(r,i);return a.total?a.results.filter(o=>o.type==="Web Map").map(o=>new XR({portalItem:o})):[]}async _fetchBasemaps3D(e,i){const r=e||this.basemapGalleryGroupQuery3D;if(!r)return[];if(ste())return[];const s=new Jn({query:r,disableExtraQuery:!0}),n=await this.queryGroups(s,i);if(!n.total)return[];const a=n.results[0];s.num=100,s.query='type:"Web Scene"',s.sortField=a.sortField||"name",s.sortOrder=a.sortOrder||"desc";const o=await a.queryItems(s,i);return o.total?o.results.filter(l=>l.type==="Web Scene").map(l=>new XR({portalItem:l})):[]}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const i=XR.fromJSON(e);return i.portalItem={portal:this},i}return null}static _resultsToTypedArray(e,i,r,s){let n;if(r){const a=s!=null?s.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||i)&&(n=n.map(o=>{const l=Object.assign(e?e.fromJSON(o):o,i);return typeof l.load=="function"&&l.load(a),l}))}else n=[];return n}},gh=Rg,Rg.AUTH_MODE_ANONYMOUS="anonymous",Rg.AUTH_MODE_AUTO="auto",Rg.AUTH_MODE_IMMEDIATE="immediate",Rg.AUTH_MODE_NO_PROMPT="no-prompt",Rg);c([p()],ze.prototype,"access",void 0),c([p()],ze.prototype,"allSSL",void 0),c([p()],ze.prototype,"authMode",void 0),c([p()],ze.prototype,"authorizedCrossOriginDomains",void 0),c([Oe("authorizedCrossOriginDomains")],ze.prototype,"readAuthorizedCrossOriginDomains",null),c([p()],ze.prototype,"basemapGalleryGroupQuery",void 0),c([p({json:{name:"3DBasemapGalleryGroupQuery"}})],ze.prototype,"basemapGalleryGroupQuery3D",void 0),c([p({json:{name:"g3DTilesGalleryGroupQuery"}})],ze.prototype,"g3DTilesGalleryGroupQuery",void 0),c([p({json:{name:"g3dTilesEnabled"}})],ze.prototype,"g3dTilesEnabled",void 0),c([p()],ze.prototype,"bingKey",void 0),c([p()],ze.prototype,"canListApps",void 0),c([p()],ze.prototype,"canListData",void 0),c([p()],ze.prototype,"canListPreProvisionedItems",void 0),c([p()],ze.prototype,"canProvisionDirectPurchase",void 0),c([p()],ze.prototype,"canSearchPublic",void 0),c([p()],ze.prototype,"canShareBingPublic",void 0),c([p()],ze.prototype,"canSharePublic",void 0),c([p()],ze.prototype,"canSignInArcGIS",void 0),c([p()],ze.prototype,"canSignInIDP",void 0),c([p()],ze.prototype,"colorSetsGroupQuery",void 0),c([p()],ze.prototype,"commentsEnabled",void 0),c([p({type:Date})],ze.prototype,"created",void 0),c([p()],ze.prototype,"credential",void 0),c([p()],ze.prototype,"culture",void 0),c([p()],ze.prototype,"currentVersion",void 0),c([p()],ze.prototype,"customBaseUrl",void 0),c([p()],ze.prototype,"default3DBasemapQuery",void 0),c([p()],ze.prototype,"defaultBasemap",void 0),c([Oe("defaultBasemap")],ze.prototype,"readDefaultBasemap",null),c([p()],ze.prototype,"defaultDevBasemap",void 0),c([Oe("defaultDevBasemap")],ze.prototype,"readDefaultDevBasemap",null),c([p({type:It})],ze.prototype,"defaultExtent",void 0),c([p()],ze.prototype,"defaultVectorBasemap",void 0),c([Oe("defaultVectorBasemap")],ze.prototype,"readDefaultVectorBasemap",null),c([p()],ze.prototype,"description",void 0),c([p()],ze.prototype,"devBasemapGalleryGroupQuery",void 0),c([p()],ze.prototype,"eueiEnabled",void 0),c([p({readOnly:!0})],ze.prototype,"extraQuery",null),c([p()],ze.prototype,"featuredGroups",void 0),c([p()],ze.prototype,"featuredItemsGroupQuery",void 0),c([p()],ze.prototype,"galleryTemplatesGroupQuery",void 0),c([p()],ze.prototype,"layoutGroupQuery",void 0),c([p()],ze.prototype,"livingAtlasGroupQuery",void 0),c([p({readOnly:!0})],ze.prototype,"hasAPIKey",null),c([p()],ze.prototype,"hasCategorySchema",void 0),c([p()],ze.prototype,"hasClassificationSchema",void 0),c([p()],ze.prototype,"helpBase",void 0),c([p()],ze.prototype,"helperServices",void 0),c([p()],ze.prototype,"helpMap",void 0),c([p()],ze.prototype,"homePageFeaturedContent",void 0),c([p()],ze.prototype,"homePageFeaturedContentCount",void 0),c([p()],ze.prototype,"httpPort",void 0),c([p()],ze.prototype,"httpsPort",void 0),c([p()],ze.prototype,"id",void 0),c([p()],ze.prototype,"ipCntryCode",void 0),c([p({readOnly:!0})],ze.prototype,"isOrganization",null),c([p()],ze.prototype,"isPortal",void 0),c([p()],ze.prototype,"isReadOnly",void 0),c([p({readOnly:!0})],ze.prototype,"itemPageUrl",null),c([p()],ze.prototype,"layerTemplatesGroupQuery",void 0),c([p()],ze.prototype,"maxTokenExpirationMinutes",void 0),c([p({type:Date})],ze.prototype,"modified",void 0),c([p()],ze.prototype,"name",void 0),c([p()],ze.prototype,"portalHostname",void 0),c([p()],ze.prototype,"portalMode",void 0),c([p()],ze.prototype,"portalProperties",void 0),c([p()],ze.prototype,"region",void 0),c([p()],ze.prototype,"recycleBinEnabled",void 0),c([p({readOnly:!0})],ze.prototype,"restUrl",null),c([p()],ze.prototype,"rotatorPanels",void 0),c([p()],ze.prototype,"showHomePageDescription",void 0),c([p()],ze.prototype,"sourceJSON",void 0),c([p()],ze.prototype,"staticImagesUrl",void 0),c([p({json:{name:"2DStylesGroupQuery"}})],ze.prototype,"stylesGroupQuery2d",void 0),c([p({json:{name:"stylesGroupQuery"}})],ze.prototype,"stylesGroupQuery3d",void 0),c([p()],ze.prototype,"supportsHostedServices",void 0),c([p()],ze.prototype,"symbolSetsGroupQuery",void 0),c([p()],ze.prototype,"templatesGroupQuery",void 0),c([p()],ze.prototype,"thumbnail",void 0),c([p({readOnly:!0})],ze.prototype,"thumbnailUrl",null),c([p()],ze.prototype,"units",void 0),c([p()],ze.prototype,"url",void 0),c([p()],ze.prototype,"urlKey",void 0),c([Oe("urlKey")],ze.prototype,"readUrlKey",null),c([p()],ze.prototype,"user",void 0),c([Oe("user")],ze.prototype,"readUser",null),c([p()],ze.prototype,"use3dBasemaps",void 0),c([p()],ze.prototype,"useDefault3dBasemap",void 0),c([p()],ze.prototype,"useStandardizedQuery",void 0),c([p()],ze.prototype,"useVectorBasemaps",void 0),c([p()],ze.prototype,"vectorBasemapGalleryGroupQuery",void 0),ze=gh=c([R("esri.portal.Portal")],ze);const Owe=new FinalizationRegistry(t=>{t.remove()});function _dt(t){const e=nr;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let Jy=class extends be{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:Pwe(e.path,e.portalItem)}:e}set path(e){e!=null&&Nu(e)?re.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return Pwe(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new q("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:i?.cacheBust?Date.now():null},signal:i?.signal})}async update(e,i){const{addOrUpdateResources:r}=await W(()=>Promise.resolve().then(()=>DE),void 0);return await r(this.portalItem,[{resource:this,content:e,compress:i?.compress,access:i?.access}],"update",i),this}hasPath(){return this.path!=null}};function Pwe(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&Nu(t)&&(t=Yle(t,e.itemUrl)),t?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}c([p()],Jy.prototype,"portalItem",void 0),c([p({type:String,value:null})],Jy.prototype,"path",null),c([wi("path")],Jy.prototype,"_castPath",null),c([p({type:String,readOnly:!0})],Jy.prototype,"url",null),c([p({type:String,readOnly:!0})],Jy.prototype,"cdnUrl",null),c([p({type:String,readOnly:!0})],Jy.prototype,"itemRelativeUrl",null),Jy=c([R("esri.portal.PortalItemResource")],Jy);let aS=class extends be{constructor(e){super(e),this.created=null,this.rating=null}};c([p({type:Date})],aS.prototype,"created",void 0),c([p()],aS.prototype,"rating",void 0),aS=c([R("esri.portal.PortalRating")],aS);var Zx;const bdt=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Knowledge Graph Layer","Map Service","Media Layer","Scene Service","Stream Service","Video Service","Vector Tile Service","WCS","WFS","WMS","WMTS"]),wdt=new Set(["KML","GeoJson","CSV"]);let qt=Zx=class extends iy($$){static from(t){return g$(Zx,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t?.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new It(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type?.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,a=!1,o=!1,l=!1,u=!1,d=!1,f=!1,g=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(a=e.includes("Table"),o=e.includes("Route Layer"),l=e.includes("Markup"),u=e.includes("Spatiotemporal"),d=e.includes("UtilityNetwork"),s=u&&a?"spatiotemporaltable":a?"table":o?"routelayer":l?"markup":u?"spatiotemporal":d?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(u=e.includes("Spatiotemporal"),f=e.includes("Relational"),s=u||f?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":e.includes("GaussianSplat")?"gaussiansplatlayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="reality mapping project"?s="realitymappingproject":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="urban project"?s="urbanproject":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro presentation"?s="propresentation":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(g=e.includes("Map"),s=g?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":t==="xr experience"?"xrexperience":"maps",s?Qs(i+s+r+".png"):null}get isLayer(){return this.type!=null&&bdt.has(this.type)}get itemCdnUrl(){return ice(this.itemUrl)}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get loaded(){return super.loaded}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const e=this.owner||this.portal?.user?.id;return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=ze.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}},i=t instanceof aS?t.rating:t;return i==null||isNaN(i)||typeof t!="number"||(e.query.rating=i),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new aS({rating:i,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:se(this.applicationProxies),avgRating:this.avgRating,categories:se(this.categories),classification:se(this.classification),created:se(this.created),culture:this.culture,description:this.description,extent:se(this.extent),groupCategories:se(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:se(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:se(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:se(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:se(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Zx({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const e of["tags","typeKeywords","categories"])t[e]=t[e]?.join(", ");for(const e of["extent","classification"]){const i=t[e];i&&(t[e]=JSON.stringify(i))}return t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new aS(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Zx)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.applicationProxies&&!Object.hasOwn(t,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t?.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new q("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new q("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:a}=t||{},o={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!r,tags:n?.join(","),title:a}},{itemId:l}=await e.request(`${i}/copy`,o);return new Zx({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")mm(e)?r.query={data:e}:r.query={url:ku(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new q("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await W(()=>Promise.resolve().then(()=>DE),void 0);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await W(()=>Promise.resolve().then(()=>DE),void 0);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i?.compress,access:i?.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await W(()=>Promise.resolve().then(()=>DE),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new q("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await W(()=>Promise.resolve().then(()=>DE),void 0);return e(this,t)}resourceFromPath(t){return new Jy({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:se(this.categories),classification:se(this.classification),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:se(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:se(this.typeKeywords),url:this.url};return Net(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Zx({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};c([p({type:["private","shared","org","public"]})],qt.prototype,"access",void 0),c([p()],qt.prototype,"accessInformation",void 0),c([p({type:String})],qt.prototype,"apiKey",void 0),c([p({json:{read:{source:"appProxies"}}})],qt.prototype,"applicationProxies",void 0),c([p()],qt.prototype,"avgRating",void 0),c([p()],qt.prototype,"categories",void 0),c([p()],qt.prototype,"classification",void 0),c([p({type:Date})],qt.prototype,"created",void 0),c([p()],qt.prototype,"culture",void 0),c([p()],qt.prototype,"description",void 0),c([p({readOnly:!0})],qt.prototype,"displayName",null),c([p({type:It})],qt.prototype,"extent",void 0),c([Oe("extent")],qt.prototype,"readExtent",null),c([p()],qt.prototype,"groupCategories",void 0),c([p({readOnly:!0})],qt.prototype,"iconUrl",null),c([p()],qt.prototype,"id",void 0),c([p({readOnly:!0})],qt.prototype,"isLayer",null),c([p({type:Boolean,readOnly:!0})],qt.prototype,"isOrgItem",void 0),c([p()],qt.prototype,"itemControl",void 0),c([p({readOnly:!0})],qt.prototype,"itemPageUrl",null),c([p({readOnly:!0})],qt.prototype,"itemUrl",null),c([p()],qt.prototype,"licenseInfo",void 0),c([p({type:Date})],qt.prototype,"modified",void 0),c([p()],qt.prototype,"name",void 0),c([p()],qt.prototype,"numComments",void 0),c([p()],qt.prototype,"numRatings",void 0),c([p()],qt.prototype,"numViews",void 0),c([p()],qt.prototype,"owner",void 0),c([p()],qt.prototype,"ownerFolder",void 0),c([p({type:ze})],qt.prototype,"portal",void 0),c([p()],qt.prototype,"screenshots",void 0),c([p()],qt.prototype,"size",void 0),c([p()],qt.prototype,"snippet",void 0),c([p()],qt.prototype,"sourceJSON",void 0),c([p({type:String})],qt.prototype,"sourceUrl",void 0),c([p({type:String})],qt.prototype,"spatialReference",void 0),c([p()],qt.prototype,"tags",void 0),c([p()],qt.prototype,"thumbnail",void 0),c([p({readOnly:!0})],qt.prototype,"thumbnailUrl",null),c([p()],qt.prototype,"title",void 0),c([p()],qt.prototype,"type",void 0),c([p()],qt.prototype,"typeKeywords",void 0),c([p({type:String,json:{read(t,e){if(wdt.has(e.type)){const i=this.portal?.restUrl;t||=i&&this.id?`${i}/content/items/${this.id}/data`:null}return t}}})],qt.prototype,"url",void 0),c([p({readOnly:!0})],qt.prototype,"userItemUrl",null),qt=Zx=c([R("esri.portal.PortalItem")],qt);const R4e=Object.freeze(Object.defineProperty({__proto__:null,get default(){return qt}},Symbol.toStringTag,{value:"Module"}));async function xdt(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await Gce("esri/t9n/basemaps");return i[t]||i[e]}const tie={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-hillshade",url:"https://services.arcgisonline.com/ArcGIS/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1},{id:"terrain-base",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/33064a20de0c48d2bb61efa8faca93a8/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Terrain Base"},{id:"terrain-reference",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/14fbc125ccc9488888b014db09f35f67/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Reference Reference",isReference:!0}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/94329802cbfa44a18f423e6f1a0b875c/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Qs("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return Qs("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Open3D_Trees_v1/SceneServer",itemId:"9d3d89d42cfe4e2c9d108a2f0d518406",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return Qs("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return Qs("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return Qs("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Open3D_Trees_v1/SceneServer",itemId:"9d3d89d42cfe4e2c9d108a2f0d518406",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Open3D_Buildings_v1/SceneServer",itemId:"cd33b09dde0a419c986ca1a78a5fc06d",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return Qs("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/Esri3D_Buildings_v1/SceneServer",itemId:"b8fec5af7dfe4866b1b8ac2d2800f282",layerType:"ArcGISSceneServiceLayer"}]}};let Qy=class extends be{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2",this.worldview=null}get languageParameter(){const e=this.language;let i=e==="local"||e==="global"?e:Eke(e??Vu())??"global";return i=i==="no"?"nb":i,i}};c([p()],Qy.prototype,"apiKey",void 0),c([p()],Qy.prototype,"id",void 0),c([p()],Qy.prototype,"language",void 0),c([p()],Qy.prototype,"places",void 0),c([p()],Qy.prototype,"serviceUrl",void 0),c([p()],Qy.prototype,"worldview",void 0),Qy=c([R("esri.support.BasemapStyle")],Qy);const Sdt=Qy,I4e=Symbol("BasemapInstance");function Tdt(t){return t!=null&&typeof t=="object"&&I4e in t}let D4e=0;const gF=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+D4e++})}};return i=c([R("esri.core.Identifiable")],i),i},oue=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:D4e++})}};return i=c([R("esri.core.Identifiable.NumericIdentifiable")],i),i},Goi=gF(class{});async function $dt(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await W(async()=>{const{fromItem:r}=await import("./portalLayers-BB5XGY1f.js");return{fromItem:r}},__vite__mapDeps([124,125,126,127,128]));try{return await i(e)}catch(r){const s=e?.portalItem,n=s?.id||"unset",a=s?.portal?.url||fr.portalUrl;throw re.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+n+"')",r),r}}const Rwe={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function wJ(t,e,i,r=xp){const s=new Hu(Bce(r)),n=gt.fromJSDate(t,{zone:s}),a=i==="decades"||i==="centuries"?"year":L4e(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[a]:e}).toJSDate()}function Hoi(t,e,i="milliseconds"){const r=t.getTime(),s=k4e(e,i,"milliseconds");return new Date(r+s)}function Iwe(t,e,i=xp){const r=new Hu(Bce(i)),s=gt.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const a=s.startOf("year"),{year:o}=a,l=o-o%(e==="decades"?10:100);return a.set({year:l}).toJSDate()}const n=L4e(e);return s.startOf(n).toJSDate()}function k4e(t,e,i){return t===0?0:t*Rwe[e]/Rwe[i]}function Cdt(t,e){return t&&e?t.intersection(e):t||e}function L4e(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var Td,bA;let ts=(bA=class extends ae{static get allTime(){return Dwe}static get empty(){return Mdt}static fromArray(e){return new Td({start:e[0]!=null?new Date(e[0]):e[0],end:e[1]!=null?new Date(e[1]):e[1]})}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,i){return i.end!=null?new Date(i.end):null}writeEnd(e,i){i.end=e?.getTime()??null}get isAllTime(){return this.equals(Td.allTime)}get isEmpty(){return this.equals(Td.empty)}readStart(e,i){return i.start!=null?new Date(i.start):null}writeStart(e,i){i.start=e?.getTime()??null}clone(){return new Td({end:this.end,start:this.start})}equals(e){if(!e)return!1;const i=this.start?.getTime()??this.start,r=this.end?.getTime()??this.end,s=e.start?.getTime()??e.start,n=e.end?.getTime()??e.end;return i===s&&r===n}expandTo(e,i=xp){if(this.isEmpty||this.isAllTime)return this.clone();let r=this.start;r&&(r=Iwe(r,e,i));let s=this.end;if(s){const n=Iwe(s,e,i);s=s.getTime()===n.getTime()?n:wJ(n,1,e,i)}return new Td({start:r,end:s})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return Td.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const i=this.start?.getTime()??-1/0,r=this.end?.getTime()??1/0,s=e.start?.getTime()??-1/0,n=e.end?.getTime()??1/0;let a,o;return s>=i&&s<=r?a=s:i>=s&&i<=n&&(a=i),r>=s&&r<=n?o=r:n>=i&&n<=r&&(o=n),a==null||o==null||isNaN(a)||isNaN(o)?Td.empty:new Td({start:a===-1/0?null:new Date(a),end:o===1/0?null:new Date(o)})}offset(e,i,r=xp){if(this.isEmpty||this.isAllTime)return this.clone();const s=new Td,{start:n,end:a}=this;return n!=null&&(s.start=wJ(n,e,i,r)),a!=null&&(s.end=wJ(a,e,i,r)),s}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return Dwe.clone();const i=this.start!=null&&e.start!=null?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=this.end!=null&&e.end!=null?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new Td({start:i,end:r})}},Td=bA,bA);c([p({type:Date,json:{write:{allowNull:!0}}})],ts.prototype,"end",void 0),c([Oe("end")],ts.prototype,"readEnd",null),c([Ie("end")],ts.prototype,"writeEnd",null),c([p({readOnly:!0,json:{read:!1}})],ts.prototype,"isAllTime",null),c([p({readOnly:!0,json:{read:!1}})],ts.prototype,"isEmpty",null),c([p({type:Date,json:{write:{allowNull:!0}}})],ts.prototype,"start",void 0),c([Oe("start")],ts.prototype,"readStart",null),c([Ie("start")],ts.prototype,"writeStart",null),ts=Td=c([R("esri.time.TimeExtent")],ts);const Dwe=new ts,Mdt=new ts({start:void 0,end:void 0});let Edt=0,zs=class extends w$(gF($$)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new It(-180,-90,180,90,Me.WGS84),this.id=Date.now().toString(16)+"-layer-"+Edt++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Me.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await W(async()=>{const{fromUrl:r}=await import("./arcgisLayers-Ccnnp-FF.js");return{fromUrl:r}},__vite__mapDeps([129,125,126,128]))).fromUrl(i)}static fromPortalItem(e){return $dt(e)}initialize(){this.when().catch(e=>{Zr(e)||re.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const{parent:e}=this;e&&(this.parent=null,e.removeChildLayer?.(this))}get effectiveVisible(){return this.visible&&(this.parent?.effectiveVisible??!0)}get hasAttributionData(){return this.attributionDataUrl!=null}get loaded(){return super.loaded}removeFromParent(){const{parent:e}=this;e&&(e.removeChildLayer?.(this),this.parent=null)}get parsedUrl(){return kn(this.url)}createLayerView(e,i){return Promise.reject(new q("layer:create-layer-view","Layer does not support creating a layer view"))}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Si(e,{query:{f:"json"},responseType:"json"})).data;throw new q("layer:no-attribution-data","Layer does not have attribution data")}};c([p({type:String})],zs.prototype,"attributionDataUrl",void 0),c([p({readOnly:!0})],zs.prototype,"effectiveVisible",null),c([p({type:It})],zs.prototype,"fullExtent",void 0),c([p({readOnly:!0})],zs.prototype,"hasAttributionData",null),c([p({type:String,clonable:!1})],zs.prototype,"id",void 0),c([p({type:Boolean,nonNullable:!0})],zs.prototype,"legendEnabled",void 0),c([p({type:["show","hide","hide-children"]})],zs.prototype,"listMode",void 0),c([p({type:Number,range:{min:0,max:1},nonNullable:!0})],zs.prototype,"opacity",void 0),c([p({clonable:!1})],zs.prototype,"parent",void 0),c([p({readOnly:!0})],zs.prototype,"parsedUrl",null),c([p({type:Boolean,readOnly:!0})],zs.prototype,"persistenceEnabled",void 0),c([p({type:Boolean})],zs.prototype,"popupEnabled",void 0),c([p({type:Boolean})],zs.prototype,"attributionVisible",void 0),c([p({type:Me})],zs.prototype,"spatialReference",void 0),c([p({type:String})],zs.prototype,"title",void 0),c([p({readOnly:!0,json:{read:!1}})],zs.prototype,"type",void 0),c([p()],zs.prototype,"url",void 0),c([p({type:ts})],zs.prototype,"visibilityTimeExtent",void 0),c([p({type:Boolean,nonNullable:!0})],zs.prototype,"visible",void 0),zs=c([R("esri.layers.Layer")],zs);const GN=new WeakMap;function lue(t){return!t.destroyed&&(GN.has(t)||t.addHandles([X(()=>{const{parent:e}=t;return!!(e&&e instanceof zs)&&(e.type==="catalog-dynamic-group"||lue(e))},e=>GN.set(t,e),bt),bi(()=>GN.delete(t))]),GN.get(t))}function F4e(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function Adt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="graphics"}function Odt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="map-image"}function Pdt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="knowledge-graph"&&"layers"in t}function Rdt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="knowledge-graph-sublayer"}function kwe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function r0(t){return t?.type==="subtype-sublayer"}function WE(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function MO(t){return t!=null&&"type"in t&&t.type==="group"}const Zoi={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function iie(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function t$(t){return t.type==="integrated-mesh"||t.type==="integrated-mesh-3dtiles"}function Lwe(t){return t?.type==="voxel"}function Fwe(t){return t?.type==="imagery-tile"}function z4e(t,e){return Tdt(t?.parent)&&t.parent[e].includes(t)}function oU(t){return z4e(t,"baseLayers")}function xJ(t){return z4e(t,"referenceLayers")}function yF(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function N4e(t){const e=t?.type;return(e==="feature"||e==="subtype-group"||e==="oriented-imagery")&&t?.source?.type==="feature-layer"}function Idt(t){return t?.type==="feature"&&t.source?.type==="feature-layer"}function Yoi(t){return F4e(t)&&Idt(t)}function Ddt(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function cue(t,e){const i=nr?.findServerInfo(t);if(i?.currentVersion!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.slice(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:a}=await Si(s,{query:{f:"json"},responseType:"json",signal:n});return a?.owningSystemUrl||null}function V4e(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function kdt(t){return V4e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function Ldt(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"knowledge-graph-sublayer":return!0;default:return!1}}function Fdt(t){return!!Ldt(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}function j4e(t){return(t.type==="imagery"||t.type==="imagery-tile")&&t.renderer?.type==="flow"}function zdt(t){const e=new ke;for(const i of t.allLayers.concat(t.allTables))i.type==="csv"||lue(i)||("charts"in i&&e.push(i),i.type==="subtype-group"&&e.push(...i.sublayers));return e}function Ndt(t,e){return null}function Joi(t){return null}function rie(t){return!t||t.type==="Feature Service"&&!t.sourceUrl}function Qoi(t,e){!e||!rie(t)||Ndt(t.url)}const Vdt=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wcs","wms","wmts"]),jdt=new Set(["integrated-mesh-3dtiles"]),U4e=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","parquet","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","video","web-tile","wcs","wfs","wms","wmts"]),Udt=new Set([...U4e,"link-chart"]);function Bdt(t){switch(t.layerContainerType){case"basemap-base-layers":return Vdt;case"basemap-ground-layers":return jdt;case"operational-layers":return t.origin==="link-chart"?Udt:U4e;default:return null}}function qdt(t,e){if(e.restrictedWebMapWriting){const i=Bdt(e);return i==null||i.has(t.type)&&!yF(t)}return!0}function Gdt(t,e){if(e)if(yF(t)){const i=jL("featureCollection.layers",e),r=i?.[0]?.layerDefinition;r&&zwe(t,r)}else t.type!=="group"&&zwe(t,e)}function zwe(t,e){"maxScale"in t&&(e.maxScale=lq(t.maxScale)??void 0),"minScale"in t&&(e.minScale=lq(t.minScale)??void 0)}function Hdt(t,e){if(Gdt(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=lq(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(yF(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function lU(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i?.messages&&i.messages.push(new q("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(yF(t)&&!t.isTable)e=t.resourceInfo;else if(qdt(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&Hdt(t,e=se(e)),e}var Nwe,RM,ZS;let hu=(ZS=class extends iy($$){constructor(e){super(e),this[Nwe]=!0,this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.type="Basemap",this.id=Date.now().toString(16)+"-basemap-"+RM.idCounter++,this.baseLayers=new ke,this.referenceLayers=new ke,this.groundLayers=new ke;const i=o=>{const{parent:l}=o;l&&l!==this&&"remove"in l&&l.remove?.(o),o.parent=this,o.type!=="elevation"&&o.type!=="integrated-mesh-3dtiles"||re.getLogger(this).error(`Layer '${o.title}, id:${o.id}' of type '${o.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=o=>{const{parent:l}=o;l&&l!==this&&"remove"in l&&l.remove?.(o),o.parent=this},s=o=>{const l=o.item;return l.parent===this?(re.getLogger(this).error(`Layer '${l.title}, id:${l.id}' of type '${l.type}' already a ground layer, second add will be ignored.`),void o.preventDefault()):l.type!=="integrated-mesh-3dtiles"&&l.type!=="integrated-mesh"?(re.getLogger(this).error(`Layer '${l.title}, id:${l.id}' of type '${l.type}' is not supported as a ground layer and will therefore be ignored.`),void o.preventDefault()):void 0},n=o=>{o.parent=null},a=o=>{o.parent===this&&(o.parent=null)};this.addHandles([this.baseLayers.on("after-add",o=>i(o.item)),this.baseLayers.on("after-remove",o=>n(o.item)),this.referenceLayers.on("after-add",o=>i(o.item)),this.referenceLayers.on("after-remove",o=>n(o.item)),this.groundLayers.on("before-add",s),this.groundLayers.on("after-add",o=>r(o.item)),this.groundLayers.on("after-remove",o=>a(o.item))])}initialize(){this.when().catch(e=>{re.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const s of e)s.destroyed||s.destroy();const i=this.groundLayers.toArray();for(const s of i)s.destroyed||s.destroy();const r=this.referenceLayers.toArray();for(const s of r)s.destroyed||s.destroy();this.baseLayers.destroy(),this.groundLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Pe(this.portalItem)}removeChildLayer(e){for(const i of[this.baseLayers,this.referenceLayers,this.groundLayers])i.remove(e)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",ju(e,this._get("baseLayers")))}_writeBaseLayers(e,i,r){const s=[];e&&(r={...r,layerContainerType:"basemap-base-layers"},this.baseLayers.forEach(n=>{const a=lU(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);a!=null&&s.push(a)}),this.referenceLayers.forEach(n=>{const a=lU(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);a!=null&&(n.type!=="scene"&&(a.isReference=!0),s.push(a))})),i.baseMapLayers=s}set groundLayers(e){this._set("groundLayers",ju(e,this._get("groundLayers")))}_writeGroundLayers(e,i,r){const s=[];e&&(r={...r,layerContainerType:"basemap-ground-layers"},this.groundLayers.forEach(n=>{const a=lU(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);a!=null&&s.push(a)}),s.length>0&&(i.groundLayers=s))}get loaded(){return super.loaded}set referenceLayers(e){this._set("referenceLayers",ju(e,this._get("referenceLayers")))}writeTitle(e,i){i.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return mF(this,e=>{e(this.baseLayers,this.groundLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(i=>d4(i)?i.clone():i),groundLayers:this.groundLayers.map(i=>d4(i)?i.clone():i),referenceLayers:this.referenceLayers.map(i=>d4(i)?i.clone():i)};return this.loaded&&(e.loadStatus="loaded"),new RM({resourceInfo:this.resourceInfo}).set(e)}read(e,i){this.resourceInfo||this._set("resourceInfo",{data:e,context:i}),super.read(e,i)}write(e,i){return e=e||{},i?.origin||(i={origin:"web-map",...i}),super.write(e,i),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const s=se(r);return s.url&&Wg(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&Wg(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),e}async _loadFromSource(e){const{resourceInfo:i,portalItem:r,style:s}=this;ct(e);const n=[];if(i){const a=i.context?i.context.url:null;if(n.push(this._loadLayersFromJSON(i.data,a,e)),i.data.id&&!i.data.title){const o=i.data.id;n.push(xdt(o).then(l=>{l&&this.read({title:l},i.context)}))}}else r?n.push(this._loadFromItem(r,e)):s&&n.push(this._loadFromStylesService(s,e));await Promise.all(n)}async _loadLayersFromJSON(e,i,r){const s=this.resourceInfo?.context,n=this.portalItem?.portal||s?.portal||null,a=Zdt[s?.origin||""]??"web-map",{populateOperationalLayers:o}=await W(async()=>{const{populateOperationalLayers:u}=await import("./layersCreator-C-Zqm3pA.js");return{populateOperationalLayers:u}},__vite__mapDeps([130,127,126,125,128,124])),l=[];if(ct(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const u={context:{...s,origin:a,url:i,portal:n,layerContainerType:"basemap-base-layers"},defaultLayerType:"DefaultTileLayer"},d=v=>a==="web-scene"&&v.layerType==="ArcGISSceneServiceLayer"||v.isReference,f=o(this.baseLayers,e.baseMapLayers.filter(v=>!d(v)),u);l.push(f);const g=o(this.referenceLayers,e.baseMapLayers.filter(d),u);l.push(g)}if(e.groundLayers&&Array.isArray(e.groundLayers)){const u={context:{...s,origin:a,url:i,portal:n,layerContainerType:"basemap-ground-layers"},defaultLayerType:"IntegratedMesh3DTilesLayer"},d=o(this.groundLayers,e.groundLayers,u);l.push(d)}await Promise.allSettled(l)}async _loadFromItem(e,i){const r=await e.load(i),s=await r.fetchData("json",i),n=kn(e.itemUrl??"");return this._set("resourceInfo",{data:s.baseMap??{},context:{origin:Wdt[e.type||""]??"web-map",portal:e.portal||ze.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:s.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||ze.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,i)}async _loadFromStylesService(e,i){const r=e.serviceUrl.endsWith("/webmaps")?e.serviceUrl.slice(0,-8):e.serviceUrl,s=`${r}/styles/${e.id}/self`,n=`${r}/webmaps/${e.id}`,a=e.apiKey??fr.apiKeys.basemapStyles,[o,l]=await Promise.all([(await Si(s,{query:{token:a},signal:i?.signal})).data,(await Si(n,{query:{language:e.languageParameter,places:e.places,worldview:e.worldview,token:a},signal:i?.signal})).data]);this.thumbnailUrl??=o.thumbnailUrl;const u=kn(n);if(this._set("resourceInfo",{data:l.baseMap??{},context:{origin:"web-map",url:u}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:l.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,u,i),a)for(const d of[...this.baseLayers,...this.groundLayers,...this.referenceLayers])"apiKey"in d&&(d.apiKey=a)}static fromId(e){const i=tie[e];return i?i.itemId?new RM({portalItem:{id:i.itemId,portal:{url:"https://www.arcgis.com"}}}):RM.fromJSON(i,i.is3d?{origin:"web-scene",portal:new ze({url:"https://www.arcgis.com"})}:{origin:"web-map"}):null}},Nwe=I4e,RM=ZS,ZS.idCounter=0,ZS);c([p({json:{read:!1,write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ke}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],hu.prototype,"baseLayers",null),c([p({json:{read:!1,write:{ignoreOrigin:!0,target:"groundLayers",writer(t,e,i,r){this._writeGroundLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{groundLayers:{type:ke}},writer(t,e,i,r){this._writeGroundLayers(t,e,r)}}}}}})],hu.prototype,"groundLayers",null),c([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],hu.prototype,"id",void 0),c([p({type:qt})],hu.prototype,"portalItem",void 0),c([p()],hu.prototype,"referenceLayers",null),c([p({readOnly:!0})],hu.prototype,"resourceInfo",void 0),c([p({type:Me})],hu.prototype,"spatialReference",void 0),c([p({type:Sdt})],hu.prototype,"style",void 0),c([p()],hu.prototype,"thumbnailUrl",void 0),c([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],hu.prototype,"title",void 0),c([Ie("title")],hu.prototype,"writeTitle",null),hu=RM=c([R("esri.Basemap")],hu);const Wdt={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},Zdt={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},ZE=hu,Ydt=Object.freeze(Object.defineProperty({__proto__:null,default:ZE},Symbol.toStringTag,{value:"Module"})),Pq={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function B4e(t){return!!Pq[t]||!!Pq[t.toLowerCase()]}function uue(t){return Pq[t]??Pq[t.toLowerCase()]}function Jdt(t){return[...uue(t)]}function SJ(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function q4e(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,a=2*i-n;return[Math.round(255*SJ(a,n,s+1/3)),Math.round(255*SJ(a,n,s)),Math.round(255*SJ(a,n,s-1/3)),r]}function Qdt(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let a=+("0x"+t.slice(1));if(isNaN(a))return null;const o=[0,0,0,1];let l;return n&&(l=a&r,a>>=i,o[3]=s*l/255),l=a&r,a>>=i,o[2]=s*l,l=a&r,a>>=i,o[1]=s*l,l=a&r,a>>=i,o[0]=s*l,o}function G4e(t){if(!t.startsWith("#")||isNaN(+`0x${t.slice(1)}`))return null;switch(t.length){case 4:case 5:{const e=parseInt(t.slice(1,2),16),i=parseInt(t.slice(2,3),16),r=parseInt(t.slice(3,4),16),s=t.length===4?15:parseInt(t.slice(4),16);return[e+16*e,i+16*i,r+16*r,(s+16*s)/255]}case 7:case 9:return[parseInt(t.slice(1,3),16),parseInt(t.slice(3,5),16),parseInt(t.slice(5,7),16),(t.length===7?255:parseInt(t.slice(7),16))/255];default:return null}}function H4e(t){const e=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(e){const i=e[2].split(/\s*,\s*/),r=e[1];if(r==="rgb"&&i.length===3||r==="rgba"&&i.length===4){if(i[0].endsWith("%")){const s=i.map(n=>2.56*parseFloat(n));return i.length===4&&(s[3]=parseFloat(i[3])),Vwe(s)}return Vwe(i.map(s=>parseFloat(s)))}if(r==="hsl"&&i.length===3||r==="hsla"&&i.length===4)return q4e(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100,parseFloat(i[3]??"1"))}return null}function Vwe(t){return t[0]=YE(t[0]),t[1]=YE(t[1]),t[2]=YE(t[2]),t[3]=t.length===4?Z4e(t[3]):1,t}function W4e(t){let e=B4e(t)?uue(t):null;return e??=H4e(t),e??=G4e(t),e}function Xoi(t){const e=W4e(t);return e!=null?[e[0]/255,e[1]/255,e[2]/255,e[3]]:null}function Z4e(t){return Y4e(t,0,1)}function YE(t){return Math.round(Y4e(t,0,255))}function Y4e(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}const EO=2.2,Xdt=1/EO;function Koi(t){return t**EO}function eli(t){return t**Xdt}function HN(t){return Ce(Lle(t),0,255)}function WN(t,e){const i=t.toString(16).padStart(2,"0");return e?i.slice(0,1):i}let Je=class $d{static blendColors(e,i,r,s=new $d){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=H4e(e);return r?$d.fromArray(r,i):null}static fromHex(e,i=new $d){const r=G4e(e);return r?$d.fromArray(r,i):null}static fromArray(e,i=new $d){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=W4e(e);return r?$d.fromArray(r,i):null}static fromJSON(e){return e!=null?new $d([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e,i){return e==null?null:(i??=[0,0,0,0],i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[3]=e.a!=null?e.a:1,i)}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?$d.fromString(e,this):Array.isArray(e)?$d.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof $d||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=e?.capitalize??!1,r=e?.digits??6,s=r===3||r===4,n=r===4||r===8,a=`#${WN(this.r,s)}${WN(this.g,s)}${WN(this.b,s)}${n?WN(Math.round(255*this.a),s):""}`;return i?a.toUpperCase():a}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=0){const i=HN(this.r),r=HN(this.g),s=HN(this.b);return e===0||this.a!==1?[i,r,s,HN(255*this.a)]:[i,r,s]}clone(){return new $d(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=YE(this.r),this.g=YE(this.g),this.b=YE(this.b),this.a=Z4e(this.a),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};Je.prototype.declaredClass="esri.Color";function st(t,e={}){const i=t instanceof ii?t:new ii(t,e),{alwaysWriteDefaults:r,default:s,ignoreUnknown:n=!0,name:a,nonNullable:o,readOnly:l=!1}=e;return p({type:n?i.apiValues:String,json:{type:i.jsonValues,default:s,name:a,read:!l&&{reader:i.read},write:{writer:i.write,alwaysWriteDefaults:r}},nonNullable:o,readOnly:l})}var sie;let cU=sie=class extends ae{constructor(t){super(t),this.type="none"}clone(){return new sie({type:this.type})}};c([st({none:"none",stayAbove:"stay-above"}),p({json:{write:{isRequired:!0}}})],cU.prototype,"type",void 0),cU=sie=c([R("esri.ground.NavigationConstraint")],cU);const J4e=Symbol("GroundInstance");function Kdt(t){return t!=null&&typeof t=="object"&&J4e in t}function vF(t){const e=Lle(100*(1-t));return Math.max(0,Math.min(e,100))}function AO(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var jwe,nie,HAe;let Cd=nie=(HAe=class extends iy($$){constructor(t){super(t),this[jwe]=!0,this.parent=null,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ke;const e=r=>{const{parent:s}=r;s&&s!==this&&"remove"in s&&s.remove?.(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&re.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))]),this.allLayers=new op({getCollections:()=>[this.layers,this.parent?.basemap?.groundLayers]})}removeChildLayer(t){this.layers.remove(t)}initialize(){this.when().catch(t=>{Zr(t)||re.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}get integratedMeshGround(){const t=this.parent?.basemap?.groundLayers.at(0);return t?.replacesTerrain?t:null}destroy(){const t=this.layers.removeAll();for(const e of t)Pe(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}get loaded(){return super.loaded}get layers(){return this._get("layers")}set layers(t){this._set("layers",ju(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const a={};Eet(n)().write(a,r)&&s.push(a)}else r?.messages&&r.messages.push(new q("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return mF(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{queryAll:i}=await W(()=>Promise.resolve().then(()=>iMe),void 0);return ct(e),i(this.layers.filter(Uwe).toArray(),t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{createSampler:i}=await W(()=>Promise.resolve().then(()=>iMe),void 0);return ct(e),i(this.layers.filter(Uwe).toArray(),t,e)}clone(){const t={opacity:this.opacity,surfaceColor:se(this.surfaceColor),navigationConstraint:se(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new nie({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=e?.origin||"web-scene",s=e?.portal||null,n=e?.url||null,{populateOperationalLayers:a}=await W(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-C-Zqm3pA.js");return{populateOperationalLayers:l}},__vite__mapDeps([130,127,126,125,128,124]));ct(i);const o=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};o.push(a(this.layers,t.layers,l))}await Promise.allSettled(o)}},jwe=J4e,HAe);function Uwe(t){return t&&"createElevationSampler"in t}c([p()],Cd.prototype,"parent",void 0),c([p()],Cd.prototype,"integratedMeshGround",null),c([p({json:{read:!1,write:{isRequired:!0}}})],Cd.prototype,"layers",null),c([p()],Cd.prototype,"allLayers",void 0),c([Ie("layers")],Cd.prototype,"writeLayers",null),c([p({readOnly:!0})],Cd.prototype,"resourceInfo",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:vi,read:{reader:AO,source:"transparency"},write:{writer:(t,e)=>{e.transparency=vF(t)},target:"transparency"}}})],Cd.prototype,"opacity",void 0),c([p({type:Je,json:{type:[vi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Cd.prototype,"surfaceColor",void 0),c([p({type:cU,json:{write:!0}})],Cd.prototype,"navigationConstraint",void 0),Cd=nie=c([R("esri.Ground")],Cd);const V5=Cd,ept="randomUUID"in crypto;function I1(){if(ept)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function tli(){return`{${I1().toUpperCase()}}`}function tpt(){return`{${I1()}}`}function ipt(t){const e=t.toUpperCase();return t.startsWith("{")?e:`{${e}}`}const CC={Base64:0,Hex:1,String:2,Raw:3},JE=8,Q4e=(1<<JE)-1;function pw(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function rpt(t){const e=[];for(let i=0,r=t.length*JE;i<r;i+=JE)e[i>>5]|=(t.charCodeAt(i/JE)&Q4e)<<i%32;return e}function spt(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=JE)e.push(String.fromCharCode(t[i>>5]>>>i%32&Q4e));return e.join("")}function npt(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function apt(t){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const a=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let o=0;o<4;o++)8*s+6*o>32*t.length?r.push("="):r.push(i.charAt(a>>6*(3-o)&63))}return r.join("")}function opt(t,e){return t<<e|t>>>32-e}function C7(t,e,i,r,s,n){return pw(opt(pw(pw(e,t),pw(r,n)),s),i)}function Al(t,e,i,r,s,n,a){return C7(e&i|~e&r,t,e,s,n,a)}function Ol(t,e,i,r,s,n,a){return C7(e&r|i&~r,t,e,s,n,a)}function Pl(t,e,i,r,s,n,a){return C7(e^i^r,t,e,s,n,a)}function Rl(t,e,i,r,s,n,a){return C7(i^(e|~r),t,e,s,n,a)}function lpt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let a=0;a<t.length;a+=16){const o=i,l=r,u=s,d=n;i=Al(i,r,s,n,t[a],7,-680876936),n=Al(n,i,r,s,t[a+1],12,-389564586),s=Al(s,n,i,r,t[a+2],17,606105819),r=Al(r,s,n,i,t[a+3],22,-1044525330),i=Al(i,r,s,n,t[a+4],7,-176418897),n=Al(n,i,r,s,t[a+5],12,1200080426),s=Al(s,n,i,r,t[a+6],17,-1473231341),r=Al(r,s,n,i,t[a+7],22,-45705983),i=Al(i,r,s,n,t[a+8],7,1770035416),n=Al(n,i,r,s,t[a+9],12,-1958414417),s=Al(s,n,i,r,t[a+10],17,-42063),r=Al(r,s,n,i,t[a+11],22,-1990404162),i=Al(i,r,s,n,t[a+12],7,1804603682),n=Al(n,i,r,s,t[a+13],12,-40341101),s=Al(s,n,i,r,t[a+14],17,-1502002290),r=Al(r,s,n,i,t[a+15],22,1236535329),i=Ol(i,r,s,n,t[a+1],5,-165796510),n=Ol(n,i,r,s,t[a+6],9,-1069501632),s=Ol(s,n,i,r,t[a+11],14,643717713),r=Ol(r,s,n,i,t[a],20,-373897302),i=Ol(i,r,s,n,t[a+5],5,-701558691),n=Ol(n,i,r,s,t[a+10],9,38016083),s=Ol(s,n,i,r,t[a+15],14,-660478335),r=Ol(r,s,n,i,t[a+4],20,-405537848),i=Ol(i,r,s,n,t[a+9],5,568446438),n=Ol(n,i,r,s,t[a+14],9,-1019803690),s=Ol(s,n,i,r,t[a+3],14,-187363961),r=Ol(r,s,n,i,t[a+8],20,1163531501),i=Ol(i,r,s,n,t[a+13],5,-1444681467),n=Ol(n,i,r,s,t[a+2],9,-51403784),s=Ol(s,n,i,r,t[a+7],14,1735328473),r=Ol(r,s,n,i,t[a+12],20,-1926607734),i=Pl(i,r,s,n,t[a+5],4,-378558),n=Pl(n,i,r,s,t[a+8],11,-2022574463),s=Pl(s,n,i,r,t[a+11],16,1839030562),r=Pl(r,s,n,i,t[a+14],23,-35309556),i=Pl(i,r,s,n,t[a+1],4,-1530992060),n=Pl(n,i,r,s,t[a+4],11,1272893353),s=Pl(s,n,i,r,t[a+7],16,-155497632),r=Pl(r,s,n,i,t[a+10],23,-1094730640),i=Pl(i,r,s,n,t[a+13],4,681279174),n=Pl(n,i,r,s,t[a],11,-358537222),s=Pl(s,n,i,r,t[a+3],16,-722521979),r=Pl(r,s,n,i,t[a+6],23,76029189),i=Pl(i,r,s,n,t[a+9],4,-640364487),n=Pl(n,i,r,s,t[a+12],11,-421815835),s=Pl(s,n,i,r,t[a+15],16,530742520),r=Pl(r,s,n,i,t[a+2],23,-995338651),i=Rl(i,r,s,n,t[a],6,-198630844),n=Rl(n,i,r,s,t[a+7],10,1126891415),s=Rl(s,n,i,r,t[a+14],15,-1416354905),r=Rl(r,s,n,i,t[a+5],21,-57434055),i=Rl(i,r,s,n,t[a+12],6,1700485571),n=Rl(n,i,r,s,t[a+3],10,-1894986606),s=Rl(s,n,i,r,t[a+10],15,-1051523),r=Rl(r,s,n,i,t[a+1],21,-2054922799),i=Rl(i,r,s,n,t[a+8],6,1873313359),n=Rl(n,i,r,s,t[a+15],10,-30611744),s=Rl(s,n,i,r,t[a+6],15,-1560198380),r=Rl(r,s,n,i,t[a+13],21,1309151649),i=Rl(i,r,s,n,t[a+4],6,-145523070),n=Rl(n,i,r,s,t[a+11],10,-1120210379),s=Rl(s,n,i,r,t[a+2],15,718787259),r=Rl(r,s,n,i,t[a+9],21,-343485551),i=pw(i,o),r=pw(r,l),s=pw(s,u),n=pw(n,d)}return[i,r,s,n]}function hue(t,e=CC.Hex){const i=e||CC.Base64,r=lpt(rpt(t),t.length*JE);switch(i){case CC.Raw:return r;case CC.Hex:return npt(r);case CC.String:return spt(r);case CC.Base64:return apt(r)}}function X4e(t){return t&&"getAtOrigin"in t&&"originOf"in t}function aie(t){return due[cpt(t)]||hpt}function cpt(t){return t.type==="json"?"application/json":t.type==="blob"?t.blob.type:upt(t.url)}function upt(t){const e=Kle(t);return oie[e]||K4e}const due={},K4e="text/plain",hpt=due[K4e],oie={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in oie)due[oie[t]]=t;function dpt(t){const e=t?.origins??[void 0];return(i,r)=>{const s=ppt(t,i,r);for(const n of e){const a=Fle(i,n,r);for(const o in s)a[o]=s[o]}}}function ppt(t,e,i){if(t?.type==="resource")return fpt(t,e,i);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:r,write:s}=Jrt;return{read:r,write:s}}}}function fpt(t,e,i){const r=YL(e,i);return{type:String,read:(s,n,a)=>{const o=t7(s,n,a);return r.type===String?o:typeof r.type=="function"?new r.type({url:o}):void 0},write:{isRequired:r.json?.write?.isRequired,writer(s,n,a,o){if(!o?.resources)return typeof s=="string"?void(n[a]=HT(s,o)):void(n[a]=s.write({},o));const l=ypt(s),u=HT(l,{...o,verifyItemRelativeUrls:o?.verifyItemRelativeUrls?{writtenUrls:o.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},1),d=r.type!==String&&(!X4e(this)||o?.origin&&this.originIdOf(i)>l0(o.origin)),f={object:this,propertyName:i,value:s,targetUrl:u,dest:n,targetPropertyName:a,context:o,params:t};o?.portalItem&&u&&!Nu(u)?d&&t?.contentAddressed?lie(f):d?mpt(f):gpt(f):o?.portalItem&&(u==null||RRe(u)!=null||e1(u)||d)?lie(f):n[a]=u}}}}function lie(t){const{targetUrl:e,params:i,value:r,context:s,dest:n,targetPropertyName:a}=t;if(!s.portalItem)return;const o=IRe(e),l=t5e(r,e,s);if(i?.contentAddressed&&l.type!=="json")return void s.messages?.push(new q("persistable:contentAddressingUnsupported",`Property "${a}" is trying to serializing a resource with content of type ${l.type} with content addressing. Content addressing is only supported for json resources.`,{content:l}));const u=i?.contentAddressed&&l.type==="json"?hue(l.jsonString):o?.filename??I1(),d=Xh(i?.prefix??o?.prefix,u),f=`${d}.${aie(l)}`;if(i?.contentAddressed&&s.resources&&l.type==="json"){const _=s.resources.toKeep.find(({resource:x})=>x.path===f)??s.resources.toAdd.find(({resource:x})=>x.path===f);if(_)return void(n[a]=_.resource.itemRelativeUrl)}const g=s.portalItem.resourceFromPath(f);e1(e)&&s.resources&&s.resources.pendingOperations.push(Frt(e).then(_=>{g.path=`${d}.${aie({type:"blob",blob:_})}`,n[a]=g.itemRelativeUrl}).catch(()=>{}));const v=i?.compress??!1;s.resources&&e5e({...t,resource:g,content:l,compress:v,updates:s.resources.toAdd}),n[a]=g.itemRelativeUrl}function mpt(t){const{context:e,targetUrl:i,params:r,value:s,dest:n,targetPropertyName:a}=t;if(!e.portalItem)return;const o=e.portalItem.resourceFromPath(i),l=t5e(s,i,e),u=aie(l),d=Kle(o.path),f=r?.compress??!1;u===d?(e.resources&&e5e({...t,resource:o,content:l,compress:f,updates:e.resources.toUpdate}),n[a]=i):lie(t)}function gpt({context:t,targetUrl:e,dest:i,targetPropertyName:r}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),i[r]=e)}function e5e({object:t,propertyName:e,updates:i,resource:r,content:s,compress:n}){const a=o=>{vpt(t,e,o)};i.push({resource:r,content:s,compress:n,finish:a})}function t5e(t,e,i){return typeof t=="string"?{type:"url",url:e}:{type:"json",jsonString:JSON.stringify(t.toJSON(i))}}function ypt(t){return t==null?null:typeof t=="string"?t:t.url}function vpt(t,e,i){typeof t[e]=="string"?t[e]=i.url:t[e].url=i.url}let uU=class extends nt(ae){constructor(e){super(e),this.color=null}};c([p({type:Je,json:{type:[vi],write:!0}})],uU.prototype,"color",void 0),uU=c([R("esri.effects.FocusAreaOutline")],uU);const _pt=uU;var hU;let cie=hU=class extends iy(ke.ofType(Wr)){constructor(t){super(t)}clone(){return new hU(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){const e=t?.layer?.spatialReference;return e?this.toArray().map(i=>{if(!e.equals(i.spatialReference)){if(!Zc(i.spatialReference,e))return t?.messages?.push(new Gu("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const s=new Wr;e4e(i,s,e),i=s}const r=i.toJSON(t);return delete r.spatialReference,r}).filter(i=>i!=null):this.toArray().map(i=>i.toJSON(t))}static fromJSON(t,e){const i=new hU;return t.forEach(r=>i.add(Wr.fromJSON(r,e))),i}};cie=hU=c([R("esri.layers.support.PolygonCollection")],cie);const x4=cie;let Xy=class extends iy(E1){constructor(e){super(e),this.id=`focusarea-${I1()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new x4}readGeometries(e,i,r){Array.isArray(e)?this.geometries=x4.fromJSON(e,r):r.origin!=="web-scene"&&r.origin!=="portal-item"||r.hooks?.onAfterLoad?.(()=>this._loadGeometries(y$(e,r),r))}async _loadGeometries(e,i){const r=await Si(e,{responseType:"json"});this.geometries=x4.fromJSON(r.data,i)}};c([p({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),p()],Xy.prototype,"id",void 0),c([p({type:String,json:{write:!0}})],Xy.prototype,"title",void 0),c([p({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],Xy.prototype,"enabled",void 0),c([p({type:_pt,json:{write:!0}})],Xy.prototype,"outline",void 0),c([p({type:x4,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:t=>new x4(t.items.map(e=>e.clone()))}),dpt({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],Xy.prototype,"geometries",void 0),c([Oe(["web-scene","portal-item","service"],"geometries")],Xy.prototype,"readGeometries",null),Xy=c([R("esri.effects.FocusArea")],Xy);const bpt=Xy;let _D=class extends iy(E1){constructor(e){super(e),this.areas=new ke,this.style="bright"}};c([p({type:ke.ofType(bpt),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:t=>new ke(t.items.map(e=>e.clone()))})],_D.prototype,"areas",void 0),c([p({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],_D.prototype,"style",void 0),_D=c([R("esri.effects.FocusAreas")],_D);const i5e=_D;function wpt(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function r5e(t){return!(!wpt(t)||!kdt(t)?.operations?.supportsEditing||"editingEnabled"in t&&!Fdt(t)||lue(t))}function M7(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function xpt(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Spt(t,e,i,r,s,n,a,o,l,u,d,f,g,v,_,x){const S=new Float32Array(16);return S[0]=t,S[1]=e,S[2]=i,S[3]=r,S[4]=s,S[5]=n,S[6]=a,S[7]=o,S[8]=l,S[9]=u,S[10]=d,S[11]=f,S[12]=g,S[13]=v,S[14]=_,S[15]=x,S}const Tpt=M7();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Tpt,clone:xpt,create:M7,fromValues:Spt},Symbol.toStringTag,{value:"Module"}));function Ln(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function sy(t,e,i,r,s,n,a,o,l,u,d,f,g,v,_,x,S){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=a,t[6]=o,t[7]=l,t[8]=u,t[9]=d,t[10]=f,t[11]=g,t[12]=v,t[13]=_,t[14]=x,t[15]=S,t}function lm(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Yc(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function s5e(t,e){return Kl(t,e)||lm(t),t}function Kl(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],u=e[7],d=e[8],f=e[9],g=e[10],v=e[11],_=e[12],x=e[13],S=e[14],T=e[15],M=i*o-r*a,E=i*l-s*a,P=i*u-n*a,O=r*l-s*o,D=r*u-n*o,L=s*u-n*l,F=d*x-f*_,j=d*S-g*_,N=d*T-v*_,B=f*S-g*x,U=f*T-v*x,Q=g*T-v*S;let H=M*Q-E*U+P*B+O*N-D*j+L*F;return H?(H=1/H,t[0]=(o*Q-l*U+u*B)*H,t[1]=(s*U-r*Q-n*B)*H,t[2]=(x*L-S*D+T*O)*H,t[3]=(g*D-f*L-v*O)*H,t[4]=(l*N-a*Q-u*j)*H,t[5]=(i*Q-s*N+n*j)*H,t[6]=(S*P-_*L-T*E)*H,t[7]=(d*L-g*P+v*E)*H,t[8]=(a*U-o*N+u*F)*H,t[9]=(r*N-i*U-n*F)*H,t[10]=(_*D-x*P+T*M)*H,t[11]=(f*P-d*D-v*M)*H,t[12]=(o*j-a*B-l*F)*H,t[13]=(i*B-r*j+s*F)*H,t[14]=(x*E-_*O-S*M)*H,t[15]=(d*O-f*E+g*M)*H,t):null}function $pt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],u=e[7],d=e[8],f=e[9],g=e[10],v=e[11],_=e[12],x=e[13],S=e[14],T=e[15];return t[0]=o*(g*T-v*S)-f*(l*T-u*S)+x*(l*v-u*g),t[1]=-(r*(g*T-v*S)-f*(s*T-n*S)+x*(s*v-n*g)),t[2]=r*(l*T-u*S)-o*(s*T-n*S)+x*(s*u-n*l),t[3]=-(r*(l*v-u*g)-o*(s*v-n*g)+f*(s*u-n*l)),t[4]=-(a*(g*T-v*S)-d*(l*T-u*S)+_*(l*v-u*g)),t[5]=i*(g*T-v*S)-d*(s*T-n*S)+_*(s*v-n*g),t[6]=-(i*(l*T-u*S)-a*(s*T-n*S)+_*(s*u-n*l)),t[7]=i*(l*v-u*g)-a*(s*v-n*g)+d*(s*u-n*l),t[8]=a*(f*T-v*x)-d*(o*T-u*x)+_*(o*v-u*f),t[9]=-(i*(f*T-v*x)-d*(r*T-n*x)+_*(r*v-n*f)),t[10]=i*(o*T-u*x)-a*(r*T-n*x)+_*(r*u-n*o),t[11]=-(i*(o*v-u*f)-a*(r*v-n*f)+d*(r*u-n*o)),t[12]=-(a*(f*S-g*x)-d*(o*S-l*x)+_*(o*g-l*f)),t[13]=i*(f*S-g*x)-d*(r*S-s*x)+_*(r*g-s*f),t[14]=-(i*(o*S-l*x)-a*(r*S-s*x)+_*(r*l-s*o)),t[15]=i*(o*g-l*f)-a*(r*g-s*f)+d*(r*l-s*o),t}function Cpt(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],l=t[7],u=t[8],d=t[9],f=t[10],g=t[11],v=t[12],_=t[13],x=t[14],S=t[15];return(e*a-i*n)*(f*S-g*x)-(e*o-r*n)*(d*S-g*_)+(e*l-s*n)*(d*x-f*_)+(i*o-r*a)*(u*S-g*v)-(i*l-s*a)*(u*x-f*v)+(r*l-s*o)*(u*_-d*v)}function Cn(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=e[6],d=e[7],f=e[8],g=e[9],v=e[10],_=e[11],x=e[12],S=e[13],T=e[14],M=e[15];let E=i[0],P=i[1],O=i[2],D=i[3];return t[0]=E*r+P*o+O*f+D*x,t[1]=E*s+P*l+O*g+D*S,t[2]=E*n+P*u+O*v+D*T,t[3]=E*a+P*d+O*_+D*M,E=i[4],P=i[5],O=i[6],D=i[7],t[4]=E*r+P*o+O*f+D*x,t[5]=E*s+P*l+O*g+D*S,t[6]=E*n+P*u+O*v+D*T,t[7]=E*a+P*d+O*_+D*M,E=i[8],P=i[9],O=i[10],D=i[11],t[8]=E*r+P*o+O*f+D*x,t[9]=E*s+P*l+O*g+D*S,t[10]=E*n+P*u+O*v+D*T,t[11]=E*a+P*d+O*_+D*M,E=i[12],P=i[13],O=i[14],D=i[15],t[12]=E*r+P*o+O*f+D*x,t[13]=E*s+P*l+O*g+D*S,t[14]=E*n+P*u+O*v+D*T,t[15]=E*a+P*d+O*_+D*M,t}function $p(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const a=e[0],o=e[1],l=e[2],u=e[3],d=e[4],f=e[5],g=e[6],v=e[7],_=e[8],x=e[9],S=e[10],T=e[11];t[0]=a,t[1]=o,t[2]=l,t[3]=u,t[4]=d,t[5]=f,t[6]=g,t[7]=v,t[8]=_,t[9]=x,t[10]=S,t[11]=T,t[12]=a*r+d*s+_*n+e[12],t[13]=o*r+f*s+x*n+e[13],t[14]=l*r+g*s+S*n+e[14],t[15]=u*r+v*s+T*n+e[15]}return t}function n5e(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Uh(t,e,i,r){let s=r[0],n=r[1],a=r[2],o=Math.sqrt(s*s+n*n+a*a);if(o<=_n())return void Ln(t,e);o=1/o,s*=o,n*=o,a*=o;const l=Math.sin(i),u=Math.cos(i),d=1-u,f=e[0],g=e[1],v=e[2],_=e[3],x=e[4],S=e[5],T=e[6],M=e[7],E=e[8],P=e[9],O=e[10],D=e[11],L=s*s*d+u,F=n*s*d+a*l,j=a*s*d-n*l,N=s*n*d-a*l,B=n*n*d+u,U=a*n*d+s*l,Q=s*a*d+n*l,H=n*a*d-s*l,J=a*a*d+u;t[0]=f*L+x*F+E*j,t[1]=g*L+S*F+P*j,t[2]=v*L+T*F+O*j,t[3]=_*L+M*F+D*j,t[4]=f*N+x*B+E*U,t[5]=g*N+S*B+P*U,t[6]=v*N+T*B+O*U,t[7]=_*N+M*B+D*U,t[8]=f*Q+x*H+E*J,t[9]=g*Q+S*H+P*J,t[10]=v*Q+T*H+O*J,t[11]=_*Q+M*H+D*J,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15])}function OO(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],a=e[5],o=e[6],l=e[7],u=e[8],d=e[9],f=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+u*r,t[5]=a*s+d*r,t[6]=o*s+f*r,t[7]=l*s+g*r,t[8]=u*s-n*r,t[9]=d*s-a*r,t[10]=f*s-o*r,t[11]=g*s-l*r,t}function E7(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],a=e[1],o=e[2],l=e[3],u=e[8],d=e[9],f=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-u*r,t[1]=a*s-d*r,t[2]=o*s-f*r,t[3]=l*s-g*r,t[8]=n*r+u*s,t[9]=a*r+d*s,t[10]=o*r+f*s,t[11]=l*r+g*s,t}function PO(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],a=e[1],o=e[2],l=e[3],u=e[4],d=e[5],f=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+u*r,t[1]=a*s+d*r,t[2]=o*s+f*r,t[3]=l*s+g*r,t[4]=u*s-n*r,t[5]=d*s-a*r,t[6]=f*s-o*r,t[7]=g*s-l*r,t}function A7(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Mpt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Cp(t,e,i){if(e===0)return lm(t);let r=i[0],s=i[1],n=i[2],a=Math.sqrt(r*r+s*s+n*n);if(a<=_n())return null;a=1/a,r*=a,s*=a,n*=a;const o=Math.sin(e),l=Math.cos(e),u=1-l;return t[0]=r*r*u+l,t[1]=s*r*u+n*o,t[2]=n*r*u-s*o,t[3]=0,t[4]=r*s*u-n*o,t[5]=s*s*u+l,t[6]=n*s*u+r*o,t[7]=0,t[8]=r*n*u+s*o,t[9]=s*n*u-r*o,t[10]=n*n*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ept(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Apt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function a5e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o5e(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=r+r,l=s+s,u=n+n,d=r*o,f=r*l,g=r*u,v=s*l,_=s*u,x=n*u,S=a*o,T=a*l,M=a*u;return t[0]=1-(v+x),t[1]=f+M,t[2]=g-T,t[3]=0,t[4]=f-M,t[5]=1-(d+x),t[6]=_+S,t[7]=0,t[8]=g+T,t[9]=_-S,t[10]=1-(d+v),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Opt(t,e){const i=Ppt,r=-e[0],s=-e[1],n=-e[2],a=e[3],o=e[4],l=e[5],u=e[6],d=e[7],f=r*r+s*s+n*n+a*a;return f>0?(i[0]=2*(o*a+d*r+l*n-u*s)/f,i[1]=2*(l*a+d*s+u*r-o*n)/f,i[2]=2*(u*a+d*n+o*s-l*r)/f):(i[0]=2*(o*a+d*r+l*n-u*s),i[1]=2*(l*a+d*s+u*r-o*n),i[2]=2*(u*a+d*n+o*s-l*r)),o5e(t,e,i),t}const Ppt=I();function Rpt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function l5e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],a=e[5],o=e[6],l=e[8],u=e[9],d=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+a*a+o*o),t[2]=Math.sqrt(l*l+u*u+d*d),t}function c5e(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function Ipt(t,e,i,r){const s=e[0],n=e[1],a=e[2],o=e[3],l=s+s,u=n+n,d=a+a,f=s*l,g=s*u,v=s*d,_=n*u,x=n*d,S=a*d,T=o*l,M=o*u,E=o*d,P=r[0],O=r[1],D=r[2];return t[0]=(1-(_+S))*P,t[1]=(g+E)*P,t[2]=(v-M)*P,t[3]=0,t[4]=(g-E)*O,t[5]=(1-(f+S))*O,t[6]=(x+T)*O,t[7]=0,t[8]=(v+M)*D,t[9]=(x-T)*D,t[10]=(1-(f+_))*D,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Dpt(t,e,i,r,s){const n=e[0],a=e[1],o=e[2],l=e[3],u=n+n,d=a+a,f=o+o,g=n*u,v=n*d,_=n*f,x=a*d,S=a*f,T=o*f,M=l*u,E=l*d,P=l*f,O=r[0],D=r[1],L=r[2],F=s[0],j=s[1],N=s[2],B=(1-(x+T))*O,U=(v+P)*O,Q=(_-E)*O,H=(v-P)*D,J=(1-(g+T))*D,Z=(S+M)*D,K=(_+E)*L,ee=(S-M)*L,_e=(1-(g+x))*L;return t[0]=B,t[1]=U,t[2]=Q,t[3]=0,t[4]=H,t[5]=J,t[6]=Z,t[7]=0,t[8]=K,t[9]=ee,t[10]=_e,t[11]=0,t[12]=i[0]+F-(B*F+H*j+K*N),t[13]=i[1]+j-(U*F+J*j+ee*N),t[14]=i[2]+N-(Q*F+Z*j+_e*N),t[15]=1,t}function kpt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=i+i,o=r+r,l=s+s,u=i*a,d=r*a,f=r*o,g=s*a,v=s*o,_=s*l,x=n*a,S=n*o,T=n*l;return t[0]=1-f-_,t[1]=d+T,t[2]=g-S,t[3]=0,t[4]=d-T,t[5]=1-u-_,t[6]=v+x,t[7]=0,t[8]=g+S,t[9]=v-x,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function u5e(t,e,i,r,s,n,a){const o=1/(i-e),l=1/(s-r),u=1/(n-a);return t[0]=2*n*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*o,t[9]=(s+r)*l,t[10]=(a+n)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n*2*u,t[15]=0,t}function Lpt(t,e,i,r,s){const n=1/Math.tan(e/2);let a;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(r-s),t[10]=(s+r)*a,t[14]=2*s*r*a):(t[10]=-1,t[14]=-2*r),t}function Fpt(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),l=2/(a+o),u=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(a-o)*l*.5,t[9]=(s-n)*u*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function h5e(t,e,i,r,s,n,a){const o=1/(e-i),l=1/(r-s),u=1/(n-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*o,t[13]=(s+r)*l,t[14]=(a+n)*u,t[15]=1,t}function O7(t,e,i,r){const s=e[0],n=e[1],a=e[2];let o=s-i[0],l=n-i[1],u=a-i[2];const d=_n();if(Math.abs(o)<d&&Math.abs(l)<d&&Math.abs(u)<d)return void lm(t);let f=1/Math.sqrt(o*o+l*l+u*u);o*=f,l*=f,u*=f;const g=r[0],v=r[1],_=r[2];let x=v*u-_*l,S=_*o-g*u,T=g*l-v*o;f=Math.sqrt(x*x+S*S+T*T),f?(f=1/f,x*=f,S*=f,T*=f):(x=0,S=0,T=0);let M=l*T-u*S,E=u*x-o*T,P=o*S-l*x;f=Math.sqrt(M*M+E*E+P*P),f?(f=1/f,M*=f,E*=f,P*=f):(M=0,E=0,P=0),t[0]=x,t[1]=M,t[2]=o,t[3]=0,t[4]=S,t[5]=E,t[6]=l,t[7]=0,t[8]=T,t[9]=P,t[10]=u,t[11]=0,t[12]=-(x*s+S*n+T*a),t[13]=-(M*s+E*n+P*a),t[14]=-(o*s+l*n+u*a),t[15]=1}function d5e(t,e,i,r){const s=e[0],n=e[1],a=e[2],o=r[0],l=r[1],u=r[2];let d=s-i[0],f=n-i[1],g=a-i[2],v=d*d+f*f+g*g;v>0&&(v=1/Math.sqrt(v),d*=v,f*=v,g*=v);let _=l*g-u*f,x=u*d-o*g,S=o*f-l*d;return v=_*_+x*x+S*S,v>0&&(v=1/Math.sqrt(v),_*=v,x*=v,S*=v),t[0]=_,t[1]=x,t[2]=S,t[3]=0,t[4]=f*S-g*x,t[5]=g*_-d*S,t[6]=d*x-f*_,t[7]=0,t[8]=d,t[9]=f,t[10]=g,t[11]=0,t[12]=s,t[13]=n,t[14]=a,t[15]=1,t}function zpt(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Npt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function Vpt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function p5e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function jpt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function Upt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function f5e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function pue(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],u=t[7],d=t[8],f=t[9],g=t[10],v=t[11],_=t[12],x=t[13],S=t[14],T=t[15],M=e[0],E=e[1],P=e[2],O=e[3],D=e[4],L=e[5],F=e[6],j=e[7],N=e[8],B=e[9],U=e[10],Q=e[11],H=e[12],J=e[13],Z=e[14],K=e[15],ee=_n();return Math.abs(i-M)<=ee*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(r-E)<=ee*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(s-P)<=ee*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(n-O)<=ee*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(a-D)<=ee*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(o-L)<=ee*Math.max(1,Math.abs(o),Math.abs(L))&&Math.abs(l-F)<=ee*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(u-j)<=ee*Math.max(1,Math.abs(u),Math.abs(j))&&Math.abs(d-N)<=ee*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(f-B)<=ee*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(g-U)<=ee*Math.max(1,Math.abs(g),Math.abs(U))&&Math.abs(v-Q)<=ee*Math.max(1,Math.abs(v),Math.abs(Q))&&Math.abs(_-H)<=ee*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(x-J)<=ee*Math.max(1,Math.abs(x),Math.abs(J))&&Math.abs(S-Z)<=ee*Math.max(1,Math.abs(S),Math.abs(Z))&&Math.abs(T-K)<=ee*Math.max(1,Math.abs(T),Math.abs(K))}function fue(t){const e=_n(),i=t[0],r=t[1],s=t[2],n=t[4],a=t[5],o=t[6],l=t[8],u=t[9],d=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+a*a+u*u))<=e&&Math.abs(1-(s*s+o*o+d*d))<=e}function P7(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const Bpt=Cn,qpt=p5e;Object.freeze(Object.defineProperty({__proto__:null,add:Vpt,adjoint:$pt,copy:Ln,determinant:Cpt,equals:pue,exactEquals:f5e,frob:Npt,fromQuat:kpt,fromQuat2:Opt,fromRotation:Cp,fromRotationTranslation:o5e,fromRotationTranslationScale:Ipt,fromRotationTranslationScaleOrigin:Dpt,fromScaling:Mpt,fromTranslation:A7,fromXRotation:Ept,fromYRotation:Apt,fromZRotation:a5e,frustum:u5e,getRotation:c5e,getScale:l5e,getTranslation:Rpt,hasIdentityRotation:P7,identity:lm,invert:Kl,invertOrIdentity:s5e,isOrthoNormal:fue,lookAt:O7,mul:Bpt,multiply:Cn,multiplyScalar:jpt,multiplyScalarAndAdd:Upt,ortho:h5e,perspective:Lpt,perspectiveFromFieldOfView:Fpt,rotate:Uh,rotateX:OO,rotateY:E7,rotateZ:PO,scale:n5e,set:sy,str:zpt,sub:qpt,subtract:p5e,targetTo:d5e,translate:$p,transpose:Yc},Symbol.toStringTag,{value:"Module"}));const Gpt=(t,e)=>{const i=sy(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Yc(i,i)},Hpt=(t,e)=>{const i=sy(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Yc(i,i)},Wpt=(t,e)=>{const i=1-e,r=sy(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Yc(r,r)},Zpt=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=sy(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Yc(s,s)},Ypt=(t,e)=>{const i=1-2*e,r=sy(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Yc(r,r)},Jpt=(t,e)=>{const i=sy(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Yc(i,i)},Qpt=(t,e)=>{const i=1-e,r=sy(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Yc(r,r)};let m5e=class g5e{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Mu(e.strength,i.strength,r),this.radius=Mu(e.radius,i.radius,r),this.threshold=Mu(e.threshold,i.threshold,r)}clone(){return new g5e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:S4(this.radius),strength:this.strength,threshold:this.threshold}}},y5e=class v5e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Mu(e.radius,i.radius,r))}clone(){return new v5e(this.radius)}toJSON(){return{type:"blur",radius:S4(this.radius)}}},uie=class _5e{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Mu(e.amount,i.amount,r),this._updateMatrix()}clone(){return new _5e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||M7();switch(this.type){case"brightness":this._colorMatrix=Gpt(e,this.amount);break;case"contrast":this._colorMatrix=Hpt(e,this.amount);break;case"grayscale":this._colorMatrix=Wpt(e,this.amount);break;case"invert":this._colorMatrix=Ypt(e,this.amount);break;case"saturate":this._colorMatrix=Jpt(e,this.amount);break;case"sepia":this._colorMatrix=Qpt(e,this.amount)}}},b5e=class w5e{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Mu(e.offsetX,i.offsetX,r),this.offsetY=Mu(e.offsetY,i.offsetY,r),this.blurRadius=Mu(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Mu(e.color[0],i.color[0],r)),this.color[1]=Math.round(Mu(e.color[1],i.color[1],r)),this.color[2]=Math.round(Mu(e.color[2],i.color[2],r)),this.color[3]=Mu(e.color[3],i.color[3],r)}clone(){return new w5e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:S4(this.offsetX),yoffset:S4(this.offsetY),blurRadius:S4(this.blurRadius),color:e}}},x5e=class S5e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Mu(e.angle,i.angle,r),this._updateMatrix()}clone(){return new S5e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||M7();this._colorMatrix=Zpt(e,this.angle)}},T5e=class $5e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Mu(e.amount,i.amount,r)}clone(){return new $5e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Mu(t,e,i){return t+(e-t)*i}function S4(t){return Math.round(1e3*Tp(t))/1e3}function Xpt(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new uie(t.type,0);case"saturate":case"brightness":case"contrast":return new uie(t.type,1);case"opacity":return new T5e(1);case"hue-rotate":return new x5e(0);case"blur":return new y5e(0);case"drop-shadow":return new b5e(0,0,0,[...uue("transparent")]);case"bloom":return new m5e(0,0,1)}}function Kpt(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function eft(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(Xpt(i[s]))}function tft(t){const e=t[0];return!!e&&"type"in e}function ift(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}function nli(t,e){return t.allLayerViews.find(r=>r.uid===e)?.layer.parent===t.map?.basemap}function hie(t){return!!t?.baseLayers.concat(t.referenceLayers).some(C5e)}function C5e(t){if(Bwe(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(Bwe(i?.sourceUrl))return!0}return!1}function rft(t,e){if(e==null||t==null)return{spatialReference:null,updating:!1};if(e.loadStatus==="not-loaded")return e.load(),{spatialReference:null,updating:!0};if(e.spatialReference)return{spatialReference:e.spatialReference,updating:!1};if(e.baseLayers.length===0)return{spatialReference:null,updating:!1};const i=e.baseLayers.at(0);switch(i.loadStatus){case"not-loaded":i.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in i?i.supportedSpatialReferences:null)||["tileInfo"in i?i.tileInfo?.spatialReference:i.spatialReference]).filter(Boolean),s=t.spatialReference;return s?{spatialReference:r.find(n=>s.equals(n))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}const sft=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function Bwe(t){if(!t)return!1;const e=new Ow(ku(t));return!!e.authority&&sft.test(e.authority)}function qwe(t){return{type:t.type,effect:"effect"in t?t.effect:void 0,url:aft("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null?void 0:t.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:t.type==="wmts"?t.activeLayer?.id:void 0}}function nft(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!ift(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),s=e.sublayers.at(i);if(r?.id!==s?.id||r?.visible!==s?.visible)return!1}}return!0}function aft(t){return t?pp(t).replace(/^\s*https?:/i,"").toLowerCase():""}const TJ=()=>re.getLogger("esri.support.basemapUtils");function oft(){return{}}function lft(t){for(const e in t){const i=t[e];i&&!i.destroyed&&i.destroy(),delete t[e]}}function mue(t,e){let i;if(typeof t=="string"){const r=t in tie,s=!r&&t.includes("/");if(!r&&!s){if(ste())TJ().warn(`Unable to find basemap definition for: ${t}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const n=Object.entries(tie).filter(([a,o])=>o.classic||o.is3d).map(([a])=>`"${a}"`).sort().join(", ");TJ().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`)}return null}e&&(i=e[t]),i||(i=r?ZE.fromId(t):new ZE({style:{id:t}}),e&&(e[t]=i))}else i=en(ZE,t);return i?.destroyed&&(TJ().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function cft(t,e=null){const i=mue(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=Gwe(r.baseLayers,e.baseLayers),r.referenceLayers=Gwe(r.referenceLayers,e.referenceLayers)),r}function Gwe(t,e){const i=new ke;return t.forEach(r=>{const s=e.find(n=>n.type!=="scene"&&nft(qwe(r),qwe(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function uft(t){return new op({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function ZN(t){for(const e of t.values())e?.destroy();t.clear()}const Hwe={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function hft(t){let e=null;if(typeof t=="string")if(t in Hwe){const i=Hwe[t];e=new V5({resourceInfo:{data:{layers:[i]}}})}else re.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=en(V5,t);return e}function die(t,e,i){let r,s;if(t)for(let n=0,a=t.length;n<a;n++){if(r=t.at(n),r?.[e]===i)return r;if(r?.type==="group"&&(s=die(r.layers,e,i),s))return s}}const dft=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.layers=new ke;const s=o=>{o.parent&&o.removeFromParent()},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||re.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},a=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void re.getLogger(this).error("#add()","Cannot add layer to itself.");s(o.item)}),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>a(o.item))])}destroy(){const r=this.layers.toArray();for(const s of r)s.destroy();this.layers.destroy()}removeChildLayer(r){this.layers.remove(r),super.removeChildLayer?.(r)}set layers(r){this._set("layers",ju(r,this._get("layers")))}add(r,s){const n=this.layers;if(s=n.getNextIndex(s),r instanceof zs){const a=r;a.parent===this?this.reorder(a,s):n.add(a,s)}else Ea(r)?r.then(a=>{this.destroyed||this.add(a,s)}):re.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,s){const n=this.layers;let a=n.getNextIndex(s);r.slice().forEach(o=>{o.parent!==this?(n.add(o,a),a+=1):this.reorder(o,a)})}findLayerById(r){return die(this.layers,"id",r)}findLayerByUid(r){return die(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,s){return this.layers.reorder(r,s)}layerAdded(r){}layerRemoved(r){}};return c([p()],i.prototype,"layers",null),i=c([R("esri.support.LayersMixin")],i),i},pft=new Set(["feature","subtype-group"]);function pie(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if(n?.type==="group"){const a=pie(n.tables,e,i);if(a)return a}}}const fft=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.tables=new ke,this.addHandles([this.tables.on("after-add",s=>{const n=s.item;n.parent&&n.parent!==this&&n.removeFromParent(),n.parent=this,pft.has(n.type)||re.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",s=>{s.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const s of r)s.destroy();this.tables.destroy()}removeChildLayer(r){this.tables.remove(r),super.removeChildLayer?.(r)}set tables(r){this._set("tables",ju(r,this._get("tables")))}findTableById(r){return pie(this.tables,"id",r)}findTableByUid(r){return pie(this.tables,"uid",r)}};return c([p()],i.prototype,"tables",null),i=c([R("esri.support.TablesMixin")],i),i};let Md=class extends fft(dft(Ju)){constructor(e){super(e),this.allLayers=new op({getCollections:()=>[this.basemap?.baseLayers,this.basemap?.groundLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.focusAreas=new i5e,this.allTables=uft(this),this.basemap=null,this.editableLayers=new op({getCollections:()=>[this.allLayers],itemFilterFunction:r5e}),this.ground=new V5,this._basemapCache=oft(),this.addHandles(vs(()=>this.ground,(i,r)=>{r?.parent===this&&(r.parent=null),i.parent=this},{sync:!0}))}destroy(){lft(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Pe(this.basemap),Pe(this.ground),this._set("ground",null)}castBasemap(e){return mue(e,this._basemapCache)}castGround(e){return hft(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};c([p({readOnly:!0,dependsOn:[]})],Md.prototype,"allLayers",void 0),c([p({type:i5e,nonNullable:!0,json:{write:{overridePolicy:t=>({enabled:t.areas.length>0,ignoreOrigin:!0})}}})],Md.prototype,"focusAreas",void 0),c([p({readOnly:!0})],Md.prototype,"allTables",void 0),c([p({type:ZE,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Md.prototype,"basemap",void 0),c([wi("basemap")],Md.prototype,"castBasemap",null),c([p({readOnly:!0})],Md.prototype,"editableLayers",void 0),c([p({type:V5,nonNullable:!0})],Md.prototype,"ground",void 0),c([wi("ground")],Md.prototype,"castGround",null),c([p()],Md.prototype,"undoRedo",void 0),Md=c([R("esri.Map")],Md);const gue=Md;var bD;const Rq=so()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),M5e=Rq.jsonValues.slice();Uc(M5e,"orthometric");const T4=so()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Bo=bD=class extends ae{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return Rq.write(t,e,i)}readHeightModel(t,e,i){return Rq.read(t)||(i?.messages&&i.messages.push(mft(t,{context:i})),null)}readHeightUnit(t,e,i){return T4.read(t)||(i?.messages&&i.messages.push(Wwe(t,{context:i})),null)}readHeightUnitService(t,e,i){return fce(t)||T4.read(t)||(i?.messages&&i.messages.push(Wwe(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new bD({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=uIe(e);return new bD({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new bD;return e.read(t,{origin:"web-scene"}),e}};function Wwe(t,e){return new Gu("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function mft(t,e){return new Gu("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}c([p({type:Rq.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:M5e,default:"ellipsoidal",write:{isRequired:!0}}}}})],Bo.prototype,"heightModel",void 0),c([Ie("web-scene","heightModel")],Bo.prototype,"writeHeightModel",null),c([Oe(["web-scene","service"],"heightModel")],Bo.prototype,"readHeightModel",null),c([p({type:T4.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:T4.jsonValues,write:{writer:T4.write,isRequired:!0}}}}})],Bo.prototype,"heightUnit",void 0),c([Oe("web-scene","heightUnit")],Bo.prototype,"readHeightUnit",null),c([Oe("service","heightUnit")],Bo.prototype,"readHeightUnitService",null),c([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Bo.prototype,"vertCRS",void 0),c([Oe("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Bo.prototype,"readVertCRS",null),Bo=bD=c([R("esri.geometry.HeightModelInfo")],Bo);let dU;async function gft(){return dU==null&&(dU=W(()=>import("./WhereClauseCache-C9TusnxI.js"),__vite__mapDeps([17,18])).then(t=>new t.WhereClauseCache(500,500))),dU}function yft(){dU=null}async function yue(t,e){const i=await gft(),r=i.get(t,e);if(r==null)throw i.getError(t,e);return r}function $4(t,e){return t||=null,e||=null,t==="1=1"?e??t:e==="1=1"?t??e:t&&e?`(${t}) AND (${e})`:t??e}function fie(t,e){return t||=null,e||=null,t==="1=1"||e==="1=1"||t===e?t==="1=1"?t:e:t&&e?`(${t}) OR (${e})`:t??e}function vft(t,e){return e.length===0?null:`${t} IN (${_ft(e)})`}function _ft(t){return t.map(e=>typeof e=="string"?bft(e):e).join(",")}function bft(t){return`'${t.replaceAll("'","''")}'`}function Yx(t){return typeof t=="number"}function oli(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}function lli(t){return typeof t=="boolean"}function D1(t){return typeof t=="string"||t instanceof String}function E5e(t){return t==null||D1(t)}function cli(t){return Array.isArray(t)}function A5e(t){return t?.declaredClass==="esri.Graphic"}function uli(t){return t instanceof Date}const wft="HH:mm",xft="HH:mm:ss",Sft="HH:mm:ss.SSS",Tft=[Sft,xft,wft,"TT"],$ft="yyyy-MM-dd";function Zwe(t){if(!t||!D1(t))return null;const e=gt.fromFormat(t,$ft);return e.isValid?e:null}function Ywe(t){return t&&D1(t)?ptt(Tft,e=>{const i=gt.fromFormat(t,e);return i.isValid?i:null})??null:null}function Jwe(t){if(!t||!D1(t))return null;const e=gt.fromISO(t);return e.isValid?e:null}const O5e=new Set(["integer","small-integer","long","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeLong","esriFieldTypeBigInteger"]);function Cft(t){return t!=null&&O5e.has(t.type)}function P5e(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function R5e(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function I5e(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}const Mft=new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]);Rle(O5e,Mft);function Eft(t,e){const i=t?.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=Cft(t);return P5e(t)||I5e(t)||R5e(t)?{...Aft(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function Aft(t,e,i){return P5e(t)?{min:Zwe(i)?.toMillis(),max:Zwe(e)?.toMillis(),rawMin:i,rawMax:e}:I5e(t)?{min:Ywe(i)?.toMillis(),max:Ywe(e)?.toMillis(),rawMin:i,rawMax:e}:R5e(t)?{min:Jwe(i)?.toMillis(),max:Jwe(e)?.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}function D5e(t){if(!t)return;const e=t.match(Oft);return e?.groups?e.groups.doubleQuoted??e.groups.singleQuoted??e.groups.dotNotation:void 0}const Oft=/^(\$feature\[(?:"(?<doubleQuoted>[^"]+)"|'(?<singleQuoted>[^']+)')\]|\$feature\.(?<dotNotation>[a-z_][a-z0-9_]*))$/i;function Pft(t){return t.match(Rft)?.[1]?.replaceAll("\\'","'")??null}const Rft=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;let $J;function p1(){return $J||($J=(async()=>{const[t,e,i]=await Promise.all([W(()=>import("./arcadeUtils-BjeN_pz1.js"),__vite__mapDeps([131,132,133,134,135,115,22,136,137,138,18,52,139,140,116,117,141])),W(()=>import("./batchExec-BzvxyE3p.js"),__vite__mapDeps([142,61])),W(()=>import("./aiServices-DuDTOiyH.js").then(r=>r.a),__vite__mapDeps([137,134,135,115,22,138,133]))]);return{arcade:t.arcade,arcadeUtils:t,batchExec:e,aiServices:i,Dictionary:t.Dictionary,Feature:t.arcadeFeature,Voxel:t.Voxel,Pixel:t.Pixel}})()),$J}const Ift=/^([0-9_])/,Dft=/[^a-z0-9_\u0080-\uffff]+/gi;function kft(t){return t==null?null:t.trim().replaceAll(Dft,"_").replace(Ift,"F$1")||null}const Lft=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],Fft=["field","normalizationField"];function Qwe(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(Xwe(Lft,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)Xwe(Fft,r,e)}}function Xwe(t,e,i){if(t)for(const r of t){const s=jL(r,e),n=s&&typeof s!="function"&&i.get(s);n&&ra(r,n.name,e)}}function k5e(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const i=e.get(t.startField),r=e.get(t.endField);t.startField=i?.name??null,t.endField=r?.name??null}else{const i=e.get(t.startTimeField),r=e.get(t.endTimeField);t.startTimeField=i?.name??null,t.endTimeField=r?.name??null}}const CJ=new Set;function R7(t,e){return t&&e?(CJ.clear(),i$(CJ,t,e),Array.from(CJ).sort()):[]}function i$(t,e,i){if(i)if(e?.fields?.length)if(i.includes("*"))for(const{name:r}of e.fields)t.add(r);else for(const r of i)ec(t,e,r);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const r of i)r!=null&&t.add(r)}}function ec(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function hli(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}function dli(t,e,i=1){if(!e||!t)return[];if(e.includes("*"))return["*"];const r=R7(t,e);return r.length/t.fields.length>=i?["*"]:r}async function ic(t,e,i,r){if(!r)return;const s=D5e(r);if(s)ec(t,e,s);else{const{arcadeUtils:n}=await p1(),a=n.extractFieldNames(r,i?.partitions??e?.fields?.map(o=>o.name));for(const o of a)ec(t,i?.index??e,o)}}async function vue(t,e,i){if(i&&i!=="1=1"){const r=await yue(i,e);if(!r.isStandardized)throw new q("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});i$(t,e,r.fieldNames)}}function zft({displayField:t,fields:e}){return t||(e?.length?Nft(e):null)}function Nft(t){return MJ(t,"name-or-title")||MJ(t,"unique-identifier")||MJ(t,"type-or-category")||Vft(t)}function Vft(t){for(const e of t){if(!e?.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function MJ(t,e){for(const i of t)if(i?.valueType&&i.valueType===e)return i.name;return null}async function pli(t,e){if(!e)return;const i=e.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function jft(t,e,i){i.onStatisticExpression?ic(t,e,null,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function fli(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(L5e(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>jft(t,e.fieldsIndex,n))),await Promise.all(r)}async function mli(t,e){const{fieldsIndex:i,trackInfo:r}=e;if(!e||!r||!i)return;const s=[r.latestObservations.renderer?.collectRequiredFields(t,i),r.previousObservations.renderer?.collectRequiredFields(t,i),r.trackLines.renderer?.collectRequiredFields(t,i)];r.popupTemplate&&s.push(L5e(t,e,r.popupTemplate));for(const n of[r.latestObservations.labelingInfo,r.previousObservations.labelingInfo,r.trackLines.labelingInfo])if(n)for(const a of n)s.push(V5e(t,i,a));await Promise.all(s)}async function L5e(t,e,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map(n=>ic(t,e.fieldsIndex,null,n.expression)));const s=i?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(ic(t,e.fieldsIndex,null,n.expressionInfo.expression));await Promise.all(r)}async function gli(t,e,i){e&&(e.timeInfo&&i?.timeExtent&&i$(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&i$(t,e.fieldsIndex,[e.floorInfo.floorField]),i?.where!=null&&await vue(t,e.fieldsIndex,i.where))}async function yli(t,e,i){e&&i&&await Promise.all(i.map(r=>Uft(t,e,r)))}async function Uft(t,e,i){e&&i&&(i.valueExpression?await ic(t,e.fieldsIndex,null,i.valueExpression):i.field&&ec(t,e.fieldsIndex,i.field))}function vli(t){return t?R7(t.fieldsIndex,F5e(t)):[]}function Bft(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?R7(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}async function _li(t,e,i){if(!e||!i)return;const r=e.fieldsIndex;await Promise.all(i.filters.map(s=>vue(t,r,s.where)))}const qft=new Set(["oid","global-id","guid"]),Gft=new Set(["oid","global-id"]),Hft=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/objectid/i,/^perimeter_/i,/_perimeter$/i,/_i$/i];function Wft(t){const e=new Set;z5e(t).forEach(r=>e.add(r)),Bft(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function F5e(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function z5e(t){return F5e(t).map(e=>e.toLowerCase())}function N5e(t,e){return t.editable&&!qft.has(t.type)&&!z5e(e).includes(t.name?.toLowerCase()??"")}function Zft(t,e){const i=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&i===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&i===e.globalIdField.toLowerCase()||Wft(e).includes(i)||Gft.has(t.type)||Hft.some(r=>r.test(i)))}async function bli(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i?.length&&await Promise.all(i.map(s=>V5e(t,r,s)))}async function V5e(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await ic(t,e,null,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(a=>{ec(t,e,a.slice(1,-1))})}await vue(t,e,s)}function Yft(t){const e=t.defaultValue;return e!==void 0&&U5e(t,e)?e:t.nullable?null:void 0}function wli(t){const e=typeof t=="string"?{type:t}:t;return _ue(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function j5e(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function Jft(t){return t===null||j5e(t)}function Qft(t){return t===null||Number.isInteger(t)}function Xft(){return!0}function U5e(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?Qft:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?Jft:j5e;break;case"string":case"esriFieldTypeString":i=t.nullable?E5e:D1;break;default:i=Xft}return arguments.length===1?i:i(e)}const Kft=["integer","small-integer","big-integer","long"],emt=["single","double"],tmt=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeLong","esriFieldTypeBigInteger"],imt=["esriFieldTypeSingle","esriFieldTypeDouble"],B5e=new Set([...Kft,...tmt]),rmt=new Set([...emt,...imt]),smt=Rle(B5e,rmt);function q5e(t){return t!=null&&B5e.has(t.type)}function _F(t){return t!=null&&smt.has(t.type)}function _ue(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function bue(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function nmt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function amt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function G5e(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function Kwe(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function e1e(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function xli(t,e){return omt(t,e)===null}function Sli(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function omt(t,e){return t==null||t.nullable&&e===null?null:U5e(t,e)?_F(t)&&!lmt(t.type,Number(e))?"numeric-range-validation-error::out-of-range":null:"type-validation-error::invalid-type"}function lmt(t,e){const i=typeof t=="string"?H5e(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function H5e(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return cmt;case"esriFieldTypeInteger":case"esriFieldTypeLong":case"integer":case"long":return umt;case"esriFieldTypeBigInteger":case"big-integer":return hmt;case"esriFieldTypeSingle":case"single":return dmt;case"esriFieldTypeDouble":case"double":return pmt}}const cmt={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},umt={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},hmt={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},YN=(2-2**-23)*2**127,dmt={min:-YN,max:YN,isInteger:!1,rawMin:-YN,rawMax:YN},pmt={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Tli(t,e,i){switch(t){case"domain-validation-error::invalid-coded-value":return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case"domain-validation-error::value-out-of-range":return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case"type-validation-error::invalid-type":return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case"numeric-range-validation-error::out-of-range":{const{min:r,max:s}=H5e(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function fmt(t,e){return!mmt(t,e,null)}function mmt(t,e,i){if(!t?.attributes||!e){if(i!=null)for(const n of e??[])i.add(n);return!0}const r=new Set(Object.keys(t.attributes));let s=!1;for(const n of e)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function gmt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}function wue(t){const e=t?.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let pU=class extends ae{constructor(e){super(e),this.type=null}};c([p({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],pU.prototype,"type",void 0),pU=c([R("esri.popup.content.Content")],pU);const K0=pU,JN=new ii({asc:"ascending",desc:"descending"});let wD=class extends nt(ae){constructor(e){super(e),this.field=null,this.order="ascending"}};c([p({type:String,json:{write:!0}})],wD.prototype,"field",void 0),c([p({type:JN.apiValues,json:{type:JN.jsonValues,read:JN.read,write:JN.write}})],wD.prototype,"order",void 0),wD=c([R("esri.popup.support.AttachmentsOrderByInfo")],wD);const ymt=wD;let Hm=class extends nt(K0){constructor(e){super(e),this.attachmentKeywords=null,this.attachmentTypes=null,this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};c([p({type:[String],json:{write:!0}})],Hm.prototype,"attachmentKeywords",void 0),c([p({type:[["application","audio","image","model","text","video"]],json:{write:!0}})],Hm.prototype,"attachmentTypes",void 0),c([p({type:String,json:{write:!0}})],Hm.prototype,"description",void 0),c([p({type:["auto","preview","list"],json:{write:!0}})],Hm.prototype,"displayType",void 0),c([p({type:[ymt],json:{write:!0}})],Hm.prototype,"orderByFields",void 0),c([p({type:String,json:{write:!0}})],Hm.prototype,"title",void 0),c([p({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Hm.prototype,"type",void 0),Hm=c([R("esri.popup.content.AttachmentsContent")],Hm);const RO=Hm;var mie;let Jx=mie=class extends K0{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new mie({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?se(this.outFields):null})}};c([p()],Jx.prototype,"creator",void 0),c([p()],Jx.prototype,"destroyer",void 0),c([p()],Jx.prototype,"outFields",void 0),c([p({type:["custom"],readOnly:!0})],Jx.prototype,"type",void 0),Jx=mie=c([R("esri.popup.content.CustomContent")],Jx);const vmt=Jx;var gie;let IM=gie=class extends ae{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new gie({title:this.title,expression:this.expression})}};c([p({type:String,json:{write:!0}})],IM.prototype,"title",void 0),c([p({type:String,json:{write:!0}})],IM.prototype,"expression",void 0),c([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],IM.prototype,"returnType",void 0),IM=gie=c([R("esri.popup.ElementExpressionInfo")],IM);const _mt=IM;var yie;let xD=yie=class extends K0{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new yie({expressionInfo:this.expressionInfo?.clone()})}};c([p({type:_mt,json:{write:!0}})],xD.prototype,"expressionInfo",void 0),c([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],xD.prototype,"type",void 0),xD=yie=c([R("esri.popup.content.ExpressionContent")],xD);const I7=xD;let fU=class extends nt(ae){constructor(e){super(e),this.type=null}};c([p({type:["date-time","number"],nonNullable:!0,readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],fU.prototype,"type",void 0),fU=c([R("esri.layers.support.FieldFormat")],fU);const xue=fU,W5e="auto";let Ky=class extends xue{constructor(e){super(e),this.dateStyle=null,this.hour12=W5e,this.month=null,this.timeStyle=null,this.type="date-time",this.year=null}};c([p({type:["full","long","medium","short"],json:{write:!0}})],Ky.prototype,"dateStyle",void 0),c([p({type:["always","auto","never"],nonNullable:!0,json:{default:W5e,write:!0}})],Ky.prototype,"hour12",void 0),c([p({type:["long","short"],json:{write:!0}})],Ky.prototype,"month",void 0),c([p({type:["full","long","medium","short"],json:{write:!0}})],Ky.prototype,"timeStyle",void 0),c([p({type:["date-time"]})],Ky.prototype,"type",void 0),c([p({type:["numeric"],json:{write:!0}})],Ky.prototype,"year",void 0),Ky=c([R("esri.layers.support.DateTimeFieldFormat")],Ky);const LS=Ky,t1e={min:0,max:20},Z5e=2,Y5e=0,J5e="decimal",Q5e="auto";let gb=class extends xue{constructor(e){super(e),this.maximumFractionDigits=Z5e,this.minimumFractionDigits=Y5e,this.style=J5e,this.type="number",this.useGrouping=Q5e}};c([p({type:vi,nonNullable:!0,range:t1e,json:{default:Z5e,write:!0}})],gb.prototype,"maximumFractionDigits",void 0),c([p({type:vi,nonNullable:!0,range:t1e,json:{default:Y5e,write:!0}})],gb.prototype,"minimumFractionDigits",void 0),c([p({type:["decimal"],nonNullable:!0,json:{default:J5e,write:!0}})],gb.prototype,"style",void 0),c([p({type:["number"]})],gb.prototype,"type",void 0),c([p({type:["always","auto","never"],nonNullable:!0,json:{default:Q5e,write:!0}})],gb.prototype,"useGrouping",void 0),gb=c([R("esri.layers.support.NumberFieldFormat")],gb);const Iq=gb;let DM=class extends nt(ae){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};c([st(kct)],DM.prototype,"dateFormat",void 0),c([p({type:Boolean,json:{write:!0}})],DM.prototype,"digitSeparator",void 0),c([p({type:vi,json:{write:!0}})],DM.prototype,"places",void 0),DM=c([R("esri.popup.support.FieldInfoFormat")],DM);const x0=DM,X5e={base:xue,key:"type",errorContext:"field-configuration-field-format",typeMap:{"date-time":LS,number:Iq}};function bmt(t,e){const{format:i}=t;return e&&C$(e)?i?K5e(i,e):C4(e,{hour12:"always",useGrouping:"always"}):null}function K5e(t,e){const{dateFormat:i}=t;if(!e)return i?r1e(t):i1e(t);if(!C$(e))return;const r={hour12:"always"};switch(e.type){case"integer":case"small-integer":case"big-integer":case"long":return eLe(t);case"single":case"double":return i1e(t);case"date":case"timestamp-offset":return i?r1e(t):C4(e,r);case"date-only":return i?wmt(t):C4(e);case"time-only":return i?xmt(t):C4(e,r)}}function C$(t){return _F(t)||bue(t)||nmt(t)||G5e(t)||amt(t)}function eLe(t){return new Iq({useGrouping:t.digitSeparator?"always":"never"})}function i1e(t){const e=eLe(t),{places:i}=t;return e.minimumFractionDigits=i??0,e.maximumFractionDigits=i??2,e}function r1e(t){return new LS({dateStyle:tLe(t),year:nLe(t),month:rLe(t),timeStyle:sLe(t),hour12:iLe(t)})}function wmt(t){return new LS({dateStyle:tLe(t),year:nLe(t),month:rLe(t)})}function xmt(t){return new LS({timeStyle:sLe(t),hour12:iLe(t)})}function tLe(t){const{dateFormat:e}=t;return e?e.startsWith("short-date")?"short":e.startsWith("day-short-month-year")?"medium":e.startsWith("long-month-day-year")?"long":e.startsWith("long-date")?"full":null:null}function iLe(t){return t.dateFormat?.endsWith("-24")?"never":"always"}function rLe(t){switch(t.dateFormat){case"short-month-year":return"short";case"long-month-year":return"long";default:return null}}function sLe(t){const{dateFormat:e}=t;return e?e.includes("short-time")?"short":e.includes("long-time")?"medium":null:null}function nLe(t){switch(t.dateFormat){case"short-month-year":case"long-month-year":case"year":return"numeric";default:return null}}function Sue(t,e){const i=t.type==="number",r=t.type==="date-time";if(!e)return i?s1e(t):r?n1e(t):null;if(C$(e))switch(e.type){case"integer":case"small-integer":case"big-integer":case"long":return i?aLe(t):null;case"single":case"double":return i?s1e(t):null;case"date":case"timestamp-offset":return r?n1e(t):null;case"date-only":return r?Smt(t):null;case"time-only":return r?Tmt(t):null}}function aLe(t){return new x0({digitSeparator:t.useGrouping!=="never"})}function s1e(t){const e=aLe(t);return e.places=t.maximumFractionDigits,e}function n1e(t){let e;const i=oLe(t),r=lLe(t),s=t.hour12==="never"?"24":null,n=t.year==="numeric"?"year":null,a=cLe(t);return i&&r&&s?e=`${i}-${r}-${s}`:i&&r?e=`${i}-${r}`:i?e=i:n&&a?e=`${a}-${n}`:n&&(e=n),e?new x0({dateFormat:e}):null}function Smt(t){let e;const i=oLe(t),r=t.year==="numeric"?"year":null,s=cLe(t);return i?e=i:r&&s?e=`${s}-${r}`:r&&(e=r),e?new x0({dateFormat:e}):null}function Tmt(t){let e;const i=lLe(t),r=t.hour12==="never"?"24":null;return i&&r?e=`short-date-${i}-${r}`:i&&(e=`short-date-${i}`),e?new x0({dateFormat:e}):null}function oLe(t){switch(t.dateStyle){case"short":return"short-date";case"medium":return"day-short-month-year";case"long":return"long-month-day-year";case"full":return"long-date";default:return}}function lLe(t){return t.timeStyle&&(t.timeStyle==="short"?"short-time":"long-time")}function cLe(t){switch(t.month){case"short":return"short-month";case"long":return"long-month";default:return}}function C4(t,e){if(!C$(t))return;const i=e?.useGrouping??"auto",r=e?.hour12??"auto";switch(t.type){case"integer":case"small-integer":case"big-integer":case"long":return new Iq({minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:i});case"single":case"double":return new Iq({minimumFractionDigits:0,maximumFractionDigits:2,useGrouping:i});case"date":case"timestamp-offset":return new LS({dateStyle:"short",timeStyle:"short",hour12:r});case"date-only":return new LS({dateStyle:"short"});case"time-only":return new LS({timeStyle:"short",hour12:r})}}let yh=class extends nt(ae){constructor(e){super(e),this.fieldName=null,this.isEditable=!0,this.label=null,this.statisticType=null,this.stringFieldOption="text-box",this.tooltip=null,this.visible=!0}set fieldFormat(e){this._set("fieldFormat",e),this._set("format",e?Sue(e):null)}set format(e){this._set("format",e),this._set("fieldFormat",e?K5e(e):null)}readFormat(e,i){if(!i.fieldFormat)return e?x0.fromJSON(e):null}clone(){const e=super.clone();return e._set("format",this.format?.clone()),e._set("fieldFormat",this.fieldFormat?.clone()),e}};c([p({value:null,clonable:!1,types:X5e,json:{write:{overridePolicy(t,e,i){const{fieldName:r}=this;return{enabled:!!r&&!r.startsWith("expression/")&&!r.startsWith("relationships/")&&!!i?.writeFieldFormat}}}}})],yh.prototype,"fieldFormat",null),c([p({type:String,json:{write:!0}})],yh.prototype,"fieldName",void 0),c([p({value:null,clonable:!1,type:x0,json:{write:!0}})],yh.prototype,"format",null),c([Oe("format")],yh.prototype,"readFormat",null),c([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],yh.prototype,"isEditable",void 0),c([p({type:String,json:{write:!0}})],yh.prototype,"label",void 0),c([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],yh.prototype,"statisticType",void 0),c([st(new ii({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],yh.prototype,"stringFieldOption",void 0),c([p({type:String,json:{write:!0}})],yh.prototype,"tooltip",void 0),c([p({type:Boolean,json:{write:!0}})],yh.prototype,"visible",void 0),yh=c([R("esri.popup.FieldInfo")],yh);const D7=yh;var vie;let yb=vie=class extends K0{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}clone(){return new vie(se({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};c([p({type:Object,json:{write:!0}})],yb.prototype,"attributes",void 0),c([p({type:String,json:{write:!0}})],yb.prototype,"description",void 0),c([p({type:[D7],json:{write:!0}})],yb.prototype,"fieldInfos",void 0),c([p({type:String,json:{write:!0}})],yb.prototype,"title",void 0),c([p({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],yb.prototype,"type",void 0),yb=vie=c([R("esri.popup.content.FieldsContent")],yb);const IO=yb;let Qx=class extends ae{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};c([p({type:String,json:{write:!0}})],Qx.prototype,"altText",void 0),c([p({type:String,json:{write:!0}})],Qx.prototype,"caption",void 0),c([p({type:String,json:{write:!0}})],Qx.prototype,"title",void 0),c([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Qx.prototype,"type",void 0),Qx=c([R("esri.popup.content.mixins.MediaInfo")],Qx);const Tue=Qx;var _ie;let Xx=_ie=class extends be{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new _ie({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};c([p()],Xx.prototype,"color",void 0),c([p()],Xx.prototype,"fieldName",void 0),c([p()],Xx.prototype,"tooltip",void 0),c([p()],Xx.prototype,"value",void 0),Xx=_ie=c([R("esri.popup.content.support.ChartMediaInfoValueSeries")],Xx);const $mt=Xx;var bie;let vb=bie=class extends ae{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new bie({colors:se(this.colors),fields:se(this.fields),normalizeField:this.normalizeField,series:se(this.series),tooltipField:this.tooltipField})}};c([p({type:[Je],json:{type:[[vi]],write:!0}})],vb.prototype,"colors",void 0),c([p({type:[String],json:{write:{isRequired:!0}}})],vb.prototype,"fields",void 0),c([p({type:String,json:{write:!0}})],vb.prototype,"normalizeField",void 0),c([p({type:[$mt],json:{read:!1}})],vb.prototype,"series",void 0),c([p({type:String,json:{write:!0}})],vb.prototype,"tooltipField",void 0),vb=bie=c([R("esri.popup.content.support.ChartMediaInfoValue")],vb);const Cmt=vb;let SD=class extends Tue{constructor(e){super(e),this.type=null,this.value=void 0}};c([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],SD.prototype,"type",void 0),c([p({type:Cmt,json:{write:{isRequired:!0}}})],SD.prototype,"value",void 0),SD=c([R("esri.popup.content.mixins.ChartMediaInfo")],SD);const k7=SD,L7=so()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var wie;let mU=wie=class extends k7{constructor(t){super(t),this.type="bar-chart"}clone(){return new wie({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};c([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:L7.write,isRequired:!0}}})],mU.prototype,"type",void 0),mU=wie=c([R("esri.popup.content.BarChartMediaInfo")],mU);const uLe=mU;var xie;let gU=xie=class extends k7{constructor(t){super(t),this.type="column-chart"}clone(){return new xie({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};c([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:L7.write,isRequired:!0}}})],gU.prototype,"type",void 0),gU=xie=c([R("esri.popup.content.ColumnChartMediaInfo")],gU);const hLe=gU;var Sie;let TD=Sie=class extends ae{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new Sie({linkURL:this.linkURL,sourceURL:this.sourceURL})}};c([p({type:String,json:{write:!0}})],TD.prototype,"linkURL",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],TD.prototype,"sourceURL",void 0),TD=Sie=c([R("esri.popup.content.support.ImageMediaInfoValue")],TD);const Mmt=TD;var Tie;let kM=Tie=class extends Tue{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new Tie({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};c([p({type:Number,json:{write:!0}})],kM.prototype,"refreshInterval",void 0),c([p({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],kM.prototype,"type",void 0),c([p({type:Mmt,json:{write:{isRequired:!0}}})],kM.prototype,"value",void 0),kM=Tie=c([R("esri.popup.content.ImageMediaInfo")],kM);const dLe=kM;var $ie;let yU=$ie=class extends k7{constructor(t){super(t),this.type="line-chart"}clone(){return new $ie({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};c([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:L7.write,isRequired:!0}}})],yU.prototype,"type",void 0),yU=$ie=c([R("esri.popup.content.LineChartMediaInfo")],yU);const pLe=yU;var Cie;let vU=Cie=class extends k7{constructor(t){super(t),this.type="pie-chart"}clone(){return new Cie({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};c([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:L7.write,isRequired:!0}}})],vU.prototype,"type",void 0),vU=Cie=c([R("esri.popup.content.PieChartMediaInfo")],vU);const fLe=vU,Mie={base:Tue,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":uLe,"column-chart":hLe,"line-chart":pLe,"pie-chart":fLe,image:dLe}};var Eie;let of=Eie=class extends K0{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?dLe.fromJSON(e):e.type==="barchart"?uLe.fromJSON(e):e.type==="columnchart"?hLe.fromJSON(e):e.type==="linechart"?pLe.fromJSON(e):e.type==="piechart"?fLe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new Eie(se({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};c([p()],of.prototype,"activeMediaInfoIndex",void 0),c([p({type:Object,json:{write:!0}})],of.prototype,"attributes",void 0),c([p({type:String,json:{write:!0}})],of.prototype,"description",void 0),c([p({types:[Mie]})],of.prototype,"mediaInfos",void 0),c([Oe("mediaInfos")],of.prototype,"readMediaInfos",null),c([Ie("mediaInfos")],of.prototype,"writeMediaInfos",null),c([p({type:String,json:{write:!0}})],of.prototype,"title",void 0),c([p({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],of.prototype,"type",void 0),of=Eie=c([R("esri.popup.content.MediaContent")],of);const j5=of;var Aie;let $D=Aie=class extends ae{constructor(t){super(t),this.field=null,this.order=null}clone(){return new Aie({field:this.field,order:this.order})}};c([p({type:String,json:{write:!0}})],$D.prototype,"field",void 0),c([p({type:["asc","desc"],json:{write:!0}})],$D.prototype,"order",void 0),$D=Aie=c([R("esri.popup.support.RelatedRecordsInfoFieldOrder")],$D);const $ue=$D;let Wm=class extends nt(K0){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};c([p({type:String,json:{write:!0}})],Wm.prototype,"description",void 0),c([p({type:Number,json:{type:vi,write:!0}})],Wm.prototype,"displayCount",void 0),c([p({type:["list"],json:{write:{isRequired:!0}}})],Wm.prototype,"displayType",void 0),c([p({type:[$ue],json:{write:!0}})],Wm.prototype,"orderByFields",void 0),c([p({type:Number,json:{type:vi,write:{isRequired:!0}}})],Wm.prototype,"relationshipId",void 0),c([p({type:String,json:{write:!0}})],Wm.prototype,"title",void 0),c([p({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Wm.prototype,"type",void 0),Wm=c([R("esri.popup.content.RelationshipContent")],Wm);const U5=Wm;var Oie;let CD=Oie=class extends K0{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new Oie({text:this.text})}};c([p({type:String,json:{write:!0}})],CD.prototype,"text",void 0),c([p({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],CD.prototype,"type",void 0),CD=Oie=c([R("esri.popup.content.TextContent")],CD);const B5=CD;let ev=class extends nt(ae){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};c([p({type:String,json:{write:!0}})],ev.prototype,"title",void 0),c([p({type:String,json:{write:!0}})],ev.prototype,"description",void 0),c([p({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],ev.prototype,"type",void 0),c([p({type:Number,json:{type:vi,write:!0}})],ev.prototype,"associatedNetworkSourceId",void 0),c([p({type:Number,json:{type:vi,write:!0}})],ev.prototype,"associatedAssetGroup",void 0),c([p({type:Number,json:{type:vi,write:!0}})],ev.prototype,"associatedAssetType",void 0),ev=c([R("esri.popup.support.UtilityNetworkAssociationType")],ev);const mLe=ev;let _b=class extends nt(K0){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};c([p({type:String,json:{write:!0}})],_b.prototype,"description",void 0),c([p({type:Number,json:{type:vi,write:!0}})],_b.prototype,"displayCount",void 0),c([p({type:String,json:{write:!0}})],_b.prototype,"title",void 0),c([p({type:[mLe],json:{write:!0}})],_b.prototype,"associationTypes",void 0),c([st({utilityNetworkAssociations:"utility-network-associations"})],_b.prototype,"type",void 0),_b=c([R("esri.popup.content.UtilityNetworkAssociationsContent")],_b);const Cue=_b,Emt={base:null,key:"type",typeMap:{attachment:RO,media:j5,text:B5,expression:I7,field:IO,relationship:U5,utilityNetworkAssociations:Cue}},Amt={base:null,key:"type",typeMap:{attachment:RO,media:j5,text:B5,expression:I7,field:IO,relationship:U5}};var Pie;let Kx=Pie=class extends ae{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Pie({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};c([p({type:String,json:{write:!0}})],Kx.prototype,"name",void 0),c([p({type:String,json:{write:!0}})],Kx.prototype,"title",void 0),c([p({type:String,json:{write:!0}})],Kx.prototype,"expression",void 0),c([p({type:["string","number"],json:{write:!0}})],Kx.prototype,"returnType",void 0),Kx=Pie=c([R("esri.popup.ExpressionInfo")],Kx);const Omt=Kx;var Rie;let MD=Rie=class extends ae{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Rie({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};c([p({type:Boolean,json:{write:!0}})],MD.prototype,"returnTopmostRaster",void 0),c([p({type:Boolean,json:{write:!0}})],MD.prototype,"showNoDataRecords",void 0),MD=Rie=c([R("esri.popup.LayerOptions")],MD);const Pmt=MD;var Iie;let ED=Iie=class extends ae{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Iie({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?se(this.orderByFields):null})}};c([p({type:Boolean,json:{write:!0}})],ED.prototype,"showRelatedRecords",void 0),c([p({type:[$ue],json:{write:!0}})],ED.prototype,"orderByFields",void 0),ED=Iie=c([R("esri.popup.RelatedRecordsInfo")],ED);const a1e=ED;var Die;let Ed=Die=class extends gF(be){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Die({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};c([p()],Ed.prototype,"active",void 0),c([p()],Ed.prototype,"className",void 0),c([p()],Ed.prototype,"disabled",void 0),c([p()],Ed.prototype,"icon",void 0),c([p()],Ed.prototype,"id",void 0),c([p()],Ed.prototype,"indicator",void 0),c([p()],Ed.prototype,"title",void 0),c([p()],Ed.prototype,"type",void 0),c([p()],Ed.prototype,"visible",void 0),Ed=Die=c([R("esri.support.actions.ActionBase")],Ed);const Mue=Ed;var kie;let _U=kie=class extends Mue{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new kie({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};c([p()],_U.prototype,"image",void 0),_U=kie=c([R("esri.support.actions.ActionButton")],_U);const Rmt=_U;var Lie;let AD=Lie=class extends Mue{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new Lie({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};c([p()],AD.prototype,"image",void 0),c([p()],AD.prototype,"value",void 0),AD=Lie=c([R("esri.support.actions.ActionToggle")],AD);const Imt=AD,KR="relationships/",o1e="expression/",Dmt=ke.ofType({key:"type",defaultKeyValue:"button",base:Mue,typeMap:{button:Rmt,toggle:Imt}}),kmt={base:K0,key:"type",typeMap:{media:j5,custom:vmt,text:B5,attachments:RO,fields:IO,expression:I7,relationship:U5,utilityNetworkAssociations:Cue}},gLe=new Set(["attachments","fields","media","text","expression","relationship"]),Lmt=new Set([...gLe,"utility-network-associations"]);let ja=class extends nt(ae){constructor(e){super(e),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>sm(kmt,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Ea(e)?e:(re.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeWebSceneContent(e,i,r,s){this._writePopupTemplateContent(e,i,s)}writeWebMapContent(e,i,r,s){this._writePopupTemplateContent(e,i,s)}writeFieldInfos(e,i,r,s){const{content:n}=this,a=Array.isArray(n)?n:null,{writeFieldFormat:o,...l}=s||{};if(e){const u=a?a.filter(f=>f.type==="fields"):[],d=u.length&&u.every(f=>f.fieldInfos?.length);i.fieldInfos=e.filter(Boolean).map(f=>{const g=f.toJSON(l);return d&&(g.visible=!1),g})}if(a)for(const u of a)u.type==="fields"&&this._writeFieldsContent(u,i,l)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i,r){const s=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,r,[...s,...this._getContentExpressionInfos(this.content,s)]),i$(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e,i){const r=new Set;return await this.collectRequiredFields(r,e,i),[...r].sort()}_writePopupTemplateContent(e,i,r){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>r?.origin==="web-scene"?gLe.has(s.type):Lmt.has(s.type)).map(s=>s?.toJSON(r)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}_writeFieldsContent(e,i,r){const s=e.fieldInfos;if(!Array.isArray(s)||!s.length)return;const n=i.fieldInfos;if(Array.isArray(n))for(const a of s){const o=n.find(l=>l.fieldName?.toLowerCase()===a.fieldName?.toLowerCase());o?o.visible=!0:n.push(a.toJSON(r))}else i.fieldInfos=s.map(a=>a.toJSON(r))}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){const r=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],s=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=se(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),j5.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),B5.fromJSON(n)):n.type==="attachments"?RO.fromJSON(n):n.type==="fields"?IO.fromJSON(n):n.type==="expression"?I7.fromJSON(n):n.type==="relationship"?U5.fromJSON(n):n.type==="utilityNetworkAssociations"?Cue.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!i?.startsWith(KR))return null;const s=i.replace(KR,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),a=s[1];return!Number.isNaN(n)&&a?U5.fromJSON({relationshipId:n,orderByFields:[{field:a,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${KR}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new B5({text:e})):n.push(new IO),Array.isArray(i)&&i.length&&n.push(j5.fromJSON({mediaInfos:i})),r&&n.push(RO.fromJSON({displayType:"auto"}));const{showRelatedRecords:a,orderByFields:o}=s;return a&&o?.length&&o.forEach(l=>{const u=this._toRelationshipContent(l);u&&n.push(u)}),n.length?n:e}_getContentElementFields(e){const i=e?.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):i==="relationship"||i==="utility-network-associations"?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:a,normalizeField:o,tooltipField:l,sourceURL:u,linkURL:d}=n,f=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(u),...this._extractFieldNames(d),...a??[]];return o&&f.push(o),l&&f.push(l),f}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r,s){s&&await Promise.all(s.map(n=>ic(e,i,r,n.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(KR)||i.startsWith(o1e))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return wue(e).filter(i=>!(i.startsWith(KR)||i.startsWith(o1e)))}};c([p({type:Dmt})],ja.prototype,"actions",void 0),c([p()],ja.prototype,"content",void 0),c([wi("content")],ja.prototype,"castContent",null),c([Oe("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],ja.prototype,"readContent",null),c([Ie("web-scene","content",{popupElements:{type:ke.ofType(Amt)},showAttachments:{type:Boolean},mediaInfos:{type:ke.ofType(Mie)},description:{type:String},relatedRecordsInfo:{type:a1e}})],ja.prototype,"writeWebSceneContent",null),c([Ie("content",{popupElements:{type:ke.ofType(Emt)},showAttachments:{type:Boolean},mediaInfos:{type:ke.ofType(Mie)},description:{type:String},relatedRecordsInfo:{type:a1e}})],ja.prototype,"writeWebMapContent",null),c([p({type:[Omt],json:{write:!0}})],ja.prototype,"expressionInfos",void 0),c([p({type:[D7]})],ja.prototype,"fieldInfos",void 0),c([Ie("fieldInfos")],ja.prototype,"writeFieldInfos",null),c([p({type:Pmt})],ja.prototype,"layerOptions",void 0),c([Ie("layerOptions")],ja.prototype,"writeLayerOptions",null),c([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],ja.prototype,"lastEditInfoEnabled",void 0),c([p()],ja.prototype,"outFields",void 0),c([p()],ja.prototype,"overwriteActions",void 0),c([p()],ja.prototype,"returnGeometry",void 0),c([p({json:{type:String}})],ja.prototype,"title",void 0),c([Ie("title")],ja.prototype,"writeTitle",null),ja=c([R("esri.PopupTemplate")],ja);const wP=ja,Eue=Symbol("idFieldsProviderSymbol");function Fmt(t){return!!t&&Eue in t}function l1e(t){return Fmt(t)?t[Eue]:void 0}const bF=Symbol("popupProvider");function Nli(t){return typeof t=="object"&&t!==null&&"popupEnabled"in t&&"popupTemplate"in t}function zmt(t){return!!t&&bF in t}function Nmt(t){return zmt(t)?t[bF]:null}function wF(t,e){switch(e.type){case"object-id":case"unique-id-simple":return t.attributes[e.fieldName];case"unique-id-composite":{const i=[];for(const r of e.fieldNames)i.push(t.attributes[r]??null);return JSON.stringify(i)}}}function c1e(t,e){if("uniqueIdFields"in e&&e.uniqueIdFields?.length){if(e.uniqueIdFields.length===1)return t.attributes?.[e.uniqueIdFields[0]];const i=e.uniqueIdFields.map(r=>t.attributes?.[r]);return JSON.stringify(i)}return"objectIdField"in e&&e.objectIdField?t.attributes?.[e.objectIdField]:null}const u1e=new ii({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let Vmt=0,Kn=class extends ae{constructor(e){super(e),this.id="sym"+Vmt++,this.type=null,this.color=new Je([0,0,0,1])}readColor(e){return e?.[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};c([p({type:u1e.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:u1e.write,isRequired:!0}}})],Kn.prototype,"type",void 0),c([p({type:Je,json:{write:{allowNull:!0}}})],Kn.prototype,"color",void 0),c([Oe("color")],Kn.prototype,"readColor",null),Kn=c([R("esri.symbols.Symbol")],Kn);var Fie;let fl=Fie=class extends Kn{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return n?ic(t,e,null,n.expression):null});await Promise.all(r)}}}clone(){return new Fie({data:se(this.data)})}hash(){return oPe(JSON.stringify(this.data)).toString()}};c([p({json:{write:!1}})],fl.prototype,"color",void 0),c([p({json:{write:!0}})],fl.prototype,"data",void 0),c([Oe("data",["symbol"])],fl.prototype,"readData",null),c([Ie("data",{})],fl.prototype,"writeData",null),c([st({CIMSymbolReference:"cim"},{readOnly:!0})],fl.prototype,"type",void 0),fl=Fie=c([R("esri.symbols.CIMSymbol")],fl);let Vc=class extends ae{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};c([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],Vc.prototype,"enabled",void 0),c([Ie("enabled")],Vc.prototype,"writeEnabled",null),c([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0,json:{write:{isRequired:!0}}})],Vc.prototype,"type",void 0),Vc=c([R("esri.symbols.Symbol3DLayer")],Vc);function jmt(t,e){const i=e.transparency!=null?AO(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Je([r[0]||0,r[1]||0,r[2]||0,i]):null}function Umt(t,e){e.color=t.toJSON().slice(0,3);const i=vF(t.a);i!==0&&(e.transparency=i)}function e_(t){return{type:Je,nonNullable:t?.nonNullable,json:{type:[vi],default:null,read:{source:["color","transparency"],reader:jmt},write:{target:{color:{type:[vi],isRequired:t?.colorRequiredOnWrite},transparency:{type:vi}},writer:Umt}}}}const Yg={type:Number,cast:mr,json:{write:!0}};function Uli(t){return t==="emissive"?0:1}let e2=class extends ae{constructor(e){super(e),this.color=new Je([0,0,0,1]),this.extensionLength=0,this.size=Tp(1)}clone(){}cloneProperties(){return{color:se(this.color),size:this.size,extensionLength:this.extensionLength}}};c([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],e2.prototype,"type",void 0),c([p(e_({colorRequiredOnWrite:!0}))],e2.prototype,"color",void 0),c([p({...Yg,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],e2.prototype,"extensionLength",void 0),c([p(Yg)],e2.prototype,"size",void 0),e2=c([R("esri.symbols.edges.Edges3D")],e2);const Aue=e2;var zie;let bU=zie=class extends Aue{constructor(t){super(t),this.type="sketch"}clone(){return new zie(this.cloneProperties())}};c([st({sketch:"sketch"},{readOnly:!0})],bU.prototype,"type",void 0),bU=zie=c([R("esri.symbols.edges.SketchEdges3D")],bU);const Bmt=bU;var Nie;let wU=Nie=class extends Aue{constructor(t){super(t),this.type="solid"}clone(){return new Nie(this.cloneProperties())}};c([st({solid:"solid"},{readOnly:!0})],wU.prototype,"type",void 0),wU=Nie=c([R("esri.symbols.edges.SolidEdges3D")],wU);const yLe=wU,vLe={types:{key:"type",base:Aue,typeMap:{solid:yLe,sketch:Bmt}},json:{write:!0}};var Vie;let aE=Vie=class extends ae{constructor(){super(...arguments),this.strength=null,this.source="emissive"}clone(){const t={strength:this.strength,source:this.source};return new Vie(t)}};c([p({json:{write:!1}})],aE.prototype,"strength",void 0),c([p({json:{write:!1}})],aE.prototype,"source",void 0),aE=Vie=c([R("esri.symbols.support.Symbol3DEmissive")],aE);var jie;let Bh=jie=class extends ae{constructor(t){super(t),this.color=null,this.emissive=new aE({source:"emissive"})}clone(){const t={color:this.color?.clone()??null,emissive:this.emissive?.clone()??null};return new jie(t)}};c([p(e_())],Bh.prototype,"color",void 0),c([p({type:aE,json:{write:!1}})],Bh.prototype,"emissive",void 0),Bh=jie=c([R("esri.symbols.support.Symbol3DMaterial")],Bh);var Uie,wA;let Iv=(wA=class extends Vc{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new Uie({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}},Uie=wA,wA);c([st({Extrude:"extrude"},{readOnly:!0})],Iv.prototype,"type",void 0),c([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Iv.prototype,"size",void 0),c([p({type:Bh,json:{write:!0}})],Iv.prototype,"material",void 0),c([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Iv.prototype,"castShadows",void 0),c([p(vLe)],Iv.prototype,"edges",void 0),Iv=Uie=c([R("esri.symbols.ExtrudeSymbol3DLayer")],Iv);let M4=class extends ae{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};c([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],M4.prototype,"type",void 0),M4=c([R("esri.symbols.patterns.LinePattern3D")],M4);const qmt=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var Bie;const Gmt=so()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let oS=Bie=class extends M4{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new Bie(t)}};c([p({type:["style"],json:{write:{isRequired:!0}}})],oS.prototype,"type",void 0),c([st(Gmt),p({type:qmt,json:{write:{isRequired:!0}}})],oS.prototype,"style",void 0),oS=Bie=c([R("esri.symbols.patterns.LineStylePattern3D")],oS);let E4=class extends ae{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};c([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],E4.prototype,"type",void 0),E4=c([R("esri.symbols.patterns.Pattern3D")],E4);const Hmt=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var qie;let oE=qie=class extends E4{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new qie({style:this.style})}};c([p({type:["style"],json:{write:{isRequired:!0}}})],oE.prototype,"type",void 0),c([p({type:Hmt,json:{read:!0,write:{isRequired:!0}}})],oE.prototype,"style",void 0),oE=qie=c([R("esri.symbols.patterns.StylePattern3D")],oE);const Wmt={types:{key:"type",base:E4,typeMap:{style:oE}},json:{write:!0}},_Le={types:{key:"type",base:M4,typeMap:{style:oS}},json:{write:!0}},A4=new Je("white"),Zmt=new Je([255,255,255,0]);function Ymt(t){return t.r===0&&t.g===0&&t.b===0}var Gie;let O4=Gie=class extends Bh{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color?.clone()??null,colorMixMode:this.colorMixMode,emissive:this.emissive?.clone()??null};return new Gie(t)}};c([st({multiply:"multiply",replace:"replace",tint:"tint"})],O4.prototype,"colorMixMode",void 0),O4=Gie=c([R("esri.symbols.support.Symbol3DFillMaterial")],O4);function ut(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bLe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Oue(t,e,i,r,s,n,a,o,l,u,d,f,g,v,_,x){return[t,e,i,r,s,n,a,o,l,u,d,f,g,v,_,x]}const gl=ut();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:gl,clone:bLe,create:ut,fromValues:Oue},Symbol.toStringTag,{value:"Module"}));function q5(t){return t<=Hc?new Array(t).fill(0):new Float64Array(t)}function Hli(t){return(lP(t)?t.byteLength/8:t.length)<=Hc?Array.from(t):new Float64Array(t)}function Wli(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Zli(t){return[...t]}function Yli(t){const e=ut();for(let i=0;i<16;++i)e[i]=t[i];return e}function nc(t=$Le){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function DO(t,e,i,r,s,n,a=nc()){return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=s,a[5]=n,a}function Jli(t,e=nc()){return Jmt(t,0,t.length/3,e)}function Jmt(t,e,i,r=nc()){return F7(r,Wie),Qmt(r,t,e,i),r}function Qli(t,e=q5(24)){const[i,r,s,n,a,o]=t;return e[0]=i,e[1]=r,e[2]=s,e[3]=i,e[4]=r,e[5]=o,e[6]=i,e[7]=a,e[8]=s,e[9]=i,e[10]=a,e[11]=o,e[12]=n,e[13]=r,e[14]=s,e[15]=n,e[16]=r,e[17]=o,e[18]=n,e[19]=a,e[20]=s,e[21]=n,e[22]=a,e[23]=o,e}function Xli(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new It(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function Kli(t,e,i=nc()){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=e[0],i[4]=e[1],i[5]=e[2],i}function wLe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function eci(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function kO(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Qmt(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],a=t[2],o=t[3],l=t[4],u=t[5];for(let d=0;d<r;d++)s=Math.min(s,e[i+3*d]),n=Math.min(n,e[i+3*d+1]),a=Math.min(a,e[i+3*d+2]),o=Math.max(o,e[i+3*d]),l=Math.max(l,e[i+3*d+1]),u=Math.max(u,e[i+3*d+2]);t[0]=s,t[1]=n,t[2]=a,t[3]=o,t[4]=l,t[5]=u}function EJ(t,e,i){const r=e.length;let s=t[0],n=t[1],a=t[2],o=t[3],l=t[4],u=t[5];if(i)for(let d=0;d<r;d++){const f=e[d];s=Math.min(s,f[0]),n=Math.min(n,f[1]),a=Math.min(a,f[2]),o=Math.max(o,f[0]),l=Math.max(l,f[1]),u=Math.max(u,f[2])}else for(let d=0;d<r;d++){const f=e[d];s=Math.min(s,f[0]),n=Math.min(n,f[1]),o=Math.max(o,f[0]),l=Math.max(l,f[1])}t[0]=s,t[1]=n,t[2]=a,t[3]=o,t[4]=l,t[5]=u}function Xmt(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function M$(t){return t[0]>=t[3]?0:t[3]-t[0]}function E$(t){return t[1]>=t[4]?0:t[4]-t[1]}function k1(t){return t[2]>=t[5]?0:t[5]-t[2]}function Kmt(t){const e=M$(t),i=k1(t),r=E$(t);return Math.sqrt(e*e+i*i+r*r)}function Pue(t,e=[0,0,0]){return e[0]=t[0]+M$(t)/2,e[1]=t[1]+E$(t)/2,e[2]=t[2]+k1(t)/2,e}function tci(t,e=[0,0,0]){return e[0]=M$(t),e[1]=E$(t),e[2]=k1(t),e}function egt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function ici(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function tgt(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function rci(t,e){return e==null||tgt(t,e)}function sci(t,e,i){let r=0,s=1;for(let n=0;n<3;++n){const a=t[n],o=t[n+3],l=e[n],u=i[n],d=u<l,f=d?u:l,g=d?l:u,v=Math.max(a,f),_=Math.min(o,g);if(v>_)return!1;if(g===f)break;const x=g-f,S=(v-f)/x,T=(_-f)/x;if(r=Math.max(r,d?1-T:S),s=Math.min(s,d?1-S:T),r>s)return!1}return!0}function igt(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function nci(t,e,i=t){const r=t[0]+M$(t)/2,s=t[1]+E$(t)/2,n=t[2]+k1(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function aci(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function xLe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function SLe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function F7(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Wu(t){return t?F7(t,Wie):nc(Wie)}function Rue(t,e=fi()){return e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function oci(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function rgt(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function Hie(t){return t.length===6}function TLe(t){return M$(t)===0&&E$(t)===0&&k1(t)===0}function lci(t,e,i){if(t==null||e==null)return t===e;if(!Hie(t)||!Hie(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function sgt(t,e,i,r,s,n){return DO(t,e,i,r,s,n,ngt)}const cci=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Wie=[1/0,1/0,1/0,-1/0,-1/0,-1/0],$Le=[0,0,0,0,0,0],ngt=nc();function uci(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const a=Ye(i,r,s);let o;for(let l=0;l<3;l++){const u=a[l];if(u!=null){o=u/t[l];break}}for(let l=0;l<3;l++)a[l]==null&&(a[l]=t[l]*o);return a}const agt=DO(-.5,-.5,-.5,.5,.5,.5),ogt=DO(-.5,-.5,0,.5,.5,1),lgt=DO(-.5,-.5,0,.5,.5,.5);function hci(t){switch(t){case"sphere":case"cube":case"diamond":return agt;case"cylinder":case"cone":case"inverted-cone":return ogt;case"tetrahedron":return lgt;default:return}}const Iue=["butt","square","round"],cgt=[...Iue,"none"],CLe=["miter","bevel","round"];var Zie;let t2=Zie=class extends ae{constructor(t){super(t),this.color=new Je([0,0,0,1]),this.size=Tp(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new Zie(t)}};c([p(e_({colorRequiredOnWrite:!0}))],t2.prototype,"color",void 0),c([p({...Yg,json:{write:{isRequired:!0}}})],t2.prototype,"size",void 0),c([p(_Le)],t2.prototype,"pattern",void 0),c([p({type:Iue,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],t2.prototype,"patternCap",void 0),t2=Zie=c([R("esri.symbols.support.Symbol3DOutline")],t2);var xU,xA;let jl=(xA=class extends Vc{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new xU(e)}static fromSimpleFillSymbol(e){const i=e.outline&&e.outline.style&&e.outline.style!=="solid"?new oS({style:e.outline.style}):null,r={size:e.outline?.width??0,color:(e.outline?.color??A4).clone(),pattern:i};return i&&e.outline?.cap&&(r.patternCap=e.outline.cap),new xU({material:new O4({color:(e.color??Zmt).clone()}),pattern:e.style&&e.style!=="solid"?new oE({style:e.style}):null,outline:r})}},xU=xA,xA);c([st({Fill:"fill"},{readOnly:!0})],jl.prototype,"type",void 0),c([p({type:O4,json:{write:!0}})],jl.prototype,"material",void 0),c([p(Wmt)],jl.prototype,"pattern",void 0),c([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],jl.prototype,"castShadows",void 0),c([p({type:t2,json:{write:!0}})],jl.prototype,"outline",void 0),c([p(vLe)],jl.prototype,"edges",void 0),jl=xU=c([R("esri.symbols.FillSymbol3DLayer")],jl);var Yie;const ugt=so()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let i2=Yie=class extends ae{constructor(t){super(t)}readHref(t,e,i){return t?y$(t,i):e.dataURI}writeHref(t,e,i,r){t&&(mm(t)?e.dataURI=t:(e.href=HT(t,r),Nu(e.href)&&(e.href=pp(e.href))))}clone(){return new Yie({href:this.href,primitive:this.primitive})}equals(t){return t.primitive===this.primitive&&t.href===this.href}};c([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],i2.prototype,"href",void 0),c([Oe("href")],i2.prototype,"readHref",null),c([Ie("href",{href:{type:String},dataURI:{type:String}})],i2.prototype,"writeHref",null),c([st(ugt)],i2.prototype,"primitive",void 0),i2=Yie=c([R("esri.symbols.support.IconSymbol3DLayerResource")],i2);const dci="circle";let SU=class extends nt(ae){constructor(e){super(e),this.mode="hidden"}equals(e){return this.mode===e.mode}};c([p({type:["adaptive","hidden","visible"],json:{write:{isRequired:!0}}})],SU.prototype,"mode",void 0),SU=c([R("esri.symbols.support.OccludedVisibility")],SU);const MLe=SU;var Jie;let lE=Jie=class extends be{constructor(t){super(t),this.x=0,this.y=0}clone(){return new Jie({x:this.x,y:this.y})}equals(t){return t.x===this.x&&t.y===this.y}};c([p({type:Number})],lE.prototype,"x",void 0),c([p({type:Number})],lE.prototype,"y",void 0),lE=Jie=c([R("esri.symbols.support.Symbol3DAnchorPosition2D")],lE);var Qie;let OD=Qie=class extends ae{constructor(t){super(t),this.color=new Je([0,0,0,1]),this.size=Tp(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new Qie(t)}equals(t){return t.size===this.size&&(this.color==null?t.color==null:this.color.equals(t.color))}};c([p(e_({colorRequiredOnWrite:!0}))],OD.prototype,"color",void 0),c([p({...Yg,json:{write:{isRequired:!0}}})],OD.prototype,"size",void 0),OD=Qie=c([R("esri.symbols.support.Symbol3DIconOutline")],OD);var LM,SA;let bo=(SA=class extends Vc{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null,this.angle=0,this.occludedVisibility=null}clone(){return new LM({anchor:this.anchor,anchorPosition:se(this.anchorPosition),enabled:this.enabled,material:se(this.material),outline:se(this.outline),resource:se(this.resource),angle:this.angle,size:this.size,occludedVisibility:se(this.occludedVisibility)})}static fromSimpleMarkerSymbol(e){const i=e.color||A4,r=h1e(e),s=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||A4).clone()}:null;return new LM({size:e.size,angle:e.angle,resource:{primitive:dgt(()=>re.getLogger(this.prototype),e.style)},material:{color:i},outline:s,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const i=!e.color||Ymt(e.color)?A4:e.color,r=h1e(e);return new LM({size:e.width<=e.height?e.height:e.width,angle:e.angle,resource:{href:e.url},material:{color:i.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new LM({resource:{href:SRe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}},LM=SA,SA);function h1e(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=d1e(t.xoffset),s=d1e(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function d1e(t){return isFinite(t)?t:0}c([p({type:Bh,json:{write:!0}})],bo.prototype,"material",void 0),c([p({type:i2,json:{write:!0}})],bo.prototype,"resource",void 0),c([st({Icon:"icon"},{readOnly:!0})],bo.prototype,"type",void 0),c([p({...Yg,json:{write:{isRequired:!0}}})],bo.prototype,"size",void 0),c([st({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"},{default:"center"})],bo.prototype,"anchor",void 0),c([p({type:lE,json:{type:[Number],read:{reader:t=>new lE({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],bo.prototype,"anchorPosition",void 0),c([p({type:OD,json:{write:!0}})],bo.prototype,"outline",void 0),c([p({type:Number,json:{write:!0,default:0}})],bo.prototype,"angle",void 0),c([p({type:MLe})],bo.prototype,"occludedVisibility",void 0),bo=LM=c([R("esri.symbols.IconSymbol3DLayer")],bo);const hgt={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function dgt(t,e){return hgt[e]||(t().warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const pgt=["begin","end","begin-end"],ELe=["arrow","circle","square","diamond","cross","x"];let Wv=class extends nt(ae){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};c([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],Wv.prototype,"type",void 0),c([p({type:pgt,json:{default:"begin-end",write:!0}})],Wv.prototype,"placement",void 0),c([p({type:ELe,json:{default:"arrow",write:!0}})],Wv.prototype,"style",void 0),c([p({type:Je,json:{type:[vi],default:null,write:!0}})],Wv.prototype,"color",void 0),Wv=c([R("esri.symbols.LineStyleMarker3D")],Wv);var TU,TA;let Ac=(TA=class extends Vc{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Tp(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new TU(e)}static fromSimpleLineSymbol(e){const i={enabled:!0,size:e.width??Tp(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style?new oS({style:e.style}):null,material:new Bh({color:(e.color||A4).clone()}),marker:e.marker?new Wv({placement:e.marker.placement,style:e.marker.style,color:e.marker.color?.clone()??null}):null};return new TU(i)}},TU=TA,TA);c([p({type:Bh,json:{write:!0}})],Ac.prototype,"material",void 0),c([st({Line:"line"},{readOnly:!0})],Ac.prototype,"type",void 0),c([p({type:CLe,json:{write:!0,default:"miter"}})],Ac.prototype,"join",void 0),c([p({type:Iue,json:{write:!0,default:"butt"}})],Ac.prototype,"cap",void 0),c([p({...Yg,json:{write:{isRequired:!0}}})],Ac.prototype,"size",void 0),c([p(_Le)],Ac.prototype,"pattern",void 0),c([p({types:{key:"type",base:Wv,typeMap:{style:Wv}},json:{write:!0}})],Ac.prototype,"marker",void 0),Ac=TU=c([R("esri.symbols.LineSymbol3DLayer")],Ac);var Xie;const fgt=so()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let PD=Xie=class extends ae{clone(){return new Xie({href:this.href,primitive:this.primitive})}};c([p({type:String,json:{read:t7,write:WT}})],PD.prototype,"href",void 0),c([st(fgt)],PD.prototype,"primitive",void 0),PD=Xie=c([R("esri.symbols.support.ObjectSymbol3DLayerResource")],PD);const mgt="sphere";var Kie;let N2=Kie=class extends be{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Kie({x:this.x,y:this.y,z:this.z})}};c([p({type:Number})],N2.prototype,"x",void 0),c([p({type:Number})],N2.prototype,"y",void 0),c([p({type:Number})],N2.prototype,"z",void 0),N2=Kie=c([R("esri.symbols.support.Symbol3DAnchorPosition3D")],N2);var ere,$A;let No=($A=class extends Vc{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new ere({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}},ere=$A,$A);c([p({type:Bh,json:{write:!0}})],No.prototype,"material",void 0),c([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],No.prototype,"castShadows",void 0),c([p({type:PD,json:{write:!0}})],No.prototype,"resource",void 0),c([st({Object:"object"},{readOnly:!0})],No.prototype,"type",void 0),c([p({type:Number,json:{write:!0}})],No.prototype,"width",void 0),c([p({type:Number,json:{write:!0}})],No.prototype,"height",void 0),c([p({type:Number,json:{write:!0}})],No.prototype,"depth",void 0),c([st({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"},{default:"origin"})],No.prototype,"anchor",void 0),c([p({type:N2,json:{type:[Number],read:{reader:t=>new N2({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],No.prototype,"anchorPosition",void 0),c([p({type:Number,json:{write:!0}})],No.prototype,"heading",void 0),c([p({type:Number,json:{write:!0}})],No.prototype,"tilt",void 0),c([p({type:Number,json:{write:!0}})],No.prototype,"roll",void 0),c([p({readOnly:!0})],No.prototype,"isPrimitive",null),No=ere=c([R("esri.symbols.ObjectSymbol3DLayer")],No);var tre,CA;let ul=(CA=class extends Vc{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,i){return e??(i.height==null&&i.size!=null?i.size:void 0)}readHeight(e,i){return e??(i.width==null&&i.size!=null?i.size:void 0)}clone(){return new tre({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}},tre=CA,CA);c([p({type:Bh,json:{write:!0}})],ul.prototype,"material",void 0),c([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ul.prototype,"castShadows",void 0),c([st({Path:"path"},{readOnly:!0})],ul.prototype,"type",void 0),c([p({type:["circle","quad"],nonNullable:!0,json:{write:!0,default:"circle"}})],ul.prototype,"profile",void 0),c([p({type:CLe,nonNullable:!0,json:{write:!0,default:"miter"}})],ul.prototype,"join",void 0),c([p({type:cgt,nonNullable:!0,json:{write:!0,default:"butt"}})],ul.prototype,"cap",void 0),c([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],ul.prototype,"width",void 0),c([Oe("width",["width","size","height"])],ul.prototype,"readWidth",null),c([p({type:Number,json:{write:!0}})],ul.prototype,"height",void 0),c([Oe("height",["height","size","width"])],ul.prototype,"readHeight",null),c([p({type:["center","bottom","top"],nonNullable:!0,json:{write:!0,default:"center"}})],ul.prototype,"anchor",void 0),c([p({type:["heading","all"],nonNullable:!0,json:{write:!0,default:"all"}})],ul.prototype,"profileRotation",void 0),ul=tre=c([R("esri.symbols.PathSymbol3DLayer")],ul);const ggt=["none","underline","line-through"],ygt=["normal","italic","oblique"],vgt=["normal","lighter","bold","bolder"],ALe={type:Number,cast:t=>{const e=Fc(t);return e===0?1:Ce(e,.1,4)},nonNullable:!0},_gt=["left","right","center"],bgt=["baseline","top","middle","bottom"],OLe={type:_gt,nonNullable:!0},PLe={type:bgt,nonNullable:!0},mci=8;var ire;let qd=ire=class extends ae{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return mr(t)}clone(){return new ire({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};c([p({type:ggt,json:{default:"none",write:!0}})],qd.prototype,"decoration",void 0),c([p({type:String,json:{write:!0}})],qd.prototype,"family",void 0),c([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],qd.prototype,"size",void 0),c([wi("size")],qd.prototype,"castSize",null),c([p({type:ygt,json:{default:"normal",write:!0}})],qd.prototype,"style",void 0),c([p({type:vgt,json:{default:"normal",write:!0}})],qd.prototype,"weight",void 0),qd=ire=c([R("esri.symbols.Font")],qd);var rre;let cE=rre=class extends ae{constructor(){super(...arguments),this.color=new Je([0,0,0,1]),this.size=0}clone(){const t={color:se(this.color),size:this.size};return new rre(t)}};c([p(e_())],cE.prototype,"color",void 0),c([p(Yg)],cE.prototype,"size",void 0),cE=rre=c([R("esri.symbols.support.Symbol3DHalo")],cE);let P4=class extends nt(ae){constructor(e){super(e),this.color=null}};c([p(e_())],P4.prototype,"color",void 0),P4=c([R("esri.symbols.support.Symbol3DTextBackground")],P4);var $U,MA;let va=(MA=class extends Vc{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline",this.occludedVisibility=null}get font(){return this._get("font")||null}set font(e){e!=null&&this._userSize!=null&&(e.size=this._userSize),this._set("font",e)}writeFont(e,i,r,s){const n={...s,textSymbol3D:!0};i.font=e.write({},n),delete i.font.size}get size(){return this._userSize!=null?this._userSize:this.font?.size!=null?this.font.size:9}set size(e){this._userSize=e,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new $U({enabled:this.enabled,font:se(this.font),halo:se(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:se(this.background),occludedVisibility:se(this.occludedVisibility)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new $U({font:e.font!=null?e.font.clone():new qd,halo:wgt(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Bh({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new P4({color:e.backgroundColor.clone()}):null})}},$U=MA,MA);function wgt(t,e){return t&&e!=null&&e>0?new cE({color:se(t),size:e}):null}c([p({type:qd,json:{write:!0}})],va.prototype,"font",null),c([Ie("font")],va.prototype,"writeFont",null),c([p({type:cE,json:{write:!0}})],va.prototype,"halo",void 0),c([p({...OLe,json:{default:"center",write:!0}})],va.prototype,"horizontalAlignment",void 0),c([p({...ALe,json:{default:1,write:!0}})],va.prototype,"lineHeight",void 0),c([p({type:Bh,json:{write:!0}})],va.prototype,"material",void 0),c([p({type:P4,json:{write:!0}})],va.prototype,"background",void 0),c([p(Yg)],va.prototype,"size",null),c([p({type:String,json:{write:!0}})],va.prototype,"text",void 0),c([st({Text:"text"},{readOnly:!0})],va.prototype,"type",void 0),c([p({...PLe,json:{default:"baseline",write:!0}})],va.prototype,"verticalAlignment",void 0),c([p({type:MLe})],va.prototype,"occludedVisibility",void 0),va=$U=c([R("esri.symbols.TextSymbol3DLayer")],va);var sre,EA;let Dv=(EA=class extends Vc{constructor(e){super(e),this.color=nre.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new sre({color:this.color.clone(),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}},sre=EA,EA);c([p({type:Je,nonNullable:!0,json:{type:[vi],write:(t,e,i)=>e[i]=t.toArray(1),default:()=>nre.clone(),defaultEquals:t=>t.toCss(!0)===nre.toCss(!0)}})],Dv.prototype,"color",void 0),c([st({Water:"water"},{readOnly:!0})],Dv.prototype,"type",void 0),c([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Dv.prototype,"waterbodySize",void 0),c([p({type:Number,json:{write:!0,default:null}})],Dv.prototype,"waveDirection",void 0),c([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Dv.prototype,"waveStrength",void 0),Dv=sre=c([R("esri.symbols.WaterSymbol3DLayer")],Dv);const nre=new Je([0,119,190]);var are;let Zv=are=class extends be{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new are({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};c([p({type:String})],Zv.prototype,"name",void 0),c([p({type:String})],Zv.prototype,"styleUrl",void 0),c([p({type:String})],Zv.prototype,"styleName",void 0),c([p({type:ze})],Zv.prototype,"portal",void 0),Zv=are=c([R("esri.symbols.support.StyleOrigin")],Zv);var ore;let R4=ore=class extends be{constructor(){super(...arguments),this.url=""}clone(){return new ore({url:this.url})}};c([p({type:String})],R4.prototype,"url",void 0),R4=ore=c([R("esri.symbols.support.Thumbnail")],R4);const RLe={icon:bo,object:No,line:Ac,path:ul,fill:jl,extrude:Iv,text:va,water:Dv},xgt=ke.ofType({base:Vc,key:"type",typeMap:RLe,errorContext:"symbol-layer"});let Tu=class extends Kn{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i?.type,s=r||ke;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&re.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){ju(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=y$(e.styleUrl,r);return new Zv({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new Zv({portal:r?.portal||ze.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new Gu("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=HT(e.styleUrl,s);Nu(n)&&(n=pp(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s?.portal&&!wRe(e.portal.restUrl,s.portal.restUrl)?s?.messages&&s.messages.push(new Gu("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Vc||e&&RLe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};c([p({json:{read:!1,write:!1}})],Tu.prototype,"color",null),c([p({type:xgt,nonNullable:!0,json:{write:!0}}),wi(b7)],Tu.prototype,"symbolLayers",null),c([p({type:Zv})],Tu.prototype,"styleOrigin",void 0),c([Oe("styleOrigin")],Tu.prototype,"readStyleOrigin",null),c([Ie("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Tu.prototype,"writeStyleOrigin",null),c([p({type:R4,json:{read:!1}})],Tu.prototype,"thumbnail",void 0),c([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Tu.prototype,"type",void 0),Tu=c([R("esri.symbols.Symbol3D")],Tu);let uE=class extends ae{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};c([p({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],uE.prototype,"type",void 0),c([p({readOnly:!0})],uE.prototype,"visible",void 0),uE=c([R("esri.symbols.callouts.Callout3D")],uE);var lre;let CU=lre=class extends ae{constructor(t){super(t),this.color=new Je("white")}clone(){return new lre({color:se(this.color)})}};c([p(e_({colorRequiredOnWrite:!0}))],CU.prototype,"color",void 0),CU=lre=c([R("esri.symbols.callouts.LineCallout3DBorder")],CU);const Sgt=CU;var cre;let kv=cre=class extends uE{constructor(t){super(t),this.type="line",this.color=new Je([0,0,0,1]),this.size=Tp(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new cre({color:se(this.color),size:this.size,border:se(this.border)})}};c([st({line:"line"})],kv.prototype,"type",void 0),c([p(e_({colorRequiredOnWrite:!0}))],kv.prototype,"color",void 0),c([p({...Yg,json:{write:{isRequired:!0}}})],kv.prototype,"size",void 0),c([p({type:Sgt,json:{write:!0}})],kv.prototype,"border",void 0),c([p({readOnly:!0})],kv.prototype,"visible",null),kv=cre=c([R("esri.symbols.callouts.LineCallout3D")],kv);function Due(t){if(!t)return!1;const e=t.verticalOffset;return!(!e||e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function ILe(t){return!t||!t.supportsCallout||!t.supportsCallout()?!1:!!t.callout?.visible&&!!Due(t)}function DLe(t){return t.type==="point-3d"||t.type==="label-3d"}function Tgt(t){return t.horizontalAlignment==="center"}const kLe={types:{key:"type",base:uE,typeMap:{line:kv}},json:{write:!0}};var ure;let sw=ure=class extends ae{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new ure({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};c([p({...Yg,json:{write:{isRequired:!0}}})],sw.prototype,"screenLength",void 0),c([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],sw.prototype,"minWorldLength",void 0),c([p({type:Number,json:{write:!0}})],sw.prototype,"maxWorldLength",void 0),sw=ure=c([R("esri.symbols.support.Symbol3DVerticalOffset")],sw);var MU;const LLe=ke.ofType({base:null,key:"type",typeMap:{text:va}});let $f=MU=class extends Tu{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new LLe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return ILe(this)}hasVisibleVerticalOffset(){return Due(this)}clone(){return new MU({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail),callout:se(this.callout),verticalOffset:se(this.verticalOffset)})}static fromTextSymbol(t){return new MU({symbolLayers:new ke([va.fromTextSymbol(t)])})}};c([p({type:sw,json:{write:!0}})],$f.prototype,"verticalOffset",void 0),c([p(kLe)],$f.prototype,"callout",void 0),c([p({json:{read:!1,write:!1}})],$f.prototype,"styleOrigin",void 0),c([p({type:LLe})],$f.prototype,"symbolLayers",void 0),c([st({LabelSymbol3D:"label-3d"},{readOnly:!0})],$f.prototype,"type",void 0),$f=MU=c([R("esri.symbols.LabelSymbol3D")],$f);var EU;const FLe=ke.ofType({base:null,key:"type",typeMap:{line:Ac,path:ul}}),$gt=ke.ofType({base:null,key:"type",typeMap:{line:Ac,path:ul}});let Bf=EU=class extends Tu{constructor(t){super(t),this.symbolLayers=new FLe,this.type="line-3d"}clone(){return new EU({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleLineSymbol(t){return new EU({symbolLayers:new ke([Ac.fromSimpleLineSymbol(t)])})}};c([p({type:FLe,json:{type:$gt}})],Bf.prototype,"symbolLayers",void 0),c([st({LineSymbol3D:"line-3d"},{readOnly:!0})],Bf.prototype,"type",void 0),Bf=EU=c([R("esri.symbols.LineSymbol3D")],Bf);var AU;const zLe=ke.ofType({base:null,key:"type",typeMap:{fill:jl}});let kg=AU=class extends Tu{constructor(t){super(t),this.symbolLayers=new zLe,this.type="mesh-3d"}clone(){return new AU({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleFillSymbol(t){return new AU({symbolLayers:new ke([jl.fromSimpleFillSymbol(t)])})}};c([p({type:zLe})],kg.prototype,"symbolLayers",void 0),c([st({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],kg.prototype,"type",void 0),kg=AU=c([R("esri.symbols.MeshSymbol3D")],kg);let RD=class extends Kn{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};c([st({esriSLS:"simple-line"},{readOnly:!0})],RD.prototype,"type",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],RD.prototype,"width",void 0),RD=c([R("esri.symbols.LineSymbol")],RD);var hre;let Zm=hre=class extends ae{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=r?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t?.[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){r?.origin==="web-map"||(e[i]=t)}clone(){return new hre({color:se(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};c([p({type:["begin","end","begin-end"],json:{write:!0}})],Zm.prototype,"placement",void 0),c([st({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],Zm.prototype,"type",void 0),c([p({type:ELe})],Zm.prototype,"style",void 0),c([Ie("style")],Zm.prototype,"writeStyle",null),c([p({type:Je,value:null,json:{write:{allowNull:!0}}})],Zm.prototype,"color",null),c([Oe("color")],Zm.prototype,"readColor",null),c([Ie("color")],Zm.prototype,"writeColor",null),Zm=hre=c([R("esri.symbols.LineSymbolMarker")],Zm);const Cgt=Zm;var dre;const AJ=new ii({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Rn=dre=class extends RD{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const a={};return t!=null&&(a.style=t),e!=null&&(a.color=e),i!=null&&(a.width=mr(i)),r!=null&&(a.cap=r),s!=null&&(a.join=s),n!=null&&(a.miterLimit=mr(n)),a}clone(){return new dre({color:se(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};c([st({esriSLS:"simple-line"},{readOnly:!0})],Rn.prototype,"type",void 0),c([p({type:AJ.apiValues,json:{read:AJ.read,write:AJ.write}})],Rn.prototype,"style",void 0),c([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Rn.prototype,"cap",void 0),c([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Rn.prototype,"join",void 0),c([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":Cgt}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Rn.prototype,"marker",void 0),c([p({type:Number,json:{read:!1,write:!1}})],Rn.prototype,"miterLimit",void 0),Rn=dre=c([R("esri.symbols.SimpleLineSymbol")],Rn);let hE=class extends Kn{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}};c([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Rn}},json:{default:null,write:!0}})],hE.prototype,"outline",void 0),c([p({type:["simple-fill","picture-fill"],readOnly:!0})],hE.prototype,"type",void 0),hE=c([R("esri.symbols.FillSymbol")],hE);function Mgt(t,e,i){return e.imageData?SRe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):NLe(e.url,i)}function NLe(t,e){if(!Nu(t)){const i=Agt(e);if(i)return Xh(i,"images",t)}return y$(t,e)}function Egt(t,e,i,r){if(mm(t)){const s=GT(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&WT(i.url,e,"url",r)}else WT(t,e,"url",r)}const VLe={json:{read:{source:["imageData","url"],reader:Mgt},write:{writer(t,e,i,r){Egt(t,e,this.source,r)}}}},jLe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=NLe(e.url,i)),r}}}};function Agt(t){if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i?.type;return r==="feature"||r==="stream"?i.parsedUrl?.path:r==="map-image"||r==="tile"?t.url?.path:null}var pre;let bu=pre=class extends hE{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=mr(i)),r!=null&&(s.height=mr(r)),s}clone(){const t=new pre({color:se(this.color),height:this.height,outline:se(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",se(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};c([st({esriPFS:"picture-fill"},{readOnly:!0})],bu.prototype,"type",void 0),c([p(VLe)],bu.prototype,"url",void 0),c([p({type:Number,json:{write:!0}})],bu.prototype,"xscale",void 0),c([p({type:Number,json:{write:!0}})],bu.prototype,"yscale",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],bu.prototype,"width",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],bu.prototype,"height",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],bu.prototype,"xoffset",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],bu.prototype,"yoffset",void 0),c([p(jLe)],bu.prototype,"source",void 0),bu=pre=c([R("esri.symbols.PictureFillSymbol")],bu);let Lv=class extends Kn{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};c([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Lv.prototype,"angle",void 0),c([p({type:["simple-marker","picture-marker"],readOnly:!0})],Lv.prototype,"type",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],Lv.prototype,"xoffset",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],Lv.prototype,"yoffset",void 0),c([p({cast:t=>t==="auto"?t:Fc(mr(t)),json:{write:!0}})],Lv.prototype,"size",void 0),Lv=c([R("esri.symbols.MarkerSymbol")],Lv);var fre;let Ec=fre=class extends Lv{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=mr(e)),i!=null&&(r.height=mr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new fre({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",se(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};c([p({json:{write:!1}})],Ec.prototype,"color",void 0),c([st({esriPMS:"picture-marker"},{readOnly:!0})],Ec.prototype,"type",void 0),c([p(VLe)],Ec.prototype,"url",void 0),c([p(jLe)],Ec.prototype,"source",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],Ec.prototype,"height",void 0),c([Oe("height",["height","size"])],Ec.prototype,"readHeight",null),c([p({type:Number,cast:mr,json:{write:!0}})],Ec.prototype,"width",void 0),c([p({json:{write:!1}})],Ec.prototype,"size",void 0),Ec=fre=c([R("esri.symbols.PictureMarkerSymbol")],Ec);var r2;const ULe=ke.ofType({base:null,key:"type",typeMap:{icon:bo,object:No,text:va}});let Gl=r2=class extends Tu{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new ULe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return ILe(this)}hasVisibleVerticalOffset(){return Due(this)}clone(){return new r2({verticalOffset:se(this.verticalOffset),callout:se(this.callout),styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new r2({symbolLayers:new ke([bo.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new r2({symbolLayers:new ke([bo.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const i=t.data.symbol;return new r2(i?.callout?{symbolLayers:new ke([bo.fromCIMSymbol(t)]),callout:new kv({size:.5,color:new Je([0,0,0])}),verticalOffset:new sw({screenLength:40})}:{symbolLayers:new ke([bo.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new r2({symbolLayers:new ke([va.fromTextSymbol(t)])})}};c([p({type:sw,json:{write:!0}})],Gl.prototype,"verticalOffset",void 0),c([p(kLe)],Gl.prototype,"callout",void 0),c([p({type:ULe,json:{origins:{"web-scene":{write:!0}}}})],Gl.prototype,"symbolLayers",void 0),c([st({PointSymbol3D:"point-3d"},{readOnly:!0})],Gl.prototype,"type",void 0),Gl=r2=c([R("esri.symbols.PointSymbol3D")],Gl);var ID;const BLe=ke.ofType({base:null,key:"type",typeMap:{extrude:Iv,fill:jl,icon:bo,line:Ac,object:No,text:va,water:Dv}});let hp=ID=class extends Tu{constructor(t){super(t),this.symbolLayers=new BLe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&Xw(re.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&Xw(re.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(tn(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Ht))}clone(){return new ID({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromJSON(t){const e=new ID;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers?.[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new ID({symbolLayers:new ke([jl.fromSimpleFillSymbol(t)])})}};c([p({type:BLe,json:{write:!0}})],hp.prototype,"symbolLayers",void 0),c([st({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],hp.prototype,"type",void 0),hp=ID=c([R("esri.symbols.PolygonSymbol3D")],hp);var mre;const OJ=new ii({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Pu=mre=class extends hE{constructor(...t){super(...t),this.color=new Je([0,0,0,.25]),this.outline=new Rn,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new mre({color:se(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};c([p()],Pu.prototype,"color",void 0),c([p()],Pu.prototype,"outline",void 0),c([st({esriSFS:"simple-fill"},{readOnly:!0})],Pu.prototype,"type",void 0),c([p({type:OJ.apiValues,json:{read:OJ.read,write:OJ.write}})],Pu.prototype,"style",void 0),Pu=mre=c([R("esri.symbols.SimpleFillSymbol")],Pu);var gre;const PJ=new ii({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let wa=gre=class extends Lv{constructor(...t){super(...t),this.color=new Je([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Rn}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=mr(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new gre({angle:this.angle,color:se(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};c([p()],wa.prototype,"color",void 0),c([Ie("color")],wa.prototype,"writeColor",null),c([st({esriSMS:"simple-marker"},{readOnly:!0})],wa.prototype,"type",void 0),c([p()],wa.prototype,"size",void 0),c([p({type:PJ.apiValues,json:{read:PJ.read,write:PJ.write}})],wa.prototype,"style",void 0),c([p({type:String,json:{write:!0}})],wa.prototype,"path",null),c([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Rn}},json:{default:null,write:!0}})],wa.prototype,"outline",void 0),wa=gre=c([R("esri.symbols.SimpleMarkerSymbol")],wa);var yre;let es=yre=class extends Kn{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new qd,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return mr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new yre({angle:this.angle,backgroundColor:se(this.backgroundColor),borderLineColor:se(this.borderLineColor),borderLineSize:this.borderLineSize,color:se(this.color),font:this.font&&this.font.clone(),haloColor:se(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};c([p({type:Je,json:{write:!0}})],es.prototype,"backgroundColor",void 0),c([p({type:Je,json:{write:!0}})],es.prototype,"borderLineColor",void 0),c([p({type:Number,json:{write:!0},cast:mr})],es.prototype,"borderLineSize",void 0),c([p({type:qd,json:{write:!0}})],es.prototype,"font",void 0),c([p({...OLe,json:{write:!0}})],es.prototype,"horizontalAlignment",void 0),c([p({type:Boolean,json:{write:!0}})],es.prototype,"kerning",void 0),c([p({type:Je,json:{write:!0}})],es.prototype,"haloColor",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],es.prototype,"haloSize",void 0),c([p({type:Boolean,json:{write:!0}})],es.prototype,"rightToLeft",void 0),c([p({type:Boolean,json:{write:!0}})],es.prototype,"rotated",void 0),c([p({type:String,json:{write:!0}})],es.prototype,"text",void 0),c([st({esriTS:"text"},{readOnly:!0})],es.prototype,"type",void 0),c([p({...PLe,json:{write:!0}})],es.prototype,"verticalAlignment",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],es.prototype,"xoffset",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],es.prototype,"yoffset",void 0),c([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],es.prototype,"angle",void 0),c([p({type:Number,json:{write:!0}})],es.prototype,"width",void 0),c([p({type:Number})],es.prototype,"lineWidth",void 0),c([Ie("lineWidth")],es.prototype,"writeLineWidth",null),c([wi("lineWidth")],es.prototype,"castLineWidth",null),c([p(ALe)],es.prototype,"lineHeight",void 0),c([Ie("lineHeight")],es.prototype,"writeLineHeight",null),es=yre=c([R("esri.symbols.TextSymbol")],es);var vre;let dl=vre=class extends Kn{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:ze.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new vre({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol(t)}async fetchCIMSymbol(t){eRe(re.getLogger(this),"WebStyleSymbol.fetchCIMSymbol is deprecated in favour of WebStyleSymbol.fetchSymbol which now supports both web and cim symbology",{version:"4.33",replacement:"WebStyleSymbol.fetchSymbol",see:"https://arcg.is/0CXPTr#fetchSymbol",warnOnce:!0});const e=await this._fetchSymbol({...t,acceptedFormats:["cim"]});if(e?.type!=="cim")throw new q("webstylesymbol:fetchCIMSymbol","Resolved web style symbol is not of type 'cim'");return e}async _fetchSymbol(t){const e=t!=null?t.cache:null,i=e?this._fetchCacheKey:null;if(e!=null){const a=i&&e.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:r}=await W(()=>import("./webStyleSymbolUtils-C2Nim7cq.js"),__vite__mapDeps([143,144]));ct(t);const s=r(this,{portal:this.portal},t);s.catch(a=>{re.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const n=await s;return e?.set(i,n.clone()),n}};c([p({json:{write:!1}})],dl.prototype,"color",void 0),c([p({type:String,json:{write:!0}})],dl.prototype,"styleName",void 0),c([p({type:ze,json:{write:!1}})],dl.prototype,"portal",void 0),c([p({type:String,json:{read:t7,write:WT}})],dl.prototype,"styleUrl",void 0),c([p({type:R4,json:{read:!1}})],dl.prototype,"thumbnail",void 0),c([p({type:String,json:{write:!0}})],dl.prototype,"name",void 0),c([st({styleSymbolReference:"web-style"},{readOnly:!0})],dl.prototype,"type",void 0),c([p()],dl.prototype,"_fetchCacheKey",null),dl=vre=c([R("esri.symbols.WebStyleSymbol")],dl);function xci(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function qLe(t){switch(t?.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Vh={base:Kn,key:"type",typeMap:{"simple-fill":Pu,"picture-fill":bu,"picture-marker":Ec,"simple-line":Rn,"simple-marker":wa,text:es,"label-3d":$f,"line-3d":Bf,"mesh-3d":kg,"point-3d":Gl,"polygon-3d":hp,"web-style":dl,cim:fl},errorContext:"symbol"},Sci={base:Kn,key:"type",typeMap:{"picture-marker":Ec,"simple-marker":wa,"point-3d":Gl,cim:fl},errorContext:"symbol"},Tci={base:Kn,key:"type",typeMap:{"simple-line":Rn,"line-3d":Bf,cim:fl},errorContext:"symbol"},$ci={base:Kn,key:"type",typeMap:{"simple-fill":Pu,"picture-fill":bu,"polygon-3d":hp,cim:fl},errorContext:"symbol"},Ogt={base:Kn,key:"type",typeMap:{"picture-marker":Ec,"simple-marker":wa,text:es,"web-style":dl,cim:fl},errorContext:"symbol"},Pgt=pP({types:Vh}),GLe={base:Kn,key:"type",typeMap:{"simple-fill":Pu,"picture-fill":bu,"picture-marker":Ec,"simple-line":Rn,"simple-marker":wa,text:es,"line-3d":Bf,"mesh-3d":kg,"point-3d":Gl,"polygon-3d":hp,"web-style":dl,cim:fl},errorContext:"symbol"},Rgt={base:Kn,key:"type",typeMap:{text:es,"label-3d":$f},errorContext:"symbol"},p1e={base:Kn,key:"type",typeMap:{"line-3d":Bf,"mesh-3d":kg,"point-3d":Gl,"polygon-3d":hp,"web-style":dl,cim:fl},errorContext:"symbol"},Igt={base:Kn,key:"type",typeMap:{"label-3d":$f},errorContext:"symbol"},HLe=sm(Vh);var _re;function Dgt(t){if(!t)return null;const e={};for(const i in t){const r=wp(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function kgt(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}var AA;let ms=(AA=class extends nt(ae){constructor(e){super(e),this.isAggregate=!1,this.layer=null,this.origin=null,this.sourceLayer=null,this._version=0,Object.defineProperty(this,"uid",{value:Gc(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&Uit(re.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(e){const i=this._get("aggregateGeometries");JSON.stringify(i)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const i=this._get("attributes");i!==e&&(this._set("attributes",e),this._notifyLayer("attributes",i,e))}set geometry(e){const i=this._get("geometry");i!==e&&(this._set("geometry",e),e?.type!=="mesh"&&this._notifyLayer("geometry",i,e))}set popupTemplate(e){const i=this._get("popupTemplate");i!==e&&(this._set("popupTemplate",e),this._notifyLayer("popupTemplate",i,e))}set symbol(e){const i=this._get("symbol");i!==e&&(this._set("symbol",e),this._notifyLayer("symbol",i,e))}get version(){return this._version}set visible(e){const i=this._get("visible");i!==e&&(this._set("visible",e),this._notifyLayer("visible",i,e))}cloneShallow(){return new _re({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const i=Nmt(this.origin);if(i)return i.popupTemplate??(e?i.defaultPopupTemplate:null)??null;const r=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const s of[r,this.sourceLayer,this.layer])if(s&&typeof s=="object"){if("popupTemplate"in s&&s.popupTemplate)return s.popupTemplate;if(e&&"defaultPopupTemplate"in s&&s.defaultPopupTemplate!=null)return s.defaultPopupTemplate}return null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,i){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=i,this._notifyLayer("attributes",r,i,e)}else this.attributes={[e]:i}}getObjectId(){const e=l1e(this.origin);if(e)return c1e(this,e);const i=this.sourceLayer??this.layer;return i?c1e(this,i):null}getGlobalId(){const e=l1e(this.origin);if(e?.globalIdField)return this.getAttribute(e.globalIdField);const i=this.sourceLayer??this.layer;return i&&"globalIdField"in i&&i.globalIdField?this.getAttribute(i.globalIdField):null}toJSON(){return{aggregateGeometries:kgt(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:$5(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(e={}){const{geometry:i}=this;if(i?.type==="mesh"){const r={origin:i.origin,transform:i.transform};this._notifyLayer("origin-transform",r,r,e.action)}}_notifyLayer(e,i,r,s){if(this._version++,!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:i,newValue:r};e==="origin-transform"&&(n.action=s),e==="attributes"&&(n.attributeName=s),this.layer.graphicChanged(n)}_watchMeshGeometryChanges(){this.addHandles([vs(()=>this.geometry?.type==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0,({localMatrix:e,origin:i})=>{this._lastMeshTransform.localMatrix===e&&this._lastMeshTransform.origin===i||(this._lastMeshTransform.localMatrix=e,this._lastMeshTransform.origin=i,this.notifyMeshTransformChanged())}),vs(()=>this.geometry?.type==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0,()=>{const e=this.geometry;e?.type==="mesh"&&e.vertexSpace.origin?(this._lastMeshTransform.localMatrix=e.transform?.localMatrix,this._lastMeshTransform.origin=e.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(e,i)=>e===i,sync:!0})])}},_re=AA,AA);c([p({value:null,json:{read:Dgt}})],ms.prototype,"aggregateGeometries",null),c([p({value:null})],ms.prototype,"attributes",null),c([p({value:null,types:gP,json:{read:wp}})],ms.prototype,"geometry",null),c([p({type:Boolean})],ms.prototype,"isAggregate",void 0),c([p({clonable:!1})],ms.prototype,"layer",void 0),c([p({clonable:"reference"})],ms.prototype,"origin",void 0),c([p({type:wP,value:null})],ms.prototype,"popupTemplate",null),c([p({clonable:"reference"})],ms.prototype,"sourceLayer",void 0),c([p({value:null,types:Vh})],ms.prototype,"symbol",null),c([p({clonable:!1,json:{read:!1,write:!1}})],ms.prototype,"_version",void 0),c([p({type:Boolean,value:!0})],ms.prototype,"visible",null),ms=_re=c([R("esri.Graphic")],ms);let FS=class extends y4{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};c([Pce({Type:ms,ensureType:en(ms)})],FS.prototype,"itemType",void 0),FS=c([R("esri.support.GraphicsCollection")],FS);let tv=class extends be{constructor(e){super(e),this.view=null,this.baseLayerViews=new ke,this.groundLayerViews=new ke,this.referenceLayerViews=new ke,this._loadingHandle=X(()=>this.view?.map?.basemap,i=>{i&&i.load().catch(()=>{})},Yt)}destroy(){this._set("view",null),this._loadingHandle=Xi(this._loadingHandle),this.baseLayerViews.destroyAll(),this.groundLayerViews.destroyAll(),this.referenceLayerViews.destroyAll()}get suspended(){return this.view?.suspended??!0}get updating(){return this.view?.suspended?!1:!!this.view?.map?.basemap?.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.groundLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};c([p({constructOnly:!0})],tv.prototype,"view",void 0),c([p({readOnly:!0})],tv.prototype,"baseLayerViews",void 0),c([p({readOnly:!0})],tv.prototype,"groundLayerViews",void 0),c([p({readOnly:!0})],tv.prototype,"referenceLayerViews",void 0),c([p({readOnly:!0})],tv.prototype,"suspended",null),c([p({type:Boolean,readOnly:!0})],tv.prototype,"updating",null),tv=c([R("esri.views.BasemapView")],tv);const Lgt=tv;let vh=class extends be{constructor(e){super(e),this.factor=1.5,this.offset=ia(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};c([p({type:Number})],vh.prototype,"factor",void 0),c([p({nonNullable:!0})],vh.prototype,"offset",void 0),c([p()],vh.prototype,"position",void 0),c([p({type:Number,range:{min:0}})],vh.prototype,"size",void 0),c([p()],vh.prototype,"maskUrl",void 0),c([p()],vh.prototype,"maskEnabled",void 0),c([p()],vh.prototype,"overlayUrl",void 0),c([p()],vh.prototype,"overlayEnabled",void 0),c([p({readOnly:!0})],vh.prototype,"version",null),c([p({type:Boolean})],vh.prototype,"visible",void 0),vh=c([R("esri.views.Magnifier")],vh);const WLe=vh;let QE=class{constructor(e){this._observable=new d$,this._map=new Map(e)}get size(){return Mt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return Mt(this._observable),this._map.entries()}forEach(e,i){Mt(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return Mt(this._observable),this._map.get(e)}has(e){return Mt(this._observable),this._map.has(e)}keys(){return Mt(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return Mt(this._observable),this._map.values()}[Symbol.iterator](){return Mt(this._observable),this._map[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var bre;let lS=bre=class extends ae{constructor(t){super(t),this.name=null,this.code=null}clone(){return new bre({name:this.name,code:this.code})}};c([p({type:String,json:{write:{isRequired:!0}}})],lS.prototype,"name",void 0),c([p({type:[String,Number],json:{write:{isRequired:!0}}})],lS.prototype,"code",void 0),lS=bre=c([R("esri.layers.support.CodedValue")],lS);const Fgt=new ii({inherited:"inherited",codedValue:"coded-value",range:"range"});let fw=class extends ae{constructor(e){super(e),this.name=null,this.type=null}};c([p({type:String,json:{write:!0}})],fw.prototype,"name",void 0),c([st(Fgt),p({json:{write:{isRequired:!0}}})],fw.prototype,"type",void 0),fw=c([R("esri.layers.support.Domain")],fw);var wre,OA;let mw=(OA=class extends fw{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let i=null;if(this.codedValues){const r=String(e);this.codedValues.some(s=>(String(s.code)===r&&(i=s.name),!!i))}return i}clone(){return new wre({codedValues:se(this.codedValues),name:this.name})}},wre=OA,OA);c([p({type:[lS],json:{write:{isRequired:!0}}})],mw.prototype,"codedValues",void 0),c([st({codedValue:"coded-value"})],mw.prototype,"type",void 0),mw=wre=c([R("esri.layers.support.CodedValueDomain")],mw);var xre,PA;let I4=(PA=class extends fw{constructor(e){super(e),this.type="inherited"}clone(){return new xre}},xre=PA,PA);c([st({inherited:"inherited"})],I4.prototype,"type",void 0),I4=xre=c([R("esri.layers.support.InheritedDomain")],I4);var Sre,RA;let V2=(RA=class extends fw{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new Sre({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}},Sre=RA,RA);c([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]},isRequired:!0}}})],V2.prototype,"maxValue",void 0),c([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]},isRequired:!0}}})],V2.prototype,"minValue",void 0),c([st({range:"range"})],V2.prototype,"type",void 0),V2=Sre=c([R("esri.layers.support.RangeDomain")],V2);const ZLe={key:"type",base:fw,typeMap:{range:V2,"coded-value":mw,inherited:I4}};function z7(t){if(!t?.type)return null;switch(t.type){case"range":return V2.fromJSON(t);case"codedValue":return mw.fromJSON(t);case"inherited":return I4.fromJSON(t)}return null}const kue=new ii({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var Tre;const zgt=new ii({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",currency:"currency",dateAndTime:"date-and-time",description:"description",emailAddress:"email-address",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",phoneNumber:"phone-number",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});var IA;let vo=(IA=class extends ae{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:i}){let r=null;try{r=i?JSON.parse(i):null}catch{}return r?.value??null}readValueType(e,{description:i}){let r=null;try{r=i?JSON.parse(i):null}catch{}return r?zgt.fromJSON(r.fieldValueType):null}clone(){return new Tre({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}},Tre=IA,IA);c([p({type:String,json:{write:!0}})],vo.prototype,"alias",void 0),c([p({type:[String,Number],json:{write:{allowNull:!0}}})],vo.prototype,"defaultValue",void 0),c([p()],vo.prototype,"description",void 0),c([Oe("description")],vo.prototype,"readDescription",null),c([p({types:ZLe,json:{read:{reader:z7},write:!0}})],vo.prototype,"domain",void 0),c([p({type:Boolean,json:{write:!0}})],vo.prototype,"editable",void 0),c([p({type:vi,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],vo.prototype,"length",void 0),c([p({type:String,json:{write:!0}})],vo.prototype,"name",void 0),c([p({type:Boolean,json:{write:!0}})],vo.prototype,"nullable",void 0),c([st(kue)],vo.prototype,"type",void 0),c([p()],vo.prototype,"valueType",void 0),c([Oe("valueType",["description"])],vo.prototype,"readValueType",null),c([p({type:Boolean,json:{read:!1}})],vo.prototype,"visible",void 0),vo=Tre=c([R("esri.layers.support.Field")],vo);var $re;let FM=$re=class extends ae{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new $re({mapLayerId:t,gdbVersion:e})}};c([st({mapLayer:"map-layer"}),p({json:{write:{isRequired:!0}}})],FM.prototype,"type",void 0),c([p({type:vi,json:{write:{isRequired:!0}}})],FM.prototype,"mapLayerId",void 0),c([p({type:String,json:{write:!0}})],FM.prototype,"gdbVersion",void 0),FM=$re=c([R("esri.layers.support.source.MapLayerSource")],FM);var Cre;let iv=Cre=class extends ae{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:r?.clone()??void 0,geometryType:s};return new Cre(n)}};c([st({queryTable:"query-table"}),p({json:{write:{isRequired:!0}}})],iv.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],iv.prototype,"workspaceId",void 0),c([p({type:String,json:{write:!0}})],iv.prototype,"query",void 0),c([p({type:String,json:{write:!0}})],iv.prototype,"oidFields",void 0),c([p({type:Me,json:{write:!0}})],iv.prototype,"spatialReference",void 0),c([st(cDe)],iv.prototype,"geometryType",void 0),iv=Cre=c([R("esri.layers.support.source.QueryTableDataSource")],iv);var Mre;let zM=Mre=class extends ae{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new Mre({workspaceId:t,dataSourceName:e})}};c([st({raster:"raster"}),p({json:{write:{isRequired:!0}}})],zM.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],zM.prototype,"dataSourceName",void 0),c([p({type:String,json:{write:!0}})],zM.prototype,"workspaceId",void 0),zM=Mre=c([R("esri.layers.support.source.RasterDataSource")],zM);var Ere;let s2=Ere=class extends ae{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new Ere({workspaceId:t,gdbVersion:e,dataSourceName:i})}};c([st({table:"table"}),p({json:{write:{isRequired:!0}}})],s2.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],s2.prototype,"workspaceId",void 0),c([p({type:String,json:{write:!0}})],s2.prototype,"gdbVersion",void 0),c([p({type:String,json:{write:!0}})],s2.prototype,"dataSourceName",void 0),s2=Ere=c([R("esri.layers.support.source.TableDataSource")],s2);var Are,Ore;const Ngt=so()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let _h=Are=class extends ae{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return f1e()(t,e,i)}castLeftTableSource(t){return sm(Pre(),t)}readRightTableSource(t,e,i){return f1e()(t,e,i)}castRightTableSource(t){return sm(Pre(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:s};return new Are(n)}};c([st({joinTable:"join-table"}),p({json:{write:{isRequired:!0}}})],_h.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],_h.prototype,"leftTableKey",void 0),c([p({type:String,json:{write:!0}})],_h.prototype,"rightTableKey",void 0),c([p({json:{write:!0}})],_h.prototype,"leftTableSource",void 0),c([Oe("leftTableSource")],_h.prototype,"readLeftTableSource",null),c([wi("leftTableSource")],_h.prototype,"castLeftTableSource",null),c([p({json:{write:!0}})],_h.prototype,"rightTableSource",void 0),c([Oe("rightTableSource")],_h.prototype,"readRightTableSource",null),c([wi("rightTableSource")],_h.prototype,"castRightTableSource",null),c([st(Ngt)],_h.prototype,"joinType",void 0),_h=Are=c([R("esri.layers.support.source.JoinTableDataSource")],_h);let RJ=null;function f1e(){return RJ||(RJ=pP({types:Pre()})),RJ}let IJ=null;function Pre(){return IJ||(IJ={key:"type",base:null,typeMap:{"data-layer":Cf,"map-layer":FM}}),IJ}const Vgt={key:"type",base:null,typeMap:{"join-table":_h,"query-table":iv,raster:zM,table:s2}};var DA;let Cf=(DA=class extends ae{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:i}=this;return new Ore({fields:e,dataSource:i})}},Ore=DA,DA);c([st({dataLayer:"data-layer"}),p({json:{write:{isRequired:!0}}})],Cf.prototype,"type",void 0),c([p({type:[vo],json:{write:!0}})],Cf.prototype,"fields",void 0),c([p({types:Vgt,json:{write:!0}})],Cf.prototype,"dataSource",void 0),Cf=Ore=c([R("esri.layers.support.source.DataLayerSource")],Cf),Cf.from=en(Cf);let n2=class extends nt(ae){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};c([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],n2.prototype,"onFields",void 0),c([p({type:String,json:{write:!0}})],n2.prototype,"operator",void 0),c([p({type:String,json:{write:!0}})],n2.prototype,"searchTerm",void 0),c([p({type:String,json:{write:!0}})],n2.prototype,"searchType",void 0),n2=c([R("esri.rest.support.FullTextSearch")],n2);const jgt=n2;var Rre;const m1e=new ii({upperLeft:"upper-left",lowerLeft:"lower-left"});let Hb=Rre=class extends ae{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new Rre(se({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};c([p({type:It,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Hb.prototype,"extent",void 0),c([p({type:["view","edit"],json:{write:!0}})],Hb.prototype,"mode",void 0),c([p({type:String,json:{read:m1e.read,write:m1e.write}})],Hb.prototype,"originPosition",void 0),c([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Hb.prototype,"tolerance",void 0),Hb=Rre=c([R("esri.rest.support.QuantizationParameters")],Hb);const Ugt=t=>{const e=t;let i=class extends e{};return i=c([R("esri.rest.support.QueryMixin")],i),i},Bgt=new ii({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var Ire;const g1e=new ii({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let lf=Ire=class extends ae{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=se(t))}clone(){return new Ire({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:se(this.statisticParameters)})}};c([p({type:Number,json:{write:!0}})],lf.prototype,"maxPointCount",void 0),c([p({type:Number,json:{write:!0}})],lf.prototype,"maxRecordCount",void 0),c([p({type:Number,json:{write:!0}})],lf.prototype,"maxVertexCount",void 0),c([p({type:String,json:{write:!0}})],lf.prototype,"onStatisticField",void 0),c([p({type:String,json:{write:!0}})],lf.prototype,"outStatisticFieldName",void 0),c([p({type:String,json:{read:{source:"statisticType",reader:g1e.read},write:{target:"statisticType",writer:g1e.write}}})],lf.prototype,"statisticType",void 0),c([p({type:Object})],lf.prototype,"statisticParameters",void 0),c([Ie("statisticParameters")],lf.prototype,"writeStatisticParameters",null),lf=Ire=c([R("esri.rest.support.StatisticDefinition")],lf);var OU;const qgt=new ii({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});var YS;let Ct=(YS=class extends Ugt(ae){static from(e){return g$(OU,e)}constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.returnTrueCurves=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,i){i.historicMoment=e&&e.getTime()}writeParameterValues(e,i){if(e){const r={};for(const s in e){const n=e[s];Array.isArray(n)?r[s]=n.map(a=>a instanceof Date?a.getTime():a):n instanceof Date?r[s]=n.getTime():r[s]=n}i.parameterValues=r}}writeStart(e,i){i.resultOffset=this.start,i.resultRecordCount=this.num||10,i.where="1=1"}writeWhere(e,i){i.where=e||"1=1"}clone(){return new OU(se({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,returnTrueCurves:this.returnTrueCurves,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}},OU=YS,YS.MAX_MAX_RECORD_COUNT_FACTOR=5,YS);c([p({json:{write:!0}})],Ct.prototype,"aggregateIds",void 0),c([p({type:Boolean,json:{write:!0}})],Ct.prototype,"cacheHint",void 0),c([p({type:Boolean,json:{default:!1,write:!0}})],Ct.prototype,"compactGeometryEnabled",void 0),c([p({json:{write:!0}})],Ct.prototype,"datumTransformation",void 0),c([wi("datumTransformation")],Ct.prototype,"castDatumTransformation",null),c([p({type:Boolean,json:{default:!1,write:!0}})],Ct.prototype,"defaultSpatialReferenceEnabled",void 0),c([p({type:Number,json:{write:!0}})],Ct.prototype,"distance",void 0),c([p({type:Cf,json:{write:!0}})],Ct.prototype,"dynamicDataSource",void 0),c([p({type:String,json:{write:!0}})],Ct.prototype,"formatOf3DObjects",void 0),c([p({type:[jgt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Ct.prototype,"fullText",void 0),c([p({type:String,json:{write:!0}})],Ct.prototype,"gdbVersion",void 0),c([p({types:gP,json:{read:wp,write:!0}})],Ct.prototype,"geometry",void 0),c([p({type:Number,json:{write:!0}})],Ct.prototype,"geometryPrecision",void 0),c([p({type:[String],json:{write:!0}})],Ct.prototype,"groupByFieldsForStatistics",void 0),c([p({type:String,json:{write:!0}})],Ct.prototype,"having",void 0),c([p({type:Date})],Ct.prototype,"historicMoment",void 0),c([Ie("historicMoment")],Ct.prototype,"writeHistoricMoment",null),c([p({type:Number,json:{write:!0}})],Ct.prototype,"maxAllowableOffset",void 0),c([p({type:Number,cast:t=>t<1?1:t>Ct.MAX_MAX_RECORD_COUNT_FACTOR?Ct.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Ct.prototype,"maxRecordCountFactor",void 0),c([p({type:["xyFootprint"],json:{write:!0}})],Ct.prototype,"multipatchOption",void 0),c([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ct.prototype,"num",void 0),c([p({json:{write:!0}})],Ct.prototype,"objectIds",void 0),c([p({type:[String],json:{write:!0}})],Ct.prototype,"orderByFields",void 0),c([p({type:[String],json:{write:!0}})],Ct.prototype,"outFields",void 0),c([p({type:Me,json:{name:"outSR",write:!0}})],Ct.prototype,"outSpatialReference",void 0),c([p({type:[lf],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Ct.prototype,"outStatistics",void 0),c([p({json:{write:!0}})],Ct.prototype,"parameterValues",void 0),c([Ie("parameterValues")],Ct.prototype,"writeParameterValues",null),c([p({type:Ue,json:{write:!0}})],Ct.prototype,"pixelSize",void 0),c([p({type:Hb,json:{write:!0}})],Ct.prototype,"quantizationParameters",void 0),c([p({type:[Object],json:{write:!0}})],Ct.prototype,"rangeValues",void 0),c([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Ct.prototype,"relationParameter",void 0),c([p({type:String,json:{write:!0}})],Ct.prototype,"resultType",void 0),c([p({type:Boolean,json:{default:!1,write:!0}})],Ct.prototype,"returnCentroid",void 0),c([p({type:Boolean,json:{default:!1,write:!0}})],Ct.prototype,"returnDistinctValues",void 0),c([p({type:Boolean,json:{default:!0,write:!0}})],Ct.prototype,"returnExceededLimitFeatures",void 0),c([p({type:Boolean,json:{write:!0}})],Ct.prototype,"returnGeometry",void 0),c([p({type:Boolean,json:{default:!1,write:!0}})],Ct.prototype,"returnQueryGeometry",void 0),c([p({type:Boolean,json:{default:!1,write:!0}})],Ct.prototype,"returnM",void 0),c([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ct.prototype,"returnZ",void 0),c([p({type:Boolean,json:{write:!0}})],Ct.prototype,"returnTrueCurves",void 0),c([p({type:Me,json:{write:!0}})],Ct.prototype,"sourceSpatialReference",void 0),c([st(Bgt,{ignoreUnknown:!1,name:"spatialRel"})],Ct.prototype,"spatialRelationship",void 0),c([p({type:Number,json:{read:{source:"resultOffset"}}})],Ct.prototype,"start",void 0),c([Ie("start"),Ie("num")],Ct.prototype,"writeStart",null),c([p({type:String,json:{write:!0}})],Ct.prototype,"sqlFormat",void 0),c([p({type:String,json:{write:!0}})],Ct.prototype,"text",void 0),c([p({type:ts,json:{write:!0}})],Ct.prototype,"timeExtent",void 0),c([p({type:Boolean,json:{default:!1,write:!0}})],Ct.prototype,"timeReferenceUnknownClient",void 0),c([st(qgt,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null}}}}})],Ct.prototype,"units",void 0),c([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Ct.prototype,"where",void 0),c([Ie("where")],Ct.prototype,"writeWhere",null),Ct=OU=c([R("esri.rest.support.Query")],Ct);function H_(t){return!(t==null||typeof t!="object"||!("createQuery"in t)||!t.createQuery)}let Ad=class extends Ju{constructor(e){super(e),this._selectionMap=new QE,this._sources=new ke,this._trashCan=[],this._layerEditHandles=new ke,this._vizTaskId=0,this.view=null,this.showHighlight=!0,this.highlightName="default"}initialize(){this.addHandles([X(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),X(()=>this.view,e=>{e?.when().then(()=>this.syncSources())},Yt),tn(()=>this.sources,"change",e=>{const i=this._selectionMap,r=[];for(const s of e.removed){const n=i.get(s);n&&(i.delete(s),n.highlightHandle?.remove(),r.push({layer:s,selection:[],added:[],removed:[...n.selection]}))}this._refreshListeners(),r.length&&this._onSelectionChange(r)},{onListenerAdd:()=>this._refreshListeners()})])}destroy(){this.clear(),this._layerEditHandles.drain(Xi)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){ju(e,this._sources)}syncSources(){const e=new Set,i=this.view?.map;if(!i)return;const r=s=>{Pdt(s)?(s.layers?.forEach(r),s.tables?.forEach(r)):Odt(s)?(s.sublayers?.forEach(r),s.subtables?.forEach(r)):kwe(s)?s.sublayers?.forEach(r):H_(s)&&e.add(s)};i.allLayers.forEach(r),i.allTables.forEach(r),this.sources=[...e]}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this;if(!s&&r==="layerView")return re.getLogger(this).warn("Cannot query layer views without a view."),[];const a=(e?.length?n.filter(o=>e.includes(o.layer)):n).map(async o=>{const{layer:l,selection:u}=o;if(!u.length)return;const d=r0(l)?l.parent:l;if(d!=null){if(s&&r==="layerView"&&!y1e(d)&&v1e(d)){const f=await s.whenLayerView(d).catch(()=>null);if(f)return _1e(f,u,i)}return _1e(d,u,i)}}).filter(wl);return(await Promise.all(a)).filter(wl)}updateSelection(e){const i=new Map;for(const[n,a]of this._selectionMap)i.set(n,[...a.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const a=n.sourceLayer,o=n.getObjectId();if(this.sources.includes(a)&&(H_(a)||r0(a))&&o!==null){const l=Fu(i,a,()=>[]);l.includes(o)||(l.push(o),r=!0)}}for(const n of e.removed){const a=n.sourceLayer,o=n.getObjectId();if(this.sources.includes(a)&&(H_(a)||r0(a))&&o!==null){const l=i.get(a),u=l?.indexOf(o);u!==void 0&&u>=0&&(l?.splice(u,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:a}=this,o=[];for(const[l,u]of i){const d=n.get(l);d!==void 0&&a.push(d),n.set(l,{selection:u}),o.push({layer:l,selection:u,...W8(d!==void 0?d.selection:[],u)})}this._onSelectionChange(o)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),a=Ntt(s,n);this._setSelection(e,Array.from(a))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();if(this.view==null)return;const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const a of e){const o=r.get(a),l=r0(a)?a.parent:a;if(l!=null&&v1e(l)){if(y1e(l))continue;i.whenLayerView(l).then(u=>{o?.highlightHandle?.remove(),o!=null&&s&&n===this._vizTaskId&&"highlight"in u&&typeof u.highlight=="function"&&o.selection.length>0&&(o.highlightHandle=u.highlight(o.selection,this.highlightName))}).catch(()=>{o?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Xi);const e=new Set(this.sources.map(i=>r0(i)?i.parent:i));for(const i of e)H_(i)&&"on"in i&&i.on&&this._layerEditHandles.push(i.on("edits",r=>this._onLayerEdit(r,i)))}_onLayerEdit(e,i){if(kwe(i))this._onParentLayerEdit(e,i);else if(e.deletedFeatures.length&&this._selectionMap.has(i)){const r=[];e.deletedFeatures.forEach(({error:s,objectId:n})=>{n!=null&&s==null&&r.push(n)}),this.removeFromSelection(i,r)}}_onParentLayerEdit(e,i){const{deletedFeatures:r,edits:s,updatedFeatures:n}=e;if(s?.updateFeatures?.forEach(a=>{const o=a.getObjectId()??a.attributes[i.objectIdField];if(o==null||n.find(d=>d.objectId===o)?.error)return;const l=i.findSublayerForFeature(a);if(!H_(l))return;const u=i.sublayers.find(d=>!(!H_(d)||!this.getSelection(d)?.includes(o)));H_(u)&&u!==l&&(this.removeFromSelection(u,[o]),this.appendToSelection(l,[o]))}),r.length){const a=[];r.forEach(({error:o,objectId:l})=>{l!=null&&o==null&&a.push(l)}),i.sublayers.forEach(o=>{H_(o)&&this._selectionMap.has(o)&&this.removeFromSelection(o,a)})}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!Hgt(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...W8(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};c([p()],Ad.prototype,"_selectionMap",void 0),c([p()],Ad.prototype,"_sources",void 0),c([p({readOnly:!0,nonNullable:!0})],Ad.prototype,"selections",null),c([p({readOnly:!0,nonNullable:!0})],Ad.prototype,"count",null),c([p()],Ad.prototype,"view",void 0),c([p({readOnly:!0,nonNullable:!0})],Ad.prototype,"hasSelection",null),c([p()],Ad.prototype,"showHighlight",void 0),c([p()],Ad.prototype,"sources",null),c([p()],Ad.prototype,"highlightName",void 0),Ad=c([R("esri.views.SelectionManager")],Ad);const y1e=t=>r0(t)?t.parent?.isTable===!0:t.isTable,Ggt=t=>t.layer!==void 0,v1e=t=>t?.when!==void 0,Hgt=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},_1e=async(t,e,i={})=>{let r;if(Ggt(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new Ct({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new Ct({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},Wgt=Ad;let DD=class extends nt(be){constructor(e){super(e),this.accentColor=new Je([255,127,0]),this.textColor=new Je([255,255,255])}};c([p({type:Je,nonNullable:!0})],DD.prototype,"accentColor",void 0),c([p({type:Je,nonNullable:!0})],DD.prototype,"textColor",void 0),DD=c([R("esri.views.Theme")],DD);const Dre=DD,YLe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],JLe={};function QLe(t){return!!JLe[t]}function Zgt(t){for(const e of t)if(!QLe(e))return!1;return!0}YLe.forEach(t=>{JLe[t]=!0});let XLe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>this.inputManager?.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!Zgt(n))return n.some(QLe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,o;Array.isArray(i)?o=i:(a=i,o=[]),typeof r=="function"?a=r:s=r,s=s??Br.DEFAULT;const l=this._createUniqueGroupName(),u=new Ygt(this.view,n,o,a);this._handlers.set(l,{handler:u,priority:s});for(const d of n){const f=this._handlerCounts.get(d)||0;this._handlerCounts.set(d,f+1)}return this.inputManager&&this.inputManager.installHandlers(l,[u],s),bi(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},Ygt=class extends _s{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,a=>s(Xgt(e,a)));break;case"double-click":this.registerIncoming("double-click",r,a=>s(Kgt(e,a)));break;case"immediate-click":this.registerIncoming("immediate-click",r,a=>s(eyt(e,a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,a=>s(tyt(e,a)));break;case"hold":this.registerIncoming("hold",r,a=>s(iyt(e,a)));break;case"drag":this.registerIncoming("drag",r,a=>{const o=this._wrapDrag(a);o&&s(o)});break;case"key-down":this.registerIncoming("key-down",r,a=>s(ryt(a)));break;case"key-up":this.registerIncoming("key-up",r,a=>s(syt(a)));break;case"pointer-down":this.registerIncoming("pointer-down",r,a=>s(eI(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,a=>s(eI(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,a=>s(eI(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,a=>s(nyt(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,a=>s(ayt(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,a=>s(eI(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,a=>s(eI(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,a=>{s(oyt(a))});break;case"focus":this.registerIncoming("focus",r,a=>{s(Jgt(a))});break;case"blur":this.registerIncoming("blur",r,a=>{s(Qgt(a))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:a,button:o}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,u=i.buttons,{cancelable:d,timestamp:f}=e,g={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:g,pointerType:a,button:o,buttons:u,radius:i.radius,angle:to(i.angle),native:l,timestamp:f,cancelable:d,stopPropagation:()=>e.stopPropagation(),defer:v=>e.defer(v),preventDefault:()=>e.preventDefault()}}};function Jgt(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),defer:e=>t.defer(e),preventDefault:()=>t.preventDefault()}}function Qgt(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),defer:e=>t.defer(e),preventDefault:()=>t.preventDefault()}}function Xgt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,{cancelable:u,timestamp:d}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:d,screenPoint:ia(n,a),mapPoint:xF(t,n,a),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),defer:f=>e.defer(f),preventDefault:()=>e.preventDefault()}}function Kgt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,{cancelable:u,timestamp:d}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:d,mapPoint:xF(t,n,a),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),defer:f=>e.defer(f),preventDefault:()=>e.preventDefault()}}function eyt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,u=o.pointerId,{cancelable:d,timestamp:f}=e;return{type:"immediate-click",pointerId:u,pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:f,mapPoint:xF(t,n,a),eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),defer:g=>e.defer(g),preventDefault:()=>e.preventDefault()}}function tyt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,u=o.pointerId,{cancelable:d,timestamp:f}=e;return{type:"immediate-double-click",pointerId:u,pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:f,mapPoint:xF(t,n,a),eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),defer:g=>e.defer(g),preventDefault:()=>e.preventDefault()}}function iyt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:a,native:o}=e.data,{cancelable:l,timestamp:u}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:a,native:o,timestamp:u,mapPoint:xF(t,n,a),cancelable:l,stopPropagation:()=>e.stopPropagation(),defer:d=>e.defer(d),preventDefault:()=>e.preventDefault()}}function xF(t,e,i){return t.toMap(ia(e,i),{exclude:[]})}function ryt(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),defer:a=>t.defer(a),preventDefault:()=>t.preventDefault()}}function syt(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),defer:n=>t.defer(n),preventDefault:()=>t.preventDefault()}}function eI(t,e){const{x:i,y:r,button:s,buttons:n,native:a,eventId:o}=t.data,l=a.pointerId,u=a.pointerType,{cancelable:d,timestamp:f}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:u,button:s,buttons:n,native:a,timestamp:f,eventId:o,cancelable:d,stopPropagation:()=>t.stopPropagation(),defer:g=>t.defer(g),preventDefault:()=>t.preventDefault()}}function nyt(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:a}=t.data.startEvent,o=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,u=t.data.action,d={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:g}=t;return{type:"pointer-drag",x:e,y:i,pointerId:o,pointerType:l,button:a,buttons:r,action:u,origin:d,native:s,timestamp:g,eventId:n,cancelable:f,stopPropagation:()=>t.stopPropagation(),defer:v=>t.defer(v),preventDefault:()=>t.preventDefault()}}function ayt(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:a,native:o}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:a,native:o,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),defer:l=>t.defer(l),preventDefault:()=>t.preventDefault()}}function oyt(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:a,axes:o}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:a,axes:o,cancelable:s,stopPropagation:()=>t.stopPropagation(),defer:l=>t.defer(l),preventDefault:()=>t.preventDefault()}}const KLe="z",eFe="r",tFe={cancel:"Escape",complete:"Enter"},Vn={...tFe,redo:eFe,undo:KLe,center:"Alt",constraint:"Shift",delete:["Backspace","Delete"],vertexAdd:"f",pan:" "},b1e={toggle:"Control"},Lci={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},Fci={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:O4e,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},editSourcePoints:{key:"Alt",continuePropagation:!0},undo:KLe,redo:eFe};let zci=class{constructor(){this._bindings=new Map}add(e,i){return this.addToggle(e,r=>{r.type==="key-down"&&i(r)})}addToggle(e,i){const r=lyt.fromDefinition(e,i),s=Fu(this._bindings,r.key,()=>[]);return s.push(r),bi(()=>oP(s,r))}register(e,i=Br.WIDGET){return Yu([e.on("key-down",r=>this.dispatch(e.inputManager,r),i),e.on("key-up",r=>this.dispatch(e.inputManager,r),i)])}dispatch(e,i){const r=i.key,s=this._bindings.get(r);if(s)for(const n of s)n.process(e,i)}},lyt=class kre{constructor(e,i,r,s,n){this.key=e,this.modifiers=i,this.repeats=r,this.continuePropagation=s,this.callback=n}process(e,i){if(!(i.key!==this.key||"repeat"in i&&i.repeat&&!this.repeats)){for(const r of this.modifiers)if(!e.isModifierKeyDown(r))return;this.continuePropagation||i.stopPropagation(),this.callback(i)}}static fromDefinition(e,i){if(typeof e=="string")return new kre(e,[],!1,!1,i);const{key:r,modifier:s,repeats:n,continuePropagation:a}=e;return new kre(r,s?Array.isArray(s)?s:[s]:[],!!n,!!a,i)}};function cyt(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return re.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function Lre(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(0)&&t.getEditableFlag(1)}function uyt(t){return t.type==="key-down"&&t.key===tFe.cancel}function jd(t){return ia(t.x,t.y)}function Vci(t){return yn(t.x,t.y)}function iFe(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?ia(e.clientX-i.left,e.clientY-i.top):ia(0,0)}function Dq(t,e){return e instanceof Event?iFe(t,e):jd(e)}function kq(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let PU=class extends be{constructor(){super(...arguments),this._pointerLocations=new Map,this._hoveredManipulators=new QE,this._grabbedManipulators=new QE,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1}get cursor(){return this._cursorFromMap(this._grabbedManipulators,"grabbing")??this._cursorFromMap(this._hoveredManipulators,"pointer")}get hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":w1e(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:e.action==="start"?this._externallyDragging=!0:e.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!x1e(e))break;const s=jd(e),n=MC(s,e.pointerType,i.tools);if(n==null)break;const a=n.manipulator,o=n.tool;a==null||o==null||!a.interactive||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._releaseManipulatorBeforeDragging(a,e,i),a!=null&&o!=null&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:a,tool:o,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!x1e(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s?.manipulator,a=s?.tool;if(n==null||a==null)break;const o=jd(e);o.x=Ce(o.x,0,i.view.width),o.y=Ce(o.y,0,i.view.height);const l=s.start,u=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,u?n.events.emit("drag",{action:"update",start:l,screenPoint:o}):n.events.emit("drag",{action:"start",start:l,screenPoint:o,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:a,manipulator:n,start:l}));break;case"end":n.dragging=!1,u&&n.events.emit("drag",{action:"end",start:l,screenPoint:o}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=jd(e),n=MC(s,e.pointerType,i.tools);if(!hyt(e)){for(const u of i.tools)if((n==null||n.tool!==u||u.automaticManipulatorSelection)&&u.manipulators){let d=!1;u.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,d=!0)}),d&&u.onManipulatorSelectionChanged&&u.onManipulatorSelectionChanged()}}if(n==null)break;const{manipulator:a,tool:o}=n;if(!a.interactive)break;a.selectable&&o.automaticManipulatorSelection&&(a.selected=!a.selected,o.onManipulatorSelectionChanged&&o.onManipulatorSelectionChanged());const l=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),DJ(a,r);break}case"click":{const s=jd(e),n=MC(s,e.pointerType,i.tools),a=n?.manipulator;if(a==null||!a.interactive)break;const o=e.native.shiftKey;a.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o}),r();break}case"double-click":{const s=jd(e),n=MC(s,e.pointerType,i.tools),a=n!=null?n.manipulator:null;if(a==null||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:r}),DJ(a,r);break}case"immediate-double-click":{const s=jd(e),n=MC(s,e.pointerType,i.tools),a=n!=null?n.manipulator:null;if(a==null||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:r}),e.pointerType==="mouse"&&DJ(a,r);break}}this._onFocusChange(i.tools)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:jd(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:jd(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateFocusedManipulatorTools(e)}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>i.add(s)),this._hoveredManipulators.forEach(({tool:s})=>r.add(s));for(const s of e){s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),a=Bit(n,({tool:o})=>o===s);s.firstGrabbedManipulator=a!=null?a.manipulator:null}}clearPointers(e,{tools:i,setActiveTool:r},s=!0,n){const a=(o,l)=>o===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:o,manipulator:l,pointerType:u},d)=>{a(o,l)&&(this._grabbedManipulators.delete(d),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:u}))}),this._draggedManipulators.forEach(({tool:o,manipulator:l},u)=>{a(o,l)&&(this._draggedManipulators.delete(u),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:o,manipulator:l},u)=>{a(o,l)&&(this._hoveredManipulators.delete(u),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(ia(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){const r=e.type;r!=="pointer-up"&&r!=="immediate-click"&&r!=="pointer-move"||!w1e(e.pointerType)||(r!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition(jd(e),e.pointerId,e.pointerType,i))}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){let n=MC(e,r,s);const a=this._hoveredManipulators.get(i)?.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&a===n.manipulator||(a!=null&&(a.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach(({manipulator:i},r)=>{e===r&&(this._hoveredManipulators.delete(e),i.hovering=!1)})}_cursorFromMap(e,i){if(!e?.size)return null;for(const{manipulator:r}of e.values())if(r?.interactive){if(r.grabbing&&r.grabCursor)return r.grabCursor;if(r.cursor)return r.cursor}return i}};function MC(t,e,i){for(const r of i){if(r.manipulators==null||!Lre(r))continue;const s=r.manipulators.intersect(t,e);if(s!=null)return{tool:r,manipulator:s}}return null}function w1e(t){return t==="mouse"}function x1e(t){return t.pointerType!=="mouse"||t.button===0}function hyt(t){return!!t.native.shiftKey}function DJ(t,e){t?.consumesClicks&&e()}c([p()],PU.prototype,"cursor",null),PU=c([R("esri.views.interactive.ToolViewManagerManipulatorState")],PU);const S1e="attached",kJ="tools",dyt=1e3;let Ym=class extends be{constructor(e){super(e),this._updatingHandles=new tm,this._clock=m$,this._manipulatorState=new PU,this.tools=new ke,this._interacting=!1,this._interactingTimeout=dyt,this._interactingTimeoutHandle=null}initialize(){this.addHandles([this.view.on(YLe,e=>{this._handleInputEvent(e)},Br.TOOL),...cyt(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy(),this._manipulatorState.destroy()}get _manipulatorStateEventArgs(){return{tools:this.tools,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void re.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=Lre(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}}get cursor(){const e=this._manipulatorState.cursor;if(e!=null)return e;for(const i of this.tools)if(i.visible&&i.cursor!=null)return i.cursor;return null}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Xi(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([X(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider.on("elevation-change",e=>this._forEachManipulator(i=>i.onElevationChange(e)))],S1e):this.addHandles(X(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(S1e),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){for(const i of this.tools)i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};if(this.activeTool!=null)this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r);else for(const s of this.tools)!i&&s.visible&&s.handleInputEvent(r);!i&&uyt(e)&&this.activeTool&&(e.stopPropagation(),e.preventDefault(),this.activeTool.cancel(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this.tools),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(kJ);for(const e of this.tools){if(e instanceof be){const i=X(()=>[e.cursor,e.visible,e.editable],()=>{Lre(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs)});this.addHandles(i,kJ)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this.tools)})],kJ)}this._manipulatorState.updateHoveredStateFromKnownPointers(this.tools)}_updateToolEditableFlag(e){e.setEditableFlag?.(1,this.activeTool==null||e===this.activeTool)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};c([p({constructOnly:!0,nonNullable:!0})],Ym.prototype,"view",void 0),c([p({value:null})],Ym.prototype,"activeTool",null),c([p({readOnly:!0,type:ke})],Ym.prototype,"tools",void 0),c([p()],Ym.prototype,"cursor",null),c([p({readOnly:!0})],Ym.prototype,"updating",null),c([p()],Ym.prototype,"_interacting",void 0),c([p({readOnly:!0})],Ym.prototype,"interacting",null),Ym=c([R("esri.views.ToolViewManager")],Ym);const pyt=new Je("cyan"),fyt=1,myt=.25,rFe=new Je("black"),sFe=.4,nFe=.2,gyt=.25,cm="default",yyt="temporary",vyt=new Je("yellow"),_yt=8;var Fre;let bh=Fre=class extends be{constructor(t){super(t),this.name=cm,this.color=pyt.clone(),this.haloColor=null,this.haloOpacity=fyt,this.fillOpacity=myt,this.shadowColor=rFe.clone(),this.shadowOpacity=sFe,this.shadowDifference=nFe,this.haloWidth=2.1,this.haloBlur=.8/this.haloWidth}equals(t){return this.color.equals(t.color)&&(this.haloColor||this.color).equals(t.haloColor||t.color)&&this.haloOpacity===t.haloOpacity&&this.fillOpacity===t.fillOpacity&&this.haloWidth===t.haloWidth&&this.haloBlur===t.haloBlur&&this.shadowColor.equals(t.shadowColor)&&this.shadowOpacity===t.shadowOpacity&&this.shadowDifference===t.shadowDifference}clone(){return new Fre({...this,color:this.color.clone(),haloColor:this.haloColor?.clone(),shadowColor:this.shadowColor?.clone()})}assignFrom(t){this.color=t.color.clone(),this.haloColor=t.haloColor?.clone(),this.haloOpacity=t.haloOpacity,this.fillOpacity=t.fillOpacity,this.shadowColor=t.shadowColor.clone(),this.shadowDifference=t.shadowDifference,this.shadowOpacity=t.shadowOpacity,this.haloBlur=t.haloBlur,this.haloWidth=t.haloWidth}};c([p({type:String,constructOnly:!0,nonNullable:!0})],bh.prototype,"name",void 0),c([p({type:Je,nonNullable:!0})],bh.prototype,"color",void 0),c([p({type:Je})],bh.prototype,"haloColor",void 0),c([p({nonNullable:!0})],bh.prototype,"haloOpacity",void 0),c([p({nonNullable:!0})],bh.prototype,"fillOpacity",void 0),c([p({type:Je,nonNullable:!0})],bh.prototype,"shadowColor",void 0),c([p({nonNullable:!0})],bh.prototype,"shadowOpacity",void 0),c([p({nonNullable:!0})],bh.prototype,"shadowDifference",void 0),c([p({nonNullable:!0})],bh.prototype,"haloWidth",void 0),c([p({nonNullable:!0})],bh.prototype,"haloBlur",void 0),bh=Fre=c([R("esri.views.support.HighlightOptions")],bh);const jg=bh;function byt(){return new(ke.ofType(jg))([new jg({name:cm}),new jg({name:yyt,color:vyt})])}let NM=class extends be{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":wyt.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return xyt[this.deviceType]}};c([p({nonNullable:!0,readOnly:!0})],NM.prototype,"nativeIndex",void 0),c([p({type:String,readOnly:!0})],NM.prototype,"deviceType",null),c([p({type:Number,readOnly:!0})],NM.prototype,"axisThreshold",null),NM=c([R("esri.views.input.gamepad.GamepadInputDevice")],NM);const Lue=NM,wyt=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),xyt={standard:.15,spacemouse:.025,unknown:0};let kD=class extends be{constructor(e){super(e),this.devices=new ke,this.enabledFocusMode="document"}};c([p({type:ke.ofType(Lue),readOnly:!0})],kD.prototype,"devices",void 0),c([p({type:["document","view","none"]})],kD.prototype,"enabledFocusMode",void 0),kD=c([R("esri.views.input.gamepad.GamepadSettings")],kD);const Syt=kD;let RU=class extends be{constructor(){super(...arguments),this.gamepad=new Syt}};c([p({readOnly:!0})],RU.prototype,"gamepad",void 0),RU=c([R("esri.views.input.Input")],RU);const Tyt=RU,LJ=()=>p({type:["pan","rotate","zoom","none"],nonNullable:!0});let a2=class extends be{constructor(e){super(e),this.dragPrimary="pan",this.dragSecondary="rotate",this.dragTertiary="zoom",this.mouseWheel="zoom"}};c([LJ()],a2.prototype,"dragPrimary",void 0),c([LJ()],a2.prototype,"dragSecondary",void 0),c([LJ()],a2.prototype,"dragTertiary",void 0),c([p({type:["zoom","none"],nonNullable:!0})],a2.prototype,"mouseWheel",void 0),a2=c([R("esri.views.navigation.NavigationActionMap")],a2);const Fue=a2;let bb=class extends be{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};c([p({type:Boolean,nonNullable:!0})],bb.prototype,"enabled",void 0),c([p({type:Lue})],bb.prototype,"device",void 0),c([p({type:["pan","zoom"],nonNullable:!0})],bb.prototype,"mode",void 0),c([p({type:["forward-down","forward-up"],nonNullable:!0})],bb.prototype,"tiltDirection",void 0),c([p({type:Number,nonNullable:!0})],bb.prototype,"velocityFactor",void 0),bb=c([R("esri.views.navigation.gamepad.GamepadSettings")],bb);const aFe=bb;let wb=class extends be{constructor(e){super(e),this.actionMap=new Fue,this.browserTouchPanEnabled=!0,this.gamepad=new aFe,this.momentumEnabled=!0}get mouseWheelZoomEnabled(){return this.actionMap.mouseWheel==="zoom"}set mouseWheelZoomEnabled(e){Wee(re.getLogger(this),"mouseWheelZoomEnabled",{replacement:"actionMap.mouseWheel",version:"4.32",warnOnce:!0}),this.actionMap.mouseWheel=e?"zoom":"none"}};c([p({type:Fue,nonNullable:!0})],wb.prototype,"actionMap",void 0),c([p({type:Boolean})],wb.prototype,"browserTouchPanEnabled",void 0),c([p({type:aFe,nonNullable:!0})],wb.prototype,"gamepad",void 0),c([p({type:Boolean})],wb.prototype,"momentumEnabled",void 0),c([p({type:Boolean})],wb.prototype,"mouseWheelZoomEnabled",null),wb=c([R("esri.views.navigation.Navigation")],wb);const N7=wb;function $yt(t,e){if(!t)return null;if(!zre(t))return new q("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=Bo.deriveUnitFromSR(t,e).heightUnit;return i!==r?new q("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function Yci(t,e,i){const r=oFe(t),s=e,n=Cyt(r,s,i);if(r){const a=Bo.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&a!==r.heightUnit){const o=new q("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${a})`,{horizontalUnit:a});return new q("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:o})}}if(!Myt(t)||n===4)return new q("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case 1:{const a=r?.heightUnit||"unknown",o=s?.heightUnit||"unknown",l=new q("layerview:incompatible-height-unit",`The vertical units of the layer (${a}) must match the vertical units of the scene (${o})`,{layerUnit:a,sceneUnit:o});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case 2:{const a=r?.heightModel||"unknown",o=s?.heightModel||"unknown",l=new q("layerview:incompatible-height-model",`The height model of the layer (${a}) must match the height model of the scene (${o})`,{layerHeightModel:a,sceneHeightModel:o});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case 3:{const a=r?.vertCRS||"unknown",o=s?.vertCRS||"unknown",l=new q("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${a}) must match the vertical datum of the scene (${o})`,{layerDatum:a,sceneDatum:o});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function Cyt(t,e,i){if(!zre(t)||!zre(e))return 4;if(t==null||e==null)return 0;if(!i&&t.heightUnit!==e.heightUnit)return 1;if(t.heightModel!==e.heightModel)return 2;switch(t.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return t.vertCRS===e.vertCRS?0:3;default:return 4}}function zre(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function Myt(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!uFe(t)}function oFe(t){if(t.type==="integrated-mesh-3dtiles"||t.type==="gaussian-splat")return null;const e=t.url?Zg(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&lFe(t)&&t.heightModelInfo?t.heightModelInfo:uFe(t)?Bo.deriveUnitFromSR(Ayt,t.spatialReference):null}function lFe(t){return"heightModelInfo"in t}function cFe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function uFe(t){return cFe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):hFe(t)}function Eyt(t){return t.layers!=null||hFe(t)||cFe(t)||lFe(t)}function hFe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"gaussian-splat":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const Ayt=new Bo({heightModel:"gravity-related-height"});let Nre,FJ=null;async function Oyt(t){FJ||(FJ=W(()=>import("./geometryServiceUtils-CNYq6r_x.js"),[]).then(e=>Nre=e)),await FJ,ct(t)}async function dFe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return ry()||Zc(s,e)?Pa(t,e):Nre?Nre.projectGeometry(t,e,i,r):(await Promise.race([Oyt(r),F0(r)]),dFe(t,e,i,r))}async function Jci(t,e){try{return t?.spatialReference?await z0(t,e):null}catch{return null}}let Ts=class extends be{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Rs(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{parent:e?.basemap,layers:e?.basemap?.groundLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),i}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,r=>{const s=this._getSupportedSpatialReferences(r);if(s.length>0){const n=this._narrowDownSpatialReferenceCandidates(e,s);n!=null&&(e=n)}return e?.length===1})&&e?.length!==1)return{updating:!0};const i=this._pickSpatialReferenceCandidate(e);return{spatialReference:i?.spatialReference??null,viewingMode:i?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=this.map?.(),i=this.spatialReference;if(!i)return{updating:this._spatialReferenceTask.updating};let r;const s=this._collectLayers([{parent:e?.basemap,layers:e?.basemap?.baseLayers},{parent:e?.basemap,layers:e?.basemap?.groundLayers},{layers:e?.layers}],n=>!(!("tileInfo"in n)||!n.tileInfo?.spatialReference.equals(i))&&(r=n,!0),n=>"tileInfo"in n);return r?{tileInfo:r.tileInfo,updating:!1}:{updating:s}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};let e={};const i=this._collectLayers(this.mapCollections,r=>{const s=oFe(r);return!!s&&(e={heightModelInfo:s,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid},!0)},r=>Eyt(r));return{...e,updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],i=this._collectLayers(this.mapCollections,r=>{const s="fullExtents"in r&&r.fullExtents||(r.fullExtent!=null?[r.fullExtent]:[]),n=this.requiresExtentInSpatialReference?null:s[0],a=s.find(o=>o.spatialReference.equals(this.spatialReference))??n;if(a)return e.push({extent:a,layer:r}),!0;if(this._getSupportedSpatialReferences(r).length>0)for(const o of s)e.push({extent:o,layer:r});return!1});return{candidates:e,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Rs(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:sc(async n=>{try{const a=await dFe(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:a}}catch{if(sa(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const a=Ryt(s.viewingMode,n.viewingMode);if(a!==!1){r.push({spatialReference:s.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==2)&&(e=e.filter(({viewingMode:r})=>r!==2)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const a=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:o,viewingMode:l}of a)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!o.equals(this.userSpatialReference)||r.push({spatialReference:o,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e,i,r=()=>!0){switch(this._loadMaybe(this.map?.())){case"loading":return!0;case"failed":return!1}const s=new Pyt(r,i);for(const n of e)if(this._collectCollection(n,s),s.done||s.preloading===this.sourcePreloadCount)break;return s.updating}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers)if((r.type!=="graphics"||!r.internal)&&i.layerFilter(r)){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":if(i.updating||(i.done=i.pushLayer(r)),i.done||i.preloading===this.sourcePreloadCount)break;"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.done||i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{Zr(i)}),"loading"):e.loadStatus:"loaded"}};c([p()],Ts.prototype,"required",void 0),c([p({constructOnly:!0})],Ts.prototype,"map",void 0),c([p({constructOnly:!0})],Ts.prototype,"getSpatialReferenceSupport",void 0),c([p()],Ts.prototype,"defaultSpatialReference",void 0),c([p()],Ts.prototype,"userSpatialReference",void 0),c([p()],Ts.prototype,"sourcePreloadCount",void 0),c([p()],Ts.prototype,"priorityCollection",void 0),c([p()],Ts.prototype,"requiresExtentInSpatialReference",void 0),c([p()],Ts.prototype,"suspended",void 0),c([p({readOnly:!0})],Ts.prototype,"ready",null),c([p({readOnly:!0})],Ts.prototype,"heightModelInfoReady",null),c([p({readOnly:!0})],Ts.prototype,"spatialReference",null),c([p({readOnly:!0})],Ts.prototype,"extent",null),c([p({readOnly:!0})],Ts.prototype,"heightModelInfo",null),c([p({readOnly:!0})],Ts.prototype,"vcsWkid",null),c([p({readOnly:!0})],Ts.prototype,"latestVcsWkid",null),c([p({readOnly:!0})],Ts.prototype,"viewingMode",null),c([p({readOnly:!0})],Ts.prototype,"tileInfo",null),c([p({readOnly:!0})],Ts.prototype,"mapCollections",null),c([p({readOnly:!0})],Ts.prototype,"_spatialReferenceTask",null),c([p({readOnly:!0})],Ts.prototype,"_tileInfoTask",null),c([p({readOnly:!0})],Ts.prototype,"_heightModelInfoTask",null),c([p({readOnly:!0})],Ts.prototype,"_extentCandidatesTask",null),c([p()],Ts.prototype,"_extentTask",null),c([p()],Ts.prototype,"_projectExtentTask",void 0),Ts=c([R("esri.views.support.DefaultsFromMap")],Ts);let Pyt=class{constructor(e,i){this.layerFilter=e,this.pushLayer=i,this.preloading=-1,this.updating=!1,this.done=!1}};function Ryt(t,e){return t!=null?e!=null?t===e&&t:t:e}function Iyt(t){return"tryRecycleWith"in t}let Dyt=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._started=!1,this.done=!1,this._deferred=Eo(),this.promise=this._deferred.promise,Mo(this._controller.signal,()=>{this._recycleController?.abort();const s=new q("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred?.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!Iyt(this.layerView))return null;this._recycleController?.abort(),this._recycleController=new AbortController;const i=this.layer.type,r=this._recycleController.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const a=this.layerView.tryRecycleWith(n,{signal:r});if(a){e.splice(s,1),this.layer=n;const o=this.layerView,l=o.view;return this.promise=a.then(()=>(ct(r),n.emit("layerview-destroy",{view:l,layerView:o}),l.emit("layerview-destroy",{view:l,layerView:o}),n.emit("layerview-create",{view:l,layerView:o}),l.emit("layerview-create",{view:l,layerView:o}),o)),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null,this.promise=null,this._deferred=null}async start(){const{view:e}=this;if(this._started||!e.map)return;this._started=!0;const{_controller:{signal:i},layer:r}=this;this._map=e.map;try{let s,n;if(await r.load({signal:i}),r.prefetchResources&&await r.prefetchResources({signal:i}),kyt(r))s=await r.createLayerView(e,{signal:i});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new q("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(r);ct(i),s="default"in l?new l.default({layer:r,view:e}):new l({layer:r,view:e})}const a=()=>{n=Xi(n),s.destroyed||s.destroy(),this.done=!0};n=Mo(i,a),ct(i);try{await s.when()}catch(l){throw a(),l}if(!this._map?.allLayers?.includes(r))return a(),void this._deferred?.reject(new q("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=s,r.emit("layerview-create",{view:e,layerView:s}),e.emit("layerview-create",{layer:r,layerView:s}),this.done=!0,this._deferred?.resolve(s)}catch(s){r.emit("layerview-create-error",{view:e,error:s}),e.emit("layerview-create-error",{layer:r,error:s}),this.done=!0,this._deferred?.reject(new q("layerview:create-error","layerview creation failed",{layer:r,error:s}))}}};function kyt(t){return t.createLayerView!==zs.prototype.createLayerView}function Lyt(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let du=class extends be{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new tm,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const i=this.view.map?.allLayers;if(i)for(const r of i)this.layerViewFilter?.(r)!==!1&&this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Eo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(uP(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const{map:i}=this.view;if(!i)return void this.clear();if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,a=d=>{if(d!=null){for(const f of d)if(f){if(this.layerViewFilter?.(f)===!1)continue;r.add(f);const g=this._layerLayerViewInfoMap.get(f);g&&n?g.start():g||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&a(f.layers)}}};for(const d of this._rootCollectionNames)a(Vf(this,d));const o=new Array,l=d=>{const f=d.tryRecycle(s);f?(this._recyclingInfoMap.set(d.layer,d),this.notifyChange("updating"),f.then(()=>{this._recyclingInfoMap.delete(d.layer),this._layerLayerViewInfoMap.set(d.layer,d),this._reschedule(),this.notifyChange("updating")}).catch(g=>{Zr(g)||(this._recyclingInfoMap.delete(d.layer),d.destroy(),this._reschedule(),this.notifyChange("updating"))})):o.push(d)};for(const d of this._layerLayerViewInfoMap.values())r.has(d.layer)||(this._layerLayerViewInfoMap.delete(d.layer),l(d));for(const d of this._recyclingInfoMap.values())r.has(d.layer)||(this._recyclingInfoMap.delete(d.layer),l(d));for(const d of s)this._createLayerView(d);this._refreshCollections(),o.forEach(d=>d.destroy());const u=[i?.ground?.layers,i?.basemap?.baseLayers,i?.basemap?.groundLayers,i?.basemap?.referenceLayers,i?.layers].filter(d=>!!d);r.forEach(d=>"layers"in d&&u.push(d.layers)),this.addHandles(u.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null},this._layersToLayerViews=new Map(e.layerviewMapping)}initialize(){this.addHandles([tn(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),X(()=>{const e=this.view,i=e?.map;return[i?.basemap,i?.ground,i?.layers,e?.ready]},()=>this._reschedule(),bt)]),this._preloadLayerViewModules(),this._reschedule()}clearHandles(){this._watchUpdatingTracking.removeAll()}destroy(){this.clear(),ZN(this._recyclingInfoMap),ZN(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(ti()),this._workPromise=null)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Lf(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(this._clearCollections(),ZN(this._layerLayerViewInfoMap),ZN(this._recyclingInfoMap))}async whenLayerView(e){await this._reschedule();const i=this._layerLayerViewInfoMap.get(e)?.promise;if(!i){const r=this._recyclingInfoMap.get(e)?.promise;if(!r)throw new q("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return r}return i}isCreatingLayerViewsForLayer(e,i){this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!r?.done)return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&e.layers?.length)&&e.layers.some(n=>this.isCreatingLayerViewsForLayer(n,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Vf(this,e),Vf(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_clearCollections(){for(const e of this._layersToLayerViews.values())Vf(this,e)?.removeAll()}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void i?.removeAll();let s=0;for(const n of e){const a=this._layerLayerViewInfoMap.get(n);if(!a?.layerView)continue;const{layerView:o}=a;o.layer=n,o.parent=r,i.at(s)!==o&&i.splice(s,0,o),"layers"in n&&Lyt(o)&&this._populateLayerViewsOwners(n.layers,o.layerViews,o),++s}s<i.length&&i.splice(s)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new Dyt(e,this.view,this.layerViewImporter);i.promise?.then(()=>this._refreshCollections(),r=>{r&&(Zr(r)||r.name==="cancelled:layerview-create")||re.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this.destroyed||this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};c([p()],du.prototype,"_workPromise",void 0),c([p({readOnly:!0})],du.prototype,"_watchUpdatingTracking",void 0),c([p({readOnly:!0})],du.prototype,"_layersToLayerViews",void 0),c([p({constructOnly:!0})],du.prototype,"layerviewMapping",void 0),c([p({readOnly:!0})],du.prototype,"_rootCollectionNames",null),c([p({constructOnly:!0})],du.prototype,"layerViewFilter",void 0),c([p()],du.prototype,"layerViewImporter",void 0),c([p()],du.prototype,"supportsGround",void 0),c([p({readOnly:!0})],du.prototype,"updating",null),c([p({readOnly:!0})],du.prototype,"updatingRemaining",null),c([p({constructOnly:!0})],du.prototype,"view",void 0),du=c([R("esri.views.support.LayerViewManager")],du);const Fyt=du;let VM=class extends be{constructor(e){super(e),this.featureTitleFields=!1,this.utilityNetworkFields=!1,this.globalIdField=!1}};c([p()],VM.prototype,"featureTitleFields",void 0),c([p()],VM.prototype,"utilityNetworkFields",void 0),c([p()],VM.prototype,"globalIdField",void 0),VM=c([R("esri.views.support.RequiredFieldsOptions")],VM);const zyt=VM;var jM,Bw;let $t=(Bw=class extends w$(aue){constructor(e){super(e),this._userSpatialReference=null,this.handles=new X0,this.updatingHandles=new tm,this.allLayerViews=new op({getCollections:()=>this.layerviewCollections,getChildrenFunction:Nyt}),this.analyses=new h1,this.basemapView=null,this.dependencies={popup:void 0},this.displayFilterEnabled=!0,this.fatalError=null,this.graphics=new FS,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ke,this.magnifier=new WLe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this._readyStateWaitingTask=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this._lowPriorityCursorHandles=new ke,this._highPriorityCursorHandles=new ke,this.input=new Tyt,this.navigation=new N7,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new XLe(this),this.persistableViewModels=new ke,this.requiredFieldsOptions=new zyt,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(X(()=>this.preconditionsReady,i=>{const r=this.ready;if(i?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,jM.views.add(this)):(this._lockedSpatialReference=null,jM.views.remove(this)),this.notifyChange("spatialReference"),!i&&r)this.toolViewManager?.detach(),this.analysisViewManager?.detach(),this.layerViewManager?.clear(),this._teardown();else if(i&&!r){try{this._startup()}catch(s){return void queueMicrotask(()=>{this.fatalError=new q("view:startup-error","View._startup failed",s)})}this.analysisViewManager?.attach(),this.toolViewManager.attach()}},Ht))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this._validateWithErrorDisplay()]).then(()=>(this._isValid=!0,qu(()=>this.ready)))),this.basemapView=new Lgt({view:this}),this.layerViewManager=new Fyt({view:this,layerViewFilter:e=>this.layerViewFilter?.(e)??!0,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},layerviewMapping:this._layerToLayerviewMapping}),this.toolViewManager=new Ym({view:this}),this.selectionManager=new Wgt({view:this}),this.addHandles([vs(()=>this.readyState==="map-content-error"&&!this.spatialReference,()=>{re.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),X(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},bt),X(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},Ht),X(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},bt)])}get _layerToLayerviewMapping(){return jM._layerToLayerview}destroy(){this.destroyed||(jM.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Pe(this.graphics),this.analyses=Pe(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.analysisViewManager=Pe(this.analysisViewManager),this.toolViewManager=Pe(this.toolViewManager),this.layerViewManager=Pe(this.layerViewManager),this.selectionManager=Pe(this.selectionManager),this.basemapView=Pe(this.basemapView),this.layerViews?.forEach(e=>e.destroy()),this.layerViews.length=0,this.invalidate(),this.handles.destroy(),this.map=Pe(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return re.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get layerviewCollections(){return[this.basemapView?.baseLayerViews,this.basemapView?.groundLayerViews,this.layerViews,this.basemapView?.referenceLayerViews]}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ts({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(e,i)=>this.getSpatialReferenceSupport(e,i),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get highlights(){return this._get("highlights")??byt()}set highlights(e){this._set("highlights",ju(e,this._get("highlights"),ke.ofType(jg)))}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!this.destroying&&!this.destroyed&&!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Qte(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(re.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),Qte(e)&&e.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get readyState(){if(this.destroyed)return this._get("readyState");if(!this.map)return"missing-map";if("container"in this&&!this.container)return"missing-container";if(this.fatalError)return"rendering-error";if((this.defaultsFromMap?.ready??!1)&&!this.spatialReference){const e=!("loaded"in this.map)||this.map.loaded,i=this.map.ground.loaded,r=this.map.basemap?.loaded??!0;return e&&r&&i&&!this.map?.allLayers.length?"empty-map":(this._readyStateWaitingTask||(this._readyStateWaitingTask=sc(s=>Q9(ie("view-readyState-waiting-delay"),null,s)),this.addHandles(this._readyStateWaitingTask),this.addHandles(this._readyStateWaitingTask,"ready-state-task")),this._readyStateWaitingTask?.finished?"map-content-error":"loading")}return this._readyStateWaitingTask=Rs(this._readyStateWaitingTask),this.removeHandles("ready-state-task"),this.ready?"ready":"loading"}get spatialReference(){const e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&this.defaultsFromMap?.required?.heightModelInfo){const i=e.clone();return i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,i}return e}set spatialReference(e){const i=!zr(e,this._get("spatialReference"));this._set("_userSpatialReference",e),i&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(e){this._userTimeExtent=e}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??xp}set timeZone(e){this._userTimeZone=e,Rct(e)||re.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._highPriorityCursorHandles.at(-1)?.cursor??this._lowPriorityCursorHandles.at(-1)?.cursor??"default"}acquireCursor(e,i="low"){const r=i==="high"?this._highPriorityCursorHandles:this._lowPriorityCursorHandles,s={cursor:e},n=bi(()=>r.remove(s));return r.add(s),this.addHandles(n),n}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new Dre}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}getSurface(){return null}importLayerView(e){throw new q("view:importLayerView-missing","importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return this.getSpatialReferenceSupport(e)!=null}when(e,i){return this.isResolved()&&!this.ready&&re.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,i)}forceReadyCycle(){this.ready&&(vs(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}on(e,i){return super.on(e,i)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}async _validateWithErrorDisplay(){try{await this.validate()}catch(e){const i=document.createElement("div");i.setAttribute("style","display: flex; flex-direction: column; gap: 8px; padding: 20px; height: 100%; justify-content: center; color: black; background: white; font-family: sans-serif;");const r=document.createElement("div");r.innerHTML="Unable to display map. WebGL2 support is required.",r.setAttribute("style","font-size: 24px; font-weight: bold;");const s=document.createElement("div");s.innerHTML="Ensure that your browser and hardware meet the minimum requirements.",s.setAttribute("style","font-size: 18px;");const n=document.createElement("a");n.innerHTML="https://esriurl.com/webgl-faq",n.target="_blank",n.setAttribute("style","font-size: 18px;"),n.href="https://esriurl.com/webgl-faq",i.appendChild(r),i.appendChild(s),i.appendChild(n);const a=this.getSurface();throw a&&a.appendChild(i),e}}},jM=Bw,Bw._layerToLayerview=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.basemap.groundLayers","view.basemapView.groundLayerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"],["view.map.layers","view.layerViews"]],Bw.views=new ke,Bw);c([p()],$t.prototype,"_userSpatialReference",void 0),c([p()],$t.prototype,"activeTool",null),c([p({readOnly:!0})],$t.prototype,"allLayerViews",void 0),c([p({readOnly:!0})],$t.prototype,"layerviewCollections",null),c([p(L5(h1,"analyses"))],$t.prototype,"analyses",void 0),c([p()],$t.prototype,"animation",null),c([p()],$t.prototype,"basemapView",void 0),c([p()],$t.prototype,"center",null),c([p()],$t.prototype,"defaultsFromMapSettings",null),c([p()],$t.prototype,"defaultsFromMap",null),c([p()],$t.prototype,"dependencies",void 0),c([p()],$t.prototype,"displayFilterEnabled",void 0),c([p({type:It})],$t.prototype,"extent",null),c([p()],$t.prototype,"fatalError",void 0),c([p(L5(FS,"graphics"))],$t.prototype,"graphics",void 0),c([p({readOnly:!0,type:Bo})],$t.prototype,"heightModelInfo",null),c([p({type:ke.ofType(jg)})],$t.prototype,"highlights",null),c([p({readOnly:!0})],$t.prototype,"interacting",null),c([p({constructOnly:!0})],$t.prototype,"layerViewFilter",void 0),c([p({readOnly:!0})],$t.prototype,"navigating",null),c([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],$t.prototype,"preconditionsReady",null),c([p({readOnly:!0})],$t.prototype,"typeSpecificPreconditionsReady",void 0),c([p({type:ke,readOnly:!0})],$t.prototype,"layerViews",void 0),c([p()],$t.prototype,"resolution",null),c([p({type:WLe})],$t.prototype,"magnifier",void 0),c([p({value:null,type:gue})],$t.prototype,"map",null),c([p()],$t.prototype,"padding",void 0),c([p({readOnly:!0})],$t.prototype,"ready",void 0),c([p()],$t.prototype,"_readyStateWaitingTask",void 0),c([p({readOnly:!0})],$t.prototype,"readyState",null),c([p({type:Me})],$t.prototype,"spatialReference",null),c([p()],$t.prototype,"stationary",null),c([p({type:ts})],$t.prototype,"timeExtent",null),c([p({type:String,nonNullable:!0})],$t.prototype,"timeZone",null),c([p()],$t.prototype,"tools",null),c([p()],$t.prototype,"toolViewManager",void 0),c([p({readOnly:!0})],$t.prototype,"type",void 0),c([p({type:Number})],$t.prototype,"scale",void 0),c([p({readOnly:!0})],$t.prototype,"updating",void 0),c([p({readOnly:!0})],$t.prototype,"initialExtentRequired",void 0),c([p({readOnly:!0})],$t.prototype,"initialExtent",null),c([p()],$t.prototype,"cursor",null),c([p({readOnly:!0})],$t.prototype,"input",void 0),c([p({type:N7,nonNullable:!0})],$t.prototype,"navigation",void 0),c([p()],$t.prototype,"layerViewManager",void 0),c([p()],$t.prototype,"analysisViewManager",void 0),c([p()],$t.prototype,"selectionManager",void 0),c([p()],$t.prototype,"width",void 0),c([p()],$t.prototype,"height",void 0),c([p({readOnly:!0})],$t.prototype,"resizing",void 0),c([p({value:null,readOnly:!0})],$t.prototype,"size",null),c([p({readOnly:!0})],$t.prototype,"suspended",void 0),c([p({readOnly:!0})],$t.prototype,"viewEvents",void 0),c([p({readOnly:!0})],$t.prototype,"persistableViewModels",void 0),c([p()],$t.prototype,"_isValid",void 0),c([p()],$t.prototype,"_readyCycleForced",void 0),c([p()],$t.prototype,"_lockedSpatialReference",void 0),c([p()],$t.prototype,"_userTimeZone",void 0),c([p()],$t.prototype,"_lockedTimeZone",void 0),c([p()],$t.prototype,"_userTimeExtent",void 0),c([p()],$t.prototype,"_lockedTimeExtent",void 0),c([p({type:Dre})],$t.prototype,"theme",void 0),c([p({readOnly:!0,type:Dre})],$t.prototype,"effectiveTheme",null),$t=jM=c([R("esri.views.View")],$t);const zJ=globalThis.$arcgis;zJ&&!zJ.views&&Object.defineProperty(zJ,"views",{configurable:!1,enumerable:!0,writable:!1,value:$t.views});const Vre=$t;function Nyt(t){return t.layerViews}function Ke(){return[0,0]}function Lq(t){return[t[0],t[1]]}function Cs(t,e){return[t,e]}function Vyt(t,e){return[t,e]}function jyt(t,e=Ke()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function zue(){return Ke()}function pFe(){return Cs(1,1)}function fFe(){return Cs(1,0)}function mFe(){return Cs(0,1)}const f1=zue(),gFe=pFe(),Uyt=fFe(),Byt=mFe();Object.freeze(Object.defineProperty({__proto__:null,ONES:gFe,UNIT_X:Uyt,UNIT_Y:Byt,ZEROS:f1,clone:Lq,create:Ke,freeze:Vyt,fromArray:jyt,fromValues:Cs,ones:pFe,unitX:fFe,unitY:mFe,zeros:zue},Symbol.toStringTag,{value:"Module"}));function qyt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function yFe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Gyt(t,e,i,r,s,n,a){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=a,t}function Nue(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*o-n*a)*l,t[5]=(r*a-i*o)*l,t):null}function Hyt(t){return t[0]*t[3]-t[1]*t[2]}function vFe(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=i[0],d=i[1],f=i[2],g=i[3],v=i[4],_=i[5];return t[0]=r*u+n*d,t[1]=s*u+a*d,t[2]=r*f+n*g,t[3]=s*f+a*g,t[4]=r*v+n*_+o,t[5]=s*v+a*_+l,t}function SF(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=Math.sin(i),d=Math.cos(i);return t[0]=r*d+n*u,t[1]=s*d+a*u,t[2]=r*-u+n*d,t[3]=s*-u+a*d,t[4]=o,t[5]=l,t}function V7(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=i[0],d=i[1];return t[0]=r*u,t[1]=s*u,t[2]=n*d,t[3]=a*d,t[4]=o,t[5]=l,t}function LO(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=i[0],d=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=a,t[4]=r*u+n*d+o,t[5]=s*u+a*d+l,t}function _Fe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function bFe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Vue(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Wyt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Zyt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Yyt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function wFe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function Jyt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function Qyt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function Xyt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Kyt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=e[0],u=e[1],d=e[2],f=e[3],g=e[4],v=e[5],_=_n();return Math.abs(i-l)<=_*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-u)<=_*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-d)<=_*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(n-f)<=_*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-g)<=_*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-v)<=_*Math.max(1,Math.abs(o),Math.abs(v))}const evt=vFe,tvt=wFe;Object.freeze(Object.defineProperty({__proto__:null,add:Yyt,copy:qyt,determinant:Hyt,equals:Kyt,exactEquals:Xyt,frob:Zyt,fromRotation:_Fe,fromScaling:bFe,fromTranslation:Vue,identity:yFe,invert:Nue,mul:evt,multiply:vFe,multiplyScalar:Jyt,multiplyScalarAndAdd:Qyt,rotate:SF,scale:V7,set:Gyt,str:Wyt,sub:tvt,subtract:wFe,translate:LO},Symbol.toStringTag,{value:"Module"}));function Ug(){return[1,0,0,1,0,0]}function ivt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function rvt(t,e,i,r,s,n){return[t,e,i,r,s,n]}const svt=Ug();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:svt,clone:ivt,create:Ug,fromValues:rvt},Symbol.toStringTag,{value:"Module"}));const QN={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new gs({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Me.WebMercator}),minus180Line:new gs({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Me.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new gs({paths:[[[180,-180],[180,180]]],spatialReference:Me.WGS84}),minus180Line:new gs({paths:[[[-180,-180],[-180,180]]],spatialReference:Me.WGS84})}};function cS(t,e){return Math.ceil((t-e)/(2*e))}function xFe(t,e){const i=D4(t);for(const r of i)for(const s of r)s[0]+=e;return t}function D4(t){return AS(t)?t.rings:t.paths}function nvt(t,e){return e?{...e,query:{...t,...e.query}}:{query:t}}function SFe(t){return typeof t=="string"?kn(t):se(t)}function avt(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(a=>avt(a));else if(typeof n=="object")if(n.toJSON){const a=n.toJSON(i?.[s]);r[s]=e?a:JSON.stringify(a)}else r[s]=e?n:JSON.stringify(n);else r[s]=n}return r}function ovt(t,e){return t?e&&nce(t)?e:sce(t)??nr?.findCredential(t)?.token:null}async function iui(t,e,i){const r=ovt(t,e);return r||(!nr&&fr.request.useIdentity&&await W(()=>import("./IdentityManager-DxgB9y7h.js"),[]),(await nr.getCredential(t,i))?.token)}async function lvt(t,e,i,r){const s=SFe(t),n=e[0].spatialReference,a={...r,responseType:"json",query:{...s.query,f:"json",sr:gq(n),target:JSON.stringify({geometryType:mP(e[0]),geometries:e}),cutter:JSON.stringify(i)}},o=await Si(s.path+"/cut",a),{cutIndexes:l,geometries:u=[]}=o.data;return{cutIndexes:l,geometries:u.map(d=>{const f=wp(d);return f.spatialReference=n,f})}}function cvt(t){return{geometryType:mP(t[0]),geometries:t.map(e=>e.toJSON())}}function TFe(t,e,i){const r=cot(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}async function uvt(t,e,i){const r=typeof t=="string"?kn(t):t,s=e[0].spatialReference,n=mP(e[0]),a={...i,query:{...r.query,f:"json",sr:gq(s),geometries:JSON.stringify(cvt(e))}},{data:o}=await Si(r.path+"/simplify",a);return TFe(o.geometries,n,s)}const $Fe=()=>re.getLogger("esri.geometry.support.normalizeUtils");function hvt(t){return t.type==="polygon"}function dvt(t){return t[0].type==="polygon"}function pvt(t){return t[0].type==="polyline"}function T1e(t){const e=[];let i=0,r=0;for(let s=0;s<t.length;s++){const n=t[s];let a=null;for(let o=0;o<n.length;o++)a=n[o],e.push(a),o===0?(i=a[0],r=i):(i=Math.min(i,a[0]),r=Math.max(r,a[0]));a&&e.push([(i+r)/2,0])}return e}function fvt(t,e){if(!(t instanceof gs||t instanceof Wr)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw $Fe().error(s),new q("internal:geometry",s)}const i=D4(t),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let a=0;a<s.length-1;a++){const o=s[a][0],l=s[a][1],u=s[a+1][0],d=s[a+1][1],f=Math.sqrt((u-o)*(u-o)+(d-l)*(d-l)),g=(d-l)/f,v=(u-o)/f,_=f/e;if(_>1){for(let M=1;M<=_-1;M++){const E=M*e,P=v*E+o,O=g*E+l;n.push([P,O])}const x=(f+Math.floor(_-1)*e)/2,S=v*x+o,T=g*x+l;n.push([S,T])}n.push([u,d])}}return hvt(t)?new Wr({rings:r,spatialReference:t.spatialReference}):new gs({paths:r,spatialReference:t.spatialReference})}function $1e(t,e,i){if(e){const r=fvt(t,1e6);t=iS(r,!0)}return i&&(t=xFe(t,i)),t}function C1e(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const s=cS(r,e);t[0]=r+s*(-2*e)}else if(r<i){const s=cS(r,i);t[0]=r+s*(-2*i)}}else{const r=t.x;if(r>e){const s=cS(r,e);t=t.clone().offset(s*(-2*e),0)}else if(r<i){const s=cS(r,i);t=t.clone().offset(s*(-2*i),0)}}return t}function mvt(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const s=e.cutIndexes[r],n=e.geometries[r],a=D4(n);for(let o=0;o<a.length;o++){const l=a[o];l.some(u=>{if(u[0]<180)return!0;{let d=0;for(let g=0;g<l.length;g++){const v=l[g][0];d=v>d?v:d}d=Number(d.toFixed(9));const f=-360*cS(d,180);for(let g=0;g<l.length;g++){const v=n.getPoint(o,g);n.setPoint(o,g,v.clone().offset(f,0))}return!0}})}if(s===i){if(dvt(t))for(const o of D4(n))t[s]=t[s].addRing(o);else if(pvt(t))for(const o of D4(n))t[s]=t[s].addPath(o)}else i=s,t[s]=n}return t}async function gvt(t,e,i){if(!Array.isArray(t))return gvt([t],e);e&&typeof e!="string"&&$Fe().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:e?.url??fr.geometryServiceUrl;let s,n,a,o,l,u,d,f,g=0;const v=[],_=[];for(const P of t)if(P!=null)if(s||(s=P.spatialReference,n=Xl(s),a=s.isWebMercator,u=a?102100:4326,o=QN[u].maxX,l=QN[u].minX,d=QN[u].plus180Line,f=QN[u].minus180Line),n)if(P.type==="mesh")_.push(P);else if(P.type==="point")_.push(C1e(P.clone(),o,l));else if(P.type==="multipoint"){const O=P.clone();O.points=O.points.map(D=>C1e(D,o,l)),_.push(O)}else if(P.type==="extent"){const O=P.clone()._normalize(!1,!1,n);_.push(O.rings?new Wr(O):O)}else if(P.extent){const O=P.extent,D=cS(O.xmin,l)*(2*o);let L=D===0?P.clone():xFe(P.clone(),D);O.offset(D,0);let{xmin:F,xmax:j}=O;F=Number(F.toFixed(9)),j=Number(j.toFixed(9)),O.intersects(d)&&j!==o?(g=j>g?j:g,L=$1e(L,a),v.push(L),_.push("cut")):O.intersects(f)&&F!==l?(g=j*(2*o)>g?j*(2*o):g,L=$1e(L,a,360),v.push(L),_.push("cut")):_.push(L)}else _.push(P.clone());else _.push(P);else _.push(P);let x=cS(g,o),S=-90;const T=x,M=new gs;for(;x>0;){const P=360*x-180;M.addPath([[P,S],[P,-1*S]]),S*=-1,x--}if(v.length>0&&T>0){const P=mvt(v,await lvt(r,v,M,i)),O=[],D=[];for(let j=0;j<_.length;j++){const N=_[j];if(N!=="cut")D.push(N);else{const B=P.shift(),U=t[j];U!=null&&U.type==="polygon"&&U.rings&&U.rings.length>1&&B.rings.length>=U.rings.length?(O.push(B),D.push("simplify")):D.push(a?_0(B):B)}}if(!O.length)return D;const L=await uvt(r,O,i),F=[];for(let j=0;j<D.length;j++){const N=D[j];N!=="simplify"?F.push(N):F.push(a?_0(L.shift()):L.shift())}return F}const E=[];for(let P=0;P<_.length;P++){const O=_[P];if(O!=="cut")E.push(O);else{const D=v.shift();E.push(a===!0?_0(D):D)}}return E}function yvt(t){if(!t)return null;const e=t.extent;if(!e)return null;const i=t.spatialReference&&Xl(t.spatialReference);if(!i)return e;const[r,s]=i.valid,n=2*s,{width:a}=e;let o,{xmin:l,xmax:u}=e;if([l,u]=[u,l],t.type==="extent"||a===0||a<=s||a>n||l<r||u>s)return e;switch(t.type){case"polygon":if(!(t.rings.length>1))return e;o=T1e(t.rings);break;case"polyline":if(!(t.paths.length>1))return e;o=T1e(t.paths);break;case"multipoint":o=t.points}const d=e.clone();for(let f=0;f<o.length;f++){let g=o[f][0];g<0?(g+=s,u=Math.max(g,u)):(g-=s,l=Math.min(g,l))}return d.xmin=l,d.xmax=u,d.width<a?(d.xmin-=s,d.xmax-=s,d):e}function jue(t,e,i){const r=Xl(i);if(r==null)return t;const[s,n]=r.valid,a=2*n;let o=0,l=0;e>n?o=Math.ceil(Math.abs(e-n)/a):e<s&&(o=-Math.ceil(Math.abs(e-s)/a)),t>n?l=Math.ceil(Math.abs(t-n)/a):t<s&&(l=-Math.ceil(Math.abs(t-s)/a));let u=t+(o-l)*a;const d=u-e;return d>n?u-=a:d<s&&(u+=a),u}function rui(t,e){return TF(e)?.normalize(t)??t}function TF(t){const e=Xl(t);if(e==null)return null;const[i,r]=e.valid;return new K9(i,r)}const CFe=TF(Me.WGS84),vvt=TF(Me.WebMercator),MFe=96,EFe=39.37,_vt=180/Math.PI;function AFe(t){return t.wkid?t:t.spatialReference||Me.WGS84}function Uue(t,e){return e.type?oi(t,e.x,e.y):na(t,e)}function OFe(t){return Yr(t)}function j7(t,e,i=0){let r=t.width,s=t.height;if(i!==0){const o=zt(i),l=Math.abs(Math.cos(o)),u=Math.abs(Math.sin(o));r=t.width*l+t.height*u,s=t.width*u+t.height*l}const n=Math.max(1,e[0]),a=Math.max(1,e[1]);return Math.max(r/n,s/a)*Mvt(t.spatialReference)}async function LD(t,e,i,r){let s,n;if(!t||Array.isArray(t)&&!t.length)return null;if(ke.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const o=t.every(d=>"attributes"in d),l=t.some(d=>!d.geometry);let u=t;if(o&&l&&e&&e.allLayerViews){const d=new Map;for(const _ of t){const x=_.layer,S=d.get(x)||[],T=_.attributes[x.objectIdField];T!=null&&S.push(T),d.set(x,S)}const f=[];d.forEach((_,x)=>{const S=e.allLayerViews?.find(T=>T.layer.id===x.id);if(S&&"queryFeatures"in S){const T=x.createQuery();T.objectIds=_,T.returnGeometry=!0,f.push(S.queryFeatures(T))}});const g=await Promise.all(f),v=[];for(const _ of g)if(_&&_.features&&_.features.length)for(const x of _.features)x.geometry!=null&&v.push(x.geometry);u=v}for(const d of u)r=await LD(d,e,i,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")s=new Ue(t);else if(t instanceof Qa)s=t;else if("geometry"in t){if(t.geometry)s=t.geometry;else if(t.layer){const o=t.layer,l=e.allLayerViews?.find(u=>u.layer.id===o.id);if(l&&"queryFeatures"in l){const u=o.createQuery();u.objectIds=[t.attributes[o.objectIdField]],u.returnGeometry=!0,s=(await l.queryFeatures(u))?.features?.[0]?.geometry}}}if(s==null)return null;switch(s.type){case"point":n=new It({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":n=yvt(s);break;default:n=s.extent}if(!n)return null;ry()||Zc(n.spatialReference,i)||await F0();const a=Pa(n,i);if(!a)return null;if(r){const o=a.center,l=o.clone();l.x=jue(o.x,r.center.x,i),l.x!==o.x&&a.centerAt(l),r=r.union(a)}else r=a;return r}function bvt(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer?.minScale!=null&&t.layer.maxScale!=null){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,i=0;for(const r of t){const s=r.layer;s?.minScale&&s.maxScale&&(e=s.minScale<e?s.minScale:e,i=s.maxScale>i?s.maxScale:i)}return e&&i?{min:e,max:i}:null}}}function M1e(t,e){const i=AFe(t);return zr(i,e)||i.imageCoordinateSystem||e.imageCoordinateSystem?t:Pa(t,e)}async function wvt(t,e){if(!t||!e)return new ys({targetGeometry:new Ue,scale:0,rotation:0});let i=e.spatialReference;const{constraints:r,padding:s,viewpoint:n,size:a}=e,o=[s?a[0]-s.left-s.right:a[0],s?a[1]-s.top-s.bottom:a[1]];let l=null;t instanceof ys?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let u=null;l?.targetGeometry?u=l.targetGeometry:t instanceof It?u=t:t instanceof Qa?u=await LD(t,e,i):t&&(u=await LD(t.center,e,i)||await LD(t.target,e,i)||await LD(t,e,i)),!u&&n?.targetGeometry?u=n.targetGeometry:!u&&e.extent&&(u=e.extent),i||(i=AFe(e.spatialReference||e.extent||u)),ry()||zr(u.spatialReference,i)||Zc(u.spatialReference,i)||await F0();const d=M1e(u,i),f="center"in d?d.center:d;e.pickClosestTarget!==!1&&f.type==="point"&&n.targetGeometry?.type==="point"&&(f.x=jue(f.x,n.targetGeometry.x,f.spatialReference));let g=0;l?g=l.rotation:t.hasOwnProperty("rotation")?g=t.rotation:n&&(g=n.rotation);let v=0;v=l?.targetGeometry!=null&&l.targetGeometry.type==="point"?l.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs?r.zoomToScale(t.zoom):Array.isArray(u)||u.type==="point"||u.type==="extent"&&u.width===0&&u.height===0?n.scale:j7(M1e(u.extent,i),o,g);const _=bvt(t.target??t);_&&(_.min&&_.min<v?v=_.min:_.max&&_.max>v&&(v=_.max));let x=new ys({targetGeometry:f,scale:v,rotation:g});return r&&(x=r.fit(x),r.constrainByGeometry(x),r.rotationEnabled||(x.rotation=n.rotation)),x}function Yl(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function xvt(t,e,i){return i?oi(t,.5*(e[0]-i.right+i.left),.5*(e[1]-i.bottom+i.top)):Nh(t,e,.5)}const Svt=(function(){const t=Ke();return function(e,i,r){const s=i.targetGeometry;Uue(t,s);const n=.5*xP(i);return e.xmin=t[0]-n*r[0],e.ymin=t[1]-n*r[1],e.xmax=t[0]+n*r[0],e.ymax=t[1]+n*r[1],e.spatialReference=s.spatialReference,e}})();function Tvt(t,e,i,r,s){return jre(t,e,i.center),t.scale=j7(i,r),s?.constraints?.constrain(t),t}function $vt(t,e,i,r){return Gue(t,e,i,r),Nue(t,t)}const PFe=(function(){const t=Ke();return function(e,i,r){return c7(e,Evt(e,i),xvt(t,i,r))}})(),Cvt=(function(){const t=Ug(),e=Ke();return function(i,r,s,n){const a=xP(r),o=Bue(r);return oi(e,a,a),bFe(t,e),SF(t,t,o),LO(t,t,PFe(e,s,n)),LO(t,t,[0,n.top-n.bottom]),oi(i,t[4],t[5])}})();function xP(t){return t.scale*RFe(t.targetGeometry?.spatialReference)}function RFe(t){return jh(t)?1/(OFe(t)*EFe*MFe):1}function Bue(t){return nF(t.rotation)||0}function Mvt(t){return jh(t)?OFe(t)*EFe*MFe:1}function Evt(t,e){return Nh(t,e,.5)}const que=(function(){const t=Ke(),e=Ke(),i=Ke();return function(r,s,n,a,o,l){return bce(t,s),Nh(e,n,.5*l),oi(i,1/a*l,-1/a*l),Vue(r,e),o&&SF(r,r,o),V7(r,r,i),LO(r,r,t),r}})(),Gue=(function(){const t=Ke();return function(e,i,r,s){const n=xP(i),a=Bue(i);return Uue(t,i.targetGeometry),que(e,t,r,n,a,s)}})(),Avt=(function(){const t=Ke();return function(e,i,r,s){const n=xP(i);return Uue(t,i.targetGeometry),que(e,t,r,n,0,s)}})();function IFe(t){const e=Xl(t);return e?e.valid[1]-e.valid[0]:0}function Ovt(t,e){return Math.round(IFe(t)/e)}const Pvt=(function(){const t=Ke(),e=Ke(),i=[0,0,0];return function(r,s,n){Os(t,r,s),vO(t,t),Os(e,r,n),vO(e,e),TIe(i,t,e);let a=Math.acos(dn(t,e)/(yO(t)*yO(e)))*_vt;return i[2]<0&&(a=-a),isNaN(a)&&(a=0),a}})(),Rvt=(function(){const t=Ke();return function(e,i,r,s){const n=e.targetGeometry;return Yl(e,i),Cvt(t,i,r,s),n.x+=t[0],n.y+=t[1],e}})(),jre=function(t,e,i){Yl(t,e);const r=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t},Ivt=(function(){const t=Ke();return function(e,i,r,s,n){n||(n="center"),c7(t,r,s),Nh(t,t,.5);const a=t[0],o=t[1];switch(n){case"center":oi(t,0,0);break;case"left":oi(t,-a,0);break;case"top":oi(t,0,o);break;case"right":oi(t,a,0);break;case"bottom":oi(t,0,-o);break;case"top-left":oi(t,-a,o);break;case"bottom-left":oi(t,-a,-o);break;case"top-right":oi(t,a,o);break;case"bottom-right":oi(t,a,-o)}return U7(e,i,t),e}})();function sui(t,e,i){return Yl(t,e),t.rotation+=i,t}function Dvt(t,e,i){return Yl(t,e),t.rotation=i,t}const kvt=(function(){const t=Ke();return function(e,i,r,s,n){return Yl(e,i),isNaN(r)||r===0||(kFe(t,s,i,n),e.scale=i.scale*r,LFe(t,t,e,n),U7(e,e,oi(t,t[0]-s[0],s[1]-t[1]))),e}})();function E1e(t,e,i){return Yl(t,e),t.scale=i,t}const DFe=(function(){const t=Ke();return function(e,i,r,s,n,a){return Yl(e,i),isNaN(r)||r===0||(kFe(t,n,i,a),e.scale=i.scale*r,e.rotation+=s,LFe(t,t,e,a),U7(e,e,oi(t,t[0]-n[0],n[1]-t[1]))),e}})(),nui=(function(){const t=Ke(),e=Ke();return function(i,r,s,n,a,o,l){return PFe(e,o,l),bg(t,a,e),n?DFe(i,r,s,n,t,o):kvt(i,r,s,t,o)}})(),kFe=(function(){const t=Ug();return function(e,i,r,s){return $g(e,i,$vt(t,r,s,1))}})(),LFe=(function(){const t=Ug();return function(e,i,r,s){return $g(e,i,Gue(t,r,s,1))}})(),U7=(function(){const t=Ke(),e=Ug();return function(i,r,s){Yl(i,r);const n=xP(r),a=i.targetGeometry;return _Fe(e,Bue(r)),V7(e,e,Cs(n,n)),$g(t,s,e),a.x+=t[0],a.y+=t[1],i}})();function FFe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Lvt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Fvt(t,e,i,r,s,n){const a=new Float32Array(6);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=s,a[5]=n,a}function zFe(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function zvt(t,e,i,r=0,s=0,n=2){const a=s||e.length/n;for(let o=r;o<a;o++)zFe(t,e,i,o*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Lvt,create:FFe,fromValues:Fvt,transform:zFe,transformMany:zvt},Symbol.toStringTag,{value:"Module"}));function Bg(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function NFe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Nvt(t,e,i,r,s,n,a,o,l){const u=new Float32Array(9);return u[0]=t,u[1]=e,u[2]=i,u[3]=r,u[4]=s,u[5]=n,u[6]=a,u[7]=o,u[8]=l,u}Object.freeze(Object.defineProperty({__proto__:null,clone:NFe,create:Bg,fromValues:Nvt},Symbol.toStringTag,{value:"Module"}));function VFe(){return new Float32Array(2)}function Vvt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function ep(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function jFe(){return VFe()}function UFe(){return ep(1,1)}function BFe(){return ep(1,0)}function qFe(){return ep(0,1)}const jvt=jFe(),Uvt=UFe(),Bvt=BFe(),qvt=qFe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Uvt,UNIT_X:Bvt,UNIT_Y:qvt,ZEROS:jvt,clone:Vvt,create:VFe,fromValues:ep,ones:UFe,unitX:BFe,unitY:qFe,zeros:jFe},Symbol.toStringTag,{value:"Module"}));function Gvt(t){return t instanceof Float32Array&&t.length>=2}function Hvt(t){return Array.isArray(t)&&t.length>=2}function NJ(t){return Gvt(t)||Hvt(t)}var Ure;const Ey=[0,0];let rv=Ure=class extends ae{constructor(t){super(t),this._viewpoint2D={center:Ke(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new It,this.id=0,this.inverseTransform=Ug(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Ug(),this.transformNoRotation=Ug(),this.displayMat3=Bg(),this.displayViewMat3=Bg(),this.viewMat3=Bg(),this.viewMat2d=FFe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}get visibleArea(){const[t,e]=this.size;return[this.toMap([0,0],0,0),this.toMap([0,0],0,e),this.toMap([0,0],t,e),this.toMap([0,0],t,0)]}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Yl(i,t.viewpoint),this._set("size",na(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Ure({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return NJ(e)?$g(t,e,this.inverseTransform):(Ey[0]=e,Ey[1]=i,$g(t,Ey,this.inverseTransform))}toScreen(t,e,i){return NJ(e)?$g(t,e,this.transform):(Ey[0]=e,Ey[1]=i,$g(t,Ey,this.transform))}toScreenNoRotation(t,e,i){return NJ(e)?$g(t,e,this.transformNoRotation):(Ey[0]=e,Ey[1]=i,$g(t,Ey,this.transformNoRotation))}wrapMapCoordinate(t,e){na(t,e);const[i]=e,[r]=this.center,{extent:s,spatialReference:n}=this;let{xmin:a,xmax:o}=s;if(n.isWrappable){const l=IFe(n)/2;a=Math.max(a,r-l),o=Math.min(o,r+l)}return(i<a||i>o)&&(t[0]=jue(i,r,n)),t}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return que(t,i,s,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),a=new ys({targetGeometry:new Ue(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",a),!n||!e||!i)return;this.resolution=xP(a),this.rotation=r,this.scale=i,this.spatialReference=e,na(this.center,t);const o=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;b0(this.displayMat3,o,0,0,0,l,0,-1,1,1);const u=oF(this.viewMat3),d=ep(n[0]/2,n[1]/2),f=ep(-n[0]/2,-n[1]/2),g=nF(r);s1(u,u,d),lF(u,u,g),s1(u,u,f),KT(this.displayViewMat3,this.displayMat3,u);const v=Vue(this.viewMat2d,d);return SF(v,v,g),LO(v,v,f),Svt(this.extent,a,n),Gue(this.transform,a,n,s),Nue(this.inverseTransform,this.transform),Avt(this.transformNoRotation,a,n,s),this.worldScreenWidth=Ovt(this.spatialReference,this.resolution),this._set("id",this.id+1),this.notifyChange("visibleArea"),this}};c([p({readOnly:!0})],rv.prototype,"id",void 0),c([p({value:1,json:{write:!0}})],rv.prototype,"pixelRatio",null),c([p({json:{write:!0}})],rv.prototype,"size",null),c([p()],rv.prototype,"spatialReference",void 0),c([p({type:ys,json:{write:!0}})],rv.prototype,"viewpoint",null),c([p({readOnly:!0})],rv.prototype,"visibleArea",null),rv=Ure=c([R("esri.views.2d.ViewState")],rv);const A1e=rv;var Bre,qre;let Yv=Bre=class extends be{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new Bre({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};c([p()],Yv.prototype,"left",void 0),c([p()],Yv.prototype,"top",void 0),c([p()],Yv.prototype,"right",void 0),c([p()],Yv.prototype,"bottom",void 0),Yv=Bre=c([R("esri.views.2d.PaddedViewState.Padding")],Yv);let UM=qre=class extends A1e{constructor(...t){super(...t),this.paddedViewState=new A1e,this._updateContent=(()=>{const e=Ke();return()=>{const i=this._get("size"),r=this._get("padding");if(!i||!r)return;const s=this.paddedViewState;oi(e,r.left+r.right,r.top+r.bottom),Os(e,i,e),na(s.size,e);const n=s.viewpoint;n&&(this.viewpoint=n)}})(),this.addHandles(X(()=>[this.size,this.padding],()=>this._updateContent(),Ht)),this.padding=new Yv,this.size=[0,0]}set padding(t){this._set("padding",t||new Yv)}set viewpoint(t){if(t){this.paddedViewState.viewpoint=t;let e=t;const i=this._get("padding");i&&(e=Rvt(t.clone(),t,this._get("size"),i));const{targetGeometry:r,rotation:s,scale:n}=e,{x:a,y:o,spatialReference:l}=r,u=this._viewpoint2D;u.center[0]=a,u.center[1]=o,u.rotation=s,u.scale=n,u.spatialReference=l,this._update()}}clone(){return new qre({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};c([p()],UM.prototype,"paddedViewState",void 0),c([p({type:Yv})],UM.prototype,"padding",null),c([p()],UM.prototype,"viewpoint",null),UM=qre=c([R("esri.views.2d.PaddedViewState")],UM);const Hue=UM;let FD=class extends be{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};c([p()],FD.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),c([p()],FD.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),FD=c([R("esri.views.support.debugFlags")],FD);const Wvt=new FD,Oa=Symbol("Yield");let Zvt=class{constructor(){this._tasks=new Array,this._numPendingTasks=ta(0),this._readyToRun=ta(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get readyToRun(){return this._readyToRun.value}_updateReadyToRun(){this._readyToRun.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return Oa;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._addTask((s,n)=>new P1e(s,n,e,i,r),Array.prototype.push)}unshift(e,i,r){return this._addTask((s,n)=>new P1e(s,n,e,i,r),Array.prototype.unshift)}pushGenerator(e,i,r){return this._addTask((s,n)=>new Yvt(s,n,e,i,r),Array.prototype.push)}_process(e){if(this._tasks.length===0)return!1;const i=this._tasks.shift();this._updateReadyToRun();try{if(sa(i.signal))this._cancelTask(i,ti());else switch(i.type){case 0:this._processSimple(i,e);break;case 1:this._processGenerator(i,e);break;case 2:this._processIterator(i,e);break;default:}}catch(r){i.reject(r)}return!0}cancelAll(){const e=ti();for(const i of this._tasks)this._cancelTask(i,e);this._tasks.length=0,this._updateReadyToRun()}_cancelTask(e,i){if(e.abortCallback){const r=e.abortCallback(i);e.type===2&&e.iterator.return&&O1e(e.iterator.return()),Ea(r)?r.then(e.resolve,e.reject):e.resolve(r)}else e.type===2&&e.iterator.throw&&O1e(e.iterator.throw(i)),e.reject(i)}_onIteratorResult(e,i){i.done?e.resolve(i.value):(this._tasks.unshift(e),this._updateReadyToRun())}_processSimple(e,i){const r=e.callback(i);Ea(r)?r.then(e.resolve,e.reject):e.resolve(r)}_processGenerator(e,i){const r=e.generatorFunction(i),s=new Jvt(e.resolve,e.reject,r,e.signal,e.abortCallback);this._processIterator(s,i)}_processIterator(e,i){const r=e.iterator.next(i);Ea(r)?r.then(s=>this._onIteratorResult(e,s),e.reject):this._onIteratorResult(e,r)}_addTask(e,i){return new Promise((r,s)=>{const n=e(r,s);i.call(this._tasks,n),++this._numPendingTasks.value,this._updateReadyToRun()}).finally(()=>--this._numPendingTasks.value)}};function O1e(t){Ea(t)?t.then(VJ,VJ):VJ(t)}function VJ(t){Zr(t)||t instanceof Error||t instanceof q||t!=null&&typeof t=="object"&&"done"in t&&t.done||re.getLogger("esri.layers.support.PromiseQueue").warn("Generator iterator was aborted, but it is not done.")}let Wue=class{constructor(e,i,r=void 0,s=void 0){this.resolve=e,this.reject=i,this.signal=r,this.abortCallback=s}},P1e=class extends Wue{constructor(e,i,r,s,n){super(e,i,s,n),this.callback=r,this.type=0}},Yvt=class extends Wue{constructor(e,i,r,s,n){super(e,i,s,n),this.generatorFunction=r,this.type=1}},Jvt=class extends Wue{constructor(e,i,r,s,n){super(e,i,s,n),this.iterator=r,this.type=2}};function GFe(){return new t0t}const Tt={RESOURCE_CONTROLLER_IMMEDIATE:"immediate",RESOURCE_CONTROLLER:"schedule",SLIDE:"slide",STREAM_DATA_LOADER:"stream loader",ELEVATION_QUERY:"elevation query",TERRAIN_SURFACE:"terrain",SURFACE_GEOMETRY_UPDATES:"surface geometry updates",LOD_RENDERER:"LoD renderer",GRAPHICS_CORE:"Graphics3D",I3S_CONTROLLER:"I3S",POINT_CLOUD_LAYER:"point cloud",FEATURE_TILE_FETCHER:"feature fetcher",STREAM_CONTROLLER:"stream controller",OVERLAY:"overlay",OVERLAY_RENDERER:"overlay renderer",STAGE:"stage",GRAPHICS_DECONFLICTOR:"graphics deconflictor",FILTER_VISIBILITY:"Graphics3D filter visibility",SCALE_VISIBILITY:"Graphics3D scale visibility",FRUSTUM_VISIBILITY:"Graphics3D frustum visibility",POINT_OF_INTEREST_FREQUENT:"POI frequent",POINT_OF_INTEREST_INFREQUENT:"POI infrequent",LABELER:"labeler",FEATURE_QUERY_ENGINE:"feature query",FEATURE_TILE_TREE:"feature tile tree",FEATURE_TILE_TREE_ACTIVE:"fast feature tile tree",ELEVATION_ALIGNMENT:"elevation alignment",ELEVATION_ALIGNMENT_SCENE:"elevation alignment scene",TEXT_TEXTURE_ATLAS:"text texture atlas",TEXTURE_UNLOAD:"texture unload",LINE_OF_SIGHT_TOOL:"line of sight tool",LINE_OF_SIGHT_TOOL_INTERACTIVE:"interactive line of sight tool",ELEVATION_PROFILE:"elevation profile",SNAPPING:"snapping",SHADOW_ACCUMULATOR:"shadow accumulator",CLOUDS_GENERATOR:"clouds generator",FLOW_GENERATOR:"flow generator",MAPVIEW_FETCH_QUEUE:"mapview fetch queue",MAPVIEW_LAYERVIEW_UPDATE:"mapview layerview update",MAPVIEW_VECTOR_TILE_PARSING_QUEUE:"mapview vector tile parsing queue",NONE:0,TEST_PRIO:1},Ud=0,R1e=new Map([[Tt.RESOURCE_CONTROLLER_IMMEDIATE,Ud],[Tt.RESOURCE_CONTROLLER,4],[Tt.SLIDE,Ud],[Tt.STREAM_DATA_LOADER,Ud],[Tt.ELEVATION_QUERY,Ud],[Tt.TERRAIN_SURFACE,1],[Tt.SURFACE_GEOMETRY_UPDATES,1],[Tt.LOD_RENDERER,2],[Tt.GRAPHICS_CORE,2],[Tt.I3S_CONTROLLER,2],[Tt.POINT_CLOUD_LAYER,2],[Tt.FEATURE_TILE_FETCHER,2],[Tt.STREAM_CONTROLLER,2],[Tt.CLOUDS_GENERATOR,2],[Tt.OVERLAY,4],[Tt.OVERLAY_RENDERER,4],[Tt.STAGE,4],[Tt.GRAPHICS_DECONFLICTOR,4],[Tt.FILTER_VISIBILITY,4],[Tt.SCALE_VISIBILITY,4],[Tt.FRUSTUM_VISIBILITY,4],[Tt.POINT_OF_INTEREST_FREQUENT,6],[Tt.POINT_OF_INTEREST_INFREQUENT,30],[Tt.LABELER,8],[Tt.FEATURE_QUERY_ENGINE,8],[Tt.FEATURE_TILE_TREE,16],[Tt.FEATURE_TILE_TREE_ACTIVE,Ud],[Tt.ELEVATION_ALIGNMENT,12],[Tt.ELEVATION_ALIGNMENT_SCENE,14],[Tt.TEXT_TEXTURE_ATLAS,12],[Tt.TEXTURE_UNLOAD,12],[Tt.LINE_OF_SIGHT_TOOL,16],[Tt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Ud],[Tt.SNAPPING,Ud],[Tt.SHADOW_ACCUMULATOR,30],[Tt.FLOW_GENERATOR,12],[Tt.MAPVIEW_FETCH_QUEUE,Ud],[Tt.MAPVIEW_LAYERVIEW_UPDATE,2],[Tt.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,Ud]]);function I1e(t){return R1e.has(t)?R1e.get(t):typeof t=="number"?t:1}const Qvt=6.5,D1e=1,Xvt=30,Kvt=1e3/30,e0t=100,k1e=.9;let t0t=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(e=>e.needsUpdate)}constructor(){this._updating=ta(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new o0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new Zue,this.state=1,this._tasks=new Array,this._runQueue=new Array,this._load=0,this._forceTask=!1,this._debug=!1,this._debugHandle=X(()=>Wvt.SCHEDULER_LOG_SLOW_TASKS,e=>this._debug=e,Yt);for(const e of Object.keys(Tt))this.performanceInfo.tasks.set(Tt[e],new o0(String(Tt[e])))}destroy(){this._tasks.forEach(e=>e.remove()),this._tasks.length=0,this._runQueue.length=0,Xi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(e,i){const r=new i0t(this,e,i);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new o0(e)),r}get load(){return this._load}frame(e){if(this._startFrameTaskTimes(),this._updateBudget(e)){const i=this._budget.now();return this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-i),!0}return this._recordFrameTaskTimes(0),!1}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let i=Qvt,r=e.frameDuration,s=D1e;switch(this.state){case 2:i=0,r=Math.max(e0t,e.frameDuration),s=Xvt;break;case 1:r=Math.max(Kvt,e.frameDuration)}return r=r-e.elapsedFrameTime-i,this.state!==2&&r<D1e&&!this._forceTask?(this._forceTask=!0,!1):(r=Math.max(r,s),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case 2:this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(0),this._budget.madeProgress()}removeTask(e){Uc(this._tasks,e),Uc(this._runQueue,e),this._updatingChanged()}_updateTask(e){this._tasks.forEach(i=>{i.name===e&&i.setPriority(e)})}_getState(e){if(this._runQueue.some(r=>r.name===e))return"s";let i="i";return this._tasks.forEach(r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?i="r":i!=="r"&&(i="w"))}),i}_getRuntime(e){let i=0;return this._tasks.forEach(r=>{r.name===e&&(i+=r.runtime)}),i}_resetRuntimes(){this._tasks.forEach(e=>e.runtime=0)}_getRunning(){const e=new Map;if(this._tasks.forEach(r=>{r.needsUpdate&&e.set(r.name,(e.get(r.name)||0)+1)}),e.size===0)return null;let i="";return e.forEach((r,s)=>{i+=r>1?` ${r}x ${s}`:` ${s}`}),i}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce((i,r)=>r.needsUpdate?++i:i,0);this._load=this._load*k1e+e*(1-k1e)}_schedule(){for(q9(this._runQueue,e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)),this._tasks.forEach(e=>{e.basePriority===Ud&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)});this._runQueue.length===0;){let e=!1,i=0;if(this._tasks.forEach(r=>{r.needsUpdate&&r.schedulePriority!==0&&r.basePriority!==Ud&&r.blockFrame!==this._frameNumber&&(e=!0,i=Math.max(i,r.basePriority),r.schedulePriority===1?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)}),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do for(;this._runQueue.length>0;){const e=this._budget.now(),i=this._runQueue.pop();this._budget.resetProgress();try{i.task.runTask(this._budget)===Oa&&(i.blockFrame=this._frameNumber)}catch(s){re.getLogger("esri.views.support.Scheduler").error(`Exception in task "${i.name}"`,s),i.blockFrame=this._frameNumber}!this._budget.hasProgressed&&i.blockFrame!==this._frameNumber&&i.needsUpdate&&(i.name,i.blockFrame=this._frameNumber),i.schedulePriority=i.basePriority;const r=this._budget.now()-e;if(i.runtime+=r,this._frameTaskTimes.set(i.priority,this._frameTaskTimes.get(i.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(Tt))this._frameTaskTimes.set(Tt[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach((i,r)=>this.performanceInfo.tasks.get(r).push(i)),this.performanceInfo.total.push(e)}get test(){return this._test}},i0t=class{get task(){return this._task.value}get readyToRun(){return this._queue.readyToRun}get updating(){return this._queue.updating}constructor(e,i,r){this._scheduler=e,this.name=i,this.blockFrame=0,this.runtime=0,this._queue=new Zvt,this._handles=new X0,this._basePriority=I1e(i),this.schedulePriority=this._basePriority,this._task=ta(r??this._queue),this._handles.add(vs(()=>this.task.readyToRun,s=>e.taskRunningChanged(s)))}remove(){this.processQueue(Jl),this._scheduler.removeTask(this),this.schedule=Rw.schedule,this.reschedule=Rw.reschedule,this.scheduleGenerator=Rw.scheduleGenerator,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const i=I1e(e);this._basePriority!==Ud&&this.schedulePriority===0||(this.schedulePriority=i),this._basePriority=i}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.readyToRun||!this.task.destroyed&&this.task.readyToRun}schedule(e,i,r){return this._queue.push(e,i,r)}reschedule(e,i,r){return this._queue.unshift(e,i,r)}scheduleGenerator(e,i,r){return this._queue.pushGenerator(e,i,r)}processQueue(e){return this._queue.runTask(e)}},Zue=class{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(e()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}};const Jl=new Zue;function r0t(t){const e=new Zue;return e.reset(t),e}Jl.enabled=!1;let s0t=class{remove(){}processQueue(){}schedule(e,i,r){try{if(sa(i)){const s=ti();return r?Promise.resolve(r(s)):Promise.reject(s)}return Dee(e(Jl))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}async scheduleGenerator(e,i,r){if(sa(i)){const n=ti();if(r)return r(n);throw n}const s=e(Jl);for(;;){const n=s.next(Jl),a=Ea(n)?await n:n;if(sa(i)){const o=ti();if(r){const u=r(o),d=s.return(null);return Ea(d)&&await bp(d),u}const l=s.throw(o);throw Ea(l)&&await bp(l),o}if(a.done)return a.value}}};const Rw=new s0t;let n0t=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=GFe(),this._schedulerHandle=vs(()=>this._scheduler.updating,()=>this.requestFrame()),this.stationary=!0,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),this.view.animation?.target==null||Ea(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=i=>{if(this._updateRequested=!1,this.view?.destroyed)return;const{allLayerViews:r,graphicsView:s,labelManager:n,state:{id:a}}=this.view;r?.forEach(this._updateLayerView,this),n!=null&&(n.lastUpdateId!==a&&(n.viewChange(),n.lastUpdateId=a),n.updateRequested&&n.processUpdate(this._updateParameters)),s!=null&&(s.lastUpdateId!==a&&(s.viewChange(),s.lastUpdateId=a),s.updateRequested&&s.processUpdate(this._updateParameters)),this.view.graphicsTileStore?.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=0:this.view.interacting?this._scheduler.state=1:this._scheduler.state=2,this._scheduler.frame(i)||this._updateRequested||this._scheduler.state!==2||this._frameTaskHandle?.pause()}}destroy(){this.stop(),this._schedulerHandle.remove(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,targetState:new Hue,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=X(()=>e.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=Hg(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){if(!e.attached)return void this.requestUpdate();const i=this.view.state,r=e.lastUpdateId;r!=null&&(this.stationary||e.moving)||(e.moving=!0),r!==i.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=i.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews?.forEach(this._updateLayerView,this)}};function a0t(t,e){const{spatialReference:i}=e,r=[e.x,e.y];let s,n,a,o;const l=[0,0],u=o0t(t);for(let g=0;g<u.length;g++){const v=u[g];for(let _=0;_<v.length-1;_++){Gat(l,r,v,_);const x=nm(r,l);(s==null||x<s)&&(s=x,n=[...l],a=g,o=_)}}if(s==null||!n||a==null||o==null)throw new q("nearest-coordinate:failed","Failed to find the nearest coordinate");const[d,f]=n;return{coordinate:new Ue({x:d,y:f,spatialReference:i}),distance:s}}function o0t(t){switch(t.type){case"extent":return[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]];case"polygon":return t.rings;case"polyline":return t.paths}}var Gre;let j2=Gre=class extends oue(be){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return Pa(this.geometry,this.spatialReference)}catch(t){return re.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(this.normalizedGeometry==null)return t;const i=t.targetGeometry;if(this.normalizedGeometry.type==="extent"?tF(this.normalizedGeometry,i):mce(this.normalizedGeometry,i))return t;const{coordinate:r}=a0t(this.normalizedGeometry,i);return r&&(t.targetGeometry=r),t}clone(){return new Gre({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};c([p({constructOnly:!0})],j2.prototype,"geometry",void 0),c([p({readOnly:!0})],j2.prototype,"normalizedGeometry",null),c([p({constructOnly:!0})],j2.prototype,"spatialReference",void 0),j2=Gre=c([R("esri.views.2d.constraints.GeometryConstraint")],j2);var Hre;let zD=Hre=class extends oue(be){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e&&(this.rotationEnabled||(t.rotation=e.rotation)),t}clone(){return new Hre({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};c([p()],zD.prototype,"enabled",void 0),c([p()],zD.prototype,"rotationEnabled",void 0),zD=Hre=c([R("esri.views.2d.constraints.RotationConstraint")],zD);const HFe=zD;var Wre;let pu=Wre=class extends oue(be){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:r,minZoom:s,maxZoom:n}=this,a=-1,o=-1,l=!1,u=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!e?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);e=e.map(d=>d.clone()),e.sort((d,f)=>f.scale-d.scale),e.forEach((d,f)=>d.level=f);for(const d of e)!l&&i>0&&i>=d.scale&&(a=d.level,l=!0),!u&&r>0&&r>=d.scale&&(o=t?t.level:-1,u=!0),t=d;s===-1&&(s=i===0?0:a),n===-1&&(n=r===0?e.length-1:o),s=Math.max(s,0),s=Math.min(s,e.length-1),n=Math.max(n,0),n=Math.min(n,e.length-1),s>n&&([s,n]=[n,s]),i=e[s].scale,r=e[n].scale,e.splice(0,s),e.splice(n-s+1),e.forEach((d,f)=>{this._lodByScale[d.scale]=d,this._scales[f]=d.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",n),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,r=this.effectiveMaxScale,s=t.targetGeometry,n=e&&e.targetGeometry,a=r!==0&&t.scale<r,o=i!==0&&t.scale>i;if(a||o){const l=o?i:r;if(e&&n){const u=(l-e.scale)/(t.scale-e.scale);s.x=n.x+(s.x-n.x)*u,s.y=n.y+(s.y-n.y)*u}t.scale=l}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.floor(t),r=Math.ceil(t);return e[i]+(t-i)*(e[r]-e[i])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,r;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let s=0;s<e.length-1;s++){if(i=e[s],r=e[s+1],r===t)return s+this.effectiveMinZoom+1;if(i>t&&r<t)return s+this.effectiveMinZoom+1-(t-r)/(i-r)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new Wre({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e,this._scales[0])),this._lodByScale[t].scale}};c([p({readOnly:!0})],pu.prototype,"effectiveLODs",void 0),c([p({readOnly:!0})],pu.prototype,"effectiveMinZoom",void 0),c([p({readOnly:!0})],pu.prototype,"effectiveMaxZoom",void 0),c([p({readOnly:!0})],pu.prototype,"effectiveMinScale",void 0),c([p({readOnly:!0})],pu.prototype,"effectiveMaxScale",void 0),c([p()],pu.prototype,"lods",void 0),c([p()],pu.prototype,"minZoom",void 0),c([p()],pu.prototype,"maxZoom",void 0),c([p()],pu.prototype,"minScale",void 0),c([p()],pu.prototype,"maxScale",void 0),c([p()],pu.prototype,"snapToZoom",void 0),pu=Wre=c([R("esri.views.2d.constraints.ZoomConstraint")],pu);const WFe=pu,l0t={base:null,key:"type",typeMap:{extent:It,polygon:Wr}};let Un=class extends be{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new ke}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){const e=this._get("_geometry");return e&&this.geometry===e.geometry&&this.view?.constraintsInfo.spatialReference===e.spatialReference?e:new j2({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new HFe({rotationEnabled:this.rotationEnabled})}get _zoom(){const e=this._get("_zoom"),i=this.lods||this.view?.constraintsInfo.lods,r=this.minZoom,s=this.maxZoom,n=this.minScale,a=this.maxScale,o=this.snapToZoom;return e&&e.lods===i&&e.minZoom===r&&e.maxZoom===s&&e.minScale===n&&e.maxScale===a&&e.snapToZoom===o?e:new WFe({lods:i,minZoom:r,maxZoom:s,minScale:n,maxScale:a,snapToZoom:o})}canZoomInTo(e){const i=this.effectiveMaxScale;return i===0||e>=i}canZoomOutTo(e){const i=this.effectiveMinScale;return i===0||e<=i}constrain(e,i){return this._zoom.constrain(e,i),this._rotation.constrain(e,i),this._geometry.constrain(e,i),this.customConstraints.forEach(r=>r.constrain(e,i)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(i=>i.applyPanConstraint?.(e)),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};c([p({readOnly:!0})],Un.prototype,"effectiveLODs",null),c([p({readOnly:!0})],Un.prototype,"effectiveMinScale",null),c([p({readOnly:!0})],Un.prototype,"effectiveMaxScale",null),c([p({readOnly:!0})],Un.prototype,"effectiveMinZoom",null),c([p({readOnly:!0})],Un.prototype,"effectiveMaxZoom",null),c([p({types:l0t,value:null})],Un.prototype,"geometry",null),c([p({type:[ba]})],Un.prototype,"lods",void 0),c([p()],Un.prototype,"minScale",void 0),c([p()],Un.prototype,"maxScale",void 0),c([p()],Un.prototype,"minZoom",void 0),c([p()],Un.prototype,"maxZoom",void 0),c([p()],Un.prototype,"rotationEnabled",void 0),c([p()],Un.prototype,"snapToZoom",void 0),c([p({type:ke})],Un.prototype,"customConstraints",void 0),c([p()],Un.prototype,"view",void 0),c([p({readOnly:!0})],Un.prototype,"version",null),c([p({type:j2,readOnly:!0})],Un.prototype,"_geometry",null),c([p({type:HFe})],Un.prototype,"_rotation",null),c([p({readOnly:!0,type:WFe})],Un.prototype,"_zoom",null),Un=c([R("esri.views.2d.MapViewConstraints")],Un);const L1e=Un;let Dl=class extends be{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([X(()=>this.constraints?.version,i=>{this.constraints&&i&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},Ht)])}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:i}=this.state.paddedViewState;return this.state.commitProperty("id"),new Ue({x:e[0],y:e[1],spatialReference:i})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let i;try{i=this._project(e,this.state.spatialReference)}catch(s){return void re.getLogger(this).error(new q("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:s}))}const r=this.viewpoint;jre(r,r,i),this.viewpoint=r}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void re.getLogger(this).error(new q("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let i;try{i=this._project(e,this.state.spatialReference)}catch(s){return void re.getLogger(this).error(new q("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:s}))}const r=this.viewpoint;Tvt(r,r,i,this.state.size,{constraints:this.constraints}),this.viewpoint=r}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const i=this.viewpoint;Dvt(i,i,e),this.viewpoint=i}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);const r=this._get("extent");return void(r&&(this._set("extent",void 0),this._set("center",r.center)))}const i=this.viewpoint;E1e(i,i,e),this.viewpoint=i}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let i,r;try{i=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?r=new q("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(r=new q("mapview:invalid-viewpoint","geometry not defined"))}catch(n){r=new q("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:n})}if(r)return void re.getLogger(this).error(r);this._scaleBeforeChangingSpatialReference=null;const s=new ys({targetGeometry:new Ue,scale:0,rotation:0});Yl(s,i),this.constraints?.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this._set("viewpoint",s)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){return this.ready?this.constraints?.scaleToZoom(this.scale)??-1:this._get("zoom")}set zoom(e){if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);const s=this._get("extent");return void(s&&(this._set("extent",void 0),this._set("center",s.center)))}const i=this.constraints?.zoomToScale(e)??0;if(!i)return void this._set("zoom",-1);const r=this.viewpoint;E1e(r,r,i),this.viewpoint=r,this._set("zoom",this.constraints?.scaleToZoom(this.scale)??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};const{padding:i,constraints:r}=this,s=this._get("center"),n=this._get("extent"),a=this._get("scale"),o=this._get("rotation"),l=this._get("viewpoint"),u=this._get("zoom"),d=u!=null&&r!=null&&r.zoomToScale(u)||void 0;let f,g,v;const _=l?.rotation,x=l?.targetGeometry;x?.type==="extent"?f=x:x?.type==="point"&&(g=x,v=l?.scale);const S=n??f;return{center:s??g??S?.center,rotation:o??_,scale:(a??d??v??(S&&j7(S,[e[0]-i.left-i.right,e[1]-i.top-i.bottom])))||void 0}}startup(e,i,r,s){const n=e.targetGeometry;try{this._project(e,r)}catch(a){re.getLogger(this).warn(new Gu("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:n.toJSON(),spatialReference:r,error:a})),e.targetGeometry=s||new Ue({x:0,y:0,spatialReference:r})}this.constraints?.fit(e),this._set("state",new Hue({padding:this.padding,size:i,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);const{center:[e,i],spatialReference:r,rotation:s,scale:n}=this.state.paddedViewState,a=new Ue({x:e,y:i,spatialReference:r});this._set("viewpoint",null),this._set("extent",null),this._set("center",a),this._set("zoom",-1),this._set("rotation",s),this._set("scale",n),this._set("state",null)}changeSpatialReference(e){const i=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=i.scale;else{const l=i.viewpoint.clone();l.scale=this._scaleBeforeChangingSpatialReference,i.viewpoint=l}const r=i.clone(),[s,n]=i.center;let a=null;try{a=this._project(new Ue({x:s,y:n,spatialReference:i.spatialReference}),e)}catch(l){ace()||re.getLogger(this).warn(new Gu("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:a?.toJSON(),spatialReference:e,error:l}))}a||(a=new Ue({x:0,y:0,spatialReference:e}));const o=jre(new ys({targetGeometry:new Ue,scale:0,rotation:0}),i.viewpoint,a);r.viewpoint=o;try{const u=[i.size[0]/2,i.size[1]/2],d=[u[0]+20,u[1]],f=i.toMap([0,0],d),{x:g,y:v}=this._project(new Ue({x:f[0],y:f[1],spatialReference:i.spatialReference}),e);f[0]=g,f[1]=v,r.toScreen(f,f);const _=Pvt(u,f,d),x=Math.hypot(f[0]-u[0],f[1]-u[1])/20;!Number.isFinite(x)||Math.abs(x)>4?(o.rotation=0,o.targetGeometry=new Ue({x:0,y:0,spatialReference:e})):(o.scale*=x,o.scale>ie("mapview-srswitch-adjust-rotation-scale-threshold")?o.rotation=0:o.rotation+=Number.isFinite(_)?_:0)}catch{}this._get("constraints")?.constrain(o,void 0),this._get("state").viewpoint=o}resize(e,i){if(!this.ready)return;const r=this.state;let s=this.state.paddedViewState.viewpoint;const n=this.state.paddedViewState.size.slice();r.size=[e,i],Ivt(s,s,n,this.state.paddedViewState.size,this.resizeAlign),s=this.constraints?.constrain(s,void 0)??s,this.state.viewpoint=s}toMap(e){if(!this.ready)return null;const i=[0,0],[r,s]=this.state.toMap(i,[e.x,e.y]),n=this.state.spatialReference;return new Ue({x:r,y:s,spatialReference:n})}toScreen(e,i){if(!this.ready)return null;const r=this._project(e,this.state.spatialReference),s=[r.x,r.y];return i?.pickClosestTarget===!1||this.state.paddedViewState.wrapMapCoordinate(s,s),this.state.toScreen(s,s),ia(s[0],s[1])}_project(e,i){const r=e?.targetGeometry||e;if(!i)return e;if(!r)return null;if(i.imageCoordinateSystem||r.spatialReference?.imageCoordinateSystem||zr(i,r.spatialReference))return e;const s=Pa(r,i);if(!s)throw new q("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:r,spatialReference:i});return c0t(e)?(e.targetGeometry=s,e):s}};function c0t(t){return t?.declaredClass==="esri.Viewpoint"}c([p({type:Ue})],Dl.prototype,"center",null),c([p()],Dl.prototype,"constraints",void 0),c([p({type:It})],Dl.prototype,"extent",null),c([p({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],Dl.prototype,"padding",null),c([p()],Dl.prototype,"ready",void 0),c([p()],Dl.prototype,"resizeAlign",void 0),c([p({readOnly:!0})],Dl.prototype,"resolution",null),c([p({type:Number})],Dl.prototype,"rotation",null),c([p({type:Number})],Dl.prototype,"scale",null),c([p({readOnly:!0})],Dl.prototype,"state",void 0),c([p({type:ys})],Dl.prototype,"viewpoint",null),c([p({readOnly:!0})],Dl.prototype,"visibleArea",null),c([p()],Dl.prototype,"zoom",null),Dl=c([R("esri.views.2d.ViewStateManager")],Dl);const F1e=160;let ND=class extends be{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=F1e&&this.clear()},F1e))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};c([p()],ND.prototype,"_timer",void 0),c([p()],ND.prototype,"stationary",null),ND=c([R("esri.views.2d.support.StationaryManager")],ND);const u0t=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.fullOpacity=1,this.stateManager=new Dl({constraints:new L1e({view:this})}),this.stationaryManager=new ND,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!1,labelsAnimationTime:0,labelCollisionsEnabled:!1},this.frameTask=new n0t(this),this.viewEvents=new XLe(this),this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([X(()=>this.viewpoint,()=>this.stationaryManager.flip(),Ht)])}get constraintsInfo(){return{lods:null,spatialReference:null}}get extent(){return this.stateManager?.extent??null}set extent(r){this.stateManager.extent=r}get state(){return this.stateManager.state}get interacting(){return!1}get stationary(){return!this.animation&&this.stationaryManager.stationary}set animation(r){const s=this._get("animation");if(r===s)return;if(s&&s.stop(),r!==this.animationManager.animation&&this.animationManager.stop(),!r||r.isFulfilled())return void this._set("animation",null);this._set("animation",r);const n=()=>{this.destroyed||r===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame())};r.when(n,n)}get constraints(){return this.stateManager?.constraints}set constraints(r){r.view=this;const s=this.stateManager.constraints;this.stateManager.constraints=r,s?.destroy()}get padding(){return this.stateManager?.padding}set padding(r){this.stateManager&&(this.stateManager.padding=r)}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(r){this.stateManager.resizeAlign=r}get rotation(){return this.stateManager.rotation??0}set rotation(r){const{rotationEnabled:s}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=r,this.constraints.rotationEnabled=s}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(r){this.stateManager.viewpoint=r,this.frameTask.requestFrame()}};return c([p({readOnly:!0})],i.prototype,"animationManager",void 0),c([p({readOnly:!0})],i.prototype,"fullOpacity",void 0),c([p()],i.prototype,"stateManager",void 0),c([p()],i.prototype,"constraintsInfo",null),c([p()],i.prototype,"extent",null),c([p({readOnly:!0})],i.prototype,"state",null),c([p({readOnly:!0})],i.prototype,"mapViewNavigation",void 0),c([p()],i.prototype,"renderingOptions",void 0),c([p({readOnly:!0})],i.prototype,"interacting",null),c([p()],i.prototype,"stationary",null),c([p()],i.prototype,"animation",null),c([p({type:L1e})],i.prototype,"constraints",null),c([p()],i.prototype,"padding",null),c([p()],i.prototype,"resizeAlign",null),c([p()],i.prototype,"rotation",null),c([p({readOnly:!0})],i.prototype,"viewEvents",void 0),c([p({type:ys})],i.prototype,"viewpoint",null),i=c([R("esri.views.Viewport2DBaseMixin")],i),i},h0t=()=>fr.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;var kA;let BM=(kA=class extends aue{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Eo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new q("view:animation-stopped","ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,i){i||(i=Ea(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}},kA.state={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"},kA);c([p({readOnly:!0})],BM.prototype,"done",null),c([p({readOnly:!0,type:String})],BM.prototype,"state",void 0),c([p()],BM.prototype,"target",void 0),BM=c([R("esri.views.ViewAnimation")],BM);const j0=BM;let IU=class extends be{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,i){if(!e)return void re.getLogger(this).error("#goTo()","target cannot be null or undefined");const r=new j0;this.view.animation=r,await qu(()=>this.view.ready,i);const s={...i,animate:i?.animate??(!h0t()&&this.view.animationsEnabled),animationMode:i?.animationMode??"auto"},{extent:n,spatialReference:a,size:o,viewpoint:l,constraints:u,padding:d,allLayerViews:f}=this.view,g=wvt(e,{extent:n,spatialReference:a,size:o,viewpoint:l,constraints:u,padding:d,allLayerViews:f,pickClosestTarget:i?.pickClosestTarget??!0});return r?.update(g),this._gotoTask={},s.animate?this._gotoAnimated(g,s):this._gotoImmediate(g,s)}_gotoImmediate(e,i){const r=this._gotoTask,s=this.view.animation,n=e.then(a=>{if(ct(i),r!==this._gotoTask)throw new q("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=a,s.finish()});return this._cancellableGoTo(r,s,n,i)}_gotoAnimated(e,i){const r=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();const n=e.then(a=>{if(ct(i),r!==this._gotoTask)throw new q("view:goto-interrupted","Goto was interrupted");return s.update(a),this.view.animationManager.animate(s,this.view.viewpoint,i),s.when().then(()=>{},()=>{})});return this._cancellableGoTo(r,s,n,i)}_cancellableGoTo(e,i,r,s){const n=()=>e===this._gotoTask;return A0(r,s).finally(()=>{n()&&(i.done||i.stop())})}};c([p({constructOnly:!0})],IU.prototype,"view",void 0),IU=c([R("esri.views.2d.GoToManager")],IU);function Yue(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function ZFe(t,e){return e.some(i=>Yue(t,i))}function Jue(t,e){const{button:i,pointerType:r}=t;return r!=="touch"&&e.some(s=>s==="primary"&&i===0||s==="secondary"&&i===2||s==="tertiary"&&i===1)}function k4(t,{dragPrimary:e,dragSecondary:i,dragTertiary:r}){return[{key:"primary",value:e},{key:"secondary",value:i},{key:"tertiary",value:r}].filter(s=>s.value===t).map(s=>s.key)}let z1e=class extends _s{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(e,i){Yue(e.data,"primary")&&(e.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},d0t=class extends _s{constructor(e,i,r){super(!0),this.view=e,this.pointerType=i,this.registerIncoming("double-tap-drag",r,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(e){const{data:i}=e,{pointerType:r}=i;if(r!==this.pointerType)return;e.stopPropagation();const{action:s,delta:n}=i,{view:a}=this,{mapViewNavigation:o}=a;switch(s){case"begin":{const{scale:l}=a;this._startScale=l,this._currentScale=l,this._previousDelta=n,o.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;const l=1.015**n.y,u=this._startScale*l,d=u/this._currentScale;o.setViewpointImmediate(d),this._currentScale=u;break}case"end":{const{constraints:l}=a,{effectiveLODs:u,snapToZoom:d}=l;if(!d||!u)return void o.end();const f=l.snapScale(this._currentScale),g=(n.y>0?Math.max(f,l.snapToPreviousScale(this._startScale)):Math.min(f,l.snapToNextScale(this._startScale)))/this._currentScale;o.zoom(g).then(()=>{o.end()});break}}}},$F=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},p0t=class extends _s{constructor(e,i,r){super(!0),this.view=e,this.pointerActions=i,this.registerIncoming("drag",r,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new $F({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&ZFe(r.data,this.pointerActions)})}_handleDrag(e){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},f0t=class extends _s{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i;const s=this._view.mapViewNavigation;this._dragEventSeparator=new $F({start:(n,a)=>{s.rotate.begin(this._view,a.data),a.stopPropagation()},update:(n,a)=>{s.rotate.update(this._view,a.data),a.stopPropagation()},end:(n,a)=>{s.rotate.end(),a.stopPropagation()},condition:(n,a)=>n===1&&ZFe(a.data,this.pointerActions)}),this.registerIncoming("drag",r,n=>this._dragEventSeparator.handle(n))}};function Ve(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function me(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function xe(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function $e(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Ae(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Que(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function YFe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function m0t(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function JFe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function FO(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function QFe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function XFe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function KFe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function g0t(t,e=0,i=1){return t[0]=Math.min(Math.max(t[0],e),i),t[1]=Math.min(Math.max(t[1],e),i),t[2]=Math.min(Math.max(t[2],e),i),t}function y0t(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function he(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Fr(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Bi(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function Mn(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function ea(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function fp(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function v0t(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Re(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function Le(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function At(t,e,i){const r=e[0],s=e[1],n=e[2],a=i[0],o=i[1],l=i[2];return t[0]=s*l-n*o,t[1]=n*a-r*l,t[2]=r*o-s*a,t}function _0t(t,e,i){const r=e[0],s=e[1],n=e[2],a=i[0],o=i[1],l=i[2],u=s*l-n*o,d=n*a-r*l,f=r*o-s*a,g=Math.sqrt(u*u+d*d+f*f);return t[0]=u/g,t[1]=d/g,t[2]=f/g,t}function cr(t,e,i,r){const s=e[0],n=e[1],a=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=a+r*(i[2]-a),t}function b0t(t,e,i,r,s,n){const a=n*n,o=a*(2*n-3)+1,l=a*(n-2)+n,u=a*(n-1),d=a*(3-2*n);return t[0]=e[0]*o+i[0]*l+r[0]*u+s[0]*d,t[1]=e[1]*o+i[1]*l+r[1]*u+s[1]*d,t[2]=e[2]*o+i[2]*l+r[2]*u+s[2]*d,t}function w0t(t,e,i,r,s,n){const a=1-n,o=a*a,l=n*n,u=o*a,d=3*n*o,f=3*l*a,g=l*n;return t[0]=e[0]*u+i[0]*d+r[0]*f+s[0]*g,t[1]=e[1]*u+i[1]*d+r[1]*f+s[1]*g,t[2]=e[2]*u+i[2]*d+r[2]*f+s[2]*g,t}function x0t(t,e=1){const i=sF,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function Ft(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function Ql(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function Eu(t,e,i){const r=i[0],s=i[1],n=i[2],a=i[3],o=e[0],l=e[1],u=e[2],d=s*u-n*l,f=n*o-r*u,g=r*l-s*o,v=s*g-n*f,_=n*d-r*g,x=r*f-s*d,S=2*a;return t[0]=o+d*S+2*v,t[1]=l+f*S+2*_,t[2]=u+g*S+2*x,t}function S0t(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function T0t(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function $0t(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function eze(t,e){Re(N1e,t),Re(V1e,e);const i=Le(N1e,V1e);return i>1?0:i<-1?Math.PI:Math.acos(i)}const N1e=I(),V1e=I();function C0t(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function di(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function m1(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],a=e[1],o=e[2],l=_n();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-a)<=l*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-o)<=l*Math.max(1,Math.abs(s),Math.abs(o))}function L1(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let a=r*r+s*s+n*n;return a>0?(a=1/Math.sqrt(a),t[0]=r*a,t[1]=s*a,t[2]=n*a,t):(t[0]=0,t[1]=0,t[2]=0,t)}const xi=Ae,M0t=Que,E0t=YFe,CF=Bi,zO=Mn,Ph=Ve,r$=ea,j1e=Object.freeze(Object.defineProperty({__proto__:null,abs:FO,add:$e,angle:eze,bezier:w0t,ceil:m0t,clamp:g0t,copy:me,cross:At,crossAndNormalize:_0t,direction:L1,dist:CF,distance:Bi,div:E0t,divide:YFe,dot:Le,equals:m1,exactEquals:di,floor:JFe,hermite:b0t,inverse:v0t,len:Ph,length:Ve,lerp:cr,max:KFe,min:XFe,mul:M0t,multiply:Que,negate:fp,normalize:Re,random:x0t,rotateX:S0t,rotateY:T0t,rotateZ:$0t,round:y0t,scale:he,scaleAndAdd:Fr,set:xe,sign:QFe,sqrDist:zO,sqrLen:r$,squaredDistance:Mn,squaredLength:ea,str:C0t,sub:xi,subtract:Ae,transformMat3:Ql,transformMat4:Ft,transformQuat:Eu},Symbol.toStringTag,{value:"Module"}));function Yp(t){let e=t*t;return t<0&&(e*=-1),e}function A0t(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function Zre(t,e,i){const r=i,s=t.state,n=t.device,a=e.tiltDirection==="forward-down"?1:-1,o=1;return n.deviceType==="standard"?(r.translation[0]=Yp(s.axes[0]),r.translation[1]=Yp(s.axes[1]),r.translation[2]=Yp(s.buttons[7])-Yp(s.buttons[6]),r.heading=Yp(s.axes[2]),r.tilt=Yp(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Yp(s.axes[0]),r.translation[1]=1.2*Yp(s.axes[1]),r.translation[2]=2*-Yp(s.axes[2]),r.heading=1.2*Yp(s.axes[5]),r.tilt=1.2*Yp(s.axes[3])),r.tilt*=a,he(r.translation,r.translation,o),r}function U1e(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function DU(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let O0t=class extends _s{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new X0,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([X(()=>this._view.navigation.gamepad?.enabled,i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=Hg({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},Yt)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const i=this._view.navigation.gamepad.device;i&&e.data.device!==i||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,A0t(this._transformation)):(this._currentDevice=e.data.device,Zre(e.data,this._view.navigation.gamepad,this._transformation)),this._frameTask?.resume())}_frameUpdate(e){const i=this._transformation;if(DU(i))return void this._frameTask?.pause();const r=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,n=R0t*s*e;U7(r,r,[i.translation[0]*n,-i.translation[1]*n]);const a=1+i.translation[2]*I0t*e,o=this._view.constraints.rotationEnabled?-i.heading*P0t*e:0,l=this._view.size,u=[l[0]/2,l[1]];DFe(r,r,a,o,u,l);const d=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=d}};const P0t=.06,R0t=.7,I0t=6e-4;function Xue(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),bi(()=>document.removeEventListener("visibilitychange",e))}let D0t=class extends _s{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=s=>{const n=this._keyMap[s.data.key];if(s.modifiers.has("Meta")||s.modifiers.has("Control"))return void this._stopMovement();if(n==null)return;s.stopPropagation(),s.preventDefault();const a=s.type==="key-down";if(this._pressedKeys[a?"add":"delete"](n),a){if(this._direction===n)return;this._direction=n,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{const o=this._timeout===void 0,l=this._pressedKeys.size>0;o||l?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,this._handleKey),this.registerIncoming("key-up",r,this._handleKey),this.registerIncoming("blur",r,this._stopMovement),this._visibilityHandle=Xue(s=>s?null:this._stopMovement())}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(e){const i=this._currentDirection!=null;if(e!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==e)switch(e){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=e}_setTimeout(e){clearTimeout(this._timeout),this._timeout=e===void 0?void 0:setTimeout(()=>{this._timeout=void 0,e()},this._stickyKeyDuration)}},k0t=class extends _s{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keyToDirection=new Map,this._pressed=!1,this._addKeysMapping(i),this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleStop()),this._visibilityHandle=Xue(s=>s?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_addKeysMapping(e){this._addKeyMapping(e.clockwise,"clockwise"),this._addKeyMapping(e.counterClockwise,"counterClockwise"),this._addKeyMapping(e.reset,"reset")}_addKeyMapping(e,i){for(const r of e)this._keyToDirection.set(r,i)}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=e.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection.get(e.data.key);if(this._pressed=s!=null,this._pressed){if(e.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}},L0t=class extends _s{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),i.zoomIn.forEach(s=>this._keysToZoomAction[s]=0),i.zoomOut.forEach(s=>this._keysToZoomAction[s]=1)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const i=e.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:r}=e.data;if(!(r in this._keysToZoomAction))return;const s=this._keysToZoomAction[r],{mapViewNavigation:n}=this.view;let a=null;switch(s){case 0:a=n.zoomIn();break;case 1:a=n.zoomOut();break;default:return}n.begin(),a.then(()=>n.end()),e.stopPropagation()}};const F0t=.6;let z0t=class extends _s{constructor(e,i){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(this._view.navigation.actionMap.mouseWheel!=="zoom"||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const i=this._view.mapViewNavigation,{x:r,y:s,deltaY:n}=e.data,a=1/F0t**(1/60*n),o=i.zoom(a,[r,s]);this._canZoom=!1,o.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()})}},N0t=class extends _s{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const i=this.view.mapViewNavigation;this._dragEventSeparator=new $F({start:(r,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(r,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(r,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:r=>r>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function B1e(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>U0t(i,t.axisThreshold))}:{buttons:[],axes:[]}}function V0t(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function j0t(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function U0t(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let B0t=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const a=n.gamepad,o=a.index,l=this._inputDevices[o];l&&(this._emitGamepadEvent(a,B1e(l),!1),this._inputDevices.splice(o,1),this._latestUpdate.splice(o,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(q1e(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new Lue(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=Hg({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;q1e(s=>{const n=this._inputDevices[s.index];if(!n)return;const a=this._latestUpdate[s.index],o=B1e(n),l=r||j0t(o);a&&(a.timestamp===s.timestamp||!a.active&&l||V0t(a.state,o))||this._emitGamepadEvent(s,o,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const a=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:a})}};function q0t(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function q1e(t){for(const e of navigator.getGamepads())q0t(e)&&t(e)}const G1e=ie("edge"),G0t=ie("chrome"),H0t=ie("ff"),W0t=ie("safari"),H1e="esri-view-surface",EC={touchNone:`${H1e}--touch-none`,touchPan:`${H1e}--touch-pan`};var JS;let tze=(JS=class{constructor(e,i){this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new B0t(e,i),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>this._releasePointerCaptureSafe(e)),this._activePointerCaptures.clear(),this._gamepadSource=Pe(this._gamepadSource),this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(jJ[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&jJ[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(jJ[i],r),this._active[i]=r}}),this._gamepadSource&&(this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1)}setPointerCapture(e,i){i?this._setPointerCaptureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?EC.touchNone:EC.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?EC.touchPan:EC.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(EC.touchNone),this._element.classList.remove(EC.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCaptureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=iFe(this._element,e);return JS.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_getDeltaFromTrackpadOrMouseWheel(e){return e.shiftKey&&ie("mac")&&e.deltaY===0?e.deltaX:e.deltaY}_handleMouseWheel(e,i){let r=this._getDeltaFromTrackpadOrMouseWheel(i);switch(i.deltaMode){case 0:G1e&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}G1e?r*=.7:G0t||W0t?r*=.6:H0t&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const a=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,a)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}},JS.test={disableSubpixelCoordinates:!1},JS);const jJ={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let ize=class extends _s{constructor(){super(!0),this.registerIncoming("context-menu",e=>e.data.native.preventDefault())}};const rze=()=>({maximumClickDelay:300}),Z0t=(t={})=>({...rze(),movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,...t}),Kue=(t={})=>({...rze(),maximumDoubleClickDistance:10,maximumDoubleTouchDistance:35,maximumDoubleClickDelay:250,maximumDoubleTouchDelay:350,...t});function Fq(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Y0t(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function J0t(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:ia()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[E,P]=t,[O,D]=[P.x-E.x,P.y-E.y];return e.radius=Math.sqrt(O*O+D*D)/2,e.center.x=(E.x+P.x)/2,e.center.y=(E.y+P.y)/2,e}let i=0,r=0;for(let E=0;E<t.length;E++)i+=t[E].x,r+=t[E].y;i/=t.length,r/=t.length;const s=t.map(E=>E.x-i),n=t.map(E=>E.y-r);let a=0,o=0,l=0,u=0,d=0,f=0,g=0;for(let E=0;E<s.length;E++){const P=s[E],O=n[E],D=P*P,L=O*O;a+=D,o+=L,l+=P*O,u+=D*P,d+=L*O,f+=P*L,g+=O*D}const v=.5*(u+f),_=.5*(d+g),x=a*o-l*l,S=(v*o-_*l)/x,T=(a*_-l*v)/x,M=ia(S+i,T+r);return{radius:Math.sqrt(S*S+T*T+(a+o)/t.length),center:M}}function zS(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let Q0t=class extends _s{constructor(e={},i=m$){super(!1),this._clock=i,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=ia(0,0),this._pointerState=new Map,this._parameters=Kue(e),this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new $F({start:(r,s)=>this._dragStart(r,s),update:(r,s)=>this._dragUpdate(s),end:(r,s)=>this._dragEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r)),this.registerIncoming("pointer-down",r=>this._handlePointerDown(r)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=Xi(e.doubleTapTimeout)})}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleTapTimeout!=null)return!0;return!1}_clearPointerDown(e){const i=this._pointerState.get(e);i&&(i.doubleTapTimeout=Xi(i.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_dragStart(e,i){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:r,modifiers:s}=i,{center:n}=r;this._dragStartCenter=n;const a=UJ("begin",ia(0,0),r);this._doubleTapDrag.emit(a,void 0,s),i.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=UJ("update",ia(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(n,void 0,r),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=UJ("end",ia(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(n,void 0,r),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:i}=e,r=zS(i),s=this._pointerState.get(r),{pointerType:n}=i.native;if(s){const a=n==="touch"?this._parameters.maximumDoubleTouchDistance:this._parameters.maximumDoubleClickDistance;this._clearPointerDown(r),Fq(s.event.data,i)>a?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:i}=e,{pointerType:r}=i.native,s=zS(i),n=r==="touch"?this._parameters.maximumDoubleTouchDelay:this._parameters.maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._clearPointerDown(s),n);this._pointerState.set(s,{event:e,doubleTapTimeout:a}),this.refreshHasPendingInputs()}};function UJ(t,e,i){const{button:r,buttons:s,pointer:n,pointers:a,pointerType:o,timestamp:l}=i;return{action:t,delta:e,button:r,buttons:s,pointer:n,pointers:a,pointerType:o,timestamp:l}}let sze=class extends _s{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:X0t(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=XN(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=kU(s,nze(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=XN(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=XN(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=kU(r,i)-e,r.lastAngle=kU(r,i)-e})}_emitEvent(e,i,r){const s=XN(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function nze(t){const e=[];return t.forEach(i=>{e.push(ia(i.event.x,i.event.y))}),J0t(e)}function XN(t){const e=nze(t);let i=0;return t.forEach(r=>{let s=kU(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const a=s-r.initialAngle;i+=a}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function X0t(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function kU(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}let aze=class extends _s{constructor(e={},i=m$){super(!1),this._clock=i,this._pointerState=new Map,this._parameters=Kue(e),this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=zS(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=zS(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,a=e.data.native.pointerType==="touch"?this._parameters.maximumDoubleTouchDistance:this._parameters.maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),Fq(n,e.data)>a?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):Fq(s,e.data)>a?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._parameters.maximumDoubleTouchDelay:this._parameters.maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=zS(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},oze=class extends _s{constructor(e={},i=m$){super(!1),this._clock=i,this._pointerState=new Map,this._parameters=Z0t(e),this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",r=>this._handlePointerDown(r)),this.registerIncoming("pointer-up",r=>this._handlePointerLoss(r,"pointer-up")),this.registerIncoming("pointer-capture-lost",r=>this._handlePointerLoss(r,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",r=>this._handlePointerLoss(r,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",r=>this._handlePointerMove(r)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Xi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const a=this._pointerState.get(r);if(a){if(!a.isDragging){const o=a.previousEvent;this._pointerHold.emit(o,void 0,e.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._parameters.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(KN("update",s,i),void 0,s.modifiers):Y0t(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._parameters.movementUntilTouchDrag;case"pen":return this._parameters.movementUntilPenDrag;default:return this._parameters.movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(KN("start",s,i)):this._pointerDrag.emit(KN("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(KN("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._parameters.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function KN(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let lze=class extends _s{constructor(e={},i=m$){super(!1),this._clock=i,this._pointerState=new Map,this._parameters=Kue(e),this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",r=>this._handleImmediateClick(r)),this.registerIncoming("pointer-down",r=>this._handlePointerDown(r))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Xi(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Xi(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=K0t(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:a,modifiers:o}=n.event,l=r==="touch"?this._parameters.maximumDoubleTouchDistance:this._parameters.maximumDoubleClickDistance;Fq(a,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(a,void 0,o))}_handlePointerDown(e){const i=zS(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=zS(i),n=r==="touch"?this._parameters.maximumDoubleTouchDelay:this._parameters.maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:e,doubleClickTimer:a,pointerDownCount:1}),this.refreshHasPendingInputs()}};function K0t(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}const eV={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwise:["a","A"],counterClockwise:["d","D"],reset:["n","N"]}},W1e=Symbol("handles");let qM=class extends be{initialize(){const e=()=>this.view?.ready;this.addHandles([vs(()=>!e(),()=>this._disconnect()),vs(e,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerInfo(){return this._inputManager?.latestPointerInfo}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_disconnect(){this.view.viewEvents.disconnect(),this.removeHandles(W1e),this._inputManager=Pe(this._inputManager)}_connect(){const e=this.view.surface,i=new tze(e,this.view.input),r=[new aze,new oze,new lze,new sze(this.view.navigation),new Q0t],s=new zd({eventSource:i,recognizers:r}),n=new p0t(this.view,["primary"]),a=new f0t(this.view,["secondary"]);s.installHandlers("prevent-context-menu",[new ize],Br.INTERNAL),s.installHandlers("navigation",[new N0t(this.view),new O0t(this.view),new z0t(this.view),new z1e(this.view),new z1e(this.view,[eV.counter]),n,new D0t(this.view,eV.pan),new L0t(this.view,eV.zoom),new k0t(this.view,eV.rotate),a,new d0t(this.view,"touch")],Br.INTERNAL),this.view.viewEvents.connect(s),this._source=i,this._inputManager=s,this.addHandles([X(()=>this.view?.navigation?.browserTouchPanEnabled,o=>{this._source&&(this._source.browserTouchPanningEnabled=!o)},Yt),X(()=>{const{actionMap:o}=this.view.navigation;return{panActions:k4("pan",o),rotateActions:k4("rotate",o)}},({panActions:o,rotateActions:l})=>{n.pointerActions=o,a.pointerActions=l},bt)],W1e)}get test(){}};c([p()],qM.prototype,"view",void 0),c([p()],qM.prototype,"latestPointerInfo",null),c([p()],qM.prototype,"multiTouchActive",null),qM=c([R("esri.views.2d.input.MapViewInputManager")],qM);const e_t=qM,t_t=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.goToManager=new IU({view:this}),this.animationsEnabled=!0,this.inputManager=new e_t({view:this}),this.addHandles([this.on("resize",s=>this.stateManager.resize(s.width,s.height))])}get interacting(){return this.navigating}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}on(r,s,n,a){return this.viewEvents.on(r,s,n,a)||super.on(r,s)}hasEventListener(r){return super.hasEventListener(r)||this.viewEvents.hasHandler(r)}goTo(r,s){return this.goToManager.goTo(r,s)}toMap(r){if(!this.ready)return null;const s=kq(r)?Dq(this,r):r;return this.stateManager.toMap(s)}};return c([p()],i.prototype,"goToManager",void 0),c([p({readOnly:!0})],i.prototype,"interacting",null),c([p()],i.prototype,"stationary",null),c([p()],i.prototype,"animationsEnabled",void 0),c([p({readOnly:!0})],i.prototype,"inputManager",void 0),i=c([R("esri.views.Viewport2DMixin")],i),i};let Z1e=class{constructor(e){this._view=e,this.viewpoint=new ys({targetGeometry:new Ue,scale:0,rotation:0})}get view(){return this._view}get size(){const[e,i]=this._view.size;return Math.sqrt(e*e+i*i)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return RFe(this.center.spatialReference)}pixelsPerPanAtZoom(e){return 1/(e*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(e){return 1/(e*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(e,i){i.pan=gIe(this.center,e.center);let r=Math.abs(e.rotation-this.rotation);r=r>=180?360-r:r,i.rotate=zt(r),i.sourceZoom=this.scale,i.targetZoom=e.scale}interpolate(e,i,r){const{pan:s,rotate:n,zoom:a,zoomOffset:o}=r,{center:l}=this;l.spatialReference=e.center.spatialReference,l.x=yt(e.center.x,i.center.x,s),l.y=yt(e.center.y,i.center.y,s),this.viewpoint.scale=yt(e.scale,i.scale+o,a);let u=e.rotation;const d=i.rotation;Math.abs(d-u)>=180&&(u+=360*(u<d?1:-1)),this.viewpoint.rotation=yt(u,d,n)}copyFrom(e){Yl(this.viewpoint,e.viewpoint),this._view=e.view}};function tI(t,e,i,r){const s=3*t,n=3*(i-t)-s,a=1-s-n,o=3*e,l=3*(r-e)-o,u=1-o-l;function d(_){return((a*_+n)*_+s)*_}function f(_){return((u*_+l)*_+o)*_}function g(_){return(3*a*_+2*n)*_+s}function v(_,x){let S,T,M,E,P,O;for(M=_,O=0;O<8;O++){if(E=d(M)-_,Math.abs(E)<x)return M;if(P=g(M),Math.abs(P)<1e-6)break;M-=E/P}if(S=0,T=1,M=_,M<S)return S;if(M>T)return T;for(;S<T;){if(E=d(M),Math.abs(E-_)<x)return M;_>E?S=M:T=M,M=.5*(T-S)+S}return M}return function(_,x=1e-6){return f(v(_,x))}}const Gd={};Gd.ease=tI(.25,.1,.25,1),Gd.linear=tI(0,0,1,1),Gd.easeIn=Gd["ease-in"]=tI(.42,0,1,1),Gd.easeOut=Gd["ease-out"]=tI(0,0,.58,1),Gd.easeInOut=Gd["ease-in-out"]=tI(.42,0,.58,1);const i_t=t=>t,G5=t=>t*t,zq=t=>1-G5(1-t),Y1e=t=>t<.5?G5(2*t)/2:(zq(2*(t-.5))+1)/2,Nq=t=>t*t*t,Yre=t=>1-Nq(1-t),Jre=t=>t<.5?Nq(2*t)/2:(Yre(2*(t-.5))+1)/2,Vq=t=>t*t*t*t,Qre=t=>1-Vq(1-t),J1e=t=>t<.5?Vq(2*t)/2:(Qre(2*(t-.5))+1)/2,jq=t=>t*t*t*t*t,Xre=t=>1-jq(1-t),Q1e=t=>t<.5?jq(2*t)/2:(Xre(2*(t-.5))+1)/2,Uq=t=>1-Math.cos(t*Math.PI/2),Kre=t=>1-Uq(1-t),X1e=t=>t<.5?Uq(2*t)/2:(Kre(2*(t-.5))+1)/2,Bq=t=>2**(10*(t-1)),NO=t=>1-Bq(1-t),K1e=t=>t<.5?Bq(2*t)/2:(NO(2*(t-.5))+1)/2,qq=t=>-(Math.sqrt(1-t*t)-1),ese=t=>1-qq(1-t),exe=t=>t<.5?qq(2*t)/2:(ese(2*(t-.5))+1)/2;function Ap(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Op(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const txe=Op(Ap(1),1),ixe=Op(Ap(1),0),Gq=Op(Ap(1),.5),rxe=Op(Ap(2),1),sxe=Op(Ap(2),0),nxe=Op(Ap(2),.5),axe=Op(Ap(3),1),oxe=Op(Ap(3),0),lxe=Op(Ap(3),.5),cxe=Op(Ap(4),1),uxe=Op(Ap(4),0),hxe=Op(Ap(4),.5),tse={linear:i_t,"in-quad":G5,"out-quad":zq,"in-out-quad":Y1e,"in-coast-quad":txe,"out-coast-quad":ixe,"in-out-coast-quad":Gq,"in-cubic":Nq,"out-cubic":Yre,"in-out-cubic":Jre,"in-coast-cubic":rxe,"out-coast-cubic":sxe,"in-out-coast-cubic":nxe,"in-quart":Vq,"out-quart":Qre,"in-out-quart":J1e,"in-coast-quart":axe,"out-coast-quart":oxe,"in-out-coast-quart":lxe,"in-quint":jq,"out-quint":Xre,"in-out-quint":Q1e,"in-coast-quint":cxe,"out-coast-quint":uxe,"in-out-coast-quint":hxe,"in-sine":Uq,"out-sine":Kre,"in-out-sine":X1e,"in-expo":Bq,"out-expo":NO,"in-out-expo":K1e,"in-circ":qq,"out-circ":ese,"in-out-circ":exe,"quad-in":G5,"quad-out":zq,"quad-in-out":Y1e,"quad-in-coast":txe,"quad-out-coast":ixe,"quad-in-out-coast":Gq,"cubic-in":Nq,"cubic-out":Yre,"cubic-in-out":Jre,"cubic-in-coast":rxe,"cubic-out-coast":sxe,"cubic-in-out-coast":nxe,"quart-in":Vq,"quart-out":Qre,"quart-in-out":J1e,"quart-in-coast":axe,"quart-out-coast":oxe,"quart-in-out-coast":lxe,"quint-in":jq,"quint-out":Xre,"quint-in-out":Q1e,"quint-in-coast":cxe,"quint-out-coast":uxe,"quint-in-out-coast":hxe,"sine-in":Uq,"sine-out":Kre,"sine-in-out":X1e,"expo-in":Bq,"expo-out":NO,"expo-in-out":K1e,"circ-in":qq,"circ-out":ese,"circ-in-out":exe,ease:t=>Gd.ease(t),"ease-in":t=>Gd.easeIn(t),"ease-out":t=>Gd.easeOut(t),"ease-in-out":t=>Gd.easeInOut(t)};let r_t=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const Hq={desiredScreenFlow:2,minDuration:500,maxDuration:8e3},cze={maxDuration:4e3};let s_t=class uze{constructor(e){this._createCamera=e,this.compared=new r_t,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:Hq.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new uze(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow??Hq.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>_n()}get hasFov(){return Math.abs(this.compared.fov)>_n()}get hasRotate(){return this.compared.rotate>_n()}},n_t=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},a_t=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,a=this.segments.reduce((o,l)=>o||l.definition.hasZoom,!1);for(let o=0;o<this.segments.length;o++){const l=this.segments[o],u=l.definition;if(e<=l.time||o===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+u.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+u.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,a&&!isNaN(i.zoom)&&isFinite(u.compared.targetZoom)){const{sourceZoom:d,targetZoom:f}=u.compared,g=i.zoom*(f-d)+d,v=this.segments[0].definition.compared.sourceZoom,_=this.segments[this.segments.length-1].definition.compared.targetZoom,x=Math.abs(f-v)>Math.abs(d-v)?f:d;i.zoomOffset=x-_,i.zoom=(g-v)/(x-v)}else i.zoom=1;return i}e-=l.time,r+=u.compared.pan,s+=u.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},BJ=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let a=0,o=0;r&&(s&&(a=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(o=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const u=a+o+a*o;this._zoomPixelFlow=a*o/u*l,this._panPixelFlow=o/u*l,this._rotatePixelFlow=a/u*l}else if(r&&s){const u=1+a;this._zoomPixelFlow=a/u*l,this._panPixelFlow=1/u*l}else if(r&&n){const u=1+o;this._zoomPixelFlow=o/u*l,this._rotatePixelFlow=1/u*l}else if(s&&n){const u=this._panPixelsAtSource/this._rotatePixels,d=1+u;this._panPixelFlow=u/d*l,this._rotatePixelFlow=1/d*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);if(this._time=Math.max(this.rotateTime,this.zoomTime,this.panTime),this.fovTime>this._time){const u=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=u,this._panPixelFlow/=u,this._rotatePixelFlow/=u}}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/o_t:0}get panTime(){if(!this.definition.hasPan)return 0;if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const o_t=zt(45);function l_t(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function c_t(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,a=1/Math.LN2,o=e-t.compared.sourceZoom,l=1/o,u=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(o))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*a*l*u-t.halfWindowSize*s*n*a*l+t.halfWindowSize*s*n*a*u/(o*o)}function u_t(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,a=Math.log(t.compared.sourceZoom*n),o=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*o+2*s*a+2*n-2*a*o/(r*r)-o/(e*e))/(t.desiredPixelFlow*Math.LN2)}function h_t(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function d_t(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function p_t(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function f_t(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function m_t(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function g_t(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function y_t(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function v_t(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,a=-e+t.compared.targetZoom,o=1/a,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*o+t.halfWindowSize*r*s*n*l/(a*a)+t.halfWindowSize*s*n*o*l/e}function __t(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,a=Math.log(e/t.compared.targetZoom),o=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*o-2*s*a+2*n+2*a*o/(r*r)-o/(e*e))/(t.desiredPixelFlow*Math.LN2)}function b_t(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function w_t(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function x_t(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function S_t(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function T_t(t,e){let i=$_t(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,a=s?h_t:l_t,o=s?d_t:c_t,l=s?p_t:u_t,u=n?b_t:y_t,d=n?w_t:v_t,f=n?x_t:__t,g=O=>a(t,O,r)+f_t(t,O,r)+u(t,O,r),v=O=>o(t,O,r)+m_t(t,O,r)+d(t,O,r),_=O=>l(t,O,r)+g_t(t,O,r)+f(t,O,r);let x=g(i);const S=S_t(t);let T;const M=e.maximumIterations||20,E=e.maximumDistance!=null?e.maximumDistance:1/0;for(T=0;T<M;T++){const O=e.desiredSlope??1e-6;let D=v(i);Math.abs(D)>O&&(D+=O);const L=D/_(i);if(isNaN(L)||i>=E&&L<0){if(!isFinite(E))return null;i=E,x=g(i);break}if(i-=L,i<=t.compared.sourceZoom||i<=t.compared.targetZoom)return null;const F=g(i);if(Math.abs(F-x)/x<=.005)break;x=F}return isNaN(x)||x>S*(1-.3)||i<=t.compared.sourceZoom||i<=t.compared.targetZoom?null:i}function $_t(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let C_t=class extends a_t{constructor(e,i){super(),this._preallocSegments=[new BJ,new BJ,new BJ],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i?.apex?T_t(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=zq(r.zoom):e===this._descensionSegment&&(r.zoom=G5(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,a=i?.ascensionFactor??.5,o=Math.min(1-a,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-a-o;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*a,r.definition.compared.rotate=this.definition.compared.rotate*a,r.definition.segmentEnd=a,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*o,n.definition.compared.rotate=this.definition.compared.rotate*o,n.definition.segmentStart=a+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const M_t=new n_t;let hze=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=Gq,this.definition=new s_t(e),this.path=new C_t}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(TPe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?Gq:NO)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,M_t);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??Hq.minDuration/r,n=i.maxDuration??Hq.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}};const E_t=2e3,A_t=64;let O_t=class{constructor(e){this._view=e,this._animation=new hze(()=>new Z1e(this._view)),this._current=new Z1e(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(e,i,r={}){Yl(this._current.viewpoint,e),Yl(this._source.viewpoint,e),Yl(this._target.viewpoint,i),this._animation.update(this._source,this._target,r)}applyRatio(e,i){this._animation.cameraAt(i,this._current),Yl(e,this._current.viewpoint)}},GM=class extends be{constructor(e){super(e),this._animation=null,this._destinationViewState=new Hue,this.updateFunction=null,this.easing=tse.ease,this.viewpoint=new ys({targetGeometry:new Ue,scale:0,rotation:0}),this._updateTask=Hg({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new O_t(e.view)}destroy(){this._updateTask=Xi(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,i,r){this.stop();const s=this.viewpoint;Yl(s,i);const n=e.target;this._transition.update(this.viewpoint,n,{apex:{maximumDistance:Math.min(Math.min(i.scale,n.scale)*A_t,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:r?.duration,maxDuration:r?.animationMode==="auto"?1/0:r?.maxDuration??cze.maxDuration,speedFactor:r?.speedFactor,easing:(typeof r?.easing=="string"?tse[r.easing]:r?.easing)||this.easing}),r?.animationMode==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=n,P_t(this._transition.animation,r,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,n,{duration:0}));const a=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(a,a),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,i){this.stop(),this.updateFunction=i,this.viewpoint=e;const r=new j0({target:e.clone()}),s=()=>{this.animation===r&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return r.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=r,r}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){const i=this.animation;if(i&&i.state!==j0.state.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),this.animation?.update(this.viewpoint);else{const r=performance.now()-this._startTime,s=this._transition.duration,n=s>0?r/s:1,a=n>=1;this._transition.applyRatio(this.viewpoint,n),a&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function P_t(t,e,i,r){if(e?.duration!=null)return!0;const{time:s,isLinear:n}=t,a=e?.speedFactor||1;if(s>(e?.maxDuration??cze.maxDuration/a))return!1;if(n){const l=Ke(),u=ia(...r.toScreen(l,...i.center)),d=ia(...i.toScreen(l,...r.center)),f=d!=null&&d.x>-1*i.size[0]&&d.x<(1.5+.5)*i.size[0]&&d.y>-1*i.size[1]&&d.y<(1.5+.5)*i.size[1],g=u!=null&&u.x>-1*r.size[0]&&u.x<(1.5+.5)*r.size[0]&&u.y>-1*r.size[1]&&u.y<(1.5+.5)*r.size[1];if(s>E_t/a&&!f&&!g)return!1}return!0}c([p()],GM.prototype,"easing",void 0),c([p()],GM.prototype,"view",void 0),c([p()],GM.prototype,"viewpoint",void 0),GM=c([R("esri.views.2d.AnimationManager")],GM);const R_t=GM;function Hs(){return Promise.all([W(()=>import("./webglDeps-BVrk6yaw.js"),__vite__mapDeps([145,146,147,148])),W(()=>import("./mapViewDeps-DPicuSt6.js"),__vite__mapDeps([149,150,55,56,50,54,57,47,151,48,152,51,153,154,46,155,146,148,156,52,61,157,58,59,158,159,160,147,161,72,162,163,164,36,45,49,14,13,165,60,166,53,106,107,66,167,62,67,168,169,170,171,172]))])}const iI=()=>Hs().then(()=>W(()=>import("./TileLayerView2D-CgHKFjXO.js"),__vite__mapDeps([173,55,56,50,54,57,47,158,159,156,154,46,155,146,148,161,151,152,51,72,162,36,150,48,153,52,61,58,59,167,45,49,14,13,62,67,174,175,176,171,177,178,169,170,179,180,181,182,183,184,185,186]))),px=()=>Hs().then(()=>W(()=>import("./FeatureLayerView2D-BPPmDZNd.js").then(t=>t.F),__vite__mapDeps([187,150,55,56,50,54,57,47,151,48,152,51,153,154,46,155,146,148,156,52,61,188,189,190,14,21,177,170,171,72,37,35,36,68,62,157,191,192,104,23,64,193,70,194,183,185,179,180,186]))),dxe={"base-dynamic":()=>Hs().then(()=>W(()=>import("./BaseDynamicLayerView2D-Vq5Kys-1.js"),__vite__mapDeps([195,196,154,46,47,155,146,148,156,175,151,176,177,197,179,180]))),"base-tile":iI,"bing-maps":iI,catalog:()=>Hs().then(()=>W(()=>import("./CatalogLayerView2D-DU0FhSjE.js"),__vite__mapDeps([198,177,156,199,179]))),"catalog-dynamic-group":()=>Hs().then(()=>W(()=>import("./CatalogDynamicGroupLayerView2D-papVuE0n.js"),__vite__mapDeps([200,177,156,201,179]))),"catalog-footprint":()=>Hs().then(()=>W(()=>import("./CatalogFootprintLayerView2D-1y4NZHUs.js"),__vite__mapDeps([202,187,150,55,56,50,54,57,47,151,48,152,51,153,154,46,155,146,148,156,52,61,188,189,190,14,21,177,170,171,72,37,35,36,68,62,157,191,192,104,23,64,193,70,194,183,185,179,180,186,203]))),csv:px,"geo-rss":()=>Hs().then(()=>W(()=>import("./GeoRSSLayerView2D-CPao_myq.js"),__vite__mapDeps([204,177,156,168,169,170,48,46,47,171,154,155,146,148,150,55,56,50,54,57,151,152,51,153,52,61,167,158,159,45,49,14,13,62,67,179]))),feature:px,geojson:px,parquet:px,graphics:()=>Hs().then(()=>W(()=>import("./GraphicsLayerView2D-DvIt1fKn.js"),__vite__mapDeps([205,177,156,168,169,170,48,46,47,171,154,155,146,148,150,55,56,50,54,57,151,152,51,153,52,61,167,158,159,45,49,14,13,62,67,179,186]))),group:()=>Hs().then(()=>W(()=>import("./GroupLayerView2D-C3nqbsY5.js"),__vite__mapDeps([206,177,156,207,179]))),imagery:()=>Hs().then(()=>W(()=>import("./ImageryLayerView2D-D3SwkNUU.js"),__vite__mapDeps([208,209,210,101,86,102,155,154,46,47,146,148,156,81,79,177,167,55,56,50,54,57,158,159,45,48,49,51,14,13,150,151,152,153,52,61,62,67,178,169,170,171,196,175,176,197,84,211,141,188,185,179,180,186]))),"imagery-tile":()=>Hs().then(()=>W(()=>import("./ImageryTileLayerView2D-D2Cm3xIT.js"),__vite__mapDeps([212,213,209,210,101,86,102,155,154,46,47,146,148,156,81,79,177,214,83,215,171,151,166,152,51,176,216,84,186,217,141,188,185,179,180]))),kml:()=>Hs().then(()=>W(()=>import("./KMLLayerView2D-CJSBuVXM.js"),__vite__mapDeps([218,219,175,151,176,196,154,46,47,155,146,148,156,177,168,169,170,48,171,150,55,56,50,54,57,152,51,153,52,61,167,158,159,45,49,14,13,62,67,179,106,107,66,84,163,147,215]))),"knowledge-graph":()=>Hs().then(()=>W(()=>import("./KnowledgeGraphLayerView2D-D0mj5CEe.js"),__vite__mapDeps([220,177,156,179]))),"link-chart":()=>Hs().then(()=>W(()=>import("./KnowledgeGraphLayerView2D-D0mj5CEe.js"),__vite__mapDeps([220,177,156,179]))),"knowledge-graph-sublayer":px,"map-image":()=>Hs().then(()=>W(()=>import("./MapImageLayerView2D-B7JPa3dv.js"),__vite__mapDeps([221,196,154,46,47,155,146,148,156,175,151,176,177,167,55,56,50,54,57,158,159,45,48,49,51,14,13,150,152,153,52,61,62,67,178,169,170,171,197,179,222,223,183,184,188,180,181,182,185,186]))),"map-notes":()=>Hs().then(()=>W(()=>import("./MapNotesLayerView2D-CYGbfT7P.js"),__vite__mapDeps([224,177,156,168,169,170,48,46,47,171,154,155,146,148,150,55,56,50,54,57,151,152,51,153,52,61,167,158,159,45,49,14,13,62,67,179,186]))),media:()=>Hs().then(()=>W(()=>import("./MediaLayerView2D-BzKl29nJ.js"),__vite__mapDeps([225,226,67,55,56,50,54,57,47,158,159,156,154,46,155,146,148,161,151,152,51,72,162,36,150,48,153,52,61,58,59,167,45,49,14,13,62,227,165,60,228,166,177,179,229]))),"ogc-feature":()=>Hs().then(()=>W(()=>import("./OGCFeatureLayerView2D-Dm-_o3wr.js"),__vite__mapDeps([230,187,150,55,56,50,54,57,47,151,48,152,51,153,154,46,155,146,148,156,52,61,188,189,190,14,21,177,170,171,72,37,35,36,68,62,157,191,192,104,23,64,193,70,194,183,185,179,180,186,231]))),"open-street-map":iI,"oriented-imagery":px,route:()=>Hs().then(()=>W(()=>import("./RouteLayerView2D-805qGTHh.js"),__vite__mapDeps([232,233,234,177,156,168,169,170,48,46,47,171,154,155,146,148,150,55,56,50,54,57,151,152,51,153,52,61,167,158,159,45,49,14,13,62,67,179,186]))),stream:()=>Hs().then(()=>W(()=>import("./StreamLayerView2D-DV3HB24W.js"),__vite__mapDeps([235,187,150,55,56,50,54,57,47,151,48,152,51,153,154,46,155,146,148,156,52,61,188,189,190,14,21,177,170,171,72,37,35,36,68,62,157,191,192,104,23,64,193,70,194,183,185,179,180,186,236]))),"subtype-group":()=>Hs().then(()=>W(()=>import("./SubtypeGroupLayerView2D-CU1nkNEY.js"),__vite__mapDeps([237,187,150,55,56,50,54,57,47,151,48,152,51,153,154,46,155,146,148,156,52,61,188,189,190,14,21,177,170,171,72,37,35,36,68,62,157,191,192,104,23,64,193,70,194,183,185,179,180,186]))),tile:iI,"vector-tile":()=>Hs().then(()=>W(()=>import("./VectorTileLayerView2D-BHLUW6Sf.js"),__vite__mapDeps([238,239,57,36,54,162,171,154,46,47,155,146,148,156,94,95,177,179,180]))),video:()=>Hs().then(()=>W(()=>import("./VideoLayerView2D-Ly_R_5B6.js"),__vite__mapDeps([240,241,113,112,228,154,46,47,155,146,148,156,150,55,56,50,54,57,151,48,152,51,153,52,61,166,242,177,168,169,170,171,167,158,159,45,49,14,13,62,67,179]))),wcs:()=>Hs().then(()=>W(()=>import("./ImageryTileLayerView2D-D2Cm3xIT.js"),__vite__mapDeps([212,213,209,210,101,86,102,155,154,46,47,146,148,156,81,79,177,214,83,215,171,151,166,152,51,176,216,84,186,217,141,188,185,179,180]))),"web-tile":iI,wfs:px,wms:()=>Hs().then(()=>W(()=>import("./WMSLayerView2D-BMGPKe6O.js"),__vite__mapDeps([243,196,154,46,47,155,146,148,156,175,151,176,177,197,179,180,244,245,188]))),wmts:()=>Hs().then(()=>W(()=>import("./WMTSLayerView2D-DeAAgTnu.js"),__vite__mapDeps([246,174,175,151,176,171,154,46,47,155,146,148,156,177,179,180]))),"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"gaussian-splat":null,"integrated-mesh-3dtiles":null,"integrated-mesh":null,"line-of-sight":null,"point-cloud":null,scene:null,unknown:null,unsupported:null,viewshed:null,voxel:null};function I_t(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new q(`${i}:view-not-supported`,`${e} is not supported in 2D`)}const pxe={hasLayerViewModule:t=>dxe[t.type]!=null,importLayerView:t=>{const e=dxe[t.type];if(e==null)throw I_t(t);return e(t)}};var kh;let t_=(kh=class{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new kh(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,a,o,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(a),this.col=parseFloat(o),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new kh(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,i,r){const s=this.clone();return s.col+=e,s.row+=i,r.normalizeKey(s),s}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new kh(e,i,r,s),new kh(e,i,r+1,s),new kh(e,i+1,r,s),new kh(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}},kh.pool=new Wc(()=>new kh(""),null,null,25,50),kh);function AC(t,e){return[t,e]}function fx(t,e,i){return t[0]=e,t[1]=i,t}function D_t(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const Jp=new t_("0/0/0/0");let k_t=class dze{static create(e,i,r=null){const s=Xl(e.spatialReference),n=i.origin||AC(e.origin.x,e.origin.y),a=AC(e.size[0]*i.resolution,e.size[1]*i.resolution),o=AC(-1/0,-1/0),l=AC(1/0,1/0),u=AC(1/0,1/0);r!=null&&(fx(o,Math.max(0,Math.floor((r.xmin-n[0])/a[0])),Math.max(0,Math.floor((n[1]-r.ymax)/a[1]))),fx(l,Math.max(0,Math.floor((r.xmax-n[0])/a[0])),Math.max(0,Math.floor((n[1]-r.ymin)/a[1]))),fx(u,l[0]-o[0]+1,l[1]-o[1]+1));const{cols:d,rows:f}=i;let g,v,_,x;return!r&&d&&f&&(fx(o,d[0],f[0]),fx(l,d[1],f[1]),fx(u,d[1]-d[0]+1,f[1]-f[0]+1)),e.isWrappable?(g=AC(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),u[1]),v=!0,_=s.origin,x=s.valid):(g=u,v=!1),new dze(i.level,i.resolution,i.scale,n,o,l,u,a,g,v,_,x)}constructor(e,i,r,s,n,a,o,l,u,d,f,g){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=a,this.size=o,this.norm=l,this.worldSize=u,this.wrap=d,this._spatialReferenceOrigin=f,this._spatialReferenceValid=g}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}normalizeKey(e){if(!this.wrap)return;const i=this.worldSize[0],r=e.col;r<0?(e.col=r+i,e.world-=1):r>=i&&(e.col=r-i,e.world+=1)}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const i=this.origin[0]+e*this.norm[0],r=this._spatialReferenceOrigin,s=this._spatialReferenceValid;return this.wrap&&r&&s?i===r[0]?s[0]:this.origin[0]===r[0]&&e===this.worldSize[0]?s[1]:i:i}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Jp.set(i);const s=r?Jp.col:this.denormalizeCol(Jp.col,Jp.world),n=Jp.row;return D_t(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){Jp.set(i);const s=r?Jp.col:this.denormalizeCol(Jp.col,Jp.world);return Array.isArray(e)?fx(e,this.getXForColumn(s),this.getYForRow(Jp.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(Jp.row)),e}};var QS;let ehe=(QS=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const a=e.getWorldForColumn(n);yield new t_(e.level,i,e.normalizeCol(n),a)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:a,colFrom:o,colTo:l}of r)for(let u=o;u<=l;u++)e.call(i,n,a,s.normalizeCol(u),s.getWorldForColumn(u))}},QS.pool=new Wc(()=>new QS),QS),qJ=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const an=new t_("0/0/0/0");let L_t=class pze{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,a]=i,o=n-r,l=a-s,u=l!==0?o/l:0,d=(Math.ceil(s)-s)*u,f=(Math.floor(s)-s)*u;return new pze(r,Math.floor(s),Math.ceil(a),u,o<0?d:f,o<0?f:d,o<0?n:r,o<0?r:n)}constructor(e,i,r,s,n,a,o,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=a,this.leftBound=o,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const ah=[[0,0],[0,0],[0,0],[0,0]],F_t=1e-6;let z_t=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(o=>o.level>=r&&o.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const a=this._lodInfos=n.map(o=>k_t.create(e,o,i));n.forEach((o,l)=>{this._infoByLevel[o.level]=a[l],this._infoByScale[o.scale]=a[l],this.scales[l]=o.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){an.set(i);const s=this._infoByLevel[an.level];return s?s.getTileBounds(e,an,r):e}getTileCoords(e,i,r=!1){an.set(i);const s=this._infoByLevel[an.level];return s?s.getTileCoords(e,an,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),a=ehe.pool.acquire(n),o=this._wrap;let l,u,d,f=1/0,g=-1/0;const v=a.spans;ah[0][0]=ah[0][1]=ah[1][1]=ah[3][0]=-i,ah[1][0]=ah[2][0]=e.size[0]+i,ah[2][1]=ah[3][1]=e.size[1]+i;for(const T of ah)e.toMap(T,T),T[0]=n.getColumnForX(T[0]),T[1]=n.getRowForY(T[1]);const _=[];let x=3;for(let T=0;T<4;T++){if(ah[T][1]===ah[x][1]){x=T;continue}const M=L_t.create(ah[T],ah[x]);f=Math.min(M.ymin,f),g=Math.max(M.ymax,g),_[M.ymin]===void 0&&(_[M.ymin]=[]),_[M.ymin].push(M),x=T}if(f==null||g==null||g-f>100)return null;let S=[];for(l=f;l<g;){_[l]!=null&&(S=S.concat(_[l])),u=1/0,d=-1/0;for(let T=S.length-1;T>=0;T--){const M=S[T];u=Math.min(u,M.getLeftCol()),d=Math.max(d,M.getRightCol())}if(u=Math.floor(u),d=Math.floor(d),l>=n.first[1]&&l<=n.last[1])if(o)if(n.size[0]<n.worldSize[0]){const T=Math.floor(d/n.worldSize[0]);for(let M=Math.floor(u/n.worldSize[0]);M<=T;M++)v.push(new qJ(l,Math.max(n.getFirstColumnForWorld(M),u),Math.min(n.getLastColumnForWorld(M),d)))}else v.push(new qJ(l,u,d));else u>n.last[0]||d<n.first[0]||(u=Math.max(u,n.first[0]),d=Math.min(d,n.last[0]),v.push(new qJ(l,u,d)));l+=1;for(let T=S.length-1;T>=0;T--){const M=S[T];M.ymax>=l?M.incrRow():S.splice(T,1)}}return a}getTileParentId(e){an.set(e);const i=this._infoByLevel[an.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(an,this._lodInfos[r],an),an.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){an.set(i);const r=this._infoByLevel[an.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(an,s,an);const a=s.denormalizeCol(an.col,an.world);for(const o of e.spans)if(o.row===an.row&&o.colFrom<=a&&o.colTo>=a)return!0}if(s.resolution<r.resolution){const[a,o,l,u]=e.spans.reduce((x,S)=>(x[0]=Math.min(x[0],S.row),x[1]=Math.max(x[1],S.row),x[2]=Math.min(x[2],S.colFrom),x[3]=Math.max(x[3],S.colTo),x),[1/0,-1/0,1/0,-1/0]),d=r.denormalizeCol(an.col,an.world),f=s.getColumnForX(r.getXForColumn(d)),g=s.getRowForY(r.getYForRow(an.row)),v=s.getColumnForX(r.getXForColumn(d+1))-1,_=s.getRowForY(r.getYForRow(an.row+1))-1;return!(f>u||v<l||g>o||_<a)}const n=s.denormalizeCol(an.col,an.world);return e.spans.some(a=>a.row===an.row&&a.colFrom<=n&&a.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=Xl(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+F_t)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},N_t=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},fze=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new QE,this._controllers=new QE,this._processingItems=new QE,this._pausedSignal=ta(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new wO(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Xi(this._schedule),this._task=Xi(this._task)}get updating(){return!!this._task?.updating||this.readyToRun}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=Mo(i,()=>s.abort()));const a=()=>{const d=this._processingItems.get(e);d&&d.controller.abort(),o(),u.reject(ti())},o=()=>{l.remove(),n?.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=GL(s.signal,a),u=Eo();return this._deferreds.set(e,u),this._controllers.set(e,s),u.promise.then(o,o),this._queue.push(e),this._scheduleNext(),u.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject(ti()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get readyToRun(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=uP(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new N_t(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}Ea(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};const fxe=[0,0];let sv=class extends be{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:i,scheduler:r,priority:s}=this;this._queue=new fze({concurrency:e,scheduler:r,priority:s,process:(n,a)=>{const o=this._keyToItem.get(n);return i(o,{signal:a})},peeker:n=>this._peek(n)})}destroy(){this.clear(),this._queue=Pe(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=this.tileInfoView.getTileScale(e.key),n=Fu(this._tilesByScale,s,()=>new Set),a=()=>{n.delete(e.key),n.size===0&&this._tilesByScale.delete(s),this._keyToItem.delete(i)};return n.add(e.key),this._keyToItem.set(i,e),r.then(a,a),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const i=new Set;for(const a of e)i.add(this._keyToItem.get(a).key);const r=this.state.scale;let s,n=Number.POSITIVE_INFINITY;for(const[a,o]of this._tilesByScale)if(rE(o,l=>i.has(l))){const l=Math.abs(a-r);l<n&&(s=o,n=l)}return this._getClosestTileKey(s,e).id}_getClosestTileKey(e,i){const r=this.tileInfoView,s=this.state.center;let n,a=Number.POSITIVE_INFINITY;for(const o of e)if(i.has(o.id)){r.getTileCoords(fxe,o);const l=nm(fxe,s);l<a&&(a=l,n=o)}return n}};c([p({constructOnly:!0})],sv.prototype,"concurrency",void 0),c([p({constructOnly:!0})],sv.prototype,"priority",void 0),c([p({constructOnly:!0})],sv.prototype,"process",void 0),c([p({constructOnly:!0})],sv.prototype,"scheduler",void 0),c([p()],sv.prototype,"state",void 0),c([p({constructOnly:!0})],sv.prototype,"tileInfoView",void 0),sv=c([R("esri.views.2d.tiling.TileQueue")],sv);const ehi=sv;let V_t=class{constructor(e,i,r){this.maxSize=e,this._tileInfoView=i,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear(),this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const i=this._tilePerId.get(e);if(!i)return;const r=i.key.level,s=this._tileKeysPerLevel[r];mxe(this._tilePerId,e);for(let n=0;n<s.length;n++)if(s[n].id===e){s.splice(n,1);break}return i.visible=!0,i}add(e){e.visible=!1;const i=e.key,r=i.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,e);const s=i.level;this._tileKeysPerLevel[s]||(this._tileKeysPerLevel[s]=[]),this._tileKeysPerLevel[s].push(i)}prune(e,i,r){let s=this._tilePerId.size;if(s<=this.maxSize)return;let n=this._tileKeysPerLevel.length-1;for(;s>this.maxSize&&n>=0;)n!==e&&(s=this._pruneAroundCenterTile(s,i,r,n)),n--;s>this.maxSize&&(s=this._pruneAroundCenterTile(s,i,r,e))}_pruneAroundCenterTile(e,i,r,s){const n=this._tileKeysPerLevel[s];if(!n||n.length===0)return e;const{size:a,origin:o}=this._tileInfoView.tileInfo,l=r*a[0],u=r*a[1],d=[0,0],f=[0,0];for(n.sort((g,v)=>(d[0]=o.x+l*(g.col+.5),d[1]=o.y-u*(g.row+.5),f[0]=o.x+l*(v.col+.5),f[1]=o.y-u*(v.row+.5),I0(d,i)-I0(f,i)));n.length>0;){const g=n.pop();if(this._removeTile(g.id),--e===this.maxSize)break}return e}_removeTile(e){const i=this._tilePerId.get(e);this._removedFunc&&i&&this._removedFunc(i),mxe(this._tilePerId,e)}};function mxe(t,e){t.delete(e)}const mx=new t_(0,0,0,0),Ay=new Map,rI=[],GJ=[];let ihi=class{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,e.resampling!=null&&(this.resampling=e.resampling),e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),e.buffer!=null&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new V_t(e.cacheSize,this.tileInfoView,i=>{this.releaseTile(i)}))}destroy(){this.tileIndex.clear()}update(e){const{resampling:i,tileIndex:r}=this,{scale:s,center:n,resolution:a}=e.state,{minScale:o,maxScale:l}=this.tileInfoView,u=!e.stationary&&s>this._previousScale;if(this._previousScale=s,!i&&(s>o||s<l))return this.tiles.length=0,void this.clear();const d=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy);if(!d)return this.tiles.length=0,void this.clear();const{spans:f,lodInfo:g}=d,{level:v}=g;this.tiles.length=0,r.forEach(T=>T.visible=!0);let _=0,x=0;if(f.length>0)for(const{row:T,colFrom:M,colTo:E}of f)for(let P=M;P<=E;P++){_++;const O=mx.set(v,T,g.normalizeCol(P),g.getWorldForColumn(P)).id;let D=r.get(O);if(D)D.isReady?(Ay.set(O,D),x++):u||this._addParentTile(O,Ay);else{if(this._tileCache?.has(O)){if(D=this._tileCache.pop(O),this.tileIndex.set(O,D),D.isReady){Ay.set(O,D),x++;continue}}else D=this.acquireTile(mx),this.tileIndex.set(O,D);u||this._addParentTile(O,Ay)}}const S=x===_;for(const[T,M]of r){if(Ay.has(T))continue;mx.set(T);const E=this.tileInfoView.intersects(d,mx),P=this.cachePolicy==="purge"?mx.level!==v:mx.level>v;!E||!u&&S?!P&&E||rI.push(M):M.isReady?P&&this.cachePolicy==="purge"&&this._hasReadyAncestor(mx,v)?rI.push(M):GJ.push(M):P&&rI.push(M)}for(const T of GJ)T.isReady&&Ay.set(T.key.id,T);for(const T of rI)this._tileCache?this._tileCache.add(T):this.releaseTile(T),r.delete(T.key.id);for(const T of Ay.values())this.tiles.push(T);for(const T of r.values())Ay.has(T.key.id)||(T.visible=!1);this._tileCache?.prune(v,n,a),ehe.pool.release(d),GJ.length=0,rI.length=0,Ay.clear()}clear(){const{tileIndex:e}=this;for(const i of e.values())this.releaseTile(i);e.clear()}refresh(e){for(const i of this.tileIndex.values())e(i);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,i){let r=e,s=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(s=this.tileIndex.get(r),s?.isReady){i.has(s.key.id)||i.set(s.key.id,s);break}}else if(this._tileCache?.has(r)&&(s=this._tileCache.pop(r),this.tileIndex.set(r,s),s?.isReady)){i.has(s.key.id)||i.set(s.key.id,s);break}}_hasReadyAncestor(e,i){const r=fi();this.tileInfoView.getTileBounds(r,e,!0);for(const s of this.tileIndex.values())if(s.isReady&&s.key.level>=i&&s.key.level<e.level){const n=fi();if(this.tileInfoView.getTileBounds(n,s.key,!0),rF(n,r))return!0}return!1}};const j_t={"area-measurement":null,dimension:null,"direct-line-measurement":null,"elevation-profile":()=>W(()=>import("./ElevationProfileAnalysisView2D-D81gziS9.js"),__vite__mapDeps([247,248,249,250,251,252,253,254,255,256,66,257,258,259,260,261,262])),"line-of-sight":null,slice:null,viewshed:null,"volume-measurement":null};function U_t(t){const e=j_t[t.type];if(!e)throw new q("analysis-view-module-import-utils:analysis-not-supported",`Analysis "${t.type}" is not supported`);return e()}let B_t=class{constructor(e,i={}){this.events=new gm,this._hasMajorPerformanceCaveat=!1,this._lastRenderFrameCounter=0,e!=null?(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform"),e.contains(this._canvas)||e.appendChild(this._canvas)):i.canvas!=null&&(this._canvas=i.canvas);const r={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0,powerPreference:"high-performance"};let s=this._canvas.getContext("webgl2",r);s||(s=this._canvas.getContext("webgl2",{...r,failIfMajorPerformanceCaveat:!1}),this._hasMajorPerformanceCaveat=!0),this._gl=s,this._handles=Yu([f$(this._canvas,"webglcontextlost",n=>this.events.emit("webgl-context-lost",n))])}destroy(){this._canvas.remove(),this._canvas=null,this._handles.remove(),this._gl=null}get gl(){return this._gl}get canvas(){return this._canvas}render(e,i){if(this._hasMajorPerformanceCaveat||ie("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=ie("esri-performance-mode-frames-between-render")&&(i(),this._lastRenderViewState=e.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){const[r,s,n,a,o,l]=this._computeViewTransform(this._lastRenderViewState,e.state);this._canvas.style.transform=`matrix(${r}, ${s}, ${n}, ${a}, ${o}, ${l})`}}else i()}resize(e){const i=this._canvas,r=i.style,{state:{size:s},pixelRatio:n}=e,a=s[0],o=s[1],l=Math.round(a*n),u=Math.round(o*n);i.width===l&&i.height===u||(i.width=l,i.height=u),r.width=a+"px",r.height=o+"px"}_computeViewTransform(e,i){const[r,s]=e.center,[n,a]=i.center,[o,l]=e.toScreen([0,0],n,a),[u,d]=e.toScreen([0,0],r,s),f=u-o,g=d-l,v=e.scale/i.scale,_=i.rotation-e.rotation,x=Ug();return yFe(x),V7(x,x,[v,v]),SF(x,x,zt(_)),LO(x,x,[f,g]),x}};function mze(t,e,i,r,s){gze(t,e,i||0,r||t.length-1,s||q_t)}function gze(t,e,i,r,s){for(;r>i;){if(r-i>600){var n=r-i+1,a=e-i+1,o=Math.log(n),l=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*l*(n-l)/n)*(a-n/2<0?-1:1);gze(t,e,Math.max(i,Math.floor(e-a*l/n+u)),Math.min(r,Math.floor(e+(n-a)*l/n+u)),s)}var d=t[e],f=i,g=r;for(sI(t,i,e),s(t[r],d)>0&&sI(t,i,r);f<g;){for(sI(t,f,g),f++,g--;s(t[f],d)<0;)f++;for(;s(t[g],d)>0;)g--}s(t[i],d)===0?sI(t,i,g):sI(t,++g,r),g<=e&&(i=g+1),e<=g&&(r=g-1)}}function sI(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function q_t(t,e){return t<e?-1:t>e?1:0}function Wq(t,e){if(!(this instanceof Wq))return new Wq(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&(typeof e=="function"?this.toBBox=e:this._initFormat(e)),this.clear()}function G_t(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function OC(t,e){VD(t,0,t.children.length,e,t)}function VD(t,e,i,r,s){s||(s=HM(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n,a=e;a<i;a++)n=t.children[a],jD(s,t.leaf?r(n):n);return s}function jD(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function gxe(t,e){return t.minX-e.minX}function yxe(t,e){return t.minY-e.minY}function HJ(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function tV(t){return t.maxX-t.minX+(t.maxY-t.minY)}function H_t(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function W_t(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function WJ(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function iV(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function HM(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function vxe(t,e,i,r,s){for(var n,a=[e,i];a.length;)(i=a.pop())-(e=a.pop())<=r||(n=e+Math.ceil((i-e)/r/2)*r,mze(t,n,e,i,s),a.push(e,n,n,i))}Wq.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!iV(t,e))return i;for(var s,n,a,o,l=[];e;){for(s=0,n=e.children.length;s<n;s++)a=e.children[s],iV(t,o=e.leaf?r(a):a)&&(e.leaf?i.push(a):WJ(t,o)?this._all(a,i):l.push(a));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!iV(t,e))return!1;for(var r,s,n,a,o=[];e;){for(r=0,s=e.children.length;r<s;r++)if(n=e.children[r],iV(t,a=e.leaf?i(n):n)){if(e.leaf||WJ(t,a))return!0;o.push(n)}e=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t!=null&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=HM([]),this},remove:function(t,e){if(t==null)return this;for(var i,r,s,n,a=this.data,o=this.toBBox(t),l=[],u=[];a||l.length;){if(a||(a=l.pop(),r=l[l.length-1],i=u.pop(),n=!0),a.leaf&&(s=G_t(t,a.children,e))!==-1)return a.children.splice(s,1),l.push(a),this._condense(l),this;n||a.leaf||!WJ(a,o)?r?(i++,a=r.children[i],n=!1):a=null:(l.push(a),u.push(i),i=0,r=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:gxe,compareMinY:yxe,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var s,n=i-e+1,a=this._maxEntries;if(n<=a)return OC(s=HM(t.slice(e,i+1)),this.toBBox),s;r||(r=Math.ceil(Math.log(n)/Math.log(a)),a=Math.ceil(n/Math.pow(a,r-1))),(s=HM([])).leaf=!1,s.height=r;var o,l,u,d,f=Math.ceil(n/a),g=f*Math.ceil(Math.sqrt(a));for(vxe(t,e,i,g,this.compareMinX),o=e;o<=i;o+=g)for(vxe(t,o,u=Math.min(o+g-1,i),f,this.compareMinY),l=o;l<=u;l+=f)d=Math.min(l+f-1,u),s.children.push(this._build(t,l,d,r-1));return OC(s,this.toBBox),s},_chooseSubtree:function(t,e,i,r){for(var s,n,a,o,l,u,d,f;r.push(e),!e.leaf&&r.length-1!==i;){for(d=f=1/0,s=0,n=e.children.length;s<n;s++)l=HJ(a=e.children[s]),(u=H_t(t,a)-l)<f?(f=u,d=l<d?l:d,o=a):u===f&&l<d&&(d=l,o=a);e=o||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,s=i?t:r(t),n=[],a=this._chooseSubtree(s,this.data,e,n);for(a.children.push(t),jD(a,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(t,e){var i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var n=this._chooseSplitIndex(i,s,r),a=HM(i.children.splice(n,i.children.length-n));a.height=i.height,a.leaf=i.leaf,OC(i,this.toBBox),OC(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(t,e){this.data=HM([t,e]),this.data.height=t.height+1,this.data.leaf=!1,OC(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,s,n,a,o,l,u,d;for(l=u=1/0,r=e;r<=i-e;r++)a=W_t(s=VD(t,0,r,this.toBBox),n=VD(t,r,i,this.toBBox)),o=HJ(s)+HJ(n),a<l?(l=a,d=r,u=o<u?o:u):a===l&&o<u&&(u=o,d=r);return d},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:gxe,s=t.leaf?this.compareMinY:yxe;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,s)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var s,n,a=this.toBBox,o=VD(t,0,e,a),l=VD(t,i-e,i,a),u=tV(o)+tV(l);for(s=e;s<i-e;s++)n=t.children[s],jD(o,t.leaf?a(n):n),u+=tV(o);for(s=i-e-1;s>=e;s--)n=t.children[s],jD(l,t.leaf?a(n):n),u+=tV(l);return u},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)jD(e[r],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)t[i].children.length===0?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():OC(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function Z_t(t,{timeZone:e,timeExtent:i}){return{$view:{scale:t,timeZone:e,timeProperties:{currentStart:i?.start,currentEnd:i?.end}}}}let _xe=class yze{constructor(e,i){this.key=new t_(0,0,0,0),this.bounds=fi(),this.objectIds=new Set,this.key.set(i);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.level=r.level,this.scale=r.scale,this.minScale=e.zoomToScale(r.level-1),this.maxScale=e.zoomToScale(r.level+1)}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return iF(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(e){return Z_t(this.scale,e)}createChildTiles(){const e=this.key.getChildKeys(),i=Lc.acquire();for(let r=0;r<e.length;r++)i[r]=new yze(this.tileInfoView,e[r]);return i}getQuantizationParameters(){return Hb.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}};const gx={added:[],removed:[]},ZJ=new Set,Y_t=new t_(0,0,0,0);function J_t(t,e){const i=Xl(e);if(!i)return null;const[r,s]=i.valid;return t[2]>s?[fi([t[0],t[1],s,t[3]]),fi([r,t[1],r+t[2]-s,t[3]])]:t[0]<r?[fi([r,t[1],t[2],t[3]]),fi([s-(r-t[0]),t[1],s,t[3]])]:null}let Q_t=class extends Oce{constructor(e){super(),this._tiles=new Map,this._index=Wq(9,ie("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){super.destroy(),this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}getIntersectingTiles(e){if(!e||So(e)===0||Zl(e)===0)return[];const i=J_t(e,this.tileScheme.spatialReference);return i!=null?[...new Set([...this.boundsIntersections(i[0]),...this.boundsIntersections(i[1])])]:this.boundsIntersections(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const i={added:[],removed:[]};for(const r of e.added)if(!this.has(r)){const s=new _xe(this.tileScheme,r);this._tiles.set(r,s),this._index.insert(s),i.added.push(s)}for(const r of e.removed)if(this.has(r)){const s=this.get(r);this._tiles.delete(r),this._index.remove(s),i.removed.push(s)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(e){const i=this.tileScheme.getTileCoverage(e,0);if(!i)return;const{spans:r,lodInfo:s}=i,{level:n}=s;if(r.length>0)for(const{row:a,colFrom:o,colTo:l}of r)for(let u=o;u<=l;u++){const d=Y_t.set(n,a,s.normalizeCol(u),s.getWorldForColumn(u)).id;if(ZJ.add(d),!this.has(d)){const f=new _xe(this.tileScheme,d);this._tiles.set(d,f),this._index.insert(f),this.tiles.push(f),gx.added.push(f)}}for(let a=this.tiles.length-1;a>=0;a--){const o=this.tiles[a];ZJ.has(o.id)||(this._tiles.delete(o.id),this.tiles.splice(a,1),this._index.remove(o),gx.removed.push(o))}(gx.added.length||gx.removed.length)&&this.emit("update",gx),ehe.pool.release(i),ZJ.clear(),gx.added.length=0,gx.removed.length=0}};const ahi=1e-30,bxe=512,rV=16777216,ohi=8,lhi=29,chi=24,uhi=4,hhi=0,dhi=0,phi=0,fhi=1,mhi=2,ghi=3,yhi=4,vhi=5,_hi=6,bhi=12,whi=13,xhi=5,X_t=6,Shi=5,Thi=6,vze=6,_ze=1<<vze,K_t=_ze<<1,$hi=1.05,Chi=3,Mhi=1,Ehi=3,Ahi=3,Ohi=5,Phi=6,Rhi=1.15,ebt=4,Ihi=128,tbt=256,Dhi=tbt-2*ebt,khi=2,Lhi=128,Fhi=1,zhi=10,Nhi=1024,Vhi=128,jhi=4,Uhi=1,Bhi=1<<20,qhi=.75,Ghi=10,Hhi=.75,Whi=256,Zhi=32,Yhi=512,Jhi=0,Qhi=1,ibt=1,Xhi=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],Khi=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],nI=256,rbt=()=>re.getLogger("esri.views.webgl.checkWebGLError");function the(t){switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const bze=!!ie("enable-feature:webgl-debug");function Bl(){return bze}function ise(){return bze}function Au(t,e=Bl()){if(e){const i=the(t);if(i){const r=new Error().stack;rbt().error(new q("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}const Sr={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Di={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131},ot={RGBA4:32854,R16F:33325,RG16F:33327,RGB32F:34837,RGBA16F:34842,R32F:33326,RG32F:33328,RGBA32F:34836,R11F_G11F_B10F:35898,RGB8:32849,RGBA8:32856,RGB5_A1:32855,R8:33321,RG8:33323,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,RGB16F:34843,RGB9_E5:35901,SRGB8:35905,SRGB8_ALPHA8:35907,RGB565:36194,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2:32857,RGB10_A2UI:36975},sbt=Object.values(ot),Jg={DEPTH24_STENCIL8:35056,DEPTH32F_STENCIL8:36013},mp={DEPTH_COMPONENT16:33189,DEPTH_COMPONENT24:33190,DEPTH_COMPONENT32F:36012},Ns={FLOAT:Di.FLOAT,UNSIGNED_BYTE:Di.UNSIGNED_BYTE,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,BYTE:Di.BYTE,UNSIGNED_SHORT:Di.UNSIGNED_SHORT,SHORT:Di.SHORT,UNSIGNED_INT:Di.UNSIGNED_INT,INT:Di.INT,HALF_FLOAT:5131,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269},YJ=33984,mn={Texture:0,TileTexture:1,BufferObject:2,VertexArrayObject:3,Shader:4,Program:5,FramebufferObject:6,Renderbuffer:7,TransformFeedback:8,Sync:9,UNCOUNTED:10,LinesOfCode:10,Uniform:11,COUNT:12},WM=1029,Zq=0,Hr=36064,vl=36065,ihe=36066,edi=36067,To=33306,wze=36096,nbt=36128,pn={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497};function xze(t,e,i,r=0){const s=t.gl;t.bindBuffer(i);for(const n of i.layout){const a=e.get(n.name);if(a==null){console.warn(`There is no location for vertex attribute '${n.name}' defined.`);continue}const o=r*n.stride;if(n.count<=4)s.vertexAttribPointer(a,n.count,n.type,n.normalized,n.stride,n.offset+o),s.enableVertexAttribArray(a),n.divisor>0&&s.vertexAttribDivisor(a,n.divisor);else if(n.count===9)for(let l=0;l<3;l++)s.vertexAttribPointer(a+l,3,n.type,n.normalized,n.stride,n.offset+12*l+o),s.enableVertexAttribArray(a+l),n.divisor>0&&s.vertexAttribDivisor(a+l,n.divisor);else if(n.count===16)for(let l=0;l<4;l++)s.vertexAttribPointer(a+l,4,n.type,n.normalized,n.stride,n.offset+16*l+o),s.enableVertexAttribArray(a+l),n.divisor>0&&s.vertexAttribDivisor(a+l,n.divisor);else console.error("Unsupported vertex attribute element count: "+n.count);if(Bl()){const l=the(t.gl);l&&console.error(`Unable to bind vertex attribute "${n.name}" with baseInstanceOffset ${o}:`,l,n)}}}function abt(t){switch(t){case 6406:case 6409:case 6403:case 36244:case 6402:case 34041:return 1;case 6410:case 33319:case 33320:return 2;case 6407:case 36248:return 3;case 6408:case 36249:return 4}return 0}function rhe(t){switch(t){case 6406:case 6409:case 6403:case 36244:case ot.R8:case ot.R8I:case ot.R8UI:case ot.R8_SNORM:case 36168:return 1;case 6410:case 33319:case 33320:case ot.RGBA4:case ot.R16F:case ot.R16I:case ot.R16UI:case ot.RG8:case ot.RG8I:case ot.RG8UI:case ot.RG8_SNORM:case ot.RGB565:case ot.RGB5_A1:case mp.DEPTH_COMPONENT16:return 2;case 6407:case 36248:case ot.RGB8:case ot.RGB8I:case ot.RGB8UI:case ot.RGB8_SNORM:case ot.SRGB8:case mp.DEPTH_COMPONENT24:return 3;case 6408:case 36249:case ot.RGBA8:case ot.R32F:case ot.R11F_G11F_B10F:case ot.RG16F:case ot.R32I:case ot.R32UI:case ot.RG16I:case ot.RG16UI:case ot.RGBA8I:case ot.RGBA8UI:case ot.RGBA8_SNORM:case ot.SRGB8_ALPHA8:case ot.RGB9_E5:case ot.RGB10_A2UI:case ot.RGB10_A2:case mp.DEPTH_COMPONENT32F:case Jg.DEPTH24_STENCIL8:return 4;case Jg.DEPTH32F_STENCIL8:return 5;case ot.RGB16F:case ot.RGB16I:case ot.RGB16UI:return 6;case ot.RG32F:case ot.RG32I:case ot.RG32UI:case ot.RGBA16F:case ot.RGBA16I:case ot.RGBA16UI:return 8;case ot.RGB32F:case ot.RGB32I:case ot.RGB32UI:return 12;case ot.RGBA32F:case ot.RGBA32I:case ot.RGBA32UI:return 16;case pn.COMPRESSED_RGB_S3TC_DXT1_EXT:case pn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case pn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case pn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case pn.COMPRESSED_R11_EAC:case pn.COMPRESSED_SIGNED_R11_EAC:case pn.COMPRESSED_RGB8_ETC2:case pn.COMPRESSED_SRGB8_ETC2:case pn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case pn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case pn.COMPRESSED_RG11_EAC:case pn.COMPRESSED_SIGNED_RG11_EAC:case pn.COMPRESSED_RGBA8_ETC2_EAC:case pn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let ar=class{constructor(e=0,i=e){this.width=e,this.height=i,this.type=0,this.target=3553,this.pixelFormat=6408,this.dataType=Ns.UNSIGNED_BYTE,this.samplingMode=9729,this.wrapMode=10497,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}};function obt(t){return t.width<=0||t.height<=0||t.depth<=0?0:Math.round(t.width*t.height*t.depth*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:rhe(t.internalFormat))*(t.target===34067?6:1))}const aI=()=>re.getLogger("esri/views/webgl/textureUtils");function oI(t){const{width:e,height:i,depth:r}=t;(e!=null&&e<0||i!=null&&i<0||r!=null&&r<0)&&aI().error("Negative dimension parameters are not allowed!");const{internalFormat:s}=t;if(s&&(she(s)||Sze(s))){const{linearFilterDepth:n,compareEnabled:a,samplingMode:o,hasMipmap:l}=t;l&&aI().error("Depth textures cannot have mipmaps"),n?o!==9729&&o!==9728&&aI().error("Depth textures cannot sample mipmaps"):(o!==9728&&aI().error("Depth textures without filtering must use NEAREST filtering"),a&&aI().error("Depth textures without filtering cannot use compare function"))}}function lbt(t){return sbt.includes(t)}function she(t){return H9(mp,t)}function Sze(t){return H9(Jg,t)}function Tze(t){return t!=null&&H9(pn,t)}function ZM(t){return t!=null&&"type"in t&&t.type==="compressed"}function cbt(t){return t!=null&&"byteLength"in t}function wxe(t){return t!=null&&!ZM(t)&&!cbt(t)}function PC(t){return t===32879||t===35866}function xxe(t,e,i,r=1){let s=Math.max(e,i);return t===32879&&(s=Math.max(s,r)),Math.floor(Math.log2(s))+1}function sV(t){if(t.internalFormat!=null)return t.internalFormat;switch(t.dataType){case Ns.FLOAT:switch(t.pixelFormat){case 6408:return ot.RGBA32F;case 6407:return ot.RGB32F;default:throw new q("texture:unknown-format","Unable to derive format")}case Ns.UNSIGNED_BYTE:switch(t.pixelFormat){case 6408:return ot.RGBA8;case 6407:return ot.RGB8}}const{pixelFormat:e}=t;return t.internalFormat=e===34041?Jg.DEPTH24_STENCIL8:e===6402?mp.DEPTH_COMPONENT24:e,t.internalFormat}function ubt(t){let e="width"in t?t.width:t.codedWidth,i="height"in t?t.height:t.codedHeight;return t instanceof HTMLVideoElement&&(e=t.videoWidth,i=t.videoHeight),{width:e,height:i,depth:1}}let hbt=class $ze extends ar{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case ot.R16F:case ot.R32F:case ot.R8_SNORM:case ot.R8:this.pixelFormat=6403;break;case ot.R8I:case ot.R8UI:case ot.R16I:case ot.R16UI:case ot.R32I:case ot.R32UI:this.pixelFormat=36244}}static validate(e,i){return new $ze(e,i)}};const dbt=!!ie("esri-tests-disable-gpu-memory-measurements"),Oy=()=>re.getLogger("esri/views/webgl/Texture");var Ha;let qi=(Ha=class{constructor(e,i=null,r=null){if(this.type=1,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const s=hbt.validate(e,i);if(!s)throw new q("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=s}this._descriptor.target===34067?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return dbt?0:obt(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){this.abortCompression(),this.hasWebGLTextureObject&&this._descriptor.context?.gl&&(this._descriptor.context.instanceCounter.decrement(mn.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor=null)}release(){this.dispose()}[Symbol.dispose](){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new q("texture:immutable-resize","Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===34067?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!ZM(e)&&this._descriptor.internalFormat&&H9(pn,this._descriptor.internalFormat)&&(this._descriptor.internalFormat=void 0),this._setData(e),!ZM(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(e,i,r,s,n,a,o=0){a||Oy().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||Oy().error("An attempt to update uninitialized texture!");const l=this._descriptor;l.internalFormat=sV(l);const{context:u,pixelFormat:d,dataType:f,target:g,isImmutable:v}=l;if(v&&!this._wasImmutablyAllocated)throw new q("texture:uninitialized","Cannot update immutable texture before allocation!");const _=u.bindTexture(this,Ha.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&Oy().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:x}=u;o&&(s&&n||Oy().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),x.pixelStorei(x.UNPACK_SKIP_ROWS,o)),wxe(a)?x.texSubImage2D(g,e,i,r,s,n,d,f,a):ZM(a)?x.compressedTexSubImage2D(g,e,i,r,s,n,l.internalFormat,a.levels[e]):x.texSubImage2D(g,e,i,r,s,n,d,f,a),o&&x.pixelStorei(x.UNPACK_SKIP_ROWS,0),u.bindTexture(_,Ha.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,a,o,l){l||Oy().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||Oy().error("An attempt to update an uninitialized texture!");const u=this._descriptor;u.internalFormat=sV(u);const{context:d,pixelFormat:f,dataType:g,isImmutable:v,target:_}=u;if(v&&!this._wasImmutablyAllocated)throw new q("texture:uninitialized","Cannot update immutable texture before allocation!");PC(_)||Oy().warn("Attempting to set 3D texture data on a non-3D texture");const x=d.bindTexture(this,Ha.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(Ha.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>u.width||r+a>u.height||s+o>u.depth)&&Oy().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:S}=d;if(ZM(l))l=l.levels[e],S.compressedTexSubImage3D(_,e,i,r,s,n,a,o,u.internalFormat,l);else{const T=l;S.texSubImage3D(_,e,i,r,s,n,a,o,f,g,T)}d.bindTexture(x,Ha.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(e.width===0||e.height===0)return;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new q("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,oI(e)}e.samplingMode===9729?(this._samplingModeDirty=!0,e.samplingMode=9985):e.samplingMode===9728&&(this._samplingModeDirty=!0,e.samplingMode=9984);const i=this._descriptor.context.bindTexture(this,Ha.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ha.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,Ha.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new q("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,oI(e)}e.samplingMode===9985?(this._samplingModeDirty=!0,e.samplingMode=9729):e.samplingMode===9984&&(this._samplingModeDirty=!0,e.samplingMode=9728)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,oI(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?9729:9728),oI(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=Rs(this._compressionAbortController)}_setData(e,i){const r=this._descriptor,s=r.context?.gl;if(!s)return;Au(s),this.hasWebGLTextureObject||(this._glName=s.createTexture(),r.context.instanceCounter.increment(mn.Texture,this)),oI(r);const n=r.context.bindTexture(this,Ha.TEXTURE_UNIT_FOR_UPDATES);r.context.setActiveTexture(Ha.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),Au(s);const a=i??r.target,o=PC(a);if(wxe(e))this._setDataFromTexImageSource(e,a);else{const{width:l,height:u,depth:d}=r;if(l==null||u==null)throw new q("texture:missing-size","Width and height must be specified!");if(o&&d==null)throw new q("texture:missing-depth","Depth must be specified!");if(r.internalFormat=sV(r),r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(a,r.internalFormat,r.hasMipmap,l,u,d),ZM(e)){if(!Tze(r.internalFormat))throw new q("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(e,r.internalFormat,a)}else this._texImage(a,0,r.internalFormat,l,u,d,e),Au(s),r.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),Au(s),r.context.bindTexture(n,Ha.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let i=34069;i<=34074;i++)this._setData(e,i)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_setDataFromTexImageSource(e,i){const{gl:r}=this._descriptor.context,s=this._descriptor;s.internalFormat=sV(s);const n=PC(i),{width:a,height:o,depth:l}=ubt(e);s.width&&s.height,s.width||(s.width=a),s.height||(s.height=o),n&&s.depth,n&&(s.depth=l),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,s.internalFormat,s.hasMipmap,a,o,l),this._texImage(i,0,s.internalFormat,a,o,l,e),Au(r),s.hasMipmap&&(this.generateMipmap(),Au(r))}_setDataFromCompressedSource(e,i,r){const s=this._descriptor,{width:n,height:a,depth:o}=s,l=e.levels,u=xxe(r,n,a,o),d=Math.min(u,l.length)-1;this._descriptor.context.gl.texParameteri(s.target,33085,d),this._forEachMipmapLevel((f,g,v,_)=>{const x=l[Math.min(f,l.length-1)];this._compressedTexImage(r,f,i,g,v,_,x)},d)}_texStorage(e,i,r,s,n,a){const{gl:o}=this._descriptor.context;if(!lbt(i)&&!she(i)&&!Sze(i))throw new q("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?xxe(e,s,n,a):1;if(PC(e)){if(a==null)throw new q("texture:missing-depth","Missing depth dimension for 3D texture upload");o.texStorage3D(e,l,i,s,n,a)}else o.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,a,o){const l=this._descriptor.context.gl,u=PC(e),{isImmutable:d,pixelFormat:f,dataType:g}=this._descriptor;if(d){if(o!=null){const v=o;if(u){if(a==null)throw new q("texture:missing-depth","Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,a,f,g,v)}else l.texSubImage2D(e,i,0,0,s,n,f,g,v)}}else{const v=o;if(u){if(a==null)throw new q("texture:missing-depth","Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,a,0,f,g,v)}else l.texImage2D(e,i,r,s,n,0,f,g,v)}}_compressedTexImage(e,i,r,s,n,a,o){const l=this._descriptor.context.gl,u=PC(e);if(this._descriptor.isImmutable){if(o!=null)if(u){if(a==null)throw new q("texture:missing-depth","Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,a,r,o)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,o)}else if(u){if(a==null)throw new q("texture:missing-depth","Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,a,0,o)}else l.compressedTexImage2D(e,i,r,s,n,0,o)}async _compressOnWorker(e){const{width:i,height:r,context:s,flipped:n,preMultiplyAlpha:a,hasMipmap:o}=this._descriptor,l=this._descriptor.compress?.compressionTracker,u=this._descriptor.compress?.compressionCallback,{compressedTextureETC:d,compressedTextureS3TC:f}=s.capabilities;if(!Ha.compressionWorkerHandle?.isCompressible(e,this._descriptor)||!d&&!f)return;this.abortCompression();const g=new AbortController;let v;this._compressionAbortController=g,l?.increment();try{e instanceof Uint8Array?v=e.buffer:(v=await createImageBitmap(e,{imageOrientation:n?"flipY":"none"}),ct(g));const _={data:v,width:i,height:r,needsFlip:e instanceof Uint8Array&&this.descriptor.flipped,components:this._descriptor.pixelFormat===6408?4:3,preMultiplyAlpha:a,hasMipmap:o,hasETC:!!d,hasS3TC:!!f},x=await Ha.compressionWorkerHandle.invoke(_,g.signal,"low");if(ct(g),x.compressedTexture&&this.hasWebGLTextureObject){const S=this.usedMemory;this._descriptor.internalFormat=x.internalFormat,this._setData(x.compressedTexture),u?.(S-this.usedMemory)}}catch(_){Zr(_)||Oy().error("Texture compression failed!")}finally{l?.decrement(),this._compressionAbortController?.signal.aborted&&(this._compressionAbortController=null),v instanceof ImageBitmap&&v.close()}}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:a,target:o}=this._descriptor;const l=o===32879;if(r==null||s==null||l&&n==null)throw new q("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let u=0;e(u,r,s,n),a&&(r!==1||s!==1||l&&n!==1)&&!(u>=i);++u)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}_applySamplingMode(){const e=this._descriptor,i=e.context?.gl;let r=e.samplingMode,s=e.samplingMode;r===9985||r===9987?(r=9729,e.hasMipmap||(s=9729)):r!==9984&&r!==9986||(r=9728,e.hasMipmap||(s=9728)),i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,r),i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,s)}_applyWrapMode(){const e=this._descriptor,i=e.context?.gl;typeof e.wrapMode=="number"?(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode)):(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode.s),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){const e=this._descriptor,i=e.context?.gl,r=e.compareEnabled?i.COMPARE_REF_TO_TEXTURE:i.NONE;i.texParameteri(e.target,i.TEXTURE_COMPARE_MODE,r),e.compareEnabled&&i.texParameteri(e.target,i.TEXTURE_COMPARE_FUNC,i.GREATER),Au(i)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,i=e.context.capabilities.textureFilterAnisotropic;i&&e.context.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}},Ha.TEXTURE_UNIT_FOR_UPDATES=0,Ha.compressionWorkerHandle=null,Ha);const JJ=()=>re.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function pbt(t,e){e.fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=(1-t.haloBlur)*t.haloWidth,e.outerHaloWidth=t.haloBlur*t.haloWidth/2,e.innerHaloWidth=t.haloBlur*t.haloWidth/2,e.outlinePosition=0}const fbt=[0,0,0,0];let Cze=class{constructor(){this.type="single",this._highlightOptions=new jg,this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0},this._optionsShadeTexKey="",this._texelData=new Uint8Array(4*nI),this._minMaxDistance=[0,0]}setHighlightOptions(e){this._highlightOptions=e}applyHighlightOptions(e,i){this._updateGradientTexture(e),e.bindTexture(this._shadeTex,X_t),i.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<vze)-1,activeGradient:this}]}_updateGradientTexture(e){const i=mbt(this._highlightOptions);if(i===this._optionsShadeTexKey)return;this._optionsShadeTexKey=i,pbt(this._highlightOptions,this._convertedHighlightOptions);const r=this._convertedHighlightOptions,s=r.outlinePosition-r.outlineWidth/2-r.outerHaloWidth,n=r.outlinePosition-r.outlineWidth/2,a=r.outlinePosition+r.outlineWidth/2,o=r.outlinePosition+r.outlineWidth/2+r.innerHaloWidth,l=Math.sqrt(Math.PI/2)*ibt,u=Math.abs(s)>l?Math.round(10*(Math.abs(s)-l))/10:0,d=Math.abs(o)>l?Math.round(10*(Math.abs(o)-l))/10:0;let f;u&&!d?JJ().error("The outer rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!u&&d?JJ().error("The inner rim of the highlight is "+d+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):u&&d&&JJ().error("The highlight is "+Math.max(u,d)+"px away from the edge of the feature; consider reducing some width values.");const g=[void 0,void 0,void 0,void 0];function v(x,S,T){g[0]=(1-T)*x[0]+T*S[0],g[1]=(1-T)*x[1]+T*S[1],g[2]=(1-T)*x[2]+T*S[2],g[3]=(1-T)*x[3]+T*S[3]}const{_texelData:_}=this;for(let x=0;x<nI;++x)f=s+x/(nI-1)*(o-s),f<s?(g[0]=0,g[1]=0,g[2]=0,g[3]=0):f<n?v(fbt,r.outlineColor,(f-s)/(n-s)):f<a?[g[0],g[1],g[2],g[3]]=r.outlineColor:f<o?v(r.outlineColor,r.fillColor,(f-a)/(o-a)):[g[0],g[1],g[2],g[3]]=r.fillColor,_[4*x]=255*g[0],_[4*x+1]=255*g[1],_[4*x+2]=255*g[2],_[4*x+3]=255*g[3];if(this._minMaxDistance[0]=s,this._minMaxDistance[1]=o,!this._shadeTex){const x=new ar(nI,1);x.wrapMode=33071,this._shadeTex=new qi(e,x)}this._shadeTex.updateData(0,0,0,nI,1,this._texelData)}};function mbt(t){return`${t.color};${t.haloColor};${t.haloOpacity};${t.fillOpacity};${t.haloWidth};${t.haloBlur}`}let gbt=class{constructor(){this.type="multi",this.gradients=[]}setHighlightOptions(e){for(let i=0;i<e.length;i++)this.gradients[i]||(this.gradients[i]=new Cze),this.gradients[i].setHighlightOptions(e[i]);for(let i=e.length+1;i<this.gradients.length;i++)this.gradients[i].destroy();this.gradients.length=e.length}destroy(){for(const e of this.gradients)e.destroy()}getReasonsWithGradients(){let e=1;const i=[];for(let r=0;r<this.gradients.length;r++){const s=this.gradients[r];i.push({activeReasons:e,activeGradient:s}),e<<=1}return i}};const Mze={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{compare:514,mask:255,op:{fail:7680,zFail:7680,zPass:7681}}}},ybt={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},vbt={...Mze,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};function _bt({pixelRatio:t,state:e,displayLevel:i,requiredLevel:r},s){const n=1/2**(i-s.key.level),a=1/2**(r-s.key.level);return{displayMat3:e.displayMat3,displayViewMat3:e.displayViewMat3,displayViewScreenMat3:s.transforms.displayViewScreenMat3,viewMat3:e.viewMat3,tileMat3:s.transforms.tileMat3,displayZoomFactor:n,requiredZoomFactor:a,tileOffset:[s.x,s.y],currentScale:e.scale,currentZoom:i,metersPerSRUnit:Yr(e.spatialReference),rotation:e.rotation,pixelRatio:t}}function Eze(t){return t.passOptions?.type==="highlight"}function Aze(t){return t.passOptions?.type==="hittest"}function bbt(t){if(!Aze(t))return null;const{position:e,distance:i,smallSymbolDistance:r,smallSymbolSizeThreshold:s}=t.passOptions;return{position:e,distance:i,smallSymbolDistance:r,smallSymbolSizeThreshold:s}}function wbt(t){if(!Eze(t))return null;const{activeReasons:e,highlightAll:i}=t.passOptions;return{activeReasons:e,highlightAll:i?1:0}}function sdi(t,e,i){const r={};for(const s in i)typeof i[s]!="function"?r[s]=i[s]:r[s]=i[s](t,e);return r}function ndi(t,e){const{attributeView:i,context:r}=t;return{storage:i.getUniforms(r),view:_bt(t,e),hittestRequest:bbt(t),highlight:wbt(t)}}function adi(t){return{inside:t.selection===2,outside:t.selection===3}}function xbt(t){return Aze(t)?ybt:Eze(t)&&t.passOptions.stepType==="clear"?vbt:Mze}function odi(t){const{row:e,col:i}=t.key,r=i*bxe,s=e*bxe;return{tileOffsetFromLocalOrigin:[r%rV,s%rV],maxIntsToLocalOrigin:[Math.floor(r/rV),Math.floor(s/rV)]}}const Sbt=new ii({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function ldi(t){return Sbt.toJSON(t)}function cdi(t){const{bandCount:e,attributeTable:i,colormap:r,pixelType:s}=t.raster.rasterInfo;return e===1&&(i!=null||r!=null||s==="u8"||s==="s8")}function Tbt(t,e){return e==null?(t?.destroy(),null):(t?.type==="single"&&Array.isArray(e)&&(t.destroy(),t=null),t?.type!=="multi"||Array.isArray(e)||(t.destroy(),t=null),t||(t=Array.isArray(e)?new gbt:new Cze),Array.isArray(e)?t.type==="multi"&&t.setHighlightOptions(e):t.type==="single"&&t.setHighlightOptions(e),t)}function udi(t,e,i,r){const{painter:s,highlightGradient:n}=t,{highlight:a}=s.effects;if(!n)return;const o=t.passOptions,l=n.getReasonsWithGradients();for(let u=0;u<l.length;u++){const d={...t,passOptions:{type:"highlight",activeGradient:l[u].activeGradient,activeReasons:l[u].activeReasons,stepType:"burn",highlightAll:e}};if(a.bind(d),i(d),u<l.length-1){let g=0;for(let v=u+1;v<l.length;v++)g|=l[v].activeReasons;i({...t,passOptions:{type:"highlight",activeGradient:l[u].activeGradient,activeReasons:g,stepType:"clear",highlightAll:e}})}const f={...t,passOptions:{type:"highlight",activeGradient:l[u].activeGradient,activeReasons:l[u].activeReasons,stepType:"draw",highlightAll:e}};s.setPipelineState(xbt(t)),s.updatePipelineState(t.context),a.draw(f),a.unbind()}t.passOptions=o}const nV=t=>parseFloat(t)/100;function $bt(t,e,i){const r=typeof t.left=="string"?nV(t.left)*e:t.left,s=typeof t.right=="string"?nV(t.right)*e:t.right,n=typeof t.top=="string"?nV(t.top)*i:t.top,a=typeof t.bottom=="string"?nV(t.bottom)*i:t.bottom,o=n;return{xmin:r,xmax:Math.max(e-s,r),ymin:o,ymax:Math.max(i-a,n)}}function Oze(t,e,i,r){switch(e.type){case"rect":{const{width:s,height:n}=t,{xmin:a,xmax:o,ymin:l,ymax:u}=$bt(e,s,n),{x:d,y:f}=i;return d>a&&d<o&&f>l&&f<u}case"path":return e.path.length===0||!Array.isArray(e.path[0][0])||gce(e.path,[i.x,i.y]);case"geometry":return e.geometry==null||(e.geometry.type==="polygon"?mce(e.geometry,r):tF(e.geometry,r))}}function LU(t){if(!t.highlights)return null;const e=t.highlights.findIndex(i=>i.name==="default");return e===-1?null:t.highlights.items[e]}function Cbt(t,e){if(!t.highlights){if(!e)return;t.highlights=new ke([new jg])}const i=t.highlights.findIndex(r=>r.name==="default");e?t.highlights.items[i].assignFrom(e):(t.highlights.removeAt(i),t.highlights.length===0&&(t.highlights=null))}async function Mbt(t,e,i){const r=kq(e)?Dq(t,e):e;if(!t.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let s=new Set;const n=new Set;let a=!1,o=null,l=null;i?.include?Txe(i.include,Sxe(t,g=>{s.add(g),QJ(g,v=>n.add(v))},(g,v)=>{n.add(g),s.add(v)},g=>{o||(o=new Set),o.add(g)},g=>s.add(g),()=>a=!0)):(a=!0,s=new Set(t.allLayerViews),s.forEach(g=>{QJ(g,v=>n.add(v))})),i?.exclude&&Txe(i.exclude,Sxe(t,g=>{s.delete(g),QJ(g,v=>n.delete(v))},g=>n.delete(g),g=>{l||(l=new Set),l.add(g)}));const u=t.toMap(r),d=t.allLayerViews.filter(g=>!g.suspended&&s.has(g)&&g.clips.every(v=>Oze(t,v,r,u))).reverse();let f=[...a?t.graphicsView.hitTest(u).map(g=>({type:"graphic",graphic:g,layer:null,mapPoint:u})):[],...await Promise.all(d.map(g=>g.hitTest(u,r)).toArray())].filter(wl).flat().filter(wl);return f=f.filter(g=>g.type!=="graphic"||g.layer?.type!=="subtype-group"||n.has(g.graphic.layer)),o&&(f=f.filter(g=>!("graphic"in g)||!g.graphic||o?.has(rse(g.graphic)))),l&&(f=f.filter(g=>!("graphic"in g)||!g.graphic||!l?.has(rse(g.graphic)))),{screenPoint:r,results:f}}function Sxe(t,e,i,r,s,n){return a=>{if(a instanceof ms){if(a.layer===t)n?.();else{const o=t.allLayerViews.find(l=>l.layer===a.layer);o&&s?.(o)}r(rse(a))}else if(!("layer"in a&&"element"in a))if(a.type==="subtype-sublayer"){const o=t.allLayerViews.find(l=>l.layer===a.parent);o&&i(a,o)}else{const o=t.allLayerViews.find(l=>l.layer===a);o&&e(o)}}}function Txe(t,e){if(t)if(oO(t))for(const i of t)if(oO(i))for(const r of i)e(r);else e(i);else e(t)}function rse(t){const e=t.getObjectId();return e?`${t.layer?.uid??t.sourceLayer?.uid??"MapView"}/${e}`:`"MapView/${t.uid}`}function QJ(t,e){const i=t.layer;i?.type==="subtype-group"&&i.sublayers.forEach(r=>{e(r)})}let lI=null,Yq=!0;function FU(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(Yq)try{return new ImageData(t,e)}catch{Yq=!1}return Pze(t,e,i)}function hdi(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(Yq)try{return new ImageData(t,e,i)}catch{Yq=!1}const s=Pze(e,i,r);return s.data.set(t,0),s}function Ebt(){return lI||(lI=document.createElement("canvas"),lI.width=1,lI.height=1),lI}function Pze(t,e,i){return i||(i=Ebt()),i.getContext("2d").createImageData(t,e)}async function Abt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await Si(i,{...e,responseType:"image"});return r}catch(r){throw Zr(r)?r:new q("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function ddi(t,e){const{arrayBuffer:i,mediaType:r}=await Obt(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:a}=await W(()=>import("./gif-CdyIzyrs.js"),[]);if(n(i))return a(i,e)}if(s){const{isAnimatedPNG:n,parseApng:a}=await W(()=>import("./apng-yIpN8Q5_.js"),__vite__mapDeps([263,8]));if(n(i))return a(i,e)}return Abt(new Blob([i],{type:r}),e)}async function Obt(t,e){const i=GT(t);if(i?.isBase64)return{arrayBuffer:fRe(i.data),mediaType:i.mediaType};const r=await Si(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader?.("Content-Type")??""}}const $xe=2048,Pbt=1.5,Rbt=8;function Rze(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},a=nhe(t,e.padding),o=Fbt(t,{width:e.width-a.left-a.right,height:e.height-a.top-a.bottom}),{width:l,height:u}=Lbt(t,o),d=jze(i),f=Uze[d];return{format:d,quality:Ce(r??f,0,100),area:o,width:l,height:u,rotation:s,disableDecorations:!!n,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function Ibt(t,e){const i=Rze(t,e),r=i.area,s=i.width/r.width,n=nhe(i,e.padding),a=n.left+n.right,o=n.top+n.bottom,l=e.width-a,u=e.height-o,d=Math.floor(l*s+a),f=Math.floor(u*s+o),g=t?.layers??[],v=i.ignoreBackground,_=i.ignorePadding;return{framebufferWidth:d,framebufferHeight:f,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:g,disableDecorations:i.disableDecorations,ignoreBackground:v,ignorePadding:_,olidColor:!1}}function Ize(t,e,i){const{ctx:r,canvas:s}=kze(t,i),n=r.getImageData(0,0,t.width,t.height),a=Fze(s,e);return Lze(s),{dataUrl:a,data:n}}function Dze(t,e){const{ctx:i,canvas:r}=kze(t,e),s=i.getImageData(0,0,t.width,t.height);return Lze(r),s}function kze(t,e){const i=Dbt();e.premultipliedAlpha&&jbt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Vbt(r),{ctx:r,canvas:i}}function Lze(t){t.width=0,t.height=0}function Dbt(){return XJ==null&&(XJ=document.createElement("canvas")),XJ}let XJ=null;function Fze(t,e){const i=Ubt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function zze(t,e){const i=jze(t),r=Uze[i];return{format:i,quality:Ce(e??r,0,100)}}function Nze(t,e){return e/Math.max(t[0],t[1])}function Vze(t,e,i,r=0,s=0,n=t.width-r,a=t.height-s,o=!1){const{data:l}=t,{width:u,height:d,data:f}=e,g=n/u,v=a/d,_=Math.ceil(g/2),x=Math.ceil(v/2),S=t.width;for(let T=0;T<d;T++)for(let M=0;M<u;M++){const E=4*(M+(o?d-T-1:T)*u);let P=0,O=0,D=0,L=0,F=0,j=0;const N=(T+.5)*v;for(let B=Math.floor(T*v);B<(T+1)*v;B++){const U=Math.abs(N-(B+.5))/x,Q=(M+.5)*g,H=U*U;for(let J=Math.floor(M*g);J<(M+1)*g;J++){const Z=Math.abs(Q-(J+.5))/_,K=Math.sqrt(H+Z*Z);if(K>=1)continue;let ee=2*K*K*K-3*K*K+1;const _e=4*(r+J+(s+B)*S);j+=ee*l[_e+3],O+=ee,!i&&l[_e+3]<255&&(ee=ee*l[_e+3]/255),D+=ee*l[_e],L+=ee*l[_e+1],F+=ee*l[_e+2],P+=ee}}f[E]=D/P,f[E+1]=L/P,f[E+2]=F/P,f[E+3]=j/O}return e}function kbt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:a}=t,o=nhe(t,i),l=o.left+o.right,u=o.top+o.bottom,d=r-l,f=s-u,g=Math.min(Rbt,Math.min(($xe-l)/d,($xe-u)/f));return g<Pbt?t:{...t,framebufferWidth:Math.round(d*g)+l,framebufferHeight:Math.round(f*g)+u,pixelRatio:n*g,resample:{region:{x:Math.round((a.x-o.left)*g)+o.left,y:Math.round((a.y-o.top)*g)+o.top,width:Math.round(a.width*g),height:Math.round(a.height*g)},width:r,height:s}}}function Lbt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function Fbt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t?.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return zbt(Nbt(i,t),e)}function zbt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,a=t.width/t.height;if(a===n)return s;if(a>n){const u=Math.floor(s.width/a),d=s.height-u;return{x:s.x,y:Math.floor(s.y+d/2),width:s.width,height:u}}const o=Math.floor(s.height*a),l=s.width-o;return{x:Math.floor(s.x+l/2),y:s.y,width:o,height:s.height}}function Nbt(t,e){if(e?.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function nhe(t,e){return!e||t?.ignorePadding?qbt:e}function jze(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Bbt}}function Vbt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function jbt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const Ubt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Cxe=98,Bbt="png",Uze={png:100,jpg:Cxe,jpeg:Cxe},qbt={top:0,right:0,bottom:0,left:0},cI=Object.freeze(Object.defineProperty({__proto__:null,completeUserSettings:Rze,createEmptyImageData:FU,encode:Ize,encodeData:Dze,getFormatAndQuality:zze,getMaximumResolutionScale:Nze,resampleHermite:Vze,screenshotSuperSampleSettings:kbt,toDataUrl:Fze,toRenderSettings:Ibt},Symbol.toStringTag,{value:"Module"})),Bze={flipY:!0,premultipliedAlpha:!0};async function Gbt(t,e){const i=await qze(t,e),{format:r,quality:s}=zze(e?.format,e?.quality);return Ize(i,{format:r,quality:s},Bze)}async function Hbt(t,e){const i=await qze(t,e);return Dze(i,Bze)}function qze(t,e){const i=Ybt(e||{},Zbt(t.stage,t.size),t.size,t.padding),r=Wbt(e,t.allLayerViews);return t.stage.takeScreenshot(i,r,t.backgroundColor,e?.rotation)}function Wbt(t={},e){if(!t.layers)return;const i=[];return t.layers.forEach(r=>{const s=e.find(n=>n.layer.id===r.id);s?.container&&i.push(s.container)}),i}function Zbt(t,e){return Math.min(4,Nze(e,Math.min(4096,t.context.parameters.maxTextureSize)))}function Ybt(t,e,i,r){t.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let s=null;t.width!=null&&t.height!=null?s=[t.width,t.height]:t.width==null&&t.height!=null?s=[t.height,t.height]:t.width!=null&&t.height==null?s=[t.width,t.width]:t.width==null&&t.height==null&&(s=null);const n=i[0]-(r.left+r.right),a=i[1]-(r.top+r.bottom);let o,l,u=t.area||{x:0,y:0,width:n,height:a};if(s){const d=n/a,f=s[0]/s[1];if(f>d){const g=u.width/f;u={x:u.x,y:Math.round(u.y+(u.height-g)/2),width:u.width,height:Math.round(g)}}else{const g=u.height*f;u={x:Math.round(u.x+(u.width-g)/2),y:u.y,width:Math.round(g),height:u.height}}}else s=[u.width,u.height];return s[0]>u.width?(o=Math.min(s[0]/u.width,e),l=s[0]/u.width/o):(o=1,l=s[0]/u.width),{cropArea:{x:Math.round((u.x+r.left)*o),y:Math.round((u.y+r.top)*o),width:Math.round(u.width*o),height:Math.round(u.height*o)},outputScale:l,resolutionScale:o}}const Jbt=t=>t.includes("Brush");let Gze=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),Jbt(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};const Mxe=Symbol("analyses-owner-handles");let xb=class extends be{constructor(e){super(e),this._allAnalysisViews=new ke,this._creatingViewCount=0,this._attachedToViewResolver=Exe(),this._items=new Map,this._moduleMap=new Map,this._scheduledUpdateHandle=null,this._emitOnView=(i,r)=>this.view.emit(i,r)}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(ti("AnalysisViewManager was destroyed")),this._set("view",null)}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(ti()),this._attachedToViewResolver=Exe()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===1)throw new q("AnalysisViewManager:no-analysis-view-for-analysis","The analysis does not exist in view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),Mxe)}_disconnectOwners(){this.removeHandles(Mxe),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return bi(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:0,list:0},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=sc(s=>this._createAnalysisViewPromise(r,s).then(n=>(this._emitOnView("analysis-view-create",{analysis:e,analysisView:n}),n),n=>{throw this._emitOnView("analysis-view-create-error",{analysis:e,error:n}),n}))}else i.state.list=0}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=1,this._scheduleUpdate()):re.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=uP(()=>this._update()))}_update(){this._scheduledUpdateHandle=Xi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list!==1)return;const{analysis:i,view:r}=e;switch(this._items.delete(i),e.state.view){case 0:e.createAnalysisViewTask=Rs(e.createAnalysisViewTask);break;case 1:r!=null&&(this._allAnalysisViews.remove(r),e.view=Pe(r),e.createAnalysisViewTask=null,this._emitOnView("analysis-view-destroy",{analysis:i,analysisView:r}))}})}async _createAnalysisViewPromise(e,i){const{analysis:r}=e;if(this._creatingViewCount+=1,!this._moduleMap.has(r.type))try{this._moduleMap.set(r.type,await this.importAnalysisViewModule(r))}catch{throw this._creatingViewCount-=1,new q("AnalysisViewManager:no-analysis-view-for-analysis",`Analysis of type "${r.type}" is not supported`)}if(sa(i))throw this._creatingViewCount-=1,ti("AnalysisView creation aborted");const s=new(this._moduleMap.get(r.type)).default({analysis:r,view:this.view});let n=!0;Mo(i,()=>{n&&this._destroyAnalysisView(r,s)});try{await s.when()}catch(a){throw n=!1,this._destroyAnalysisView(r,s),a}if(sa(i))throw ti();return n=!1,e.view=s,e.state.view=1,this._allAnalysisViews.add(s),this._creatingViewCount-=1,s}_destroyAnalysisView(e,i){i.destroyed||(this._creatingViewCount-=1,i.destroy(),this._emitOnView("analysis-view-destroy",{analysis:e,analysisView:i}))}};c([p()],xb.prototype,"updating",null),c([p({constructOnly:!0})],xb.prototype,"importAnalysisViewModule",void 0),c([p({constructOnly:!0})],xb.prototype,"view",void 0),c([p()],xb.prototype,"_allAnalysisViews",void 0),c([p()],xb.prototype,"_creatingViewCount",void 0),xb=c([R("esri.views.support.AnalysisViewManager")],xb);const Hze=xb;function Exe(){const t=Eo();return t.promise.catch(()=>{}),t}let Qbt=class{constructor(e){this.getUnmaskedRenderer=e}};function Wze(t){const e=t.getExtension("WEBGL_debug_renderer_info");return e?new Qbt(()=>t.getParameter(e.UNMASKED_RENDERER_WEBGL)):null}let Axe;function Xbt(){return Axe??=twt(),Axe}let Kbt=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1,this.unmaskedRenderer="unloaded"}};function ewt(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=e.getContext("webgl2"),i!=null&&(t.majorPerformanceCaveat=!0,t.unmaskedRenderer=Wze(i)?.getUnmaskedRenderer()??"unknown")),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function twt(){const t=new Kbt,e=ewt(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function Zze(t){const e=Xbt();return e.available?t==="3d"&&e.majorPerformanceCaveat?new q("webgl:major-performance-caveat-detected",`Your WebGL implementation (${e.unmaskedRenderer}) doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.`):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new q("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new q("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new q("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function iwt(t){return t&&"nodeType"in t}function rwt(t){return t&&typeof t.render=="function"}const Oxe={component:"esri-component"};let o2=class extends be{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(Oxe.component),i&&i.classList.remove(Oxe.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||iwt(e)?(this._set("widget",null),w7(e)):(rwt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};c([p()],o2.prototype,"id",null),c([p()],o2.prototype,"node",null),c([wi("node")],o2.prototype,"castNode",null),c([p({readOnly:!0})],o2.prototype,"widget",void 0),o2=c([R("esri.views.ui.Component")],o2);const L4=o2,swt="--esri-calcite-mode-name";function nwt(){const t=getComputedStyle(document.body).getPropertyValue(swt).replaceAll(/\W/g,"").toLowerCase();return t==="dark"||t==="light"?t:void 0}const Yze="calcite-mode-";function Jze(t){return nwt()??jKe(t??document.body)}function vdi(t){return Jze(t)==="dark"}function awt(t){return`${Yze}${Jze(t)}`}function owt(t){const e=awt(t);lwt(t),t.classList.add(e)}function lwt(t){Array.from(t.classList).forEach(e=>{e.startsWith(Yze)&&t.classList.remove(e)})}const B7=new Map;function ahe(){B7.clear()}function cwt(t){return B7.get(t)}function uwt(t,e){B7.set(t,e)}function KJ(t){B7.delete(t)}function hwt(...t){const e=Lc.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const a in s)s[a]&&e.push(a)}const i=e.join(" ");return Lc.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{ahe();for(const s of r)t.get(s.target)?.(s)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),bi(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let a=null;return Yu([X(()=>typeof r=="function"?r():r,o=>{a?.remove(),o&&(a=i(o,s,n))},bt),bi(()=>a?.remove())])}})();function dwt(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function _di(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function bdi(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function pwt(t){return t==="Enter"||t===" "}async function fwt(t,e){await ktt(qL(e));const i=typeof t=="function"?t():t;i&&("setFocus"in i&&typeof i.setFocus=="function"?await i.setFocus():i instanceof HTMLElement&&i.focus())}const mwt={left:0,top:0,bottom:0,right:0},Qze={bottom:30,top:15,right:15,left:15},Py="esri-ui",nu={ui:Py,corner:`${Py}-corner`,innerContainer:`${Py}-inner-container`,manualContainer:`${Py}-manual-container`,cornerContainer:`${Py}-corner-container`,topLeft:`${Py}-top-left`,topRight:`${Py}-top-right`,bottomLeft:`${Py}-bottom-left`,bottomRight:`${Py}-bottom-right`};function gwt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function aV(t){return t===0?"0":`${t}px`}function eQ(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function tQ(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let Jm=class extends Ju{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=Vu(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&tQ(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&tQ(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([X(()=>[this.view?.padding,this.container],this._applyViewPadding,Yt),X(()=>this.padding,this._applyUIPadding,Yt),X(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Yt),Ice(e=>{this._locale=e})])}destroy(){this.removeAllHandles(),this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear(),this.view=null,this._set("view",null)}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(nu.ui),owt(e),this._attachContainers(e)),i&&(i.classList.remove(nu.ui),tQ(i,{top:"",bottom:"",left:"",right:""}),i.textContent=""),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...Qze,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(o=>this.add(o,i));const a=eQ(e);a&&({index:r,position:i,component:e,key:s}=a),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r??this._getNumComponentsAtPosition(i),s,n)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,i));const r=this._find(e);if(r){const s=this._componentMap.get(r);if(!s||s.key!==i)return;const n=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(r),r.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.forEach(o=>{const l=this._componentMap.get(o);l&&l.position===s.position&&l.index>s.index&&l.index--}),this._components.splice(n,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>n==null?!1:!(this._componentMap.get(n)?.internal??!1)||i.removeInternal);for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(a=>this.move(a,i)),!e)return;let r;const s=eQ(e)||eQ(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>i.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof L4||(e=new L4({node:e}));const{widget:a}=e;a!=null&&a instanceof be&&a.addHandles(bi(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey);const o=this._positionNameToContainerLookup[i];this._components.some(l=>{const u=this._componentMap.get(l)?.position,d=u?this._positionNameToContainerLookup[u]:null;return o===d&&this._componentMap.get(l)?.index===r})&&this._components.forEach(l=>{const u=this._componentMap.get(l),d=u?.position,f=d?this._positionNameToContainerLookup[d]:null;u&&f===o&&u.index>=r&&u.index++}),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,position:i,internal:n,index:r})}_find(e){return e?e instanceof L4?this._findByComponent(e):typeof e=="string"?this._findById(e):"domNode"in e?this._findByNode(e.domNode):this._findByNode(e):null}_getViewPadding(){return this.view?.padding??mwt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(nu.innerContainer,nu.cornerContainer);const i=document.createElement("div");i.classList.add(nu.innerContainer,nu.manualContainer);const r=document.createElement("div");r.classList.add(nu.topLeft,nu.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(nu.topRight,nu.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(nu.bottomLeft,nu.corner),e.appendChild(n);const a=document.createElement("div");a.classList.add(nu.bottomRight,nu.corner),e.appendChild(a),this._innerContainer=e,this._manualContainer=i;const o=dwt();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":a,"top-leading":o?s:r,"top-trailing":o?r:s,"bottom-leading":o?a:n,"bottom-trailing":o?n:a},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],a=s!=null&&s>-1;if(gwt(r.widget)&&r.widget.startup(),!a)return void n.appendChild(r.node);const o=Array.from(n.children);if(o.length!==0){for(const l of o){const u=this._findByNode(l);if(u&&s<(this._componentMap.get(u)?.index??0))return void l.parentNode?.insertBefore(r.node,l)}n.appendChild(r.node)}else n.appendChild(r.node)}_toPixelPosition(e){return{top:aV(e.top),left:aV(e.left),right:aV(e.right),bottom:aV(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return e?this._components.find(({node:i})=>i===e):null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(wl).filter(s=>i.includeInternal||!this._componentMap.get(s)?.internal).map(({widget:s,node:n})=>s??n)}_getNumComponentsAtPosition(e){return this._positionNameToContainerLookup[e]?.children.length??0}};c([p()],Jm.prototype,"_locale",void 0),c([p()],Jm.prototype,"container",null),c([p()],Jm.prototype,"height",null),c([p({value:Qze})],Jm.prototype,"padding",null),c([wi("padding")],Jm.prototype,"castPadding",null),c([p()],Jm.prototype,"view",void 0),c([p()],Jm.prototype,"width",null),Jm=c([R("esri.views.ui.UI")],Jm);const ywt=Jm,vwt={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},_wt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.startsWith("-")?t.style.setProperty(e,i):t.style[e]=i}},bwt=t=>({..._wt,...t}),wwt=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},xwt=(t,e)=>t.find(e),Pxe=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const a=r?.children?xwt(r.children,o=>o.domNode===s):void 0;i&&!a&&n!==e.length-1||(r=a)}),r},Swt=t=>{let e;const i={...vwt,...t},r=bwt(i),s=r.performanceLogger;let n,a=!0,o=!1;const l=[],u=[],d=(g,v,_)=>{let x;r.eventHandlerInterceptor=(T,M,E,P)=>function(O){let D;s("domEvent",O);const L=wwt(O.currentTarget,x.domNode),F=L.some(N=>customElements.get(N?.tagName?.toLowerCase()));if(O.eventPhase===Event.CAPTURING_PHASE||!F)L.reverse(),D=Pxe(x.getLastRender(),L);else{const N=O.composedPath(),B=N.slice(N.indexOf(O.currentTarget),N.indexOf(x.domNode)).reverse();D=Pxe(x.getLastRender(),B,!0)}let j;return D&&(j=i.handleInterceptedEvent(e,D,this,O)),s("domEventProcessed",O),j},i.postProcessProjectionOptions?.(r);const S=_();x=g(v,S,r),r.eventHandlerInterceptor=void 0,l.push(x),u.push(_),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(x,S)};let f=()=>{if(n=void 0,a){a=!1,s("renderStart",void 0);for(let g=0;g<l.length;g++){const v=u[g]();s("rendered",void 0);try{l[g].update(v)}catch(_){console.error(_)}s("patched",void 0)}s("renderDone",void 0),a=!0}};return i.modifyDoRenderImplementation&&(f=i.modifyDoRenderImplementation(f,l,u)),e={renderNow:f,scheduleRender:()=>{n||o||(n=requestAnimationFrame(f))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),o=!0},resume:()=>{o=!1,a=!0,e.scheduleRender()},append:(g,v)=>{d(dw.append,g,v)},insertBefore:(g,v)=>{d(dw.insertBefore,g,v)},merge:(g,v)=>{d(dw.merge,g,v)},replace:(g,v)=>{d(dw.replace,g,v)},detach:g=>{for(let v=0;v<u.length;v++)if(u[v]===g)return u.splice(v,1),l.splice(v,1)[0];throw new Error("renderFunction was not found")}},e};let Xze=!1;const Twt=t=>{Xze=!0,zXe(t)};let Kze;function $wt(){Xze||Twt(ku(Qs(Kze)))}function F1(t){const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push(t[i]?.());return e.length>0?Promise.all(e):null}Kze="components/assets";const eNe=Symbol("widget"),tNe=Symbol("widget-test-data"),Cwt=[],Mwt={},Jq=new WeakMap;function iNe(t,e){let i=e.children;if(i?.length)for(let s=0;s<i.length;++s)i[s]=iNe(t,i[s]);else i=Cwt;const r=e.vnodeSelector;if(Qq(r)){const s=e.properties||Mwt,n=s.key||r,a={key:n,afterCreate:Ewt,afterUpdate:Awt,afterRemoved:rNe,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}};return{vnodeSelector:r.vnodeSelector,properties:a,children:void 0,text:void 0,domNode:null}}return e}function Ewt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){const a=new s(n);a.container=t,Jq.set(t,a),a.afterCreate?.(a,t),r.addHandles(bi(()=>rNe(t))),queueMicrotask(()=>{a[tNe].projector?.renderNow()})}function Awt(t,e,i,{widgetProperties:r}){const s=Jq.get(t);s&&(s.set(r),s.afterUpdate?.(s,t))}function rNe(t){const e=Jq.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),Jq.delete(t))}function Qq(t){return typeof t=="function"&&t[eNe]}const Rxe=new Set;function Owt(t){Rxe.add(t),t.finally(()=>Rxe.delete(t))}function Pwt(t){return bi()}var Ixe;let Rwt=0;function sNe(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?sNe(t[r],e[r]):t[r]=e[r]);return t}const Iwt=Swt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,a)=>{const o=e?.(r,s,n,a),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const u=r[2].toLowerCase()+r.slice(3),d=v=>o?.call(n,v);n.addEventListener(u,d,l);const f=()=>n.removeEventListener(u,d,l),g=a.afterRemoved;a.afterRemoved=v=>{g?.(v),f()}}return o}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,a=s===Event.CAPTURING_PHASE;let o=`on${n}${a?"capture":""}`;const l=e.properties;(l&&o in l||(o=`on${n[0].toUpperCase()}${n.slice(1)}${a?"Capture":""}`,l&&o in l))&&(ahe(),t.scheduleRender(),l[o].call(l.bind||i,r))}});let iQ=!1;var XS;let Fo=(XS=class extends fF(Ju){constructor(e,i){super(e,i),this._attached=!1,this._projector=Iwt,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=HL(async()=>{if(this._messageBundleProps?.length){const l=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:u,propertyName:d})=>{if(this.destroyed)return;let f=await Gce(u);this.destroyed||(this.uiStrings&&Object.keys(this.uiStrings)&&(f=sNe(se(f),this.uiStrings)),this[d]=f)}));if(this.destroyed)return;for(const u of l)u.status==="rejected"&&re.getLogger(this).error("widget-intl:locale-error",this.declaredClass,u.reason)}await this.loadLocale()}),this.addHandles(Pwt()),$wt();const r="esri-widget-uid-"+I1(),s=this.render.bind(this);this._trackingTarget=new UL(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),a=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const l=s()??n(),u=l.properties??={};if(u.key??=r,Qq(l.vnodeSelector)){if(!this.visible)return n()}else this.visible?u.styles||(u.styles={}):(u.class="",u.styles={display:"none"}),u.styles.display??="";let d=0;return l.children?.forEach(f=>{Qq(f.vnodeSelector)||(f.properties??={},f.properties.key??=`${this.id}--${d++}`)}),iNe(this,l)};this.render=()=>{if(iQ)return a();let l=cwt(this)??null;if(l)return l;this._trackingTarget.clear(),iQ=!0;try{l=Gg(this._trackingTarget,a)}catch(u){throw re.getLogger(this).error(u),u}finally{iQ=!1}return l&&uwt(this,l),l};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then(()=>{this.destroyed||(this._readyForTrueRender=!0,this._postInitialize())}):(this._resourcesFetch=Promise.resolve().then(()=>{this.destroyed||this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),Owt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(Iee):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Pe(this._trackingTarget),Pe(this.viewModel),this._detach(this.container),this._set("container",null),this.render=()=>null,this._projector=null,KJ(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return w7(e)}get destroyed(){return super.destroyed}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+Rwt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(Ixe=eNe,tNe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(KJ(this),this._projector.scheduleRender())}classes(...e){return hwt.apply(this,e)}renderNow(){KJ(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(X(()=>this.viewModel,(i,r)=>{r&&this.removeHandles("delegated-events"),i&&Y9(i)&&this.addHandles(this._delegatedEventNames.map(s=>f$(i,s,n=>{this.emit(s,n)})),"delegated-events")},bt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Iee),this.scheduleRender()};this.addHandles([Ice(e),X(()=>this.uiStrings,e)]),this.addHandles(vs(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0}))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}},XS[Ixe]=!0,XS.vnodeSelector="div",XS);c([p()],Fo.prototype,"_readyForTrueRender",void 0),c([p({value:null})],Fo.prototype,"container",null),c([wi("container")],Fo.prototype,"castContainer",null),c([p()],Fo.prototype,"icon",null),c([p()],Fo.prototype,"id",null),c([p()],Fo.prototype,"label",null),c([p()],Fo.prototype,"renderable",null),c([p()],Fo.prototype,"uiStrings",void 0),c([p()],Fo.prototype,"viewModel",void 0),c([p({value:!0})],Fo.prototype,"visible",null),c([p()],Fo.prototype,"key",void 0),c([p()],Fo.prototype,"children",void 0),c([p()],Fo.prototype,"afterCreate",void 0),c([p()],Fo.prototype,"afterUpdate",void 0),c([p()],Fo.prototype,"afterRemoved",void 0),Fo=c([R("esri.widgets.Widget")],Fo);const ym=Fo,xdi=-1,Dwt=-2;let UD,BD=null;const gw=new Map;async function Sdi(t){BD==null&&(UD==null&&(UD=W(()=>import("./Lyr3DWasmPerSceneView-C20Fb4Gd.js"),__vite__mapDeps([264,97]))),BD=await UD);const e=t.view;let i=gw.get(e);i||(i=new BD.default({view:e}),gw.set(e,i));const r=!!e.stage.renderView.renderingContext.capabilities.compressedTextureS3TC,s=!!e.stage.renderView.renderingContext.capabilities.compressedTextureETC;await i.initializeWasm(r,s);const n=i.addLayerView(t);if(n.wasmLayerId<0)throw i.getValidLayerViewCount()<1&&(gw.delete(e),gw.size===0&&(UD=null,BD=null)),n.wasmLayerId===Dwt?new q("tiles3d:addLayer-failure","The 3d tiles layer web assembly module failed to download.",{}):new q("tiles3d:addLayer-failure",n.check?.errorDescription??"The 3d tiles layer description was invalid.",{});return n.wasmLayerId}function kwt(t){return gw.get(t)}function Tdi(t){const e=t.view,i=gw.get(e);i&&i.removeLayerView(t)<1&&(gw.delete(e),gw.size===0&&(UD=null,BD=null))}function Dxe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function Lwt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function oV(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function Fwt(t){return t.type==="bing-maps"}const Rm=[];let YM=class extends be{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ke,this.view=null,this._allLayerViewsChange=i=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=this.view?.allLayerViews;r&&(this.addHandles(r.map(s=>X(()=>[s.suspended,s.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(s=>{s.declaredClass==="esri.views.3d.layers.IntegratedMesh3DTilesLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i?.removed&&i.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([tn(()=>this.view?.allLayerViews,"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),vs(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e?.allLayerViews;Rm.length=0;let r=!1,s=null;if(!e||!i)return void this._clear();i.forEach(a=>{if(a.suspended||!a.layer?.attributionVisible)return;const o=a.layer;if(Dxe(o,"user"))return void oV(Rm,a,o.copyright);if(o.type==="integrated-mesh-3dtiles"&&o.hasGoogleUrl&&(r=!0,s=a),o.hasAttributionData){if(this._fetchedAttributionData.has(a)){const u=this._fetchedAttributionData.get(a);return void(u?oV(Rm,a,this._getDynamicAttribution(u,e,o)):Dxe(o)&&oV(Rm,a,o.copyright))}return void this._fetchAttributionData(a)}const l="portalItem"in o?o.portalItem?.accessInformation:void 0;oV(Rm,a,l||o.copyright)});const n=i.find(a=>a.layer?.type==="integrated-mesh-3dtiles");if(this.view&&n){const a=kwt(this.view);if(a){const o=a.getAttributionText();for(let l=o.length-1;l>-1;--l)Rm.unshift({text:o[l],layerView:n})}}r&&s&&Rm.unshift({text:"Google Maps",layerView:s}),Lwt(this.items,Rm)&&(this.items.removeAll(),this.items.addMany(Rm)),Rm.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Sp(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,Fwt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const a=r[n],o=a.coverageAreas;if(!o)return;for(const l of o){const u=l.bbox,d=l.zoomMin-(i&&l.zoomMin?1:0),f=l.zoomMax-(i&&l.zoomMax?1:0),g=new It({xmin:u[1],ymin:u[0],xmax:u[3],ymax:u[2],spatialReference:Me.WGS84}),v={extent:_0(g),attribution:a.attribution||"",score:l.score!=null?l.score:100,id:n};for(let _=d;_<=f;_++)s[_]??=[],s[_].push(v)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){const{extent:s,scale:n}=i;let a=r.tileInfo?.scaleToZoom(n)??0;if(a=Math.min(e.maxKey??0,Math.round(a)),!s||a==null||a<=-1)return"";const o=e[a],l=eF(s.center.clone().normalize(),Me.WebMercator),u=new Set;return o?o.filter(d=>{const f=d.id,g=!u.has(f)&&l&&d.extent&&tF(d.extent,l);return g&&u.add(f),g}).sort((d,f)=>f.score-d.score||d.objectId-f.objectId).map(d=>d.attribution).join(", "):""}};c([p({readOnly:!0,type:ke})],YM.prototype,"items",void 0),c([p({readOnly:!0})],YM.prototype,"state",null),c([p()],YM.prototype,"view",void 0),YM=c([R("esri.widgets.Attribution.AttributionViewModel")],YM);const nNe=YM,Zh={button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",empty:"esri-widget__content--empty",heading:"esri-widget__heading",interactive:"esri-interactive",panel:"esri-widget--panel",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetDisabled:"esri-widget--disabled"};function zwt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:Vwt(t[e])}}}function Nwt(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function Vwt(t){return function(e,...i){Nwt(e)?pwt(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function gp(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var jwt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},aNe=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?aNe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=jwt(s)),e.push(s))}},Uwt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return aNe(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function Rt(t,e,...i){return typeof t!="function"||Qq(t)?Uwt(t,e??null,...i):t(e,...i)}function rQ(...t){return t}const RC="esri-attribution",IC={base:RC,poweredBy:`${RC}__powered-by`,sources:`${RC}__sources`,open:`${RC}--open`,sourcesOpen:`${RC}__sources--open`,link:`${RC}__link`};let gc=class extends ym{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._sourcesNode=null,this._overflowRequestAnimationFrame=null,this._resizeObserver=new ResizeObserver(r=>{r.forEach(({target:s})=>{this._scheduleOverflowCheck(s)})}),this._mutationObserver=new MutationObserver(r=>{let s=!1;for(const n of r)if(n.type==="childList"||n.type==="characterData"||n.type==="attributes"){s=!0;break}s&&this._sourcesNode&&this._scheduleOverflowCheck(this._sourcesNode)}),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new nNe}initialize(){this.addHandles(tn(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect(),this._mutationObserver?.disconnect(),this._overflowRequestAnimationFrame!=null&&(cancelAnimationFrame(this._overflowRequestAnimationFrame),this._overflowRequestAnimationFrame=null)}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}_scheduleOverflowCheck(e){this._overflowRequestAnimationFrame==null&&(this._overflowRequestAnimationFrame=requestAnimationFrame(()=>{this._overflowRequestAnimationFrame=null,this._checkSourceTextOverflow(e)}))}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[IC.open]:this._isOpen};return Rt("div",{bind:this,class:this.classes(IC.base,Zh.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Rt("div",{class:IC.poweredBy},"Powered by"," ",Rt("a",{class:IC.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[IC.sourcesOpen]:e,[Zh.interactive]:i};return Rt("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(IC.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._sourcesNode=e,this._resizeObserver.observe(e),this._mutationObserver.observe(e,{subtree:!0,childList:!0,characterData:!0,attributes:!0}),this._scheduleOverflowCheck(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,a=n>s,o=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,o&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};c([p()],gc.prototype,"_isOpen",void 0),c([p()],gc.prototype,"_isInteractive",null),c([p()],gc.prototype,"_attributionTextOverflowed",void 0),c([p()],gc.prototype,"_prevSourceNodeHeight",void 0),c([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],gc.prototype,"attributionText",null),c([p()],gc.prototype,"icon",null),c([p()],gc.prototype,"itemDelimiter",void 0),c([p()],gc.prototype,"label",null),c([p(),gp("esri/widgets/Attribution/t9n/Attribution")],gc.prototype,"messages",void 0),c([p()],gc.prototype,"view",null),c([p({type:nNe})],gc.prototype,"viewModel",void 0),c([zwt()],gc.prototype,"_toggleState",null),gc=c([R("esri.widgets.Attribution")],gc);const Bwt=gc;function qwt(){const t=ie("mapview-essential-goto-duration");return t==null?t:t}function Gwt(t){return t?.spatialReference?.isWebMercator||t?.spatialReference?.isGeographic||!1}function Hwt(t,e,i){return t.goTo(e,i)}const Wwt=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:s}=this;return cP(s),this.goToOverride?this.goToOverride(s,r):Hwt(s,r.target,r.options)}};return c([p()],i.prototype,"goToOverride",void 0),c([p()],i.prototype,"view",void 0),i=c([R("esri.widgets.support.GoTo")],i),i};let l2=class extends Wwt(be){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._watchForView(Yt)}destroy(){this.view=null}get canShowNorth(){return Gwt(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:qwt()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),this._watchForView(),e&&this.addHandles(e.type==="2d"?X(()=>e?.rotation,this._updateForRotation,Yt):X(()=>e?.camera,this._updateForCamera,Yt))}_watchForView(e){this.addHandles(X(()=>this.view,this._updateRotationWatcher,e))}};c([p({readOnly:!0})],l2.prototype,"canShowNorth",null),c([p({readOnly:!0})],l2.prototype,"orientation",void 0),c([p({readOnly:!0})],l2.prototype,"state",null),c([p()],l2.prototype,"view",void 0),l2=c([R("esri.widgets.Compass.CompassViewModel")],l2);const oNe=l2,kxe="esri-compass",Lxe={base:kxe,iconContainer:`${kxe}__icon-container`};let nv=class extends ym{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new oNe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return F1({button:()=>W(()=>Promise.resolve().then(()=>bW),void 0),icon:()=>W(()=>Promise.resolve().then(()=>EOe),void 0)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return Rt("div",{class:this.classes(Lxe.base,Zh.widget)},Rt("calcite-button",{class:Zh.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},Rt("div",{"aria-hidden":"true",class:Lxe.iconContainer,title:r.reset},Rt("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};c([p()],nv.prototype,"goToOverride",null),c([p()],nv.prototype,"icon",null),c([p()],nv.prototype,"label",null),c([p(),gp("esri/widgets/Compass/t9n/Compass")],nv.prototype,"messages",void 0),c([p()],nv.prototype,"view",null),c([p({type:oNe})],nv.prototype,"viewModel",void 0),nv=c([R("esri.widgets.Compass")],nv);const Zwt=nv,Fxe="esri-navigation-toggle",zxe={base:Fxe,isLayoutHorizontal:`${Fxe}--horizontal`};let JM=class extends be{constructor(e){super(e),this._navigationMode="pan",this.view=null,e?.isDefaultViewModel||jit(re.getLogger(this),"Navigation Toggle","arcgis-navigation-toggle",{version:"4.33"})}normalizeCtorArgs(e={}){const{isDefaultViewModel:i,...r}=e;return r}initialize(){this.addHandles(vs(()=>this.view?.navigation?.actionMap,()=>this._updateNavigationActionMap()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._updateNavigationActionMap()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_updateNavigationActionMap(){const e=this.view?.navigation?.actionMap;if(!e)return;const i=this._navigationMode==="pan";e.dragPrimary=i?"pan":"rotate",e.dragSecondary=i?"rotate":"pan"}};c([p({readOnly:!0})],JM.prototype,"state",null),c([p()],JM.prototype,"_navigationMode",void 0),c([p()],JM.prototype,"view",void 0),JM=c([R("esri.widgets.NavigationToggle.NavigationToggleViewModel")],JM);const lNe=JM;let av=class extends ym{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new lNe({isDefaultViewModel:!0}),this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{const r=this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton;fwt(r),this.toggle()},e?.isDefaultUI||Vit(re.getLogger(this),"Navigation Toggle","arcgis-navigation-toggle",{version:"4.32"})}normalizeCtorArgs(e={}){const{isDefaultUI:i,...r}=e;return r}loadDependencies(){return F1({button:()=>W(()=>Promise.resolve().then(()=>bW),void 0)})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel?.state==="disabled",i=this.viewModel?.navigationMode==="pan",r=this.messages.toggle;return Rt("div",{class:this.classes(zxe.base,Zh.widget,{[zxe.isLayoutHorizontal]:this.layout==="horizontal"})},Rt("calcite-button",{afterCreate:s=>{this._panButton=s},appearance:i?"outline-fill":"solid",class:Zh.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),Rt("calcite-button",{afterCreate:s=>{this._rotateButton=s},appearance:i?"solid":"outline-fill",class:Zh.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};c([p()],av.prototype,"icon",null),c([p()],av.prototype,"label",null),c([p({value:"vertical"})],av.prototype,"layout",null),c([p(),gp("esri/widgets/NavigationToggle/t9n/NavigationToggle")],av.prototype,"messages",void 0),c([p()],av.prototype,"view",null),c([p({type:lNe})],av.prototype,"viewModel",void 0),av=c([R("esri.widgets.NavigationToggle")],av);const Ywt=av;let c2=class extends be{get canZoomIn(){if(!this.view?.ready)return!1;const i=this.view?.constraints?.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const r=e.constraints?.effectiveMinScale;return r===0||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};c([p({readOnly:!0})],c2.prototype,"canZoomIn",null),c([p({readOnly:!0})],c2.prototype,"canZoomOut",null),c([p()],c2.prototype,"view",void 0),c([p()],c2.prototype,"_scale",null),c2=c([R("esri.widgets.Zoom.ZoomConditions2D")],c2);const Jwt=c2;let QM=class extends be{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};c([p({readOnly:!0})],QM.prototype,"canZoomIn",null),c([p({readOnly:!0})],QM.prototype,"canZoomOut",null),c([p()],QM.prototype,"view",void 0),QM=c([R("esri.widgets.Zoom.ZoomConditions3D")],QM);const Qwt=QM;let Sb=class extends be{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Jwt({view:e}):e.type==="3d"&&(this._zoomConditions=new Qwt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){const e=this.view;this.canZoomIn&&e&&(e.type==="2d"?e.mapViewNavigation.zoomIn():bp(e.goTo({zoomFactor:2})))}zoomOut(){const e=this.view;this.canZoomOut&&e&&(e.type==="2d"?e.mapViewNavigation.zoomOut():bp(e.goTo({zoomFactor:.5})))}};c([p()],Sb.prototype,"_zoomConditions",void 0),c([p()],Sb.prototype,"canZoomIn",null),c([p()],Sb.prototype,"canZoomOut",null),c([p({readOnly:!0})],Sb.prototype,"state",null),c([p()],Sb.prototype,"view",null),Sb=c([R("esri.widgets.Zoom.ZoomViewModel")],Sb);const cNe=Sb,Nxe={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let ov=class extends ym{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new cNe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return F1({button:()=>W(()=>Promise.resolve().then(()=>bW),void 0)})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Nxe.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return Rt("div",{class:this.classes(Nxe.base,Zh.widget,e)},Rt("calcite-button",{class:Zh.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),Rt("calcite-button",{class:Zh.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};c([p()],ov.prototype,"icon",null),c([p()],ov.prototype,"label",null),c([p({value:"vertical"})],ov.prototype,"layout",null),c([p(),gp("esri/widgets/Zoom/t9n/Zoom")],ov.prototype,"messages",void 0),c([p()],ov.prototype,"view",null),c([p({type:cNe})],ov.prototype,"viewModel",void 0),ov=c([R("esri.widgets.Zoom")],ov);const Xwt=ov;function Kwt(t){return t?.view!==void 0}let zU=class extends ywt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const s=this._find(r),n=s?.widget;Kwt(n)&&(n.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([X(()=>this.components,this._componentsWatcher,Yt),X(()=>this.view,this._updateViewAwareWidgets,Yt)])}_add(e,i,r,s,n){let a=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;a=this._createComponent(e)}super._add(a,i,r,s,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new L4({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new Bwt({view:i});case"compass":return new Zwt({view:i});case"navigation-toggle":return new Ywt({view:i,isDefaultUI:!0});case"zoom":return new Xwt({view:i})}}};c([p()],zU.prototype,"components",void 0),zU=c([R("esri.views.ui.DefaultUI")],zU);const q7=zU;let NU=class extends q7{constructor(e){super(e),this.components=["attribution","zoom"]}};c([p()],NU.prototype,"components",void 0),NU=c([R("esri.views.ui.2d.DefaultUI2D")],NU);const uNe=NU;let hNe=class{constructor(e={},i={},r=8,s=1/0){this.disabledExtensions=e,this.debugWebGLExtensions=i,this.maxAnisotropy=r,this.maxPreferredTexturePixels=s}},MF=class sse{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}greaterEqual(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new q(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new sse(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!r?.match||!n.test(r))throw new q((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s?.match||!n.test(s))throw new q((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const a=parseInt(r,10),o=parseInt(s,10);return new sse(a,o,i)}},XE=class extends MF{constructor(e,i){super(e,i,"webmap")}};function VU(t){return t!=null&&typeof t=="object"&&"declaredClass"in t&&t.declaredClass==="esri.WebMap"}const dNe=new XE(2,35);var nse;let jU=nse=class extends ae{constructor(t){super(t),this.color=new Je([0,0,0,1])}clone(){return new nse(se({color:this.color}))}};c([p({type:Je,json:{write:!0}})],jU.prototype,"color",void 0),jU=nse=c([R("esri.webmap.background.ColorBackground")],jU);const G7=jU;let pNe,fNe,mNe,gNe,yNe,vNe,_Ne;async function e1t(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,GridView2D:n,Stage:a}]=await Promise.all([W(()=>import("./webglDeps-BVrk6yaw.js"),__vite__mapDeps([145,146,147,148])),W(()=>import("./mapViewDeps-DPicuSt6.js"),__vite__mapDeps([149,150,55,56,50,54,57,47,151,48,152,51,153,154,46,155,146,148,156,52,61,157,58,59,158,159,160,147,161,72,162,163,164,36,45,49,14,13,165,60,166,53,106,107,66,167,62,67,168,169,170,171,172]))]);fNe=t,mNe=e,gNe=i,yNe=r,vNe=s,_Ne=n,pNe=a}var LA;let Yi=(LA=class extends t_t(u0t(n4e(P4e(E4e(Vre))))){get timeZone(){return super.timeZone}set timeZone(e){super.timeZone=e}constructor(e){super(e),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new op({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.graphicsView=null,this.labelManager=null,this.navigation=new N7({actionMap:new Fue({dragTertiary:"none"})}),this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.analyses=new h1,this.analysisViewManager=new Hze({importAnalysisViewModule:i=>U_t(i),view:this}),this.floors=new ke,this.grid=null,this.map=null,this.timeline=new Gze,this.type="2d",this.view2dType=null,this.ui=new uNe,this.animationsEnabled=!0,this.test={takeScreenshot:async i=>Hbt(this._getScreenshotView(i),i)},this.padding={top:0,right:0,bottom:0,left:0},Pke()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=Pe(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new Q_t(this.featuresTilingScheme)}get constraintsInfo(){const e=this.defaultsFromMap?.tileInfo,i=this.spatialReference;return{lods:e?.spatialReference?.equals(i)?e.lods:null,spatialReference:i}}get initialExtentRequired(){if(!this.stateManager)return!1;const{scale:e,constraints:i,center:r,viewpoint:s,extent:n}=this;let a=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint)&&!n&&(i?.effectiveLODs||(a=-1),(!r||e===0&&a===-1)&&(s?.targetGeometry==null||s.targetGeometry.type!=="extent"&&!s.scale))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const i=e.targetGeometry,r=this.spatialReference;return rw(i.spatialReference,r)}get background(){return VU(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){return this.stateManager?.center??null}set center(e){this.stateManager.center=e}get constraints(){return super.constraints}set constraints(e){super.constraints=e}get highlightOptions(){return LU(this)}set highlightOptions(e){Cbt(this,e)}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){return this.stage?.renderRequested??!1}get resizeAlign(){return super.resizeAlign}set resizeAlign(e){super.resizeAlign=e}get resolution(){return this.stateManager.resolution??0}get rotation(){return super.rotation}set rotation(e){super.rotation=e}get scale(){return this.stateManager?.scale??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get spatialReference(){return super.spatialReference}set spatialReference(e){super.spatialReference=e}get spatialReferenceLocked(){return this._get("spatialReferenceLocked")}set spatialReferenceLocked(e){this.stage&&re.getLogger(this).warn("spatialReferenceLocked cannot be changed after the view has become ready"),this._set("spatialReferenceLocked",e)}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){const e=!(!this.magnifier.visible||this.magnifier.position===null||!this._magnifierView?.updatingHandles.updating),i=!this.destroyed&&(!this.analysisViewManager||!this.layerViewManager||!this.labelManager||!this.graphicsView||this.analysisViewManager.updating===!0||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(r=>!r.destroyed&&!("layerViews"in r)&&r.updating===!0)||e);if(ie("esri-2d-log-updating")){const r=this.allLayerViews.reduce((s,n)=>({...s,[`${n.layer.id}(${n.layer.type})`]:!n.destroyed&&!("layerViews"in n)&&n.updating}),{});console.log(`Updating MapView: ${i}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${this.layerViewManager?.updating}
-> labelManager.updating: ${this.labelManager?.updating}
-> graphicsView.updating: ${this.graphicsView?.updating}
-> allLayerViews: ${JSON.stringify(r)}
-> updatingMagnifier: ${e}
`)}return i}get viewpoint(){return super.viewpoint}set viewpoint(e){super.viewpoint=e}get visibleArea(){const e=this.stateManager.visibleArea;return e&&new Wr({rings:[e.map(i=>[i[0],i[1]])],spatialReference:this.spatialReference})}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){return this.mapViewNavigation?.interacting??!1}async hitTest(e,i){return Mbt(this,e,i)}async takeScreenshot(e){return Gbt(this._getScreenshotView(e),e)}toScreen(e,i){return this.stateManager.toScreen(e,i)}async whenAnalysisView(e){if(e.parent==null)throw new q("view:no-analysisview-for-analysis","The analysis does not exist in view.analyses",{analysis:e});return this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return VU(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return VU(this.map)?this.map.initialViewProperties.timeExtent:null}getSurface(){return this.surface}hasLayerViewModule(e){return pxe.hasLayerViewModule(e)}importLayerView(e){return pxe.importLayerView(e)}pixelSizeAt(){return this.ready?this.resolution:(re.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(e){const i=this.toMap(e),r=await this.hitTest(e),s=this.allLayerViews.toArray().filter(u=>u.clips.every(d=>Oze(this,d,e,i))).reverse(),n=new globalThis.Map(s.map(u=>[u.layer.uid,u])),a=[];let o=0,l=0;for(;o<r.results.length||l<s.length;){const u=r.results.at(o);if(u&&u.type!=="graphic"){++o;continue}const d=n.get((u?.layer??u?.graphic.layer)?.uid);if((!u||d)&&l<s.length&&s.at(l)!==d){const f=s.at(l);"fetchPopupFeaturesAtLocation"in f&&a.push({mapPoint:i,layerView:f}),++l}else u&&(a.push({graphic:u.graphic,layerView:d}),++o)}return{hits:a,location:i}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let e=Zze(this.type);if(ie("safari")&&ie("safari")<9&&(e=new q("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:ie("safari")})),e!=null)throw re.getLogger(this).warn("#validate()",e.message),e}loadAsyncDependencies(){return e1t()}_getDefaultViewpoint(){const{constraints:e,initialExtent:i,map:r,padding:s,size:n}=this;if(!e)return null;const a=r&&"initialViewProperties"in r?r.initialViewProperties:void 0,o=this.stateManager.getUserStartupOptions(this.size),l=a?.viewpoint,u=l?.targetGeometry?.extent??i,d=u?.center,f=l?.rotation??0,g=l?.scale||u&&j7(u,[n[0]-s.left-s.right,n[1]-s.top-s.bottom]),v=o.center??d,_=o.rotation??f,x=o.scale??g;return v&&x?new ys({targetGeometry:v,scale:x,rotation:_}):null}_startup(){this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;const i=new B_t(this.surface),r=new pNe(this.surface,{canvas:this.renderCanvas,contextOptions:new hNe(this.deactivatedWebGLExtensions,this.debugWebGLExtensions),renderingOptions:this.renderingOptions,timeline:this.timeline},i);this.stage=r,this._magnifierView=new vNe,this._magnifierView.magnifier=this.magnifier,this._gridView=new _Ne;const s=new gNe({view:this});this._set("labelManager",s);const n=new R_t({view:this});this._set("animationManager",n);const a=new yNe({view:this,animationManager:n});this._set("mapViewNavigation",a),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),r.on("webgl-error",l=>this.fatalError=l.error),X(()=>this.stationary,l=>r.stationary=l,bt),X(()=>this.background,l=>{r.backgroundColor=l?.color,this._magnifierView.backgroundColor=l?.color},bt),X(()=>this.magnifier,l=>this._magnifierView.magnifier=l,bt),X(()=>this.grid,l=>this._gridView.grid=l,bt),X(()=>this.renderingOptions,l=>r.renderingOptions=l,bt),X(()=>this.highlights.items.map(l=>({name:l.name,options:{fillColor:l.color,haloColor:l.haloColor,fillOpacity:l.fillOpacity,haloOpacity:l.haloOpacity,haloWidth:l.haloWidth,haloBlur:l.haloBlur}})),()=>{r.highlightGradient=Tbt(r.highlightGradient,this.highlights.items)},bt),X(()=>this.state.id,()=>r.state=this.state,bt),X(()=>this.animationsEnabled,l=>{this.stage.animationsEnabled=l},bt)],"map-view"),this._updateStageChildren();const o=this._resolveWhenReady;this._resolveWhenReady=[],o.forEach(l=>l(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(i=>{this.stage.addChild(i.container)});const e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){const e=new z_t(_o.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const i=new fNe({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new mNe(e)});this._set("graphicsView",i)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){const{allLayerViews:i,padding:r,size:s,stage:n}=this;return{allLayerViews:i,backgroundColor:e?.ignoreBackground?null:this.background?.color,padding:r,size:s,stage:n}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(const i of this.allLayerViews)i.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const i of this.allLayerViews)i.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}},LA.type="2d",LA);c([p({constructOnly:!0})],Yi.prototype,"deactivatedWebGLExtensions",void 0),c([p({constructOnly:!0})],Yi.prototype,"debugWebGLExtensions",void 0),c([p({readOnly:!0})],Yi.prototype,"featuresTilingScheme",void 0),c([p({readOnly:!0})],Yi.prototype,"graphicsTileStore",null),c([p()],Yi.prototype,"graphicsView",void 0),c([p()],Yi.prototype,"constraintsInfo",null),c([p()],Yi.prototype,"initialExtentRequired",null),c([p()],Yi.prototype,"labelManager",void 0),c([p({type:N7,nonNullable:!0})],Yi.prototype,"navigation",void 0),c([p({constructOnly:!0})],Yi.prototype,"renderCanvas",void 0),c([p()],Yi.prototype,"renderingOptions",void 0),c([p({constructOnly:!0})],Yi.prototype,"supersampleScreenshotsEnabled",void 0),c([p()],Yi.prototype,"defaultsFromMapSettings",null),c([p({readOnly:!0})],Yi.prototype,"typeSpecificPreconditionsReady",null),c([p(L5(h1,"analyses"))],Yi.prototype,"analyses",void 0),c([p()],Yi.prototype,"analysisViewManager",void 0),c([p({type:G7})],Yi.prototype,"background",null),c([p()],Yi.prototype,"center",null),c([p({type:ke})],Yi.prototype,"floors",void 0),c([p()],Yi.prototype,"grid",void 0),c([p({type:jg})],Yi.prototype,"highlightOptions",null),c([p()],Yi.prototype,"map",void 0),c([p()],Yi.prototype,"padding",null),c([p({readOnly:!0})],Yi.prototype,"rendering",null),c([p({readOnly:!0})],Yi.prototype,"resolution",null),c([p()],Yi.prototype,"scale",null),c([p({type:Boolean,value:!1})],Yi.prototype,"spatialReferenceLocked",null),c([p({readOnly:!0})],Yi.prototype,"tileInfo",null),c([p({type:Gze,readOnly:!0})],Yi.prototype,"timeline",void 0),c([p({readOnly:!0})],Yi.prototype,"type",void 0),c([p({readOnly:!0})],Yi.prototype,"updating",null),c([p({readOnly:!0})],Yi.prototype,"view2dType",void 0),c([p({readOnly:!0})],Yi.prototype,"visibleArea",null),c([p()],Yi.prototype,"zoom",null),c([p({readOnly:!0})],Yi.prototype,"navigating",null),c([p(),wi(t=>t instanceof q7?t:g$(uNe,t))],Yi.prototype,"ui",void 0),c([p()],Yi.prototype,"animationsEnabled",void 0),Yi=c([R("esri.views.View2D")],Yi);const t1t=Yi;let UU=class extends t1t{constructor(e){super(e),this.view2dType="map"}};c([p({readOnly:!0})],UU.prototype,"view2dType",void 0),UU=c([R("esri.views.MapView")],UU);const i1t=UU;let r1t=class bNe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(Zee),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new bNe,r=this._originStores[0];r&&r.forEach((s,n)=>{i.set(n,se(s),0)});for(let s=2;s<Zee;s++){const n=this._originStores[s];n&&n.forEach((a,o)=>{e&&e.has(o)||i.set(o,se(a),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=7){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=7){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const a=this._originStores[n];if(a&&a.has(e)){this._values.set(e,a.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r?.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||0}isAtOrigin(e,i){return this.has(e,i)&&this.originOf(e)===i}isBelowOrigin(e,i){return!this.has(e)||this.originOf(e)<i}forEach(e){this._values.forEach(e)}};const wNe=t=>{const e=t;let i=class extends e{constructor(...r){super(...r);const s=xl(this),n=s.store,a=new r1t;s.store=a,oRe(s,n,a)}read(r,s){cRe(this,r,s)}getAtOrigin(r,s){const n=sQ(this),a=l0(s);if(typeof r=="string")return n.get(r,a);const o={};return r.forEach(l=>{o[l]=n.get(l,a)}),o}originOf(r){return T5(this.originIdOf(r))}originIdOf(r){return sQ(this).originOf(r)}revert(r,s){const n=sQ(this),a=l0(s),o=xl(this);let l;l=typeof r=="string"?r==="*"?n.keys(a):[r]:r,l.forEach(u=>{o.invalidate(u),n.revert(u,a),o.commit(u)})}};return i=c([R("esri.core.ReadOnlyMultiOriginJSONSupport")],i),i};function sQ(t){return xl(t).store}wNe(be);const s1t=t=>{const e=t;let i=class extends e{constructor(...r){super(...r)}clear(r,s="user"){xl(this).clearOrigin(r,l0(s))}write(r,s){return hRe(this,r=r||{},s),r}setAtOrigin(r,s,n){xl(this).setAtOrigin(r,s,l0(n))}removeOrigin(r){const s=Vxe(this),n=l0(r),a=s.keys(n);for(const o of a)s.originOf(o)===n&&s.set(o,s.get(o,n),7)}updateOrigin(r,s){const n=Vxe(this),a=l0(s),o=Vf(this,r);for(let l=a+1;l<Zee;++l)n.delete(r,l);n.set(r,o,a)}toJSON(r){return this.write({},r)}};return i=c([R("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],i),i.prototype.toJSON.isDefaultToJSON=!0,i};function Vxe(t){return xl(t).store}const EF=t=>{const e=s1t(wNe(t));let i=class extends e{};return i=c([R("esri.core.MultiOriginJSONSupport")],i),i},ohe=EF(be);async function n1t(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return iS(t);const i=Me.WGS84;return await om(e,i),Pa(t,i)}function z1(t,e){if(!yw(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function yw(t,e){return!!t.typeKeywords?.includes(e)}function Vdi(t){return yw(t,U0.HOSTED_SERVICE)}function Pc(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function ase(t,e,i){i?z1(t,e):Pc(t,e)}async function jdi(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return n1t(i)}const U0={CHARTS:"Charts",DYNAMIC:"Dynamic",DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function a1t(t){const{portal:e,isOrgItem:i,itemControl:r}=t,s=e.user?.privileges;let n=!s||s.includes("features:user:edit"),a=!!i&&!!s?.includes("features:user:fullEdit");const o=r==="update"||r==="admin";return o?a=n=!0:a&&(n=!0),{features:{edit:n,fullEdit:a},content:{updateItem:o}}}let Tb=class extends ae{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};c([p({type:String,json:{write:{isRequired:!0}}})],Tb.prototype,"facilityIdField",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],Tb.prototype,"layerId",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],Tb.prototype,"nameField",void 0),c([p({type:String,json:{write:!0}})],Tb.prototype,"siteIdField",void 0),c([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Tb.prototype,"sublayerId",void 0),Tb=c([R("esri.layers.support.FacilityLayerInfo")],Tb);const o1t=Tb;let cf=class extends ae{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};c([p({type:String,json:{write:{isRequired:!0}}})],cf.prototype,"facilityIdField",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],cf.prototype,"layerId",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],cf.prototype,"levelIdField",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],cf.prototype,"levelNumberField",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],cf.prototype,"longNameField",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],cf.prototype,"shortNameField",void 0),c([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],cf.prototype,"sublayerId",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],cf.prototype,"verticalOrderField",void 0),cf=c([R("esri.layers.support.LevelLayerInfo")],cf);const l1t=cf;let u2=class extends ae{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};c([p({type:String,json:{write:{isRequired:!0}}})],u2.prototype,"layerId",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],u2.prototype,"nameField",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],u2.prototype,"siteIdField",void 0),c([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],u2.prototype,"sublayerId",void 0),u2=c([R("esri.layers.support.SiteLayerInfo")],u2);const c1t=u2;let XM=class extends ae{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};c([p({type:l1t,json:{write:{isRequired:!0}}})],XM.prototype,"levelLayer",void 0),c([p({type:o1t,json:{write:{isRequired:!0}}})],XM.prototype,"facilityLayer",void 0),c([p({type:c1t,json:{write:!0}})],XM.prototype,"siteLayer",void 0),XM=c([R("esri.support.MapFloorInfo")],XM);const xNe=XM;var ose;let KM=ose=class extends ae{constructor(t){super(t),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new ose(se({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};c([p({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],KM.prototype,"activeRange",void 0),c([p({type:[Number],json:{write:!0}})],KM.prototype,"currentRangeExtent",void 0),c([p({type:[Number],json:{write:!0}})],KM.prototype,"fullRangeExtent",void 0),KM=ose=c([R("esri.webdoc.RangeInfo")],KM);const lhe=KM;var lse;let Qm=lse=class extends ae{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new lse(se({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};c([p({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],Qm.prototype,"enabled",void 0),c([p({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],Qm.prototype,"longNames",void 0),c([p({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],Qm.prototype,"minimized",void 0),c([p({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],Qm.prototype,"pinnedLevels",void 0),c([p({type:String,json:{read:{source:"site"},write:{target:"site"}}})],Qm.prototype,"site",void 0),c([p({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],Qm.prototype,"facility",void 0),c([p({type:String,json:{read:{source:"level"},write:{target:"level"}}})],Qm.prototype,"level",void 0),Qm=lse=c([R("esri.webdoc.widgets.FloorFilter")],Qm);const u1t=Qm;var cse;const lV=new ii({slider:"slider",picker:"picker"});let e3=cse=class extends ae{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new cse({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};c([p({type:lV.apiValues,nonNullable:!0,json:{type:lV.jsonValues,default:null,read:{reader:lV.read},write:{isRequired:!0,writer:lV.write}}})],e3.prototype,"interactionMode",void 0),c([p({type:vi,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],e3.prototype,"numStops",void 0),c([p({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],e3.prototype,"stopInterval",void 0),e3=cse=c([R("esri.webdoc.widgets.Range")],e3);const h1t=e3,che=so()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let qf=class extends nt(ae){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return k4e(this.value,this.unit,"milliseconds")}};c([st(che,{nonNullable:!0})],qf.prototype,"unit",void 0),c([p({type:Number,json:{write:!0},nonNullable:!0})],qf.prototype,"value",void 0),qf=c([R("esri.time.TimeInterval")],qf);var use;let ho=use=class extends ae{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){return t?ts.fromArray(t):void 0}writeCurrentTimeExtent(t,e,i){t&&ra(i,t.toArray(),e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new ts({start:s,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,s=t.start;r&&(i.endTime=r!=null?r.getTime():null),s&&(i.startTime=s!=null?s.getTime():null)}readStopInterval(t,e,i){return t?qf.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const s=t.toJSON(r);ra("properties.timeStopInterval",{interval:s.value,units:s.unit},e)}readStops(t){return t?.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t?.length&&ra(i,t.map(r=>r.getTime()),e)}clone(){return new use(se({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};c([p({type:ts,json:{type:[[vi,hP]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],ho.prototype,"currentTimeExtent",void 0),c([Oe("currentTimeExtent")],ho.prototype,"readCurrentTimeExtent",null),c([Ie("currentTimeExtent")],ho.prototype,"writeCurrentTimeExtent",null),c([p({type:ts,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],ho.prototype,"fullTimeExtent",void 0),c([Oe("fullTimeExtent")],ho.prototype,"readFullTimeExtent",null),c([Ie("fullTimeExtent")],ho.prototype,"writeFullTimeExtent",null),c([p({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],ho.prototype,"loop",void 0),c([p({type:vi,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const t=!!this.stopInterval,e=!!this.stops?.length,i=!(t||e);return{enabled:i,isRequired:i}}}}})],ho.prototype,"numStops",void 0),c([p({type:[1,2],nonNullable:!0,json:{type:vi,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],ho.prototype,"numThumbs",void 0),c([p({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],ho.prototype,"stopDelay",void 0),c([p({type:qf,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:che.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){const t=this.numStops!=null,e=!!this.stops?.length;return{enabled:!e,isRequired:!(t||e)}}}}})],ho.prototype,"stopInterval",void 0),c([Oe("stopInterval")],ho.prototype,"readStopInterval",null),c([Ie("stopInterval")],ho.prototype,"writeStopInterval",null),c([p({type:[Date],json:{type:[vi],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],ho.prototype,"stops",void 0),c([Oe("stops")],ho.prototype,"readStops",null),c([Ie("stops")],ho.prototype,"writeStops",null),ho=use=c([R("esri.webdoc.widgets.TimeSlider")],ho);const d1t=ho;var hse;let t3=hse=class extends ae{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new hse(se({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};c([p({type:h1t,json:{write:!0}})],t3.prototype,"range",void 0),c([p({type:d1t,json:{write:!0}})],t3.prototype,"timeSlider",void 0),c([p({type:u1t,json:{write:!0}})],t3.prototype,"floorFilter",void 0),t3=hse=c([R("esri.webdoc.Widgets")],t3);const SNe=t3,p1t={width:600,height:400},cV=1.5;function TNe(t,e){e=e||p1t;let{width:i,height:r}=e;const s=i/r;return s<cV?r=i/cV:s>cV&&(i=r*cV),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function f1t(t,e){return{...$Ne(t,e),readResourcePaths:[]}}function dse(t,e,i){const r=kn(t.itemUrl);return{...$Ne(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function $Ne(t,e){return{origin:e,url:kn(t.itemUrl),portal:t.portal||ze.getDefault(),portalItem:t}}let Jv=class extends ae{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=gq(this.outSpatialReference),r.inSR=gq(i.spatialReference),r.geometries=JSON.stringify({geometryType:mP(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};c([p()],Jv.prototype,"geometries",void 0),c([p({type:Me,json:{read:{source:"outSR"}}})],Jv.prototype,"outSpatialReference",void 0),c([p()],Jv.prototype,"transformation",void 0),c([p()],Jv.prototype,"transformForward",void 0),Jv=c([R("esri.rest.support.ProjectParameters")],Jv);const m1t=en(Jv);async function CNe(t,e,i){e=m1t(e);const r=SFe(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,a=mP(e.geometries[0]),o=nvt(s,i);return Si(r.path+"/project",o).then(({data:{geometries:l}})=>TFe(l,a,n))}function g1t(t,e){return e.resourceInfo?MNe(e,e.resourceInfo,{origin:t.origin}):e.portalItem?.id?y1t(t,e,e.portalItem):Promise.resolve()}function MNe(t,e,i){const r={context:{...i,layerContainerType:"operational-layers"}};return t.portalItem&&(r.context.portal=t.portalItem.portal||ze.getDefault()),W(async()=>{const{populateOperationalLayers:s}=await import("./layersCreator-C-Zqm3pA.js");return{populateOperationalLayers:s}},__vite__mapDeps([130,127,126,125,128,124])).then(({populateOperationalLayers:s})=>{const n=[],a=e.operationalLayers;a?.length&&n.push(s(t.layers,a,r));const o={...r,context:{...r.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},l=e.tables;return l?.length&&n.push(s(t.tables,l,o)),Promise.allSettled(n).then(()=>{})})}async function y1t(t,e,i){if(await i.load().catch(a=>{throw new q(`${t.name}:load-portal-item`,"Failed to load portal item",{error:a})}),i.type!==t.itemType)throw new q(`${t.name}:invalid-portal-item`,`Invalid portal item type '${i.type}', expected '${t.itemType}'`,{type:i.type});const r=await i.fetchData();e.resourceInfo=r;const s=f1t(i,t.origin);await v1t(t,e,r,s),e.resourceReferences={portalItem:i,paths:s.readResourcePaths};const n=await b1t(e.initialViewProperties,i,re.getLogger(e));if(n){const a=e.initialViewProperties?.clone()??t.createInitialViewProperties();a.viewpoint=n,e.initialViewProperties=a}}function v1t(t,e,i,r){const s=_1t(t,i);return e.read(s,r),MNe(e,s,r)}function _1t(t,e){const i=t.parseVersion(e.version||"",t.name);return t.currentVersion.validate(i),e.version=`${i.major}.${i.minor}`,e}async function b1t(t,e,i){if(t?.viewpoint?.targetGeometry)return null;const s=await w1t(t,e,i);return s?new ys({targetGeometry:s}):null}async function w1t(t,e,i){const r=t?.spatialReference,s=e?.extent;if(!r||!s)return null;if(r.isWGS84)return s.clone();if(r.isWebMercator)return _0(s);const{getGeometryServiceURL:n}=await W(()=>import("./geometryServiceUtils-CNYq6r_x.js"),[]);try{const a=await n(e),o=new Jv({geometries:[s],outSpatialReference:r});return(await CNe(a,o))[0]}catch(a){i.error("Error projecting item's extent:",a)}return null}function jxe(t){return{enabled:!!t?.length}}var pse;let i3=pse=class extends ae{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new pse({exactMatch:this.exactMatch,type:this.type,name:this.name})}};c([p({type:Boolean,json:{write:!0}})],i3.prototype,"exactMatch",void 0),c([p({type:String,json:{write:!0}})],i3.prototype,"name",void 0),c([st(kue)],i3.prototype,"type",void 0),i3=pse=c([R("esri.webdoc.applicationProperties.SearchLayerField")],i3);const x1t=i3;var fse;let r3=fse=class extends ae{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new fse(se({field:this.field,id:this.id,subLayer:this.subLayer}))}};c([p({type:x1t,json:{write:{isRequired:!0}}})],r3.prototype,"field",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],r3.prototype,"id",void 0),c([p({type:vi,json:{write:!0}})],r3.prototype,"subLayer",void 0),r3=fse=c([R("esri.webdoc.applicationProperties.SearchLayer")],r3);const S1t=r3;var mse;let s3=mse=class extends ae{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new mse({exactMatch:this.exactMatch,type:this.type,name:this.name})}};c([p({type:Boolean,json:{write:!0}})],s3.prototype,"exactMatch",void 0),c([p({type:String,json:{write:!0}})],s3.prototype,"name",void 0),c([st(kue)],s3.prototype,"type",void 0),s3=mse=c([R("esri.webdoc.applicationProperties.SearchTableField")],s3);const T1t=s3;var gse;let qD=gse=class extends ae{constructor(t){super(t),this.field=null,this.id=null}clone(){return new gse(se({field:this.field,id:this.id}))}};c([p({type:T1t,json:{write:{isRequired:!0}}})],qD.prototype,"field",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],qD.prototype,"id",void 0),qD=gse=c([R("esri.webdoc.applicationProperties.SearchTable")],qD);const $1t=qD;var yse;const ENe=ke.ofType(S1t),ANe=ke.ofType($1t);let Xm=yse=class extends ae{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new ENe,this.tables=new ANe}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new yse(se({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};c([p({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Xm.prototype,"addressSearchEnabled",void 0),c([Oe("addressSearchEnabled")],Xm.prototype,"readAddressSearchEnabled",null),c([Ie("addressSearchEnabled")],Xm.prototype,"writeAddressSearchEnabled",null),c([p({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Xm.prototype,"enabled",void 0),c([p({type:String,json:{write:!0}})],Xm.prototype,"hintText",void 0),c([p({type:ENe,json:{write:{overridePolicy:jxe},origins:{"web-scene":{write:{isRequired:!0}}}}})],Xm.prototype,"layers",void 0),c([p({type:ANe,json:{read:!0,write:{overridePolicy:jxe}}})],Xm.prototype,"tables",void 0),Xm=yse=c([R("esri.webdoc.applicationProperties.Search")],Xm);const C1t=Xm;var vse;let BU=vse=class extends ae{constructor(t){super(t),this.search=null}clone(){return new vse(se({search:this.search}))}};c([p({type:C1t,json:{write:!0}})],BU.prototype,"search",void 0),BU=vse=c([R("esri.webdoc.applicationProperties.Viewing")],BU);const ONe=BU;var _se;let n3=_se=class extends ae{constructor(t){super(t),this.editing=null,this.offline=null,this.viewing=null}clone(){return new _se(se({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};c([p({json:{write:!0}})],n3.prototype,"editing",void 0),c([p({json:{write:!0}})],n3.prototype,"offline",void 0),c([p({type:ONe,json:{write:!0}})],n3.prototype,"viewing",void 0),n3=_se=c([R("esri.webmap.ApplicationProperties")],n3);const M1t=n3;var bse;let jc=bse=class extends ae{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return TRe(this.url)}get isDataURI(){return mm(this.url)}clone(){return new bse({url:this.url})}};c([p({type:String,json:{write:{isRequired:!0}}})],jc.prototype,"url",void 0),c([p()],jc.prototype,"isSecureUrl",null),c([p()],jc.prototype,"isDataURI",null),jc=bse=c([R("esri.webdoc.support.SlideThumbnail")],jc);const uhe={type:ts,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?ts.fromArray(t):ts.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r?.messages&&r.messages.push(new q("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[vi,hP]]}}}}};var wse;let Km=wse=class extends gF(ae){constructor(t){super(t),this.name=null,this.thumbnail=new jc,this.timeExtent=null}castThumbnail(t){return typeof t=="string"?new jc({url:t}):en(jc,t)}set viewpoint(t){const{targetGeometry:e,scale:i}=t;e!=null&&e.type==="point"&&i==null&&re.getLogger(this).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",t),this._set("viewpoint",t)}readViewpoint(t,e){const{extent:i,viewpoint:r}=e;return ys.fromJSON(r||{targetGeometry:i})}writeViewpoint(t,e,i,r){if(!t)return;const{targetGeometry:s}=t;if(s!=null&&s.type!=="extent"){const n="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";return void(r?.messages?r.messages.push(new q("property:unsupported",n)):re.getLogger(this).error(n))}s!=null&&(e.extent=s.toJSON()),e[i]=t.toJSON()}clone(){return new wse(se({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};c([p({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],Km.prototype,"name",void 0),c([p({type:jc,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.url)})}}})],Km.prototype,"thumbnail",void 0),c([wi("thumbnail")],Km.prototype,"castThumbnail",null),c([p(uhe)],Km.prototype,"timeExtent",void 0),c([p({type:ys,nonNullable:!0,json:{write:!0}})],Km.prototype,"viewpoint",null),c([Oe("viewpoint",["extent","viewpoint"])],Km.prototype,"readViewpoint",null),c([Ie("viewpoint")],Km.prototype,"writeViewpoint",null),Km=wse=c([R("esri.webmap.Bookmark")],Km);const E1t=Km;let lv=class extends nt(be){constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeExtent=null,this.timeZone=xp,this.viewpoint=null}};c([p({type:G7})],lv.prototype,"background",void 0),c([p({type:lhe})],lv.prototype,"rangeInfo",void 0),c([p({type:Me})],lv.prototype,"spatialReference",void 0),c([p({type:ts})],lv.prototype,"timeExtent",void 0),c([p({nonNullable:!0})],lv.prototype,"timeZone",void 0),c([p({type:ys})],lv.prototype,"viewpoint",void 0),lv=c([R("esri.webmap.InitialViewProperties")],lv);const Xq=lv,PNe=ke.ofType(E1t),A1t=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),O1t="ArcGIS Pro",P1t=U0.JSAPI;let qs=class extends EF($7(fF(gue))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new PNe,this.floorInfo=null,this.initialViewProperties=new Xq,this.portalItem=null,this.sourceVersion=null,this.widgets=null,this._debouncedSaveOperations=HL(async(i,r,s)=>{const{save:n,saveAs:a}=await W(()=>Promise.resolve().then(()=>NQt),void 0);switch(i){case 0:return n(this.context,this,r);case 1:return a(this.context,this,s,r)}}),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){this.portalItem=Pe(this.portalItem)}initialize(){if(this.when().catch(e=>{re.getLogger(this).error("#load()","Failed to load web map",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp=P1t}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=ece}readInitialViewProperties(e,i){const r=new Xq;i.background&&(r.background=G7.fromJSON(i.background));const s=i.initialState?.timeExtent;s&&(r.timeExtent=ts.fromArray(s));const n=i.initialState?.viewpoint;return n&&(n.rotation&&XE.parse(i.version||"","webmap").lessThan(2,20)&&i.authoringApp===O1t&&(n.rotation*=-1),r.viewpoint=ys.fromJSON(n)),i.mapRangeInfo&&(r.rangeInfo=lhe.fromJSON(i.mapRangeInfo)),i.spatialReference&&(r.spatialReference=Me.fromJSON(i.spatialReference)),i.timeZone&&(r.timeZone=i.timeZone),r}writeInitialViewProperties(e,i,r,s){if(!e)return;e.background?.color&&(i.background=e.background.write({},s));const{timeExtent:n,viewpoint:a}=e;if(a||n){const o={};a&&(o.viewpoint=a.write({},s)),n&&(o.timeExtent=n.toArray()),i.initialState=o}e.rangeInfo&&(i.mapRangeInfo=e.rangeInfo.toJSON(s)),e.spatialReference&&(i.spatialReference=e.spatialReference.write({},s)),i.timeZone=e.timeZone}writeLayers(e,i,r,s){i[r]=this._writeLayers(e,s,"operational-layers")}get loaded(){return super.loaded}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new XE(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${this.context.currentVersion.major}.${this.context.currentVersion.minor}`}writeTables(e,i,r,s){const n=this._writeLayers(e,s,"tables");n.length&&(i[r]=n)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(g1t(this.context,this)),Promise.resolve(this)}loadAll(){return mF(this,e=>{e(this.ground,this.basemap,this.layers,this.tables)})}read(e,i){i={...i,origin:this.context.origin};const r=this._getAuthoringPropsState();Ule(this,e,s=>super.read(e,s),i),this._restoreAuthoringPropsFromState(r)}write(e,i){if(this.loadStatus!=="loaded"){const r=new q("webmap:not-loaded","Web map must be loaded before it can be serialized");throw re.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),r}return this._removeDanglingLayerRefs(),i={...i,origin:this.context.origin,restrictedWebMapWriting:!0,webmap:this},super.write(e,i)}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,i){return this._debouncedSaveOperations(1,i,e)}async updateFrom(e,i){const r=this._updateFromInternal(e,i);this._updateFromPromise=r,await r,r===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){const i=this.resourceInfo;return this._collectAllLayersJSON([...i?.baseMap?.baseMapLayers||[],...i?.operationalLayers||[],...this.basemap?.resourceInfo?.data?.baseMapLayers||[]]).find(r=>r.id===e.id)}async updateItemThumbnail(){this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename}),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:Xle(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce((i,r)=>(i.push(r),r.layerType==="GroupLayer"&&(i=i.concat(this._collectAllLayersJSON(r.layers||[]))),i),[])}_writeLayers(e,i,r){return i={...i,layerContainerType:r},e.map(s=>lU(s,r==="tables"?null:this.getLayerJSONFromResourceInfo(s),i)).filter(wl).toArray()}_validateJSON(e){const i=XE.parse(e.version||"","webmap");return this.context.currentVersion.validate(i),e.version=`${i.major}.${i.minor}`,e}_removeDanglingLayerRefs(){const e=this.applicationProperties,i=e?.viewing?.search,r=a=>this.allLayers.some(o=>o.id===a);if(i?.layers&&(i.layers=i.layers.filter(a=>r(a.id))),i?.tables&&(i.tables=i.tables.filter(a=>this.tables.some(o=>o.id===a.id))),e){const a=e.editing?.locationTracking;a?.info&&!r(a.info.layerId)&&(e.editing=null)}const s="presentation"in this?this.presentation:null,n=s?.slides;n&&n.forEach(a=>{a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(o=>r(o.id)))})}async _updateFromInternal(e,i){if(i??={},await qu(()=>e.ready),this._updateInitialViewProperties(e,i),e.map===this)for(const r of e.allLayerViews)"visible"in r&&"visible"in r.layer&&r._isOverridden("visible")&&(r.layer.visible=r.visible),"featureEffect"in r&&"featureEffect"in r.layer&&r._isOverridden("featureEffect")&&(r.layer.featureEffect=r.featureEffect);await this._updateThumbnailUrl(e,i)}_updateInitialViewProperties(e,i){if(i.backgroundExcluded||(this.initialViewProperties.background=e.background?.clone()),this.initialViewProperties.spatialReference=e.spatialReference?.clone(),this.initialViewProperties.timeZone=e.timeZone,i.viewpointExcluded||(this.initialViewProperties.viewpoint=new ys({rotation:e.rotation,scale:i.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!i.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this)}_getViewExtent(e){const i=e.center.clone().normalize(),r=e.extent.clone(),s=r.width/2;return r.xmin=i.x-s,r.xmax=i.x+s,r}async _updateThumbnailUrl(e,i){if(i.thumbnailExcluded)return;const r=TNe(e,i.thumbnailSize),s=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(s.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if(mm(e)){const i=GT(e),r=i?.mediaType,s=r&&A1t.get(r.toLowerCase())||null,n=`thumbnail${Date.now()}`;return s?`${n}.${s}`:n}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}};c([p()],qs.prototype,"_updateFromPromise",void 0),c([p({type:M1t,json:{write:!0}})],qs.prototype,"applicationProperties",void 0),c([p({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],qs.prototype,"authoringApp",null),c([Ie("authoringApp")],qs.prototype,"writeAuthoringApp",null),c([p({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],qs.prototype,"authoringAppVersion",null),c([Ie("authoringAppVersion")],qs.prototype,"writeAuthoringAppVersion",null),c([p({type:PNe,json:{write:{overridePolicy:t=>({enabled:!!(t&&t.length>0),ignoreOrigin:!0})}}})],qs.prototype,"bookmarks",void 0),c([p({type:xNe,json:{name:"mapFloorInfo",write:!0}})],qs.prototype,"floorInfo",void 0),c([p({type:Xq,nonNullable:!0,json:{read:{source:["background","initialState.timeExtent","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:G7},"initialState.timeExtent":{type:ts},"initialState.viewpoint":{type:ys},mapRangeInfo:{type:lhe},spatialReference:{type:Me},"timeZone:":{type:String}}}}})],qs.prototype,"initialViewProperties",void 0),c([Oe("initialViewProperties")],qs.prototype,"readInitialViewProperties",null),c([Ie("initialViewProperties")],qs.prototype,"writeInitialViewProperties",null),c([p({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],qs.prototype,"layers",void 0),c([Ie("layers")],qs.prototype,"writeLayers",null),c([p({type:qt})],qs.prototype,"portalItem",void 0),c([p()],qs.prototype,"resourceInfo",void 0),c([p({readOnly:!0,type:XE,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],qs.prototype,"sourceVersion",void 0),c([Oe("sourceVersion")],qs.prototype,"readSourceVersion",null),c([Ie("sourceVersion")],qs.prototype,"writeSourceVersion",null),c([p({json:{read:!1,write:{ignoreOrigin:!0}}})],qs.prototype,"tables",void 0),c([Ie("tables")],qs.prototype,"writeTables",null),c([p()],qs.prototype,"thumbnailUrl",null),c([p()],qs.prototype,"updatingFromView",null),c([p({type:SNe,json:{write:!0}})],qs.prototype,"widgets",void 0),qs=c([R("esri.WebDocument2D")],qs);const R1t=qs,Es=(t=>t)(["operational-layers","basemap-base-layers","basemap-ground-layers","ground"]);var xse;let h2=xse=class extends ae{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new xse({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};c([p({type:String,json:{write:!0}})],h2.prototype,"expression",void 0),c([p({type:String,json:{write:!0}})],h2.prototype,"name",void 0),c([p({type:["boolean","date","number","string"],json:{write:!0}})],h2.prototype,"returnType",void 0),c([p({type:String,json:{write:!0}})],h2.prototype,"title",void 0),h2=xse=c([R("esri.form.ExpressionInfo")],h2);const I1t=h2;let Ru=class extends ae{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};c([p({type:String,json:{write:!0}})],Ru.prototype,"description",void 0),c([p({type:String,json:{write:!0}})],Ru.prototype,"label",void 0),c([p()],Ru.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],Ru.prototype,"visibilityExpression",void 0),Ru=c([R("esri.form.elements.Element")],Ru);let qU=class extends nt(ae){constructor(e){super(e),this.type=null}};c([p()],qU.prototype,"type",void 0),qU=c([R("esri.form.elements.inputs.attachments.Input")],qU);const g1=qU,H7=["any","capture","upload"];let a3=class extends g1{constructor(e){super(e),this.type="audio",this.inputMethod="any",this.maxDuration=null}};c([p({type:["audio"],readOnly:!0,json:{write:!0}})],a3.prototype,"type",void 0),c([p({type:H7,json:{write:!0}})],a3.prototype,"inputMethod",void 0),c([p({type:Number,json:{write:!0}})],a3.prototype,"maxDuration",void 0),a3=c([R("esri.form.elements.inputs.attachments.AudioInput")],a3);const Uxe=a3;let GD=class extends g1{constructor(e){super(e),this.type="document",this.maxFileSize=null}};c([p({type:["document"],readOnly:!0,json:{write:!0}})],GD.prototype,"type",void 0),c([p({type:Number,json:{write:!0}})],GD.prototype,"maxFileSize",void 0),GD=c([R("esri.form.elements.inputs.attachments.DocumentInput")],GD);const Bxe=GD;let o3=class extends g1{constructor(e){super(e),this.type="image",this.inputMethod="any",this.maxImageSize=null}};c([p({type:["image"],readOnly:!0,json:{write:!0}})],o3.prototype,"type",void 0),c([p({type:H7,json:{write:!0}})],o3.prototype,"inputMethod",void 0),c([p({type:Number,json:{write:!0}})],o3.prototype,"maxImageSize",void 0),o3=c([R("esri.form.elements.inputs.attachments.ImageInput")],o3);const qxe=o3;let HD=class extends g1{constructor(e){super(e),this.type="signature",this.inputMethod="any"}};c([p({type:["signature"],readOnly:!0,json:{write:!0}})],HD.prototype,"type",void 0),c([p({type:H7,json:{write:!0}})],HD.prototype,"inputMethod",void 0),HD=c([R("esri.form.elements.inputs.attachments.SignatureInput")],HD);const Gxe=HD;let l3=class extends g1{constructor(e){super(e),this.type="video",this.inputMethod="any",this.maxDuration=null}};c([p({type:["video"],readOnly:!0,json:{write:!0}})],l3.prototype,"type",void 0),c([p({type:H7,json:{write:!0}})],l3.prototype,"inputMethod",void 0),c([p({type:Number,json:{write:!0}})],l3.prototype,"maxDuration",void 0),l3=c([R("esri.form.elements.inputs.attachments.VideoInput")],l3);const Hxe=l3;function RNe(t){return{nestableTypes:{base:g1,key:"type",typeMap:{audio:Uxe,document:Bxe,image:qxe,signature:Gxe,video:Hxe}},allTypes:{base:g1,key:"type",typeMap:{attachment:t,audio:Uxe,document:Bxe,image:qxe,signature:Gxe,video:Hxe}}}}function D1t(t,e,i){return t?t.map(r=>sm(e.nestableTypes,r)):null}function k1t(t,e,i){if(!t)return null;const r=e.nestableTypes.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function L1t(t,e,i){if(!t)return null;const r=e.nestableTypes.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}let hg=class extends g1{constructor(e){super(e),this.type="attachment",this.attachmentAssociationType="exact",this.inputTypes=null}castInputs(e){return D1t(e,nQ)}readInputs(e,i){return k1t(i.inputTypes,nQ)}writeInputs(e,i){i.inputTypes=L1t(e,nQ)}};c([p({type:["attachment"],readOnly:!0,json:{write:!0}})],hg.prototype,"type",void 0),c([p({type:["any","exact","exactOrNone"],json:{write:!0}})],hg.prototype,"attachmentAssociationType",void 0),c([p({json:{write:{isRequired:!0}}})],hg.prototype,"inputTypes",void 0),c([wi("inputTypes")],hg.prototype,"castInputs",null),c([Oe("inputTypes")],hg.prototype,"readInputs",null),c([Ie("inputTypes")],hg.prototype,"writeInputs",null),hg=c([R("esri.form.elements.inputs.attachments.AttachmentInput")],hg);const nQ=RNe(hg),F1t=hg;var Sse;const z1t=RNe(F1t);let wh=Sse=class extends Ru{constructor(t){super(t),this.allowUserRename=!0,this.attachmentKeyword=null,this.displayFilename=!1,this.editableExpression=null,this.filenameExpression="{attachmentKeyword}_{now}",this.input=null,this.maxAttachmentCount=null,this.minAttachmentCount=null,this.type="attachment",this.useOriginalFilename=!0}clone(){return new Sse({allowUserRename:this.allowUserRename,attachmentKeyword:this.attachmentKeyword,description:this.description,displayFilename:this.displayFilename,editableExpression:this.editableExpression,filenameExpression:this.filenameExpression,input:this.input?.clone(),label:this.label,maxAttachmentCount:this.maxAttachmentCount,minAttachmentCount:this.minAttachmentCount,useOriginalFilename:this.useOriginalFilename,visibilityExpression:this.visibilityExpression})}};c([p({type:Boolean,json:{write:!0}})],wh.prototype,"allowUserRename",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],wh.prototype,"attachmentKeyword",void 0),c([p({type:Boolean,json:{write:!0}})],wh.prototype,"displayFilename",void 0),c([p({type:String,json:{write:!0}})],wh.prototype,"editableExpression",void 0),c([p({type:String,json:{write:!0}})],wh.prototype,"filenameExpression",void 0),c([p({types:z1t.allTypes,json:{read:{source:"inputType"},write:{target:"inputType",isRequired:!0}}})],wh.prototype,"input",void 0),c([p({type:Number,json:{write:!0}})],wh.prototype,"maxAttachmentCount",void 0),c([p({type:Number,json:{write:!0}})],wh.prototype,"minAttachmentCount",void 0),c([p({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],wh.prototype,"type",void 0),c([p({type:Boolean,json:{write:!0}})],wh.prototype,"useOriginalFilename",void 0),wh=Sse=c([R("esri.form.elements.AttachmentElement")],wh);const Wxe=wh;let GU=class extends ae{constructor(e){super(e),this.type=null}};c([p()],GU.prototype,"type",void 0),GU=c([R("esri.form.elements.inputs.Input")],GU);const i_=GU;let WD=class extends i_{constructor(e){super(e),this.maxLength=null,this.minLength=0}};c([p({type:Number,json:{write:!0}})],WD.prototype,"maxLength",void 0),c([p({type:Number,json:{write:!0}})],WD.prototype,"minLength",void 0),WD=c([R("esri.form.elements.inputs.TextInput")],WD);const hhe=WD;var Tse;let HU=Tse=class extends hhe{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new Tse({maxLength:this.maxLength,minLength:this.minLength})}};c([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],HU.prototype,"type",void 0),HU=Tse=c([R("esri.form.elements.inputs.BarcodeScannerInput")],HU);const N1t=HU;var $se;let c3=$se=class extends i_{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new $se({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};c([p({type:String,json:{write:!0}})],c3.prototype,"noValueOptionLabel",void 0),c([p({type:Boolean,json:{write:!0}})],c3.prototype,"showNoValueOption",void 0),c([p({type:["combo-box"],json:{read:!1,write:!0}})],c3.prototype,"type",void 0),c3=$se=c([R("esri.form.elements.inputs.ComboBoxInput")],c3);const V1t=c3;var Cse;function Zxe(t){return t??null}function Yxe(t){return t??null}let eg=Cse=class extends i_{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return Zxe(e.max)}writeMax(t,e){e.max=Yxe(t)}readMin(t,e){return Zxe(e.min)}writeMin(t,e){e.min=Yxe(t)}clone(){return new Cse({max:this.max,min:this.min})}};c([p({type:String,json:{type:String,write:!0}})],eg.prototype,"max",void 0),c([Oe("max")],eg.prototype,"readMax",null),c([Ie("max")],eg.prototype,"writeMax",null),c([p({type:String,json:{type:String,write:!0}})],eg.prototype,"min",void 0),c([Oe("min")],eg.prototype,"readMin",null),c([Ie("min")],eg.prototype,"writeMin",null),c([p({type:["date-picker"],json:{read:!1,write:!0}})],eg.prototype,"type",void 0),eg=Cse=c([R("esri.form.elements.inputs.DatePickerInput")],eg);const j1t=eg;var Mse;function aQ(t){return t??null}function oQ(t){return t??null}let fu=Mse=class extends i_{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return aQ(e.max)}writeMax(t,e){e.max=oQ(t)}readMin(t,e){return aQ(e.min)}writeMin(t,e){e.min=oQ(t)}readTimeResolution(t,e){return aQ(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=oQ(t)}clone(){return new Mse({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};c([p({type:Boolean,json:{write:!0}})],fu.prototype,"includeTimeOffset",void 0),c([p({type:String,json:{type:String,write:!0}})],fu.prototype,"max",void 0),c([Oe("max")],fu.prototype,"readMax",null),c([Ie("max")],fu.prototype,"writeMax",null),c([p({type:String,json:{type:String,write:!0}})],fu.prototype,"min",void 0),c([Oe("min")],fu.prototype,"readMin",null),c([Ie("min")],fu.prototype,"writeMin",null),c([p({type:String,json:{type:String,write:!0}})],fu.prototype,"timeResolution",void 0),c([Oe("timeResolution")],fu.prototype,"readTimeResolution",null),c([Ie("timeResolution")],fu.prototype,"writeTimeResolution",null),c([p({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],fu.prototype,"type",void 0),fu=Mse=c([R("esri.form.elements.inputs.DateTimeOffsetPickerInput")],fu);const U1t=fu;var Ese;function Jxe(t){return t!=null?new Date(t):null}function Qxe(t){return t?t.getTime():null}let uf=Ese=class extends i_{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return Jxe(e.max)}writeMax(t,e){e.max=Qxe(t)}readMin(t,e){return Jxe(e.min)}writeMin(t,e){e.min=Qxe(t)}clone(){return new Ese({includeTime:this.includeTime,max:this.max,min:this.min})}};c([p({type:Boolean,json:{write:!0}})],uf.prototype,"includeTime",void 0),c([p({type:Date,json:{type:Number,write:!0}})],uf.prototype,"max",void 0),c([Oe("max")],uf.prototype,"readMax",null),c([Ie("max")],uf.prototype,"writeMax",null),c([p({type:Date,json:{type:Number,write:!0}})],uf.prototype,"min",void 0),c([Oe("min")],uf.prototype,"readMin",null),c([Ie("min")],uf.prototype,"writeMin",null),c([p({type:["datetime-picker"],json:{read:!1,write:!0}})],uf.prototype,"type",void 0),uf=Ese=c([R("esri.form.elements.inputs.DateTimePickerInput")],uf);const B1t=uf;var Ase;let u3=Ase=class extends i_{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new Ase({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};c([p({type:String,json:{write:!0}})],u3.prototype,"noValueOptionLabel",void 0),c([p({type:Boolean,json:{write:!0}})],u3.prototype,"showNoValueOption",void 0),c([p({type:["radio-buttons"],json:{read:!1,write:!0}})],u3.prototype,"type",void 0),u3=Ase=c([R("esri.form.elements.inputs.RadioButtonsInput")],u3);const q1t=u3;var Ose;let h3=Ose=class extends i_{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Ose({offValue:this.offValue,onValue:this.onValue})}};c([p({type:[String,Number],json:{write:!0}})],h3.prototype,"offValue",void 0),c([p({type:[String,Number],json:{write:!0}})],h3.prototype,"onValue",void 0),c([p({type:["switch"],json:{read:!1,write:!0}})],h3.prototype,"type",void 0),h3=Ose=c([R("esri.form.elements.inputs.SwitchInput")],h3);const G1t=h3;var Pse;let WU=Pse=class extends hhe{constructor(t){super(t),this.type="text-area"}clone(){return new Pse({maxLength:this.maxLength,minLength:this.minLength})}};c([p({type:["text-area"],json:{read:!1,write:!0}})],WU.prototype,"type",void 0),WU=Pse=c([R("esri.form.elements.inputs.TextAreaInput")],WU);const H1t=WU;var Rse;let ZU=Rse=class extends hhe{constructor(t){super(t),this.type="text-box"}clone(){return new Rse({maxLength:this.maxLength,minLength:this.minLength})}};c([p({type:["text-box"],json:{read:!1,write:!0}})],ZU.prototype,"type",void 0),ZU=Rse=c([R("esri.form.elements.inputs.TextBoxInput")],ZU);const W1t=ZU;var Ise;function lQ(t){return t??null}function cQ(t){return t??null}let xh=Ise=class extends i_{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return lQ(e.max)}writeMax(t,e){e.max=cQ(t)}readMin(t,e){return lQ(e.min)}writeMin(t,e){e.min=cQ(t)}readTimeResolution(t,e){return lQ(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=cQ(t)}clone(){return new Ise({max:this.max,min:this.min,timeResolution:this.timeResolution})}};c([p({type:String,json:{type:String,write:!0}})],xh.prototype,"max",void 0),c([Oe("max")],xh.prototype,"readMax",null),c([Ie("max")],xh.prototype,"writeMax",null),c([p({type:String,json:{type:String,write:!0}})],xh.prototype,"min",void 0),c([Oe("min")],xh.prototype,"readMin",null),c([Ie("min")],xh.prototype,"writeMin",null),c([p({type:String,json:{type:String,write:!0}})],xh.prototype,"timeResolution",void 0),c([Oe("timeResolution")],xh.prototype,"readTimeResolution",null),c([Ie("timeResolution")],xh.prototype,"writeTimeResolution",null),c([p({type:["time-picker"],json:{read:!1,write:!0}})],xh.prototype,"type",void 0),xh=Ise=c([R("esri.form.elements.inputs.TimePickerInput")],xh);const Z1t=xh,Y1t=N1t,J1t=V1t,Q1t=j1t,X1t=U1t,K1t=B1t,ext=q1t,txt=G1t,ixt=H1t,rxt=W1t,sxt=Z1t,nxt={base:i_,key:"type",typeMap:{"barcode-scanner":Y1t,"combo-box":J1t,"date-picker":Q1t,"datetime-picker":K1t,"datetimeoffset-picker":X1t,"radio-buttons":ext,switch:txt,"text-area":ixt,"text-box":rxt,"time-picker":sxt}};var Dse;let Oh=Dse=class extends Ru{constructor(t){super(t),this.domain=null,this.editable=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new Dse({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};c([p({types:ZLe,json:{read:{reader:z7},write:!0}})],Oh.prototype,"domain",void 0),c([p({type:Boolean,json:{write:!0}})],Oh.prototype,"editable",void 0),c([p({type:String,json:{write:!0}})],Oh.prototype,"editableExpression",void 0),c([p({type:String,json:{write:!0}})],Oh.prototype,"fieldName",void 0),c([p({type:String,json:{write:!0}})],Oh.prototype,"hint",void 0),c([p({types:nxt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Oh.prototype,"input",void 0),c([p({type:String,json:{write:!0}})],Oh.prototype,"requiredExpression",void 0),c([p({type:String,json:{read:!1,write:!0}})],Oh.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],Oh.prototype,"valueExpression",void 0),Oh=Dse=c([R("esri.form.elements.FieldElement")],Oh);var kse;let cv=kse=class extends Ru{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new kse({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:se(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};c([p({type:Number,json:{write:!0}})],cv.prototype,"displayCount",void 0),c([p({type:["list"],json:{write:!0}})],cv.prototype,"displayType",void 0),c([p({type:String,json:{write:!0}})],cv.prototype,"editableExpression",void 0),c([p({type:[$ue],json:{write:!0}})],cv.prototype,"orderByFields",void 0),c([p({type:Number,json:{write:!0}})],cv.prototype,"relationshipId",void 0),c([p({type:["relationship"],json:{read:!1,write:!0}})],cv.prototype,"type",void 0),cv=kse=c([R("esri.form.elements.RelationshipElement")],cv);const Xxe=cv;var Lse;let d3=Lse=class extends Ru{constructor(t){super(t),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new Lse({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};c([p({type:String,json:{write:!0}})],d3.prototype,"text",void 0),c([p({type:String,json:{write:!0}})],d3.prototype,"textFormat",void 0),c([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],d3.prototype,"type",void 0),d3=Lse=c([R("esri.form.elements.TextElement")],d3);const Kxe=d3;let p3=class extends nt(Ru){constructor(e){super(e),this.associationTypes=null,this.editableExpression=null,this.type="utilityNetworkAssociations"}};c([p({type:[mLe],json:{write:{isRequired:!0}}})],p3.prototype,"associationTypes",void 0),c([p({type:String,json:{write:!0}})],p3.prototype,"editableExpression",void 0),c([p({type:["utilityNetworkAssociations"],json:{read:!1,write:!0}})],p3.prototype,"type",void 0),p3=c([R("esri.form.elements.UtilityNetworkAssociationsElement")],p3);const e2e=p3,axt=t=>t.type==="field",oxt=t=>t.type==="group",lxt=t=>t.type==="text";function INe(t){return{typesWithGroup:{base:Ru,key:"type",typeMap:{attachment:Wxe,field:Oh,group:t,relationship:Xxe,text:Kxe,utilityNetworkAssociations:e2e}},typesWithoutGroup:{base:Ru,key:"type",typeMap:{attachment:Wxe,field:Oh,relationship:Xxe,text:Kxe,utilityNetworkAssociations:e2e}}}}function DNe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function kNe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function LNe(t,e,i=!0){return t?t.map(r=>sm(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var Fse;let dg=Fse=class extends Ru{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return LNe(t,uQ,!1)}readElements(t,e){return DNe(e.formElements,uQ,!1)}writeElements(t,e){e.formElements=kNe(t,uQ,!1)}clone(){return new Fse({description:this.description,elements:se(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};c([p({json:{write:!0}})],dg.prototype,"elements",void 0),c([wi("elements")],dg.prototype,"castElements",null),c([Oe("elements",["formElements"])],dg.prototype,"readElements",null),c([Ie("elements")],dg.prototype,"writeElements",null),c([p({type:["collapsed","expanded"],json:{write:!0}})],dg.prototype,"initialState",void 0),c([p({type:String,json:{read:!1,write:!0}})],dg.prototype,"type",void 0),dg=Fse=c([R("esri.form.elements.GroupElement")],dg);const uQ=INe(dg),cxt=dg;var zse;const hQ=INe(cxt);let hf=zse=class extends ae{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return LNe(t,hQ)}readElements(t,e){return DNe(e.formElements,hQ)}writeElements(t,e){e.formElements=kNe(t,hQ)}clone(){return new zse({description:this.description,expressionInfos:se(this.expressionInfos),elements:se(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(t,e){const i=new Set,{description:r,elements:s,expressionInfos:n,title:a}=this;if(F4(i,t,r),F4(i,t,a),!s)return[];const o=uxt(s,n).map(l=>ic(i,t,null,l));await Promise.all(o);for(const l of s)FNe(i,{fieldsIndex:t,relationships:e},l);return Array.from(i).sort()}};function FNe(t,e,i){const{fieldsIndex:r}=e;if(!r||r.fields.length!==t.size)switch(F4(t,r,i.label),F4(t,r,i.description),i.type){case"field":ec(t,r,i.fieldName);break;case"group":i.elements.forEach(s=>FNe(t,e,s));break;case"relationship":if(e.relationships){const s=e.relationships.find(n=>n.id===i.relationshipId);s&&ec(t,r,s.keyField)}i$(t,r,i.orderByFields?.map(s=>s.field));break;case"text":F4(t,r,i.text)}}function uxt(t,e){if(!e||e.length===0)return[];const i=zNe(t),r=[];for(const s of e)i.has(s.name)&&r.push(s.expression);return r}function zNe(t){const e=new Set;for(const i of t)if(g_e(e,i.visibilityExpression),!lxt(i)){if(oxt(i))K8(e,zNe(i.elements));else if(g_e(e,i.editableExpression),axt(i)){const{requiredExpression:r,valueExpression:s}=i;K8(e,[r,s])}}return e}function F4(t,e,i){i$(t,e,wue(i))}c([p({type:String,json:{write:!0}})],hf.prototype,"description",void 0),c([p({json:{write:!0}})],hf.prototype,"elements",void 0),c([wi("elements")],hf.prototype,"castElements",null),c([Oe("elements",["formElements"])],hf.prototype,"readElements",null),c([Ie("elements")],hf.prototype,"writeElements",null),c([p({type:[I1t],json:{write:!0}})],hf.prototype,"expressionInfos",void 0),c([p({type:Boolean,json:{default:!1,write:!0}})],hf.prototype,"preserveFieldValuesWhenHidden",void 0),c([p({type:String,json:{write:!0}})],hf.prototype,"title",void 0),hf=zse=c([R("esri.form.FormTemplate")],hf);const dhe=Symbol("getSliceableSymbol");function hxt(t){return typeof t=="object"&&!!t&&dhe in t}function opi(t){return hxt(t)?t[dhe]:void 0}let H5=class{};H5=c([R("esri.graphic.GraphicOrigin")],H5);const NNe=Symbol("isFeatureGraphicOrigin");function cpi(t){return!!t&&NNe in t}var t2e;let dxt=class extends H5{get[(t2e=NNe,bF)](){return this.layer}get[Eue](){return this.layer}get[dhe](){return this.layer}constructor(e){super(),this[t2e]=!0,this.type="feature",this.layer=e}get id(){return this.layer.id}};function i2e(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function pxt(t,e,i){if(!t&&!e||!i)return;const r=ed(i);r2e(t,i,r),r2e(e,i,r)}function r2e(t,e,i){if(t)for(const r of t)fxt(r.geometry,e,i)}function fxt(t,e,i){if(!t?.spatialReference||zr(t.spatialReference,e))return;const r=ed(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)i2e(t,t.rings,r);else if("paths"in t)i2e(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}function s2e(t,e,i){if(!i?.features||!i.hasZ)return;const r=Gke(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const s of i.features)r(s.geometry)}var Nse;const Vse=new ii({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let mo=Nse=class extends ae{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){return this.readFeaturesWithClass(t,e,ms)}writeGeometryType(t,e,i,r){if(t)return void Vse.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if(n?.geometry!=null)return void Vse.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=wp(t);return r&&!i&&e.spatialReference&&(r.spatialReference=Me.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new Nse(this.cloneProperties())}cloneProperties(){return se({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t?.[i];r.geometry=s?.toJSON()||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=u=>Math.round((u-r)/e),a=u=>Math.round((s-u)/i),o=this.features,l=this._getQuantizationFunction(this.geometryType,n,a);for(let u=0,d=o.length;u<d;u++)l?.(o[u].geometry)||(o.splice(u,1),u--,d--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,a]}=i,o=g=>g*n+r,l=g=>s-g*a;let u=null,d=null;if(this.hasZ&&i?.scale?.[2]!=null){const{translate:[,,g],scale:[,,v]}=i;u=_=>_*v+g}if(this.hasM&&i?.scale?.[3]!=null){const{translate:[,,,g],scale:[,,,v]}=i;d=_=>_==null?_:_*v+g}const f=this._getHydrationFunction(t,o,l,u,d);for(const{geometry:g}of e)g!=null&&f&&f(g);return this.transform=null,this}readFeaturesWithClass(t,e,i){const r=Me.fromJSON(e.spatialReference),s=[];for(let n=0;n<t.length;n++){const a=t[n],o=i.fromJSON(a),l=a.geometry?.spatialReference;o.geometry==null||l||(o.geometry.spatialReference=r);const u=a.aggregateGeometries,d=o.aggregateGeometries;if(u&&d!=null)for(const f in d){const g=d[f],v=u[f],_=v?.spatialReference;g==null||_||(g.spatialReference=r)}s.push(o)}return s}_quantizePoints(t,e,i){let r,s;const n=[];for(let a=0,o=t.length;a<o;a++){const l=t[a];if(a>0){const u=e(l[0]),d=i(l[1]);u===r&&d===s||(n.push([u-r,d-s]),r=u,s=d)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=AS(r)?r.rings:r.paths,n=[];for(let a=0,o=s.length;a<o;a++){const l=s[a],u=this._quantizePoints(l,e,i);u&&n.push(u)}return n.length>0?(AS(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,s){return t==="point"?n=>{n.x=e(n.x),n.y=i(n.y),r&&(n.z=r(n.z))}:t==="polyline"||t==="polygon"?n=>{const a=AS(n)?n.rings:n.paths;let o,l;for(let u=0,d=a.length;u<d;u++){const f=a[u];for(let g=0,v=f.length;g<v;g++){const _=f[g];g>0?(o+=_[0],l+=_[1]):(o=_[0],l=_[1]),_[0]=e(o),_[1]=i(l)}}if(r&&s)for(let u=0,d=a.length;u<d;u++){const f=a[u];for(let g=0,v=f.length;g<v;g++){const _=f[g];_[2]=r(_[2]),_[3]=s(_[3])}}else if(r)for(let u=0,d=a.length;u<d;u++){const f=a[u];for(let g=0,v=f.length;g<v;g++){const _=f[g];_[2]=r(_[2])}}else if(s)for(let u=0,d=a.length;u<d;u++){const f=a[u];for(let g=0,v=f.length;g<v;g++){const _=f[g];_[2]=s(_[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=i(n.ymin),n.xmax=e(n.xmax),n.ymax=i(n.ymax),r&&n.zmax!=null&&n.zmin!=null&&(n.zmax=r(n.zmax),n.zmin=r(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const a=n.points;let o,l;for(let u=0,d=a.length;u<d;u++){const f=a[u];u>0?(o+=f[0],l+=f[1]):(o=f[0],l=f[1]),f[0]=e(o),f[1]=i(l)}if(r&&s)for(let u=0,d=a.length;u<d;u++){const f=a[u];f[2]=r(f[2]),f[3]=s(f[3])}else if(r)for(let u=0,d=a.length;u<d;u++){const f=a[u];f[2]=r(f[2])}else if(s)for(let u=0,d=a.length;u<d;u++){const f=a[u];f[2]=s(f[2])}}:null}};c([p({type:String,json:{write:!0}})],mo.prototype,"displayFieldName",void 0),c([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],mo.prototype,"exceededTransferLimit",void 0),c([p({type:[ms],json:{write:!0}})],mo.prototype,"features",void 0),c([Oe("features")],mo.prototype,"readFeatures",null),c([p({type:[vo],json:{write:!0}})],mo.prototype,"fields",void 0),c([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:Vse.read}}})],mo.prototype,"geometryType",void 0),c([Ie("geometryType")],mo.prototype,"writeGeometryType",null),c([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],mo.prototype,"hasM",void 0),c([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],mo.prototype,"hasZ",void 0),c([p({types:gP,json:{write:!0}})],mo.prototype,"queryGeometry",void 0),c([Oe("queryGeometry")],mo.prototype,"readQueryGeometry",null),c([p({type:Me,json:{write:!0}})],mo.prototype,"spatialReference",void 0),c([Ie("spatialReference")],mo.prototype,"writeSpatialReference",null),c([p({json:{write:!0}})],mo.prototype,"transform",void 0),mo=Nse=c([R("esri.rest.support.FeatureSet")],mo),mo.prototype.toJSON.isDefaultToJSON=!0;let mxt=0,Fv=class extends $7(fF(ke)){constructor(e){super(e),this._idToClientGeometry=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);s2e(e,this.layer.spatialReference,r);const s=mo.fromJSON(r);if(!this._requiresClientGraphicMapping()||!this._idToClientGeometry)return s;const n=this.layer.objectIdField;for(const a of s.features){const o=a.attributes[n],l=this._idToClientGeometry.get(o);l!==void 0&&(a.geometry=l)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new q("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return s2e(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:It.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async queryAttributeBins(e,i={}){return await this.load(),this._connection.invoke("queryAttributeBins",e?.toJSON(),i)}async _applyEdits(e){if(!this._connection)throw new q("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const a=d=>"objectId"in d&&d.objectId!=null?d.objectId:"attributes"in d&&d.attributes[i]!=null?d.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const d of e.deleteFeatures){const f=a(d);f!=null&&s.push(f)}const o=e.updateFeatures&&this._idToClientGeometry?new Map:null;if(e.updateFeatures){for(const d of e.updateFeatures)if(n.push(this._serializeFeature(d)),o&&d.geometry!=null){const f=a(d);f!=null&&o.set(f,d)}}pxt(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:u}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(u.uidToObjectId),this._updateIdToClientGeometries(o,u),this._createEditsResult(u)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateIdToClientGeometries(e,i){if(this._idToClientGeometry){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGeometry(s)}for(const r of i.deleteResults)r.success&&this._idToClientGeometry.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:""};return{objectId:e.objectId,globalId:e.globalId,error:i?new q("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let a=0;a<e.length;a++){const o=e[a],l=this._serializeFeature(o);s||o.geometry==null||(s=o.geometry.type),r[a]=l,i.set(`${l.uid}`,o)}const n=this;return{features:r,inferredGeometryType:s,finish(a){const o=n.sourceJSON.objectIdField;for(const l in a){const u=a[l],d=i.get(l);d&&(d.attributes||(d.attributes={}),u===-1?delete d.attributes[o]:d.attributes[o]=u,n._addIdToClientGeometry(d))}}}}_addIdToClientGeometry(e){if(!this._idToClientGeometry)return;const i=this.sourceJSON.objectIdField,r=e.attributes?.[i];r!=null&&this._idToClientGeometry.set(r,e.geometry??null)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(mxt++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?Wr.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await Rke("MemorySourceWorker",{strategy:ie("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:a,timeInfo:o,dateFieldsTimeZone:l}=this.layer,u=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const d=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",_=>{re.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),_.preventDefault()}));const f={features:d.features,fields:i?.map(_=>_.toJSON()),geometryType:mbe.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||a,objectIdField:s,spatialReference:u?null:r&&r.toJSON(),timeInfo:o?.toJSON()??null,dateFieldsTimeZone:l},g=await this._connection.invoke("load",f,{signal:e});for(const _ of g.warnings)re.getLogger(this.layer).warn("#load()",`${_.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:_});g.featureErrors.length&&re.getLogger(this.layer).warn("#load()",`Encountered ${g.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:g.featureErrors});const v=g.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(d.inferredGeometryType)&&(v.geometryType=mbe.toJSON(d.inferredGeometryType)),this.sourceJSON=v,this._requiresClientGraphicMapping()&&(this._idToClientGeometry=new Map),d.finish(g.assignedObjectIds)}};c([Pce({Type:ms,ensureType:en(ms)})],Fv.prototype,"itemType",void 0),c([p()],Fv.prototype,"type",void 0),c([p({constructOnly:!0})],Fv.prototype,"layer",void 0),c([p({readOnly:!0})],Fv.prototype,"_workerGeometryType",null),c([p()],Fv.prototype,"sourceJSON",void 0),Fv=c([R("esri.layers.graphics.sources.MemorySource")],Fv);function gxt(t){return"portalItem"in t}const yxt=t=>{const e=t;let i=class extends e{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):gxt(this)?this.portalItem?.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return c([p({type:String})],i.prototype,"apiKey",null),i=c([R("esri.layers.mixins.APIKeyMixin")],i),i},vxt=t=>{const e=t;let i=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=Zg(this.url);if(r?.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",tst(r,re.getLogger(this)))}};return c([p()],i.prototype,"title",null),c([p({type:String})],i.prototype,"url",null),i=c([R("esri.layers.mixins.ArcGISService")],i),i};let n2e=class extends SyntaxError{constructor(e,i,r,s){super(e),this.expected=i,this.found=r,this.location=s,this.name="SyntaxError"}format(e){let i="Error: "+this.message;if(this.location){let r=null;const s=e.find(l=>l.source===this.location.source);s&&(r=s.text.split(/\r\n|\n|\r/g));const n=this.location.start,a=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(n):n,o=this.location.source+":"+a.line+":"+a.column;if(r){const l=this.location.end,u="".padEnd(a.line.toString().length," "),d=r[n.line-1],f=(n.line===l.line?l.column:d.length+1)-n.column||1;i+=`
 --> `+o+`
`+u+` |
`+a.line+" | "+d+`
`+u+" | "+"".padEnd(n.column-1," ")+"".padEnd(f,"^")}else i+=`
 at `+o}return i}static buildMessage(e,i){function r(g){return g.codePointAt(0).toString(16).toUpperCase()}const s=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function n(g){return s?g.replace(s,v=>"\\u{"+r(v)+"}"):g}function a(g){return n(g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,v=>"\\x0"+r(v)).replace(/[\x10-\x1F\x7F-\x9F]/g,v=>"\\x"+r(v)))}function o(g){return n(g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,v=>"\\x0"+r(v)).replace(/[\x10-\x1F\x7F-\x9F]/g,v=>"\\x"+r(v)))}const l={literal:g=>'"'+a(g.text)+'"',class(g){const v=g.parts.map(_=>Array.isArray(_)?o(_[0])+"-"+o(_[1]):o(_));return"["+(g.inverted?"^":"")+v.join("")+"]"+(g.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:g=>g.description};function u(g){return l[g.type](g)}function d(g){const v=g.map(u);if(v.sort(),v.length>0){let _=1;for(let x=1;x<v.length;x++)v[x-1]!==v[x]&&(v[_]=v[x],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(g){return g?'"'+a(g)+'"':"end of input"}return"Expected "+d(e)+" but "+f(i)+" found."}};function _xt(t,e){const i={},r=(e=e!==void 0?e:{}).grammarSource,s={start:Lp};let n=Lp;const a="none",o=")",l=",",u="(",d="%",f="px",g="cm",v="mm",_="in",x="pt",S="pc",T="deg",M="rad",E="grad",P="turn",O="#",D=".",L="e",F=/^[ \t\n\r]/,j=/^[a-z\-]/,N=/^[0-9a-fA-F]/,B=/^[+\-]/,U=/^[0-9]/,Q=Oi("none"),H=gr("none",!1),J=gr(")",!1),Z=gr(",",!1),K=Ia([" ","	",`
`,"\r"],!1,!1,!1),ee=Oi("function"),_e=gr("(",!1),Ne=Oi("identifier"),G=Ia([["a","z"],"-"],!1,!1,!1),le=Oi("percentage"),de=gr("%",!1),Se=Oi("length"),je=gr("px",!1),Be=gr("cm",!1),pt=gr("mm",!1),Dt=gr("in",!1),at=gr("pt",!1),Bt=gr("pc",!1),kt=Oi("angle"),Lt=gr("deg",!1),Xt=gr("rad",!1),Ge=gr("grad",!1),Wt=gr("turn",!1),Ze=Oi("number"),We=Oi("color"),St=gr("#",!1),vt=Ia([["0","9"],["a","f"],["A","F"]],!1,!1,!1),Nt=Ia(["+","-"],!1,!1,!1),tt=Ia([["0","9"]],!1,!1,!1),Qe=gr(".",!1),et=gr("e",!1);function ht(){return[]}function ri(Y,fe){return{type:"function",name:Y,parameters:fe||[]}}function Wi(Y,fe){return fe.length>0?Sm(Y,fe,3):[Y]}function zi(Y){return{type:"quantity",value:Y.value,unit:Y.unit}}function ci(Y){return{type:"color",colorType:Y.type,value:Y.value}}function or(Y){return Y}function tr(){return Oo()}function Mi(Y){return{value:Y,unit:"%"}}function Ei(Y){return{value:Y,unit:"px"}}function ui(Y){return{value:Y,unit:"cm"}}function Ot(Y){return{value:Y,unit:"mm"}}function Zt(Y){return{value:Y,unit:"in"}}function Jt(Y){return{value:Y,unit:"pt"}}function Ni(Y){return{value:Y,unit:"pc"}}function Nr(Y){return{value:Y,unit:"deg"}}function ir(Y){return{value:Y,unit:"rad"}}function Vi(Y){return{value:Y,unit:"grad"}}function Vr(Y){return{value:Y,unit:"turn"}}function is(Y){return{value:Y,unit:null}}function Ds(){return{type:"hex",value:Oo()}}function Ra(Y){return{type:"function",value:Y}}function En(){return{type:"named",value:Oo()}}function Xo(){return parseFloat(Oo())}let pe=0|e.peg$currPos,hi=pe;const ai=[{line:1,column:1}];let rs,lr=pe,Us=e.peg$maxFailExpected||[],it=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');n=s[e.startRule]}function Oo(){return t.substring(hi,pe)}function Ko(Y=pe){const fe=t.codePointAt(Y);return fe===void 0?"":String.fromCodePoint(fe)}function gr(Y,fe){return{type:"literal",text:Y,ignoreCase:fe}}function Ia(Y,fe,qe,Vt){return{type:"class",parts:Y,inverted:fe,ignoreCase:qe,unicode:Vt}}function rn(){return{type:"end"}}function Oi(Y){return{type:"other",description:Y}}function ao(Y){let fe,qe=ai[Y];if(qe)return qe;if(Y>=ai.length)fe=ai.length-1;else for(fe=Y;!ai[--fe];);for(qe=ai[fe],qe={line:qe.line,column:qe.column};fe<Y;)t.charCodeAt(fe)===10?(qe.line++,qe.column=1):qe.column++,fe++;return ai[Y]=qe,qe}function kp(Y,fe,qe){const Vt=ao(Y),Zi=ao(fe);return{source:r,start:{offset:Y,line:Vt.line,column:Vt.column},end:{offset:fe,line:Zi.line,column:Zi.column}}}function Kt(Y){pe<lr||(pe>lr&&(lr=pe,Us=[]),Us.push(Y))}function oy(Y,fe,qe){return new n2e(n2e.buildMessage(Y,fe),Y,fe,qe)}function Lp(){let Y;return Y=ly(),Y===i&&(Y=wm()),Y}function ly(){let Y,fe;return it++,Y=pe,rr(),t.substr(pe,4)===a?(fe=a,pe+=4):(fe=i,it===0&&Kt(H)),fe!==i?(rr(),hi=Y,Y=ht()):(pe=Y,Y=i),it--,Y===i&&it===0&&Kt(Q),Y}function wm(){let Y,fe;if(Y=[],fe=Xc(),fe!==i)for(;fe!==i;)Y.push(fe),fe=Xc();else Y=i;return Y}function Xc(){let Y,fe,qe,Vt;return Y=pe,rr(),fe=oo(),fe!==i?(rr(),qe=ac(),qe===i&&(qe=null),rr(),t.charCodeAt(pe)===41?(Vt=o,pe++):(Vt=i,it===0&&Kt(J)),Vt!==i?(rr(),hi=Y,Y=ri(fe,qe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y}function ac(){let Y,fe,qe,Vt,Zi,bs,ks,oa;if(Y=pe,fe=el(),fe!==i){for(qe=[],Vt=pe,Zi=rr(),t.charCodeAt(pe)===44?(bs=l,pe++):(bs=i,it===0&&Kt(Z)),bs===i&&(bs=null),ks=rr(),oa=el(),oa!==i?(Zi=[Zi,bs,ks,oa],Vt=Zi):(pe=Vt,Vt=i);Vt!==i;)qe.push(Vt),Vt=pe,Zi=rr(),t.charCodeAt(pe)===44?(bs=l,pe++):(bs=i,it===0&&Kt(Z)),bs===i&&(bs=null),ks=rr(),oa=el(),oa!==i?(Zi=[Zi,bs,ks,oa],Vt=Zi):(pe=Vt,Vt=i);hi=Y,Y=Wi(fe,qe)}else pe=Y,Y=i;return Y}function el(){let Y,fe;return Y=pe,fe=aa(),fe===i&&(fe=Xu(),fe===i&&(fe=$l(),fe===i&&(fe=oc()))),fe!==i&&(hi=Y,fe=zi(fe)),Y=fe,Y===i&&(Y=pe,fe=Fp(),fe!==i&&(hi=Y,fe=ci(fe)),Y=fe),Y}function rr(){let Y,fe;for(it++,Y=[],fe=t.charAt(pe),F.test(fe)?pe++:(fe=i,it===0&&Kt(K));fe!==i;)Y.push(fe),fe=t.charAt(pe),F.test(fe)?pe++:(fe=i,it===0&&Kt(K));return it--,Y}function oo(){let Y,fe,qe;return it++,Y=pe,fe=ss(),fe!==i?(t.charCodeAt(pe)===40?(qe=u,pe++):(qe=i,it===0&&Kt(_e)),qe!==i?(hi=Y,Y=fe):(pe=Y,Y=i)):(pe=Y,Y=i),it--,Y===i&&(fe=i,it===0&&Kt(ee)),Y}function ss(){let Y,fe,qe;if(it++,Y=pe,fe=[],qe=t.charAt(pe),j.test(qe)?pe++:(qe=i,it===0&&Kt(G)),qe!==i)for(;qe!==i;)fe.push(qe),qe=t.charAt(pe),j.test(qe)?pe++:(qe=i,it===0&&Kt(G));else fe=i;return fe!==i&&(hi=Y,fe=tr()),Y=fe,it--,Y===i&&(fe=i,it===0&&Kt(Ne)),Y}function aa(){let Y,fe,qe;return it++,Y=pe,rr(),fe=Da(),fe!==i?(t.charCodeAt(pe)===37?(qe=d,pe++):(qe=i,it===0&&Kt(de)),qe!==i?(hi=Y,Y=Mi(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),it--,Y===i&&it===0&&Kt(le),Y}function Xu(){let Y,fe,qe;return it++,Y=pe,rr(),fe=Da(),fe!==i?(t.substr(pe,2)===f?(qe=f,pe+=2):(qe=i,it===0&&Kt(je)),qe!==i?(hi=Y,Y=Ei(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y===i&&(Y=pe,rr(),fe=Da(),fe!==i?(t.substr(pe,2)===g?(qe=g,pe+=2):(qe=i,it===0&&Kt(Be)),qe!==i?(hi=Y,Y=ui(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y===i&&(Y=pe,rr(),fe=Da(),fe!==i?(t.substr(pe,2)===v?(qe=v,pe+=2):(qe=i,it===0&&Kt(pt)),qe!==i?(hi=Y,Y=Ot(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y===i&&(Y=pe,rr(),fe=Da(),fe!==i?(t.substr(pe,2)===_?(qe=_,pe+=2):(qe=i,it===0&&Kt(Dt)),qe!==i?(hi=Y,Y=Zt(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y===i&&(Y=pe,rr(),fe=Da(),fe!==i?(t.substr(pe,2)===x?(qe=x,pe+=2):(qe=i,it===0&&Kt(at)),qe!==i?(hi=Y,Y=Jt(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y===i&&(Y=pe,rr(),fe=Da(),fe!==i?(t.substr(pe,2)===S?(qe=S,pe+=2):(qe=i,it===0&&Kt(Bt)),qe!==i?(hi=Y,Y=Ni(fe)):(pe=Y,Y=i)):(pe=Y,Y=i)))))),it--,Y===i&&it===0&&Kt(Se),Y}function $l(){let Y,fe,qe;return it++,Y=pe,fe=Da(),fe!==i?(t.substr(pe,3)===T?(qe=T,pe+=3):(qe=i,it===0&&Kt(Lt)),qe!==i?(hi=Y,Y=Nr(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y===i&&(Y=pe,fe=Da(),fe!==i?(t.substr(pe,3)===M?(qe=M,pe+=3):(qe=i,it===0&&Kt(Xt)),qe!==i?(hi=Y,Y=ir(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y===i&&(Y=pe,fe=Da(),fe!==i?(t.substr(pe,4)===E?(qe=E,pe+=4):(qe=i,it===0&&Kt(Ge)),qe!==i?(hi=Y,Y=Vi(fe)):(pe=Y,Y=i)):(pe=Y,Y=i),Y===i&&(Y=pe,fe=Da(),fe!==i?(t.substr(pe,4)===P?(qe=P,pe+=4):(qe=i,it===0&&Kt(Wt)),qe!==i?(hi=Y,Y=Vr(fe)):(pe=Y,Y=i)):(pe=Y,Y=i)))),it--,Y===i&&(fe=i,it===0&&Kt(kt)),Y}function oc(){let Y,fe;return it++,Y=pe,rr(),fe=Da(),fe!==i?(hi=Y,Y=is(fe)):(pe=Y,Y=i),it--,Y===i&&it===0&&Kt(Ze),Y}function Fp(){let Y,fe,qe,Vt;if(it++,Y=pe,t.charCodeAt(pe)===35?(fe=O,pe++):(fe=i,it===0&&Kt(St)),fe!==i){if(qe=[],Vt=t.charAt(pe),N.test(Vt)?pe++:(Vt=i,it===0&&Kt(vt)),Vt!==i)for(;Vt!==i;)qe.push(Vt),Vt=t.charAt(pe),N.test(Vt)?pe++:(Vt=i,it===0&&Kt(vt));else qe=i;qe!==i?(hi=Y,Y=Ds()):(pe=Y,Y=i)}else pe=Y,Y=i;return Y===i&&(Y=pe,fe=Xc(),fe!==i&&(hi=Y,fe=Ra(fe)),Y=fe,Y===i&&(Y=pe,fe=ss(),fe!==i&&(hi=Y,fe=En()),Y=fe)),it--,Y===i&&(fe=i,it===0&&Kt(We)),Y}function Da(){let Y,fe,qe,Vt,Zi,bs,ks,oa;for(Y=pe,fe=t.charAt(pe),B.test(fe)?pe++:(fe=i,it===0&&Kt(Nt)),fe===i&&(fe=null),qe=pe,Vt=[],Zi=t.charAt(pe),U.test(Zi)?pe++:(Zi=i,it===0&&Kt(tt));Zi!==i;)Vt.push(Zi),Zi=t.charAt(pe),U.test(Zi)?pe++:(Zi=i,it===0&&Kt(tt));if(t.charCodeAt(pe)===46?(Zi=D,pe++):(Zi=i,it===0&&Kt(Qe)),Zi!==i){if(bs=[],ks=t.charAt(pe),U.test(ks)?pe++:(ks=i,it===0&&Kt(tt)),ks!==i)for(;ks!==i;)bs.push(ks),ks=t.charAt(pe),U.test(ks)?pe++:(ks=i,it===0&&Kt(tt));else bs=i;bs!==i?(Vt=[Vt,Zi,bs],qe=Vt):(pe=qe,qe=i)}else pe=qe,qe=i;if(qe===i)if(qe=[],Vt=t.charAt(pe),U.test(Vt)?pe++:(Vt=i,it===0&&Kt(tt)),Vt!==i)for(;Vt!==i;)qe.push(Vt),Vt=t.charAt(pe),U.test(Vt)?pe++:(Vt=i,it===0&&Kt(tt));else qe=i;if(qe!==i){if(Vt=pe,t.charCodeAt(pe)===101?(Zi=L,pe++):(Zi=i,it===0&&Kt(et)),Zi!==i){if(bs=t.charAt(pe),B.test(bs)?pe++:(bs=i,it===0&&Kt(Nt)),bs===i&&(bs=null),ks=[],oa=t.charAt(pe),U.test(oa)?pe++:(oa=i,it===0&&Kt(tt)),oa!==i)for(;oa!==i;)ks.push(oa),oa=t.charAt(pe),U.test(oa)?pe++:(oa=i,it===0&&Kt(tt));else ks=i;ks!==i?(Zi=[Zi,bs,ks],Vt=Zi):(pe=Vt,Vt=i)}else pe=Vt,Vt=i;Vt===i&&(Vt=null),hi=Y,Y=Xo()}else pe=Y,Y=i;return Y}function xm(Y,fe){return Y.map(function(qe){return qe[fe]})}function Sm(Y,fe,qe){return[Y].concat(xm(fe,qe))}rs=n();const zp=rs!==i&&pe===t.length;function Tm(){throw rs!==i&&pe<t.length&&Kt(rn()),oy(Us,lr<t.length?Ko(lr):null,lr<t.length?kp(lr,lr+1):kp(lr,lr))}return e.peg$library?{peg$result:rs,peg$currPos:pe,peg$FAILED:i,peg$maxFailExpected:Us,peg$maxFailPos:lr,peg$success:zp,peg$throw:zp?void 0:Tm}:zp?rs:void Tm()}function VNe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=a2e(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new q("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:a2e(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!Kpt(e[i].effects,e[i+1].effects))throw new q("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});eft(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function a2e(t){let e;if(!t)return[];try{e=_xt(t)}catch(i){throw new q("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>bxt(i))}function bxt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return wxt(t);case"opacity":return xxt(t);case"hue-rotate":return Sxt(t);case"blur":return Txt(t);case"drop-shadow":return $xt(t);case"bloom":return Cxt(t)}}catch(e){throw e.details.filter=t,e}throw new q("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function wxt(t){let e=1;return SP(t.parameters,1),t.parameters.length===1&&(e=Mf(t.parameters[0])),new uie(t.name,e)}function xxt(t){let e=1;return SP(t.parameters,1),t.parameters.length===1&&(e=Mf(t.parameters[0])),new T5e(e)}function Sxt(t){let e=0;return SP(t.parameters,1),t.parameters.length===1&&(e=Rxt(t.parameters[0])),new x5e(e)}function Txt(t){let e=0;return SP(t.parameters,1),t.parameters.length===1&&(e=mhe(t.parameters[0]),AF(e,t.parameters[0])),new y5e(e)}function $xt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new q("effect:type-error","Accepts only one color",{});i=Ixt(r)}else{const s=mhe(r);if(Object.isFrozen(e))throw new q("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&AF(s,r)}if(e.length<2||e.length>3)throw new q("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new b5e(e[0],e[1],e[2]||0,i||jNe("black"))}function Cxt(t){let e=1,i=0,r=0;return SP(t.parameters,3),t.parameters[0]&&(e=Mf(t.parameters[0])),t.parameters[1]&&(i=mhe(t.parameters[1]),AF(i,t.parameters[1])),t.parameters[2]&&(r=Mf(t.parameters[2])),new m5e(e,i,r)}function SP(t,e){if(t.length>e)throw new q("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function W7(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in fhe)return"<length>";if(t.unit in phe)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function AF(t,e){if(t<0)throw new q("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function Mxt(t){if(t.type!=="quantity"||t.unit!==null)throw new q("effect:type-error",`Expected <double>, Actual: ${W7(t)}`,{term:t})}function Ext(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new q("effect:type-error",`Expected <double> or <percentage>, Actual: ${W7(t)}`,{term:t})}const phe={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Axt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&phe[t.unit]!=null))throw new q("effect:type-error",`Expected <angle>, Actual: ${W7(t)}`,{term:t})}const fhe={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Oxt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&fhe[t.unit]!=null))throw new q("effect:type-error",`Expected <length>, Actual: ${W7(t)}`,{term:t})}function Mf(t){Ext(t);const e=t.value;return AF(e,t),t.unit==="%"?.01*e:e}function Pxt(t){return Mxt(t),AF(t.value,t),t.value}function Rxt(t){return Axt(t),t.value*phe[t.unit]||0}function mhe(t){return Oxt(t),t.value*fhe[t.unit]||0}function Ixt(t){switch(t.colorType){case"hex":return Qdt(t.value);case"named":return jNe(t.value);case"function":return Lxt(t.value)}}function jNe(t){if(!B4e(t))throw new q("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return Jdt(t)}const Dxt=/^rgba?/i,kxt=/^hsla?/i;function Lxt(t){if(SP(t.parameters,4),Dxt.test(t.name))return[Mf(t.parameters[0]),Mf(t.parameters[1]),Mf(t.parameters[2]),t.parameters[3]?Mf(t.parameters[3]):1];if(kxt.test(t.name))return q4e(Pxt(t.parameters[0]),Mf(t.parameters[1]),Mf(t.parameters[2]),t.parameters[3]?Mf(t.parameters[3]):1);throw new q("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function W5(t,e,i){try{return zxt(t)}catch(r){i?.messages?.push(r)}return null}function Z5(t,e,i,r){try{const s=Fxt(t);ra(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function Fxt(t){const e=VNe(t);return e?tft(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function zxt(t){if(!t||t.length===0)return null;if(Nxt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:o2e(i.value)});return e}return o2e(t)}function Nxt(t){const e=t[0];return!!e&&"scale"in e}function o2e(t){if(!t?.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Ry(i,"amount")];break;case"blur":r=[Ry(i,"radius","pt")];break;case"hue-rotate":r=[Ry(i,"angle","deg")];break;case"drop-shadow":r=[Ry(i,"xoffset","pt"),Ry(i,"yoffset","pt"),Ry(i,"blurRadius","pt"),Vxt(i,"color")];break;case"bloom":r=[Ry(i,"strength"),Ry(i,"radius","pt"),Ry(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;VNe(s),e.push(s)}return e.join(" ")}function Ry(t,e,i){if(t[e]==null)throw new q("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function Vxt(t,e){if(t[e]==null)throw new q("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const jxt={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:Es}},"portal-item":{read:!0,write:{layerContainerTypes:Es}}}}},l2e={read:{reader:W5},write:{allowNull:!0,writer:Z5,layerContainerTypes:Es}},Uxt={json:{read:!1,write:!1,origins:{"web-map":l2e,"portal-item":l2e}}},UNe=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return c([p(jxt)],i.prototype,"blendMode",void 0),c([p(Uxt)],i.prototype,"effect",void 0),i=c([R("esri.layers.mixins.BlendLayer")],i),i},Bxt=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.customParameters=null}};return c([p({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],i.prototype,"customParameters",void 0),i=c([R("esri.layers.mixins.CustomParametersMixin")],i),i},ghe=96;function ppi(t,e){const i=t.extent,r=t.width,s=Yr(i?.spatialReference);return i&&r?i.width/r*s*cce*ghe:0}function qxt(t,e){return t/(Yr(e)*cce*ghe)}function Gxt(t){return t/(cce*ghe)}function fpi(t,e,i){return Hxt(t,e)&&Wxt(t,i)}function Hxt(t,e){return e===0||yl(t,e)||t<e}function Wxt(t,e){return e===0||yl(t,e)||t>e}function Zxt(t,e){return yl(t,e)?0:(t||Number.POSITIVE_INFINITY)>(e||Number.POSITIVE_INFINITY)?1:-1}const c2e={write:{overridePolicy:(t,e,i)=>({enabled:!i||i.filterMode==="scale"})}};let zv=class extends nt(ae){constructor(e){super(e),this.id=I1(),this.maxScale=0,this.minScale=0,this.title="",this.where=null}};c([p({type:String,json:{write:!0}})],zv.prototype,"id",void 0),c([p({type:Number,json:c2e})],zv.prototype,"maxScale",void 0),c([p({type:Number,json:c2e})],zv.prototype,"minScale",void 0),c([p({type:String,json:{write:!0}})],zv.prototype,"title",void 0),c([p({type:String,json:{write:!0}})],zv.prototype,"where",void 0),zv=c([R("esri.layers.support.DisplayFilter")],zv);function Yxt(t,e){return{...e,filterMode:t.mode}}function gpi(t,e){return BNe(t,e).next().value??null}function ypi(t,e,i){const r=Jxt(t);if(r&&(rRe(e,r[0])||Yee(i,r[1])))return"";const s=Array.from(BNe(t,e,i)),n=Qxt(s,e,i)?"1=1":s.map(a=>a.where||"1=1").reduce((a,o)=>fie(a,o),"");return n&&n!=="1=1"?n:""}function Jxt(t){if(qNe(t)==="manual")return null;const e=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:i,maxScale:r}of t.filters)e[0]=Math.max(e[0],Y5(i)),e[1]=Math.min(e[1],Kq(r));return e}function*BNe(t,e,i){if(qNe(t)==="manual"){const r=t.filters.find(s=>s.id===t.activeFilterId);r&&(yield r)}else{typeof e=="object"&&(e=e.scale);for(const r of t.filters)Xxt(r.minScale,r.maxScale,e,i)&&(yield r)}}function Qxt(t,e,i){if(t.length===0)return!0;const r=Y5(t.at(0)?.minScale),s=Kq(t.at(-1)?.maxScale);if(Yee(r,e)||rRe(s,i))return!0;for(let n=0;n<t.length-1;n++){const a=t[n],o=t[n+1];if(Yee(Y5(o.minScale),Kq(a.maxScale)))return!0}return!1}function Xxt(t,e,i,r){return t=Y5(t),i=Y5(i),e=Kq(e),!(!yl(i,t)&&(r??i)>t)&&!ert(e,i)&&(r===void 0||!yl(r,t))}function qNe(t){return"mode"in t?t.mode:t.filterMode}function Y5(t){return t||Number.POSITIVE_INFINITY}function Kq(t){return t||0}let d2=class extends nt(ae){constructor(e){super(e),this.activeFilterId=null,this.filters=new(ke.ofType(zv)),this.mode="manual"}writeFilters(e,i,r,s){const n=e.toArray();this.mode==="scale"&&n.sort((a,o)=>{const l=Zxt(o.minScale,a.minScale),u=a.maxScale-o.maxScale;return l===0?u:l}),i[r]=n.map(a=>a.toJSON(s))}write(e,i){return super.write(e,Yxt(this,i))}};c([p({type:String,json:{write:{overridePolicy:(t,e,i)=>({enabled:i.filterMode==="manual",isRequired:!0})}}})],d2.prototype,"activeFilterId",void 0),c([p({type:ke.ofType(zv),nonNullable:!0,json:{write:!0}})],d2.prototype,"filters",void 0),c([Ie("filters")],d2.prototype,"writeFilters",null),c([p({type:["manual","scale"],nonNullable:!0,json:{name:"filterMode",write:!0}})],d2.prototype,"mode",void 0),d2=c([R("esri.layers.support.DisplayFilterInfo")],d2);const Kxt=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.displayFilterEnabled=!0,this.displayFilterInfo=null}};return c([p(e2t)],i.prototype,"displayFilterEnabled",void 0),c([p(t2t)],i.prototype,"displayFilterInfo",void 0),i=c([R("esri.layers.mixins.DisplayFilteredLayer")],i),i},e2t={type:Boolean,json:{name:"layerDefinition.disableDisplayFilter",read:{reader:t=>!t},write:{layerContainerTypes:Es,writer(t,e,i){ra(i,!t,e)}},origins:{"web-scene":{write:!1,read:!1}}}},t2t={type:d2,json:{name:"layerDefinition.displayFilterInfo",write:{enabled:!0,allowNull:!0,layerContainerTypes:Es},origins:{"web-scene":{write:!1,read:!1}}}},jse=tpt(),GNe=new Map,HNe=new Map;async function _pi(t,e,i){if(!t||!i)return!1;if(!e)return!0;const r=new URL(t).host;let s=GNe.get(r);if(!s){const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await Si(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===e}async function u2e(t,e,i=!1){if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=HNe.get(r)?.entries();if(s){for(const[n,a]of s)if(a.name===e){const o=!a.stack?.hasForwardEdits();if(!o&&i){const[{deleteForwardEdits:l},{default:u}]=await Promise.all([W(()=>import("./deleteForwardEdits-Dfxgslow.js"),[]),W(()=>import("./DeleteForwardEditsParameters-D1kW1cpo.js"),[])]),d=await l(r,n,new u({sessionId:jse,moment:a.moment}));return d.success&&a.stack?.clearForwardEdits(),d.success}return o}}return!0}function YU(t,e){if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=HNe.get(i)?.entries();if(r){for(const[s,n]of r)if(n.name===e)return n.lockType==="edit"}return!1}const yhe=new gm;function WNe(t){return yhe.on("apply-edits",new WeakRef(t))}function ZNe(t){return yhe.on("update-moment",new WeakRef(t))}function h2e(t,e,i=null,r=!1){const s=Eo();return r=e==null||r,yhe.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:s.promise}),s}const YNe=Symbol();function bpi(t){return t!=null&&typeof t=="object"&&YNe in t}function uI(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function z4(t,e,i){const r=new URL(t).host,s=GNe.get(r),n=a=>!a||a===s;return n(e)&&n(i)||e===i}const i2t=t=>{var s;var e;const i=t;let r=(s=class extends i{constructor(...n){super(...n),this[e]=!0,this._applyEditsHandler=a=>{const{serviceUrl:o,layerId:l,gdbVersion:u,mayReceiveServiceEdits:d,result:f}=a,g=o===this.url,v=l!=null&&this.layerId!=null&&l===this.layerId,_=uI(this),x=uI(this)&&z4(o,u,this.gdbVersion);if(!g||_&&!x||!v&&!d)return;const S=f.then(T=>{if(this.lastEditsEventDate=new Date,v&&(T.addedFeatures.length||T.updatedFeatures.length||T.deletedFeatures.length||T.addedAttachments.length||T.updatedAttachments.length||T.deletedAttachments.length))return this.emit("edits",se(T)),T;const M=T.editedFeatures?.find(({layerId:P})=>P===this.layerId);if(M){const{adds:P,updates:O,deletes:D}=M.editedFeatures,L={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:P?P.map(({attributes:F})=>({objectId:this.objectIdField&&F[this.objectIdField],globalId:this.globalIdField&&F[this.globalIdField]})):[],deletedFeatures:D?D.map(({attributes:F})=>({objectId:this.objectIdField&&F[this.objectIdField],globalId:this.globalIdField&&F[this.globalIdField]})):[],updatedFeatures:O?O.map(({current:{attributes:F}})=>({objectId:this.objectIdField&&F[this.objectIdField],globalId:this.globalIdField&&F[this.globalIdField]})):[],editedFeatures:se(T.editedFeatures),exceededTransferLimit:!1,historicMoment:se(T.historicMoment)};return this.emit("edits",L),L}const E={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:se(T.editedFeatures),exceededTransferLimit:!1,historicMoment:se(T.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(o,u,E.historicMoment)&&this.emit("edits",E),E}).then(T=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(o,u,T.historicMoment)&&(this.historicMoment=T.historicMoment),T));this.emit("apply-edits",{result:S})},this._updateMomentHandler=a=>{const{serviceUrl:o,gdbVersion:l,moment:u}=a,d=o===this.url,f=uI(this),g=uI(this)&&z4(o,l,this.gdbVersion),v=uI(this)&&!z4(o,this.gdbVersion,null);d&&f&&g&&v&&"historicMoment"in this&&this.historicMoment!==u&&(this.historicMoment=u)},this.when().then(()=>{this.addHandles(WNe(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(ZNe(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(n,a,o){return"historicMoment"in this&&this.historicMoment!==o&&YU(n,a)}},e=YNe,s);return c([p()],r.prototype,"lastEditsEventDate",void 0),r=c([R("esri.layers.mixins.EditBusLayer")],r),r};var Use;const dQ=new ii({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),pQ=new ii({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let tg=Use=class extends ae{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:a,distance:o}=this;return new Ct({geometry:se(i),objectIds:se(n),spatialRelationship:r,timeExtent:se(s),where:e,units:a,distance:o,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:a}=this;return new Use({geometry:se(e),objectIds:se(s),spatialRelationship:i,timeExtent:se(r),where:t,units:n,distance:a})}};c([p({type:String,json:{write:!0}})],tg.prototype,"where",void 0),c([p({types:gP,json:{write:!0}})],tg.prototype,"geometry",void 0),c([p({type:dQ.apiValues,json:{name:"spatialRel",read:{reader:dQ.read},write:{allowNull:!1,writer:dQ.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],tg.prototype,"spatialRelationship",void 0),c([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],tg.prototype,"distance",void 0),c([p({type:[Number],json:{write:!0}})],tg.prototype,"objectIds",void 0),c([p({type:pQ.apiValues,json:{read:pQ.read,write:{writer:pQ.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],tg.prototype,"units",void 0),c([p({type:ts,json:{write:!0}})],tg.prototype,"timeExtent",void 0),tg=Use=c([R("esri.layers.support.FeatureFilter")],tg);const r2t=tg;var Bse;const d2e={read:{reader:W5},write:{writer:Z5,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},p2e={read:{reader:W5},write:{writer:Z5,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},f2e={name:"showExcludedLabels",default:!0};let p2=Bse=class extends ae{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const i=super.write(t,e);if(e?.origin){if(i.filter){const r=Object.keys(i.filter);if(r.length>1||r[0]!=="where")return e.messages?.push(new q("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return e.messages?.push(new q("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new Bse({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};c([p({type:r2t,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t?.write({},r);s&&Object.keys(s).length!==0?ra(i,s,e):ra(i,null,e)}}}})],p2.prototype,"filter",void 0),c([p({json:{read:W5,write:{writer:Z5,allowNull:!0},origins:{"web-map":d2e,"portal-item":d2e}}})],p2.prototype,"includedEffect",void 0),c([p({json:{read:W5,write:{writer:Z5,allowNull:!0},origins:{"web-map":p2e,"portal-item":p2e}}})],p2.prototype,"excludedEffect",void 0),c([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":f2e,"portal-item":f2e}}})],p2.prototype,"excludedLabelsVisible",void 0),p2=Bse=c([R("esri.layers.support.FeatureEffect")],p2);const m2e={write:{allowNull:!0}},s2t={type:p2,json:{origins:{"web-map":m2e,"portal-item":m2e}}},n2t=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return c([p(s2t)],i.prototype,"featureEffect",void 0),i=c([R("esri.layers.mixins.FeatureEffectLayer")],i),i};var qse;let ZD=qse=class extends ae{constructor(t){super(t),this.expression=void 0,this.title=void 0}async collectRequiredFields(t,e){return ic(t,e,null,this.expression)}clone(){return new qse({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};c([p({type:String,json:{write:{isRequired:!0}}})],ZD.prototype,"expression",void 0),c([p({type:String,json:{write:!0}})],ZD.prototype,"title",void 0),ZD=qse=c([R("esri.symbols.support.FeatureExpressionInfo")],ZD);const g2e=ZD,VO={unknown:1,inches:yi(1,"meters","inches"),feet:yi(1,"meters","feet"),"us-feet":yi(1,"meters","us-feet"),yards:yi(1,"meters","yards"),miles:yi(1,"meters","miles"),"nautical-miles":yi(1,"meters","nautical-miles"),millimeters:yi(1,"meters","millimeters"),centimeters:yi(1,"meters","centimeters"),decimeters:yi(1,"meters","decimeters"),meters:yi(1,"meters","meters"),kilometers:yi(1,"meters","kilometers"),"decimal-degrees":1/ent(1,"meters",Ci.radius)};function a2t(t){return!!t&&VO[t]!=null}function vhe(t){return 1/(VO[t]||1)}function o2t(){const t=Object.keys(VO);return oP(t,"decimal-degrees"),t.sort(),t}const l2t=o2t(),uV=so()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),y2e=new ii({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let pg=class extends nt(ae){constructor(e){super(e),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(e,i){return e!=null?e.expression?e:void 0:i.featureExpression&&i.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,i,r,s){i[r]=e.write({},s),e.expression==="0"&&(i.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:i}=this;return this._isOverridden("mode")?this._get("mode"):e!=null||i?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,i){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,i):null}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&Ree(this.featureExpressionInfo,e.featureExpressionInfo)}};c([p({type:g2e,json:{write:!0}})],pg.prototype,"featureExpressionInfo",void 0),c([Oe("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],pg.prototype,"readFeatureExpressionInfo",null),c([Ie("featureExpressionInfo",{featureExpressionInfo:{type:g2e},"featureExpression.value":{type:[0]}})],pg.prototype,"writeFeatureExpressionInfo",null),c([p({type:uV.apiValues,nonNullable:!0,json:{type:uV.jsonValues,read:uV.read,write:{writer:uV.write,isRequired:!0}}})],pg.prototype,"mode",null),c([p({type:Number,json:{write:!0}})],pg.prototype,"offset",void 0),c([p({type:l2t,json:{type:String,read:y2e.read,write:y2e.write}})],pg.prototype,"unit",null),pg=c([R("esri.symbols.support.ElevationInfo")],pg);let f3=class extends ae{constructor(e){super(e),this.description=null,this.label=null,this.type=null}};c([p({type:String,json:{write:!0}})],f3.prototype,"description",void 0),c([p({type:String,json:{write:!0}})],f3.prototype,"label",void 0),c([p()],f3.prototype,"type",void 0),f3=c([R("esri.tables.elements.AttributeTableElement")],f3);const TP=f3;let YD=class extends nt(TP){constructor(e){super(e),this.displayType="auto",this.type="attachment"}clone(){return super.clone()}};c([p({type:["auto"],json:{write:!0}})],YD.prototype,"displayType",void 0),c([p({type:["attachment"],readOnly:!0,json:{read:!1,write:{enabled:!0,isRequired:!0}}})],YD.prototype,"type",void 0),YD=c([R("esri.tables.elements.AttributeTableAttachmentElement")],YD);const JNe=YD;let f2=class extends nt(TP){constructor(e){super(e),this.description=null,this.fieldName=null,this.label=null,this.type="field"}clone(){return super.clone()}};c([p({type:String,json:{read:!1,write:!1}})],f2.prototype,"description",void 0),c([p({type:String,json:{write:{enabled:!0,isRequired:!0}}})],f2.prototype,"fieldName",void 0),c([p({type:String,json:{read:!1,write:!1}})],f2.prototype,"label",void 0),c([p({type:["field"],readOnly:!0,json:{read:!1,write:{enabled:!0,isRequired:!0}}})],f2.prototype,"type",void 0),f2=c([R("esri.tables.elements.AttributeTableFieldElement")],f2);const QNe=f2;let JD=class extends nt(TP){constructor(e){super(e),this.relationshipId=null,this.type="relationship"}clone(){return super.clone()}};c([p({type:Number,json:{type:vi,write:{enabled:!0,isRequired:!0}}})],JD.prototype,"relationshipId",void 0),c([p({type:["relationship"],readOnly:!0,json:{read:!1,write:{enabled:!0,isRequired:!0}}})],JD.prototype,"type",void 0),JD=c([R("esri.tables.elements.AttributeTableRelationshipElement")],JD);const XNe=JD,KNe={base:TP,key:"type",typeMap:{attachment:JNe,field:QNe,relationship:XNe}};function c2t(t){return{typesWithGroup:{base:TP,key:"type",typeMap:{attachment:JNe,field:QNe,group:t,relationship:XNe}},typesWithoutGroup:KNe}}let QD=class extends nt(TP){constructor(e){super(e),this.elements=null,this.type="group"}clone(){return super.clone()}};c([p({types:[KNe],json:{name:"attributeTableElements",write:!0}})],QD.prototype,"elements",void 0),c([p({type:["group"],readOnly:!0,json:{read:!1,write:{enabled:!0,isRequired:!0}}})],QD.prototype,"type",void 0),QD=c([R("esri.tables.elements.AttributeTableGroupElement")],QD);const u2t=QD;let XD=class extends nt(ae){constructor(e){super(e),this.field=null,this.order=null}};c([p({type:String,json:{write:!0}})],XD.prototype,"field",void 0),c([p({type:["asc","desc"],json:{write:!0}})],XD.prototype,"order",void 0),XD=c([R("esri.tables.support.FieldOrder")],XD);const h2t=XD;var Gse;const d2t=c2t(u2t);let KD=Gse=class extends ae{constructor(t){super(t),this.elements=null,this.orderByFields=null}clone(){return new Gse({elements:se(this.elements),orderByFields:se(this.orderByFields)})}};c([p({types:[d2t.typesWithGroup],json:{name:"attributeTableElements",write:!0}})],KD.prototype,"elements",void 0),c([p({type:[h2t],json:{write:!0}})],KD.prototype,"orderByFields",void 0),KD=Gse=c([R("esri.tables.AttributeTableTemplate")],KD);const p2t=KD,f2t={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:Es}}},Z7={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},Y7={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:Es}}},m2t={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:WT}}},g2t={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:Es}}},y2t={value:null,type:pg,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:Es}}};function Epi(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const eVe={write:{enabled:!0,layerContainerTypes:Es},read:!0},Hse={type:Number,json:{origins:{"web-document":eVe,"portal-item":{write:{layerContainerTypes:Es}}}}},v2t={...Hse,json:{...Hse.json,origins:{"web-document":{...eVe,write:{enabled:!0,layerContainerTypes:Es,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition?.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?AO(e.layerDefinition.drawingInfo.transparency):void 0:AO(e.drawingInfo.transparency)}}},Api={type:It,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=It.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=Me.fromJSON(e.spatialReference)),i}}}},read:!1}},_2t={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},b2t={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.minScale",write:{layerContainerTypes:Es}}},w2t={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.maxScale",write:{layerContainerTypes:Es}}},tVe={json:{write:{ignoreOrigin:!0,layerContainerTypes:Es},origins:{"web-map":{read:!1,write:!1}}}},x2t={type:p2t,json:{name:"attributeTableInfo",write:!0}};let uv=class extends nt(ae){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};c([p()],uv.prototype,"creatorField",void 0),c([p()],uv.prototype,"creationDateField",void 0),c([p()],uv.prototype,"editorField",void 0),c([p()],uv.prototype,"editDateField",void 0),c([p()],uv.prototype,"realm",void 0),c([p(Mq("dateFieldsTimeReference",!0))],uv.prototype,"timeZone",void 0),uv=c([R("esri.layers.support.EditFieldsInfo")],uv);let fg=class extends nt(ae){constructor(e){super(e)}};c([p({constructOnly:!0,json:{write:!0}})],fg.prototype,"name",void 0),c([p({constructOnly:!0,json:{write:!0}})],fg.prototype,"fields",void 0),c([p({constructOnly:!0,json:{write:!0}})],fg.prototype,"isAscending",void 0),c([p({constructOnly:!0,json:{write:!0}})],fg.prototype,"indexType",void 0),c([p({constructOnly:!0,json:{write:!0}})],fg.prototype,"isUnique",void 0),c([p({constructOnly:!0,json:{write:!0}})],fg.prototype,"description",void 0),fg=c([R("esri.layers.support.FeatureIndex")],fg);async function iVe(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=rVe(t));const r=S2t(t),s=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let n=null;for(;;){const a=await t.source.queryFeaturesJSON(e,i);if(n==null?n=a:n.features=n.features.concat(a.features),n.exceededTransferLimit=a.exceededTransferLimit,!s||!a.exceededTransferLimit)break;e.start+=r}return n}function S2t(t){return rVe(t)*T2t(t)}function T2t(t){return t.capabilities.query.maxRecordCount||2e3}function rVe(t){return t.capabilities.query.supportsMaxRecordCountFactor?Ct.MAX_MAX_RECORD_COUNT_FACTOR:1}var Wse;let ek=Wse=class extends ae{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new Wse({minValue:this.minValue,maxValue:this.maxValue})}};c([p({type:Number,json:{write:!0}})],ek.prototype,"minValue",void 0),c([p({type:Number,json:{write:!0}})],ek.prototype,"maxValue",void 0),ek=Wse=c([R("esri.renderers.support.AuthoringInfoClassBreakInfo")],ek);var Zse;let Wb=Zse=class extends ae{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new Zse({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:se(this.classBreakInfos)})}};c([p({type:String,json:{write:!0}})],Wb.prototype,"field",void 0),c([p({type:String,json:{write:!0}})],Wb.prototype,"normalizationField",void 0),c([p({type:String,json:{write:!0}})],Wb.prototype,"label",void 0),c([p({type:[ek],json:{write:!0}})],Wb.prototype,"classBreakInfos",void 0),Wb=Zse=c([R("esri.renderers.support.AuthoringInfoFieldInfo")],Wb);var Yse;let m3=Yse=class extends ae{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new Yse({label:this.label,value:this.value,size:this.size})}};c([p({type:String,json:{write:!0}})],m3.prototype,"label",void 0),c([p({type:Number,json:{write:!0}})],m3.prototype,"size",void 0),c([p({type:Number,json:{write:!0}})],m3.prototype,"value",void 0),m3=Yse=c([R("esri.renderers.support.AuthoringInfoSizeStop")],m3);const $2t=m3;var Jse;const hV=new ii({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),dV=new ii({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),v2e={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},_2e=["high-to-low","above-and-below","centered-on","extremes"],b2e=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size","spike"])],w2e=["seconds","minutes","hours","days","months","years"],C2t=["circle","diamond","hexagon-flat","hexagon-pointy","square"],M2t=["triangle-closed-outline","triangle-gradient-fill-closed","triangle-gradient-fill-closed-outline","triangle-gradient-fill-open","triangle-gradient-fill-open-outline","triangle-open-outline","triangle-solid-fill-closed","triangle-solid-fill-closed-outline","triangle-solid-fill-open","triangle-solid-fill-open-outline"];let po=Jse=class extends ae{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}get normalizationField(){return this.theme==="reference-size"||this.theme==="spike"?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}get spikeSymbolStyle(){return this.theme==="spike"?this._get("spikeSymbolStyle"):null}set spikeSymbolStyle(t){this._set("spikeSymbolStyle",t)}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get sizeStops(){return this.theme==="reference-size"||this.theme==="spike"?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new Jse({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,spikeSymbolStyle:this.spikeSymbolStyle,sizeStops:se(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};c([p({types:v2e,json:{write:!0}})],po.prototype,"endTime",void 0),c([wi("endTime")],po.prototype,"castEndTime",null),c([p({type:String,json:{write:!0}})],po.prototype,"field",void 0),c([p({type:Number,json:{write:!0}})],po.prototype,"maxSliderValue",void 0),c([p({type:Number,json:{write:!0}})],po.prototype,"minSliderValue",void 0),c([p({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],po.prototype,"normalizationField",null),c([p({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],po.prototype,"referenceSizeScale",null),c([p({type:C2t,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],po.prototype,"referenceSizeSymbolStyle",null),c([p({type:M2t,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],po.prototype,"spikeSymbolStyle",null),c([p({types:v2e,json:{write:!0}})],po.prototype,"startTime",void 0),c([wi("startTime")],po.prototype,"castStartTime",null),c([p({type:[$2t],json:{origins:{"web-scene":{write:!1}},write:!0}})],po.prototype,"sizeStops",null),c([p({type:hV.apiValues,value:null,json:{type:hV.jsonValues,read:hV.read,write:hV.write}})],po.prototype,"style",null),c([p({type:b2e,value:null,json:{type:b2e,origins:{"web-scene":{type:_2e,write:{writer:(t,e)=>{_2e.includes(t)&&(e.theme=t)}}}},write:!0}})],po.prototype,"theme",null),c([p({type:dV.apiValues,json:{type:dV.jsonValues,read:dV.read,write:dV.write}})],po.prototype,"type",void 0),c([p({type:w2e,json:{type:w2e,write:!0}})],po.prototype,"units",void 0),po=Jse=c([R("esri.renderers.support.AuthoringInfoVisualVariable")],po);const E2t=po;let KE=class extends ae{constructor(e){super(e),this.type=null}};c([p({readOnly:!0,json:{read:!1,write:!0}})],KE.prototype,"type",void 0),KE=c([R("esri.rest.support.ColorRamp")],KE);var Qse;let Qv=Qse=class extends KE{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new Qse({fromColor:se(this.fromColor),toColor:se(this.toColor),algorithm:this.algorithm})}};c([st({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Qv.prototype,"algorithm",void 0),c([p({type:Je,json:{type:[vi],write:{isRequired:!0}}})],Qv.prototype,"fromColor",void 0),c([p({type:Je,json:{type:[vi],write:{isRequired:!0}}})],Qv.prototype,"toColor",void 0),c([p({type:["algorithmic"],json:{write:{isRequired:!0}}})],Qv.prototype,"type",void 0),Qv=Qse=c([R("esri.rest.support.AlgorithmicColorRamp")],Qv);var Xse;let Nv=Xse=class extends KE{constructor(t){super(t),this.colorRamps=null,this.type="multipart",this.weights=void 0}writeColorRamps(t,e,i,r){const s=t?.map(a=>a.toJSON(r)),{weights:n}=this;if(s&&n?.length&&s.length===n?.length){const a=100/n.reduce((l,u)=>l+u);let o=0;s.forEach((l,u)=>{l.start=o,o+=n[u]*a,l.stop=o})}e.colorRamps=s}readWeights(t,e){const i=e.colorRamps?.map(({start:r,stop:s})=>r==null||s==null?-1:s-r);if(!i?.some(r=>r<0))return i}clone(){return new Xse({colorRamps:se(this.colorRamps)})}};c([p({type:[Qv],json:{write:{isRequired:!0}}})],Nv.prototype,"colorRamps",void 0),c([Ie("colorRamps")],Nv.prototype,"writeColorRamps",null),c([p({type:["multipart"],json:{write:{isRequired:!0}}})],Nv.prototype,"type",void 0),c([p({type:[Number]})],Nv.prototype,"weights",void 0),c([Oe("weights",["colorRamps"])],Nv.prototype,"readWeights",null),Nv=Xse=c([R("esri.rest.support.MultipartColorRamp")],Nv);const A2t={key:"type",base:KE,typeMap:{algorithmic:Qv,multipart:Nv}};function O2t(t){return t?.type?t.type==="algorithmic"?Qv.fromJSON(t):t.type==="multipart"?Nv.fromJSON(t):null:null}var Kse;const yx=new ii({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),pV=new ii({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),x2e=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"],P2t=["high-to-low","above-and-below","above","below"],R2t=["flow-line","wave-front"],I2t=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let un=Kse=class extends ae{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?O2t(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new Kse({classificationMethod:this.classificationMethod,colorRamp:se(this.colorRamp),fadeRatio:se(this.fadeRatio),fields:this.fields?.slice(),field1:se(this.field1),field2:se(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};c([p({type:yx.apiValues,value:null,json:{type:yx.jsonValues,read:yx.read,write:yx.write,origins:{"web-document":{default:"manual",type:yx.jsonValues,read:yx.read,write:yx.write}}}})],un.prototype,"classificationMethod",null),c([p({types:A2t,json:{write:!0}})],un.prototype,"colorRamp",void 0),c([Oe("colorRamp")],un.prototype,"readColorRamp",null),c([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"fadeRatio",void 0),c([p({type:[String],value:null,json:{write:!0}})],un.prototype,"fields",null),c([p({type:Wb,value:null,json:{write:!0}})],un.prototype,"field1",null),c([p({type:Wb,value:null,json:{write:!0}})],un.prototype,"field2",null),c([p({type:R2t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"flowTheme",null),c([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],un.prototype,"focus",null),c([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],un.prototype,"isAutoGenerated",void 0),c([p({type:Number,value:null,json:{type:vi,write:!0}})],un.prototype,"numClasses",null),c([p({type:x2e,json:{type:x2e,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],un.prototype,"lengthUnit",void 0),c([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"maxSliderValue",void 0),c([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"minSliderValue",void 0),c([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"statistics",null),c([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],un.prototype,"standardDeviationInterval",null),c([p({type:pV.apiValues,value:null,json:{type:pV.jsonValues,read:pV.read,write:pV.write}})],un.prototype,"type",null),c([p({type:[E2t],json:{write:!0}})],un.prototype,"visualVariables",void 0),c([p({type:I2t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"univariateSymbolStyle",null),c([p({type:P2t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"univariateTheme",null),un=Kse=c([R("esri.renderers.support.AuthoringInfo")],un);const fQ=new ii({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let qh=class extends ae{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}get symbols(){return[]}get arcadeRequired(){return!1}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};c([p({type:un,json:{write:!0}})],qh.prototype,"authoringInfo",void 0),c([p({type:fQ.apiValues,readOnly:!0,json:{type:fQ.jsonValues,read:!1,write:{writer:fQ.write,ignoreOrigin:!0,isRequired:!0}}})],qh.prototype,"type",void 0),qh=c([R("esri.renderers.Renderer")],qh);let tk=class extends nt(ae){constructor(){super(...arguments),this.showLegend=null,this.title=null}};c([p({type:Boolean,json:{write:!0}})],tk.prototype,"showLegend",void 0),c([p({type:String,json:{write:!0}})],tk.prototype,"title",void 0),tk=c([R("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],tk);const sVe=tk,mQ=new ii({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let zl=class extends ae{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(re.getLogger(this).error(".field: field must be a string value"),null):ZL(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};c([p()],zl.prototype,"index",void 0),c([p({type:mQ.apiValues,readOnly:!0,json:{read:mQ.read,write:{writer:mQ.write,isRequired:!0}}})],zl.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],zl.prototype,"field",void 0),c([wi("field")],zl.prototype,"castField",null),c([p({type:String,json:{write:!0}})],zl.prototype,"valueExpression",void 0),c([p({type:String,json:{write:!0}})],zl.prototype,"valueExpressionTitle",void 0),c([p({readOnly:!0})],zl.prototype,"arcadeRequired",null),c([p({type:sVe,json:{write:!0}})],zl.prototype,"legendOptions",void 0),zl=c([R("esri.renderers.visualVariables.VisualVariable")],zl);var ene;let m2=ene=class extends ae{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new ene({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};c([p({type:Je,json:{type:[vi],write:{isRequired:!0}}})],m2.prototype,"color",void 0),c([p({type:String,json:{write:!0}})],m2.prototype,"label",void 0),c([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],m2.prototype,"value",void 0),c([Ie("value")],m2.prototype,"writeValue",null),m2=ene=c([R("esri.renderers.visualVariables.support.ColorStop")],m2);const D2t=m2;var tne;let Zb=tne=class extends zl{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new tne({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};c([p({readOnly:!0})],Zb.prototype,"cache",null),c([p({type:["color"],json:{type:["colorInfo"]}})],Zb.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],Zb.prototype,"normalizationField",void 0),c([p({type:[D2t],json:{write:!0}})],Zb.prototype,"stops",null),Zb=tne=c([R("esri.renderers.visualVariables.ColorVariable")],Zb);var ine;let $b=ine=class extends ae{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return AO(e.transparency)}writeOpacity(t,e,i){e[i]=vF(t)}clone(){return new ine({label:this.label,opacity:this.opacity,value:this.value})}};c([p({type:String,json:{write:!0}})],$b.prototype,"label",void 0),c([p({type:Number,json:{type:vi,write:{target:"transparency",isRequired:!0}}})],$b.prototype,"opacity",void 0),c([Oe("opacity",["transparency"])],$b.prototype,"readOpacity",null),c([Ie("opacity")],$b.prototype,"writeOpacity",null),c([p({type:Number,json:{write:{isRequired:!0}}})],$b.prototype,"value",void 0),$b=ine=c([R("esri.renderers.visualVariables.support.OpacityStop")],$b);const k2t=$b;var rne;let Xv=rne=class extends zl{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new rne({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};c([p({readOnly:!0})],Xv.prototype,"cache",null),c([p({type:["opacity"],json:{type:["transparencyInfo"]}})],Xv.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],Xv.prototype,"normalizationField",void 0),c([p({type:[k2t],json:{write:!0}})],Xv.prototype,"stops",null),Xv=rne=c([R("esri.renderers.visualVariables.OpacityVariable")],Xv);var sne;let Yb=sne=class extends zl{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new sne({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};c([p({readOnly:!0})],Yb.prototype,"cache",null),c([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Yb.prototype,"axis",void 0),c([p({type:["rotation"],json:{type:["rotationInfo"]}})],Yb.prototype,"type",void 0),c([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Yb.prototype,"rotationType",void 0),Yb=sne=c([R("esri.renderers.visualVariables.RotationVariable")],Yb);function L2t(t){return mr(t)}var nne;let Ef=nne=class extends ae{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new nne({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};c([p({type:String,json:{write:!0}})],Ef.prototype,"label",void 0),c([p({type:Number,cast:mr,json:{write:{isRequired:!0}}})],Ef.prototype,"size",void 0),c([p({type:Number,json:{write:{isRequired:!0}}})],Ef.prototype,"value",void 0),c([p({type:Boolean,json:{write:!1}})],Ef.prototype,"useMinValue",void 0),c([p({type:Boolean,json:{write:!1}})],Ef.prototype,"useMaxValue",void 0),Ef=nne=c([R("esri.renderers.visualVariables.support.SizeStop")],Ef);let JU=class extends sVe{constructor(){super(...arguments),this.customValues=null}};c([p({type:[Number],json:{write:!0}})],JU.prototype,"customValues",void 0),JU=c([R("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],JU);const F2t=JU;function dE(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function s$(t){return t!=null&&!isNaN(t)&&isFinite(t)}function nVe(t){return t.valueExpression?"expression":t.field&&typeof t.field=="string"?"field":"unknown"}function z2t(t,e){const i=e||nVe(t),r=t.valueUnit||"unknown";return i==="unknown"?"constant":t.stops?"stops":t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?"clamped-linear":r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?"proportional":"additive":"identity":"real-world-size"}const aVe=()=>re.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),J7=t=>aVe().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),Q7=()=>aVe().error("Use of arcade expressions requires an arcade context"),S2e=new ms,QU=Math.PI,oVe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function lVe(t,e,i){const r="visualVariables"in t?t.visualVariables?.find(_=>_.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void J7("ColorVariable");const s=typeof e=="number",n=s?null:e,a=n?.attributes;let o=s?e:null;const l=r.field,{ipData:u,hasExpression:d}=r.cache;let f=r.cache.compiledFunc;if(!l&&!d){const _=r.stops;return _&&_[0]&&_[0].color}if(typeof o!="number")if(d){if(i?.arcade==null)return void Q7();const _={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},x=i.arcade.arcadeUtils,S=x.getViewInfo(_),T=x.createExecContext(n,S,i.timeZone);if(!f){const M=x.createSyntaxTree(r.valueExpression);f=x.createFunction(M),r.cache.compiledFunc=f}o=x.executeFunction(f,T)}else a&&(o=a[l]);const g=r.normalizationField,v=a!=null&&g!=null?parseFloat(a[g]):void 0;if(o!=null&&(!g||s||!isNaN(v)&&v!==0)){s$(v)&&!s&&(o/=v);const _=_he(o,u);if(_){const x=_[0],S=_[1],T=x===S?r.stops[x].color:Je.blendColors(r.stops[x].color,r.stops[S].color,_[2],i?.color);return new Je(T)}}}function cVe(t,e,i){const r="visualVariables"in t?t.visualVariables?.find(_=>_.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void J7("OpacityVariable");const s=typeof e=="number",n=s?null:e,a=n?.attributes;let o=s?e:null;const l=r.field,{ipData:u,hasExpression:d}=r.cache;let f=r.cache.compiledFunc;if(!l&&!d){const _=r.stops;return _&&_[0]&&_[0].opacity}if(typeof o!="number")if(d){if(i?.arcade==null)return void Q7();const _={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},x=i.arcade.arcadeUtils,S=x.getViewInfo(_),T=x.createExecContext(n,S,i.timeZone);if(!f){const M=x.createSyntaxTree(r.valueExpression);f=x.createFunction(M),r.cache.compiledFunc=f}o=x.executeFunction(f,T)}else a&&(o=a[l]);const g=r.normalizationField,v=a!=null&&g!=null?parseFloat(a[g]):void 0;if(o!=null&&(!g||s||!isNaN(v)&&v!==0)){s$(v)&&!s&&(o/=v);const _=_he(o,u);if(_){const x=_[0],S=_[1];if(x===S)return r.stops[x].opacity;{const T=r.stops[x].opacity;return T+(r.stops[S].opacity-T)*_[2]}}}}function uVe(t,e,i){const r="visualVariables"in t?t.visualVariables?.find(v=>v.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void J7("RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,a=s==="heading"&&r.rotationType==="arithmetic"?-1:1,o=typeof e=="number"?null:e,l=o?.attributes,u=r.field,{hasExpression:d}=r.cache;let f=r.cache.compiledFunc,g=null;if(!u&&!d)return g;if(d){if(i?.arcade==null)return void Q7();const v={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,x=_.getViewInfo(v),S=_.createExecContext(o,x,i.timeZone);if(!f){const T=_.createSyntaxTree(r.valueExpression);f=_.createFunction(T),r.cache.compiledFunc=f}g=_.executeFunction(f,S)}else l&&(g=l[u]);return g=typeof g!="number"||isNaN(g)?null:n+a*g,g}function N2t(t,e,i){const r=typeof e=="number",s=r?null:e,n=s?.attributes;let a=r?e:null;const{isScaleDriven:o}=t.cache;let l=t.cache.compiledFunc;if(o){const d=i?.scale,f=i?.view;a=d==null||f==="3d"?V2t(t):d}else if(!r)switch(t.inputValueType){case"expression":{if(i?.arcade==null)return void Q7();const d={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},f=i.arcade.arcadeUtils,g=f.getViewInfo(d),v=f.createExecContext(s,g,i.timeZone);if(!l){const _=f.createSyntaxTree(t.valueExpression);l=f.createFunction(_),t.cache.compiledFunc=l}a=f.executeFunction(l,v);break}case"field":n&&(a=n[t.field]);break;case"unknown":a=null}if(!s$(a))return null;if(r||!t.normalizationField)return a;const u=n?parseFloat(n[t.normalizationField]):null;return s$(u)&&u!==0?a/u:null}function V2t(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function X7(t,e,i){const r="visualVariables"in t?t.visualVariables?.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void J7("SizeVariable");const s=dVe(N2t(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?void 0:s}function Uu(t,e,i){return t==null?null:dE(t)?X7(t,e,i):s$(t)?t:null}function hVe(t,e,i){return s$(i)&&t>i?i:s$(e)&&t<e?e:t}function j2t(t,e,i,r){const s=Uu(e.minSize,i,r)||e.minDataValue;return t==null&&s==null?null:(t??0)+(s??0)}function U2t(t,e,i){const r=t.stops;let s=r?.length&&r[0].size;return s==null&&(s=t.minSize),Uu(s,e,i)}function B2t(t,e,i,r){const s=Uu(e.minSize,i,r);if(t==null)return s;const{minDataValue:n,maxDataValue:a}=e;if(n==null||a==null)return null;const o=(t-n)/(a-n),l=Uu(e.maxSize,i,r),u=r?.shape;if(t<=n)return s;if(t>=a)return l;if(s==null||l==null)return null;if(e.scaleBy==="area"&&u){const d=u==="circle",f=d?QU*(s/2)**2:s*s,g=f+o*((d?QU*(l/2)**2:l*l)-f);return d?2*Math.sqrt(g/QU):Math.sqrt(g)}return s+o*(l-s)}function q2t(t,e,i,r){const s=Uu(e.minSize,i,r);if(t==null||s==null)return s;const n=r?.shape,{minDataValue:a}=e;if(a==null)return null;const o=t/a,l=Uu(e.maxSize,i,r);let u=null;return u=n==="circle"?2*Math.sqrt(o*(s/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(o*s**2):o*s,hVe(u,s,l)}function G2t(t,e,i,r,s){if(t==null)return null;const[n,a,o]=_he(t,s);if(n===a)return Uu(e.stops?.[n].size,i,r);{const l=Uu(e.stops?.[n].size,i,r),u=Uu(e.stops?.[a].size,i,r);return l==null||u==null?null:l+(u-l)*o}}function H2t(t,e,i,r){const s=(r?.resolution??1)*VO[e.valueUnit],n=Uu(e.minSize,i,r),a=Uu(e.maxSize,i,r),{valueRepresentation:o}=e;if(t==null)return n;let l=null;return l=o==="area"?2*Math.sqrt(t/QU)/s:o==="radius"||o==="distance"?2*t/s:t/s,hVe(l,n,a)}function dVe(t,e,i,r,s){switch(e.transformationType){case"additive":return j2t(t,e,i,r);case"constant":return U2t(e,i,r);case"clamped-linear":return B2t(t,e,i,r);case"proportional":return q2t(t,e,i,r);case"stops":return G2t(t,e,i,r,s);case"real-world-size":return H2t(t,e,i,r);case"identity":return t;case"unknown":return null}}function W2t(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=Uu(t.minSize,S2e,s),a=Uu(t.maxSize,S2e,s);if(n!=null||a!=null){if(n>a){const o=a;a=n,n=o}return{minSize:n,maxSize:a}}}function Z2t(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],a=[],o=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":o.push(l);break;case"size":a.push(l)}return s.forEach(l=>{const u=lVe(l,e,i);r.push({variable:l,value:u})}),n.forEach(l=>{const u=cVe(l,e,i);r.push({variable:l,value:u})}),o.forEach(l=>{const u=uVe(l,e,i);r.push({variable:l,value:u})}),a.forEach(l=>{const u=X7(l,e,i);r.push({variable:l,value:u})}),r}function _he(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function Y2t(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":X7(s,e,i)??"proportional";switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const Fpi=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Y2t,getColor:lVe,getOpacity:cVe,getRotationAngle:uVe,getSize:X7,getSizeForValue:dVe,getSizeFromNumberOrVariable:Uu,getSizeRangeAtScale:W2t,getVisualVariableValues:Z2t,viewScaleRE:oVe},Symbol.toStringTag,{value:"Module"}));var ane;const fV=new ii({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),one=new ii({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function T2e(t){if(t!=null)return typeof t=="string"||typeof t=="number"?L2t(t):t.type==="size"?dE(t)?t:(delete(t={...t}).type,new Er(t)):void 0}function $2e(t,e,i){if(typeof t!="object")return t;const r=new Er;return r.read(t,i),r}let Er=ane=class extends zl{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&oVe.test(this.valueExpression)}}set index(t){dE(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),dE(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return nVe(this)}set maxDataValue(t){t&&this.stops&&(re.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(re.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return T2e(t)}readMaxSize(t,e,i){return $2e(t,e,i)}set minDataValue(t){t&&this.stops&&(re.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(re.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return T2e(t)}readMinSize(t,e,i){return $2e(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(re.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return z2t(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r?.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new q("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?one.read(t):null}clone(){return new ane({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:dE(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:dE(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType==="clamped-linear"){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType==="stops"){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map(t=>t.value||0)}};c([p({readOnly:!0})],Er.prototype,"cache",null),c([p({type:fV.apiValues,json:{type:fV.jsonValues,origins:{"web-map":{read:!1}},read:fV.read,write:fV.write}})],Er.prototype,"axis",void 0),c([p()],Er.prototype,"index",null),c([p({type:String,readOnly:!0})],Er.prototype,"inputValueType",null),c([p({type:F2t,json:{write:!0}})],Er.prototype,"legendOptions",void 0),c([p({type:Number,value:null,json:{write:!0}})],Er.prototype,"maxDataValue",null),c([p({type:Number,value:null,json:{write:!0}})],Er.prototype,"maxSize",null),c([wi("maxSize")],Er.prototype,"castMaxSize",null),c([Oe("maxSize")],Er.prototype,"readMaxSize",null),c([p({type:Number,value:null,json:{write:!0}})],Er.prototype,"minDataValue",null),c([p({type:Number,value:null,json:{write:!0}})],Er.prototype,"minSize",null),c([wi("minSize")],Er.prototype,"castMinSize",null),c([Oe("minSize")],Er.prototype,"readMinSize",null),c([p({type:String,json:{write:!0}})],Er.prototype,"normalizationField",void 0),c([p({readOnly:!0})],Er.prototype,"arcadeRequired",null),c([p({type:String})],Er.prototype,"scaleBy",void 0),c([p({type:[Ef],value:null,json:{write:!0}})],Er.prototype,"stops",null),c([p({type:["outline"],json:{write:!0}})],Er.prototype,"target",void 0),c([p({type:String,readOnly:!0})],Er.prototype,"transformationType",null),c([p({type:["size"],json:{type:["sizeInfo"]}})],Er.prototype,"type",void 0),c([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Er.prototype,"useSymbolValue",void 0),c([p({type:String,json:{write:!0}})],Er.prototype,"valueExpression",void 0),c([Oe("valueExpression",["valueExpression","expression"])],Er.prototype,"readValueExpression",null),c([Ie("web-scene","valueExpression")],Er.prototype,"writeValueExpressionWebScene",null),c([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Er.prototype,"valueRepresentation",void 0),c([p({type:one.apiValues,json:{write:one.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Er.prototype,"valueUnit",void 0),c([Oe("valueUnit")],Er.prototype,"readValueUnit",null),Er=ane=c([R("esri.renderers.visualVariables.SizeVariable")],Er);const J2t={color:Zb,size:Er,opacity:Xv,rotation:Yb},Q2t=new ii({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),X2t=/^\[([^\]]+)\]$/i;let XU=class extends be{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e?.filter(i=>!!i),e?.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,a=s?.match(X2t),o=a?.[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:o})),e)return e.map(l=>{const u=Q2t.read(l.type),d=J2t[u];d||(re.getLogger(this).warn(`Unknown variable type: ${u}`),r?.messages&&r.messages.push(new Gu("visual-variable:unsupported",`visualVariable of type '${u}' is not supported`,{definition:l,context:r})));const f=new d;return f.read(l,r),f})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};c([p()],XU.prototype,"visualVariables",null),XU=c([R("esri.renderers.visualVariables.VisualVariableFactory")],XU);const K2t={base:zl,key:"type",typeMap:{opacity:Xv,color:Zb,rotation:Yb,size:Er}},$P=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this._vvFactory=new XU}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,s,n){return this._vvFactory.readVariables(r,s,n)}writeVisualVariables(r,s,n,a){s[n]=this._vvFactory.writeVariables(r,a)}get arcadeRequiredForVisualVariables(){return this.visualVariables?.some(({arcadeRequired:r})=>r)??!1}hasVisualVariables(r,s){return r?this.getVisualVariablesForType(r,s).length>0:this.getVisualVariablesForType("size",s).length>0||this.getVisualVariablesForType("color",s).length>0||this.getVisualVariablesForType("opacity",s).length>0||this.getVisualVariablesForType("rotation",s).length>0}getVisualVariablesForType(r,s){return this.visualVariables?.filter(n=>n.type===r&&(typeof s=="string"?n.target===s:s!==!1||!n.target))??[]}async collectVVRequiredFields(r,s){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const a of n)a&&(a.field&&ec(r,s,a.field),a.normalizationField&&ec(r,s,a.normalizationField),a.valueExpression&&(eSt(a.valueExpression,r,s)||await ic(r,s,null,a.valueExpression)))}};return c([p({types:[K2t],value:null,json:{write:!0}})],i.prototype,"visualVariables",null),c([Oe("visualVariables",["visualVariables","rotationType","rotationExpression"])],i.prototype,"readVisualVariables",null),c([Ie("visualVariables")],i.prototype,"writeVisualVariables",null),i=c([R("esri.renderers.mixins.VisualVariablesMixin")],i),i};function eSt(t,e,i){const r=Pft(t);return r!=null&&(ec(e,i,r),!0)}const bhe=[252,146,31,255],tSt=[153,153,153,255],iSt={type:"esriSMS",style:"esriSMSCircle",size:6,color:bhe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},rSt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:bhe},sSt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},nSt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},aSt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},oSt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},lSt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},eG=wa.fromJSON(iSt),whe=Rn.fromJSON(rSt),pVe=Pu.fromJSON(sSt),cSt=es.fromJSON(nSt);function Npi(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return eG;case"polyline":return whe;case"polygon":case"extent":return pVe}return null}const Vpi=wa.fromJSON(aSt),jpi=Rn.fromJSON(oSt),Upi=Pu.fromJSON(lSt),uSt=Gl.fromSimpleMarkerSymbol(eG),hSt=Bf.fromSimpleLineSymbol(whe),dSt=hp.fromSimpleFillSymbol(pVe),pSt=new kg({symbolLayers:new ke([new jl({material:{color:bhe},edges:new yLe({size:Tp(1),color:new Je(tSt)})})])}),fSt=new Bf({symbolLayers:new ke([new Ac({material:{color:new Je([0,0,0])},size:Tp(1)})])}),mSt=new hp({symbolLayers:new ke([new jl({outline:{color:new Je([0,0,0]),size:Tp(1)}})])});function Bpi(t){if(t==null)return null;switch(t.type){case"mesh":return pSt;case"point":case"multipoint":return uSt;case"polyline":return hSt;case"polygon":case"extent":return dSt}return null}const C2e="#useCIMFallbackSymbology()",DC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function gSt(t,e=DC){if(!t)return{symbol:null};const{retainId:i=DC.retainId,ignoreDrivers:r=DC.ignoreDrivers,hasLabelingContext:s=DC.hasLabelingContext,retainCIM:n=DC.retainCIM,cimFallbackEnabled:a=DC.cimFallbackEnabled}=e;let o=null;if(qLe(t))o=t.clone();else if(t.type==="web-style")o=t.clone();else if(t.type==="cim"){const l=t.data?.symbol?.type;switch(l){case"CIMPointSymbol":o=n?t.clone():Gl.fromCIMSymbol(t);break;case"CIMLineSymbol":a&&(o=fSt.clone(),e?.logWarning?.(C2e,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":a&&(o=mSt.clone(),e?.logWarning?.(C2e,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!o)return{error:new q("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${l||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof Rn)o=Bf.fromSimpleLineSymbol(t);else if(t instanceof wa)o=Gl.fromSimpleMarkerSymbol(t);else if(t instanceof Ec)o=Gl.fromPictureMarkerSymbol(t);else if(t instanceof Pu)o=e.geometryType&&e.geometryType==="mesh"?kg.fromSimpleFillSymbol(t):hp.fromSimpleFillSymbol(t);else{if(!(t instanceof es))return{error:new q("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?$f.fromTextSymbol(t):Gl.fromTextSymbol(t)}return i&&o&&o.type!=="cim"&&(o.id=t.id),!r||o.type==="cim"||o instanceof dl||o.symbolLayers.forEach(l=>l.ignoreDrivers=!0),{symbol:o}}function tG(t,e,i,r){const s=fVe(t,{},{context:r,isLabelSymbol:!1});s!=null&&ra(i,s,e)}function M2e(t,e,i,r){const s=fVe(t,{},{context:r,isLabelSymbol:!0});s!=null&&(e[i]=s)}function E2e(t){return qLe(t)||t instanceof dl}function ySt(t){return t?.type==="polygon-3d"||t?.type==="line-3d"}function fVe(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:s}=i,n=r?.origin,a=r?.messages;if(n==="web-scene"&&!E2e(t)){const o=gSt(t,{retainCIM:!0,hasLabelingContext:s});return o.symbol!=null?o.symbol.write(e,r):(a?.push(new q("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:o.error})),null)}return iie(r?.layer)&&ySt(t)?(a?.push(new q("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported on layers of type '${r?.layer?.declaredClass}'.`,{symbol:t,context:r})),null):(n==="web-map"||n==="portal-item"&&!iie(r?.layer))&&E2e(t)?(a?.push(new q("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function qpi(t,e){return Pgt(t,null,e)}const K7={types:GLe,json:{write:{writer:tG},origins:{"web-scene":{types:p1e,write:{writer:tG},read:{reader:pP({types:p1e})}}}}},xhe=Ele({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},K7),She={types:{base:Kn,key:"type",typeMap:{"simple-fill":Vh.typeMap["simple-fill"],"picture-fill":Vh.typeMap["picture-fill"],"polygon-3d":Vh.typeMap["polygon-3d"],cim:Vh.typeMap.cim}},json:{write:{writer:tG},origins:{"web-scene":{type:hp,write:{writer:tG}}}}},KU={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}};var lne;let zc=lne=class extends $P(qh){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.symbols.map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}get symbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return this.symbols.reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new lne({description:this.description,label:this.label,symbol:se(this.symbol),visualVariables:se(this.visualVariables),authoringInfo:se(this.authoringInfo)})}};c([p({type:String,json:{write:!0}})],zc.prototype,"description",void 0),c([p({type:String,json:{write:!0}})],zc.prototype,"label",void 0),c([p(xhe)],zc.prototype,"symbol",void 0),c([st({simple:"simple"})],zc.prototype,"type",void 0),zc=lne=c([R("esri.renderers.SimpleRenderer")],zc);const vSt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function cne(t){return t instanceof be}function A2e(t){return t instanceof ke?Object.keys(t.items):cne(t)?xl(t).keys():t?Object.keys(t):[]}function mV(t,e){return t instanceof ke?t.items[e]:t[e]}function _St(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function N4(t){return t?t.declaredClass:null}function mVe(t,e){const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=A2e(t),s=A2e(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||_St(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(f=>!r.includes(f)),a=r.filter(f=>!s.includes(f)),o=r.filter(f=>s.includes(f)&&mV(t,f)!==mV(e,f)).concat(n,a).sort(),l=N4(t);if(l&&vSt.has(l)&&o.length)return{type:"complete",oldValue:t,newValue:e};let u;const d=cne(t)&&cne(e);for(const f of o){const g=mV(t,f),v=mV(e,f);let _;if((d||typeof g!="function"&&typeof v!="function")&&g!==v&&(g!=null||v!=null)){if(i&&i[f]&&typeof i[f]=="function")_=i[f]?.(g,v);else if(g instanceof Date&&v instanceof Date){if(g.getTime()===v.getTime())continue;_={type:"complete",oldValue:g,newValue:v}}else _=typeof g=="object"&&typeof v=="object"&&N4(g)===N4(v)?mVe(g,v):{type:"complete",oldValue:g,newValue:v};_!=null&&(u!=null?u.diff[f]=_:u={type:"partial",diff:{[f]:_}})}}return u}function Gpi(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function bSt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&N4(t)!==N4(e)?{type:"complete",oldValue:t,newValue:e}:mVe(t,e)}function gV(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!gV(i))return!1;for(const i of e.removed)if(!gV(i))return!1;for(const i of e.changed)if(!gV(i))return!1;return!0}case"partial":for(const e in t.diff)if(!gV(t.diff[e]))return!1;return!0}}var une;const wSt=so()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let ik=une=class extends nt(ae){static from(t){return g$(une,t)}constructor(t){super(t),this.title=null,this.order=null}};c([p({type:String,json:{write:!0}})],ik.prototype,"title",void 0),c([st(wSt)],ik.prototype,"order",void 0),ik=une=c([R("esri.renderers.support.RendererLegendOptions")],ik);const The=ik;let zf=class extends nt(ae){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};c([p(KU)],zf.prototype,"value",void 0),c([p(KU)],zf.prototype,"value2",void 0),c([p(KU)],zf.prototype,"value3",void 0),zf=c([R("esri.renderers.support.UniqueValue")],zf);let Vv=class extends nt(ae){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new zf({value:r})):i==="object"?e[0]instanceof zf?e:e.map(r=>new zf(r)):null}};c([p({type:String,json:{write:!0}})],Vv.prototype,"description",void 0),c([p({type:String,json:{write:!0}})],Vv.prototype,"label",void 0),c([p(K7)],Vv.prototype,"symbol",void 0),c([p({type:[zf],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new zf({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(wl).map(n=>n.toString());i.push(s)}e.values=i}}}})],Vv.prototype,"values",void 0),c([wi("values")],Vv.prototype,"castValues",null),Vv=c([R("esri.renderers.support.UniqueValueClass")],Vv);let uS=class extends nt(ae){constructor(e){super(e),this.heading=null,this.classes=null}};c([p({type:String,json:{write:!0}})],uS.prototype,"heading",void 0),c([p({type:[Vv],json:{write:{isRequired:!0}}})],uS.prototype,"classes",void 0),uS=c([R("esri.renderers.support.UniqueValueGroup")],uS);var hne;let Rf=hne=class extends ae{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new hne({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${t}`}};c([p({type:String,json:{write:!0}})],Rf.prototype,"description",void 0),c([p({type:String,json:{write:!0}})],Rf.prototype,"label",void 0),c([p(xhe)],Rf.prototype,"symbol",void 0),c([p(KU)],Rf.prototype,"value",void 0),Rf=hne=c([R("esri.renderers.support.UniqueValueInfo")],Rf);const O2e=new Map;async function xSt(t,e){try{return{data:(await CSt(t,e)).data,baseUrl:Urt(t),styleUrl:t}}catch(i){return ml(i),null}}function SSt(t,e,i){const r=e.portal!=null?e.portal:ze.getDefault();let s;const n=`${r.url} - ${r.user?.username} - ${t}`,a=O2e.get(n);if(a)return a;const o=TSt(t,r,i).then(l=>(s=l,l.fetchData())).then(l=>({data:l,baseUrl:s.itemUrl??"",styleName:t}));return O2e.set(n,o),o}function TSt(t,e,i){return e.load(i).then(()=>{const r=new Jn({disableExtraQuery:!0,query:`owner:${P2e} AND type:${R2e} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(a.typeKeywords?.some(l=>l.toLowerCase()===n)&&a.type===R2e&&a.owner===P2e){s=a;break}}if(!s)throw new q("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function $St(t,e,i){return t?.styleUrl!=null?xSt(t.styleUrl,i):t?.styleName!=null?SSt(t.styleName,e,i):Promise.reject(new q("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function Ypi(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function Jpi(t,e){for(const i of e)switch(i){case"cim":if(t.cimRef)return{format:i,url:encodeURI(t.cimRef)};break;case"web-gltf-basisu":{const r=gQ(t,"gltf_basisu");if(r)return{format:i,url:r};break}case"web-gltf":{const r=gQ(t,"gltf");if(r)return{format:i,url:r};break}case"web":{const r=gQ(t,"gltf");if(r)return{format:"web-gltf",url:r};if(t.webRef)return{format:i,url:encodeURI(t.webRef)};break}}}function gQ(t,e){if(!ie("enable-feature:force-wosr"))return t.formatInfos?.find(i=>i.type===e)?.href}function CSt(t,e){const i={responseType:"json",query:{f:"json"},...e};return Si(pp(t),i)}const P2e="esri_en",R2e="Style",Qpi="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var rk;const I2e="uvInfos-watcher",D2e="uvGroups-watcher",MSt=",",ESt=en(Rf);function ASt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:a}=t,o=!(!e||!i);return[{classes:(n??[]).map(l=>{const{symbol:u,label:d,value:f,description:g}=l,[v,_,x]=o?f?.toString()?.split(s||"")||[]:[f],S=[];return(e||a)&&S.push(v),i&&S.push(_),r&&S.push(x),{symbol:u,label:d,values:[S],description:g}})}]}function kC(t){return t!=null&&t!==""&&(typeof t!="string"||t.trim()!==""&&t.toLowerCase()!=="<null>")||(t=null),t+""}let Fs=rk=class extends $P(qh){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const a=e.find(o=>o.value===i[n].value);a?bSt(a,i[n])?(s.changed.push({type:"complete",oldValue:a,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:a,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(a=>a.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:ZL(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r?.messages?r.messages.push(new q("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):re.getLogger(this).error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||ze.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=y$(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=HT(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?re.getLogger(this).error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?re.getLogger(this).error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void re.getLogger(this).error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?ESt(t):new Rf({value:t,symbol:HLe(e)}),this.uniqueValueInfos?.push(i),this._valueInfoMap[kC(i.value)]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void re.getLogger(this).error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[kC(t)],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await p1()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){return this.valueExpression&&e?.arcade==null?void re.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used"):this._getUniqueValueInfo(t,e)?.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&i?.arcade==null){const s=await p1(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}return this._getUniqueValueInfo(t,i)?.symbol||this.defaultSymbol}get symbols(){const t=[];if(this._isInfosSource)for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);else for(const e of this.uniqueValueGroups??[])for(const i of e.classes??[])i.symbol&&t.push(i.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=this.uniqueValueInfos?.reduce((r,s)=>r+s.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new rk({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:se(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:se(this.visualVariables),legendOptions:se(this.legendOptions),authoringInfo:se(this.authoringInfo),backgroundFillSymbol:se(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=se(this.uniqueValueInfos),i=se(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(se(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.symbols.map(r=>r.collectRequiredFields(t,e)),ic(t,e,null,this.valueExpression)];ec(t,e,this.field),ec(t,e,this.field2),ec(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return $St(this.styleOrigin,{portal:this.portal}).then(t=>{const e=[];return this._valueInfoMap={},t?.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const r=new dl({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new Rf({value:i.name,symbol:r});e.push(s),this._valueInfoMap[kC(i.name)]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",MSt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[kC(e.value)]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(I2e);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(X(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,I2e)}}_watchUniqueValueGroups(){this.removeHandles(D2e);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(X(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(X(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,D2e)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:a}=this;if(!e&&!a)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const o=!(!e||!i);for(const l of n)for(const u of l.classes??[]){const{symbol:d,label:f,values:g,description:v}=u;for(const _ of g??[]){const{value:x,value2:S,value3:T}=_,M=[x];i&&M.push(S),r&&M.push(T);const E=o?M.join(s||""):M[0]??void 0;t.push(new Rf({symbol:d,label:f,value:E,description:v}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const a=!(!e||!i),o=n.map(u=>{const{symbol:d,label:f,value:g,description:v}=u,[_,x,S]=a?g?.toString()?.split(s||"")||[]:[g];return new Vv({symbol:d,label:f,description:v,values:[new zf({value:_,value2:x,value3:S})]})}),l=[new uS({classes:o})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:a}=e??{};let o=this._cache.compiledFunc;const l=n.arcadeUtils;if(!o){const d=l.createSyntaxTree(this.valueExpression);o=l.createFunction(d),this._cache.compiledFunc=o}const u=l.executeFunction(o,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),a));return this._valueInfoMap[kC(u)]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(this.field2){const s=this.field2,n=this.field3,a=[];e&&a.push(i[e]),s&&a.push(i[s]),n&&a.push(i[n]),r=a.join(this.fieldDelimiter||"")}else e&&(r=i[e]);return this._valueInfoMap[kC(r)]}static fromPortalStyle(t,e){const i=new rk(e?.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",e?.portal||ze.getDefault());const r=i.populateFromStyle();return r.catch(s=>{re.getLogger(this.prototype).error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new rk(e?.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{re.getLogger(this.prototype).error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};c([p({readOnly:!0})],Fs.prototype,"_cache",null),c([st({uniqueValue:"unique-value"})],Fs.prototype,"type",void 0),c([p(She)],Fs.prototype,"backgroundFillSymbol",void 0),c([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Fs.prototype,"field",null),c([wi("field")],Fs.prototype,"castField",null),c([Ie("field")],Fs.prototype,"writeField",null),c([p({type:String,value:null,json:{write:!0}})],Fs.prototype,"field2",null),c([p({type:String,value:null,json:{write:!0}})],Fs.prototype,"field3",null),c([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],Fs.prototype,"orderByClassesEnabled",void 0),c([p({type:String,value:null,json:{write:!0}})],Fs.prototype,"valueExpression",null),c([p({type:String,json:{write:!0}})],Fs.prototype,"valueExpressionTitle",void 0),c([p({type:The,json:{write:!0}})],Fs.prototype,"legendOptions",void 0),c([p({type:String,json:{write:!0}})],Fs.prototype,"defaultLabel",void 0),c([p(Ele({...K7},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Fs.prototype,"defaultSymbol",null),c([p({type:String,value:null,json:{write:!0}})],Fs.prototype,"fieldDelimiter",null),c([p({type:ze,readOnly:!0})],Fs.prototype,"portal",void 0),c([Oe("portal",["styleName"])],Fs.prototype,"readPortal",null),c([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Fs.prototype,"styleOrigin",void 0),c([Oe("styleOrigin",["styleName","styleUrl"])],Fs.prototype,"readStyleOrigin",null),c([Ie("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Fs.prototype,"writeStyleOrigin",null),c([p({type:[uS],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||ASt(e)).map(r=>uS.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Fs.prototype,"uniqueValueGroups",null),c([p({type:[Rf],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],Fs.prototype,"uniqueValueInfos",null),Fs=rk=c([R("esri.renderers.UniqueValueRenderer")],Fs);var dne,FA;let fo=(FA=class extends ae{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.orderByFields=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,i){i.resultOffset=this.start,i.resultRecordCount=this.num||10}clone(){return new dne(se({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}},dne=FA,FA);c([p({type:[String],json:{write:!0}})],fo.prototype,"attachmentTypes",void 0),c([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],fo.prototype,"attachmentsWhere",void 0),c([p({type:Boolean,json:{write:!0}})],fo.prototype,"cacheHint",void 0),c([p({type:[String],json:{write:!0}})],fo.prototype,"keywords",void 0),c([p({type:[String],json:{write:!0}})],fo.prototype,"globalIds",void 0),c([p({json:{write:!0}})],fo.prototype,"name",void 0),c([p({type:Number,json:{read:{source:"resultRecordCount"}}})],fo.prototype,"num",void 0),c([p({type:[Number],json:{write:!0}})],fo.prototype,"objectIds",void 0),c([p({type:[String],json:{write:!0}})],fo.prototype,"orderByFields",void 0),c([p({type:Boolean,json:{default:!1,write:!0}})],fo.prototype,"returnMetadata",void 0),c([p({type:[Number],json:{write:!0}})],fo.prototype,"size",void 0),c([p({type:Number,json:{read:{source:"resultOffset"}}})],fo.prototype,"start",void 0),c([Ie("start"),Ie("num")],fo.prototype,"writeStart",null),c([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],fo.prototype,"where",void 0),fo=dne=c([R("esri.rest.support.AttachmentQuery")],fo),fo.from=en(fo);const gVe=so()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),k2e="percent-of-total",L2e="field",Xpi=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let r=this._get("normalizationType");const s=!!this.normalizationField,n=this.normalizationTotal!=null;return s||n?(r=s&&L2e||n&&k2e||null,s&&n&&re.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):r!==L2e&&r!==k2e||(r=null),r}set normalizationType(r){this._set("normalizationType",r)}};return c([p({type:String,json:{name:"parameters.normalizationField",write:!0}})],i.prototype,"normalizationField",void 0),c([p({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],i.prototype,"normalizationMaxValue",void 0),c([p({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],i.prototype,"normalizationMinValue",void 0),c([p({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],i.prototype,"normalizationTotal",void 0),c([st(gVe,{name:"parameters.normalizationType"})],i.prototype,"normalizationType",null),i=c([R("esri.rest.support.NormalizationBinParametersMixin")],i),i};var pne,zA;let Ws=(zA=class extends ae{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,i){i.historicMoment=e&&e.getTime()}writeStart(e,i){i.resultOffset=this.start,i.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(i.definitionExpression="1=1")}clone(){return new pne(se({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}},pne=zA,zA);c([p({type:Boolean,json:{write:!0}})],Ws.prototype,"cacheHint",void 0),c([p({type:Cf,json:{write:!0}})],Ws.prototype,"dynamicDataSource",void 0),c([p({type:String,json:{write:!0}})],Ws.prototype,"gdbVersion",void 0),c([p({type:Number,json:{write:!0}})],Ws.prototype,"geometryPrecision",void 0),c([p({type:Date})],Ws.prototype,"historicMoment",void 0),c([Ie("historicMoment")],Ws.prototype,"_writeHistoricMoment",null),c([p({type:Number,json:{write:!0}})],Ws.prototype,"maxAllowableOffset",void 0),c([p({json:{write:!0}})],Ws.prototype,"objectIds",void 0),c([p({type:[String],json:{write:!0}})],Ws.prototype,"orderByFields",void 0),c([p({type:[String],json:{write:!0}})],Ws.prototype,"outFields",void 0),c([p({type:Me,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ws.prototype,"outSpatialReference",void 0),c([p({json:{write:!0}})],Ws.prototype,"relationshipId",void 0),c([p({type:Number,json:{read:{source:"resultOffset"}}})],Ws.prototype,"start",void 0),c([Ie("start"),Ie("num")],Ws.prototype,"writeStart",null),c([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ws.prototype,"num",void 0),c([p({json:{write:!0}})],Ws.prototype,"returnGeometry",void 0),c([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ws.prototype,"returnM",void 0),c([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ws.prototype,"returnZ",void 0),c([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ws.prototype,"where",void 0),Ws=pne=c([R("esri.rest.support.RelationshipQuery")],Ws),Ws.from=en(Ws);const Kpi=Object.freeze(Object.defineProperty({__proto__:null,get default(){return Ws}},Symbol.toStringTag,{value:"Module"})),fne=new ii({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function OSt(t,e,i,r){const s=await N1(t);if(await $he(t,e,r),!s.addAttachment)throw new q(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function $he(t,e,i){const{attributes:r}=e,{objectIdField:s}=t;return t.capabilities?.data?.supportsAttachment?e?r?s&&r[s]?Promise.resolve():Promise.reject(new q(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new q(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new q(i,"A feature is required to add/delete/update attachments")):Promise.reject(new q(i,"this layer doesn't support attachments"))}async function PSt(t,e,i,r,s){const n=await N1(t);if(await $he(t,e,s),!n.updateAttachment)throw new q(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function RSt(t,e,i){const{applyEdits:r}=await W(()=>import("./editingSupport-D04zAGj6.js"),[]),s=await t.load();let n=i;return s.type==="feature"&&s.infoFor3D&&e.deleteFeatures!=null&&s.globalIdField!=null&&(n={...n,globalIdToObjectId:await eTt(s,e.deleteFeatures,s.globalIdField)}),r(s,s.source,e,i)}async function ISt(t,e,i){const{uploadAssets:r}=await W(()=>import("./editingSupport-D04zAGj6.js"),[]),s=await t.load();return r(s,s.source,e,i)}async function DSt(t,e,i,r){const s=await N1(t);if(await $he(t,e,r),!s.deleteAttachments)throw new q(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function kSt(t,e,i){const r=(await t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new q(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function LSt(t,e,i,r){e=fo.from(e),await t.load();const s=t.source,n=t.capabilities;if(!n?.data?.supportsAttachment)throw new q(r,"this layer doesn't support attachments");const{attachmentTypes:a,objectIds:o,globalIds:l,num:u,size:d,start:f,where:g}=e;if(!n?.operations?.supportsQueryAttachments&&(a?.length>0||l?.length>0||d?.length>0||u||f||g))throw new q(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(o?.length||l?.length||g))throw new q(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new q(r,"Layer source does not support queryAttachments capability",e);return!n?.attachment?.supportsOrderByFields&&e.orderByFields?.length&&((e=e.clone()).orderByFields=null),s.queryAttachments(e)}async function FSt(t,e,i,r){const s=await N1(t);if(!s.queryObjectIds)throw new q(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Ct.from(e)??t.createQuery(),i)}async function zSt(t,e,i,r){const s=await N1(t);if(!s.queryFeatureCount)throw new q(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Ct.from(e)??t.createQuery(),i)}async function NSt(t,e,i,r){const s=await N1(t);if(!s.queryExtent)throw new q(r,"Layer source does not support queryExtent capability");return s.queryExtent(Ct.from(e)??t.createQuery(),i)}async function VSt(t,e,i,r){const s=await N1(t);if(!s.queryRelatedFeatures)throw new q(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(Ws.from(e),i)}async function jSt(t,e,i,r){const s=await N1(t);if(!s.queryRelatedFeaturesCount)throw new q(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(Ws.from(e),i)}async function USt(t){const e=t.source;if(e?.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await yue(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function BSt(t){const e=new Ct;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,e.outFields=["*"],e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null;const i=t.capabilities?.query;i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference);const r=t.capabilities?.data;r?.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r?.supportsM&&t.returnM!=null&&(e.returnM=t.returnM);const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e}function yVe(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function vVe(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function qSt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function GSt(t,e,i,r){const s=i?.feature,n=!!t.subtypes?.length;if(n&&!i?.excludeImpliedDomains){const l=WSt(t,e);if(l)return l}const a=n&&HSt(t,s);if(a){const l=a?.domains?.[e];return l?.type==="inherited"?r:l}const o=wVe(t.types,t.typeIdField,s);if(o){const l=o.domains&&o.domains[e];if(l&&l?.type!=="inherited")return l}if(r)return r;if(!i?.excludeImpliedDomains){const l=ZSt(t,e);if(l)return l}return null}function HSt(t,e){const{subtypes:i,subtypeField:r}=t;if(!e?.attributes||!i?.length||!r)return null;const s=e.attributes[r];return s==null?null:i.find(n=>n.code===s)}function WSt(t,e){const{fieldsIndex:i,subtypeField:r}=t,{name:s,type:n}=i.get(e)??{};if(!s)return null;if((r&&i.get(r)?.name)===s&&t.subtypes?.length){const a=t.subtypes.map(o=>new lS({code:_Ve(o.code,n),name:o.name}));if(a?.length)return new mw({codedValues:a})}return null}function ZSt(t,e){const{fieldsIndex:i}=t,{name:r,type:s}=i.get(e)??{};if(!r)return null;if(("typeIdField"in t?i.get(t.typeIdField)?.name:null)===r&&"types"in t&&t.types?.length){const n=t.types.map(a=>new lS({code:_Ve(a.id,s),name:a.name}));return new mw({codedValues:n})}return null}function _Ve(t,e){return e?_ue({type:e})&&typeof t=="number"?`${t}`:q5e({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function N1(t){return(await t.load()).source}async function efi(t,e){if(!nr)return;const i=nr.findCredential(t);if(i)return i.userId;let r;try{const s=await cue(t,e);s&&(r=await nr.checkSignInStatus(`${s}/sharing`))}catch{}return r?r.userId:null}async function bVe(t,e){if(!nr||nr.findCredential(t))return;let i;try{const r=await cue(t,e);r&&(i=await nr.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await nr.getCredential(t,{signal:r})}catch{}}async function YSt(t,e,i){const r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&await bVe(r,i)}async function tfi(t){const e=t.parsedUrl?.path;e&&JSt(t)&&await bVe(e)}function JSt(t){return QSt(t)&&("serviceDefinitionExpression"in t&&iG(t.serviceDefinitionExpression)||"definitionExpression"in t&&iG(t.definitionExpression))}function QSt(t){return!(!V4e(t)||!t.capabilities?.query.supportsCurrentUser)}function iG(t){return!!t?.toLowerCase().includes("current_user")}function XSt(t){return!eB(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const yQ=pP({types:GLe});function Che(t,e){if(t.defaultSymbol)return t.types?.length?new Fs({defaultSymbol:yQ(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(i=>({id:i.id,symbol:yQ(i.symbol,i,e)}))}):new zc({symbol:yQ(t.defaultSymbol,t,e)})}function KSt(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;const i=t.editingInfo?.lastEditDate?.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function eTt(t,e,i){if(e==null)return null;const r=[],{objectIdField:s}=t;if(e.forEach(u=>{let d=null;if("attributes"in u){const{attributes:f}=u;d={globalId:f[i],objectId:f[s]!=null&&f[s]!==-1?f[s]:null}}else d={globalId:u.globalId,objectId:u.objectId!=null&&u.objectId!==-1?u.objectId:null};d.globalId!=null&&(d.objectId!=null&&d.objectId!==-1||r.push(d.globalId))}),r.length===0)return null;const n=t.createQuery();n.where=r.map(u=>`${i}='${u}'`).join(" OR "),n.returnGeometry=!1,n.outFields=[s,i],n.cacheHint=!1;const a=await Hht(iVe(t,n));if(!a.ok)return null;const o=new Map,l=a.value.features;for(const u of l){const d=u.attributes[i],f=u.attributes[s];d!=null&&f!=null&&f!==-1&&o.set(ipt(d),f)}return o}function wVe(t,e,i){if(!e||!i||!t)return null;const r=i.getAttribute(e);return r==null?null:t.find(s=>{const{id:n}=s;return n!=null&&n.toString()===r.toString()})??null}function eB(t){return t.sourceJSON?.isMultiServicesView||tTt(t)}function tTt(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map(e=>e.trim()).includes("map")}function iTt(t,e,i){const r=e?.queryAttributeBins;if(!e?.operations?.supportsQueryBins||!r)throw new q(i,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new q(i,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!F2e(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new q(i,"Layer source does not support normalization binning");break;case"date":if(!r.supportsDate)throw new q(i,"Layer source does not support date binning");if(t.binParameters.snapToData&&!r.supportsSnapToData)throw new q(i,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!r.supportsReturnFullIntervalBin)throw new q(i,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new q(i,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new q(i,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!F2e(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new q(i,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!r.supportsStackBy)throw new q(i,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!r.supportsSplitBy)throw new q(i,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!r.supportsFirstDayOfWeek)throw new q(i,"Layer source does not support firstDayOfWeek binning");const s=r?.supportedStatistics;if(t.outStatistics&&s){const n=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:a}of t.outStatistics){const o=n.get(a);if(o&&!s[o])throw new q(i,`Layer source does not support ${a} statistic type`)}}}function F2e(t,e){return t!=null&&!!e?.[gVe.toJSON(t)]}let g3=class extends nt(ae){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};c([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],g3.prototype,"shapeAreaField",void 0),c([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],g3.prototype,"shapeLengthField",void 0),c([p({type:String,json:{read:t=>cnt.read(t)||unt.read(t)}})],g3.prototype,"units",void 0),g3=c([R("esri.layers.support.GeometryFieldsInfo")],g3);var mne;let y3=mne=class extends ae{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ke}clone(){return new mne({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};c([p({type:String,json:{write:{isRequired:!0}}})],y3.prototype,"floorField",void 0),c([p({json:{read:!1,write:!1}})],y3.prototype,"viewAllMode",void 0),c([p({json:{read:!1,write:!1}})],y3.prototype,"viewAllLevelIds",void 0),y3=mne=c([R("esri.layers.support.LayerFloorInfo")],y3);function rTt(t){const{nonStandardUrlAllowed:e=!1,separator:i}=t??{},r=se(m2t),s=r.json?.write;return typeof s=="object"&&s&&(s.writer=function(n,a,o,l){rst(this,n,i,a,l)}),{...r,set:function(n){if(n==null)return void this._set("url",n);const a=ist({layer:this,url:n,nonStandardUrlAllowed:e,logger:re.getLogger(this)});this._set("url",a.url),a.layerId!=null&&this._set("layerId",a.layerId)}}}function sTt(t,e){const{separator:i}=e??{},r=kn(t.url);return r!=null&&(t.dynamicDataSource!=null?r.path=Xh(r.path,"dynamicLayer"):t.layerId!=null&&(r.path=Xh(r.path,i??"",t.layerId.toString()))),r}const z2e=new ii({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),N2e=new ii({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Sh=class extends nt(ae){constructor(e){super(e),this.cardinality=null,this.catalogId=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};c([p({json:{read:z2e.read,write:z2e.write}})],Sh.prototype,"cardinality",void 0),c([p({json:{name:"catalogID"}})],Sh.prototype,"catalogId",void 0),c([p({json:{read:!0,write:!0}})],Sh.prototype,"composite",void 0),c([p({json:{read:!0,write:!0}})],Sh.prototype,"id",void 0),c([p({json:{read:!0,write:!0}})],Sh.prototype,"keyField",void 0),c([p({json:{read:!0,write:!0}})],Sh.prototype,"keyFieldInRelationshipTable",void 0),c([p({json:{read:!0,write:!0}})],Sh.prototype,"name",void 0),c([p({json:{read:!0,write:!0}})],Sh.prototype,"relatedTableId",void 0),c([p({json:{read:!0,write:!0}})],Sh.prototype,"relationshipTableId",void 0),c([p({json:{read:N2e.read,write:N2e.write}})],Sh.prototype,"role",void 0),Sh=c([R("esri.layers.support.Relationship")],Sh);const nTt=[["binary","application/octet-stream","bin",""]];function sfi(t,e){return $Ve(e.name,t?.supportedFormats??[])!=null}function nfi(t,e){if(!t)return!1;const i=aTt(e,t.supportedFormats??[]);return i!=null&&t.editFormats.includes(i)}function xVe(t,e){return Ehe(uTt(t,e))}function SVe(t,e){return Ehe($Ve(t,e))}function afi(t,e){return CVe(cTt(t,e))}function aTt(t,e){return SVe(t.name,e)??xVe(t.type,e)}function eH(t,e,i){return xVe(t,i)??SVe(e,i)}function TVe({supportedFormats:t}){return eH("model/gltf-binary","glb",t)}function ofi(t){const e=TVe(t);return e!=null&&t.editFormats.includes(e)}function oTt({supportedFormats:t}){return eH("model/gltf+json","gltf",t)}function lTt(t){if(!t)return null;const e=TVe(t),i=oTt(t);let r=null;for(const s of t.queryFormats){if(s===e)return s;s===i&&(r=s)}return r}function lfi({supportedFormats:t}){return eH("application/esri3do-SR_world","wld",t)}function cfi({supportedFormats:t}){return eH("application/esri3do-SR_prj","prj",t)}function Mhe(t){return[...nTt,...t]}function cTt(t,e){return Mhe(e).find(i=>Ehe(i)===t)}function uTt(t,e){const i=t.toLowerCase();return Mhe(e).find(r=>CVe(r)===i)}function $Ve(t,e){const i=t.toLowerCase();return Mhe(e).find(r=>hTt(r).some(s=>i.endsWith(s)))}function Ehe(t){return t?.[0]}function CVe(t){return t?.[1].toLowerCase()}function hTt(t){return t?.[2].split(",").map(e=>e.toLowerCase())??[]}function ufi(t){return t.tables?.find(e=>e.role==="assetMaps")}function lt(t,e,i){return!!MVe(t,e,i)}function v3(t,e,i){return MVe(t,e,i)}function MVe(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const dTt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function pTt(t){const e=t?.supportedSpatialAggregationStatistics?.map(i=>i.toLowerCase());return{envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function OF(t,e){return!!t?.supportedOperationsWithCacheHint?.map(r=>r.toLowerCase())?.includes(e.toLowerCase())}function fTt(t){const e=t?.supportedStatisticTypes?.map(i=>i.toLowerCase());return{count:!!e?.includes("count"),sum:!!e?.includes("sum"),min:!!e?.includes("min"),max:!!e?.includes("max"),avg:!!e?.includes("avg"),var:!!e?.includes("var"),stddev:!!e?.includes("stddev"),percentileContinuous:!!e?.includes("percentile_cont"),percentileDiscrete:!!e?.includes("percentile_disc"),envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function mTt(t){const e=t?.supportedNormalizationTypes?.map(i=>i.toLowerCase());return{field:!!e?.includes("field"),log:!!e?.includes("log"),naturalLog:!!e?.includes("naturallog"),percentOfTotal:!!e?.includes("percentoftotal"),squareRoot:!!e?.includes("squareroot")}}function EVe(t,e){return{analytics:gTt(t),attachment:yTt(t),data:vTt(t),metadata:_Tt(t),operations:bTt(t.capabilities,t,e),query:wTt(t,e),queryAttributeBins:TTt(t),queryRelated:xTt(t),queryTopFeatures:STt(t),editing:$Tt(t)}}function gTt(t){return{supportsCacheHint:OF(t.advancedQueryCapabilities,"queryAnalytics")}}function yTt(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:OF(t.advancedQueryCapabilities,"queryAttachments"),supportsOrderByFields:lt(t.advancedQueryCapabilities,"supportsQueryAttachmentOrderByFields",!1),supportsResize:lt(t,"supportsAttachmentsResizing",!1),supportsTypeWildcard:lt(t.advancedQueryCapabilities,"supportsQueryAttachmentWithTypeWildcard",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=dTt[r.name];s&&(i[s]=!!r.isEnabled)}),i}function vTt(t){return{isVersioned:lt(t,"isDataVersioned",!1),isBranchVersioned:lt(t,"isDataBranchVersioned",!1),supportsAttachment:lt(t,"hasAttachments",!1),supportsM:lt(t,"hasM",!1),supportsZ:lt(t,"hasZ",!1)}}function _Tt(t){return{supportsAdvancedFieldProperties:lt(t,"supportsFieldDescriptionProperty",!1)}}function bTt(t,e,i){const r=t?.toLowerCase().split(",").map(g=>g.trim())??[],s=i?Zg(i):null,n=r.includes(s?.serverType==="MapServer"?"data":"query"),a=r.includes("editing")&&!e.datesInUnknownTimezone&&e.uniqueIdInfo?.OIDFieldContainsHashValue!==!0;let o=a&&r.includes("create"),l=a&&r.includes("delete"),u=a&&r.includes("update");const d=r.includes("changetracking"),f=e.advancedQueryCapabilities;return a&&!(o||l||u)&&(o=l=u=!0),{supportsCalculate:lt(e,"supportsCalculate",!1),supportsTruncate:lt(e,"supportsTruncate",!1),supportsValidateSql:lt(e,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:l,supportsEditing:a,supportsChangeTracking:d,supportsQuery:n,supportsQueryAnalytics:lt(f,"supportsQueryAnalytic",!1),supportsQueryAttachments:lt(f,"supportsQueryAttachments",!1),supportsQueryBins:lt(f,"supportsQueryBins",!1)||!!e.queryBinsCapabilities,supportsQueryPivot:lt(f,"supportsQueryPivot",!1),supportsQueryTopFeatures:lt(f,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:lt(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:u,supportsExceedsLimitStatistics:lt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:lt(e,"supportsAsyncConvert3D",!1)}}function wTt(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,a=e?.includes("MapServer"),o=!a||n>=ie("mapserver-pbf-version-support"),l=pq(e),u=new Set((t.supportedQueryFormats??"").split(",").map(d=>d.toLowerCase().trim()));return{maxRecordCount:v3(t,"maxRecordCount",void 0),maxRecordCountFactor:v3(t,"maxRecordCountFactor",void 0),maxUniqueIDCount:v3(t,"maxUniqueIDCount",void 0),standardMaxRecordCount:v3(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:pTt(i),supportsCacheHint:lt(i,"supportsQueryWithCacheHint",!1)||OF(i,"query"),supportsCentroid:lt(i,"supportsReturningGeometryCentroid",!1),supportsCentroidOnDegeneratedQuantizedGeometry:l||e==null,supportsCompactGeometry:l,supportsCurrentUser:lt(i,"supportsCurrentUserQueries",!1),supportsDefaultSpatialReference:lt(i,"supportsDefaultSR",!1),supportsDegeneratedQuantizedGeometry:lt(i,"supportsDegeneratedQuantizedGeometry",!1),supportsDisjointSpatialRelationship:lt(i,"supportsDisjointSpatialRel",!1),supportsDistance:lt(i,"supportsQueryWithDistance",!1),supportsDistinct:lt(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:lt(i,"supportsReturningQueryExtent",!1),supportsFormatPBF:o&&u.has("pbf"),supportsFullTextSearch:lt(i,"supportsFullTextSearch",!1),supportsGeometryProperties:lt(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:lt(i,"supportsHavingClause",!1),supportsHistoricMoment:lt(s,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:lt(i,"supportsMaxRecordCountFactor",!1),supportsOrderBy:lt(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:lt(i,"supportsPagination",!1),supportsPaginationOnAggregatedQueries:lt(i,"supportsPaginationOnAggregatedQueries",!1),supportsPercentileStatistics:lt(i,"supportsPercentileStatistics",!1),supportsQuantization:lt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:lt(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:lt(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:lt(r,"allowOthersToQuery",!0),supportsQueryGeometry:lt(t,"supportsReturningQueryGeometry",!1),supportsResultType:lt(i,"supportsQueryWithResultType",!1),supportsReturnMesh:!!lTt(t.infoFor3D),supportsSpatialAggregationStatistics:lt(i,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:lt(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:lt(t,"useStandardizedQueries",!1),supportsStatistics:lt(i,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:lt(i,"supportsTopFeaturesQuery",!1),supportsTrueCurve:lt(i,"supportsTrueCurve",!1),tileMaxRecordCount:v3(t,"tileMaxRecordCount",void 0)}}function xTt(t){const e=t.advancedQueryCapabilities,i=lt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:lt(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:OF(e,"queryRelated")}}function STt(t){return{supportsCacheHint:OF(t.advancedQueryCapabilities,"queryTopFilter")}}function TTt(t){const e=t?t.queryBinsCapabilities:void 0;return{supportsDate:lt(e,"supportsDateBin",!1),supportsFixedInterval:lt(e,"supportsFixedIntervalBin",!1),supportsAutoInterval:lt(e,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:lt(e,"supportsFixedBoundariesBin",!1),supportsStackBy:lt(e,"supportsStackBy",!1),supportsSplitBy:lt(e,"supportsSplitBy",!1),supportsSnapToData:lt(e,"supportsSnapToData",!1),supportsReturnFullIntervalBin:lt(e,"supportsReturnFullIntervalBin",!1),supportsFirstDayOfWeek:lt(e,"supportsFirstDayOfWeek",!1),supportsNormalization:lt(e,"supportsNormalization",!1),supportedStatistics:fTt(e),supportedNormalizationTypes:mTt(e)}}function $Tt(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:lt(t,"allowGeometryUpdates",!0),supportsGlobalId:lt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:lt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:lt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:lt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:lt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:lt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:lt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:lt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:lt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:lt(i,"supportsAsyncApplyEdits",!1),zDefault:v3(t,"zDefault",void 0)}}function hfi(t){return{operations:{supportsAppend:lt(t,"supportsAppend",!1),supportsCoverageQuery:t?.playbackInfo?.klv["0601"]??!1,supportsExportClip:lt(t,"supportsExportClip",!1),supportsExportFrameset:lt(t,"supportsExportFrameset",!1),supportsMensuration:lt(t,"supportsMensuration",!1),supportsPreviews:lt(t,"supportsPreviews",!1),supportsUpdate:lt(t,"supportsUpdate",!1)}}}let hv=class extends nt(ae){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=z7(e[r]);return i}writeDomains(e,i){if(!e)return;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=e[s]?.toJSON());i.domains=r}};c([p({type:Number,json:{write:!0}})],hv.prototype,"code",void 0),c([p({type:Object,json:{write:!0}})],hv.prototype,"defaultValues",void 0),c([p({json:{write:!0}})],hv.prototype,"domains",void 0),c([Oe("domains")],hv.prototype,"readDomains",null),c([Ie("domains")],hv.prototype,"writeDomains",null),c([p({type:String,json:{write:!0}})],hv.prototype,"name",void 0),hv=c([R("esri.layers.support.Subtype")],hv);const CTt=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.fieldsIndex=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(ke.ofType(fg)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=Me.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.uniqueIdFields=null,this.url=null,this.version=void 0,this._isUrlHostModified=!1,this._isUrlHostModificationEnabled=!1}getFieldDomain(r,s){throw new Error("Not implemented")}getField(r){return this.fieldsIndex.get(r)}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:r}=this;if(r){const{query:n,operations:a,editing:o}=r;if(!n.supportsQueryByOthers||!n.supportsQueryByAnonymous||a.supportsEditing&&!(o.supportsUpdateByOthers&&o.supportsUpdateByAnonymous&&o.supportsDeleteByOthers&&o.supportsDeleteByAnonymous))return"load"}if(iG(this.serviceDefinitionExpression)||iG(this.definitionExpression))return"load";if(this.userHasUpdateItemPrivileges){if(KSt(this))return"load";if(this.hasUpdateItemRestrictions)return r.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const s=this.editFieldsInfo;return(s?.creatorField||s?.editorField)&&r?.operations.supportsEditing?"editing":null}readCapabilitiesFromService(r,s){return EVe(s,this.url)}readEditingInfo(r,s){const{editingInfo:n}=s;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}get effectiveCapabilities(){const r=this.capabilities;if(!r)return null;const s=se(r),{operations:n,editing:a}=s;return eB(this)?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),s):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=a.supportsDeleteByOthers=a.supportsGeometryUpdate=a.supportsUpdateByOthers=!0,s):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=a.supportsGeometryUpdate=!0),s)}get effectiveEditingEnabled(){return!1}readGlobalIdFieldFromService(r,s){return yVe(s)}get hasFullEditingRestrictions(){const r=this.capabilities;if(!r||eB(this))return!1;const{operations:s,editing:n}=r;return s.supportsEditing&&!(s.supportsAdd&&s.supportsDelete&&s.supportsUpdate&&n.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const r=this.capabilities;if(!r)return!1;const{operations:s,editing:n}=r;return eB(this)?!s.supportsQuery:!(s.supportsAdd&&s.supportsDelete&&s.supportsEditing&&s.supportsQuery&&s.supportsUpdate&&n.supportsDeleteByOthers&&n.supportsGeometryUpdate&&n.supportsUpdateByOthers)}readIsTableFromService(r,s){return s.type==="Table"}readMaxScale(r,s){return s.effectiveMaxScale||r||0}readMinScale(r,s){return s.effectiveMinScale||r||0}readObjectIdFieldFromService(r,s){return vVe(s)}get parsedUrl(){return sTt(this)}readServiceDefinitionExpression(r,s){return s.definitionQuery||s.definitionExpression}readUniqueIdFields(r,s){return s.uniqueIdInfo?.OIDFieldContainsHashValue?s.uniqueIdInfo.fields:null}readVersion(r,s){return qSt(s)}get isUrlHostModified(){const{loaded:r,url:s,_isUrlHostModified:n}=this;if(n)return!0;if(!r||!s||this.originIdOf("url")<7)return!1;const a=this.sourceJSON?.preferredHost;if(!a||!Ng(s,`https://${a}`,!0))return!1;for(let o=6;o>=3;o--){const l=this.getAtOrigin("url",T5(o));if(l)return!Ng(s,l,!0)}return!1}applyPreferredHost(r){const{url:s,portalItem:n}=this;!s||rie(n)}applyHostFromPortalItem(){const{url:r,portalItem:s}=this;if(!r||this.originIdOf("url")===7||!s?.url||!rie(s)||!yw(s,U0.HOSTED_SERVICE)||Ng(r,s.url,!0)||!this._isUrlHostModificationEnabled)return;const n=Wrt(s.url);this._set("url",CRe(r,n)),this._isUrlHostModified=!0}};return c([p({readOnly:!0})],i.prototype,"authenticationTriggerEvent",null),c([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],i.prototype,"copyright",void 0),c([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","isDataBranchVersioned","isDataVersioned","maxRecordCount","maxRecordCountFactor","maxUniqueIDCount","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],i.prototype,"capabilities",void 0),c([Oe("service","capabilities")],i.prototype,"readCapabilitiesFromService",null),c([p(Mq("dateFieldsTimeReference"))],i.prototype,"dateFieldsTimeZone",void 0),c([p({type:Boolean})],i.prototype,"datesInUnknownTimezone",void 0),c([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],i.prototype,"definitionExpression",void 0),c([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],i.prototype,"displayField",void 0),c([p({readOnly:!0,type:uv})],i.prototype,"editFieldsInfo",void 0),c([p({readOnly:!0})],i.prototype,"editingInfo",void 0),c([Oe("editingInfo")],i.prototype,"readEditingInfo",null),c([p({readOnly:!0})],i.prototype,"effectiveCapabilities",null),c([p()],i.prototype,"effectiveEditingEnabled",null),c([p((()=>{const r=se(y2t),s=r.json.origins;return s["web-map"]={read:!1,write:!1},s["portal-item"]={read:!1,write:!1},r})())],i.prototype,"elevationInfo",void 0),c([p()],i.prototype,"fieldsIndex",void 0),c([p({type:y3,json:{name:"layerDefinition.floorInfo",write:{layerContainerTypes:Es}}})],i.prototype,"floorInfo",void 0),c([p({type:It,json:{origins:{service:{read:{source:"extent"}}}}})],i.prototype,"fullExtent",void 0),c([p()],i.prototype,"gdbVersion",void 0),c([p({readOnly:!0,type:g3,json:{read:{source:"geometryProperties"}}})],i.prototype,"geometryFieldsInfo",void 0),c([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:fne.read}}}})],i.prototype,"geometryType",void 0),c([p({type:String})],i.prototype,"globalIdField",void 0),c([Oe("service","globalIdField",["globalIdField","fields"])],i.prototype,"readGlobalIdFieldFromService",null),c([p({readOnly:!0})],i.prototype,"hasFullEditingRestrictions",null),c([p({type:Boolean,json:{origins:{service:{read:!0}}}})],i.prototype,"hasM",void 0),c([p({readOnly:!0})],i.prototype,"hasUpdateItemRestrictions",null),c([p({type:Boolean,json:{origins:{service:{read:!0}}}})],i.prototype,"hasZ",void 0),c([p({readOnly:!0,type:Bo})],i.prototype,"heightModelInfo",void 0),c([p({type:Date})],i.prototype,"historicMoment",void 0),c([p({type:ke.ofType(fg),readOnly:!0})],i.prototype,"indexes",void 0),c([p({readOnly:!0})],i.prototype,"isTable",void 0),c([Oe("service","isTable",["type"])],i.prototype,"readIsTableFromService",null),c([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],i.prototype,"layerId",void 0),c([p(w2t)],i.prototype,"maxScale",void 0),c([Oe("service","maxScale",["maxScale","effectiveMaxScale"])],i.prototype,"readMaxScale",null),c([p(b2t)],i.prototype,"minScale",void 0),c([Oe("service","minScale",["minScale","effectiveMinScale"])],i.prototype,"readMinScale",null),c([p({type:String})],i.prototype,"objectIdField",void 0),c([Oe("service","objectIdField",["objectIdField","fields"])],i.prototype,"readObjectIdFieldFromService",null),c([p({readOnly:!0})],i.prototype,"parsedUrl",null),c([p(Mq("preferredTimeReference"))],i.prototype,"preferredTimeZone",void 0),c([p({type:[Sh],readOnly:!0})],i.prototype,"relationships",void 0),c([p({type:Boolean})],i.prototype,"returnM",void 0),c([p({type:Boolean})],i.prototype,"returnZ",void 0),c([p({readOnly:!0,json:{write:!1}})],i.prototype,"serverGens",void 0),c([p({readOnly:!0})],i.prototype,"serviceDefinitionExpression",void 0),c([Oe("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],i.prototype,"readServiceDefinitionExpression",null),c([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],i.prototype,"serviceItemId",void 0),c([p()],i.prototype,"sourceJSON",void 0),c([p({type:Me,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],i.prototype,"spatialReference",void 0),c([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],i.prototype,"subtypeField",void 0),c([p({type:[hv],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],i.prototype,"subtypes",void 0),c([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],i.prototype,"trackIdField",void 0),c([p({type:[String],readOnly:!0})],i.prototype,"uniqueIdFields",void 0),c([Oe("service","uniqueIdFields",["uniqueIdInfo.OIDFieldContainsHashValue","uniqueIdInfo.fields"])],i.prototype,"readUniqueIdFields",null),c([p(rTt({nonStandardUrlAllowed:!0}))],i.prototype,"url",void 0),c([p({json:{origins:{service:{read:!0}},read:!1}})],i.prototype,"version",void 0),c([Oe("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],i.prototype,"readVersion",null),c([p({readOnly:!0})],i.prototype,"isUrlHostModified",null),i=c([R("esri.layers.mixins.FeatureLayerBase")],i),i};let MTt=class extends H5{constructor(e){super(),this.type="aggregate",this.featureReductionProvider=e}get id(){return this.featureReductionProvider.id}get[bF](){const e=this.featureReductionProvider.featureReduction;return e&&"popupTemplate"in e?e:null}},nw=class extends nt(ae){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};c([p({type:String,json:{write:!0}})],nw.prototype,"expression",void 0),c([p({type:String,json:{write:!0}})],nw.prototype,"title",void 0),c([p({type:String,json:{write:!0}})],nw.prototype,"returnType",void 0),nw=c([R("esri.layers.support.ExpressionInfo")],nw);var gne,NA;let Ul=(NA=class extends ae{constructor(e){super(e),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new gne({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:se(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}},gne=NA,NA);c([p({type:Boolean,json:{write:!0}})],Ul.prototype,"isAutoGenerated",void 0),c([p({type:String,json:{write:!0}})],Ul.prototype,"name",void 0),c([p({type:String,json:{write:!0}})],Ul.prototype,"alias",void 0),c([p({type:String,json:{write:!0}})],Ul.prototype,"onStatisticField",void 0),c([p({type:nw,json:{write:!0}})],Ul.prototype,"onStatisticExpression",void 0),c([p({type:String,json:{write:!0}})],Ul.prototype,"statisticType",void 0),Ul=gne=c([R("esri.layers.support.AggregateField")],Ul);let Iw=class extends ae{constructor(){super(...arguments),this.type=null}};c([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Iw.prototype,"type",void 0),Iw=c([R("esri.layers.support.FeatureReduction")],Iw);const Ahe="__begin__",Ohe="__end__",ETt=new RegExp(Ahe,"ig"),ATt=new RegExp(Ohe,"ig"),V2e=new RegExp("^"+Ahe,"i"),j2e=new RegExp(Ohe+"$","i"),rG='"',OTt=rG+" + ",PTt=" + "+rG;function RTt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function ITt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function tH(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=RTt(t.labelExpression),e.type="conventional"),e}function DTt(t){const e=tH(t);if(!e)return null;switch(e.type){case"conventional":return yne(e.expression);case"arcade":return e.expression}return null}function kTt(t){const e=tH(t);if(!e)return null;switch(e.type){case"conventional":return FTt(e.expression);case"arcade":return Phe(e.expression)}return null}function yne(t){let e;return t?(e=Q0(t,i=>Ahe+'$feature["'+i+'"]'+Ohe),e=V2e.test(e)?e.replace(V2e,""):rG+e,e=j2e.test(e)?e.replace(j2e,""):e+rG,e=e.replaceAll(ETt,OTt).replaceAll(ATt,PTt)):e='""',e}const LTt=/^\s*\{([^}]+)\}\s*$/i;function FTt(t){return t?.match(LTt)?.[1].trim()||null}const zTt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,NTt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,VTt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function Phe(t){if(!t)return null;let e=zTt.exec(t)||NTt.exec(t);return e?e[1]||e[3]:(e=VTt.exec(t),e?e[2]:null)}var vne,VA;let jv=(VA=class extends ae{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,i){return i.value?yne(i.value):e}writeExpression(e,i,r){this.value!=null&&(e=yne(this.value)),e!=null&&(i[r]=e)}clone(){return new vne({expression:this.expression,title:this.title,value:this.value})}},vne=VA,VA);c([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],jv.prototype,"expression",void 0),c([Oe("expression",["expression","value"])],jv.prototype,"readExpression",null),c([Ie("expression")],jv.prototype,"writeExpression",null),c([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],jv.prototype,"title",void 0),c([p({json:{read:!1,write:!1}})],jv.prototype,"value",void 0),jv=vne=c([R("esri.layers.support.LabelExpressionInfo")],jv);var _ne;const yV=new ii({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function vV(t,e,i){return{enabled:!iie(i?.layer)}}function AVe(t){return!t||t.origin!=="service"&&t.layer?.type!=="map-image"}function jTt(t){return t?.type==="map-image"}function OVe(t){return!!jTt(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function UTt(t){return AVe(t)||OVe(t?.layer)}var jA;let Js=(jA=class extends ae{static evaluateWhere(e,i){const r=(s,n,a)=>{switch(n){case"=":return s==a;case"<>":return s!=a;case">":return s>a;case">=":return s>=a;case"<":return s<a;case"<=":return s<=a}return!1};try{if(e==null)return!0;const s=e.split(" ");if(s.length===3)return r(i[s[0]],s[1],s[2]);if(s.length===7){const n=r(i[s[0]],s[1],s[2]),a=s[3],o=r(i[s[4]],s[5],s[6]);switch(a){case"AND":return n&&o;case"OR":return n||o}}return!1}catch{}}constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=cSt,this.useCodedValues=void 0,this.where=null}readLabelExpression(e,i){const r=i.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,i,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=ITt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const s=Phe(this.labelExpressionInfo.expression);s&&(e="["+s+"]")}}e!=null&&(i[r]=e)}writeLabelExpressionInfo(e,i,r,s){if(e==null&&this.labelExpression!=null&&AVe(s))e=new jv({expression:this.getLabelExpressionArcade()});else if(!e)return;const n=e.toJSON(s);n.expression&&(i[r]=n)}writeMaxScale(e,i){(e||this.minScale)&&(i.maxScale=e)}writeMinScale(e,i){(e||this.maxScale)&&(i.minScale=e)}getLabelExpression(){return tH(this)}getLabelExpressionArcade(){return DTt(this)}getLabelExpressionSingleField(){return kTt(this)}hash(){return JSON.stringify(this)}clone(){return new _ne({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:se(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:se(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}},_ne=jA,jA);c([p({type:String,json:{write:!0}})],Js.prototype,"name",void 0),c([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:vV}}}}})],Js.prototype,"allowOverrun",void 0),c([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:vV}}}}})],Js.prototype,"deconflictionStrategy",void 0),c([p({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&i?.origin==="service"&&OVe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],Js.prototype,"labelExpression",void 0),c([Oe("labelExpression")],Js.prototype,"readLabelExpression",null),c([Ie("labelExpression")],Js.prototype,"writeLabelExpression",null),c([p({type:jv,json:{write:{overridePolicy:(t,e,i)=>UTt(i)?{allowNull:!0}:{enabled:!1}}}})],Js.prototype,"labelExpressionInfo",void 0),c([Ie("labelExpressionInfo")],Js.prototype,"writeLabelExpressionInfo",null),c([p({type:yV.apiValues,json:{type:yV.jsonValues,read:yV.read,write:yV.write}})],Js.prototype,"labelPlacement",void 0),c([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Js.prototype,"labelPosition",void 0),c([p({type:Number})],Js.prototype,"maxScale",void 0),c([Ie("maxScale")],Js.prototype,"writeMaxScale",null),c([p({type:Number})],Js.prototype,"minScale",void 0),c([Ie("minScale")],Js.prototype,"writeMinScale",null),c([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:vV}}}}})],Js.prototype,"repeatLabel",void 0),c([p({type:Number,cast:mr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:vV}}}}})],Js.prototype,"repeatLabelDistance",void 0),c([p({types:Rgt,json:{origins:{"web-scene":{types:Igt,write:M2e,default:null}},write:M2e,default:null}})],Js.prototype,"symbol",void 0),c([p({type:Boolean,json:{write:!0}})],Js.prototype,"useCodedValues",void 0),c([p({type:String,json:{write:!0}})],Js.prototype,"where",void 0),Js=_ne=c([R("esri.layers.support.LabelClass")],Js);var bne;let Af=bne=class extends ae{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new bne({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};c([p({type:String,json:{write:!0}})],Af.prototype,"description",void 0),c([p({type:String,json:{write:!0}})],Af.prototype,"label",void 0),c([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Af.prototype,"minValue",void 0),c([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Af.prototype,"maxValue",void 0),c([p(xhe)],Af.prototype,"symbol",void 0),Af=bne=c([R("esri.renderers.support.ClassBreakInfo")],Af);var wne;const PVe="log",tB="percent-of-total",iB="field",_V=new ii({esriNormalizeByLog:PVe,esriNormalizeByPercentOfTotal:tB,esriNormalizeByField:iB}),BTt=en(Af);let fa=wne=class extends $P(qh){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new Af;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(re.getLogger(this).error(".field: field must be a string value"),null):ZL(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&iB||i&&tB||null,e&&i&&re.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==iB&&t!==tB||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new Af({minValue:t,maxValue:e,symbol:HLe(i)}):BTt(se(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&e?.arcade==null&&re.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await p1()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&e?.arcade==null)return void re.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&e?.arcade==null){const s=await p1(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}get symbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new wne({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:se(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:se(this.visualVariables),legendOptions:se(this.legendOptions),authoringInfo:se(this.authoringInfo)})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.symbols.map(r=>r.collectRequiredFields(t,e)),ic(t,e,null,this.valueExpression)];ec(t,e,this.field),ec(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:a}=e??{},{valueExpression:o}=this;let l=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const u=n.arcadeUtils;if(!l){const f=u.createSyntaxTree(o);l=u.createFunction(f),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=o;const d=u.executeFunction(l,u.createExecContext(t,u.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),a));return this._getBreakIndexfromInfos(d)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,a=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===PVe)s=Math.log(s)*Math.LOG10E;else if(r!==tB||n==null||isNaN(n)){if(r===iB&&!isNaN(a)){if(isNaN(s)||isNaN(a))return-1;s/=a}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};c([p(She)],fa.prototype,"backgroundFillSymbol",void 0),c([p({type:[Af],json:{write:{isRequired:!0}}})],fa.prototype,"classBreakInfos",void 0),c([Oe("classBreakInfos")],fa.prototype,"readClassBreakInfos",null),c([Ie("classBreakInfos")],fa.prototype,"writeClassBreakInfos",null),c([p({type:String,json:{write:!0}})],fa.prototype,"defaultLabel",void 0),c([p(K7)],fa.prototype,"defaultSymbol",void 0),c([p({type:String,json:{write:!0}})],fa.prototype,"field",void 0),c([wi("field")],fa.prototype,"castField",null),c([p({type:Boolean})],fa.prototype,"isMaxInclusive",void 0),c([p({type:The,json:{write:!0}})],fa.prototype,"legendOptions",void 0),c([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],fa.prototype,"minValue",null),c([p({type:String,json:{write:!0}})],fa.prototype,"normalizationField",void 0),c([p({type:Number,json:{write:!0}})],fa.prototype,"normalizationTotal",void 0),c([p({type:_V.apiValues,value:null,json:{type:_V.jsonValues,read:_V.read,write:_V.write}})],fa.prototype,"normalizationType",null),c([st({classBreaks:"class-breaks"})],fa.prototype,"type",void 0),c([p({type:String,json:{write:!0}})],fa.prototype,"valueExpression",void 0),c([p({type:String,json:{write:!0}})],fa.prototype,"valueExpressionTitle",void 0),fa=wne=c([R("esri.renderers.ClassBreaksRenderer")],fa);const xne=-3,RVe=xne-1,qTt=!!ie("esri-tests-disable-gpu-memory-measurements");let GTt=class{constructor(e,i,r,s=0){this.name=e,this._storage=i,this.removeFunc=r,this._defaultPriority=s,this.id=`${WTt++}${rB}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=HTt}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}set maxSize(e){this._storage.setMaxSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r=this._defaultPriority){this._storage.put(this,e,i,i.usedMemory,r)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e){this._storage.updateSize(this,e)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},Rhe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){return this._db.get(e.id+i)?.size??0}put(e,i,r,s,n){i=e.id+i;const a=this._db.get(i);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(i),a.entry!==r&&this._notifyRemove(i,a.entry,a.size,0)),s>this._maxSize)return void this._notifyRemove(i,r,s,0);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return qTt||console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,0);const o=1+Math.max(n,RVe)-xne;this._db.set(i,new ZTt(r,s,o)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i){i=e.id+i;const r=this._db.get(i);if(!r)return;this._size-=r.size,e.size-=r.size;let s=r.entry.usedMemory;for(;s>this._maxSize;){const n=this._notifyRemove(i,r.entry,s,1);if(!(n!=null&&n>0))return void this._db.delete(i);s=n}r.size=s,this._size+=s,e.size+=s,this._checkSize()}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((a,o)=>{const l=a.lifetime;r[l]=(r[l]||0)+a.size,this._users.forEach(u=>{const{id:d,name:f}=u;if(o.startsWith(d)){const g=i[f]||0;i[f]=g+a.size}})});const s={};this._users.forEach(a=>{const o=a.name;if("hitRate"in a&&typeof a.hitRate=="number"&&!isNaN(a.hitRate)&&a.hitRate>0){const l=i[o]||0;i[o]=l,s[o]=Math.round(100*a.hitRate)+"%"}else s[o]="0%"});const n=Object.keys(i);n.sort((a,o)=>i[o]-i[a]),n.forEach(a=>e[a]=Math.round(i[a]/2**20)+"MB / "+s[a]);for(let a=r.length-1;a>=0;--a){const o=r[a];o&&(e["Priority "+(a+xne-1)]=Math.round(o/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,0))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,0)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}*values(e){for(const[i,r]of this._db)i.startsWith(e.id)&&(yield r.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){const n=this._users.get(e.split(rB)[0])?.removeFunc,a=n?.(i,s,r);return typeof a=="number"?a:null}_checkSize(){this._sizeLimits.forEach((e,i)=>this._checkSizeLimits(e,i)),this._checkSizeLimits(this.maxSize)}setMaxSize(e,i){i==null||i<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,i)}_checkSizeLimits(e,i){const r=i??this;if(r.size<=e)return;const s=i?.id;let n=!0;for(;n;){n=!1;for(const[a,o]of this._db)if(o.lifetime===0&&(!s||a.startsWith(s))){const l=i??this._users.get(a.split(rB)[0]);if(this._purgeItem(a,o,l),r.size<=.9*e)return;n||=this._db.has(a)}}for(const[a,o]of this._db)if(!s||a.startsWith(s)){const l=i??this._users.get(a.split(rB)[0]);if(this._purgeItem(a,o,l),r.size<=.9*e)return}}_purgeItem(e,i,r){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,1);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}};const HTt=new Rhe(0);let WTt=0,ZTt=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}};const rB=":";let Ihe=class{constructor(e,i){this.removeFunc=i,this._storage=new Rhe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy(),this._storage=null}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},U2e=class IVe{static parse(e,i,r){const s=[],n=[],a=e.split(";");for(let o=0;o<a.length;o++){const l=a[o];if(l){if(l.includes("po:")){const u=l.slice(3).split("|");if(u.length===3){const[d,f,g]=u,v=JTt(d,f,g);v&&n.push(v)}continue}if(l.includes("|")){for(const u of l.split("|"))if(i.has(u)){s.push(u);break}}else if(i.has(l))s.push(l);else if(o===0){s.length=0,s.push(QTt(r));break}}}return new IVe(s,n)}constructor(e,i){this.partNames=e,this.overrides=i}};function YTt(t,e){if(t==="DashTemplate")return e.split(" ").map(i=>Number(i));if(t==="Color"){const i=new Je(e).toRgba();return[i[0],i[1],i[2],255*i[3]]}return Number(e)}function JTt(t,e,i){return{primitiveName:t,propertyName:e,value:YTt(e,i),defaultValue:null}}function QTt(t){switch(t){case"esriGeometryPolyline":return"Invalid_L";case"esriGeometryPolygon":return"Invalid_A";default:return"Invalid_P"}}var UA;let Cg=(UA=class{},UA.instance=new Hu("Etc/UTC"),UA);function XTt(t){return t instanceof S$?t===Cg.instance:t?.toString().toLowerCase()==="unknown"}function bfi(t){return XTt(t)?Cg.instance:t}function KTt(t){return"timeZone"in t}function e$t(t){return"timeZone"in t}function t$t(t){return"dateFieldsTimeZone"in t}const i$t=new Map;let sG=class sB{static fromJSON(e){return new sB(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new sB(e.fields??[],q2e(e))}static fromLayerJSON(e){return new sB(e.fields??[],q2e(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const s of this.fields){const n=s?.name,a=B2e(n);if(n&&a){const o=U2(n);this._fieldsMap.set(n,s),this._fieldsMap.set(o,s),this._normalizedFieldsMap.set(a,s),r.push(`${o}:${s.type}:${this._timeZoneByFieldName?.get(n)}`),bue(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):_F(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),Kwe(s)||e1e(s)||(s.editable=s.editable==null||!!s.editable,s.nullable=s.nullable==null||!!s.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Kwe(e)||e1e(e)||e.nullable||Yft(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(U2(e))??this._normalizedFieldsMap.get(B2e(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(re.getLogger("esri.layers.support.FieldsIndex").errorOnce(new q("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),a1):DVe.has(i.type)?n1:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===n1?Cg.instance:i===a1?Xa.utcInstance:Fu(i$t,i,()=>Hu.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return G5e(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>$5(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function U2(t){return t.trim().toLowerCase()}function B2e(t){return kft(t)?.toLowerCase()??""}const DVe=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function q2e(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:s}=t,n=(r?"startField"in r?r.startField:r.startTimeField:"")??"",a=(r?"endField"in r?r.endField:r.endTimeField:"")??"",o=t$t(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?tU(t.dateFieldsTimeReference):null,l=s?KTt(s)?s.timeZone??o:s.dateFieldsTimeReference?tU(s.dateFieldsTimeReference):o??a1:null,u=r?e$t(r)?r.timeZone??o:r.timeReference?tU(r.timeReference):o:null,d=new Map([[U2(s?.creationDateField??""),l],[U2(s?.editDateField??""),l],[U2(n),u],[U2(a),u]]);for(const{name:f,type:g}of t.fields)if(DVe.has(g))e.set(f,n1);else if(g!=="date"&&g!=="esriFieldTypeDate")e.set(f,null);else if(i)e.set(f,n1);else{const v=d.get(U2(f??""))??o;e.set(f,v)}return e}const kVe={TypeNotAllowedInFeature:"Feature attributes only support dates, numbers, strings, guids.",LogicError:"Logic error - {reason}",CannotCompareDateAndTime:"Cannot compare date or dateonly with timeonly types",NeverReach:"Encountered unreachable logic",AsyncNotEnabled:"Async Arcade must be enabled for this script",ModuleAccessorMustBeString:"Module accessor must be a string",ModuleExportNotFound:"Module has no export with provided identifier",ModulesNotSupported:"Current profile does not support modules",ArrayAccessMustBeNumber:"Array accessor must be a number",FunctionNotFound:"Function not found",FieldNotFound:"Key not found - {key}",CircularModules:"Circular module dependencies are not allowed",Cancelled:"Execution cancelled",UnsupportedHashType:"Type not supported in hash function",IllegalResult:"Value is not a supported return type",PortalRequired:"Portal is required",InvalidParameter:"Invalid parameter",WrongNumberOfParameters:"Call with wrong number of parameters",Unrecognized:"Unrecognized code structure",UnrecognizedType:"Unrecognized type",WrongSpatialReference:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",BooleanConditionRequired:"Conditions must use booleans",NoFunctionInDictionary:"Dictionaries cannot contain functions.",NoFunctionInArray:"Arrays cannot contain functions.",NoFunctionInTemplateLiteral:"Template Literals do not expect functions by value.",KeyAccessorMustBeString:"Accessor must be a string",KeyMustBeString:"Object keys must be a string",Immutable:"Object is immutable",UnexpectedToken:"Unexpected token",MemberOfNull:"Cannot access property of null object",MaximumCallDepth:"Exceeded maximum function depth",OutOfBounds:"Out of bounds",InvalidIdentifier:"Identifier not recognized",CallNonFunction:"Expression is not a function",InvalidMemberAccessKey:"Cannot access value using a key of this type",AssignModuleFunction:"Cannot assign function to module variable",UnsupportUnaryOperator:"Unsupported unary operator",UnsupportedOperator:"Unsupported operator",LogicalExpressionOnlyBoolean:"Logical expressions must be boolean",LogicExpressionOrAnd:"Logical expression can only be combined with || or &&",CannotChangeTimeZoneTime:"Cannot change the timezone of a Time",CannotChangeTimeZoneDateOnly:"Cannot change the timezone of a DateOnly",FeatureSetDoesNotHaveSubtypes:"FeatureSet does not have subtypes"};let r$t=class extends Error{constructor(...e){super(...e)}},G2e=class LVe extends r$t{constructor(e,i){super(Dhe(i)+e.message,{cause:e}),this.loc=null,Error.captureStackTrace&&Error.captureStackTrace(this,LVe),i?.loc&&(this.loc=i.loc)}},s$t=class FVe extends Error{constructor(e,i,r,s){super("Execution error - "+Dhe(r)+Q0(kVe[i],s)),this.loc=null,this.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(this,FVe),r?.loc&&(this.loc=r.loc)}};function Dhe(t){return t&&t.loc?`Line : ${t.loc.start?.line}, ${t.loc.start?.column}: `:""}let xfi=class zVe extends Error{constructor(e,i,r,s){super("Compilation error - "+Dhe(r)+Q0(kVe[i],s)),this.loc=null,this.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(this,zVe),r?.loc&&(this.loc=r.loc)}},Sfi=class NVe extends Error{constructor(){super("Uncompilable code structures"),this.declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(this,NVe)}};function Tfi(t,e,i){return i.declaredRootClass==="esri.arcade.arcadeexecutionerror"||i.declaredRootClass==="esri.arcade.arcadecompilationerror"?i.loc===null&&e?.loc?new G2e(i,{cause:i}):i:(i.declaredRootClass==="esri.arcade.featureset.support.featureseterror"||i.declaredRootClass==="esri.arcade.featureset.support.sqlerror"||i.declaredRootClass,e?.loc?new G2e(i,{cause:i}):i)}const n$t={UnrecognizedUri:"Unrecognized uri - {uri}",UnsupportedUriProtocol:"Unrecognized uri protocol"};let $fi=class VVe extends Error{constructor(e,i){super(Q0(n$t[e],i)),this.declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(this,VVe)}};function nB(t){return t.toLowerCase().replaceAll(/[\s-]+/g,"")}let Cfi=class{constructor(e,i){const r=new Map;for(const s of e){const n=nB(s);if(r.has(n))throw new Error(`${s} already added as ${r.get(n)}`);r.set(n,s)}if(i!=null)for(const[s,n]of i){const a=nB(s);if(r.has(a))throw new Error(`${s} already associated with ${r.get(a)}`);r.set(a,n)}this._enumMap=r}lookup(e){return this._enumMap.get(nB(e))}get(e){const i=this.lookup(e);if(i==null)throw new s$t(null,"InvalidParameter",null);return i}};const a$t={TimeZoneNotRecognized:"Timezone identifier has not been recognized."};let o$t=class jVe extends Error{constructor(e,i){super(Q0(a$t[e],i)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,jVe)}};function LC(t,e,i){return t<e?t-e:t>i?t-i:0}function FC(t,e,i){return t<e?e:t>i?i:t}let c0=class da{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,i=1,r=1,s=0,n=0,a=0,o=0,l){if(isNaN(e)||isNaN(i)||isNaN(r)||isNaN(s)||isNaN(n)||isNaN(a)||isNaN(o))return null;const u=gt.local(e,i).daysInMonth;let d=gt.fromObject({day:FC(r,1,u),year:e,month:FC(i,1,12),hour:FC(s,0,23),minute:FC(n,0,59),second:FC(a,0,59),millisecond:FC(o,0,999)},{zone:wg(l)});return d=d.plus({months:LC(i,1,12),days:LC(r,1,u),hours:LC(s,0,23),minutes:LC(n,0,59),seconds:LC(a,0,59),milliseconds:LC(o,0,999)}),new da(d)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,i){const r=wg(i);return e.isUnknownTimeZone||r===Cg.instance?da.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new da(e._date.setZone(r))}static dateJSToArcadeDate(e){return new da(gt.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,i="system"){const r=wg(i);return new da(gt.fromJSDate(e,{zone:r}))}static unknownEpochToArcadeDate(e){return new da(gt.fromMillis(e,{zone:Cg.instance}))}static unknownDateJSToArcadeDate(e){return new da(gt.fromMillis(e.getTime(),{zone:Cg.instance}))}static epochToArcadeDate(e,i="system"){const r=wg(i);return new da(gt.fromMillis(e,{zone:r}))}static dateTimeToArcadeDate(e){return new da(e)}clone(){return new da(this._date)}changeTimeZone(e){const i=wg(e);return da.dateTimeToArcadeDate(this._date.setZone(i))}static dateTimeAndZoneToArcadeDate(e,i){const r=wg(i);return e.zone===Cg.instance||r===Cg.instance?da.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new da(e.setZone(r))}static nowToArcadeDate(e){const i=wg(e);return new da(gt.fromJSDate(new Date,{zone:i}))}static nowUTCToArcadeDate(){return new da(gt.utc())}get isSystem(){return this.timeZone==="system"||this.timeZone===da.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===Cg.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if(this._date.zone.type==="system")return"system";const e=this.zone;return e.type==="fixed"?e.fixed===0?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new da(this._date.plus(e))}diff(e,i){return this._date.diff(e._date,i)[i]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,i){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:i&&!this.isUnknownTimeZone})}toFormat(e,i){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,i)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new da(this._date.toUTC())}toLocal(){return new da(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const i=gt.fromISO(e,{setZone:!0});return new da(i)}};function wg(t,e=!0){if(t instanceof S$)return t;switch(nB(t)){case"system":return"system";case"utc":return"UTC";case"unknown":return Cg.instance}if(/^[+-]?[0-9]{1,2}(:[0-9]{2})?$/.test(t)){const r=Xa.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(r)return r}const i=Hu.create(t);if(!i.isValid){if(e)throw new o$t("TimeZoneNotRecognized");return null}return i}function H2e(t){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let e="";const i=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of t.match(i)||[])switch(r){case"D":e+="d";break;case"DD":e+="dd";break;case"DDD":e+="o";break;case"d":e+="c";break;case"ddd":e+="ccc";break;case"dddd":e+="cccc";break;case"M":e+="L";break;case"MM":e+="LL";break;case"MMM":e+="LLL";break;case"MMMM":e+="LLLL";break;case"YY":e+="yy";break;case"Y":case"YYYY":e+="yyyy";break;case"Q":e+="q";break;case"X":case"x":e+=r;break;default:r.length>=2&&r.startsWith("[")&&r.endsWith("]")?e+=`'${r.slice(1,-1)}'`:e+=`'${r}'`}return e}const W2e="esri.core.sql.dateonly";let l$t=class Th{constructor(e,i,r){this._year=e,this._month=i,this._day=r,this.declaredRootClass=W2e}static isDateOnly(e){return typeof e=="object"&&e!=null&&"declaredRootClass"in e&&e.declaredRootClass===W2e}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return Th.isDateOnly(e)&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new Th(this._year,this._month,this._day)}toDateTime(e){return gt.fromObject({day:this.day,month:this.month,year:this.year},{zone:wg(e)})}toDateTimeLuxon(e){return gt.fromObject({day:this.day,month:this.month,year:this.year},{zone:wg(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(e=null,i=!0){if(e===null||e==="")return this.toString();if(i&&(e=H2e(e)),!e)return"";const r=this.toDateTime("unknown");return c0.dateTimeToArcadeDate(r).toFormat(e,{locale:Vu(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return c0.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,i){return Th.fromDateTime(this.toUTCDateTime().plus({[e]:i}))}toUTCDateTime(){return gt.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,i){switch(i.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return i==="M"?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const i=gt.fromMillis(e,{zone:Xa.utcInstance});return i.isValid?Th.fromParts(i.year,i.month,i.day):null}static fromSeconds(e){const i=gt.fromSeconds(e,{zone:Xa.utcInstance});return i.isValid?Th.fromParts(i.year,i.month,i.day):null}static fromReader(e){if(!e)return null;const i=e.split("-");return i.length!==3?null:new Th(parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10))}static fromParts(e,i,r){const s=new Th(e,i,r);return s.isValid===!1?null:s}static fromDateJS(e){return Th.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return Th.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,i=null){if(e===""||e===null)return null;const r=[];if(i)(i=H2e(i))&&r.push(i);else if(i===null||i===""){const s=gt.fromISO(e,{setZone:!0});return s.isValid?Th.fromParts(s.year,s.month,s.day):null}for(const s of r){const n=gt.fromFormat(e,i??s);if(n.isValid)return new Th(n.year,n.month,n.day)}return null}static fromNow(e="system"){const i=gt.fromJSDate(new Date).setZone(wg(e));return new Th(i.year,i.month,i.day)}};function Efi(t){if(t==null)return null;switch(t.type){case"polygon":case"multipoint":case"polyline":return t.extent;case"point":return new It({xmin:t.x,ymin:t.y,xmax:t.x,ymax:t.y,spatialReference:t.spatialReference});case"extent":return t}return null}function Afi(t){if(t==null)return null;const e=t.clone();return t.cache._geVersion!==void 0&&(e.cache._geVersion=t.cache._geVersion),e}function bV(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}function Z2e(t){if(!t)return"";const e=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let i="";for(const r of t.match(e)||[])switch(r){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":i+=r;break;case"A":case"a":i+="a";break;default:i+=`'${r}'`}return i}const Y2e="esri.core.sql.timeonly";let c$t=class ig{constructor(e,i,r,s){this._hour=e,this._minute=i,this._second=r,this._millisecond=s,this.declaredRootClass=Y2e}static isTimeOnly(e){return typeof e=="object"&&e!=null&&"declaredRootClass"in e&&e.declaredRootClass===Y2e}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return ig.isTimeOnly(e)&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new ig(this.hour,this.minute,this.second,this.millisecond)}isValid(){return bV(this.hour)&&bV(this.minute)&&bV(this.second)&&bV(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(e=null){return e===null||e===""?this.toString():(e=Z2e(e))?gt.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:Vu(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,i,r,s){const n=new ig(e,i,r,s);return n.isValid()?n:null}static fromReader(e){if(!e)return null;const i=e.split(":");return i.length!==3?null:new ig(parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const i=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),s=Math.floor(e/36e5%24),n=Math.floor(e%1e3);return new ig(s,r,i,n)}static fromDateJS(e){return new ig(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new ig(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,i=null){if(e===""||e===null)return null;const r=[];i?(i=Z2e(i))&&r.push(i):i!==null&&i!==""||(r.push("HH:mm:ss"),r.push("HH:mm:ss.SSS"),r.push("hh:mm:ss a"),r.push("hh:mm:ss.SSS a"),r.push("HH:mm"),r.push("hh:mm a"),r.push("H:mm"),r.push("h:mm a"),r.push("H:mm:ss"),r.push("h:mm:ss a"),r.push("H:mm:ss.SSS"),r.push("h:mm:ss.SSS a"));for(const s of r){const n=gt.fromFormat(e,s);if(n.isValid)return new ig(n.hour,n.minute,n.second,n.millisecond)}return null}plus(e,i){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return ig.fromDateTime(this.toUTCDateTime().plus({[e]:i}))}return null}toUTCDateTime(){return gt.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,i){switch(i.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return i==="M"?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}};const u$t=["geometry","scale","timeProperties"];function Ofi(t,e){if(e!=null)for(const i of u$t)e.hasArcadeDependency(i)&&t.add(i);return t}function h$t(t,e){return khe.create(t,e,null,["$feature","$view"])}function Pfi(t,e){return khe.create(t,e,null,["$feature","$view"])}function d$t(t,e,i){return khe.create(t,e,i,["$feature","$view","$config"])}let khe=class UVe{static async create(e,i,r,s){const{arcade:n,Dictionary:a}=await p1();let o;try{o=n.parseScript(e)}catch(v){throw new q("arcade-bad-expression","Failed to parse arcade script",{script:e,error:v})}const l=n.scriptUsesGeometryEngine(o);l&&await n.enableGeometrySupport(),await n.loadDependentModules(new Set,o,null,!1,l);const u={vars:s.reduce((v,_)=>({...v,[_]:null}),{}),spatialReference:i,useAsync:!1},d=n.compileScript(o,u);let f=null;r!=null&&(f=new a(r),f.immutable=!0);const g=new a;return g.immutable=!1,g.setField("scale",0),new UVe(e,n,o,d,i,g,f,a)}constructor(e,i,r,s,n,a,o,l){this.script=e,this._arcade=i,this._syntaxTree=r,this._compiled=s,this._spatialReference=n,this._viewDict=a,this._configDict=o,this._dictionaryCtor=l,this._dependencies=new Map,this._featureReader=new BVe,this._dependencies.set("geometry",i.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}evaluate(e,i){const r=i.$view?.timeZone;if(i.$view){let s;if(this._viewDict.setField("scale",i.$view.scale),i.$view.timeProperties!=null){const{currentStart:n,currentEnd:a}=i.$view.timeProperties;s=new this._dictionaryCtor({currentStart:n!=null?r!=null?c0.epochToArcadeDate(n,r):c0.unknownEpochToArcadeDate(n):void 0,currentEnd:a!=null?r!=null?c0.epochToArcadeDate(a,r):c0.unknownEpochToArcadeDate(a):void 0,startIncluded:!0,endIncluded:!0})}this._viewDict.setField("timeProperties",s)}return this._compiled({vars:{$view:this._viewDict,$config:this._configDict,$feature:e},spatialReference:this._spatialReference,timeZone:r})}repurposeFeature(e,i){return this._featureReader.bind(e,i,this._spatialReference),this._featureReader}references(e){return this._dependencies.get(e)??!1}},BVe=class{constructor(){this._boundTarget=null,this._boundSchema={fields:null,fieldsIndex:null,spatialReference:null,get geometryType(){return null},get objectIdField(){return null}},this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}bind(e,i,r){const s=i??new sG(qVe(e.attributes));this._boundTarget=e,this._boundSchema.fields=s.fields,this._boundSchema.fieldsIndex=s,this._boundSchema.spatialReference=r}_getField(e){return this._boundSchema.fieldsIndex.get(e)}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}readArcadeFeature(){return this}hasField(e){return this._boundSchema.fieldsIndex.has(e)}geometry(){if("fromJSON"in this._boundTarget)return this._boundTarget.geometry;const e=wp(this._boundTarget.geometry);if(e){if(!this._boundSchema.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");e.spatialReference=this._boundSchema.spatialReference}return e}_hasGeometry(){return this._boundTarget.geometry!=null}isUnknownDateTimeField(e){return this._boundSchema.fieldsIndex.getTimeZone(e)===n1}field(e,i=!0){const r=this._getField(e);if(r){const s=this._boundTarget.attributes[r.name];if(s==null)return null;switch(r.type){case"date-only":case"esriFieldTypeDateOnly":return l$t.fromReader(s);case"time-only":case"esriFieldTypeTimeOnly":return c$t.fromReader(s);case"esriFieldTypeTimestampOffset":case"timestamp-offset":return c0.fromReaderAsTimeStampOffset(s);case"date":case"esriFieldTypeDate":return this.isUnknownDateTimeField(e)?c0.unknownEpochToArcadeDate(s):c0.epochToArcadeDate(s,this.contextTimeZone??xp);default:return s}}if(i)throw new Error(`Field ${e} does not exist`);return null}setField(e,i){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this._boundSchema.fieldsIndex.fields.map(e=>e.name)}isEmpty(){return this._boundSchema.fields.length<=0&&!this._hasGeometry()}castToText(e=!1){return JSON.stringify(this._boundTarget)}gdbVersion(){return null}fullSchema(){return this._boundSchema}castAsJson(e=null){return{attributes:this._boundTarget.attributes,geometry:e?.keepGeometryType===!0?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,i=null){return Promise.resolve(this.castAsJson(i))}};function qVe(t){const e=[];for(const i in t)e.push({name:i,alias:i,type:typeof t[i]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"});return e}let p$t=class GVe{static async from(e,i,r){const s=e.dictionary_version?MF.parse(e.dictionary_version):null,n=new Set(e.itemsNames),a={};if(i)for(const f in i)a[f]=i[f];if(e.authoringInfo.configuration)for(const f of e.authoringInfo.configuration)a.hasOwnProperty(f.name)||(a[f.name]=f.value);const o=new Set(e.authoringInfo.symbol);for(const f of Object.keys(r))o.delete(f);o.size&&re.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("missing-fields: fieldMap entries for the following symbol fields are missing",{symbolFields:o});const l=await d$t(e.expression,null,a);if(!l)throw new q("dictionary-renderer:expression-error","Unable to create dictionary renderer expression");const u=!s||!s.greaterEqual(4,0);u&&re.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("Dictionary script does not support native field types. Applying fallback",{version:s});const d=new f$t(r,u);return new GVe(u,n,l,d)}constructor(e,i,r,s){this._requiresFieldCoercionToString=e,this._itemNames=i,this._compiled=r,this._reader=s}get itemNames(){return this._itemNames}evaluate(e,i,r,s){try{return this._reader.bind(e,r,s),this._compiled.evaluate(this._reader,{$view:{scale:i}})}catch(n){re.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("arcade: dictionary script evaluation failed",{error:n})}return null}createDictionaryFieldsIndex(e){if(!this._requiresFieldCoercionToString)return new sG(e);const i=e.map(r=>({...r,type:"esriFieldTypeString"}));return new sG(i)}},f$t=class extends BVe{constructor(e,i){super(),this._fieldMap=e,this._requiresFieldCoercionToString=i}_getField(e){const i=this._fieldMap[e]??e;return this._boundSchema.fieldsIndex.get(i)}field(e){if(!this._requiresFieldCoercionToString)return super.field(e,!1);const i=this._getField(e);return i==null||this._boundTarget.attributes[i.name]==null?"":""+this._boundTarget.attributes[i.name]}};const J2e={Relative:0,Absolute:1},m$t={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},Sne={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1,gradientMethod:"AcrossLine",gradientSize:75,gradientSizeUnits:J2e.Relative,gradientType:"Discrete",interval:5},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGradientFill:{enable:!0,angle:90,gradientMethod:"Linear",gradientSize:75,gradientSizeUnits:J2e.Relative,gradientType:"Discrete",interval:5},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRadial:{angle:0,length:5},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0,easing:"Linear"},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0,rotateclockwise:!1},CIMSymbolAnimationOffset:{offsetx:0,offsety:0},CIMSymbolAnimationMoveAlongLine:{speed:30,distanceAlong:100}};function g$t(t){return typeof t=="function"}function Dfi(t,e,i,r){return g$t(t)?t(e,i,r):t}function kfi(t){return[t.r,t.g,t.b,t.a]}const y$t=` /-,
`;function Q2e(t){let e=t.length;for(;e--;)if(!y$t.includes(t.charAt(e)))return!1;return!0}function Lfi(t,e){const i=[];let r=0,s=-1;do if(s=t.indexOf("[",r),s>=r){if(s>r){const n=t.slice(r,s);i.push([n,null,Q2e(n)])}if(r=s+1,s=t.indexOf("]",r),s>=r){if(s>r){const n=e[t.slice(r,s)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<t.length){const n=t.slice(r);i.push([n,null,Q2e(n)])}return i}function Ffi(t,e,i){let r="",s=null;for(const n of e){const[a,o,l]=n;if(a!=null&&a!=="")l?s=a:(s!=null&&(r+=s,s=null),r+=a);else{const u=t.readAttribute(o);u!=null&&u!==""&&(s!==null&&(r+=s,s=null),r+=u)}}return HVe(r,i)}function zfi(t,e,i,r){let s="",n=null;for(const a of e){const[o,l,u]=a;if(o!=null&&o!=="")u?n=o:(n!=null&&(s+=n,n=null),s+=o);else{let d=l;i!=null&&(d=$$t(l,i));const f=t.attributes[d];f!=null&&f!==""&&(n!=null&&(s+=n,n=null),s+=f)}}return HVe(s,r)}function HVe(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function Nfi(t,e,i,r,s,n,a=!0){const o=e/s,l=i/n,u=Math.ceil(o/2),d=Math.ceil(l/2);for(let f=0;f<n;f++)for(let g=0;g<s;g++){const v=4*(g+(a?n-f-1:f)*s);let _=0,x=0,S=0,T=0,M=0,E=0,P=0;const O=(f+.5)*l;for(let D=Math.floor(f*l);D<(f+1)*l;D++){const L=Math.abs(O-(D+.5))/d,F=(g+.5)*o,j=L*L;for(let N=Math.floor(g*o);N<(g+1)*o;N++){let B=Math.abs(F-(N+.5))/u;const U=Math.sqrt(j+B*B);U>=-1&&U<=1&&(_=2*U*U*U-3*U*U+1,_>0&&(B=4*(N+D*e),P+=_*t[B+3],S+=_,t[B+3]<255&&(_=_*t[B+3]/250),T+=_*t[B],M+=_*t[B+1],E+=_*t[B+2],x+=_))}}r[v]=T/x,r[v+1]=M/x,r[v+2]=E/x,r[v+3]=P/S}}function v$t(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function Vfi(t){return t.data?.symbol??null}function jfi(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function Ufi(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function Bfi(t){return t!=null&&(t.type==="CIMGradientFill"||t.type==="CIMHatchFill"||t.type==="CIMPictureFill"||t.type==="CIMSolidFill"||t.type==="CIMWaterFill")}function _$t(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const qfi=(t,e=0)=>t==null||isNaN(t)?e:t,Gfi=(t,e)=>t??e,Hfi=(t,e)=>t??e,Wfi=t=>t.tintColor?v$t(t.tintColor):[255,255,255,1];let b$t=class{constructor(e){this._import=e}getImportPromise(){return this._promise==null&&(this._promise=this._import().then(e=>this.module=e)),this._promise}};function Yfi(t){return new b$t(t)}function Jfi(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function Qfi(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function Xfi(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function Kfi(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function X2e(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=X2e(e);if(i!=null)return i}break;case"CIMTextSymbol":return X2e(t.symbol);case"CIMSolidFill":return t.color}return null}function K2e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=K2e(i);if(r!=null)return r}break}case"CIMTextSymbol":return K2e(t.symbol);case"CIMSolidStroke":return t.color}}function emi(t){for(const e of t)if(e.enable)switch(e.type){case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return!0}return!1}function eSe(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=eSe(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return eSe(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function tmi(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function imi(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function rmi(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const smi=t=>t.includes("data:image/svg+xml");function nmi(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function iH(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}function ami(t,e,i,r,s,n,a=!0){const{infos:o}=n;let l=1,u=0,d=0,f=0,g=1;for(const{absoluteAnchorPoint:x,offsetX:S,offsetY:T,rotation:M,size:E,frameHeight:P,rotateClockWise:O,scaleSymbolsProportionally:D}of o)g=x?1:l,d=iSe(S,T,u,g,d),f=tSe(S,T,u,g,f),P&&(D||a)&&(l*=E/P),u=rSe(M,O,u);const v=iSe(r,s,u,g,d),_=tSe(r,s,u,g,f);return{size:t*l,rotation:rSe(e,i,u),offsetX:v,offsetY:_}}function w$t(t){if(t==null)return!1;if(Array.isArray(t))return t.every(e=>w$t(e));switch(typeof t){case"string":return!!t;case"number":return!isNaN(t)}}function x$t(t,e){if(e==="color"||e==="outlinecolor"||e==="backgroundcolor"||e==="borderlinecolor"||e==="tintcolor")return[...m$t[e]];const i=Sne[t];if(!i)throw new Error(`InternalError: default value for type ${t}.`);return i[e]}function S$t(t){return t.split(" ").map(e=>Number(e))}function T$t(t){return typeof t=="string"?S$t(t):t}function omi(t){return t?.dashTemplate&&(t.dashTemplate=T$t(t.dashTemplate)),t}function Tne(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return Tne(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return Tne(i.symbol)}}return"Normal"}function lmi(t){if(t)switch(t.type){case"CIMTextSymbol":return t.height;case"CIMPointSymbol":{let e=0;if(t.symbolLayers){for(const i of t.symbolLayers)if(i)switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const r=i.size??Sne.CIMVectorMarker.size;r>e&&(e=r);break}}}return e}case"CIMLineSymbol":case"CIMPolygonSymbol":{let e=0;if(t.symbolLayers){for(const i of t.symbolLayers)if(i)switch(i.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const r=i.width;r!=null&&r>e&&(e=r);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(i.markerPlacement&&_$t(i.markerPlacement)){const r=i.size??Sne.CIMVectorMarker.size;r>e&&(e=r)}break;case"CIMPictureFill":{const r=i.height;r!=null&&r>e&&(e=r)}}}return e}}}function $$t(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function cmi(t){return t.map(e=>({...e,propertyName:iH(e.propertyName)}))}function umi(t){const e={};for(const i in t){const r=t[i];e[iH(i)]=r}return e}function tSe(t,e,i,r,s){const n=i*Math.PI/180;if(n){const a=Math.cos(n);return(Math.sin(n)*t+a*e)*r+s}return e*r+s}function iSe(t,e,i,r,s){const n=i*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*r+s:t*r+s}function rSe(t,e,i){return e?i-t:i+t}function hmi(t,e,i){const r=i==="Color"||i==="TintColor"||i==="ToColor",s=i==="Rotation"||i==="Angle"||i==="ToRotation";let n=e[iH(i)];if(n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255]:s&&(n*=Math.PI/180)),n==null&&(n=x$t(e.type,i.toLowerCase()),n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]]:s&&(n*=Math.PI/180))),e.primitiveName!=null){const a=t[e.primitiveName];if(a!=null){const o=a[i];o==null||(typeof o=="string"||typeof o=="number"||Array.isArray(o)?(n=o,n!=null&&(r?n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255]:s&&(n*=Math.PI/180))):(n={valueExpressionInfo:o,defaultValue:n},n!=null&&(r?n={type:"Process",op:"ArcadeColor",value:n}:s&&(n={type:"Process",op:"Divide",left:n,right:180/Math.PI}))))}}if(n==null)throw new Error(`Failed to derive a value or an expression for "${i}".`);return n}function dmi(t,e,i){if(e[iH(i)]!=null)return!0;if(e.primitiveName!=null){const r=t[e.primitiveName];if(r!=null&&r[i]!=null)return!0}return!1}function pmi(t,e){return Math.max(Math.min((t??e)/100,1),0)}const C$t={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let WVe=class{constructor(e,i,r,s){this.url=e,this.fieldMap=r,this.dictionaryInfo=s,this._symbolPartCache=new Ihe(100);const n=async()=>p$t.from(await s,i,r);this._evaluator=n()}async getSymbolAsync(e,i,r=!0){const s=await this._evaluator,n=i?.fields??qVe(e.attributes),a=s.createDictionaryFieldsIndex(n),o=s.evaluate(e,i?.scale??0,a,i?.spatialReference);if(o==null)return null;const l=mP(e.geometry),u=U2e.parse(o,s.itemNames,l),d=l==="esriGeometryPoint"&&!e.geometry?.hasZ;return await this._cimPartsToCIMSymbol(e,u.partNames,u.overrides,d,i,r,a)}async getSymbolForControlString(e,i,r){const s=await this._evaluator,n=U2e.parse(e,s.itemNames,i),a=i==="esriGeometryPoint"&&!r,o=sSe(await Promise.all(n.partNames.map(l=>this._getSymbolPart(l))),n.overrides,a);return new fl({data:o})}async _cimPartsToCIMSymbol(e,i,r,s,n,a,o){const l=i.map(f=>this._getSymbolPart(f,n));let u=await Promise.all(l);if(a&&this.fieldMap&&u.length>0){const{OverrideHelper:f}=await W(()=>import("./OverrideHelper-DQZGOyKM.js"),__vite__mapDeps([158,159]));u=se(u);for(const g of u)f.applyDictionaryTextOverrides(g,e,this.fieldMap,o,Tne(g))}const d=sSe(u,r,s);return new fl({data:d})}async _fetchSymbolPart(e,i){const r=await this.dictionaryInfo,s=(this.url+"/"+r.cimRefTemplateUrl).replaceAll(/\{itemName\}/gi,e),{data:n}=await Si(s,{responseType:"json",query:{f:"json"},...i});return n}async _getSymbolPart(e,i){let r=this._symbolPartCache.get(e);return r||(r=this._fetchSymbolPart(e,i),this._symbolPartCache.put(e,r)),r}};function sSe(t,e,i){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.effects=null,r.symbolLayers=[];for(const s of t){const n=s;if(n.effects!=null)for(const a of n.symbolLayers)a.effects==null?a.effects=n.effects:a.effects.unshift(...n.effects);r.symbolLayers.unshift(...n.symbolLayers)}}return i&&(r.callout=C$t),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var $ne;let df=$ne=class extends $P(qh){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){const t=this.getDictionaryInfo();return new WVe(this.url,this.config,this.fieldMap??{},t)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r?.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new $ne({config:se(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:se(this.fieldMap),url:se(this.url),visualVariables:se(this.visualVariables)})}async getSymbolAsync(t,e,i=!0){return this._loader.getSymbolAsync(t,e,i)}async getSymbolForControlString(t,e,i){return this._loader.getSymbolForControlString(t,e,i)}getDictionaryInfo(){return this._dictionaryInfoPromise||(this._dictionaryInfoPromise=this._fetchDictionaryInfo()),this._dictionaryInfoPromise}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await ic(t,e,null,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}async _fetchDictionaryInfo(){const{data:t}=await Si(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"}});return t}};c([p({type:WVe})],df.prototype,"_loader",null),c([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],df.prototype,"config",void 0),c([p({type:Object,json:{write:!0}})],df.prototype,"fieldMap",void 0),c([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],df.prototype,"scaleExpression",void 0),c([Ie("scaleExpression")],df.prototype,"writeData",null),c([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],df.prototype,"scaleExpressionTitle",void 0),c([p({type:String,json:{write:!0}})],df.prototype,"url",void 0),c([Ie("visualVariables")],df.prototype,"writeVisualVariables",null),df=$ne=c([R("esri.renderers.DictionaryRenderer")],df);var Cne;let dv=Cne=class extends ae{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(re.getLogger(this).error(".field: field must be a string value"),null):ZL(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new Cne({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};c([p({type:Je,json:{type:[Number],write:!0}})],dv.prototype,"color",void 0),c([p({type:String,json:{write:!0}})],dv.prototype,"field",void 0),c([wi("field")],dv.prototype,"castField",null),c([p({type:String,json:{write:!0}})],dv.prototype,"label",void 0),c([p({type:String,json:{write:!0}})],dv.prototype,"valueExpression",void 0),c([p({type:String,json:{write:!0}})],dv.prototype,"valueExpressionTitle",void 0),dv=Cne=c([R("esri.renderers.support.AttributeColorInfo")],dv);const ZVe=dv;var Mne;let aB=Mne=class extends ae{constructor(){super(...arguments),this.unit=null}clone(){return new Mne({unit:this.unit})}};c([p({type:String,json:{write:!0}})],aB.prototype,"unit",void 0),aB=Mne=c([R("esri.renderers.support.DotDensityLegendOptions")],aB);const M$t=aB;var Ene;let mu=Ene=class extends $P(qh){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Je([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Rn,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}set visualVariables(t){super.visualVariables=t}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Pu({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Ene({attributes:se(this.attributes),backgroundColor:se(this.backgroundColor),dotBlendingEnabled:se(this.dotBlendingEnabled),dotShape:se(this.dotShape),dotSize:se(this.dotSize),dotValue:se(this.dotValue),legendOptions:se(this.legendOptions),outline:se(this.outline),referenceScale:se(this.referenceScale),seed:se(this.seed),visualVariables:se(this.visualVariables),authoringInfo:se(this.authoringInfo)})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await ic(t,e,null,i.valueExpression),i.field&&t.add(i.field)}};c([p({type:[ZVe],json:{write:!0}})],mu.prototype,"attributes",void 0),c([p({type:Je,json:{write:!0}})],mu.prototype,"backgroundColor",void 0),c([p({type:Boolean,json:{write:!0}})],mu.prototype,"dotBlendingEnabled",void 0),c([p({type:String,json:{write:!1}})],mu.prototype,"dotShape",void 0),c([p({type:Number,json:{write:!0}})],mu.prototype,"dotSize",void 0),c([p({type:M$t,json:{write:!0}})],mu.prototype,"legendOptions",void 0),c([p({type:Rn,json:{default:null,write:!0}})],mu.prototype,"outline",void 0),c([p({type:Number,json:{write:!0}})],mu.prototype,"dotValue",void 0),c([p({type:Number,json:{write:!0}})],mu.prototype,"referenceScale",void 0),c([p({type:Number,json:{write:!0}})],mu.prototype,"seed",void 0),c([st({dotDensity:"dot-density"})],mu.prototype,"type",void 0),mu=Ene=c([R("esri.renderers.DotDensityRenderer")],mu);var Ane;let vw=Ane=class extends ae{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new Ane({color:this.color&&this.color.clone(),ratio:this.ratio})}};c([p({type:Je,json:{type:[vi],default:null,write:{isRequired:!0}}})],vw.prototype,"color",void 0),c([p({type:Number,json:{write:{isRequired:!0}}})],vw.prototype,"ratio",void 0),vw=Ane=c([R("esri.renderers.support.HeatmapColorStop")],vw);let _3=class extends nt(ae){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};c([p({type:String,json:{write:!0}})],_3.prototype,"minLabel",void 0),c([p({type:String,json:{write:!0}})],_3.prototype,"maxLabel",void 0),c([p({type:String,json:{write:!0}})],_3.prototype,"title",void 0),_3=c([R("esri.renderers.support.HeatmapLegendOptions")],_3);function qc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function E$t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Or(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Lhe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function YVe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function JVe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function QVe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function A$t(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function O$t(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function P$t(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function R$t(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function I$t(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function y1(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function D$t(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function XVe(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function nG(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function Fhe(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function rH(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function k$t(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function L$t(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function KVe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let a=i*i+r*r+s*s+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=i*a,t[1]=r*a,t[2]=s*a,t[3]=n*a),t}function zhe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function sH(t,e,i,r){const s=e[0],n=e[1],a=e[2],o=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=a+r*(i[2]-a),t[3]=o+r*(i[3]-o),t}function F$t(t,e=1){const i=sF;let r,s,n,a,o,l;do r=2*i()-1,s=2*i()-1,o=r*r+s*s;while(o>=1);do n=2*i()-1,a=2*i()-1,l=n*n+a*a;while(l>=1);const u=Math.sqrt((1-o)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*u,t[3]=e*a*u,t}function zu(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*a,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*a,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*a,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*a,t}function z$t(t,e,i){const r=e[0],s=e[1],n=e[2],a=i[0],o=i[1],l=i[2],u=i[3],d=u*r+o*n-l*s,f=u*s+l*r-a*n,g=u*n+a*s-o*r,v=-a*r-o*s-l*n;return t[0]=d*u+v*-a+f*-l-g*-o,t[1]=f*u+v*-o+g*-a-d*-l,t[2]=g*u+v*-l+d*-o-f*-a,t[3]=e[3],t}function N$t(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function S0(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function J5(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],a=e[0],o=e[1],l=e[2],u=e[3],d=_n();return Math.abs(i-a)<=d*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-l)<=d*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-u)<=d*Math.max(1,Math.abs(n),Math.abs(u))}const V$t=YVe,j$t=JVe,U$t=QVe,B$t=XVe,q$t=nG,G$t=Fhe,H$t=rH,eje=Object.freeze(Object.defineProperty({__proto__:null,add:Lhe,ceil:A$t,copy:qc,copyVec3:E$t,dist:B$t,distance:XVe,div:U$t,divide:QVe,dot:zhe,equals:J5,exactEquals:S0,floor:O$t,inverse:L$t,len:G$t,length:Fhe,lerp:sH,max:R$t,min:P$t,mul:j$t,multiply:JVe,negate:k$t,normalize:KVe,random:F$t,round:I$t,scale:y1,scaleAndAdd:D$t,set:Or,sqrDist:q$t,sqrLen:H$t,squaredDistance:nG,squaredLength:rH,str:N$t,sub:V$t,subtract:YVe,transformMat4:zu,transformQuat:z$t},Symbol.toStringTag,{value:"Module"}));function li(){return[0,0,0,0]}function eA(t){return[t[0],t[1],t[2],t[3]]}function $i(t,e,i,r){return[t,e,i,r]}function Q5(t,e,i,r){return[t,e,i,r]}function X5(t,e=li()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function tje(){return li()}function Nhe(){return $i(1,1,1,1)}function ije(){return $i(1,0,0,0)}function rje(){return $i(0,1,0,0)}function sje(){return $i(0,0,1,0)}function nje(){return $i(0,0,0,1)}const Tn=tje(),nH=Nhe(),W$t=ije(),Z$t=rje(),Y$t=sje(),J$t=nje();Object.freeze(Object.defineProperty({__proto__:null,ONES:nH,UNIT_W:J$t,UNIT_X:W$t,UNIT_Y:Z$t,UNIT_Z:Y$t,ZEROS:Tn,clone:eA,create:li,freeze:Q5,fromArray:X5,fromValues:$i,ones:Nhe,unitW:nje,unitX:ije,unitY:rje,unitZ:sje,zeros:tje},Symbol.toStringTag,{value:"Module"}));const Vhe=2.4;function Q$t(t){return Tp(t*Vhe)}function X$t(t){return d1(t)/Vhe}function K$t(t,e,i,r){let{color:s,ratio:n}=e,{color:a,ratio:o}=i;o===n&&(o===1?n-=1e-6:o+=1e-6);const l=Ce((r-n)/(o-n),0,1);sH(t,s.toArray(),a.toArray(),l)}function gmi(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:o})=>o>=0&&o<=1).sort((o,l)=>o.ratio-l.ratio).map(({color:o,ratio:l})=>({color:o,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const a=li();for(let o=0;o<512;o++){const l=(o+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];K$t(a,r,s,l),i.set(a,4*o)}return i}function ymi(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function vmi(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var One;function nSe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:a,...o}=t;return o}}return t}let go=One=class extends qh{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new vw({ratio:0,color:new Je("rgba(255, 140, 0, 0)")}),new vw({ratio:.75,color:new Je("rgba(255, 140, 0, 1)")}),new vw({ratio:.9,color:new Je("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(t){return nSe(t)}get blurRadius(){return X$t(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",Q$t(t)),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(Vhe**2*this.blurRadius**4)}read(t,e){t=nSe(t),super.read(t,e)}getSymbol(){return new wa}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&ec(t,e,i),r&&typeof r=="string"&&await ic(t,e,null,r)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new One({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:se(this.colorStops),field:this.field,legendOptions:se(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};c([p({type:un,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],go.prototype,"authoringInfo",void 0),c([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],go.prototype,"blurRadius",null),c([p({type:[vw],json:{write:{isRequired:!0}}})],go.prototype,"colorStops",void 0),c([p({type:String,json:{write:!0}})],go.prototype,"field",void 0),c([p({type:_3,json:{write:!0}})],go.prototype,"legendOptions",void 0),c([p({type:Number,json:{write:!0}})],go.prototype,"maxDensity",void 0),c([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],go.prototype,"maxPixelIntensity",null),c([p({type:Number,json:{write:!0}})],go.prototype,"minDensity",void 0),c([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],go.prototype,"minPixelIntensity",null),c([p({type:Number,cast:mr,json:{write:!0}})],go.prototype,"radius",void 0),c([p({type:Number,range:{min:0},json:{default:0,write:!0}})],go.prototype,"referenceScale",void 0),c([st({heatmap:"heatmap"})],go.prototype,"type",void 0),c([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],go.prototype,"valueExpression",void 0),c([p({type:String})],go.prototype,"valueExpressionTitle",void 0),c([p({readOnly:!0})],go.prototype,"_pixelIntensityToDensity",null),go=One=c([R("esri.renderers.HeatmapRenderer")],go);let B2=class extends nt(ae){constructor(){super(...arguments),this.color=new Je([0,0,0,0]),this.label=null,this.threshold=0}};c([p({type:Je,json:{write:!0}})],B2.prototype,"color",void 0),c([p({type:String,json:{write:!0}})],B2.prototype,"label",void 0),c([p({type:Number,range:{min:0,max:1},json:{write:!0}})],B2.prototype,"threshold",void 0),B2=c([R("esri.renderers.support.OthersCategory")],B2);const eCt={base:zl,key:"type",typeMap:{size:Er,opacity:Xv}};let gu=class extends $P(nt(qh)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Je([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new B2,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new wa({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(wl)}getAttributeHash(){return this.visualVariables?.reduce((e,i)=>e+i.getAttributeHash(),"")??""}getMeshHash(){return this.symbols.reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await ic(e,i,null,r.valueExpression),r.field&&e.add(r.field)}};c([p({type:[ZVe],json:{write:!0}})],gu.prototype,"attributes",void 0),c([p(She)],gu.prototype,"backgroundFillSymbol",void 0),c([p({type:Je,json:{write:!0}})],gu.prototype,"defaultColor",void 0),c([p({type:String,json:{write:!0}})],gu.prototype,"defaultLabel",void 0),c([p({type:Number,range:{min:0,max:1},json:{write:!0}})],gu.prototype,"holePercentage",void 0),c([p({type:B2,json:{write:!0}})],gu.prototype,"othersCategory",void 0),c([p({type:The,json:{write:!0}})],gu.prototype,"legendOptions",void 0),c([p({type:Rn,json:{default:null,write:!0}})],gu.prototype,"outline",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],gu.prototype,"size",void 0),c([st({pieChart:"pie-chart"})],gu.prototype,"type",void 0),c([p({types:[eCt]})],gu.prototype,"visualVariables",void 0),gu=c([R("esri.renderers.PieChartRenderer")],gu);const PF={key:"type",base:qh,typeMap:{heatmap:go,simple:zc,"unique-value":Fs,"class-breaks":fa,"dot-density":mu,dictionary:df,"pie-chart":gu},errorContext:"renderer"},tCt={key:"type",base:qh,typeMap:{simple:zc,"unique-value":Fs,"class-breaks":fa,heatmap:go},errorContext:"renderer",validate:iCt};function iCt(t){switch(t.type){case"simple":return rCt(t);case"unique-value":return sCt(t);case"class-breaks":return nCt(t);case"heatmap":return t}}function rCt(t){if(t.symbol)return t;re.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function sCt(t){const e=t.uniqueValueInfos,i=e?.filter(({symbol:r,label:s},n)=>(r||re.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${n}] ${s}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.uniqueValueInfos=i),t}function nCt(t){const e=t.classBreakInfos,i=e?.filter(({symbol:r,label:s},n)=>(r||re.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${n}] ${s}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.classBreakInfos=i),t}function wmi(t,e){return K5(t,null,e)}const aCt=pP({types:PF});function K5(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i?.messages&&i.messages.push(new Gu("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):aCt(t,e,i):null}var Pne;let ol=Pne=class extends Iw{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=mr("12px"),this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ra(i,r,e)}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?K5(r,e,i)??void 0:Che(e,i)}clone(){return new Pne({fields:se(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:se(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:se(this.popupTemplate),renderer:se(this.renderer),binType:se(this.binType),size:this.size})}};c([st({binning:"binning"})],ol.prototype,"type",void 0),c([st({geohash:"geohash",square:"square"}),p({type:["geohash","square"]})],ol.prototype,"binType",void 0),c([p({type:Number,json:{write:!0}})],ol.prototype,"fixedBinLevel",void 0),c([p({type:[Js],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],ol.prototype,"labelingInfo",void 0),c([p(Y7)],ol.prototype,"labelsVisible",void 0),c([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],ol.prototype,"maxScale",void 0),c([p(Z7)],ol.prototype,"popupEnabled",void 0),c([p({type:wP,json:{name:"popupInfo",write:!0}})],ol.prototype,"popupTemplate",void 0),c([p({cast:t=>t==="auto"?t:Fc(mr(t))})],ol.prototype,"size",void 0),c([p({type:[Ul],json:{write:!0}})],ol.prototype,"fields",void 0),c([Ie("fields")],ol.prototype,"writeFields",null),c([p({types:PF,json:{write:{target:"drawingInfo.renderer"}}})],ol.prototype,"renderer",void 0),c([Oe("renderer",["drawingInfo.renderer"])],ol.prototype,"readRenderer",null),ol=Pne=c([R("esri.layers.support.FeatureReductionBinning")],ol);var Rne;function aSe(t){return t.type==="simple"&&!t.visualVariables?.length}let ma=Rne=class extends ae{constructor(t){super(t),this.type="cluster",this.clusterRadius=mr("80px"),this.clusterMinSize=mr("12px"),this.clusterMaxSize=mr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r?aSe(r)?null:K5(r,e,i)??void 0:Che(e,i)}readSymbol(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r&&aSe(r)?K5(r,e,i)?.symbol:null}writeSymbol(t,e,i,r){const s=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||s){const n=new zc({symbol:t});e.drawingInfo={renderer:n.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ra(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>Ul.fromJSON(r))}clone(){return new Rne({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:se(this.labelingInfo),labelsVisible:this.labelsVisible,fields:se(this.fields),maxScale:this.maxScale,renderer:se(this.renderer),symbol:se(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:se(this.popupTemplate)})}};c([p({type:["cluster"],readOnly:!0,json:{write:!0}})],ma.prototype,"type",void 0),c([p({cast:t=>t==="auto"?t:Fc(mr(t)),json:{write:!0}})],ma.prototype,"clusterRadius",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],ma.prototype,"clusterMinSize",void 0),c([p({type:Number,cast:mr,json:{write:!0}})],ma.prototype,"clusterMaxSize",void 0),c([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],ma.prototype,"maxScale",void 0),c([p(Z7)],ma.prototype,"popupEnabled",void 0),c([p({type:wP,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],ma.prototype,"popupTemplate",void 0),c([p({types:PF,json:{write:{target:"drawingInfo.renderer"}}})],ma.prototype,"renderer",void 0),c([Oe("renderer",["drawingInfo.renderer"])],ma.prototype,"readRenderer",null),c([p({types:Ogt})],ma.prototype,"symbol",void 0),c([Oe("symbol",["drawingInfo.renderer"])],ma.prototype,"readSymbol",null),c([Ie("symbol")],ma.prototype,"writeSymbol",null),c([p({type:[Js],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],ma.prototype,"labelingInfo",void 0),c([p(Y7)],ma.prototype,"labelsVisible",void 0),c([p({type:[Ul],json:{write:!0}})],ma.prototype,"fields",void 0),c([Ie("fields")],ma.prototype,"writeFields",null),c([Oe("fields")],ma.prototype,"readFields",null),ma=Rne=c([R("esri.layers.support.FeatureReductionCluster")],ma);var Ine;let V4=Ine=class extends Iw{constructor(t){super(t),this.type="selection"}clone(){return new Ine}};c([p({type:["selection"]})],V4.prototype,"type",void 0),V4=Ine=c([R("esri.layers.support.FeatureReductionSelection")],V4);const oSe={key:"type",base:Iw,typeMap:{cluster:ma,binning:ol}},oCt={types:{key:"type",base:Iw,typeMap:{selection:V4,cluster:ma,binning:ol}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:oSe},"portal-item":{types:oSe},"web-scene":{types:{key:"type",base:Iw,typeMap:{selection:V4}},name:"layerDefinition.featureReduction",write:{allowNull:!0,layerContainerTypes:Es}}}}},lCt=()=>re.getLogger("esri.views.2d.layers.support.clusterUtils");ie.add("esri-cluster-arcade-enabled",!0);const cCt=ie("esri-cluster-arcade-enabled"),uCt=new Set(["simple-line","simple-fill","picture-fill"]);function lSe(t,e){let i=e.clone();if(!hCt(i))return i;if(e.symbols.some(r=>uCt.has(r.type))&&(i=new zc({symbol:new wa})),i.authoringInfo||(i.authoringInfo=new un),i.authoringInfo.isAutoGenerated=!0,"visualVariables"in i){const r=(i.visualVariables||[]).filter(s=>s.valueExpression!=="$view.scale");r.forEach(s=>{s.type==="rotation"?s.field?s.field=vx(t,s.field,"avg_angle","number"):s.valueExpression&&(s.field=hI(t,s.valueExpression,"avg_angle","number"),s.valueExpression=null):s.normalizationField?(s.field=vx(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=vx(t,s.field,"avg","number"):s.valueExpression&&(s.field=hI(t,s.valueExpression,"avg","number"),s.valueExpression=null)}),i.visualVariables=r}switch(i.type){case"simple":break;case"pie-chart":for(const r of i.attributes)r.field?r.field=vx(t,r.field,"sum","number"):r.valueExpression&&(r.field=hI(t,r.valueExpression,"sum","number"),r.valueExpression=null);break;case"unique-value":i.field?i.field=vx(t,i.field,"mode","string"):i.valueExpression&&(i.field=hI(t,i.valueExpression,"mode","string"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=vx(t,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=vx(t,i.field,"avg","number"):i.valueExpression&&(i.field=hI(t,i.valueExpression,"avg","number"),i.valueExpression=null)}return i}const hCt=t=>{const e=i=>lCt().error(new q("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!cCt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function dCt(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+hue(n)}}}function hI(t,e,i,r){const s=hue(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(a=>a.name===n)||t.push(new Ul({name:n,isAutoGenerated:!0,onStatisticExpression:new nw({expression:e,returnType:r}),statisticType:i})),n}function vx(t,e,i,r,s){if(e==="cluster_count"||t.some(a=>a.name===e))return e;const n=dCt(i,e,s);return t.some(a=>a.name===n)||(i==="avg_norm"?t.push(new Ul({name:n,isAutoGenerated:!0,onStatisticExpression:new nw({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new Ul({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const pCt=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.aggregateGraphicOrigin=new MTt(this),this.addHandles(X(()=>this.renderer,()=>{if(this.featureReduction){const s=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",s)}},Ht))}set featureReduction(r){const s=this._normalizeFeatureReduction(r);this._set("featureReduction",s)}set renderer(r){}_withClusterVariable(r,s,n){const a=r.clone();return"visualVariables"in a&&(a.visualVariables||(a.visualVariables=[]),a.visualVariables.some(o=>o.type==="size")||a.visualVariables.push(new Er({field:"cluster_count",stops:[new Ef({value:1}),new Ef({useMinValue:!0,size:s}),new Ef({useMaxValue:!0,size:n})]}))),a}_normalizeFeatureReduction(r){if(r?.type!=="cluster")return r;const s=r.clone(),n=[new Ul({name:"cluster_count",alias:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],a=(s.fields??[]).filter(g=>!g.isAutoGenerated),o=r.renderer&&!r.renderer.authoringInfo?.isAutoGenerated,{clusterMinSize:l,clusterMaxSize:u}=s;if(o){s.fields=[...n,...a];const g=this._withClusterVariable(s.renderer,l,u);return s.effectiveFeatureRenderer=g,s.effectiveClusterRenderer=g,s}if(r.symbol){if(s.fields=[...n,...a],s.renderer=null,!this.renderer)return s.effectiveFeatureRenderer=null,s.effectiveClusterRenderer=null,s;const g=lSe(n,this.renderer),v=this._withClusterVariable(g,l,u),_="visualVariables"in v&&v.visualVariables?v.visualVariables:[],x=new zc({symbol:r.symbol,visualVariables:_});return s.fields=[...n,...a],s.effectiveFeatureRenderer=v,s.effectiveClusterRenderer=x,s}if(!this.renderer)return r;const d=lSe(n,this.renderer);s.fields=[...n,...a],s.renderer=d;const f=this._withClusterVariable(d,l,u);return s.effectiveFeatureRenderer=f,s.effectiveClusterRenderer=f,s}};return c([p({readOnly:!0,clonable:!1})],i.prototype,"aggregateGraphicOrigin",void 0),c([p(oCt)],i.prototype,"featureReduction",null),i=c([R("esri.layers.mixins.FeatureReductionLayer")],i),i},cSe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,ArcGISVideoLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,ParquetLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},uSe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},hSe={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},fCt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GaussianSplatLayer:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,Object3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap-base-layers":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap-ground-layers":{IntegratedMesh3DTilesLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":cSe,"web-map/basemap-base-layers":uSe,"web-map/tables":hSe,"link-chart/operational-layers":{...cSe,LinkChartLayer:!0},"link-chart/basemap-base-layers":uSe,"link-chart/tables":hSe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0,WCS:!0},"portal-item/tables":{ArcGISFeatureLayer:!0,SubtypeGroupTable:!0}},mCt=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(r,s,n){return n?.portalItem?.type==="Group Layer"?void 0:r}writeListMode(r,s,n,a){(a&&a.layerContainerType==="ground"||r&&mrt(this,n,{},a))&&(s[n]=r)}writeOperationalLayerType(r,s,n){r&&(s[n]=r)}writeTitle(r,s){s.title=r??"Layer"}readVisibilityTimeExtent(r){return r?ts.fromArray(r):null}writeVisibilityTimeExtent(r,s,n,a){r&&a.layerContainerType!=="tables"&&(r.isEmpty?a?.messages&&a.messages.push(new q("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):s[n]=r.toArray())}read(r,s){s&&(s.layer=this),Ule(this,r,n=>super.read(r,n),s)}write(r,s){if(!this.persistenceEnabled&&!s?.ignorePersistenceEnabled)return null;if(s?.origin){const o=`${s.origin}/${s.layerContainerType||"operational-layers"}`;let u=!!fCt[o]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&o==="web-scene/operational-layers"&&(u=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&o==="web-map/operational-layers"&&(u=!1),!u)return s.messages?.push(new q("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${o}'`,{layer:this})),null}const n=super.write(r,{...s,layer:this}),a=!!s&&!!s.messages&&!!s.messages.filter(o=>o instanceof q&&o.name==="web-document-write:property-required").length;return e1(n?.url)?(s?.messages?.push(new q("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&a?null:n}beforeSave(){}};return c([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],i.prototype,"id",void 0),c([Oe("id",["id"])],i.prototype,"readId",null),c([p(tVe)],i.prototype,"listMode",void 0),c([Ie("listMode")],i.prototype,"writeListMode",null),c([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:Es,isRequired:!0}}}}})],i.prototype,"operationalLayerType",void 0),c([Ie("operationalLayerType")],i.prototype,"writeOperationalLayerType",null),c([p(Hse)],i.prototype,"opacity",void 0),c([p({type:Boolean,readOnly:!1})],i.prototype,"persistenceEnabled",void 0),c([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],i.prototype,"title",void 0),c([Ie("title"),Ie(["web-scene"],"title")],i.prototype,"writeTitle",null),c([p({type:ts,json:{origins:{"web-scene":{write:{layerContainerTypes:Es}}}}})],i.prototype,"visibilityTimeExtent",void 0),c([Oe("visibilityTimeExtent")],i.prototype,"readVisibilityTimeExtent",null),c([Ie(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[vi,hP]]}})],i.prototype,"writeVisibilityTimeExtent",null),c([p({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:Es}}})],i.prototype,"visible",void 0),i=c([R("esri.layers.mixins.OperationalLayer")],i),i};var Dne;const wV=new ii({asc:"ascending",desc:"descending"});var BA;let q2=(BA=class extends ae{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Dne({field:this.field,valueExpression:this.valueExpression,order:this.order})}},Dne=BA,BA);c([p({type:String,json:{write:!0}})],q2.prototype,"field",void 0),c([p({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],q2.prototype,"valueExpression",void 0),c([p({type:wV.apiValues,json:{type:wV.jsonValues,read:wV.read,write:wV.write}})],q2.prototype,"order",void 0),q2=Dne=c([R("esri.layers.support.OrderByInfo")],q2);function gCt(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new q2;return s.read(r,i),[s]}function yCt(t,e,i,r){const s=t.find(n=>!!n.field);s&&ra(i,[s.toJSON()],e)}const vCt={type:[q2],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:gCt},write:{writer:yCt}}},_Ct=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.orderBy=null}};return c([p(vCt)],i.prototype,"orderBy",void 0),i=c([R("esri.layers.mixins.OrderedLayer")],i),i},bCt=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Pe(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,s,n){if(s.itemId)return new qt({id:s.itemId,portal:n?.portal})}writePortalItem(r,s){r?.id&&(s.itemId=r.id)}async loadFromPortal(r,s){if(this.portalItem?.id)try{const{load:n}=await W(()=>import("./layersLoader-CvzHz3XW.js"),__vite__mapDeps([265,126,127,125]));return ct(s),await n({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap,populateGroupLayer:r.populateGroupLayer},s)}catch(n){throw Zr(n)||re.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(s=>(ml(s),!0)))}async setUserPrivileges(r,s){if(!fr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(s);if(this.url)try{const{features:{edit:n,fullEdit:a},content:{updateItem:o}}=await this._fetchUserPrivileges(r,s);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",a),this._set("userHasUpdateItemPrivileges",o)}catch(n){ml(n)}}async _fetchUserPrivileges(r,s){let n=this.portalItem;if(!r||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(s);const a=!nr?.findCredential(this.url),o=r===n.id;if(o&&n.portal.user)return this._getUserPrivileges(n,a);let l,u;if(o)l=n.portal.url;else try{l=await cue(this.url,s)}catch(v){ml(v)}if(!l||!bRe(l,n.portal.url))return this._fetchFallbackUserPrivileges(s);try{const v=s!=null?s.signal:null;u=await nr?.getCredential(`${l}/sharing`,{prompt:!1,signal:v})}catch(v){ml(v)}const d=!0,f=!1,g=!1;if(!u)return{features:{edit:d,fullEdit:f},content:{updateItem:g}};try{if(o?await n.reload():(n=new qt({id:r,portal:{url:l}}),await n.load(s)),n.portal.user)return this._getUserPrivileges(n,a)}catch(v){ml(v)}return{features:{edit:d,fullEdit:f},content:{updateItem:g}}}_getUserPrivileges(r,s){const n=a1t(r);return s&&(n.features.edit=!0),n}async _fetchFallbackUserPrivileges(r){let s=!0;try{s=await this._fetchUserHasEditingPrivileges(r)}catch(n){ml(n)}return{features:{edit:s,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const s=this.url?nr?.findCredential(this.url):null;if(!s)return!0;const n=xV.credential===s?xV.user:await this._fetchEditingUser(r);return xV.credential=s,xV.user=n,n?.privileges==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(r){const s=this.portalItem?.portal?.user;if(s)return s;const n=nr?.findServerInfo(this.url??"");if(!n?.owningSystemUrl)return null;const a=`${n.owningSystemUrl}/sharing/rest`,o=ze.getDefault();if(o&&o.loaded&&pp(o.restUrl)===pp(a))return o.user;const l=`${a}/community/self`,u=r!=null?r.signal:null,d=await Sp(Si(l,{authMode:"no-prompt",query:{f:"json"},signal:u}));return d.ok?as.fromJSON(d.value.data):null}read(r,s){s&&(s.layer=this),super.read(r,s)}write(r,s){const n=s?.portal,a=this.portalItem?.id&&(this.portalItem.portal||ze.getDefault());return n&&a&&!wRe(a.restUrl,n.restUrl)?(s.messages&&s.messages.push(new q("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...s,layer:this})}};return c([p({type:qt})],i.prototype,"portalItem",null),c([Oe("web-document","portalItem",["itemId"])],i.prototype,"readPortalItem",null),c([Ie("web-document","portalItem",{itemId:{type:String}})],i.prototype,"writePortalItem",null),c([p({clonable:!1})],i.prototype,"resourceReferences",void 0),c([p({type:Boolean,readOnly:!0})],i.prototype,"userHasEditingPrivileges",void 0),c([p({type:Boolean,readOnly:!0})],i.prototype,"userHasFullEditingPrivileges",void 0),c([p({type:Boolean,readOnly:!0})],i.prototype,"userHasUpdateItemPrivileges",void 0),i=c([R("esri.layers.mixins.PortalLayer")],i),i},xV={credential:null,user:null};let sk=class extends be{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};c([p()],sk.prototype,"updating",void 0),c([p()],sk.prototype,"status",void 0),sk=c([R("esri.layers.support.PublishingInfo")],sk);const wCt=Symbol(),xCt=t=>{var s;var e;const i=t;let r=(s=class extends i{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const n=this._get("publishingInfo");if(n)return n;const a=new sk;return this._checkPublishingStatus(a),a}_checkPublishingStatus(n){let l=0;const u=async f=>{let g;n.updating=!0;try{g=await this.fetchPublishingStatus()}catch{g="unavailable"}g!=="published"&&g!=="unavailable"||(n.status==="publishing"&&this.refresh(),d.remove()),n.status=g,n.updating=!1,d.removed||(l=setTimeout(u,f,f+125))},d={removed:!1,remove(){this.removed=!0,clearTimeout(l)}};this.when().catch(()=>d.remove()),u(250),this.addHandles(d)}},e=wCt,s);return c([p({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=c([R("esri.layers.mixins.PublishableLayer")],r),r},_w=new ke,j4=new WeakMap;function SCt(t){$Ct(t)&&_w.push(new WeakRef(t))}function TCt(t){const e=_w.find(i=>i.deref()===t);e&&_w.remove(e)}function $Ct(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function aje(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:aje(e,t%e):0}let vQ=0,SV=0;function CCt(){const t=Date.now();let e=!1;for(const i of _w){const r=i.deref();r?r.refreshInterval&&t-(j4.get(r)??0)+5>=6e4*r.refreshInterval&&(j4.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=_w.length-1;i>=0;i--)_w.at(i).deref()||_w.removeAt(i)}DPe(()=>{const t=Date.now();let e=0;for(const i of _w){const r=i.deref();r&&(e=aje(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?j4.get(r)||j4.set(r,t):j4.delete(r))}if(e!==SV){if(SV=e,clearInterval(vQ),SV===0)return void(vQ=0);vQ=setInterval(CCt,SV)}},Ht);function Smi(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const dSe=.1,MCt=t=>{const e=t;let i=class extends e{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=HL(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||SCt(this)},()=>{})}destroy(){TCt(this)}castRefreshInterval(r){return r>=dSe?r:r<=0?0:dSe}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){bp(this._debounceHasDataChanged()).then(s=>{s&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:s})},s=>{re.getLogger(this).error(s),this.emit("refresh",{dataChanged:!1,error:s})})}async hasDataChanged(){return!0}get test(){}};return c([p({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:Es}}}}})],i.prototype,"refreshInterval",void 0),c([wi("refreshInterval")],i.prototype,"castRefreshInterval",null),c([p({readOnly:!0})],i.prototype,"refreshTimestamp",void 0),c([p({readOnly:!0})],i.prototype,"refreshParameters",null),i=c([R("esri.layers.mixins.RefreshableLayer")],i),i},oje=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},s=this.parent;s?.effectiveScaleRange!==void 0&&ECt(r,s.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return c([p({type:Number,nonNullable:!0,json:{write:!0}})],i.prototype,"minScale",void 0),c([p({type:Number,nonNullable:!0,json:{write:!0}})],i.prototype,"maxScale",void 0),c([p({readOnly:!0})],i.prototype,"effectiveScaleRange",null),i=c([R("esri.layers.mixins.ScaleRangeLayer")],i),i};function ECt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function pSe(t,e){return qf.fromJSON({value:t,unit:e})}let zo=class extends nt(ae){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,i){return i.timeExtent&&Array.isArray(i.timeExtent)&&i.timeExtent.length===2?ts.fromArray(i.timeExtent):null}writeFullTimeExtent(e,i){e?.start!=null&&e.end!=null?i.timeExtent=e.toArray():i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?pSe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?pSe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=e?.toJSON().value??null,i.timeIntervalUnits=e?.toJSON().unit??null}};c([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],zo.prototype,"cumulative",void 0),c([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],zo.prototype,"endField",void 0),c([p({type:ts,json:{write:{enabled:!0,allowNull:!0}}})],zo.prototype,"fullTimeExtent",void 0),c([Oe("fullTimeExtent",["timeExtent"])],zo.prototype,"readFullTimeExtent",null),c([Ie("fullTimeExtent")],zo.prototype,"writeFullTimeExtent",null),c([p({type:Boolean,json:{write:!0}})],zo.prototype,"hasLiveData",void 0),c([p({type:qf,json:{write:{enabled:!0,allowNull:!0}}})],zo.prototype,"interval",void 0),c([Oe("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],zo.prototype,"readInterval",null),c([Ie("interval")],zo.prototype,"writeInterval",null),c([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],zo.prototype,"startField",void 0),c([p(Mq("timeReference",!0))],zo.prototype,"timeZone",void 0),c([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],zo.prototype,"trackIdField",void 0),c([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],zo.prototype,"useTime",void 0),c([p({type:[Date],json:{read:!1}})],zo.prototype,"stops",void 0),zo=c([R("esri.layers.support.TimeInfo")],zo);const ACt={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:Es}}},OCt=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,s){const n=s.timeInfo.exportOptions;if(!n)return null;const a=n.timeOffset,o=che.fromJSON(n.timeOffsetUnits);return a&&o?new qf({value:a,unit:o}):null}set timeInfo(r){k5e(r,this.fieldsIndex),this._set("timeInfo",r)}};return c([p({type:ts,json:{write:!1}})],i.prototype,"timeExtent",void 0),c([p({type:qf})],i.prototype,"timeOffset",void 0),c([Oe("service","timeOffset",["timeInfo.exportOptions"])],i.prototype,"readOffset",null),c([p({value:null,type:zo,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],i.prototype,"timeInfo",null),c([p(ACt)],i.prototype,"useViewTime",void 0),i=c([R("esri.layers.mixins.TemporalLayer")],i),i};let PCt=class extends H5{constructor(e){super(),this.type="track",this.trackInfoProvider=e}get id(){return this.trackInfoProvider.id}get[bF](){return this.trackInfoProvider.trackInfo}},tp=class extends nt(ae){constructor(e){super(e),this.labelingInfo=null,this.labelsVisible=!0,this.renderer=null,this.visible=!0}};c([p({type:[Js],json:{write:!0}})],tp.prototype,"labelingInfo",void 0),c([p(Y7)],tp.prototype,"labelsVisible",void 0),c([p({types:PF,json:{write:!0}})],tp.prototype,"renderer",void 0),c([p({type:Boolean,json:{write:!0}})],tp.prototype,"visible",void 0),tp=c([R("esri.layers.support.TrackPartInfo")],tp);let yu=class extends nt(ae){constructor(e){super(e),this.enabled=!0,this.fields=[],this.latestObservations=new tp({renderer:new zc({symbol:eG.clone()})}),this.maxDisplayDuration=null,this.maxDisplayObservationsPerTrack=0,this.popupEnabled=!0,this.popupTemplate=null,this.previousObservations=new tp({renderer:new zc({symbol:eG.clone()})}),this.trackLines=new tp({renderer:new zc({symbol:whe.clone()})}),this.timeField="startTimeField"}writeFields(e,i,r){const s=e.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());ra(r,s,i)}};c([p({type:Boolean,json:{write:!0}})],yu.prototype,"enabled",void 0),c([p({type:[Ul],json:{write:!0}})],yu.prototype,"fields",void 0),c([Ie("fields")],yu.prototype,"writeFields",null),c([p({type:tp,json:{write:!0}})],yu.prototype,"latestObservations",void 0),c([p({type:qf,json:{write:!0}})],yu.prototype,"maxDisplayDuration",void 0),c([p({type:Number,json:{write:!0}})],yu.prototype,"maxDisplayObservationsPerTrack",void 0),c([p(Z7)],yu.prototype,"popupEnabled",void 0),c([p({type:wP,json:{name:"popupInfo",write:!0}})],yu.prototype,"popupTemplate",void 0),c([p({type:tp,json:{write:!0}})],yu.prototype,"previousObservations",void 0),c([p({type:tp,json:{write:!0}})],yu.prototype,"trackLines",void 0),c([p({type:["timeReceived","startTimeField","endTimeField"],json:{read:!0,write:!0}})],yu.prototype,"timeField",void 0),yu=c([R("esri.layers.support.TrackInfo")],yu);const RCt=t=>{const e=t;let i=class extends e{constructor(){super(...arguments),this.trackGraphicOrigin=new PCt(this),this.trackInfo=null}};return c([p({readOnly:!0,clonable:!1})],i.prototype,"trackGraphicOrigin",void 0),c([p({type:yu})],i.prototype,"trackInfo",void 0),i=c([R("esri.layers.mixins.TrackableLayer")],i),i},fSe=new ii({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let xg=class extends nt(ae){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};c([p({json:{write:!0}})],xg.prototype,"name",void 0),c([p({json:{write:!0}})],xg.prototype,"description",void 0),c([p({json:{read:fSe.read,write:fSe.write}})],xg.prototype,"drawingTool",void 0),c([p({json:{write:!0}})],xg.prototype,"prototype",void 0),c([p({json:{write:!0}})],xg.prototype,"thumbnail",void 0),xg=c([R("esri.layers.support.FeatureTemplate")],xg);let mg=class extends nt(ae){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=z7(e[r]);return i}writeDomains(e,i){const r={};for(const s of Object.keys(e))e[s]&&(r[s]=e[s]?.toJSON());i.domains=r}};c([p({json:{write:!0}})],mg.prototype,"id",void 0),c([p({json:{write:!0}})],mg.prototype,"name",void 0),c([p({json:{write:!0}})],mg.prototype,"domains",void 0),c([Oe("domains")],mg.prototype,"readDomains",null),c([Ie("domains")],mg.prototype,"writeDomains",null),c([p({type:[xg],json:{write:!0}})],mg.prototype,"templates",void 0),mg=c([R("esri.layers.support.FeatureType")],mg);let aw=class extends nt(ae){constructor(e){super(e),this.alias=null,this.name=void 0,this.fieldFormat=null}};c([p({type:String,json:{write:!0}})],aw.prototype,"alias",void 0),c([p({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],aw.prototype,"name",void 0),c([p({types:X5e,json:{write:!0}})],aw.prototype,"fieldFormat",void 0),aw=c([R("esri.layers.support.FieldConfiguration")],aw);function ICt(t){const{popupTemplate:e,fieldsIndex:i}=t,r=e?.fieldInfos;if(!r?.length||!i)return;const s=[];for(const n of r){const{fieldName:a,label:o}=n,l=i.get(a);if(!l)continue;const u=o&&o!==l.alias?o:null,d=bmt(n,l);(u||d)&&s.push(new aw({name:l.name,alias:u,fieldFormat:d}))}return s.length?s:null}function DCt(t){const{fields:e}=t;if(!e?.length)return;const i=[];for(const r of e){const s=C$(r)?C4(r):null;s&&i.push(new aw({name:r.name,fieldFormat:s}))}return i.length?i:null}function kCt(t,e){const{popupTemplate:i,fieldsIndex:r}=t;if(!i||!r)return;const s=LCt(t,e,i.fieldInfos);if(!s)return;const n=i.clone();return n.fieldInfos=s,n}function LCt(t,e,i){e??=[],i=se(i)??[];let r=!1;const s=new Map;for(const n of e){const a=t.fieldsIndex.get(n.name);a&&s.set(a.name,n)}for(const n of i){const a=t.fieldsIndex.get(n.fieldName);if(!a)continue;const o=s.get(a.name);n.label=o?.alias||a.alias,n.format=C$(a)&&o?.fieldFormat?Sue(o.fieldFormat,a):null,r=!0,s.delete(a.name)}for(const n of s.values()){const a=FCt(t,n);a&&(i.push(a),r=!0)}return r?i:null}function FCt(t,e){const{name:i,alias:r,fieldFormat:s}=e,n=t.fieldsIndex.get(i);if(!n||!r&&!s)return;const a=r||n.alias,o=C$(n)&&s?Sue(s,n):null;return new D7({fieldName:n.name,label:a,format:o,visible:!1,isEditable:N5e(n,t)})}function zCt(){return{fields:{type:[vo],value:null,set:function(t){if(t&&ie("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");re.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return sG.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t?.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t)this.fieldsIndex?.has(e)||re.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t});return R7(this.fieldsIndex,t)}}}}const _Q=()=>re.getLogger("esri.layers.support.labelingInfo"),NCt=/\[([^[\]]+)\]/gi;function mSe(t,e,i){return t?t.map(r=>{const s=new Js;if(s.read(r,i),s.labelExpression){const n=e.fields||e.layerDefinition?.fields||this.fields;s.labelExpression=s.labelExpression.replaceAll(NCt,(a,o)=>`[${VCt(o,n)}]`)}return s}):null}function VCt(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const gSe=["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],jCt={esriGeometryPoint:gSe,esriGeometryMultiPatch:["always-horizontal"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:gSe,esriGeometryEnvelope:null};function Pmi(t,e){const i=[];for(const r of t){const s=r.labelPlacement,n=jCt[e];if(!r.symbol)return _Q().warn("No ILabelClass symbol specified."),[];if(!n)return _Q().error(new q("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(n.includes(s))i.push(r);else{const a=n[0];s&&_Q().warn(`Found invalid label placement type ${s} for ${e}. Defaulting to ${a}`);const o=r.clone();o.labelPlacement=a,i.push(o)}}return i}const UCt="relationships/",BCt="expression/",qCt=/<br\s*\/*>/gi;let yc=class extends be{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||sc(()=>p1()):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??W(()=>import("./featureUtils-PX6clf8X.js"),__vite__mapDeps([111,2])).then(e=>this._featureUtils=e)}get calculatedExpressions(){const e=new ke;if(!this.expressionsUsedInTitle.length)return e;if(!this._arcadeTask?.value){for(const i of this.expressionsUsedInTitle??[])e.push({name:i.name,invalid:!0});return e}for(const i of this.expressionsUsedInTitle)try{const r=this._arcadeTask.value.arcade.parseScript(i.expression,["$layer","$map","$datastore"]);if(r.isAsync){e.push({name:i.name,invalid:!0});break}e.push({name:i.name,syntax:r,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(r,{vars:{$feature:"any"}})})}catch{e.push({name:i.name,invalid:!0});break}return e}get expressionsUsedInTitle(){let e=this.effectivePopupTemplate?.title??"";return typeof e!="string"?[]:(e=e.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter(i=>e.includes(`{expression/${i.name.toLowerCase()}}`))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some(e=>e.invalid===!0)}get requiredFields(){const e=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const r of this.calculatedExpressions?.toArray()??[])try{const s=this._arcadeTask.value.arcade.extractFieldLiterals(r.syntax);for(const n of s){const a=n.split("."),o=this.fieldsIndex.get(a.at(-1)??"");o&&e.add(o.name)}}catch{}const i=this._extractFieldNames(this.workingTitle);for(const r of i){const s=this.fieldsIndex.get(r);s&&e.add(s.name)}return this.objectIdField!=null&&e.add(this.objectIdField),e}get titleFromDisplayField(){let e="";return this.displayField&&(e=this.fieldsIndex.get(this.displayField)?.name??""),e||(e=this.fieldsIndex.get(this.objectIdField)?.name??""),e?`{${e}}`:""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return e===""||e==null||this.hasBadExpressions||typeof e!="string"?this.titleFromDisplayField:e}async getTitle(e,i,r){const s=i.getObjectId()??i.attributes[e.objectIdField];return(await this.getTitles(e,[i],r)).get(s)??""}async getTitles(e,i,r){const s=new Map,n=r?.timeZone??"system";try{const[{substituteFieldsInLinksAndAttributes:a}]=await Promise.all([this.featureUtilsPromise,this._arcadeTask?.promise]);r?.fetchMissingFields&&(i=await this._checkAndReQueryGraphics(e,i));const{fieldInfoMap:o,workingTitle:l}=this,u=l&&o;i.forEach(d=>{const f=d.getObjectId()??d.attributes[e.objectIdField];let g=u?a({attributes:d.attributes,expressionAttributes:null,fieldInfoMap:o,globalAttributes:this._createFormattedAttributes(e,d,n).global,layer:e,text:l}):"";r?.removeHTML&&(g=Eht.sanitize(g).replaceAll(qCt," ")),s.set(f,g)})}catch{}return s}async _checkAndReQueryGraphics(e,i){const r=i.map(s=>s.getObjectId()??s.attributes[e.objectIdField]).filter(wl);if(r.length!==i.length)return i;if(i.some(s=>!fmt(s,this.requiredFields))){const s=e.createQuery();s.where="1=1",s.outFields=[...this.requiredFields],s.objectIds=r;const n=await e.queryFeatures(s);if(n?.features.length===i.length)return n.features}return i}_createFieldInfoMap(e){const i=new Map;if(!e)return i;for(const r of e){if(!r.fieldName)continue;const s=this.fieldsIndex.get(r.fieldName),n=s?.name??r.fieldName;r.fieldName=n,i.set(n.toLowerCase(),r)}return i}_createFormattedAttributes(e,i,r="system"){const s=this.effectivePopupTemplate?.fieldInfos??[],n={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const o=this._arcadeTask.value.Feature.createFromGraphicLikeObject(i.geometry,i.attributes,e,null);for(const l of this.calculatedExpressions)try{n[`expression/${l.name}`]=l.func({vars:{$feature:o}})}catch{}}const a={...i.attributes,...n};return{global:this._featureUtils.formatAttributes({fieldInfos:s,attributes:a,graphic:i,timeZone:r,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return wue(e).filter(i=>!(i.startsWith(UCt)||i.startsWith(BCt)))}};c([p({readOnly:!0})],yc.prototype,"_arcadeTask",null),c([p()],yc.prototype,"_featureUtils",void 0),c([p({readOnly:!0})],yc.prototype,"featureUtilsPromise",null),c([p({readOnly:!0})],yc.prototype,"calculatedExpressions",null),c([p()],yc.prototype,"displayField",void 0),c([p()],yc.prototype,"effectivePopupTemplate",void 0),c([p()],yc.prototype,"expressionsUsedInTitle",null),c([p()],yc.prototype,"fieldsIndex",void 0),c([p()],yc.prototype,"fieldInfoMap",null),c([p()],yc.prototype,"fields",void 0),c([p()],yc.prototype,"objectIdField",void 0),c([p()],yc.prototype,"requiredFields",null),yc=c([R("esri.layers.support.TitleCreator")],yc);const b3=[];function GCt(t,e){if(pq(t.url??""))return!0;const{wkid:i}=e;for(const r of b3){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}b3.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),b3.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),b3.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),b3.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),b3.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]);async function HCt(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Sp(r.populateFromStyle());if(ct(i),s.ok===!1){const n=s.error;e?.messages&&e.messages.push(new Gu("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e?.origin)}}}function WCt({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const a=QCt({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!a.length)return null;const o=eMt({titleBase:s,fields:i,displayField:t}),l=KCt();return new wP({title:o,content:l,fieldInfos:a})}const ZCt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):Zft(t,e);function YCt({fields:t,ignoreFieldTypes:e,sortDisabled:i}){const r=t;return e&&(t=t.filter(s=>!e.includes(s.type))),t===r&&(t=t.slice()),i!==!0&&t.sort(JCt),t}function JCt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:ySe(t)?-1:ySe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function QCt(t,e){const i=e?.visibleFieldNames;return YCt({fields:t.fields??[],ignoreFieldTypes:e?.ignoreFieldTypes||tMt,sortDisabled:e?.sortDisabled}).map(r=>new D7({fieldName:r.name,isEditable:N5e(r,t),label:r.alias,format:XCt(r),visible:ZCt(r,{...t,visibleFieldNames:i})}))}function XCt(t){switch(t.type){case"small-integer":case"integer":return new x0({digitSeparator:!0,places:0});case"single":case"double":return new x0({digitSeparator:!0,places:2});case"string":return gmt(t.name)?new x0({digitSeparator:!0,places:0}):void 0;default:return}}function KCt(){return[new IO,new RO]}function eMt(t){const e=zft(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function ySe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:t.alias?.toLowerCase()==="name"}const tMt=["geometry","blob","raster","guid","xml"],Io="FeatureLayer";function TV(t,e){return new q("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function vSe(t){return t&&t instanceof ke}const bQ=zCt();function wQ(t,e,i){const r=!!i?.writeLayerSchema;return{enabled:r,ignoreOrigin:r}}let mt=class extends CTt(pCt(n2t(xCt(i2t(Kxt(UNe(_Ct(OCt(RCt(oje(MCt(vxt(mCt(bCt(EF(Bxt(yxt(nt(zs))))))))))))))))))){constructor(...e){super(...e),this.attributeTableTemplate=null,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new dxt(this),this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="ArcGISFeatureLayer",this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Me.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=HL(async(i,r,s)=>{const{save:n,saveAs:a}=await W(()=>import("./featureLayerUtils-S1DPo9w_.js"),__vite__mapDeps([266,267,126]));switch(i){case 0:return n(this,r);case 1:return a(this,s,r)}})}destroy(){this.source?.destroy()}normalizeCtorArgs(e,i){return typeof e=="string"?{url:e,...i}:e}load(e){const i=e!=null?e.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(i).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},e).catch(ml).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstValidLayerId(i);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new q("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(i))}).then(()=>YSt(this,"load",e));return this.addResolvingPromise(r),Promise.resolve(this)}get _titleCreator(){const e=this._get("_titleCreator");return Pe(e),new yc({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,fields:this.fields,displayField:this.displayField,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}readCapabilities(e,i){return i=i.layerDefinition||i,EVe(i,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,i){return this._readEditingEnabled(i,!1)}readEditingEnabledFromWebMap(e,i,r){return this._readEditingEnabled(i,!0,r)}writeEditingEnabled(e,i){this._writeEditingEnabled(e,i,!1)}writeEditingEnabledToWebMap(e,i,r,s){this._writeEditingEnabled(e,i,!0,s)}get effectiveEditingEnabled(){return XSt(this)}get featureTitleFields(){return[...this._titleCreator.requiredFields]}set fieldConfigurations(e){if(this._hasMemorySource()||(this._override("fieldConfigurations",e),!this.loaded))return;const i=kCt(this,e);i&&this._set("popupTemplate",i)}get fieldConfigurations(){if(!this._hasMemorySource())return this._isOverridden("fieldConfigurations")?this._get("fieldConfigurations"):ICt(this)||null}readIsTable(e,i){return(i=i?.layerDefinition??i).type==="Table"||!i.geometryType}writeIsTable(e,i,r,s){s?.writeLayerSchema&&ra(r,e?"Table":"Feature Layer",i)}readGlobalIdField(e,i){return yVe(i.layerDefinition||i)}readObjectIdField(e,i){return vVe(i.layerDefinition||i)}writePopupTemplate(e,i,r,s){e&&(i[r]=e.toJSON({...s,writeFieldFormat:!s?.writeLayerSchema}))}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Qwe(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,i,r){i=i.layerDefinition||i;const s=i.drawingInfo?.renderer;if(s){const n=K5(s,i,r)??void 0;return n||re.getLogger(this).error("Failed to create renderer",{rendererDefinition:i.drawingInfo.renderer,layer:this,context:r}),n}return Che(i,r)}set source(e){const i=this._get("source");i!==e&&(vSe(i)&&this._resetMemorySource(i),vSe(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof ke?new Fv({layer:this,items:e}):e:null}readSource(e,i){const r=mo.fromJSON(i.featureSet);return new Fv({layer:this,items:r?.features??[]})}readTemplates(e,i){const r=i.editFieldsInfo,s=r?.creatorField,n=r?.editorField;return e=e?.map(a=>xg.fromJSON(a)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,i){const r=i.layerDefinition?.name??i.name,s=i.title||i.layerDefinition?.title;if(r){const n=this.portalItem?.title;if(this.sublayerTitleMode==="item-title")return this.url?est(this.url,r):r;let a=r;if(!a&&this.url){const o=Zg(this.url);o!=null&&(a=o.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&n&&n!==a&&(a=n+" - "+a),rce(a)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,i){return i.title||i.layerDefinition?.name}readTypeIdField(e,i){let r=(i=i.layerDefinition||i).typeIdField;if(r&&i.fields){r=r.toLowerCase();const s=i.fields.find(n=>n.name.toLowerCase()===r);s&&(r=s.name)}return r}readTypes(e,i){e=(i=i.layerDefinition||i).types;const r=i.editFieldsInfo,s=r?.creatorField,n=r?.editorField;return e?.map(a=>(a=mg.fromJSON(a),this._fixTemplates(a.templates,s),this._fixTemplates(a.templates,n),a))}readVisible(e,i){return i.layerDefinition?.defaultVisibility!=null?!!i.layerDefinition.defaultVisibility:i.visibility!=null?!!i.visibility:void 0}async addAttachment(e,i){const r=await OSt(this,e,i,Io);return this.lastEditsEventDate=new Date,r}async updateAttachment(e,i,r){const s=await PSt(this,e,i,r,Io);return this.lastEditsEventDate=new Date,s}async applyEdits(e,i){return RSt(this,e,i)}async uploadAssets(e,i){return ISt(this,e,i)}createFieldConfigurations(){return DCt(this)}createPopupTemplate(e){return WCt(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:i}=await A0(W(()=>import("./FeatureLayerSource-UPGgnQd3.js"),__vite__mapDeps([268,269,270,271,272,24,19,273,274,37,35,36,114])),e);return new i({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:e})}createQuery(){const e=BSt(this);e.dynamicDataSource=this.dynamicDataSource;const i=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,r=$4(this.definitionExpression,i);return e.where=r||"1=1",e}async deleteAttachments(e,i){const r=await DSt(this,e,i,Io);return this.lastEditsEventDate=new Date,r}async fetchRecomputedExtents(e){return kSt(this,e,Io)}async getFeatureTitle(e,i){return this._titleCreator.getTitle(this,e,i)}async getFeatureTitles(e,i){return this._titleCreator.getTitles(this,e,i)}getFeatureType(e){return wVe(this.types,this.typeIdField,e)}getFieldAlias(e){const i=this.getField(e);if(i)return this.getFieldConfiguration(i.name)?.alias||i.alias}getFieldConfiguration(e){return e=e.toLowerCase(),this.fieldConfigurations?.find(i=>i.name.toLowerCase()===e)}getFieldDomain(e,i){return GSt(this,e,i,this.getField(e)?.domain??null)}async queryAttachments(e,i){return LSt(this,e,i,Io)}async queryFeatures(e,i){const r=await this.load(),s=await r.source.queryFeatures(Ct.from(e)??r.createQuery(),i),n=this.graphicOrigin;if(s?.features)for(const a of s.features)a.layer=a.sourceLayer=r,a.origin=n;return s}async queryObjectIds(e,i){return await FSt(this,e,i,Io)}async queryFeatureCount(e,i){return zSt(this,e,i,Io)}async queryExtent(e,i){return NSt(this,e,i,Io)}async queryRelatedFeatures(e,i){return VSt(this,e,i,Io)}async queryRelatedFeaturesCount(e,i){return jSt(this,e,i,Io)}async queryPivot(e,i){const{source:r,capabilities:s}=await this.load();if(!r.queryPivot||!s?.operations?.supportsQueryPivot)throw new q(Io,"Layer source does not support queryPivot capability");const n=await W(()=>import("./PivotQuery-KWX8IEZC.js").then(o=>o.P),[]),a=await r.queryPivot(n.default.from(e),i);if(a?.features)for(const o of a.features)o.layer=o.sourceLayer=this;return a}async queryTopFeatures(e,i){const{source:r,capabilities:s}=await this.load();if(!r.queryTopFeatures||!s?.query?.supportsTopFeaturesQuery)throw new q(Io,"Layer source does not support queryTopFeatures capability");const n=await W(()=>import("./TopFeaturesQuery-DyEELIfJ.js"),[]),a=await r.queryTopFeatures(n.default.from(e),i);if(a?.features)for(const o of a.features)o.layer=o.sourceLayer=this;return a}async queryAttributeBins(e,i){const{source:r,capabilities:s}=await this.load();if(!r.queryAttributeBins)throw new q(Io,"Layer source does not support queryAttributeBins capability");iTt(e,s,Io);const n=await W(()=>import("./AttributeBinsQuery-Ccy6qrx9.js"),__vite__mapDeps([190,14,21])),a=await r.queryAttributeBins(n.default.from(e),i);if(a.features)for(const o of a.features)o.layer=o.sourceLayer=this;return a}async queryTopObjectIds(e,i){const{source:r,capabilities:s}=await this.load();if(!r.queryTopObjectIds||!s?.query.supportsTopFeaturesQuery)throw new q(Io,"Layer source does not support queryTopObjectIds capability");const n=await W(()=>import("./TopFeaturesQuery-DyEELIfJ.js"),[]);return(await r.queryTopObjectIds(n.default.from(e),i)).filter(Yx)}async queryTopFeaturesExtent(e,i){const{source:r,capabilities:s}=await this.load();if(!r.queryTopExtents||!s?.query?.supportsTopFeaturesQuery)throw new q(Io,"Layer source does not support queryTopExtents capability");const n=await W(()=>import("./TopFeaturesQuery-DyEELIfJ.js"),[]);return r.queryTopExtents(n.default.from(e),i)}async queryTopFeatureCount(e,i){const{source:r,capabilities:s}=await this.load();if(!r.queryTopCount||!s?.query?.supportsTopFeaturesQuery)throw new q(Io,"Layer source does not support queryFeatureCount capability");const n=await W(()=>import("./TopFeaturesQuery-DyEELIfJ.js"),[]);return r.queryTopCount(n.default.from(e),i)}read(e,i){const r=e.featureCollection;if((r||e.type==="Feature Collection")&&(this.resourceInfo=e),r){const{layers:s,showLegend:n}=r;s?.length===1&&(super.read(s[0],i),n!=null&&super.read({showLegend:n},i))}super.read(e,i),i&&i.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,i){i={...i,origin:i?.origin??void 0,writeLayerSchema:i?.writeLayerSchema??this._hasMemorySource()};const{origin:r,layerContainerType:s,messages:n}=i;if(this.dynamicDataSource)return n?.push(TV(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((r==="web-map"||r==="web-scene")&&s!=="tables")return n?.push(TV(this,`a table source can only be written to tables, not ${s}`)),null;if(this._hasMemorySource())return n?.push(TV(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(r==="web-map"||r==="web-scene")&&s==="tables")return n?.push(TV(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(e,i)}clone(){if(this._hasMemorySource())throw new q(Io,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source?.type==="memory"||GCt(this,e))}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,i){return this._debouncedSaveOperations(1,i,e)}_readEditingEnabled(e,i,r){let s=e.layerDefinition?.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,i&&r?.origin==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(i=>i.trim()).includes("editing")}_writeEditingEnabled(e,i,r,s){if(!e){const n=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";ra("layerDefinition.capabilities",n,i),r&&!s?.writeLayerSchema&&(i.capabilities=n)}}_fetchFirstValidLayerId(e){return Si(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(i=>{const r=i.data;if(r)return this.applyPreferredHost(r),this.findFirstValidLayerId(r)})}async initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Qwe(this.renderer,this.fieldsIndex),k5e(this.timeInfo,this.fieldsIndex),this._hasMemorySource()&&this.geometryType==="mesh"&&(this.capabilities.query.supportsReturnMesh=!0),HCt(this,{origin:"service"})}async hasDataChanged(){return USt(this)}async fetchPublishingStatus(){const e=this.source;return e?.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){const e=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||this.fields?.some(i=>i.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,i){e&&e.forEach(r=>{const s=r.prototype?.attributes;s&&i&&delete s[i]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new q("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new q("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(i=>{i.layer=this,i.sourceLayer=this}),this.addHandles([e.on("after-add",i=>{i.item.layer=this,i.item.sourceLayer=this}),e.on("after-remove",i=>{i.item.layer=null,i.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(i=>{i.layer=null,i.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(e){return Array.isArray(e.layers)&&e.layers.length>0?e.layers[0].id:Array.isArray(e.tables)&&e.tables.length>0?e.tables[0].id:void 0}};c([p({clonable:!1,readOnly:!0})],mt.prototype,"_titleCreator",null),c([p(x2t)],mt.prototype,"attributeTableTemplate",void 0),c([Oe("service","capabilities")],mt.prototype,"readCapabilities",null),c([p({json:{origins:{"web-scene":{write:!1}},write:!0}})],mt.prototype,"charts",void 0),c([p({readOnly:!0})],mt.prototype,"createQueryVersion",null),c([p({json:{read:{source:"layerDefinition.copyrightText"}}})],mt.prototype,"copyright",void 0),c([p({json:{read:{source:"layerDefinition.displayField"}}})],mt.prototype,"displayField",void 0),c([p({types:Vh,readOnly:!0})],mt.prototype,"defaultSymbol",void 0),c([p({type:Cf})],mt.prototype,"dynamicDataSource",void 0),c([p({type:Boolean})],mt.prototype,"editingEnabled",null),c([Oe(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],mt.prototype,"readEditingEnabled",null),c([Oe("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],mt.prototype,"readEditingEnabledFromWebMap",null),c([Ie(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],mt.prototype,"writeEditingEnabled",null),c([Ie("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],mt.prototype,"writeEditingEnabledToWebMap",null),c([p({readOnly:!0})],mt.prototype,"effectiveEditingEnabled",null),c([p({clonable:!1,readOnly:!0})],mt.prototype,"featureTitleFields",null),c([p({type:[aw],json:{name:"layerDefinition.fieldConfigurations",write:{overridePolicy(t,e,i){return{enabled:!i?.writeLayerSchema,ignoreOrigin:this.originIdOf(e)===1}}}}})],mt.prototype,"fieldConfigurations",null),c([p({...bQ.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:wQ}}}}})],mt.prototype,"fields",void 0),c([p(bQ.fieldsIndex)],mt.prototype,"fieldsIndex",void 0),c([p({type:hf,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],mt.prototype,"formTemplate",void 0),c([p({json:{read:{source:"layerDefinition.extent"}}})],mt.prototype,"fullExtent",void 0),c([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:wQ,writer(t,e,i){const r=t?fne.toJSON(t):null;r&&ra(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:fne.read}}})],mt.prototype,"geometryType",void 0),c([p({readOnly:!0,clonable:!1})],mt.prototype,"graphicOrigin",void 0),c([p({json:{read:{source:"layerDefinition.hasM"}}})],mt.prototype,"hasM",void 0),c([p({json:{read:{source:"layerDefinition.hasZ"}}})],mt.prototype,"hasZ",void 0),c([p(_2t)],mt.prototype,"id",void 0),c([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],mt.prototype,"infoFor3D",void 0),c([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],mt.prototype,"isTable",void 0),c([Oe("service","isTable",["type","geometryType"]),Oe("isTable",["layerDefinition.type","layerDefinition.geometryType"])],mt.prototype,"readIsTable",null),c([Ie("web-map","isTable")],mt.prototype,"writeIsTable",null),c([p(Y7)],mt.prototype,"labelsVisible",void 0),c([p({type:[Js],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:mSe,write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:mSe,write:{layerContainerTypes:Es}}})],mt.prototype,"labelingInfo",void 0),c([p((()=>{const t=se(v2t);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){ra(r,vF(e),i)}}},t})())],mt.prototype,"opacity",void 0),c([p(g2t)],mt.prototype,"legendEnabled",void 0),c([p({type:["show","hide"],json:(()=>{const t=se(tVe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],mt.prototype,"listMode",void 0),c([Oe("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],mt.prototype,"readGlobalIdField",null),c([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:wQ}}}}})],mt.prototype,"objectIdField",void 0),c([Oe("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],mt.prototype,"readObjectIdField",null),c([p({type:["ArcGISFeatureLayer"],json:{write:{target:"layerType",ignoreOrigin:!0,layerContainerTypes:Es}}})],mt.prototype,"operationalLayerType",void 0),c([p(bQ.outFields)],mt.prototype,"outFields",void 0),c([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],mt.prototype,"path",void 0),c([p(Z7)],mt.prototype,"popupEnabled",void 0),c([p({type:wP,json:{name:"popupInfo",write:!0}})],mt.prototype,"popupTemplate",void 0),c([Ie("popupTemplate")],mt.prototype,"writePopupTemplate",null),c([p({readOnly:!0})],mt.prototype,"defaultPopupTemplate",null),c([p({types:PF,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:tCt,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:Es,overridePolicy:(t,e,i)=>({ignoreOrigin:i?.writeLayerSchema,layerContainerTypes:Es})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i?.writeLayerSchema,layerContainerTypes:Es})}}})],mt.prototype,"renderer",null),c([Oe("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Oe("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],mt.prototype,"readRenderer",null),c([p()],mt.prototype,"resourceInfo",void 0),c([p((()=>{const t=se(f2t);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],mt.prototype,"screenSizePerspectiveEnabled",void 0),c([p({clonable:!1})],mt.prototype,"source",null),c([wi("source")],mt.prototype,"castSource",null),c([Oe("portal-item","source",["featureSet"]),Oe("web-map","source",["featureSet"])],mt.prototype,"readSource",null),c([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],mt.prototype,"spatialReference",void 0),c([p({type:Number})],mt.prototype,"subtypeCode",void 0),c([p({type:[xg]})],mt.prototype,"templates",void 0),c([Oe("templates",["editFieldsInfo","creatorField","editorField","templates"])],mt.prototype,"readTemplates",null),c([p({type:zo})],mt.prototype,"timeInfo",void 0),c([p()],mt.prototype,"title",void 0),c([Oe("service","title",["name"]),Oe("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],mt.prototype,"readTitle",null),c([Oe("web-map","title",["layerDefinition.name","title"])],mt.prototype,"readTitleFromWebMap",null),c([p({type:String})],mt.prototype,"sublayerTitleMode",void 0),c([p({json:{read:!1}})],mt.prototype,"type",void 0),c([p({type:String})],mt.prototype,"typeIdField",void 0),c([Oe("service","typeIdField"),Oe("typeIdField",["layerDefinition.typeIdField"])],mt.prototype,"readTypeIdField",null),c([p({type:[mg]})],mt.prototype,"types",void 0),c([Oe("service","types",["types"]),Oe("types",["layerDefinition.types"])],mt.prototype,"readTypes",null),c([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility",layerContainerTypes:Es}}}}})],mt.prototype,"visible",void 0),c([Oe("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],mt.prototype,"readVisible",null),mt=c([R("esri.layers.FeatureLayer")],mt);const Dmi=Object.freeze(Object.defineProperty({__proto__:null,get default(){return mt}},Symbol.toStringTag,{value:"Module"}));let pv=class extends ae{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};c([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.moment=t?t.getTime():null}}}})],pv.prototype,"moment",void 0),c([p({type:Boolean,json:{write:!0}})],pv.prototype,"fullUpdate",void 0),c([p({type:Boolean,json:{write:!0}})],pv.prototype,"validateErrorsCreated",void 0),c([p({type:Boolean,json:{write:!0}})],pv.prototype,"exceededTransferLimit",void 0),c([p({type:[Object],json:{write:!0}})],pv.prototype,"serviceEdits",void 0),c([p({type:[Object],json:{write:!0}})],pv.prototype,"discoveredSubnetworks",void 0),pv=c([R("esri.rest.networks.support.ValidateNetworkTopologyResult")],pv);const iMt=pv,rMt=so()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let Cb=class extends iMt{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const i={...e,query:{f:"json"}},{data:r}=await Si(this.statusUrl,i);return this.read(r),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(e={}){const{interval:i=1e3,statusCallback:r}=e;return new Promise((s,n)=>{this._clearTimer();const a=setInterval(()=>{this._timer||n(ti()),this.checkJobStatus().then(o=>{const{status:l}=o;switch(this.status=l,l){case"job-succeeded":this._clearTimer(),s(this);break;case"job-waiting":case"job-executing":r&&r(this)}},o=>{this._clearTimer(),n(o)})},i);this._timer=a})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};c([p()],Cb.prototype,"editsResolver",void 0),c([p({type:String,json:{write:!0}})],Cb.prototype,"statusUrl",void 0),c([st(rMt)],Cb.prototype,"status",void 0),c([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.submissionTime=t?t.getTime():null}}}})],Cb.prototype,"submissionTime",void 0),c([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.lastUpdatedTime=t?t.getTime():null}}}})],Cb.prototype,"lastUpdatedTime",void 0),Cb=c([R("esri.networks.support.TopologyValidationJobInfo")],Cb);const sMt=Cb;function nMt(t,e,i="from"){const{fromRuleElement:r,viaRuleElement:s,toRuleElement:n}=lje(t),a=[];switch(t.ruleType){case 2:case 3:i==="from"&&Of(e,r,!1)?a.push(n):i==="to"&&Of(e,n,!1)&&a.push(r);break;case 4:case 1:Of(e,r,!0)?a.push(n):Of(e,n,!0)&&a.push(r);break;case 5:s&&(Of(e,s,!0)?(a.push(r),a.push(n)):(Of(e,r,!0)||Of(e,n,!0))&&a.push(s));break;default:return[]}return a}function nk(t,e,i){const{fromRuleElement:r,viaRuleElement:s,toRuleElement:n}=lje(t);switch(t.ruleType){case 2:case 3:return $V(e,i,r,n,!1,!1);case 4:case 1:return $V(e,i,r,n,!0,!0);case 5:return $V(e,i,r,s,!0,!0)||$V(e,i,n,s,!0,!0);default:return!1}}function $V(t,e,i,r,s,n){if(!i||!r)return!1;const a=Of(t,i,n),o=Of(e,r,n);if(s){const l=Of(t,r,n),u=Of(e,i,n);return a&&o||l&&u}return a&&o}function aMt(t,e){const i=t.terminal?.terminalId,r=e.terminalId;return i==null&&r==null||(i===1?r==null||r===1:i===r)}function Of(t,e,i){const{assetGroupCode:r,assetTypeCode:s}=t;return("layerId"in t?t.layerId===e.networkSource?.layerId:t.networkSourceId===e.networkSource?.sourceId)&&(r==null||r===e.assetGroup?.assetGroupCode)&&(s==null||s===e.assetType?.assetTypeCode)&&(!i||!("terminalId"in t)||aMt(e,t))}function lje(t){return{fromRuleElement:{networkSource:t.fromNetworkSource,assetGroup:t.fromAssetGroup,assetType:t.fromAssetType,terminal:t.fromTerminal},viaRuleElement:t.viaNetworkSource?{networkSource:t.viaNetworkSource,assetGroup:t.viaAssetGroup,assetType:t.viaAssetType,terminal:t.viaTerminal}:void 0,toRuleElement:{networkSource:t.toNetworkSource,assetGroup:t.toAssetGroup,assetType:t.toAssetType,terminal:t.toTerminal}}}function zC(t){let e=null,i=null,r=null;if(A5e(t))e=kne(t),[i,r]=oMt(t);else if(r0(t)){e=t.parent?.layerId??null;const[s]=aG(t);s===t.subtypeField&&(i=t.subtypeCode)}else e=t.layerId??null;return{layerId:e,assetGroupCode:i,assetTypeCode:r}}function kne(t){const{sourceLayer:e}=t;let i;return F4e(e)?i=e.layerId:r0(e)&&(i=e.parent?.layerId),i??null}function oMt(t){const[e,i]=aG(t.sourceLayer);return[e?t.attributes[e]:null,i?t.attributes[i]:null]}function aG(t){return!t||!("fieldsIndex"in t)?[null,null]:[t.fieldsIndex.normalizeFieldName("assetGroup")??null,t.fieldsIndex.normalizeFieldName("assetType")??null]}async function _Se(t,e){if(t==="Utility Network Layer"){const{default:i}=await W(()=>Promise.resolve().then(()=>xMt),void 0);return new i({layerUrl:e})}return null}async function lMt(t){let e="portalItem"in t?t:{portalItem:t};!e.portalItem||e.portalItem instanceof qt||(e={...e,portalItem:new qt(e.portalItem)});const i=e.portalItem;if(await i.load(),i.type!=="Feature Service")throw new q("portal:unknown-item-type","Unknown item type '${type}'",{type:i.type});const r=i.url,s=await Si(r,{responseType:"json",query:{f:"json"}}),n="Network Layer";if(s.data.type?.includes(n))return _Se(s.data.type,r);if(s.data.layers){const a=s.data.layers.find(o=>o.type.includes(n));if(a){const o=`${r}/${a.id}`;return _Se(a.type,o)}}return null}let An=class extends EF($$){static fromPortalItem(e){return lMt(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this._historicMoment=null,this._gdbVersion=null,this._sourceIdByLayerId=new Map,this._layerIdBySourceId=new Map,this._applyEditsHandler=i=>{const{serviceUrl:r,gdbVersion:s,result:n}=i,a=r===this.featureServiceUrl,o=z4(r,s,this.gdbVersion);a&&o&&n.then(l=>{YU(r,s)&&(this.historicMoment=l.historicMoment)})},this._updateMomentHandler=i=>{const{serviceUrl:r,gdbVersion:s,moment:n}=i,a=r===this.featureServiceUrl,o=z4(r,s,this.gdbVersion);a&&o&&(this.historicMoment=n)},this.when().then(()=>{this.addHandles([WNe(this._applyEditsHandler),ZNe(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(e=>{Zr(e)||re.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}get loaded(){return super.loaded}get datasetName(){return this.dataElement?.name??null}get owner(){return this.dataElement?.userIdentity??null}get schemaGeneration(){return this.dataElement?.schemaGeneration??null}get parsedUrl(){return kn(this.layerUrl)}get featureServiceUrl(){return Zg(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return Zg(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}get gdbVersion(){return this._gdbVersion}set gdbVersion(e){this._gdbVersion=e}get historicMoment(){return this._historicMoment}set historicMoment(e){this._historicMoment=e}async load(e){return this.addResolvingPromise(this._load(e)),this}async _load(e){await Promise.all([this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e),this._fetchLayerMetaData(this.layerUrl,e)])}getLayerIdBySourceId(e){if(!this.dataElement)return null;const i=this._layerIdBySourceId.get(e);if(i!=null)return i;const r=this.dataElement.domainNetworks,s=this._traverseNetworkSources(r,this._layerIdBySourceId,"sourceId","layerId",e);return s>=0?s:null}getSourceIdByLayerId(e){if(!this.dataElement)return null;const i=this._sourceIdByLayerId.get(e);if(i!=null)return i;const r=this.dataElement.domainNetworks,s=this._traverseNetworkSources(r,this._sourceIdByLayerId,"layerId","sourceId",e);return s>=0?s:null}getObjectIdsFromElements(e){const i=[],r=new Map;for(const n of e){const a=this.getLayerIdBySourceId(n.networkSourceId);if(a==null)continue;let o=r.get(a);o===void 0&&(o=[]),o.push(n.objectId),r.set(a,o)}const s=this.featureServiceUrl;return r.forEach((n,a)=>i.push({layerUrl:`${s}/${a}`,objectIds:n})),i}async queryNamedTraceConfigurations(e,i){const[{queryNamedTraceConfigurations:r},{default:s}]=await Promise.all([W(()=>import("./queryNamedTraceConfigurations-DoJsh6kq.js"),[]),W(()=>import("./QueryNamedTraceConfigurationsParameters-BQyVFJnc.js"),[])]),n=this.networkServiceUrl,a=s.from(e);return(await r(n,a,{...i}))?.namedTraceConfigurations}async validateTopology(e,i){if(!e.validateArea)throw new q("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:r},{default:s}]=await Promise.all([W(()=>import("./validateNetworkTopology-BnHmNZob.js"),[]),W(()=>import("./ValidateNetworkTopologyParameters-BzTMgUjF.js"),[])]),n=s.from(e);YU(this.featureServiceUrl,this.gdbVersion||null)?(n.sessionID=jse,await u2e(this.featureServiceUrl,this.gdbVersion,!0)):n.sessionID=null,n.gdbVersion=this.gdbVersion;const a=this.networkServiceUrl,o=this.featureServiceUrl,l=h2e(o,null,this.gdbVersion,!0),u=await r(a,n,{...i});if(u?.serviceEdits){const d=[];for(const f of u.serviceEdits){const{editedFeatures:g}=f,v=g?.spatialReference?new Me(g.spatialReference):null;d.push({layerId:f.layerId,editedFeatures:{adds:g?.adds?.map(_=>CV(_,v))||[],updates:g?.updates?.map(_=>({original:CV(_[0],v),current:CV(_[1],v)}))||[],deletes:g?.deletes?.map(_=>CV(_,v))||[],spatialReference:v}})}l.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:d,exceededTransferLimit:!1,historicMoment:u.moment})}return u}async submitTopologyValidationJob(e,i){let r=null;if(!e.validateArea)throw new q("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const d=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");r=(await Si(d,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:s},{default:n}]=await Promise.all([W(()=>import("./validateNetworkTopology-BnHmNZob.js"),[]),W(()=>import("./ValidateNetworkTopologyParameters-BzTMgUjF.js"),[])]),a=n.from(e);YU(this.featureServiceUrl,this.gdbVersion||null)?(a.sessionID=jse,await u2e(this.featureServiceUrl,this.gdbVersion,!0)):a.sessionID=null,a.gdbVersion=this.gdbVersion||r;const o=this.networkServiceUrl,l=this.featureServiceUrl?h2e(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,u=await s(o,a,{...i});return new sMt({statusUrl:u,editsResolver:l})}getSourceTypeById(e){if(!this.dataElement)return null;for(const i of this.dataElement.domainNetworks)for(const r of[i.edgeSources??[],i.junctionSources??[]])for(const s of r)if(s.sourceId===e)return r===i.edgeSources?"edge":"junction";return null}_traverseNetworkSources(e,i,r,s,n){for(const a of e)for(const o of[a.edgeSources??[],a.junctionSources??[]])for(const l of o)if(l[r]===n)return i.set(n,l[s]),l[s];return-1}async _fetchLayerMetaData(e,i){const r=await Si(e,{responseType:"json",query:{f:"json"},...i});this.sourceJSON=r.data,this.read(r.data,{origin:"service"})}async _fetchDataElement(e,i,r){if(this.dataElement)return;const s=await Si(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([i]),f:"json"},...r}).then(n=>n.data.layerDataElements?.[0]);s&&this.read(s,{origin:"service"})}};function CV(t,e){return new ms({attributes:t.attributes,geometry:wp({...t.geometry,spatialReference:e})})}c([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],An.prototype,"id",void 0),c([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],An.prototype,"title",void 0),c([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],An.prototype,"layerUrl",void 0),c([p({type:Object,json:{origins:{service:{read:!0}},read:!1}})],An.prototype,"dataElement",void 0),c([p({type:It,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],An.prototype,"fullExtent",void 0),c([p({type:Me,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],An.prototype,"spatialReference",void 0),c([p({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],An.prototype,"type",void 0),c([p({readOnly:!0})],An.prototype,"datasetName",null),c([p({readOnly:!0})],An.prototype,"owner",null),c([p({readOnly:!0})],An.prototype,"schemaGeneration",null),c([p({readOnly:!0})],An.prototype,"parsedUrl",null),c([p({readOnly:!0})],An.prototype,"featureServiceUrl",null),c([p({readOnly:!0})],An.prototype,"networkServiceUrl",null),c([p({readOnly:!0})],An.prototype,"layerId",null),c([p()],An.prototype,"sourceJSON",void 0),c([p({readOnly:!0})],An.prototype,"networkSystemLayers",null),c([p({type:String})],An.prototype,"gdbVersion",null),c([p({type:Date})],An.prototype,"historicMoment",null),c([p()],An.prototype,"_historicMoment",void 0),c([p()],An.prototype,"_gdbVersion",void 0),An=c([R("esri.networks.Network")],An);const cMt=An;let Mb=class extends iy($$){constructor(e){super(e),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=Si}initialize(){}async load(e){const i=this.rulesLayer.load(e).then(()=>this._initializeRulesTable());return this.addResolvingPromise(i),this}getFeaturesCanAssociateWithClause(e,i,r){const s=new Map,[n,a]=aG(e.sourceLayer);if(!n||!a)return"";const o=zC(e),l=zC(i);r.forEach(d=>{const{type:f,direction:g}=d;this._getRulesForAssociationType(f).forEach(v=>{nMt(v,o,g).filter(_=>_.networkSource?.layerId===l.layerId).forEach(_=>{const x=_.assetGroup?.assetGroupCode,S=_.assetType?.assetTypeCode;if(x!=null&&S!=null){const T=s.get(x)??new Set;T.add(S),s.set(x,T)}})})});let u=[];return this._mergeAssetCodes(s).forEach((d,f)=>{const g=`${n} IN (${f})`,v=vft(a,[...d]);g&&v&&u.push($4(g,v))}),u.length>1&&(u=u.map(d=>`(${d})`)),u.join(" OR ")}getFeaturesCanAssociateWith(e,i,r){return kne(e)==null?[]:i.filter(s=>this.canAssociateFeatures(e,s,r))}canAssociateFeatures(e,i,r){if(!this._canSupportAssociations([e,i]))return!1;const s=zC(e),n=zC(i);return r.some(a=>{const{type:o,direction:l}=a;return this._getRulesForAssociationType(o).some(u=>l==="to"?nk(u,n,s):nk(u,s,n))})}getLayersCanAssociateWith(e,i,r){return kne(e)==null?[]:i.filter(s=>this.canAssociateFeatureToLayer(e,s,r))}canAssociateFeatureToLayer(e,i,r){if(!this._canSupportAssociations([e,i]))return!1;const s=zC(e),n=zC(i);return r.some(a=>{const{type:o,direction:l}=a;return this._getRulesForAssociationType(o).some(u=>l==="to"?nk(u,n,s):nk(u,s,n))})}getFeatureSQL(e,i){const r=e.layerId.toString(),s=e.fieldsIndex?.normalizeFieldName("assetGroup"),n=e.fieldsIndex?.normalizeFieldName("assetType"),a=s?i.attributes[s]:null,o=n?i.attributes[n]:null,l=this.rulesHash[r];if(l){const u=l.assetGroupHash[a];if(u)return u.assetTypeHash[o]||null}return null}_initializeRulesTable(){const e={},i=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const r of this.rules){if(r.ruleType===3){this.rulesCategorized.attachment.push(r);continue}if(r.ruleType===2){this.rulesCategorized.containment.push(r);continue}if(r.ruleType===1){this.rulesCategorized.connectivity.push(r);continue}this.rulesCategorized.connectivity.push(r);let s=[[0,1],[1,0]];r.ruleType===5&&(s=[[0,2],[2,0],[1,2],[2,1]]);for(const n of s){const a=n.shift(),o=n.shift();let l=!1;switch(r.ruleType){case 5:l=a===0||a===1;break;case 4:l=a===1}const u=i[a],d=r[u.networkSourceId]?.layerId.toString()??"",f=r[u.assetGroupId]?.assetGroupCode?.toString(),g=r[u.assetTypeId],v=g?.assetTypeCode?.toString(),_=i[o],x=r[_.networkSourceId]?.layerId.toString()??"",S=r[_.assetGroupId]?.assetGroupCode?.toString(),T=r[_.assetTypeId],M=T?.assetTypeCode?.toString(),E=e[d]??{assetGroupHash:{}};if(!(f&&v&&S&&M))continue;const P=E.assetGroupHash[f]??{assetTypeHash:{}},O=P.assetTypeHash[v]??{};if(O[x]=O[x]??{},l){O[d]=O[d]??{};const L=$4(`assetgroup = ${f}`,`assettype = ${v}`);T?.connectivityPolicy==="esriNECPEndVertex"?O[d].endVertex=O[d]?.endVertex?`${O[d].endVertex}`:`(${L})`:O[d].anyVertex=O[d].anyVertex?`${O[d].anyVertex}`:`(${L})`}const D=$4(`assetgroup = ${S}`,`assettype = ${M}`);T?.connectivityPolicy==="esriNECPEndVertex"?O[x].endVertex=O[x]?.endVertex?fie(O[x].endVertex,D):`(${D})`:O[x].anyVertex=O[x]?.anyVertex?fie(O[x].anyVertex,D):`(${D})`,P.assetTypeHash[v]=O,E.assetGroupHash[f]=P,e[d]=E}}this._set("rulesHash",e)}_getRulesForAssociationType(e){const{rulesCategorized:i}=this;switch(e){case"attachment":return i.attachment;case"containment":return i.containment;case"connectivity":case"junction-junction-connectivity":return i.connectivity.filter(r=>r.ruleType===1);case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return i.connectivity.filter(r=>r.ruleType===4||r.ruleType===5);default:return[]}}_areSetsEqual(e,i){if(e.size!==i.size)return!1;for(const r of e)if(!i.has(r))return!1;return!0}_mergeAssetCodes(e){const i=new Map,r=new Set;for(const[s,n]of e){const a=new Set([s]);for(const[l,u]of e)s!==l&&!r.has(l)&&this._areSetsEqual(n,u)&&(a.add(l),r.add(l));const o=Array.from(a).sort().join(",");i.set(o,n)}return i}_canSupportAssociations(e){return e.every(i=>{const r=A5e(i)?i.sourceLayer:i,[s,n]=aG(r);return s!=null&&n!=null})}};c([p({constructOnly:!0})],Mb.prototype,"rulesLayer",void 0),c([p({constructOnly:!0})],Mb.prototype,"rules",void 0),c([p({readOnly:!0})],Mb.prototype,"rulesHash",void 0),c([p()],Mb.prototype,"rulesCategorized",void 0),c([p({constructOnly:!0})],Mb.prototype,"request",void 0),Mb=c([R("esri.networks.RulesTable")],Mb);let Od=class extends ae{constructor(e){super(e),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};c([p({type:[Object],json:{write:!0}})],Od.prototype,"conditionBarriers",void 0),c([p({type:[Object],json:{write:!0}})],Od.prototype,"outputConditions",void 0),c([p({type:[Object],json:{write:!0}})],Od.prototype,"functions",void 0),c([p({type:[Object],json:{write:!0}})],Od.prototype,"functionBarriers",void 0),c([p({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],Od.prototype,"traversabilityScope",void 0),c([p({type:String,json:{write:!0}})],Od.prototype,"shortestPathNetworkAttributeName",void 0),c([p({type:Boolean,json:{write:!0}})],Od.prototype,"includeBarriers",void 0),c([p({type:Boolean,json:{write:!0}})],Od.prototype,"validateConsistency",void 0),c([p({type:Boolean,json:{write:!0}})],Od.prototype,"ignoreBarriersAtStartingPoints",void 0),Od=c([R("esri.networks.support.TraceConfiguration")],Od);const jhe=Od,xQ=new ii({Clean:"clean",Dirty:"dirty"}),bw=new ii({Physical:"physical",Virtual:"virtual"}),SQ=new ii({"Start and end":"start-and-end",Start:"start",Midspan:"midspan",End:"end"}),MV=new ii({startingPoint:"starting-point",barrier:"barrier",stoppingPoint:"stopping-point"}),EV=new ii({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation",path:"path",circuit:"circuit"}),uMt="{00000000-0000-0000-0000-000000000000}",hMt=new ii({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionEdgeMidspanConnectivity:"junction-edge-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"}),dMt={connectivity:1,"junction-junction-connectivity":1,containment:2,attachment:3,"junction-edge-from-connectivity":4,"junction-edge-midspan-connectivity":5,"junction-edge-to-connectivity":6},Vmi=new ii({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let $s=class extends jhe{constructor(e){super(e),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.circuitName=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.inferConnectivity=null,this.maxHops=null,this.nearestNeighbor=null,this.numPaths=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};c([p({type:[Object],json:{write:!0}})],$s.prototype,"filterBarriers",void 0),c([p({type:String,json:{write:!0}})],$s.prototype,"arcadeExpressionBarrier",void 0),c([p({type:String,json:{write:!0}})],$s.prototype,"circuitName",void 0),c([p({type:String,json:{write:!0}})],$s.prototype,"domainNetworkName",void 0),c([p({type:String,json:{write:!0}})],$s.prototype,"filterBitsetNetworkAttributeName",void 0),c([p({type:[Object],json:{write:!0}})],$s.prototype,"filterFunctionBarriers",void 0),c([p({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],$s.prototype,"filterScope",void 0),c([p({type:Boolean,json:{write:!0}})],$s.prototype,"includeContainers",void 0),c([p({type:Boolean,json:{write:!0}})],$s.prototype,"includeContent",void 0),c([p({type:Boolean,json:{write:!0}})],$s.prototype,"includeIsolated",void 0),c([p({type:Boolean,json:{write:!0}})],$s.prototype,"includeStructures",void 0),c([p({type:Boolean,json:{write:!0}})],$s.prototype,"allowIndeterminateFlow",void 0),c([p({type:Boolean,json:{write:!0}})],$s.prototype,"includeUpToFirstSpatialContainer",void 0),c([p({type:Boolean,json:{write:!0}})],$s.prototype,"inferConnectivity",void 0),c([p({type:Number,json:{write:!0}})],$s.prototype,"maxHops",void 0),c([p({type:Object,json:{write:!0}})],$s.prototype,"nearestNeighbor",void 0),c([p({type:Number,json:{write:!0}})],$s.prototype,"numPaths",void 0),c([p({type:[Object],json:{write:!0}})],$s.prototype,"outputFilterCategories",void 0),c([p({type:[Object],json:{write:!0}})],$s.prototype,"outputFilters",void 0),c([p({type:[Object],json:{write:!0}})],$s.prototype,"propagators",void 0),c([p({type:String,json:{write:!0}})],$s.prototype,"subnetworkName",void 0),c([p({type:String,json:{write:!0}})],$s.prototype,"targetTierName",void 0),c([p({type:String,json:{write:!0}})],$s.prototype,"diagramTemplateName",void 0),c([p({type:String,json:{write:!0}})],$s.prototype,"tierName",void 0),c([p({type:Boolean,json:{write:!0}})],$s.prototype,"validateLocatability",void 0),$s=c([R("esri.networks.support.UNTraceConfiguration")],$s);const pMt=$s;let vu=class extends ohe{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,i){return e.tierName!==void 0?pMt.fromJSON(e):jhe.fromJSON(e)}};c([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],vu.prototype,"globalId",void 0),c([p({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],vu.prototype,"title",void 0),c([p({type:jhe,json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"traceConfiguration",void 0),c([Oe("service","traceConfiguration")],vu.prototype,"readTraceConfiguration",null),c([p({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"creationDate",void 0),c([p({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"creator",void 0),c([p({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"description",void 0),c([p({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],vu.prototype,"minStartingPoints",void 0),c([p({json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"resultTypes",void 0),c([p({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"tags",void 0),c([p({type:EV.apiValues,json:{type:EV.jsonValues,origins:{service:{read:EV.read,write:EV.write}},read:!1}})],vu.prototype,"traceType",void 0),vu=c([R("esri.networks.support.NamedTraceConfiguration")],vu);const fMt=vu;function mMt(t){const e=t?.fieldsIndex,i="fromnetworksourceid",r="fromglobalid",s="fromterminalid",n="fromfirstunit",a="fromnumunits",o="tonetworksourceid",l="toglobalid",u="toterminalid",d="tofirstunit",f="tonumunits",g="status",v="associationtype",_="iscontentvisible",x="percentalong",S="globalid";return{fromNetworkSourceId:e?.get(i)?.name??i,fromGlobalId:e?.get(r)?.name??r,fromTerminalId:e?.get(s)?.name??s,fromFirstUnit:e?.get(n)?.name??n,fromNumUnits:e?.get(a)?.name??a,toNetworkSourceId:e?.get(o)?.name??o,toGlobalId:e?.get(l)?.name??l,toTerminalId:e?.get(u)?.name??u,toFirstUnit:e?.get(d)?.name??d,toNumUnits:e?.get(f)?.name??f,status:e?.get(g)?.name??g,associationType:e?.get(v)?.name??v,isContentVisible:e?.get(_)?.name??_,percentAlong:e?.get(x)?.name??x,globalId:e?.get(t?.globalIdField??S)?.name??S}}function Bmi(t,e){if(e.type!=="feature"&&e.type!=="subtype-group")return[];if(!e.url)return[];const i="utilityNetworks"in t.map?t.map.utilityNetworks??[]:[];for(const r of i)if(r.isUtilityLayer(e)){const s=e.fieldsIndex.get("assetgroup"),n=e.fieldsIndex.get("assettype");return[s?.name,n?.name].filter(a=>a!=null)}return[]}let $h=class extends be{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTable=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTable=null,this.associationsTableId=null,this.associationsTableUrl=null}destroy(){this.associationsTable?.destroy()}async loadAssociationsTable(e){if(!this.associationsTable){const{associationsTableUrl:i}=this;if(!i)throw new q("utility-network-system-layers:missing-associations-table-url","Unable to load the associations table, as the `associationsTableUrl` is not set.");this.associationsTable=new mt({url:i})}return await this.associationsTable.load(e),this.associationsTable}async loadSubnetworksTable(e){if(!this.subnetworksTable){const{subnetworksTableUrl:i}=this;if(!i)throw new q("utility-network-system-layers:missing-subnetworks-table-url","Unable to load the subnetworks table, as the `subnetworksTableUrl` is not set.");this.subnetworksTable=new mt({url:i})}return await this.subnetworksTable.load(e),this.subnetworksTable}};c([p({constructOnly:!0})],$h.prototype,"rulesTableId",void 0),c([p({constructOnly:!0})],$h.prototype,"rulesTableUrl",void 0),c([p()],$h.prototype,"subnetworksTable",void 0),c([p({constructOnly:!0})],$h.prototype,"subnetworksTableId",void 0),c([p({constructOnly:!0})],$h.prototype,"subnetworksTableUrl",void 0),c([p({constructOnly:!0})],$h.prototype,"dirtyAreasLayerId",void 0),c([p({constructOnly:!0})],$h.prototype,"dirtyAreasLayerUrl",void 0),c([p()],$h.prototype,"associationsTable",void 0),c([p({constructOnly:!0})],$h.prototype,"associationsTableId",void 0),c([p({constructOnly:!0})],$h.prototype,"associationsTableUrl",void 0),$h=c([R("esri.networks.support.NetworkSystemLayers")],$h);let w3=class extends ae{constructor(e){super(e),this.id=null,this.name=null}};c([p({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],w3.prototype,"id",void 0),c([p({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],w3.prototype,"name",void 0),c([p({type:Boolean,json:{write:!0}})],w3.prototype,"isUpstreamTerminal",void 0),w3=c([R("esri.networks.support.Terminal")],w3);const gMt=w3,AV=new ii({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let Uv=class extends ae{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};c([p({type:String,json:{write:!0}})],Uv.prototype,"defaultConfiguration",void 0),c([p({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],Uv.prototype,"id",void 0),c([p({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],Uv.prototype,"name",void 0),c([p({type:[gMt],json:{write:!0}})],Uv.prototype,"terminals",void 0),c([p({type:AV.apiValues,json:{type:AV.jsonValues,read:AV.read,write:AV.write}})],Uv.prototype,"traversabilityModel",void 0),Uv=c([R("esri.networks.support.TerminalConfiguration")],Uv);let wu=class extends ae{constructor(e){super(e),this.type="networkElement",this.assetGroupCode=null,this.assetTypeCode=null,this.globalId=null,this.networkSourceId=null,this.objectId=null,this.positionFrom=null,this.positionTo=null,this.terminalId=null}};c([p({json:{write:!1}})],wu.prototype,"type",void 0),c([p({type:Number,json:{write:!0}})],wu.prototype,"assetGroupCode",void 0),c([p({type:Number,json:{write:!0}})],wu.prototype,"assetTypeCode",void 0),c([p({type:String,json:{write:!0}})],wu.prototype,"globalId",void 0),c([p({type:Number,json:{write:!0}})],wu.prototype,"networkSourceId",void 0),c([p({type:Number,json:{write:!0}})],wu.prototype,"objectId",void 0),c([p({type:Number,json:{write:!0}})],wu.prototype,"positionFrom",void 0),c([p({type:Number,json:{write:!0}})],wu.prototype,"positionTo",void 0),c([p({type:Number,json:{write:!0}})],wu.prototype,"terminalId",void 0),wu=c([R("esri.rest.networks.support.NetworkElement")],wu);let lp=class extends wu{constructor(e){super(e),this.type="telecomNetworkElement",this.firstUnit=null,this.numUnits=null}};c([p({json:{write:!1}})],lp.prototype,"type",void 0),c([p({json:{write:!0}})],lp.prototype,"firstUnit",void 0),c([p({json:{write:!0}})],lp.prototype,"numUnits",void 0),lp=c([R("esri.rest.networks.support.TelecomNetworkElement")],lp);let fv=class extends ae{constructor(e){super(e),this.edgeElement=null,this.junctionElement=null}readEdgeElement(e,i){return new lp({networkSourceId:i.edgeNetworkSourceId,globalId:i.edgeGlobalId,objectId:i.edgeObjectId,positionFrom:i.edgePositionFrom,positionTo:i.edgePositionTo,firstUnit:i.edgeFirstUnit,numUnits:i.edgeNumUnits})}writeEdgeElement(e,i){i.edgeNetworkSourceId=e.networkSourceId,i.edgeGlobalId=e.globalId,i.edgeObjectId=e.objectId,i.edgePositionFrom=e.positionFrom,i.edgePositionTo=e.positionTo,i.edgeFirstUnit=e.firstUnit,i.edgeNumUnits=e.numUnits}readJunctionElement(e,i){return new lp({networkSourceId:i.junctionNetworkSourceId,globalId:i.junctionGlobalId,objectId:i.junctionObjectId,terminalId:i.junctionTerminalId,firstUnit:i.junctionFirstUnit,numUnits:i.junctionNumUnits})}writeJunctionElement(e,i){i.junctionNetworkSourceId=e.networkSourceId,i.junctionGlobalId=e.globalId,i.junctionObjectId=e.objectId,i.junctionTerminalId=e.terminalId,i.junctionFirstUnit=e.firstUnit,i.junctionNumUnits=e.numUnits}};c([p({type:lp,json:{read:{source:["edgeNetworkSourceId","edgeGlobalId","edgeObjectId","edgePositionFrom","edgePositionTo","edgeFirstUnit","edgeNumUnits"]},write:!0}})],fv.prototype,"edgeElement",void 0),c([Oe("edgeElement")],fv.prototype,"readEdgeElement",null),c([Ie("edgeElement")],fv.prototype,"writeEdgeElement",null),c([p({type:lp,json:{read:{source:["junctionNetworkSourceId","junctionGlobalId","junctionObjectId","junctionTerminalId","junctionFirstUnit","junctionNumUnits"]},write:!0}})],fv.prototype,"junctionElement",void 0),c([Oe("junctionElement")],fv.prototype,"readJunctionElement",null),c([Ie("junctionElement")],fv.prototype,"writeJunctionElement",null),fv=c([R("esri.networks.support.CircuitPathConnectivityElement")],fv);const yMt=fv;let pf=class extends ae{constructor(e){super(e),this.globalId=null,this.isFilterBarrier=!1,this.percentAlong=null,this.terminalId=null,this.type=null,this.firstUnit=null,this.numUnits=null,this.networkSourceId=null}};c([p({type:String,json:{write:!0}})],pf.prototype,"globalId",void 0),c([p({type:Boolean,json:{write:!0}})],pf.prototype,"isFilterBarrier",void 0),c([p({type:Number,json:{write:!0}})],pf.prototype,"percentAlong",void 0),c([p({type:Number,json:{write:!0}})],pf.prototype,"terminalId",void 0),c([p({type:MV.apiValues,json:{type:MV.jsonValues,read:{reader:MV.read,source:"traceLocationType"},write:{writer:MV.write,target:"traceLocationType"}}})],pf.prototype,"type",void 0),c([p({type:Number,json:{write:!0}})],pf.prototype,"firstUnit",void 0),c([p({type:Number,json:{write:!0}})],pf.prototype,"numUnits",void 0),c([p({type:Number})],pf.prototype,"networkSourceId",void 0),pf=c([R("esri.rest.networks.support.TraceLocation")],pf);const bSe=pf;let mv=class extends ae{constructor(e){super(e),this.pathId=null,this.order=null,this.startingPoint=null,this.stoppingPoint=null,this.pathConnectivity=[],this.geometry=null}};c([p({type:Number,json:{write:!0}})],mv.prototype,"pathId",void 0),c([p({type:Number,json:{write:!0}})],mv.prototype,"order",void 0),c([p({type:bSe,json:{write:!0}})],mv.prototype,"startingPoint",void 0),c([p({type:bSe,json:{write:!0}})],mv.prototype,"stoppingPoint",void 0),c([p({type:[yMt],json:{write:!0}})],mv.prototype,"pathConnectivity",void 0),c([p({type:gs,json:{write:!0}})],mv.prototype,"geometry",void 0),mv=c([R("esri.networks.support.CircuitPath")],mv);const Uhe=mv;let Eb=class extends ae{constructor(e){super(e),this.sourceId=null,this.globalId=null,this.terminalId=1,this.firstUnit=1,this.numUnits=1}};c([p({type:Number,json:{write:!0}})],Eb.prototype,"sourceId",void 0),c([p({type:String,json:{write:!0}})],Eb.prototype,"globalId",void 0),c([p({type:Number,json:{write:!0}})],Eb.prototype,"terminalId",void 0),c([p({type:Number,json:{write:!0}})],Eb.prototype,"firstUnit",void 0),c([p({type:Number,json:{write:!0}})],Eb.prototype,"numUnits",void 0),Eb=c([R("esri.networks.support.CircuitLocation")],Eb);const oG=Eb;let gv=class extends ae{constructor(e){super(e),this.name=null,this.globalId=null,this.providerId=null,this.consumerId=null,this.isReserved=!1,this.attributes=null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,i){this.attributes?this.attributes[e]=i:this.attributes={[e]:i}}};c([p({type:String,json:{write:!0}})],gv.prototype,"name",void 0),c([p({type:String,json:{write:!0}})],gv.prototype,"globalId",void 0),c([p({type:String})],gv.prototype,"providerId",void 0),c([p({type:String})],gv.prototype,"consumerId",void 0),c([p({type:Boolean,json:{write:!0}})],gv.prototype,"isReserved",void 0),c([p({json:{write:{allowNull:!0,writer:(t,e)=>e.attributes=t??{}}}})],gv.prototype,"attributes",void 0),gv=c([R("esri.networks.support.Subcircuit")],gv);const cje=gv;let rg=class extends ae{constructor(e){super(e),this.sectionId=null,this.role="start-and-end",this.sectionType="physical",this.startLocation=null,this.stopLocation=null,this.subcircuit=null,this.path=null}normalizeCtorArgs(e){if(e===void 0)return e;const{sectionId:i,startLocation:r,stopLocation:s,subcircuit:n}=e;return(r||s)&&n?(delete e.startLocation,delete e.stopLocation,re.getLogger(this).warn("Cannot instantiate CircuitSection with both start/stop locations and subcircuit.",`CircuitSection with ID '${i}' was defaulted to having a subcircuit only.`)):(r&&!s||!r&&s)&&!n&&re.getLogger(this).warn(`CircuitSection with ID '${i}' must have both start and stop locations.`,"Create/alter operations involving this section will fail unless both are populated."),e}setStartStopLocations(e,i){this.startLocation=e,this.stopLocation=i,this.subcircuit=null}setSubcircuit(e){this.subcircuit=e,this.startLocation=null,this.stopLocation=null}};c([p({type:Number,json:{write:!0}})],rg.prototype,"sectionId",void 0),c([p({type:SQ.apiValues,json:{type:SQ.jsonValues,read:SQ.read},readOnly:!0})],rg.prototype,"role",void 0),c([p({type:bw.apiValues,json:{type:bw.jsonValues,read:bw.read,write:bw.write}})],rg.prototype,"sectionType",void 0),c([p({type:oG,json:{write:!0}})],rg.prototype,"startLocation",void 0),c([p({type:oG,json:{write:!0}})],rg.prototype,"stopLocation",void 0),c([p({type:cje,json:{write:!0}})],rg.prototype,"subcircuit",void 0),c([p({type:Uhe,readOnly:!0})],rg.prototype,"path",void 0),rg=c([R("esri.networks.support.CircuitSection")],rg);let Ua=class extends ae{constructor(e){super(e),this._sectionIdLookup=new Map,this.attributes=null,this.circuitManager=null,this.circuitType="physical",this.globalId=null,this.isDeleted=!1,this.lastExportedTime=null,this.lastVerifiedTime=null,this.name=null,this.sections=null,this.startLocation=null,this.status="dirty",this.stopLocation=null,this.subcircuits=[]}initialize(){this.addHandles([X(()=>this.sections,e=>{this._sectionIdLookup.clear(),e!=null&&Array.from(e.keys()).forEach(i=>this._sectionIdLookup.set(i.sectionId,i))},Yt)])}normalizeCtorArgs(e){if(e===void 0)return e;const{name:i,startLocation:r,stopLocation:s,sections:n}=e;return(r||s)&&n?(delete e.startLocation,delete e.stopLocation,re.getLogger(this).warn("Cannot instantiate Circuit with both start/stop locations and sections.",`Circuit '${i}' was defaulted to having sections only.`)):(r&&!s||!r&&s)&&!n&&re.getLogger(this).warn(`Non-sectioned circuit '${i}' must have both start and stop locations.`,"Create/alter operations involving this circuit will fail unless both are populated."),e}get isSectioned(){return this.startLocation==null&&this.stopLocation==null&&this.sections!=null}readSections(e,i){const{sectionOrder:r,sections:s}=i,n=new Map;if(s==null)return null;if(this._sectionIdLookup.clear(),s.forEach(a=>this._sectionIdLookup.set(a.sectionId,rg.fromJSON(a))),r==null)return Array.from(this._sectionIdLookup.values()).forEach(a=>n.set(a,[])),n;for(const[a,o]of Object.entries(r)){const l=Number(a),u=this._sectionIdLookup.get(l);if(u==null)continue;const d=o.map(f=>this._sectionIdLookup.get(f)).filter(wl);n.set(u,d)}return n}writeSections(e,i){const r={},s=[];e?.forEach((n,a)=>{const o=a.sectionId.toString(),l=n.map(u=>u.sectionId);r[o]=l,s.push(a.toJSON())}),i.sectionOrder=r,i.sections=s}getSectionById(e){return this._sectionIdLookup.get(e)??null}setStartStopLocations(e,i){this.startLocation=e,this.stopLocation=i,this.sections=null}setSections(e){this.sections=e,this.startLocation=null,this.stopLocation=null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,i){this.attributes?this.attributes[e]=i:this.attributes={[e]:i}}};c([p({json:{write:{allowNull:!0,writer:(t,e)=>e.attributes=t??{}}}})],Ua.prototype,"attributes",void 0),c([p()],Ua.prototype,"circuitManager",void 0),c([p({type:bw.apiValues,json:{type:bw.jsonValues,read:bw.read,write:bw.write}})],Ua.prototype,"circuitType",void 0),c([p({type:String,json:{write:!0}})],Ua.prototype,"globalId",void 0),c([p({type:Boolean,readOnly:!0})],Ua.prototype,"isDeleted",void 0),c([p({type:Boolean,json:{write:!0},readOnly:!0})],Ua.prototype,"isSectioned",null),c([p({type:Date,json:{read:{reader:t=>typeof t=="number"?new Date(t):null}},readOnly:!0})],Ua.prototype,"lastExportedTime",void 0),c([p({type:Date,json:{read:{reader:t=>typeof t=="number"?new Date(t):null}},readOnly:!0})],Ua.prototype,"lastVerifiedTime",void 0),c([p({type:String,json:{write:!0}})],Ua.prototype,"name",void 0),c([p({json:{read:{source:["sectionOrder","sections"]},write:!0}})],Ua.prototype,"sections",void 0),c([Oe("sections")],Ua.prototype,"readSections",null),c([Ie("sections")],Ua.prototype,"writeSections",null),c([p({type:oG,json:{write:!0}})],Ua.prototype,"startLocation",void 0),c([p({type:xQ.apiValues,json:{type:xQ.jsonValues,read:xQ.read}})],Ua.prototype,"status",void 0),c([p({type:oG,json:{write:!0}})],Ua.prototype,"stopLocation",void 0),c([p({type:[cje],json:{write:!0}})],Ua.prototype,"subcircuits",void 0),Ua=c([R("esri.networks.support.Circuit")],Ua);let g2=class extends ae{constructor(e){super(e),this.circuit=null,this.geometry=null,this.path=null}readCircuit(e,i){return Ua.fromJSON(i)}};c([p({type:Ua,json:{write:!0,read:{source:["name","globalId","isSectioned","sectionOrder","startLocation","stopLocation","sections","subcircuits","lastVerifiedTime","lastExportedTime","circuitType","status"]}}})],g2.prototype,"circuit",void 0),c([Oe("circuit")],g2.prototype,"readCircuit",null),c([p({type:gs,json:{write:!0}})],g2.prototype,"geometry",void 0),c([p({type:Uhe,json:{write:!0}})],g2.prototype,"path",void 0),g2=c([R("esri.rest.networks.circuits.support.CircuitTraceResult")],g2);const vMt=g2;let x3=class extends ae{constructor(e){super(e),this.line=null,this.multipoint=null,this.polygon=null}};c([p({type:gs,json:{write:!0},readOnly:!0})],x3.prototype,"line",void 0),c([p({type:Ho,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],x3.prototype,"multipoint",void 0),c([p({type:Wr,json:{write:!0},readOnly:!0})],x3.prototype,"polygon",void 0),x3=c([R("esri.rest.networks.support.AggregatedGeometry")],x3);const _Mt=x3;let S3=class extends ae{constructor(e){super(e),this.functionType=null,this.networkAttributeName=null,this.result=null}};c([p({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],S3.prototype,"functionType",void 0),c([p({type:String,json:{write:!0},readOnly:!0})],S3.prototype,"networkAttributeName",void 0),c([p({type:Number,json:{write:!0},readOnly:!0})],S3.prototype,"result",void 0),S3=c([R("esri.rest.networks.support.FunctionResult")],S3);const bMt=S3;let Ch=class extends ae{constructor(e){super(e),this.aggregatedGeometry=null,this.circuits=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.paths=null,this.startingPointsIgnored=!1,this.warnings=null}readNetworkElements(e,i){return i.elements!=null&&Array.isArray(i.elements)?i.elements.map(r=>"firstUnit"in r&&"numUnits"in r?new lp({...r}):new wu({...r})):[]}writeNetworkElements(e,i){i.elements=e.map(r=>r.toJSON())}};c([p({type:_Mt,json:{write:!0},readOnly:!0})],Ch.prototype,"aggregatedGeometry",void 0),c([p({type:[vMt],json:{write:!0},readOnly:!0})],Ch.prototype,"circuits",void 0),c([p({type:[wu],json:{write:!0},readOnly:!0})],Ch.prototype,"elements",void 0),c([Oe("elements")],Ch.prototype,"readNetworkElements",null),c([Ie("elements")],Ch.prototype,"writeNetworkElements",null),c([p({type:[bMt],json:{write:!0},readOnly:!0})],Ch.prototype,"globalFunctionResults",void 0),c([p({type:Boolean,json:{write:!0},readOnly:!0})],Ch.prototype,"kFeaturesForKNNFound",void 0),c([p({type:[Uhe],json:{write:!0},readOnly:!0})],Ch.prototype,"paths",void 0),c([p({type:Boolean,json:{write:!0},readOnly:!0})],Ch.prototype,"startingPointsIgnored",void 0),c([p({type:[String],json:{write:!0},readOnly:!0})],Ch.prototype,"warnings",void 0),Ch=c([R("esri.rest.networks.support.TraceResult")],Ch);const wMt=so()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let y2=class extends Ch{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const i={...e,query:{f:"json"}},{data:r}=await Si(this.statusUrl,i),s=r.traceResults?{...r.traceResults,...r}:r;return this.read(s),this}async waitForJobCompletion(e={}){const{interval:i=1e3,statusCallback:r}=e;return new Promise((s,n)=>{this._clearTimer();const a=setInterval(()=>{this._timer||n(ti()),this.checkJobStatus().then(o=>{const{status:l}=o;switch(this.status=l,l){case"job-succeeded":this._clearTimer(),s(this);break;case"job-waiting":case"job-executing":r&&r(this)}},o=>{this._clearTimer(),n(o)})},i);this._timer=a})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};c([p({type:String,json:{write:!0}})],y2.prototype,"statusUrl",void 0),c([st(wMt)],y2.prototype,"status",void 0),c([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.submissionTime=t?t.getTime():null}}}})],y2.prototype,"submissionTime",void 0),c([p({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.lastUpdatedTime=t?t.getTime():null}}}})],y2.prototype,"lastUpdatedTime",void 0),y2=c([R("esri.networks.support.TraceJobInfo")],y2);let Pd=class extends cMt{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility",this._circuitManagerMap=new Map,this._terminalById=new Map,this._unitIdentifierManager=null}initialize(){this.addHandles(X(()=>[this.gdbVersion,this.historicMoment],()=>{this.networkSystemLayers.associationsTable&&(this.networkSystemLayers.associationsTable.gdbVersion!==this.gdbVersion&&(this.networkSystemLayers.associationsTable.gdbVersion=this.gdbVersion),this.networkSystemLayers.associationsTable.historicMoment!==this.historicMoment&&(this.networkSystemLayers.associationsTable.historicMoment=this.historicMoment))}))}get _rulesLayer(){const{gdbVersion:e,historicMoment:i}=this,r=this.networkSystemLayers.rulesTableUrl;return new mt({url:r,gdbVersion:e,historicMoment:i})}get _utilityLayerList(){const e=new Set;return this.dataElement?.domainNetworks?.map(i=>{i?.edgeSources?.map(({layerId:r,sourceId:s})=>{this._layerIdBySourceId.set(s,r),this._sourceIdByLayerId.set(r,s),e.add(r)}),i?.junctionSources?.map(({layerId:r,sourceId:s})=>{this._layerIdBySourceId.set(s,r),this._sourceIdByLayerId.set(r,s),e.add(r)})}),e}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new $h({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:this.sourceJSON?.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map(e=>Uv.fromJSON(e))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map(e=>e.domainNetworkName)||[]}get hasTelecomNetwork(){return this.dataElement?.domainNetworks.some(e=>e.isTelecomNetwork)??!1}get associationsTable(){return this.networkSystemLayers.associationsTable}async load(e){return this.addResolvingPromise(this._load(e)),this}async _load(e){await super._load(e),await Promise.all([this._loadNamedTraceConfigurationsFromNetwork(e),this.networkSystemLayers.loadAssociationsTable(e)])}getTerminalConfiguration(e){let i=null,r=null;const s=e.sourceLayer;let n=null;if(s?.type==="feature"){if(n=s.layerId,n===null)return null}else if(s?.type!=="subtype-sublayer"||(n=s?.parent?.layerId??null,n===null))return null;const a=e.attributes;if(a==null)return null;for(const u of Object.keys(a))u.toUpperCase()==="ASSETGROUP"&&(i=e.getAttribute(u)),u.toUpperCase()==="ASSETTYPE"&&(r=e.getAttribute(u));if(!this.dataElement)return null;let o=null;const l=this.dataElement.domainNetworks;for(const u of l){const d=u.junctionSources?.find(f=>f.layerId===n);if(d){const f=d.assetGroups?.find(g=>g.assetGroupCode===i);if(f){const g=f.assetTypes?.find(v=>v.assetTypeCode===r);if(g?.isTerminalConfigurationSupported){o=g.terminalConfigurationId;break}}}}if(o!=null){const u=this.dataElement.terminalConfigurations,d=u?.find(f=>f.terminalConfigurationId===o);return d?Uv.fromJSON(d):null}return null}getTierNames(e){return this.dataElement?.domainNetworks.find(r=>r.domainNetworkName===e)?.tiers?.map(r=>r.name)||[]}async getRulesTable(){const e=this._rulesLayer;e.loaded||await e.load();const i=this.dataElement?.domainNetworks;if(!i)return null;const r=i.flatMap(n=>[...n.edgeSources||[],...n.junctionSources||[]]),s=(await this._queryRulesTable(e)).map(n=>this._hydrateRuleInfo(e,r,n));return new Mb({rulesLayer:e,rules:s})}async getCircuitManager(e){if(!this.hasTelecomNetwork)return null;const i=this.dataElement?.domainNetworks.find(s=>s.domainNetworkName===e&&s.isTelecomNetwork);if(!i)return null;const{default:r}=await W(()=>import("./CircuitManager-B504Tqy4.js"),[]);return Fu(this._circuitManagerMap,e,()=>new r({utilityNetwork:this,telecomDomainNetwork:i}))}async getUnitIdentifierManager(){if(!this.hasTelecomNetwork)return null;if(this._unitIdentifierManager)return this._unitIdentifierManager;const{default:e}=await W(()=>import("./UnitIdentifierManager-DC8MuLFK.js"),[]);return this._unitIdentifierManager=new e({utilityNetwork:this}),this._unitIdentifierManager}getTerminalById(e){if(!this.dataElement||e==null)return null;const i=this._terminalById.get(e);return i??(this.terminalConfigurations.forEach(r=>{r.terminals.forEach(s=>{this._terminalById.set(s.id,s)})}),this._terminalById.get(e))}isUtilityLayer(e){return"layerId"in e?e.layerId!=null&&this._utilityLayerList.has(e.layerId)&&(e.url?.startsWith(this.featureServiceUrl)??!1):!(e.type!=="subtype-sublayer"||!e.parent)&&this._utilityLayerList.has(e.parent.layerId)&&(e.parent.url?.startsWith(this.featureServiceUrl)??!1)}async queryAssociations(e,i){const[{queryAssociations:r},{default:s}]=await Promise.all([W(()=>import("./queryAssociations-BfssiAr_.js"),__vite__mapDeps([275,276])),W(()=>import("./QueryAssociationsParameters-CtB5aBmI.js"),[])]),n=s.from(e);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,(await r(this.networkServiceUrl,n,i)).associations}async synthesizeAssociationGeometries(e){const[{synthesizeAssociationGeometries:i},{default:r}]=await Promise.all([W(()=>import("./synthesizeAssociationGeometries-BIrCfA0R.js"),__vite__mapDeps([277,276])),W(()=>import("./SynthesizeAssociationGeometriesParameters-CC7c5ZER.js"),[])]),s=r.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,i(this.networkServiceUrl,s)}async trace(e){const[{trace:i},{default:r}]=await Promise.all([W(()=>import("./trace-BuN6A7x1.js"),[]),W(()=>import("./TraceParameters-BlpThpKu.js"),[])]),s=r.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,i(this.networkServiceUrl,s)}async submitTraceJob(e){const[{submitTraceJob:i},{default:r}]=await Promise.all([W(()=>import("./trace-BuN6A7x1.js"),[]),W(()=>import("./TraceParameters-BlpThpKu.js"),[])]),s=r.from(e);s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment;const n=await i(this.networkServiceUrl,s);return new y2({statusUrl:n})}async canAddAssociation(e){const i=await this.getRulesTable();if(!i)return!1;const{fromNetworkElement:r,toNetworkElement:s}=e;if(!r||!s)return!1;await i.load();let n=null;switch(e.associationType){case"containment":n=i.rulesCategorized.containment;break;case"attachment":n=i.rulesCategorized.attachment;break;default:n=i.rulesCategorized.connectivity}return n.some(a=>nk(a,r,s))}generateAddAssociations(e){const{associationsTable:i}=this.networkSystemLayers,{fromNetworkSourceId:r,fromGlobalId:s,fromTerminalId:n,fromFirstUnit:a,fromNumUnits:o,toNetworkSourceId:l,toGlobalId:u,toTerminalId:d,toFirstUnit:f,toNumUnits:g,associationType:v,isContentVisible:_,percentAlong:x,globalId:S}=mMt(i);return{addFeatures:e.map(T=>{const M=new ms({attributes:{[r]:T.fromNetworkElement?.networkSourceId,[s]:T.fromNetworkElement?.globalId,[n]:T.fromNetworkElement?.terminalId,[l]:T.toNetworkElement?.networkSourceId,[u]:T.toNetworkElement?.globalId,[d]:T.toNetworkElement?.terminalId,[v]:dMt[T.associationType],[_]:T.isContentVisible==null?void 0:T.isContentVisible?1:0,[x]:T.percentAlong,[S]:T.globalId}});return T.fromNetworkElement instanceof lp&&(M.attributes[a]=T.fromNetworkElement?.firstUnit,M.attributes[o]=T.fromNetworkElement?.numUnits),T.toNetworkElement instanceof lp&&(M.attributes[f]=T.toNetworkElement?.firstUnit,M.attributes[g]=T.toNetworkElement?.numUnits),M}),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:i?.globalIdField??"globalid",objectIdField:i?.objectIdField??"objectid"}}}generateDeleteAssociations(e){const{associationsTable:i,associationsTableId:r}=this.networkSystemLayers,s={id:r,identifierFields:{globalIdField:i?.globalIdField??"globalid",objectIdField:i?.objectIdField??"objectid"}};if(this.dataElement?.schemaGeneration===-8){const a=this._generateDeleteTelecomAssociationPayload(e);return{...s,deleteAssociations:a}}const n=e.map(a=>({globalId:a.globalId}));return{...s,deleteFeatures:n}}generateCombineNetworkElements(e){return{id:this._ensureSingleSourceIdAsValidLayerId(e),combineGroupedObjects:[{globalIds:e.map(i=>i.globalId)}]}}generateDivideNetworkElements(e,i){return{id:this._ensureSingleSourceIdAsValidLayerId([e]),divideGroupedObjects:[{globalId:e.globalId,numUnits:i}]}}async loadAssociationsTable(){return this.networkSystemLayers.loadAssociationsTable()}async loadSubnetworksTable(){return this.networkSystemLayers.loadSubnetworksTable()}async _loadNamedTraceConfigurationsFromNetwork(e){if(this.sharedNamedTraceConfigurations?.length===0)return;const i=this.sharedNamedTraceConfigurations.map(s=>s.globalId),r=await this.queryNamedTraceConfigurations({globalIds:i},e);for(const s of this.sharedNamedTraceConfigurations){const n=r?.find(a=>a.globalId===s.globalId);if(n){const a=n.write({},{origin:"service"});s.read(a,{origin:"service"})}}}_hydrateRuleInfo(e,i,r){const s=e.fieldsIndex,n=s.get("RULETYPE"),a=s.get("CREATIONDATE"),o=s.get("FROMNETWORKSOURCEID"),l=s.get("FROMASSETGROUP"),u=s.get("FROMASSETTYPE"),d=s.get("FROMTERMINALID"),f=s.get("TONETWORKSOURCEID"),g=s.get("TOASSETGROUP"),v=s.get("TOASSETTYPE"),_=s.get("TOTERMINALID"),x=s.get("VIANETWORKSOURCEID"),S=s.get("VIAASSETGROUP"),T=s.get("VIAASSETTYPE"),M=s.get("VIATERMINALID"),E=r.attributes[n.name],P=new Date(r.attributes[a.name]),O=[{networkSourceId:r.attributes[o.name],assetGroupId:r.attributes[l.name],assetTypeId:r.attributes[u.name],terminalId:r.attributes[d.name]},{networkSourceId:r.attributes[f.name],assetGroupId:r.attributes[g.name],assetTypeId:r.attributes[v.name],terminalId:r.attributes[_.name]},{networkSourceId:r.attributes[x.name],assetGroupId:r.attributes[S.name],assetTypeId:r.attributes[T.name],terminalId:r.attributes[M.name]}],D={ruleType:E,creationDate:P};for(const L of[0,1,2]){if(E!==5&&L===2)continue;const F=O[L],j=i.find(H=>H.sourceId===F.networkSourceId),N=j?.assetGroups.find(H=>H.assetGroupCode===F.assetGroupId),B=N?.assetTypes.find(H=>H.assetTypeCode===F.assetTypeId),U=this._getTerminal(B,F);let Q="";switch(L){case 0:Q="from";break;case 1:Q="to";break;case 2:Q="via"}D[`${Q}NetworkSource`]=j,D[`${Q}AssetGroup`]=N,D[`${Q}AssetType`]=B,D[`${Q}Terminal`]=U?.toJSON()}return D}_getTerminal(e,i){const r=e?.terminalConfigurationId;return this.terminalConfigurations?.find(n=>n.id===r)?.terminals?.find(n=>n.id===i.terminalId)??null}async _queryRulesTable(e){const{gdbVersion:i,historicMoment:r}=this,s=new Ct({where:"1=1",outFields:["*"],gdbVersion:i,historicMoment:r});return(await iVe(e,s)).features}_generateDeleteTelecomAssociationPayload(e){return e.map(i=>({globalId:i.globalId??uMt,associationType:hMt.toJSON(i.associationType),fromSourceId:i.fromNetworkElement.networkSourceId,fromGlobalId:i.fromNetworkElement.globalId,fromTerminalId:i.fromNetworkElement.terminalId,toSourceId:i.toNetworkElement.networkSourceId,toGlobalId:i.toNetworkElement.globalId,toTerminalId:i.toNetworkElement.terminalId}))}_ensureSingleSourceIdAsValidLayerId(e){const i=SS(e.map(n=>n.networkSourceId));if(i.length>1)throw new q("utility-network:invalid-source-id","'networkSourceId' is not valid. Ensure that all network elements have the same 'networkSourceId' and that it corresponds to a valid layer in the utility network.");const r=i[0],s=this.getLayerIdBySourceId(r);if(s==null)throw new q("utility-network:invalid-source-id","'networkSourceId' is not valid. Ensure that all network elements have the same 'networkSourceId' and that it corresponds to a valid layer in the utility network.");return s}};c([p({readOnly:!0})],Pd.prototype,"_rulesLayer",null),c([p({type:[fMt],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],Pd.prototype,"sharedNamedTraceConfigurations",void 0),c([p({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],Pd.prototype,"type",void 0),c([p({readOnly:!0})],Pd.prototype,"serviceTerritoryFeatureLayerId",null),c([p({readOnly:!0})],Pd.prototype,"networkSystemLayers",null),c([p({readOnly:!0})],Pd.prototype,"terminalConfigurations",null),c([p({readOnly:!0})],Pd.prototype,"domainNetworkNames",null),c([p({readOnly:!0})],Pd.prototype,"hasTelecomNetwork",null),c([p({readOnly:!0,json:{read:!1}})],Pd.prototype,"associationsTable",null),Pd=c([R("esri.networks.UtilityNetwork")],Pd);const uje=Pd,xMt=Object.freeze(Object.defineProperty({__proto__:null,default:uje},Symbol.toStringTag,{value:"Module"}));let T3=class extends nt(ae){constructor(e){super(e),this.expression=null,this.returnType="string",this.title=null}};c([p({type:String,json:{write:{isRequired:!0}}})],T3.prototype,"expression",void 0),c([p({type:["number","string"],json:{write:!0}})],T3.prototype,"returnType",void 0),c([p({type:String,json:{write:!0}})],T3.prototype,"title",void 0),T3=c([R("esri.webdoc.geotriggersInfo.ExpressionInfo")],T3);const hje=T3,OV=new ii({deviceLocation:"device-location"});let ak=class extends nt(ae){constructor(e){super(e),this.filterExpression=null,this.type="device-location"}};c([p({type:hje,json:{write:!0}})],ak.prototype,"filterExpression",void 0),c([p({type:OV.apiValues,readOnly:!0,json:{type:OV.jsonValues,read:OV.read,write:OV.write}})],ak.prototype,"type",void 0),ak=c([R("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],ak);const SMt=ak;let ok=class extends nt(ae){constructor(e){super(e),this.geometry=null,this.where=null}};c([p({types:gP,json:{read:wp,write:!0}})],ok.prototype,"geometry",void 0),c([p({type:String,json:{write:!0}})],ok.prototype,"where",void 0),ok=c([R("esri.webdoc.geotriggersInfo.FeatureFilter")],ok);const TMt=ok;let $3=class extends nt(ae){constructor(e){super(e),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};c([p({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],$3.prototype,"layerId",void 0),c([p({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],$3.prototype,"layerUrl",void 0),c([st({featureLayer:"feature-layer"},{readOnly:!0})],$3.prototype,"type",void 0),$3=c([R("esri.webdoc.geotriggersInfo.FeatureLayerSource")],$3);const $Mt=$3;let v2=class extends nt(ae){constructor(e){super(e),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};c([p({type:$Mt,json:{write:{isRequired:!0}}})],v2.prototype,"fenceSource",void 0),c([p({type:TMt,json:{write:!0}})],v2.prototype,"filter",void 0),c([p({type:Number,json:{write:!0}})],v2.prototype,"bufferDistance",void 0),c([st({features:"features"},{readOnly:!0})],v2.prototype,"type",void 0),v2=c([R("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],v2);const CMt=v2;let oB=class extends nt(ae){constructor(e){super(e),this.type="fence"}};c([st({fence:"fence"},{readOnly:!0})],oB.prototype,"type",void 0),oB=c([R("esri.webdoc.geotriggersInfo.Geotrigger")],oB);const dje=oB;let lk=class extends nt(ae){constructor(e){super(e),this.expressionInfo=null,this.requestedActions=null}};c([p({type:hje,json:{write:!0}})],lk.prototype,"expressionInfo",void 0),c([p({type:[String],json:{write:!0}})],lk.prototype,"requestedActions",void 0),lk=c([R("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],lk);const MMt=lk,EMt=new ii({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),AMt=new ii({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),PV=new ii({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let ff=class extends dje{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};c([st(EMt)],ff.prototype,"enterExitRule",void 0),c([p({type:SMt,json:{write:{isRequired:!0}}})],ff.prototype,"feed",void 0),c([st(AMt)],ff.prototype,"feedAccuracyMode",void 0),c([p({type:PV.apiValues,json:{type:PV.jsonValues,read:PV.read,write:{writer:PV.write,isRequired:!0}}})],ff.prototype,"fenceNotificationRule",void 0),c([p({type:CMt,json:{write:{isRequired:!0}}})],ff.prototype,"fenceParameters",void 0),c([p({type:String,json:{write:!0}})],ff.prototype,"name",void 0),c([p({type:MMt,json:{write:!0}})],ff.prototype,"notificationOptions",void 0),c([st({fence:"fence"},{readOnly:!0})],ff.prototype,"type",void 0),ff=c([R("esri.webdoc.geotriggersInfo.FenceGeotrigger")],ff);const OMt=ff,PMt={base:dje,key:"type",typeMap:{fence:OMt}};let lB=class extends nt(ae){constructor(e){super(e),this.geotriggers=null}};c([p({types:[PMt],json:{write:{isRequired:!0}}})],lB.prototype,"geotriggers",void 0),lB=c([R("esri.webdoc.GeotriggersInfo")],lB);const RMt=lB;let cB=class extends nt(ae){constructor(e){super(e),this.enabled=!0}};c([p({type:Boolean,nonNullable:!0,json:{write:!0}})],cB.prototype,"enabled",void 0),cB=c([R("esri.webdoc.ips.AppleIPSProperties")],cB);const IMt=cB;let uB=class extends nt(ae){constructor(e){super(e),this.enabled=!0}};c([p({type:Boolean,nonNullable:!0,json:{write:!0}})],uB.prototype,"enabled",void 0),uB=c([R("esri.webdoc.ips.GNSSProperties")],uB);const DMt=uB;let C3=class extends nt(ae){constructor(e){super(e),this.enabled=!0,this.distance=5,this.units="meter"}};c([p({type:Boolean,nonNullable:!0,json:{write:!0}})],C3.prototype,"enabled",void 0),c([p({type:Number,nonNullable:!0,json:{write:!0}})],C3.prototype,"distance",void 0),c([p({type:["feet","meter"],nonNullable:!0,json:{write:!0}})],C3.prototype,"units",void 0),C3=c([R("esri.webdoc.ips.PathSnappingProperties")],C3);const kMt=C3;let hB=class extends nt(ae){constructor(e){super(e),this.enabled=!0}};c([p({type:Boolean,nonNullable:!0,json:{write:!0}})],hB.prototype,"enabled",void 0),hB=c([R("esri.webdoc.ips.SmoothingProperties")],hB);const LMt=hB;let _2=class extends nt(ae){constructor(e){super(e),this.appleIPS=null,this.gnss=null,this.smoothing=null,this.pathSnapping=null}};c([p({type:IMt,json:{name:"AppleIPS",write:!0}})],_2.prototype,"appleIPS",void 0),c([p({type:DMt,json:{name:"GNSS",write:!0}})],_2.prototype,"gnss",void 0),c([p({type:LMt,json:{write:!0}})],_2.prototype,"smoothing",void 0),c([p({type:kMt,json:{write:!0}})],_2.prototype,"pathSnapping",void 0),_2=c([R("esri.webdoc.ips.Configuration")],_2);const FMt=_2;let M3=class extends nt(ae){constructor(e){super(e),this.portalItem=null}readPortalItem(e,i,r){const{itemId:s}=i;if(s)return new qt({id:s,portal:r?.portal})}writePortalItem(e,i){e?.id&&(i.itemId=e.id)}};c([p({type:qt,json:{write:{isRequired:!0}}})],M3.prototype,"portalItem",void 0),c([Oe("portalItem",["itemId"])],M3.prototype,"readPortalItem",null),c([Ie("portalItem",{itemId:{type:String}})],M3.prototype,"writePortalItem",null),M3=c([R("esri.webdoc.ips.PositioningService")],M3);const zMt=M3;let ck=class extends nt(ae){constructor(e){super(e),this.positioningService=null,this.configuration=null}};c([p({type:zMt,json:{write:{isRequired:!0}}})],ck.prototype,"positioningService",void 0),c([p({type:FMt,json:{write:!0}})],ck.prototype,"configuration",void 0),ck=c([R("esri.webdoc.IPSInfo")],ck);const NMt=ck,VMt={currentVersion:dNe,createInitialViewProperties:()=>new Xq,parseVersion:XE.parse,itemType:"Web Map",name:"webmap",origin:"web-map"},jMt=ke.ofType(uje);var qA;let b2=(qA=class extends R1t{constructor(e){super(e),this.geotriggersInfo=null,this.ipsInfo=null,this.presentation=null,this.utilityNetworks=null}destroy(){if(this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const i of e)i.destroy();this.utilityNetworks.destroy()}}get context(){return VMt}loadAll(){return mF(this,e=>{e(this.ground,this.basemap,this.layers,this.tables,this.ipsInfo?.positioningService?.portalItem)})}static fromJSON(e){if(e)return new this({resourceInfo:e});throw new q("webmap:empty-resource","Expected a JSON resource but got nothing")}},qA.VERSION=dNe,qA);c([p({type:RMt,json:{write:!0}})],b2.prototype,"geotriggersInfo",void 0),c([p({type:NMt,json:{write:!0,name:"mapIPSInfo"}})],b2.prototype,"ipsInfo",void 0),c([p({json:{write:!0}})],b2.prototype,"presentation",void 0),c([p({type:jMt,json:{read:!0,write:!0}})],b2.prototype,"utilityNetworks",void 0),b2=c([R("esri.WebMap")],b2);const UMt=b2,Qi=(t,e)=>{const r=nP().manager;r.onLoaded(()=>r.onLifecycle(()=>tn(t,e,s.emit)));const s=dle();return s},aH=(t,e)=>i=>BMt(i,t);class Bhe extends F9{constructor(e,i){super(e),this.Y=new Map,this.A=void 0,this.#t=gPe();const r=this;r.#i=i,r.Z(),r.setProvisionalExports(pje(e,new WeakRef(r),e.M.length-1,r.instance,r.Y),!1),ule(e,s=>{if(s){const n=X(()=>e[s],a=>{if(a===r.instance)return;const o=r.instance;r.exports=a,r.instance=a,r.Y.forEach((l,u)=>e.requestUpdate(l,o[u])),r.#e&&o.destroy(),r.#e=!1},{sync:!0});r.onDestroy(n.remove)}},r.exports)}#e;#t;#i;get exports(){return yPe(this.#t),super.exports}set exports(e){super.exports=e,this.#t.notify()}Z(){const e=this;e.instance="prototype"in e.#i&&"declaredClass"in e.#i.prototype?new e.#i:e.#i(),e.#e=!0}hostConnected(){this.exports=this.instance}hostDestroy(){this.#e&&this.instance.destroy?.()}}const BMt=U9(Bhe),pje=(t,e,i,r,s)=>new Proxy(r,{get:(n,a)=>{const o=n[a];if(typeof a=="symbol"||s.has(a))return o;const l=t.M[i];return l.A=a,hle(t,u=>{if(l.A=void 0,u!==void 0){const d=u.key;s.set(a,d);const f=t.constructor.getPropertyOptions(d),g=a!==d&&d.toLowerCase().includes("disable");qMt(e,f,a,d,g),f.i===void 0&&GMt(f,i,a,g)}},o)}}),qMt=(t,e,i,r,s,n)=>n=X(()=>{const a=t.deref();return a===void 0||a.component.manager.destroyed?n=n.remove():a.exports[i]},(a,o)=>{if(!n)return;t.deref().component?.requestUpdate(r,s?!o:o),e.c=!1},{sync:!0}),GMt=(t,e,i,r)=>{t.d.get=function(){const s=this.M[e]?.exports[i];return r?!s:s},t.d.set=function(s){const n=this.M[e];n.A!==i&&(n.exports[i]=r?!s:s)}},HMt=t=>t.Y,fje=(t,e)=>{const i=e.manager.useRefSync(t);i?.hostDestroy(),i?.Z(),i?.hostConnected()};const mje=Sl`@charset "UTF-8";@keyframes esri-basemap-slide{0%{opacity:0;margin-top:0;margin-left:0}75%{opacity:0;margin-top:0;margin-left:0}to{opacity:1;margin-top:5px;margin-left:5px}}@keyframes esri-docking-animation{0%{opacity:0}25%{opacity:0}to{opacity:1}}@keyframes popup-intro-animation-down{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translate(0)}}@keyframes popup-intro-animation-up{0%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translate(0)}}@supports (-ms-ime-align: auto){.esri-slider__anchor:focus{outline:1px dotted #000}}@keyframes esri-spinner--start-animation{0%{opacity:0;transform:scale(0)}to{opacity:1;transform:scale(1)}}@keyframes esri-spinner--finish-animation{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(0)}}@keyframes esri-spinner--rotate-animation{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (prefers-reduced-motion){.esri-utility-network-trace__reset-prompt{animation:none!important}}@media (prefers-reduced-motion){.esri-popup--aligned-top-center,.esri-popup--aligned-top-left,.esri-popup--aligned-top-right,.esri-popup--aligned-bottom-center,.esri-popup--aligned-bottom-left,.esri-popup--aligned-bottom-right,.esri-popup--is-docked{animation:none!important}}@keyframes esri-fade-in-down{0%{opacity:0;transform:translateY(-5px)}25%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translate(0)}}@keyframes esri-fade-in-up{0%{opacity:0;transform:translateY(5px)}25%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translate(0)}}@keyframes esri-fade-in{0%{opacity:0}25%{opacity:0}to{opacity:1}}@keyframes esri-fade-in-scale{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}@keyframes looping-progresss-bar-ani{0%{width:0;left:0}20%{width:20%;left:0}80%{width:20%;left:80%}to{width:0;left:100%}}@keyframes esri-rotate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes panel-advance{0%{opacity:0;transform:translate(50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-retreat{0%{opacity:0;transform:translate(-50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-advance--rtl{0%{opacity:0;transform:translate(-50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-retreat--rtl{0%{opacity:0;transform:translate(50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}.esri-view{--esri-view-outline-color: var(--calcite-color-brand);--esri-view-outline: 2px solid var(--esri-view-outline-color);--esri-view-outline-offset: -2px;margin:0;padding:0;display:flex;height:100%;width:100%}.esri-view .esri-view-user-storage{overflow:hidden}.esri-view .esri-view-root{-webkit-tap-highlight-color:var(--calcite-color-foreground-1);-webkit-tap-highlight-color:transparent;border:none;flex:100%;margin:0;padding:0;position:relative}.esri-view .esri-view-surface{-webkit-user-select:none;user-select:none;direction:ltr;border:none;outline:0;width:100%;height:100%;margin:0;padding:0;position:absolute;top:0;left:0;overflow:clip}.esri-view .esri-view-surface--touch-none{touch-action:none}.esri-view .esri-view-surface--touch-pan{touch-action:pan-x pan-y}.esri-view .esri-view-surface:focus:after{box-sizing:border-box;z-index:999;outline:var(--esri-view-outline);outline-offset:var(--esri-view-outline-offset);content:"";pointer-events:none;width:100%;height:100%;position:absolute;top:0;left:0;overflow:hidden}.esri-view .esri-view-surface[data-navigating=true]{cursor:grabbing}.esri-view .esri-view-surface[data-cursor=copy]{cursor:copy}.esri-view .esri-view-surface[data-cursor=crosshair]{cursor:crosshair}.esri-view .esri-view-surface[data-cursor=help]{cursor:help}.esri-view .esri-view-surface[data-cursor=move]{cursor:move}.esri-view .esri-view-surface[data-cursor=pointer]{cursor:pointer}.esri-view .esri-view-surface[data-cursor=progress]{cursor:progress}.esri-view .esri-view-surface[data-cursor=grab]{cursor:grab}.esri-view .esri-view-surface[data-cursor=grabbing]{cursor:grabbing}.esri-view .esri-view-surface[data-cursor=n-resize]{cursor:n-resize}.esri-view .esri-view-surface[data-cursor=e-resize]{cursor:e-resize}.esri-view .esri-view-surface[data-cursor=s-resize]{cursor:s-resize}.esri-view .esri-view-surface[data-cursor=w-resize]{cursor:w-resize}.esri-view .esri-view-surface[data-cursor=ne-resize]{cursor:ne-resize}.esri-view .esri-view-surface[data-cursor=nw-resize]{cursor:nw-resize}.esri-view .esri-view-surface[data-cursor=se-resize]{cursor:se-resize}.esri-view .esri-view-surface[data-cursor=sw-resize]{cursor:sw-resize}.esri-view .esri-view-surface[data-cursor=ew-resize]{cursor:ew-resize}.esri-view .esri-view-surface[data-cursor=ns-resize]{cursor:ns-resize}.esri-view .esri-view-surface[data-cursor=nesw-resize]{cursor:nesw-resize}.esri-view .esri-view-surface[data-cursor=nwse-resize]{cursor:nwse-resize}.esri-view .esri-view-surface[data-cursor=none]{cursor:none}.esri-view .esri-display-object,.esri-view .esri-bitmap{-webkit-user-drag:none;-webkit-user-select:none;user-select:none;border:none;margin:0;padding:0;position:absolute}.esri-view .esri-bitmap{transform-origin:0 0;max-width:none}:root{view-transition-name:none}::view-transition{pointer-events:none}.esri-ui{box-sizing:border-box;z-index:0;pointer-events:none;contain:layout;font-size:var(--calcite-font-size);position:absolute;inset:0;overflow:hidden;container:esri-view-canvas/size}.esri-ui calcite-flow,.esri-ui calcite-panel{z-index:1;position:relative}.esri-ui .esri-component{pointer-events:auto}.esri-ui .esri-fov-overlay-outer{pointer-events:none;place-content:center;width:100%;height:100%;display:grid}.esri-ui .esri-fov-overlay{text-shadow:0 0 1px var(--calcite-color-foreground-1),0 0 2px var(--calcite-color-foreground-1),0 0 3px var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);font-size:var(--calcite-font-size-3);-webkit-user-select:none;user-select:none;pointer-events:none;flex-direction:row;align-items:center;gap:7px;animation:1s forwards fadeInAnimation;display:flex}.esri-ui .esri-fov-overlay-reset{cursor:pointer;pointer-events:auto}.esri-ui .esri-fov-overlay-text{pointer-events:none}@keyframes fadeInAnimation{0%{opacity:0}to{opacity:1}}@media (prefers-reduced-motion: reduce){.esri-fov-overlay{animation:none!important}}.esri-ui-corner{display:flex;position:absolute}.esri-ui-inner-container{position:absolute;inset:0}.esri-ui-manual-container>.esri-component{position:absolute}.esri-ui-manual-container .esri-swipe{z-index:-1}.esri-ui-top-left,.esri-ui-top-right{flex-flow:column}.esri-ui-top-left{align-items:flex-start;top:0;left:0}.esri-ui-top-right{align-items:flex-end;top:0;right:0}.esri-ui-bottom-left,.esri-ui-bottom-right{flex-flow:row;align-items:flex-end}.esri-ui-bottom-right{flex-flow:row-reverse;bottom:0;right:0}.esri-ui-bottom-right .esri-component{margin-left:10px}.esri-ui-top-right .esri-component,.esri-ui-top-left .esri-component{margin-bottom:10px}.esri-ui-bottom-left{bottom:0;left:0}.esri-ui-bottom-left .esri-component{margin-right:10px}:dir(rtl) .esri-ui-top-left{align-items:flex-end}:dir(rtl) .esri-ui-top-right{align-items:flex-start}:dir(rtl) .esri-ui-bottom-left{flex-direction:row-reverse}:dir(rtl) .esri-ui-bottom-right{flex-direction:row}.esri-zoom-box__container{width:100%;height:100%;position:relative}.esri-zoom-box__overlay{cursor:crosshair;width:100%;height:100%;position:absolute;top:0;left:0}.esri-zoom-box__overlay-background{fill:#0000001a}.esri-zoom-box__outline{fill:var(--calcite-color-transparent);stroke:var(--calcite-color-brand);stroke-dasharray:1 1;stroke-width:var(--calcite-spacing-base)}.esri-overlay-surface{z-index:0;pointer-events:none;-webkit-user-select:none;user-select:none;border:none;width:100%;height:100%;margin:0;padding:0;position:absolute;top:0;left:0;overflow:clip}.esri-text-overlay-item{white-space:nowrap;font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight);display:block;position:absolute;overflow:hidden}.esri-text-overlay-item-anchor-bottom{transform:translate(-50%,-100%)}.esri-text-overlay-item-anchor-bottom-right{transform:translate(-100%,-100%)}.esri-text-overlay-item-anchor-bottom-left{transform:translateY(-100%)}.esri-text-overlay-item-anchor-top{transform:translate(-50%)}.esri-text-overlay-item-anchor-top-right{transform:translate(-100%)}.esri-text-overlay-item-anchor-top-left{transform:translate(0)}.esri-text-overlay-item-anchor-center{transform:translate(-50%,-50%)}.esri-text-overlay-item-anchor-right{transform:translate(-100%,-50%)}.esri-text-overlay-item-anchor-left{transform:translateY(-50%)}.esri-line-overlay-item,.esri-outline-overlay-item,.esri-box-overlay-item{white-space:nowrap;display:block;position:absolute;overflow:hidden}.esri-shadow-cast__tooltip{color:var(--calcite-color-text-2);font-size:var(--calcite-font-size-sm)}.esri-shadow-cast__tooltip__content{margin-top:-8px-var(--calcite-spacing-xxs);padding:var(--calcite-spacing-xs) var(--calcite-spacing-sm);background:var(--calcite-color-foreground-1);width:max-content;position:absolute;transform:translate(-50%,-100%)}.esri-shadow-cast__tooltip__content:after{content:"";border:8px solid var(--calcite-color-transparent);border-top-color:var(--calcite-color-foreground-1);box-sizing:inherit;width:0;height:0;display:block;position:absolute;bottom:1px;left:50%;transform:translate(-50%,100%)}.esri-attribution{position:absolute;bottom:0;left:0;right:0;background-color:var(--calcite-color-transparent-tint)!important;flex-flow:row;justify-content:space-between;align-items:center;font-size:var(--calcite-font-size-sm)!important;line-height:var(--calcite-font-line-height-fixed-base)!important;display:flex}.esri-attribution__link{color:var(--calcite-color-text-1)}.esri-attribution__link:hover,.esri-attribution__link:active,.esri-attribution__link:visited,.esri-attribution__link:focus{color:var(--calcite-color-text-1)}.esri-attribution__sources{text-overflow:ellipsis;white-space:nowrap;flex:1 0;align-self:flex-start;padding:0 5px;font-weight:var(--calcite-font-weight-light);overflow:hidden}.esri-attribution__sources[role=button]{font-size:1em}.esri-attribution__powered-by{color:var(--calcite-color-text-2);text-align:right;white-space:nowrap;align-self:flex-end;padding:0 5px;font-weight:var(--calcite-font-weight-normal)}.esri-attribution--open{z-index:2}.esri-attribution__sources--open{white-space:normal}.esri-button{box-sizing:border-box;cursor:pointer;white-space:normal;word-break:normal;color:var(--calcite-color-text-1);background-color:var(--calcite-color-status-info);border:var(--calcite-spacing-px) solid var(--calcite-color-status-info);justify-content:center;align-items:center;width:100%;min-height:var(--calcite-spacing-xxxl);padding:6px 7px;font-family:inherit;font-size:var(--calcite-font-size);transition:background-color .125s ease-in-out,border .125s ease-in-out;display:flex;overflow:hidden;&:hover{color:var(--calcite-color-text-1);background-color:var(--calcite-color-status-info-hover);border:var(--calcite-spacing-px) solid var(--calcite-color-status-info-hover)}}.esri-button:hover{color:var(--calcite-color-text-1);background-color:var(--calcite-color-text-2);border:1px solid var(--calcite-color-text-2)}.esri-button.esri-button--small{min-height:var(--calcite-spacing-xl);font-size:var(--calcite-font-size-sm)}.esri-button.esri-button--half{width:50%;display:inline-block}.esri-button.esri-button--third{width:33%;display:inline-block}.esri-button--secondary{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-button--tertiary{color:var(--calcite-color-brand);background-color:var(--calcite-color-transparent);border-color:var(--calcite-color-transparent)}.esri-button--tertiary:hover{color:var(--calcite-color-brand-hover);background-color:var(--calcite-color-foreground-2);border-color:var(--calcite-color-transparent)}.esri-button--disabled{opacity:.4;pointer-events:none}.esri-button--drill-in{outline-offset:-4px;cursor:pointer;text-align:unset;background-color:var(--calcite-color-foreground-1);border:none;border-radius:2px;justify-content:space-between;align-items:center;margin:var(--calcite-spacing-md) 7px;padding:var(--calcite-spacing-md) 7px;text-decoration:none;transition:background-color .125s ease-in-out;display:flex;box-shadow:0 0 0 1px #adadad4d}.esri-button--drill-in:hover,.esri-button--drill-in:focus{background-color:var(--calcite-color-foreground-2)}.esri-button--drill-in__title{font-size:var(--calcite-font-size)}.esri-button--drill-in [class^=esri-icon-],.esri-button--drill-in [class*=" esri-icon-"]{padding:0 7px}.esri-widget--button{cursor:pointer;text-align:center;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);flex-flow:row;justify-content:center;align-items:center;width:var(--calcite-spacing-xxxl);height:var(--calcite-spacing-xxxl);margin:0;padding:0;font-size:var(--calcite-font-size);transition:background-color .125s ease-in-out;display:flex;overflow:hidden}.esri-widget--button:is(calcite-button):not(:hover){--calcite-icon-color: var(--calcite-color-text-3)}.esri-widget--button:not([appearance]),.esri-widget--button[appearance=solid]{--calcite-color-foreground-3: var(--calcite-color-foreground-1)}.esri-widget--button:is(calcite-button){--calcite-offset-invert-focus: 1}.esri-widget--button calcite-loader[inline]{margin:auto}.esri-button--secondary{color:var(--calcite-color-brand);background-color:var(--calcite-color-foreground-1);&:hover{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-status-info);border:1px solid var(--calcite-color-status-info)}}.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}.esri-hidden{display:none!important}[class^=esri-icon-],[class*=" esri-icon-"]{speak:none;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:var(--calcite-font-weight-normal);line-height:1;font-family:CalciteWebCoreIcons!important}.esri-icon-close:before{content:"";color:inherit}.esri-icon-drag-horizontal:before{content:"";color:inherit}.esri-icon-drag-vertical:before{content:"";color:inherit}.esri-icon-handle-horizontal:before{content:"";color:inherit}.esri-icon-handle-vertical:before{content:"";color:inherit}.esri-icon-check-mark:before{content:"";color:inherit}.esri-icon-left-triangle-arrow:before{content:"";color:inherit}.esri-icon-right-triangle-arrow:before{content:"";color:inherit}.esri-icon-down-arrow:before{content:"";color:inherit}.esri-icon-up-arrow:before{content:"";color:inherit}.esri-icon-overview-arrow-bottom-left:before{content:"";color:inherit}.esri-icon-overview-arrow-bottom-right:before{content:"";color:inherit}.esri-icon-overview-arrow-top-left:before{content:"";color:inherit}.esri-icon-overview-arrow-top-right:before{content:"";color:inherit}.esri-icon-maximize:before{content:"";color:inherit}.esri-icon-minimize:before{content:"";color:inherit}.esri-icon-checkbox-unchecked:before{content:"";color:inherit}.esri-icon-checkbox-checked:before{content:"";color:inherit}.esri-icon-radio-unchecked:before{content:"";color:inherit}.esri-icon-radio-checked:before{content:"";color:inherit}.esri-icon-up-arrow-circled:before{content:"";color:inherit}.esri-icon-down-arrow-circled:before{content:"";color:inherit}.esri-icon-left-arrow-circled:before{content:"";color:inherit}.esri-icon-right-arrow-circled:before{content:"";color:inherit}.esri-icon-zoom-out-fixed:before{content:"";color:inherit}.esri-icon-zoom-in-fixed:before{content:"";color:inherit}.esri-icon-refresh:before{content:"";color:inherit}.esri-icon-edit:before{content:"";color:inherit}.esri-icon-authorize:before{content:"";color:inherit}.esri-icon-map-pin:before{content:"";color:inherit}.esri-icon-blank-map-pin:before{content:"";color:inherit}.esri-icon-table:before{content:"";color:inherit}.esri-icon-plus:before{content:"+";color:inherit}.esri-icon-minus:before{content:"";color:inherit}.esri-icon-beginning:before{content:"";color:inherit}.esri-icon-reverse:before{content:"";color:inherit}.esri-icon-pause:before{content:"";color:inherit}.esri-icon-play:before{content:"";color:inherit}.esri-icon-forward:before{content:"";color:inherit}.esri-icon-end:before{content:"";color:inherit}.esri-icon-erase:before{content:"";color:inherit}.esri-icon-up-down-arrows:before{content:"";color:inherit}.esri-icon-left:before{content:"";color:inherit}.esri-icon-right:before{content:"";color:inherit}.esri-icon-announcement:before{content:"";color:inherit}.esri-icon-notice-round:before{content:"";color:inherit}.esri-icon-notice-triangle:before{content:"";color:inherit}.esri-icon-home:before{content:"";color:inherit}.esri-icon-locate:before{content:"";color:inherit}.esri-icon-expand:before{content:"";color:inherit}.esri-icon-collapse:before{content:"";color:inherit}.esri-icon-layer-list:before{content:"";color:inherit}.esri-icon-basemap:before{content:"";color:inherit}.esri-icon-globe:before{content:"";color:inherit}.esri-icon-applications:before{content:"";color:inherit}.esri-icon-arrow-up-circled:before{content:"";color:inherit}.esri-icon-arrow-down-circled:before{content:"";color:inherit}.esri-icon-arrow-left-circled:before{content:"";color:inherit}.esri-icon-arrow-right-circled:before{content:"";color:inherit}.esri-icon-minus-circled:before{content:"";color:inherit}.esri-icon-plus-circled:before{content:"";color:inherit}.esri-icon-add-attachment:before{content:"";color:inherit}.esri-icon-attachment:before{content:"";color:inherit}.esri-icon-calendar:before{content:"";color:inherit}.esri-icon-close-circled:before{content:"";color:inherit}.esri-icon-browser:before{content:"";color:inherit}.esri-icon-collection:before{content:"";color:inherit}.esri-icon-comment:before{content:"";color:inherit}.esri-icon-configure-popup:before{content:"";color:inherit}.esri-icon-contact:before{content:"";color:inherit}.esri-icon-dashboard:before{content:"";color:inherit}.esri-icon-deny:before{content:"";color:inherit}.esri-icon-description:before{content:"";color:inherit}.esri-icon-directions:before{content:"";color:inherit}.esri-icon-directions2:before{content:"";color:inherit}.esri-icon-documentation:before{content:"";color:inherit}.esri-icon-duplicate:before{content:"";color:inherit}.esri-icon-review:before{content:"";color:inherit}.esri-icon-environment-settings:before{content:"";color:inherit}.esri-icon-error:before{content:"";color:inherit}.esri-icon-error2:before{content:"";color:inherit}.esri-icon-experimental:before{content:"";color:inherit}.esri-icon-feature-layer:before{content:"";color:inherit}.esri-icon-filter:before{content:"";color:inherit}.esri-icon-grant:before{content:"";color:inherit}.esri-icon-group:before{content:"";color:inherit}.esri-icon-key:before{content:"";color:inherit}.esri-icon-labels:before{content:"";color:inherit}.esri-icon-tag:before{content:"";color:inherit}.esri-icon-layers:before{content:"";color:inherit}.esri-icon-left-arrow:before{content:"";color:inherit}.esri-icon-right-arrow:before{content:"";color:inherit}.esri-icon-link-external:before{content:"";color:inherit}.esri-icon-link:before{content:"";color:inherit}.esri-icon-loading-indicator:before{content:"";color:inherit}.esri-icon-maps:before{content:"";color:inherit}.esri-icon-marketplace:before{content:"";color:inherit}.esri-icon-media:before{content:"";color:inherit}.esri-icon-media2:before{content:"";color:inherit}.esri-icon-menu:before{content:"";color:inherit}.esri-icon-mobile:before{content:"";color:inherit}.esri-icon-phone:before{content:"";color:inherit}.esri-icon-navigation:before{content:"";color:inherit}.esri-icon-pan:before{content:"";color:inherit}.esri-icon-printer:before{content:"";color:inherit}.esri-icon-pie-chart:before{content:"";color:inherit}.esri-icon-chart:before{content:"";color:inherit}.esri-icon-line-chart:before{content:"";color:inherit}.esri-icon-question:before{content:"";color:inherit}.esri-icon-resend-invitation:before{content:"";color:inherit}.esri-icon-rotate:before{content:"";color:inherit}.esri-icon-save:before{content:"";color:inherit}.esri-icon-settings:before{content:"";color:inherit}.esri-icon-settings2:before{content:"";color:inherit}.esri-icon-share:before{content:"";color:inherit}.esri-icon-sign-out:before{content:"";color:inherit}.esri-icon-support:before{content:"";color:inherit}.esri-icon-user:before{content:"";color:inherit}.esri-icon-time-clock:before{content:"";color:inherit}.esri-icon-trash:before{content:"";color:inherit}.esri-icon-upload:before{content:"";color:inherit}.esri-icon-download:before{content:"";color:inherit}.esri-icon-zoom-in-magnifying-glass:before{content:"";color:inherit}.esri-icon-search:before{content:"";color:inherit}.esri-icon-zoom-out-magnifying-glass:before{content:"";color:inherit}.esri-icon-locked:before{content:"";color:inherit}.esri-icon-unlocked:before{content:"";color:inherit}.esri-icon-favorites:before{content:"";color:inherit}.esri-icon-compass:before{content:"";color:inherit}.esri-icon-down:before{content:"";color:inherit}.esri-icon-up:before{content:"";color:inherit}.esri-icon-chat:before{content:"";color:inherit}.esri-icon-dock-bottom:before{content:"";color:inherit}.esri-icon-dock-left:before{content:"";color:inherit}.esri-icon-dock-right:before{content:"";color:inherit}.esri-icon-organization:before{content:"";color:inherit}.esri-icon-north-navigation:before{content:"";color:inherit}.esri-icon-locate-circled:before{content:"";color:inherit}.esri-icon-dial:before{content:"";color:inherit}.esri-icon-polygon:before{content:"";color:inherit}.esri-icon-polyline:before{content:"";color:inherit}.esri-icon-visible:before{content:"";color:inherit}.esri-icon-non-visible:before{content:"";color:inherit}.esri-icon-link-vertical:before{content:"";color:inherit}.esri-icon-unlocked-link-vertical:before{content:"";color:inherit}.esri-icon-link-horizontal:before{content:"";color:inherit}.esri-icon-unlocked-link-horizontal:before{content:"";color:inherit}.esri-icon-swap:before{content:"";color:inherit}.esri-icon-cta-link-external:before{content:"";color:inherit}.esri-icon-reply:before{content:"";color:inherit}.esri-icon-public:before{content:"";color:inherit}.esri-icon-share2:before{content:"";color:inherit}.esri-icon-launch-link-external:before{content:"";color:inherit}.esri-icon-rotate-back:before{content:"";color:inherit}.esri-icon-pan2:before{content:"";color:inherit}.esri-icon-tracking:before{content:"";color:inherit}.esri-icon-expand2:before{content:"";color:inherit}.esri-icon-arrow-down:before{content:"";color:inherit}.esri-icon-arrow-up:before{content:"";color:inherit}.esri-icon-hollow-eye:before{content:"";color:inherit}.esri-icon-play-circled:before{content:"";color:inherit}.esri-icon-volume-off:before{content:"";color:inherit}.esri-icon-volume-on:before{content:"";color:inherit}.esri-icon-bookmark:before{content:"";color:inherit}.esri-icon-lightbulb:before{content:"";color:inherit}.esri-icon-sketch-rectangle:before{content:"";color:inherit}.esri-icon-north-navigation-filled:before{content:"";color:inherit}.esri-icon-default-action:before{content:"";color:inherit}.esri-icon-undo:before{content:"";color:inherit}.esri-icon-redo:before{content:"";color:inherit}.esri-icon-cursor:before{content:"";color:inherit}.esri-icon-cursor-filled:before{content:"";color:inherit}.esri-icon-measure:before{content:"";color:inherit}.esri-icon-measure-line:before{content:"";color:inherit}.esri-icon-measure-area:before{content:"";color:inherit}.esri-icon-legend:before{content:"";color:inherit}.esri-icon-sliders:before{content:"";color:inherit}.esri-icon-sliders-horizontal:before{content:"";color:inherit}.esri-icon-cursor-marquee:before{content:"";color:inherit}.esri-icon-lasso:before{content:"";color:inherit}.esri-icon-elevation-profile:before{content:"";color:inherit}.esri-icon-slice:before{content:"";color:inherit}.esri-icon-line-of-sight:before{content:"";color:inherit}.esri-icon-zoom-to-object:before{content:"";color:inherit}.esri-icon-urban-model:before{content:"";color:inherit}.esri-icon-measure-building-height-shadow:before{content:"";color:inherit}.esri-icon-partly-cloudy:before{content:"";color:inherit}.esri-attachments__progress-bar:before,.esri-attachments__progress-bar:after{opacity:var(--calcite-opacity-100);content:"";height:1px;transition:opacity .5s ease-in-out;position:absolute;top:0}.esri-attachments__progress-bar:before{z-index:0;background-color:var(--calcite-color-foreground-2);width:100%}.esri-attachments__progress-bar:after{z-index:0;background-color:var(--calcite-color-text-2);width:20%;animation:1.5s linear infinite looping-progresss-bar-ani}.esri-attachments{background-color:var(--calcite-color-background)!important;width:100%}.esri-attachments__loader-container{justify-content:center;align-items:center;height:150px;padding:0;display:flex}.esri-attachments__loader{background:url(data:image/gif;base64,R0lGODlhIQAnALMKAAB6wrze86TR7Y3F53W44V6s2kaf1C+TzheGyNPq+f///wAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1MkRGQzEzOEQ3MUIxMUU0QjJCRTkxRjI3NjA5MTc2MyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2RDdDRTgwM0Q3MjAxMUU0QjJCRTkxRjI3NjA5MTc2MyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2RDdDRTgwMkQ3MjAxMUU0QjJCRTkxRjI3NjA5MTc2MyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQyYThhNjgzLWIwNjctNDhhZi05Nzc0LTZiOTZkM2RhMjI2OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo1MkRGQzEzOEQ3MUIxMUU0QjJCRTkxRjI3NjA5MTc2MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAkEAAoALAAAAAAhACcAAASOUMlJq70W6L2xv1z4jVPIkaTZoZ+qsa0Ley4wY7WU7Dyv9z1JTgEMEos7oeyI/DUVQ2SSWVSqnFUq0GrCbrXGqNQbXkoTZB/UPAarxc8zV+SeytfXOlo/P/H/cFl3gV+DbHFthEaGeXeMXX+PdI6Jh4KVjW2SfpRPQzcVn6AlS6OkeaZ9K6l4kKyirLEXEQAh+QQJBAAKACwAAAAAIQAnAAAEqFDJSau9OOutkP8fx4GkuJGgqaGhirGe+8JSYN+3CCM1jkuJoFAo2fV8NuBwWKQpkDnFktlxQpPSabDJOiKVWi7K6wNPxaXn1bxEp9RQNtUI/2bD1W69fD/nx3s/fW1/aVcBckSFb4eJW4stjYNzVmuTinSSWo+ZlpsJbpGem6ExgVGfpTynWKmQppqkr6uxeJ1xl5yVuCdOMhV0vxTBwqrFw77HysvFEQAh+QQFBAAKACwAAAAAIQAnAAAEqFDJSau9OOvNez5gGHqaaJKfOaKXugpwHHcuKMk4Xd/4rCTAYFBSO/B6AolwSdwpkDDlcqgoHnvSaaLpuuZ+2m3VCU2CtVyVV5adpk9PaJs57saRc+FbtPaFxVZ3WGdudWqCX397L3KEdIFleVSQjYqGcJGOepd8iGyak2SVYYs2nn6knIx4oEClRqdRrYCirJaUtqm4gxu7X71OLBWBwhTExcjJysseEQAh+QQJBAAKACwBAAMAFAAhAAAEU9DIOZW9WNGd+6Zd9lXKYJ7nKFloqxpsm6qxPLy1jJf2TfO2Xc83yrl+Q2FPGUQunc0iUAelSpPV4/W5jX6MKKb1O9WSsd0xpxzOtqUhyy6u+dEjACH5BAkEAAoALAAAAAAhACcAAASAUMlJq7046827/10hjiOIkahErCwboqXSzi9cqLPL2SKeEzWYLxdMyX7AHW9IU9qYrSIJqtvwbsefNIZMWpdZolMYbn6f5ejY2N320lXNlbpyY9vrKbye5yLtdF5yYHhnZIWDaIgZc3uCjIR/fW+LJ5Fak3eShkYmnp+goaKjHREAIfkECQQACgAsAAAAACEAJwAABKhQyUmrvTjrzbv/IFaMJNkRaJpKZXuqKtuaHBwrM73ZK54XkoRwOJTwULJckEg0HpOzJVPo5EFdimlRcSRcS9Jp1falaancp0+ZPY9h5VGY+b79gG1tvXefN9NWa1F5YoBkglhnCXtIiGCEdIZwjmZuknY/fltdcXiKjF6UcpB/nKKelqZ9pJtqq5+XfJmsaKqzsLZsuK6zO7xsvoGrIRXDxMfIycrLxBEAIfkEBQQACgAsAAAAACEAJwAABKdQyUmrvTjrzbu3RiiKXzaeJXaO3eC+r7SSHGzLs9HasZLrioRwOJTwej8JcWk8DnAz5bKocD59Oek00TxCV9ppl/dFBbfcqrPMOm/HN2zULVZ75WA6007Gm9FpVmw0gHAwgyFhe4J+bYV8cUl6RIZIWZNUjJKPmpeca42EaJUuiECfd5ujkIehiZhCpFeqb6yWc6h9khudcykVu78TwcKuQMXIycrKEQAh+QQJBAAKACwBAAMAFAAhAAAEVVDJSdW5GNed+65dJowkKYVYqZ7ooZYs+ppWO49xeAt5t/eiGzAlrMmKLRfStjzOhpefUdekPqe+avaalHa1QS5T7HxBlWSrGRtef9OezyQpn7fq5wgAIfkECQQACgAsAAAAACEAJwAABIBQyUmrvTjrzZH/H9eBoLiRpZmhoYqxnhjMNC3BiFzXN6zvsx7rBxSiiDsjCclT4Jg2p48DjD6p1YAytclqpUNsddvqZskxcRF8VCfZS3fzah7DuRovOie3TutrdHlnd2WDdoIZeoVpgG+JGIuQF5J/LhWTl5kumyqdJp+XoqMiEQAh+QQJBAAKACwAAAAAIQAnAAAEjlDJSau9OIPNef5VJ4KkInYleHqptgKtu8bYC5NJruuSLe3AH5BnegmHieOwZ1Qgc8pgceZ8RndM6jNZRWZPV+L2O+ouzVIfGrsmqsdt6BQc58Lf1joZpe/jvX5NcHeCeYRahnl/Z4d0g4qFgI1lj4CLUpN8lWeXbCpNNCGgoRNqpKWjp6anc2WsrXyvrBEAIfkECQQACgAsAAAAACEAJwAABKlQyUmrvTjrzZH/H9eBoLiRpZmhoYqxnvvCUmDft5TsPC/BiBoOp+v1fjTFkKgwHhVA4TJQdCaQLOmy6sSitEOu0UsCM607cmpqEz+jSrbbB02yqU20unWfp+tZcVN+V4Bfglt5VnsxiGGKXYZljmd6kmtykGOXfJlohXB9mm92npahpoucjaKfjEGUOaN0qIOzf7WJJ6W2u4EyFXDAFMLDr8bEScjLzBoRACH5BAUEAAoALAAAAAAhACcAAASqUMlJq7046827t0coil82niV2jum1koogz3P3hhKtS0nv+5LbIaerKX7I4I1YFPCQQIWQWXxCE8oXdXe8YqXLWNPZvWZXW5oVekaJm+skWPuultlzdJ3r/U73andyf2NkfW0sgEaHeW6FcT+IMI+CkY2JlIyEY5BRm3CVnmGZXpI4ijKdPaZDqIall5Ocoauxp6Rmtq2UG592vaOzwHQtFH/FE8fIy8zNzBEAIfkECQQACgAsDAADABQAIQAABFPQyDmVvVjRnfumXfZVymCe5yhZaKsabJuqsTy8tYyX9k3ztl3PN8q5fkNhTxlELp3NIlAHpUqT1eP1uY1+jCim9TvVkrHdMacczralIcsurvnRIwAh+QQJBAAKACwAAAAAIQAnAAAEgFDJSau9OOvNu/8gVowkGV5lKhFs23ZpubouHI8zzdp3rvMxHw2oUuhenBvOeCQQZczj0xT9JZXC2rVXHW6DXe1GWcgix9jwWUM2777FphMOlU+Xdjo1j+by2Wl/GW1qb31ggiKBTXdlhXOHcYx6eJORdZaAfpmDaSefoKGio58RACH5BAkEAAoALAAAAAAhACcAAASoUMlJq7046827/2AoFWRZdkSqqqNpouvauiQcpzMtJXzfSzeWgnZS+I7AICHn2h1/CuVySCw4n4lkkPkyYrNRJbf4BUvHNS9We0Nb1U92zH2Nh7dUYh15b+d1cHxnf02BPnIyhF1liEJVb4x9c4pkX404lGmRg497h5KJnYZQnFWepGKZkJagjqajPJdTopuptKylehy5gBu8hb62ryIUosTHyMnKyxIRACH5BAUEAAoALAAAAAAhACcAAASpUMlJq7046827/5IhjiOIkah5oWQ3vDAcsqIbxzMtJXzfSzecglZT+I7A4CvH2h1/CuVySHQ+E0klM2W8YqPSbat7zQbFJfLTfEMXvV/pwG2wrsFaqk6NxJ/1TXw+bEJEdYJQcnR2fYqAXHCEMo9jkX5tlGmWjoaMg5eFVYg8klOdo3FhmW9epXOrh5uqp7J5tK2gk6cbnKK8s74qE7vCi8XDwcfKy8wWEQAh+QQJBAAKACwMAAMAFAAhAAAEVVDJSdW5GNed+65dJowkKYVYqZ7ooZYs+ppWO49xeAt5t/eiGzAlrMmKLRfStjzOhpefUdekPqe+avaalHa1QS5T7HxBlWSrGRtef9OezyQpn7fq5wgAIfkECQQACgAsAAAAACEAJwAABIBQyUmrvTjrzTf6INh5YThqpXliqbhe7dcFdF1LMTLbNh7vPJqvBQwOU0XesZTsKXLN2/PHCUqhVWtgqdpot1Ni1sp1ebVl2dgYRq6VbebbiT2T413NN62bX6l2bHV6aHhmhHeDGXuGaoFwihiMkReTgC8UlC+aK5wnniOgmKOjEQAh+QQJBAAKACwAAAAAIQAnAAAEjlDJSau9OGsFuvdbyH2fuJGlmaGgirGd+8LyBQNSou97zvOSm++nGxKDNAWxp1wmkCzjTwocRZtLKlOIPXanVpS2+K1ync/yNokep89ON1SsJrfDJHn9zY7v53l/gnBZg32Fd4ReiYeLfopgjFd3knSUj42RmJN+lYE1FFygE6KjeCmmpy2ppaOtoK+pFhEAIfkECQQACgAsAAAAACEAJwAABI1QyUmrvTjrzTf6INh5YThqpXliqbhe7ffCsZTcOG7nuRQjO94tKPTVFEIdMpkwtog8aE/xkyqZTeoRax1qn8tkN1sNF83Rb2rMVpfaXLcqHi/Tmc41elrf4vdKdn99YHdici6GZ4KHhHqKaYxnjm+AXpRzg3+SaZguMxRloBOio4gypnmVqaWjramwLxEAIfkEBQQACgAsAAAAACEAJwAABIpQyUmrvTjrzbv/0iGOI4iRqHmhpGqxpUvBopTcOG7neUjvvBsw6IMNeceegnZI6hTBJ9MphEYTRRYVa41mU11iGLn8jZVX7vT8TH9b7Kq7bIxz5+s53qy/vmN9XnRadlt/NYWJeX6KfIx7dYFii4KQhJJklGKWYJhKazKHTaGipKWmoKGppqytrBEAIfkECQQACgAsFwADAAkAIQAABBLQyEmrvTjrzbv/YCiOZGmeZQQAIfkECQQACgAsAAAAACEAJwAABFBQyUmrvTjrzbv/YCgVZFmKlqmilWqylHvCo1zQtYwr9o33O+DPFiQOdUdXEUkTNo1PJsw5hValLGrWusWitF9u2CsCl8Vncsi8Ru/e8PguAgAh+QQJBAAKACwAAAAAIQAnAAAEhlDJSau9OOvNu/9gKIZEaZpjda4ptZ5SIs9zTNPSiyo3zveynI5gAxZ7Qt3xtvQNiT9jFKl4NmtTZnV4DWad3C8W6LWKveRE8tVVn93mdHvNes+3Srs+Tr7zpXJ4bHqBf1SFYYGIeYp9gnWNUoZai4ORVJM+lXUtjzCdnjudZqClpqeoqRsRACH5BAUEAAoALAAAAAAhACcAAASFUMlJq7046827/2AojuQ2nChaTmkrJXAcv7IstSldw/p+46deTWhTAIOK3SypTPyAxGXTaTxGeUzlE3elTreurE88rELJxa+Zi5Y2wbk2Vn0cdO/rsJpulXvfeXF7gHV4fGeDWoEqfniFjZCPiWOSgIdsk2WVipdhK4+ffSujpKWmp6grEQAh+QQJBAAKACwXAAYACQAbAAAEEFDISau9OOvNu/9gKI5kyUUAIfkECQQACgAsAAAAACEAJwAABElQyUmrvTjrzbv/YCiOZGkqQaqqJ7qu7QufMkvXQYzrNS/7L+DMhMvdesdfMrgclopCG3HXlD6pU2RWuWV2nSRoa0wum8/o9CYCACH5BAUEAAoALAAAAAAhACcAAARsUMlJq7046827/2AojmRpckmqqtLqti6rxDKdwjQe6+9s8ytg7efLFXfHni0hvCWDz6Fx2WRGndSrNcsldqfeMHiM/JbFZ7ISvVZDze20PE5/s+1u6Ry/19f9fH9Yd4CFTieIiYqLjI2OjyQRACH5BAUEAAoALAAAAAABAAEAAAQCUEUAIfkEBQQACgAsAAAAAAEAAQAABAJQRQA7) 50% no-repeat;width:100%;height:64px}.esri-attachments__actions{flex-flow:wrap;padding:6px 7px;display:flex}.esri-attachments__item-add-icon{font-size:var(--calcite-font-size-xl);margin:0;padding:0 7px}.esri-attachments__delete-button{color:var(--calcite-color-status-danger);width:auto;margin-right:auto}.esri-attachments .esri-attachments__items{width:100%;margin:0;padding:0;display:flex}.esri-attachments .esri-attachments__item{margin:0;line-height:var(--calcite-font-line-height-relative-tight);list-style-type:none}.esri-attachments__item-button{outline-offset:-4px;cursor:pointer;width:100%;text-align:unset;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-2);border:1px solid var(--calcite-color-foreground-1);border-radius:var(--calcite-border-width-md);align-items:center;margin:0 0 var(--calcite-spacing-xs);padding:var(--calcite-spacing-xs) 7px;text-decoration:none;transition:border-color .125s ease-in-out;display:flex;box-shadow:0 1px var(--calcite-color-foreground-1)}.esri-attachments__item-button:focus,.esri-attachments__item-button:hover{border-color:var(--calcite-color-border-white)}.esri-attachments__item-link{text-decoration:none;display:block;position:relative}.esri-attachments__item-link:hover .esri-attachments__item-link-overlay,.esri-attachments__item-link:focus .esri-attachments__item-link-overlay{opacity:1}.esri-attachments__item-add{background-color:var(--calcite-color-background);padding:6px 0}.esri-attachments__add-attachment-button{align-items:baseline!important;border-radius:var(--calcite-corner-radius-xs);border:none!important;justify-content:flex-start!important;padding:12px 3px!important;font-size:var(--calcite-font-size-sm)!important;transition:background-color .25s ease-in-out}.esri-attachments__add-attachment-button:hover{background-color:var(--calcite-color-foreground-1)!important;text-decoration:none;box-shadow:0 1px 2px #0000004d}.esri-attachments__item-link-overlay{opacity:0;pointer-events:none;-webkit-user-select:none;user-select:none;justify-content:center;align-items:center;transition:opacity .25s ease-in-out;display:flex;position:absolute;inset:0}.esri-attachments__item-link-overlay-icon{color:var(--calcite-color-foreground-2);background-color:var(--calcite-color-foreground-1);border-radius:100%;justify-content:center;align-items:center;padding:18px;display:flex}.esri-attachments__item-link-overlay-icon svg{fill:var(--calcite-color-foreground-1)}.esri-attachments__item-mask{justify-content:center;align-items:center;width:64px;height:64px;display:flex;position:relative;overflow:hidden;box-shadow:0 0 0 1px var(--calcite-color-foreground-1)}.esri-attachments__item-mask--icon{background-color:var(--calcite-color-foreground-2);padding:24px 0}.esri-attachments__item-mask--icon .esri-attachments__image{width:var(--calcite-spacing-xxxl);height:var(--calcite-spacing-xxxl)}.esri-attachments__metadata{justify-content:space-between;margin-top:3px;display:flex}.esri-attachments__metadata .esri-attachments__metadata-fieldset{text-align:center;background-color:var(--calcite-color-foreground-1);border:none;flex:0 calc(50% - 1px);margin:0;padding:6px 7px;font-size:var(--calcite-font-size-sm)}.esri-attachments__file-name{white-space:pre-wrap;word-break:break-word;word-wrap:break-word;margin-bottom:3px;font-size:var(--calcite-font-size-sm);display:inline-block}.esri-attachments__file-fieldset{border:none;margin:0;padding:var(--calcite-spacing-md) 7px}.esri-attachments__file-input{opacity:0;z-index:-1;width:.1px;height:.1px;position:absolute;overflow:hidden}.esri-attachments__container--list .esri-attachments__items{flex-flow:column}.esri-attachments__container--list .esri-attachments__item-mask{flex:none;margin-right:7px;position:relative}.esri-attachments__container--list .esri-attachments__image{max-width:unset;max-height:unset;left:50%}.esri-attachments__container--list .esri-attachments__label{flex:auto;justify-content:space-between;display:flex}.esri-attachments__container--list .esri-attachments__filename{white-space:pre-wrap;word-break:break-word;word-wrap:break-word;cursor:pointer;flex:1 0 0}.esri-attachments__container--list .esri-attachments__item-chevron-icon{cursor:pointer;flex:none;padding:0 15px}.esri-attachments__container--preview .esri-attachments__items{flex-flow:wrap;align-items:center}.esri-attachments__container--preview .esri-attachments__item{width:100%;margin-bottom:var(--calcite-spacing-md)}.esri-attachments__container--preview .esri-attachments__item-mask{width:100%;height:auto}.esri-attachments__container--preview .esri-attachments__item-button{box-shadow:none;flex-flow:column}.esri-attachments__container--preview .esri-attachments__item-button .esri-attachments__label{margin:var(--calcite-spacing-md) 0}.esri-attachments__container--preview .esri-attachments__image{max-width:100%}.esri-attachments__container--preview .esri-attachments__filename{white-space:pre-wrap;word-break:break-word;word-wrap:break-word;text-align:center;text-overflow:ellipsis;width:calc(100% - 15px);margin-top:var(--calcite-spacing-md);overflow:hidden}.esri-attachments__container--preview .esri-attachments__item-mask--icon{background-color:var(--calcite-color-foreground-1)}.esri-attachments__form-node{background-color:var(--calcite-color-foreground-1);padding:6px 7px;box-shadow:var(--calcite-shadow-sm)}.esri-attachments__form-node .esri-attachments__item-mask{box-shadow:none;width:unset;height:unset}.esri-attachments__form-node .esri-attachments__image{max-width:100%}.esri-attachments__error-message{background-color:var(--calcite-color-foreground-1);border-top:3px solid var(--calcite-color-status-danger);margin:6px 7px;padding:var(--calcite-spacing-md) 15px;animation:.25s ease-in-out esri-fade-in-down;box-shadow:0 1px 2px #0000004d}.esri-attachments__progress-bar{width:100%;position:absolute}.esri-attachments__item-mask:dir(rtl){margin-left:7px;margin-right:0}.esri-feature-form{letter-spacing:0em;background:var(--calcite-color-background);padding:var(--esri-widget-padding)}.esri-feature-form__disabled-notice{margin-bottom:var(--calcite-spacing-xl)}.esri-feature-form .esri-feature-utility-network-associations,.esri-feature-form .esri-feature-form-utility-network-association-list{margin-block-end:var(--calcite-spacing-md)}.esri-feature-form .esri-feature-utility-network-associations .esri-feature-element-info__description{color:var(--calcite-color-text-2)}.esri-feature-form .esri-feature-utility-network-associations .esri-feature-element-info h5{font-size:inherit}.esri-feature-form__form{flex-direction:column;display:flex}.esri-feature-form__centered-button{align-self:center}.esri-feature-form__description-text{color:var(--calcite-color-text-2);font-size:var(--calcite-font-size-sm)}.esri-feature-form__list-observer{z-index:2;text-align:center;position:relative;bottom:var(--calcite-spacing-xxl)}.esri-feature-form__related-records_header{margin-bottom:var(--calcite-spacing-xs);display:flex}.esri-feature-form__related-records_header span{flex-grow:1}.esri-feature-form__related-records_label calcite-notice,.esri-feature-form__related-records_label .esri-feature-form__description-text{margin-bottom:var(--calcite-spacing-xs)}.esri-feature-form__related-records_list{min-height:40px;margin-bottom:var(--calcite-spacing-xs)}label.esri-feature-form__label{gap:.5em;margin-bottom:var(--calcite-spacing-md)}.esri-feature-form__label{opacity:1;flex-direction:column;justify-content:space-between;margin-bottom:var(--calcite-spacing-xs);transition:opacity .25s,margin .25s;display:flex;position:relative}.esri-feature-form__label:last-child{margin-bottom:0}.esri-feature-form__label-text-content{white-space:pre-wrap;word-break:break-word;word-wrap:break-word;align-items:center;display:flex}.esri-feature-form__form-header{margin-bottom:var(--calcite-spacing-md)}.esri-feature-form__form-header .esri-feature-form__description-text~.esri-widget__heading{margin-bottom:0}.esri-feature-form__input{width:100%}.esri-feature-form__input:focus{outline:2px solid var(--calcite-color-brand);outline-offset:-2px}textarea.esri-feature-form__input{resize:vertical}.esri-feature-form__input--disabled{background-color:var(--calcite-color-background);font-weight:var(--calcite-font-weight-medium)}.esri-feature-form__field-error-message{padding:7px 0;font-size:var(--calcite-font-size-sm)}.esri-feature-form__date-input-container{flex-direction:column;display:flex}.esri-feature-form__date-input-container .esri-feature-form__input{margin-bottom:3px}.esri-feature-form__date-input-container :last-child{margin-bottom:0}.esri-feature-form__input--radio-group{flex-direction:column;display:flex}.esri-feature-form__input--radio-label{align-items:center;display:flex}.esri-feature-form__input--switch{margin:7px 0}.esri-feature-form__group{margin:0 0 var(--calcite-spacing-md);background-color:inherit;margin-inline:-10px}.esri-feature-form__group--sequential{border-bottom:none;border-inline-start:3px solid #adadad4d}.esri-feature-form__group--active{border-inline-start-color:var(--calcite-color-status-info)}.esri-feature-form__text-element{color:var(--calcite-color-text-3);line-height:var(--calcite-font-line-height-relative-snug);font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-normal)}.esri-feature-form__text-element a{transition:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start inset-size,opacity,outline-color,transform var(--calcite-animation-timing) ease-in-out 0s,outline 0s,outline-offset 0s;background-color:var(--calcite-color-background);background-image:linear-gradient(currentColor,currentColor),linear-gradient(var(--calcite-color-brand-underline),var(--calcite-color-brand-underline));color:var(--calcite-color-text-link);background-position-x:0%,100%;background-position-y:min(1.5em,100%);background-repeat:no-repeat,no-repeat;background-size:0% 1px,100% 1px;border-style:none;padding:0;text-decoration:none;display:inline;position:relative}.esri-feature-form__text-element a:hover,.esri-feature-form__text-element a:focus{background-size:100% 1px,100% 1px}.esri-feature-form__text-element a:active{background-size:100% 2px,100% 2px}.esri-feature-form__text-element a.calcite--rtl{background-position:100% 100%,100% 100%}.esri-feature-form__text-element code{border:1px solid var(--calcite-color-border-3);background-color:var(--calcite-color-foreground-3);white-space:normal;word-break:break-word;color:var(--calcite-color-text-2);font-family:var(--calcite-code-family);border-radius:var(--calcite-spacing-base);padding:.25em;font-size:85%}.esri-feature-form__text-element h1,.esri-feature-form__text-element h2,.esri-feature-form__text-element h3,.esri-feature-form__text-element h4,.esri-feature-form__text-element h5{color:var(--calcite-color-text-1);line-height:var(--calcite-font-line-height-relative-snug);font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-bold);margin-bottom:var(--calcite-spacing-xxs)}.esri-feature-form__text-element h5{font-weight:var(--calcite-font-weight-medium)}.esri-feature-form__text-element h6{color:var(--calcite-color-text-2);line-height:var(--calcite-font-line-height-relative-snug);font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-medium);margin-bottom:var(--calcite-spacing-xxs)}.esri-feature-form__text-element p{color:var(--calcite-color-text-3);line-height:var(--calcite-font-line-height-relative-snug);font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-normal);margin-bottom:var(--calcite-spacing-xl)}.esri-feature-form__text-element strong{font-weight:var(--calcite-font-weight-bold)}:dir(rtl) .esri-feature-form__date-input-part:first-child .esri-feature-form__input{border-left:none;border-right:1px solid #adadad4d}.esri-feature-form-utility-network-association-layers{background-color:var(--calcite-color-background)}.esri-feature-form-utility-network-association-layers__header>*{margin-block-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-layers__header>:last-child{color:var(--calcite-color-text-3)}.esri-feature-form-utility-network-association-layers__heading-content{align-items:center;display:flex}.esri-feature-form-utility-network-association-layers__heading-content calcite-icon{margin-inline-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-layers__list-container{min-height:var(--calcite-spacing-xxxl);margin-bottom:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-layers__feature-observer{z-index:2;text-align:center;position:relative;bottom:20px}.esri-feature-form-utility-network-association-layers__filter-container{z-index:1;margin-bottom:var(--calcite-spacing-md);top:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-layers__filter-options-container{flex-direction:column;display:flex}.esri-feature-form-utility-network-association-layers__filter-options-header{flex-direction:row;align-items:baseline;display:flex}.esri-feature-form-utility-network-association-layers__filter-options-header span{flex-grow:1}.esri-feature-form-utility-network-association-layers__spatial-select-container{flex-direction:column;align-items:flex-end;gap:6px;display:flex}.esri-feature-form-utility-network-association-layers__spatial-select-toolbar{--calcite-action-group-border-color: transparent;border-width:var(--calcite-border-width-sm, 1px);border-radius:var(--calcite-corner-radius-round, 4px);border-style:solid;border-color:var(--calcite-color-border-3, var(--calcite-color-inverse));width:100%;min-height:min-content;overflow:hidden}.esri-feature-form-utility-network-association-layers__sticky-loading-container{z-index:2;pointer-events:none;justify-content:center;align-items:center;height:var(--calcite-spacing-xxxl);margin:0;padding:0;display:flex;position:sticky;bottom:10px}.esri-feature-form-utility-network-association-layers__loading-container{justify-content:center;width:100%;padding:var(--calcite-spacing-md) 0;display:flex}.esri-feature-form-utility-network-association-list{background-color:var(--calcite-color-foreground-1)}.esri-feature-form-utility-network-association-list__header>*{margin-block-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-list__header>:last-child{color:var(--calcite-color-text-3)}.esri-feature-form-utility-network-association-list__header calcite-block{margin-block-start:-18px;margin-inline:-15px}.esri-feature-form-utility-network-association-list__heading-content{align-items:center;display:flex}.esri-feature-form-utility-network-association-list__heading-content calcite-icon{margin-inline-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-list__list-container{flex-direction:column;min-height:var(--calcite-spacing-xxxl);display:flex}.esri-feature-form-utility-network-association-list__list-container calcite-fab{margin-block:var(--calcite-spacing-md);flex-direction:row;align-self:center;display:flex}.esri-feature-form-utility-network-association-settings{--calcite-block-padding: 0;background-color:var(--calcite-color-foreground-1);flex-direction:column;display:flex}.esri-feature-form-utility-network-association-settings calcite-block{border:1px solid var(--calcite-color-border-3);margin-block:0}.esri-feature-form-utility-network-association-settings calcite-block:first-of-type{border-radius:var(--calcite-spacing-sm) var(--calcite-spacing-sm) 0 0}.esri-feature-form-utility-network-association-settings calcite-block:last-of-type{border-top:none;border-radius:0 0 var(--calcite-spacing-sm) var(--calcite-spacing-sm);margin-block-end:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-settings calcite-block calcite-label{margin-inline:var(--calcite-spacing-md)}.esri-feature-form-utility-network-association-settings__info-container{flex-direction:column;display:flex}.esri-feature-form-utility-network-association-settings__info-container>*{margin-block-end:var(--calcite-spacing-md)}.esri-feature{letter-spacing:0em;isolation:isolate;position:relative;width:100%}.esri-feature__title{word-break:break-word;word-wrap:break-word;font-size:var(--calcite-font-size);display:block}.esri-feature calcite-icon{box-sizing:content-box}.esri-feature__attachments{display:flex}.esri-feature__loading-container{justify-content:center;width:100%;padding:var(--calcite-spacing-md) 0;display:flex}.esri-feature-relationship{position:relative}.esri-feature-relationship__list{min-height:var(--calcite-spacing-xxxl)}.esri-feature-relationship__list-item--hidden{display:none}.esri-feature-utility-network-associations{position:relative}.esri-feature__filter-container{z-index:1;margin-bottom:var(--calcite-spacing-md);position:sticky;top:var(--calcite-spacing-md)}.esri-feature__feature-observer{z-index:2;text-align:center;position:relative;bottom:var(--calcite-spacing-xxl)}.esri-feature__sticky-loading-container{z-index:2;pointer-events:none;justify-content:center;align-items:center;height:var(--calcite-spacing-xxxl);margin:0;padding:0;display:flex;position:sticky;bottom:10px}.esri-icon-loading-indicator{display:inline-block}.esri-feature__content-element{margin-bottom:24px;padding:0 7px}.esri-feature__content-element .esri-widget__heading{line-height:var(--calcite-font-line-height-relative-tight)}.esri-feature__content-element:only-child,.esri-feature__content-node--text{margin-bottom:3px}.esri-feature__content-node{flex-direction:column;display:flex}.esri-feature__text{line-height:var(--calcite-font-line-height-relative-tight)}.esri-feature-attachments{flex-flow:column wrap;align-items:flex-start}.esri-feature__last-edited-info{padding-top:var(--calcite-spacing-xs);font-size:var(--calcite-font-size-sm)}:dir(rtl) .esri-feature__attachments-title{margin:0 0 0 auto}:dir(rtl) .esri-feature__attachments--list .esri-feature__attachment-item-mask{margin-left:7px;margin-right:0}.esri-feature-content__loader-container{justify-content:center;align-items:center;height:150px;padding:0;display:flex}.esri-feature-content__loader{background:url(./assets/attachments/images/loading-throb.gif) 50% no-repeat;width:100%;height:64px}.esri-feature-content{font-size:var(--calcite-font-size)}.esri-feature-content h1,.esri-feature-content h2,.esri-feature-content h3,.esri-feature-content h4,.esri-feature-content h5,.esri-feature-content h6{letter-spacing:0;color:var(--calcite-color-text-2);margin:.5em 0;font-weight:var(--calcite-font-weight-semibold);line-height:normal}.esri-feature-content h1{font-size:1.75em}.esri-feature-content h2{font-size:1.5em}.esri-feature-content h3{font-size:1.25em}.esri-feature-content h4,.esri-feature-content h5,.esri-feature-content h6{font-size:1em}.esri-widget__heading.esri-feature-element-info__title{color:var(--calcite-color-text-2);margin-top:0;margin-bottom:.2em;font-size:var(--calcite-font-size-xl);font-weight:var(--calcite-font-weight-normal)}.esri-feature-element-info__description{margin-bottom:var(--calcite-font-size-xs);font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-normal)}.esri-feature-content p{margin:0 0 1.2em;font-size:var(--calcite-font-size)}.esri-feature-content p:last-child{margin-block-end:0}.esri-feature-content img{image-orientation:from-image;max-width:100%;max-height:100%}.esri-feature-content video{max-width:100%;max-height:100%}.esri-feature-content figure{margin:0;padding:0}.esri-feature-content figcaption{margin:.2em 0 0;padding:0;font-size:var(--calcite-font-size-sm);font-style:italic;display:block}.esri-feature-content ul,.esri-feature-content ol{margin-block:1rem}.esri-feature-content ul:first-child,.esri-feature-content ol:first-child{margin-block-start:0}.esri-feature-content a{color:var(--calcite-color-text-3)}.esri-feature-content a:hover,.esri-feature-content a:focus{color:var(--calcite-color-text-2)}.esri-features{--calcite-color-background: $background-color;flex-direction:column;display:flex}.esri-features img{image-orientation:from-image}.esri-features__flow-item--collapsed{--calcite-flow-item-header-border-block-end: none}.esri-features__container{background-color:var(--calcite-color-background)}.esri-features__container:not(:empty){padding:var(--calcite-spacing-md)}.esri-features .esri-feature,.esri-features .esri-feature-relationship,.esri-features .esri-feature-utility-network-associations{background-color:#0000}.esri-features__heading{word-break:break-word;word-wrap:break-word}.esri-features__header,.esri-features__footer{background-color:var(--calcite-color-foreground-1);flex:1;justify-content:flex-end;align-items:center;display:flex}.esri-features__pagination-text{padding-inline:var(--calcite-spacing-sm);color:var(--calcite-color-text-3);font-size:var(--calcite-font-size-sm)}.esri-features__loader{align-self:center;padding-inline:1rem}.esri-features__pagination-action-bar{flex:1}.esri-features__pagination-menu-button{border-inline-start:1px solid var(--calcite-color-border-3)}.esri-features__icon{flex:0 0 var(--calcite-spacing-lg);width:var(--calcite-spacing-lg);height:var(--calcite-spacing-lg);display:inline-block}.esri-features__action-image{background-position:50%;background-repeat:no-repeat;background-size:contain;flex:0 0 var(--calcite-spacing-lg);width:var(--calcite-spacing-lg);height:var(--calcite-spacing-lg)}.esri-features__header{border-block-end:1px solid var(--calcite-color-border-3)}.esri-features__content-feature{--calcite-flow-item-footer-padding: 0}.esri-features__feature-menu-observer{z-index:2;text-align:center;position:relative;bottom:20px}.esri-features__action--exit{transform:scaleX(-1)}.esri-feature-media__container{flex-flow:wrap;align-items:center;width:100%;min-height:150px;margin-top:var(--calcite-spacing-xs);display:flex}.esri-feature-media__container .esri-feature-media__pagination-button{cursor:pointer;color:var(--calcite-color-text-3);background:0 0;border:none;justify-content:center;align-items:center;padding-block:var(--calcite-spacing-xs);padding-inline:var(--calcite-spacing-sm);display:flex}.esri-feature-media__container .esri-feature-media__pagination-button:hover,.esri-feature-media__container .esri-feature-media__pagination-button:focus{color:var(--calcite-color-text-2);fill:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-2)}.esri-feature-media__item-title{margin:0;font-size:var(--calcite-font-size-md)}.esri-feature-media__item-caption{padding-block-start:3px;font-size:var(--calcite-font-size-sm)}.esri-feature-media__item{justify-content:center;align-items:flex-start;width:100%;height:auto;margin-block:var(--calcite-spacing-xs);display:flex}.esri-feature-media__item-navigation{flex:0 100%;justify-content:space-between;align-items:flex-start;margin-block-end:var(--calcite-spacing-xs);display:flex}.esri-feature-media__item-text{margin-inline-end:var(--calcite-spacing-md)}.esri-feature-media__pagination{flex:none;align-items:center;display:flex;overflow:hidden}.esri-feature-media__pagination:only-child{margin-inline-start:auto}.esri-feature-media__pagination-text{color:var(--calcite-color-text-3);padding-inline:var(--calcite-spacing-base);font-size:var(--calcite-font-size-sm)}.esri-feature-media__item-container{flex:0 auto;width:100%}.esri-feature-media__item-container img{max-width:100%}.esri-feature-media__item-container img[src$=".SVG"],.esri-feature-media__item-container img[src$=".svg"]{width:100%}.esri-feature-media__chart{background-color:var(--calcite-color-foreground-1);width:100%;height:155px}:dir(rtl) .esri-feature-media__image-summary{margin:0 .5em 0 0}:dir(rtl) .esri-feature-media__pagination-icon{transform:rotate(180deg)}.esri-identity-modal__info,.esri-identity-modal__notice{margin:0;margin-bottom:var(--calcite-spacing-md)}.esri-ui .esri-popup{z-index:1;pointer-events:none;flex-flow:column;display:flex;position:absolute}.esri-ui .esri-popup .esri-features{flex:1;width:100%}.esri-ui .esri-popup .esri-widget__heading{margin:0}.esri-ui .esri-popup--hidden{display:none}.esri-popup--shadow{box-shadow:0 1px 4px #000c}.esri-popup--aligned-top-center{transform-origin:50% 100%}.esri-popup--aligned-bottom-center{transform-origin:50% -5%}.esri-popup--aligned-top-left,.esri-popup--aligned-bottom-left{transform-origin:100%}.esri-popup--aligned-top-right,.esri-popup--aligned-bottom-right{transform-origin:-5%}.esri-popup--aligned-top-center,.esri-popup--aligned-top-left,.esri-popup--aligned-top-right{animation:.2s ease-in-out popup-intro-animation-down}.esri-popup--aligned-bottom-center,.esri-popup--aligned-bottom-left,.esri-popup--aligned-bottom-right{animation:.2s ease-in-out popup-intro-animation-up}.esri-popup__main-container{z-index:1;pointer-events:auto;background-color:var(--calcite-color-foreground-1);width:340px;min-height:48px;max-height:340px;display:flex;position:relative;overflow:hidden}.esri-popup__pointer{width:0;height:0;position:absolute}.esri-popup__pointer-direction{content:"";background-color:var(--calcite-color-foreground-1);width:var(--calcite-spacing-md);height:var(--calcite-spacing-md);position:absolute}.esri-popup--aligned-top-center .esri-popup__pointer{margin:0 0 0 -6px;top:100%;left:50%}.esri-popup--aligned-bottom-center .esri-popup__pointer{margin:0 0 0 -6px;bottom:100%;left:50%}.esri-popup--aligned-top-left .esri-popup__pointer{bottom:var(--calcite-spacing-xs);right:var(--calcite-spacing-xs);transform:rotate(-45deg)}.esri-popup--aligned-bottom-left .esri-popup__pointer{top:var(--calcite-spacing-xs);right:var(--calcite-spacing-xs);transform:rotate(45deg)}.esri-popup--aligned-top-right .esri-popup__pointer{bottom:var(--calcite-spacing-xs);left:var(--calcite-spacing-xs);transform:rotate(45deg)}.esri-popup--aligned-bottom-right .esri-popup__pointer{top:var(--calcite-spacing-xs);left:var(--calcite-spacing-xs);transform:rotate(-45deg)}.esri-popup--aligned-top-center .esri-popup__pointer-direction,.esri-popup--aligned-bottom-center .esri-popup__pointer-direction{transform:scale(.75,2) rotate(45deg)}.esri-popup--aligned-top-left .esri-popup__pointer-direction,.esri-popup--aligned-bottom-left .esri-popup__pointer-direction,.esri-popup--aligned-top-right .esri-popup__pointer-direction,.esri-popup--aligned-bottom-right .esri-popup__pointer-direction{top:-6px;left:-6px;transform:scaleY(3.5) rotate(45deg)}.esri-popup--aligned-top-center .esri-popup__pointer-direction{top:-6px;left:0}.esri-popup--aligned-bottom-center .esri-popup__pointer-direction{bottom:-6px;left:0}.esri-view-width-xlarge .esri-popup__main-container{width:460px}.esri-view-width-large .esri-popup__main-container{width:400px}.esri-view-width-medium .esri-popup__main-container{width:340px}.esri-view-width-less-than-medium .esri-popup__main-container{width:280px}.esri-view-width-xsmall .esri-popup--is-docked-bottom-center{margin-bottom:var(--calcite-spacing-xl)}.esri-view-width-xsmall .esri-popup--is-docked-top-center,.esri-view-width-xsmall .esri-popup--is-docked-bottom-center{width:auto;margin:0}.esri-view-width-xsmall .esri-popup--is-docked-top-center .esri-popup__main-container,.esri-view-width-xsmall .esri-popup--is-docked-bottom-center .esri-popup__main-container{width:100%;max-height:75%;position:absolute;left:0;right:0}.esri-view-width-xsmall .esri-popup--is-docked-bottom-center .esri-popup__main-container{bottom:0}.esri-view-width-xsmall .esri-popup--is-docked-top-center .esri-popup__main-container{top:0}.esri-view-height-xlarge .esri-popup__main-container{max-height:460px}.esri-view-height-xlarge.esri-popup--feature-menu-open .esri-popup__feature-menu-viewport{max-height:410px}.esri-view-height-large .esri-popup__main-container{max-height:400px}.esri-view-height-large.esri-popup--feature-menu-open .esri-popup__feature-menu-viewport{max-height:350px}.esri-view-height-less-than-medium .esri-popup__main-container{max-height:300px}.esri-view-height-less-than-medium.esri-popup--feature-menu-open .esri-popup__feature-menu-viewport{max-height:250px}.esri-popup--is-docked{margin:15px 15px 30px;animation:.25s ease-out esri-docking-animation;inset:0}.esri-ui .esri-popup--is-docked{flex-flow:row}.esri-popup--is-docked-top-left,.esri-popup--is-docked-top-center,.esri-popup--is-docked-top-right{align-items:flex-start}.esri-popup--is-docked-bottom-left,.esri-popup--is-docked-bottom-center,.esri-popup--is-docked-bottom-right{align-items:flex-end}.esri-popup--is-docked-top-left,.esri-popup--is-docked-bottom-left{justify-content:flex-start}.esri-popup--is-docked-top-center,.esri-popup--is-docked-bottom-center{justify-content:center}.esri-popup--is-docked-top-right,.esri-popup--is-docked-bottom-right{justify-content:flex-end}.esri-popup--is-docked-top-left .esri-popup__main-container,.esri-popup--is-docked-top-right .esri-popup__main-container,.esri-popup--is-docked-bottom-left .esri-popup__main-container,.esri-popup--is-docked-bottom-right .esri-popup__main-container{max-height:80%}.esri-popup--is-docked-top-center .esri-popup__main-container,.esri-popup--is-docked-bottom-center .esri-popup__main-container{max-height:40%}@media (prefers-reduced-motion){.esri-popup--aligned-top-center,.esri-popup--aligned-top-left,.esri-popup--aligned-top-right,.esri-popup--aligned-bottom-center,.esri-popup--aligned-bottom-left,.esri-popup--aligned-bottom-right,.esri-popup--is-docked{animation:none}}.esri-tooltip{--calcite-input-padding-inline: .5rem;--calcite-input-height: 1.5rem;--field-height: .875rem;--field-height--input: var(--calcite-input-height);--field-row-gap: 1px;--field-column-gap: var(--calcite-app-spacing-2);--field-input-width: 6.5rem;--field-title-extra-margin: var(--calcite-app-spacing-6);--field-title-color: var(--calcite-color-text-2);--field-value-color: var(--calcite-color-text-1);--font-size: var(--calcite-font-size--3);--font-size--input: var(--calcite-font-size--2);--content-padding-inline: var(--calcite-app-spacing-2);--content-padding-block: var(--calcite-app-spacing-2);--help-message-border-spacing: var(--calcite-app-spacing-2);--help-message-min-width: 7rem;--icon-size--feedback: .625rem;z-index:1;will-change:transform;width:fit-content;position:absolute;top:0;left:0;overflow:visible}.esri-tooltip-content{gap:var(--content-padding-block);border:solid 1px var(--calcite-color-border-3);padding-block:var(--content-padding-block);padding-inline:var(--content-padding-inline);color:var(--calcite-color-text-2);width:min-content;line-height:var(--calcite-font-line-height-relative-tight);font-size:var(--font-size);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);touch-action:none;view-transition-name:tooltip-content;background:var(--calcite-color-foreground-2);border-radius:.25rem;flex-direction:column;display:flex;position:relative;box-shadow:0 6px 20px -4px #0000001a,0 4px 12px -2px #00000014;outline:none!important}.esri-tooltip-content:empty{opacity:0}.esri-tooltip-content__header{margin-block-start:calc(var(--content-padding-block) * -1);margin-inline:calc(var(--content-padding-inline) * -1);border-block-end:solid 1px var(--calcite-color-border-3);justify-content:flex-start;block-size:24px;padding-block-end:0;display:flex}.esri-tooltip-content__header__spacer{flex-grow:1;flex-shrink:1}.esri-tooltip-content__header__actions{flex-grow:0;flex-shrink:0;padding-inline-end:var(--content-padding-inline)}.esri-tooltip-content__header calcite-button{--calcite-offset-invert-focus: 1}.esri-tooltip-content--input{--field-height: var(--field-height--input);background:var(--calcite-color-foreground-1);pointer-events:all;-webkit-backdrop-filter:none;backdrop-filter:none}.esri-tooltip-content--input:not(:focus-within){opacity:.8}.esri-tooltip.calcite-mode-dark .esri-tooltip-content,.esri-tooltip.calcite-mode-dark .esri-tooltip-content--input{background:var(--calcite-color-foreground-1)}.esri-tooltip-table{grid-gap:var(--field-row-gap) var(--field-column-gap);grid-template-columns:max-content 1fr max-content max-content;align-items:flex-start;width:max-content;display:grid}.esri-tooltip-field{display:contents}.esri-tooltip-field__title,.esri-tooltip-field__value{block-size:var(--field-height);white-space:nowrap;color:var(--calcite-color-text-3);justify-content:flex-start;align-items:center;display:flex}.esri-tooltip-field__title{color:var(--field-title-color);margin-inline-end:var(--field-title-extra-margin)}.esri-tooltip-field__value{color:var(--field-value-color);grid-column:span 3}.esri-tooltip-editable-field{display:contents}.esri-tooltip-editable-field__title,.esri-tooltip-editable-field__value{block-size:var(--field-height);white-space:nowrap;justify-content:flex-start;align-items:center}.esri-tooltip-editable-field__title{display:flex}.esri-tooltip-editable-field__value{font-variant-numeric:tabular-nums;display:contents}.esri-tooltip-editable-field__value__content{grid-column:span 3;align-items:center;min-width:max-content;display:flex}.esri-tooltip-editable-field__value__content--read-only{padding-inline:var(--calcite-input-padding-inline);block-size:var(--calcite-input-height);line-height:var(--calcite-input-height);font-size:var(--calcite-font-size--2)}.esri-tooltip-editable-field--feedback.esri-tooltip-editable-field--locked .esri-tooltip-editable-field__value__content{grid-column:span 2}.esri-tooltip-editable-field--feedback .esri-tooltip-editable-field__title{color:var(--field-title-color);margin-inline-end:var(--field-title-extra-margin)}.esri-tooltip-editable-field--feedback .esri-tooltip-editable-field__value__content{color:var(--field-value-color);align-self:center}.esri-tooltip-editable-field--feedback .esri-tooltip-editable-field__lock-icon{width:var(--icon-size--feedback);min-width:var(--icon-size--feedback);height:var(--icon-size--feedback);min-height:var(--icon-size--feedback);align-self:center;margin-top:-2px}.esri-tooltip-editable-field--input{padding:0}.esri-tooltip-editable-field--input .esri-tooltip-editable-field__title{font-size:var(--font-size--input)}.esri-tooltip-editable-field__input-wrapper{inline-size:var(--field-input-width)}.esri-tooltip-editable-field__input-message{text-wrap:auto;width:100%;margin-block-end:var(--calcite-input-message-spacing-value)}.esri-tooltip-editable-field__input-suffix{line-height:var(--field-height--input)}.esri-tooltip-editable-field__button{width:var(--field-height--input)}.esri-tooltip-value-by-value span:nth-child(2){margin-inline:7px}.esri-tooltip-help-message{gap:var(--calcite-app-spacing-2);margin-inline:calc(var(--content-padding-inline) * -1);border-block-start:solid 1px var(--calcite-color-border-3);padding-block-start:var(--content-padding-inline);padding-inline:var(--content-padding-inline);width:auto;min-width:var(--help-message-min-width);text-align:left;text-wrap:balance;white-space:break-spaces;font-size:var(--font-size);border-block-end:1px solid var(--calcite-color-foreground-1);justify-content:center;align-items:center;display:flex}.esri-tooltip-help-message:only-child{border-block:none;padding-block-start:var(--field-row-gap)}.esri-tooltip-help-message__icon{color:var(--calcite-color-status-info)}.esri-tooltip-help-message__text{padding-block-start:2px}.esri-tooltip ::view-transition-old(tooltip-content){animation-duration:.1s}.esri-tooltip ::view-transition-new(tooltip-content){animation-duration:.1s}.esri-tooltip{--offset-start: calc(-100% - var(--offset))}.esri-tooltip--debug:after{--size: 10px;margin-top:calc(var(--size) * -.5);margin-left:calc(var(--size) * -.5);width:var(--size);height:var(--size);content:"";background:var(--calcite-color-status-danger);position:absolute;top:0;left:0}.esri-tooltip--bottom .esri-tooltip-content{transform:translate(-50%,var(--offset))}.esri-tooltip--bottom-left.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--bottom-right.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--bottom-start.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--bottom-end.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),var(--offset))}.esri-tooltip--bottom-right.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--bottom-left.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--bottom-start.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--bottom-end.esri-tooltip--ltr .esri-tooltip-content{transform:translate(var(--offset),var(--offset))}.esri-tooltip--leading.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--trailing.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),-50%)}.esri-tooltip--leading-start.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--trailing-start.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),var(--offset-start))}.esri-tooltip--leading-end.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--trailing-end.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),var(--offset))}.esri-tooltip--top .esri-tooltip-content{transform:translate(-50%,var(--offset-start))}.esri-tooltip--top-left.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--top-right.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--top-start.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--top-end.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset-start),var(--offset-start))}.esri-tooltip--top-right.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--top-left.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--top-start.esri-tooltip--rtl .esri-tooltip-content,.esri-tooltip--top-end.esri-tooltip--ltr .esri-tooltip-content{transform:translate(var(--offset),var(--offset-start))}.esri-tooltip--trailing.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--leading.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset),-50%)}.esri-tooltip--trailing-start.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--leading-start.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset),var(--offset-start))}.esri-tooltip--trailing-end.esri-tooltip--ltr .esri-tooltip-content,.esri-tooltip--leading-end.esri-tooltip--rtl .esri-tooltip-content{transform:translate(var(--offset),var(--offset))}`;const nl="arcgis-map",Ys={base:nl,containerUI:`${nl}-container-ui`,containerElement:`${nl}-container-ui__element`,containerElementDefaultSlot:`${nl}-container-ui__element-default`,containerElementPopupSlot:`${nl}-container-ui__element-popup`,containerTopLeftColumn:`${nl}-container-ui__top-left-column`,containerTopRightColumn:`${nl}-container-ui__top-right-column`,containerBottomLeftRow:`${nl}-container-ui__bottom-left-row`,containerBottomRightRow:`${nl}-container-ui__bottom-right-row`,containerElementTopLeft:`${nl}-container-ui__element-top-left`,containerElementTopRight:`${nl}-container-ui__element-top-right`,containerElementBottomLeft:`${nl}-container-ui__element-bottom-left`,containerElementBottomRight:`${nl}-container-ui__element-bottom-right`,containerElementTopStart:`${nl}-container-ui__element-top-start`,containerElementTopEnd:`${nl}-container-ui__element-top-end`,containerElementBottomStart:`${nl}-container-ui__element-bottom-start`,containerElementBottomEnd:`${nl}-container-ui__element-bottom-end`},oh={topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",topStart:"top-start",topEnd:"top-end",bottomStart:"bottom-start",bottomEnd:"bottom-end",popup:"popup"};function WMt(t,e,i){return ni`<div class=${Et({[Ys.containerElementPopupSlot]:!0})}><slot name=${oh.popup} @slotchange=${e}></slot></div><div class=${Et({[Ys.containerElementDefaultSlot]:!0})}>${i}<slot></slot></div><div class=${Et({[Ys.containerTopLeftColumn]:!0})}><div class=${Et({[Ys.containerElement]:!0,[Ys.containerElementTopLeft]:!0})}><slot name=${oh.topLeft}></slot></div><div class=${Et({[Ys.containerElement]:!0,[Ys.containerElementTopStart]:!0})}><slot name=${t==="ltr"?oh.topStart:oh.topEnd}></slot></div></div><div class=${Et({[Ys.containerTopRightColumn]:!0})}><div class=${Et({[Ys.containerElement]:!0,[Ys.containerElementTopRight]:!0})}><slot name=${oh.topRight}></slot></div><div class=${Et({[Ys.containerElement]:!0,[Ys.containerElementTopEnd]:!0})}><slot name=${t==="ltr"?oh.topEnd:oh.topStart}></slot></div></div><div class=${Et({[Ys.containerBottomLeftRow]:!0})}><div class=${Et({[Ys.containerElement]:!0,[Ys.containerElementBottomLeft]:!0})}><slot name=${oh.bottomLeft}></slot></div><div class=${Et({[Ys.containerElement]:!0,[Ys.containerElementBottomStart]:!0})}><slot name=${t==="ltr"?oh.bottomStart:oh.bottomEnd}></slot></div></div><div class=${Et({[Ys.containerBottomRightRow]:!0})}><div class=${Et({[Ys.containerElement]:!0,[Ys.containerElementBottomRight]:!0})}><slot name=${oh.bottomRight}></slot></div><div class=${Et({[Ys.containerElement]:!0,[Ys.containerElementBottomEnd]:!0})}><slot name=${t==="ltr"?oh.bottomEnd:oh.bottomStart}></slot></div></div>`}const gje=Sl`:host{--arcgis-internal-color-black-30: color-mix(in srgb, #000000 30.2%, transparent);--arcgis-internal-box-shadow: var(--calcite-spacing-none) var(--calcite-spacing-px) var(--calcite-spacing-base) var(--arcgis-internal-color-black-30);--arcgis-internal-top-max-width: calc(min(100cqw, 100vw) - var(--calcite-spacing-xxxl));--arcgis-internal-panel-width: 300px;--arcgis-internal-panel-height: 100%;--arcgis-internal-panel-height-sm: 240px;--arcgis-internal-panel-height-md: 420px;--arcgis-internal-panel-height-lg: 540px;--arcgis-internal-panel-height-xl: 680px;--arcgis-internal-basemap-gallery-width-lg: 450px;--arcgis-expand-max-height: var(--calcite-spacing-xxxl);--arcgis-collapse-icon-flip: scaleX(1);--arcgis-row-direction: row;--arcgis-legend-internal-width: 300px;--arcgis-layout-overlay-space-top: 0px;--arcgis-layout-overlay-space-bottom: 0px;--arcgis-layout-overlay-space-left: 0px;--arcgis-layout-overlay-space-right: 0px;--arcgis-internal-sketch-justify-content: flex-start}:host{display:block;position:relative;height:100%;width:100%;padding:var(--calcite-spacing-none);margin:var(--calcite-spacing-none);container:arcgis-map-container/size;contain:layout}::slotted(:is([closed],[closed="true"])){display:none}:dir(rtl) ::slotted(:not(arcgis-swipe)){direction:rtl}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-attachments,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-coordinate-conversion,arcgis-daylight,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-elevation-profile,arcgis-expand,arcgis-feature-form,arcgis-features,arcgis-feature-table,arcgis-fullscreen,arcgis-grid-controls,arcgis-home,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-link-chart-layout-switcher,arcgis-locate,arcgis-measurement,arcgis-navigation-toggle,arcgis-oriented-imagery-viewer,arcgis-print,arcgis-search,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-time-slider,arcgis-time-zone-label,arcgis-track,arcgis-utility-network-associations,arcgis-utility-network-trace,arcgis-utility-network-validate-topology,arcgis-version-management,arcgis-video-player,arcgis-weather,arcgis-zoom)){box-shadow:var(--arcgis-internal-box-shadow)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width);min-width:var(--calcite-spacing-xxxl);min-height:var(--calcite-spacing-xxxl);transition:max-height .25s ease-in-out;overflow-y:auto}.arcgis-map-container-ui{position:absolute;inset:var(--calcite-spacing-none);padding:var(--calcite-spacing-none);z-index:var(--calcite-z-index);pointer-events:none;background:none}.arcgis-map-container-ui__element{display:flex;flex-direction:column;pointer-events:none;width:max-content;max-width:100%}.arcgis-map-container-ui__element .esri-widget--panel{min-width:var(--arcgis-internal-panel-width)}.arcgis-map-container-ui__element-popup,.arcgis-map-container-ui__element-default{pointer-events:none;max-width:100%;position:absolute;display:block;inset:var(--calcite-spacing-none);width:100%;::slotted(:not(arcgis-swipe)){pointer-events:auto}}.arcgis-map-container-ui__top-left-column{position:absolute;top:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start;margin-top:var(--calcite-spacing-lg);margin-left:var(--calcite-spacing-lg);padding-top:var(--arcgis-layout-overlay-space-top);padding-left:var(--arcgis-layout-overlay-space-left);::slotted(*){max-width:var(--arcgis-internal-top-max-width)}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column wrap}}.arcgis-map-container-ui__top-left-column:dir(rtl){align-items:flex-end;::slotted(arcgis-floor-filter){--arcgis-row-direction: row-reverse}}.arcgis-map-container-ui__top-right-column{position:absolute;top:var(--calcite-spacing-none);right:var(--calcite-spacing-none);display:flex;flex-direction:column;align-items:flex-end;margin-top:var(--calcite-spacing-lg);margin-right:var(--calcite-spacing-lg);padding-top:var(--arcgis-layout-overlay-space-top);padding-right:var(--arcgis-layout-overlay-space-right);::slotted(*){max-width:var(--arcgis-internal-top-max-width)}::slotted(arcgis-expand){--arcgis-internal-sketch-justify-content: flex-end}}.arcgis-map-container-ui__top-right-column:dir(rtl){align-items:flex-start;::slotted(arcgis-floor-filter){--arcgis-row-direction: row}}.arcgis-map-container-ui__element-top-left{top:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;justify-content:flex-start;align-items:flex-start;::slotted(arcgis-expand){--arcgis-expand-icon-number-left: none;--arcgis-expand-icon-number-right: calc(-1 * var(--calcite-spacing-xs))}::slotted(:is(arcgis-floor-filter,arcgis-expand)){--arcgis-collapse-icon-flip: scaleX(-1)}::slotted(arcgis-sketch){--sketch-pad-flex-flow: wrap}::slotted(*){margin-bottom:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-top-left:dir(rtl){align-items:flex-end}.arcgis-map-container-ui__element-top-right{position:relative;justify-content:flex-start;align-items:flex-end;margin-left:auto;::slotted(arcgis-expand){--arcgis-expand-icon-number-left: calc(-1 * var(--calcite-spacing-xs));--arcgis-expand-icon-number-right: none}::slotted(arcgis-floor-filter){--arcgis-row-direction: row-reverse}::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column wrap-reverse}::slotted(*){margin-bottom:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-top-right:dir(rtl){align-items:flex-start}.arcgis-map-container-ui__element-top-start{position:relative;justify-content:flex-start;align-items:flex-start;::slotted(arcgis-expand){--arcgis-expand-icon-number-left: none;--arcgis-expand-icon-number-right: calc(-1 * var(--calcite-spacing-xs))}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column wrap}::slotted(:is(arcgis-floor-filter,arcgis-expand)){--arcgis-collapse-icon-flip: scaleX(-1)}::slotted(*){margin-bottom:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-top-start:dir(rtl){align-items:flex-end;--arcgis-internal-sketch-justify-content: flex-start;::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap-reverse}}.arcgis-map-container-ui__element-top-end{position:relative;justify-content:flex-start;align-items:flex-end;::slotted(arcgis-expand){--arcgis-expand-icon-number-left: calc(-1 * var(--calcite-spacing-xs));--arcgis-expand-icon-number-right: none}::slotted(arcgis-floor-filter){--arcgis-row-direction: row-reverse}::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column wrap-reverse}::slotted(*){margin-bottom:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-top-end:dir(rtl){align-items:flex-start;--arcgis-internal-sketch-justify-content: flex-end}.arcgis-map-container-ui__bottom-left-row{position:absolute;bottom:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;flex-direction:row;align-items:flex-end;max-width:100%;margin-left:var(--calcite-spacing-lg);margin-bottom:var(--calcite-spacing-xxxl);padding-left:var(--arcgis-layout-overlay-space-left);padding-bottom:var(--arcgis-layout-overlay-space-bottom);::slotted(:last-child){margin-right:var(--calcite-spacing-xxl)}::slotted(arcgis-floor-filter){--arcgis-internal-floor-filter-column-direction: column-reverse;--arcgis-internal-floor-filter-button-border-width: 0 0 1px}::slotted(*){max-width:var(--arcgis-internal-top-max-width)}}.arcgis-map-container-ui__bottom-left-row:dir(rtl){flex-direction:row-reverse;::slotted(arcgis-floor-filter){--arcgis-row-direction: row-reverse}}.arcgis-map-container-ui__bottom-right-row{position:absolute;bottom:var(--calcite-spacing-none);right:var(--calcite-spacing-none);display:flex;flex-direction:row-reverse;align-items:flex-end;max-width:100%;margin-right:var(--calcite-spacing-lg);margin-bottom:var(--calcite-spacing-xxxl);padding-right:var(--arcgis-layout-overlay-space-right);padding-bottom:var(--arcgis-layout-overlay-space-bottom);::slotted(:last-child){margin-left:var(--calcite-spacing-xxl)}::slotted(arcgis-floor-filter){--arcgis-internal-floor-filter-column-direction: column-reverse;--arcgis-internal-floor-filter-button-border-width: 0 0 1px}::slotted(*){max-width:var(--arcgis-internal-top-max-width)}::slotted(arcgis-expand){--arcgis-internal-sketch-justify-content: flex-end}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap-reverse}}.arcgis-map-container-ui__bottom-right-row:dir(rtl){flex-direction:row;::slotted(arcgis-floor-filter){--arcgis-row-direction: row}}.arcgis-map-container-ui__element-bottom-left{bottom:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;flex-direction:column;align-items:flex-end;justify-content:flex-end;flex-flow:row;::slotted(arcgis-coordinate-conversion){--arcgis-coordinate-conversion-flex-direction: column-reverse}::slotted(arcgis-expand){--arcgis-expand-icon-number-left: none;--arcgis-expand-icon-number-right: calc(-1 * var(--calcite-spacing-xs))}::slotted(:is(arcgis-floor-filter,arcgis-expand)){--arcgis-collapse-icon-flip: scaleX(-1)}::slotted(arcgis-sketch){--sketch-pad-flex-flow: wrap-reverse}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap}::slotted(arcgis-floor-filter){--arcgis-floor-filter-align-items: flex-end}::slotted(*){margin-right:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-bottom-right{bottom:var(--calcite-spacing-none);right:var(--calcite-spacing-none);align-items:flex-end;justify-content:flex-end;margin-left:auto;flex-flow:row-reverse;::slotted(arcgis-coordinate-conversion){--arcgis-coordinate-conversion-flex-direction: column-reverse}::slotted(arcgis-expand){--arcgis-expand-icon-number-left: calc(-1 * var(--calcite-spacing-xs));--arcgis-expand-icon-number-right: none}::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap-reverse}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap-reverse}::slotted(arcgis-floor-filter){--arcgis-floor-filter-align-items: flex-end;--arcgis-row-direction: row-reverse}::slotted(*){margin-left:var(--calcite-spacing-sm-plus)}}.arcgis-map-container-ui__element-bottom-start{bottom:var(--calcite-spacing-none);left:var(--calcite-spacing-none);display:flex;flex-direction:column;align-items:flex-end;justify-content:flex-end;flex-flow:row;::slotted(arcgis-coordinate-conversion){--arcgis-coordinate-conversion-flex-direction: column-reverse}::slotted(arcgis-expand){--arcgis-expand-icon-number-left: none;--arcgis-expand-icon-number-right: calc(-1 * var(--calcite-spacing-xs))}::slotted(:is(arcgis-floor-filter,arcgis-expand)){--arcgis-collapse-icon-flip: scaleX(-1)}::slotted(arcgis-sketch){--sketch-pad-flex-flow: wrap-reverse}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap}::slotted(arcgis-floor-filter){--arcgis-floor-filter-align-items: flex-end}::slotted(*){margin-right:var(--calcite-spacing-sm-plus)}::slotted(:dir(rtl)){margin-right:var(--calcite-spacing-none);--arcgis-internal-sketch-justify-content: flex-start}}.arcgis-map-container-ui__element-bottom-end{bottom:var(--calcite-spacing-none);right:var(--calcite-spacing-none);align-items:flex-end;justify-content:flex-end;margin-left:auto;flex-flow:row-reverse;::slotted(arcgis-coordinate-conversion){--arcgis-coordinate-conversion-flex-direction: column-reverse}::slotted(arcgis-expand){--arcgis-expand-icon-number-left: calc(-1 * var(--calcite-spacing-xs));--arcgis-expand-icon-number-right: none}::slotted(arcgis-sketch){--sketch-pad-flex-flow: row-reverse wrap-reverse}::slotted(arcgis-sketch[layout="vertical"]){--sketch-pad-flex-flow: column-reverse wrap-reverse}::slotted(arcgis-floor-filter){--arcgis-floor-filter-align-items: flex-end;--arcgis-row-direction: row-reverse}::slotted(*){margin-left:var(--calcite-spacing-sm-plus)}::slotted(:dir(rtl)){margin-left:var(--calcite-spacing-none);--arcgis-internal-sketch-justify-content: flex-end}}.arcgis-map-container-ui__element>*{pointer-events:auto}@container arcgis-map-container (height >= 0){::slotted(arcgis-sketch){--responsive-toolbar-vert-width: var(--calcite-spacing-none);--responsive-toolbar-vert-height: min(100vh - 120px, 100cqh - 120px);--responsive-toolbar-horiz-width: min(100vw - 60px, 100cqw - 60px);--responsive-toolbar-horiz-height: var(--calcite-spacing-none)}}@container arcgis-map-container (max-height: 544px) or (max-width: 544px){::slotted(:is(arcgis-floor-filter)){--arcgis-internal-floor-filter-button-display: none;--arcgis-internal-floor-filter-menu-width: 225px}}@container arcgis-map-container (max-height: 499.99px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-sm);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-sm)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-sm)}}@container arcgis-map-container (min-height: 500px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-md);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-md)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-md)}::slotted(:is(arcgis-floor-filter)){--arcgis-internal-floor-filter-menu-max-height: 320px;--arcgis-internal-floor-filter-levels-max-height: 320px}}@container arcgis-map-container (min-height: 768px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-lg);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-lg)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-lg)}::slotted(:is(arcgis-floor-filter)){--arcgis-internal-floor-filter-menu-max-height: 420px;--arcgis-internal-floor-filter-levels-max-height: 420px}}@container arcgis-map-container (min-height: 992px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-lg);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-lg)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-lg)}}@container arcgis-map-container (min-height: 1200px){.arcgis-map-container-ui__element>*{--arcgis-expand-max-height: var(--arcgis-internal-panel-height-xl);--arcgis-internal-panel-height: var(--arcgis-internal-panel-height-xl)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-legend,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){max-height:var(--arcgis-internal-panel-height-xl)}}@container arcgis-map-container (min-width: 544px){::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width)}}@container arcgis-map-container (min-width: 768px){::slotted(:is(arcgis-legend[card-style-layout="auto"])){--arcgis-legend-internal-width: auto}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width)}}@container arcgis-map-container (min-width: 992px){::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-gallery,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width)}}@container arcgis-map-container (min-width: 1200px){::slotted(:is(arcgis-basemap-gallery)){width:var(--arcgis-internal-basemap-gallery-width-lg)}::slotted(:is(arcgis-area-measurement-2d,arcgis-area-measurement-3d,arcgis-basemap-layer-list,arcgis-bookmarks,arcgis-building-explorer,arcgis-catalog-layer-list,arcgis-directions,arcgis-direct-line-measurement-3d,arcgis-distance-measurement-2d,arcgis-editor,arcgis-feature-form,arcgis-features,arcgis-layer-list,arcgis-line-of-sight,arcgis-print,arcgis-shadow-cast,arcgis-slice,arcgis-table-list,arcgis-utility-network-trace,arcgis-grid-controls)){width:var(--arcgis-internal-panel-width)}}`;const ZMt={"top-left":"top-left","top-right":"top-right","bottom-left":"bottom-left","bottom-right":"bottom-right","bottom-leading":"bottom-start","bottom-trailing":"bottom-end","top-leading":"top-start","top-trailing":"top-end"},YMt=["manual"];function RV(t){t.el.childElem&&(t.el.childElem.ownedBy=t.el),t.position&&YMt.includes(t.position)?t.el.removeAttribute("slot"):t.position&&(t.el.slot=ZMt[t.position]);const e=JMt(t);if(!e){const i=t3t(t);if(!i){_je(t);return}return xSe(i,t,!0),i}return QMt(e,t.el.parent)||(t.el.parent=e,e.localName==="arcgis-expand"?XMt(e,t):e.localName==="arcgis-placement"?KMt(e,t):xSe(e,t,!1)),e}function JMt({el:t}){for(let e=t.parentElement;e;e=e?.parentElement??null){if(wSe.has(e.localName))return e;if("ownedBy"in e&&e.ownedBy instanceof HTMLElement&&wSe.has(e.ownedBy.localName))return e.ownedBy}}const wSe=new Set(["arcgis-map","arcgis-scene","arcgis-link-chart","arcgis-expand","arcgis-placement"]);function QMt(t,e){if(t!==e)return!1;const i=t.localName;return i==="arcgis-expand"||i==="arcgis-placement"}function oH(t,e,i="arcgisReady"){const r=t;if(r.view)e(r.view);else{let s=function(n){n.target===t&&(oH(t,e,i),t.removeEventListener(i,s))};t.addEventListener(i,s)}}const XMt=(t,e)=>oH(t,i=>{const r=Ghe(e);e.el.shadowRoot?t.content=e.el:e.el.childElem&&t.content!=null&&r.append(e.el.childElem),e.el.view=i}),KMt=(t,e)=>oH(t,i=>{const r=Ghe(e);e.el.childElem&&r.append(e.el.childElem),e.el.view=i}),xSe=(t,e,i)=>oH(t,r=>{i&&_je(e),e.el.view=r,e.referenceElement=t},"arcgisViewReadyChange");function e3t(t,e){return e!=null&&t?.position===e.position&&t?.heading===e.heading&&t?.tilt===e.tilt&&t?.fov===e.fov}function yje(t,e){return e===void 0||t?.targetGeometry!==e?.targetGeometry||t?.rotation!==e?.rotation||t?.scale!==e?.scale}function vje(t,e){return qhe(e?.center,t)}function qhe(t,e){if(typeof e=="string")return qhe(t,e.split(",").map(Number));if(!t)return e;if(Array.isArray(e)){const i=e[0],r=e[1],s=e.length>2?e[2]:void 0;if(i!==t.longitude||r!==t.latitude||s!==t.z)return e}else if(e&&!t?.equals(e))return e}function _je(t){t.el.childElem&&Ghe(t).append(t.el.childElem)}function Ghe(t){return t.el.shadowRoot??t.el}function t3t(t,e){const i=t.referenceElement;if(typeof i!="string")return i??void 0;const r=i.includes("#")||i.includes(".")||i.includes("["),s=t.el.getRootNode();return(r?void 0:s.querySelector(`#${i}`))??s.querySelector(i)??void 0}let bje=class extends F9{constructor(e){super(e),this.direction=QKe(),this.component.listen("arcgisViewClick",i=>{this._handleOpenPopup(i.detail)}),this.component.listenOn(globalThis,"unhandledrejection",i=>{if(i.reason?.name==="webgl:required"){const{name:r}=i.reason;this.webGLError={name:r}}})}hostLifecycle(){return vs(()=>this.component.view.popup?.visible,()=>{this.popupRef?.visible&&(this.popupRef.visible=!1)})}openPopup(e){this.popupRef?this.popupRef.open(e):this.component.view.openPopup(e)}closePopup(){this.popupRef?this.popupRef.visible=!1:this.component.view.closePopup()}async _handleOpenPopup(e){if(this.popupRef&&!this.component.popupDisabled){e.stopPropagation();const{location:i,promises:r}=await this.popupRef?.handleViewClick(e);r?.length&&(this.component.view.closePopup(),this.popupRef?.open({location:i,promises:r}))}}_handlePopupSlotChange(e){const i=zKe(e.target,"arcgis-popup");!this.popupRef&&i.length?this.popupRef=i[0]:i.length||(this.popupRef=void 0)}_webGLErrorAlert(){return this.webGLError?ni`<calcite-alert icon=x-octagon kind=danger open .label=${this.webGLError.name}><div slot=title>Unable to display map. WebGL2 support is required.</div><div slot=message>Ensure that your browser and hardware meet the minimum requirements.</div><calcite-link slot=link href=https://esriurl.com/webgl-faq>https://esriurl.com/webgl-faq</calcite-link></calcite-alert>`:null}render(){return WMt(this.direction,e=>this._handlePopupSlotChange(e),this._webGLErrorAlert())}};const wje=vle((t,e)=>{const i=$a();return e.onLifecycle(()=>X(()=>{const{map:r}=t;if(!r||r.destroyed)return[];const s=[];return r.loadError&&s.push(r),r.basemap?.loadError&&s.push(r.basemap),r.ground.loadError&&s.push(r.ground),[...r.allLayers,...r.allTables].forEach(n=>{n.loadError&&s.push(n)}),s},r=>{r.length&&(t.loadErrorSources=r,i.emit())})),i}),xje=vle((t,e)=>{const i=$a();return e.onLifecycle(()=>X(()=>t.view?.readyState,r=>{(r==="map-content-error"||r==="rendering-error")&&i.emit()})),i});const i3t=aH(UMt),r3t=aH(i1t);var KS;let s3t=(KS=class extends Wo{constructor(){super(),this._containerRef=Jw(),this._mapRef=Jw(),this._uiController=new bje(this),this.extraContent=new ke,this.arcgisLoadError=wje(this),this.arcgisViewReadyError=xje(this),this._map=i3t(this),this.view=r3t(this),this.animationsDisabled=this.view.animationsEnabled,this.allLayerViews=this.view.allLayerViews,this.analyses=this.view.analyses,this.autoDestroyDisabled=!1,this.background=this.view.background,this.basemap=this._map.basemap,this.basemapView=this.view.basemapView,this.constraints=this.view.constraints,this.displayFilterDisabled=this.view.displayFilterEnabled,this.fatalError=this.view.fatalError,this.floors=this.view.floors,this.graphics=this.view.graphics,this.ground=this._map.ground,this.highlights=this.view.highlights,this.highlightOptions=this.view.highlightOptions,this.ipsInfo=this._map.ipsInfo,this.layerViews=this.view.layerViews,this.magnifier=this.view.magnifier,this.map=this.view.map,this.navigation=this.view.navigation,this.padding=this.view.padding,this.popup=this.view.popup,this.popupDisabled=this.view.popupEnabled,this.ready=this.view.ready,this.resizeAlign=this.view.resizeAlign,this.resolution=this.view.resolution,this.rotation=this.view.rotation,this.spatialReference=this.view.spatialReference,this.spatialReferenceLocked=this.view.spatialReferenceLocked,this.suspended=this.view.suspended,this.theme=this.view.theme,this.timeExtent=this.view.timeExtent,this.timeZone=this.view.timeZone,this.updating=this.view.updating,this.visibleArea=this.view.visibleArea,this.arcgisViewAnalysisViewCreate=Qi(()=>this.view,"analysis-view-create"),this.arcgisViewAnalysisViewCreateError=Qi(()=>this.view,"analysis-view-create-error"),this.arcgisViewAnalysisViewDestroy=Qi(()=>this.view,"analysis-view-destroy"),this.arcgisViewChange=$a(),this.arcgisViewClick=Qi(()=>this.view,"click"),this.arcgisViewDoubleClick=Qi(()=>this.view,"double-click"),this.arcgisViewDrag=Qi(()=>this.view,"drag"),this.arcgisViewHold=Qi(()=>this.view,"hold"),this.arcgisViewImmediateClick=Qi(()=>this.view,"immediate-click"),this.arcgisViewImmediateDoubleClick=Qi(()=>this.view,"immediate-double-click"),this.arcgisViewKeyDown=Qi(()=>this.view,"key-down"),this.arcgisViewKeyUp=Qi(()=>this.view,"key-up"),this.arcgisViewLayerviewCreate=Qi(()=>this.view,"layerview-create"),this.arcgisViewLayerviewCreateError=Qi(()=>this.view,"layerview-create-error"),this.arcgisViewLayerviewDestroy=Qi(()=>this.view,"layerview-destroy"),this.arcgisViewMouseWheel=Qi(()=>this.view,"mouse-wheel"),this.arcgisViewPointerDown=Qi(()=>this.view,"pointer-down"),this.arcgisViewPointerEnter=Qi(()=>this.view,"pointer-enter"),this.arcgisViewPointerLeave=Qi(()=>this.view,"pointer-leave"),this.arcgisViewPointerMove=Qi(()=>this.view,"pointer-move"),this.arcgisViewPointerUp=Qi(()=>this.view,"pointer-up"),this.arcgisViewReadyChange=$a(),this.view.ui={components:["attribution"]}}get aria(){return this.view?.aria}set aria(e){this.view&&(this.view.aria=e)}get center(){return this.view.center}set center(e){const i=vje(e,this.view);i&&(this.view.center=i)}get extent(){return this.view.extent}set extent(e){e&&!this.extent?.equals(e)&&(this.view.extent=e)}get focusAreas(){return this.map?this.map.focusAreas:{areas:[],style:"bright"}}set focusAreas(e){this.map&&(this.map.focusAreas=e)}get gamepad(){return this.view.input.gamepad}get interacting(){return this.view.interacting}get itemId(){return this._map.portalItem?.id}set itemId(e){fje(this._map,this),this._map.portalItem={id:e},this.view.map=this._map}get navigating(){return this.view.navigating}get scale(){return this.view.scale}set scale(e){this.view.scale=e}get stationary(){return this.view.stationary}get viewpoint(){return this.view.viewpoint}set viewpoint(e){yje(this.viewpoint,e)&&(this.view.viewpoint=e)}get zoom(){return this.view.zoom}set zoom(e){this.view.zoom=e}async addLayer(e,i){this.map?.add(e,i)}async addLayers(e,i){this.map?.addMany(e,i)}async addTable(e){this.map?.tables.add(e)}async addTables(e,i){this.map?.tables.addMany(e,i)}async closePopup(){this._uiController.closePopup()}async destroy(){await this.manager.destroy()}async goTo(e,i){return await this.view.goTo(e,i)}async hitTest(e,i){return await this.view.hitTest(e,i)}async openPopup(e){this._uiController.openPopup(e)}async takeScreenshot(e){return await this.view.takeScreenshot(e)}toMap(e){return this.view.toMap(e)}toScreen(e,i){return this.view.toScreen(e,i)}async tryFatalErrorRecovery(){this.view.tryFatalErrorRecovery()}async viewOnReady(e,i){return await this.componentOnReady(),await this.view.whenReady().then(()=>e?.()).catch(i)}async whenAnalysisView(e){return await this.view.whenAnalysisView(e)}async whenLayerView(e){return await this.view?.whenLayerView(e)}loaded(){const e=this;e.el.childElem=this._mapRef.value,this.view.container??=e.el.childElem,this.map||=this._map,this.manager.onLifecycle(()=>[X(()=>this.map,i=>{i&&(this._map=i)},{initial:!0,sync:!0}),X(()=>this.view.stationary,()=>this.arcgisViewChange.emit(),{initial:!0}),X(()=>this.view.ready,()=>this.arcgisViewReadyChange.emit(),{initial:this.view.ready})])}renderMain(){return ni`<div class=${Et(Ys.base)} ${_p(this._mapRef)}></div>`}render(){return ni`<section class=${Et(Ys.containerUI)} ${_p(this._containerRef)}>${this._uiController.render()}${this.extraContent}</section>${this.renderMain()}`}},KS.properties={_map:16,view:32,animationsDisabled:5,aria:0,allLayerViews:0,analyses:0,autoDestroyDisabled:5,background:0,basemap:1,basemapView:0,center:1,constraints:0,displayFilterDisabled:5,extent:0,fatalError:0,floors:0,focusAreas:0,gamepad:32,graphics:0,ground:1,highlights:0,highlightOptions:0,interacting:32,ipsInfo:0,itemId:3,layerViews:0,magnifier:0,map:0,navigating:32,navigation:0,padding:0,popup:0,popupDisabled:5,ready:4,resizeAlign:1,resolution:8,rotation:9,scale:9,spatialReference:0,spatialReferenceLocked:5,stationary:32,suspended:7,theme:0,timeExtent:0,timeZone:1,updating:4,viewpoint:0,visibleArea:0,zoom:9,loadErrorSources:0},KS.styles=[mje,gje],KS);p$("arcgis-map",s3t);let n3t=class{constructor(e){this._observable=new d$,this._set=new Set(e)}get size(){return Mt(this._observable),this._set.size}add(e){const i=this._set.size;return this._set.add(e),this._set.size!==i&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const i=this._set.delete(e);return i&&this._observable.notify(),i}entries(){return Mt(this._observable),this._set.entries()}forEach(e,i){Mt(this._observable),this._set.forEach((r,s)=>e.call(i,r,s,this),i)}has(e){return Mt(this._observable),this._set.has(e)}keys(){return Mt(this._observable),this._set.keys()}values(){return Mt(this._observable),this._set.values()}[Symbol.iterator](){return Mt(this._observable),this._set[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}};function Sje(t,e){const i=xl(t),r=xl(e),s=i.store,n=r.store,a=r.metadata;for(const o in a){const l=a[o],u=s.originOf(o),d=n.originOf(o);if(!l.readOnly&&d!==0){if(u!==0){const f=s.get(o),g=n.get(o);f&&g&&g instanceof be&&f instanceof be&&f instanceof g.constructor&&Sje(f,g);continue}t.set(o,n.get(o))}}}let Cgi=class{constructor(e=9,i){this._compareMinX=TSe,this._compareMinY=$Se,this._toBBox=r=>r,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&(typeof i=="function"?this._toBBox=i:this._initFormat(i)),this.clear()}destroy(){this.clear(),Ab.prune(),B4.prune(),vc.prune(),hk.prune()}all(e){SSe(this._data,e)}search(e,i){let r=this._data;const s=this._toBBox;if(DV(e,r))for(Ab.clear();r;){for(let n=0,a=r.children.length;n<a;n++){const o=r.children[n],l=r.leaf?s(o):o;DV(e,l)&&(r.leaf?i(o):TQ(e,l)?SSe(o,i):Ab.push(o))}r=Ab.pop()}}collides(e){let i=this._data;const r=this._toBBox;if(!DV(e,i))return!1;for(Ab.clear();i;){for(let s=0,n=i.children.length;s<n;s++){const a=i.children[s],o=i.leaf?r(a):a;if(DV(e,o)){if(i.leaf||TQ(e,o))return!0;Ab.push(a)}}i=Ab.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let r=0,s=e.length;r<s;r++)this.insert(e[r]);return this}let i=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===i.height)this._splitRoot(this._data,i);else{if(this._data.height<i.height){const r=this._data;this._data=i,i=r}this._insert(i,this._data.height-i.height-1,!0)}else this._data=i;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new dB([]),this}remove(e){if(!e)return this;let i,r=this._data,s=null,n=0,a=!1;const o=this._toBBox(e);for(vc.clear(),hk.clear();r||vc.length>0;){if(r||(r=vc.pop(),s=vc.data[vc.length-1],n=hk.pop()??0,a=!0),r.leaf&&(i=w5(r.children,e,r.children.length,r.indexHint),i!==-1))return r.children.splice(i,1),vc.push(r),this._condense(vc),this;a||r.leaf||!TQ(r,o)?s?(n++,r=s.children[n],a=!1):r=null:(vc.push(r),hk.push(n),n=0,s=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,i,r,s){const n=r-i+1;let a=this._maxEntries;if(n<=a){const d=new dB(e.slice(i,r+1));return NC(d,this._toBBox),d}s||(s=Math.ceil(Math.log(n)/Math.log(a)),a=Math.ceil(n/a**(s-1)));const o=new $Q([]);o.height=s;const l=Math.ceil(n/a),u=l*Math.ceil(Math.sqrt(a));CSe(e,i,r,u,this._compareMinX);for(let d=i;d<=r;d+=u){const f=Math.min(d+u-1,r);CSe(e,d,f,l,this._compareMinY);for(let g=d;g<=f;g+=l){const v=Math.min(g+l-1,f);o.children.push(this._build(e,g,v,s-1))}}return NC(o,this._toBBox),o}_insert(e,i,r){const s=this._toBBox,n=r?e:s(e);vc.clear();const a=a3t(n,this._data,i,vc);for(a.children.push(e),U4(a,n);i>=0&&vc.data[i].children.length>this._maxEntries;)this._split(vc,i),i--;o3t(n,vc,i)}_split(e,i){const r=e.data[i],s=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,s);const a=this._chooseSplitIndex(r,n,s);if(!a)return;const o=r.children.splice(a,r.children.length-a),l=r.leaf?new dB(o):new $Q(o);l.height=r.height,NC(r,this._toBBox),NC(l,this._toBBox),i?e.data[i-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,i){this._data=new $Q([e,i]),this._data.height=e.height+1,NC(this._data,this._toBBox)}_chooseSplitIndex(e,i,r){let s,n,a;s=n=1/0;for(let o=i;o<=r-i;o++){const l=uk(e,0,o,this._toBBox),u=uk(e,o,r,this._toBBox),d=c3t(l,u),f=Lne(l)+Lne(u);d<s?(s=d,a=o,n=f<n?f:n):d===s&&f<n&&(n=f,a=o)}return a}_chooseSplitAxis(e,i,r){const s=e.leaf?this._compareMinX:TSe,n=e.leaf?this._compareMinY:$Se;this._allDistMargin(e,i,r,s)<this._allDistMargin(e,i,r,n)&&e.children.sort(s)}_allDistMargin(e,i,r,s){e.children.sort(s);const n=this._toBBox,a=uk(e,0,i,n),o=uk(e,r-i,r,n);let l=IV(a)+IV(o);for(let u=i;u<r-i;u++){const d=e.children[u];U4(a,e.leaf?n(d):d),l+=IV(a)}for(let u=r-i-1;u>=i;u--){const d=e.children[u];U4(o,e.leaf?n(d):d),l+=IV(o)}return l}_condense(e){for(let i=e.length-1;i>=0;i--){const r=e.data[i];if(r.children.length===0)if(i>0){const s=e.data[i-1],n=s.children;n.splice(w5(n,r,n.length,s.indexHint),1)}else this.clear();else NC(r,this._toBBox)}}_initFormat(e){const i=["return a"," - b",";"];this._compareMinX=new Function("a","b",i.join(e[0])),this._compareMinY=new Function("a","b",i.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};function a3t(t,e,i,r){for(;r.push(e),e.leaf!==!0&&r.length-1!==i;){let s,n=1/0,a=1/0;for(let o=0,l=e.children.length;o<l;o++){const u=e.children[o],d=Lne(u),f=l3t(t,u)-d;f<a?(a=f,n=d<n?d:n,s=u):f===a&&d<n&&(n=d,s=u)}e=s||e.children[0]}return e}function SSe(t,e){let i=t;for(B4.clear();i;){if(i.leaf===!0)for(const r of i.children)e(r);else B4.pushArray(i.children);i=B4.pop()??null}}function o3t(t,e,i){for(let r=i;r>=0;r--)U4(e.data[r],t)}function NC(t,e){uk(t,0,t.children.length,e,t)}function uk(t,e,i,r,s){s||(s=new dB([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let n,a=e;a<i;a++)n=t.children[a],U4(s,t.leaf?r(n):n);return s}function U4(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function TSe(t,e){return t.minX-e.minX}function $Se(t,e){return t.minY-e.minY}function Lne(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function IV(t){return t.maxX-t.minX+(t.maxY-t.minY)}function l3t(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function c3t(t,e){const i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function TQ(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function DV(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function CSe(t,e,i,r,s){const n=[e,i];for(;n.length;){const a=n.pop(),o=n.pop();if(a-o<=r)continue;const l=o+Math.ceil((a-o)/r/2)*r;mze(t,l,o,a,s),n.push(o,l,l,a)}}const Ab=new Ai,B4=new Ai,vc=new Ai,hk=new Ai({deallocator:void 0});function u3t(){Ab.prune(),B4.prune(),vc.prune(),hk.prune()}let h3t=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}},Tje=class extends h3t{constructor(){super(...arguments),this.height=1,this.indexHint=new wle}},dB=class extends Tje{constructor(e){super(),this.children=e,this.leaf=!0}},$Q=class extends Tje{constructor(e){super(),this.children=e,this.leaf=!1}};const d3t=new Me(tIe),pE=new Me(s7),fE=new Me(n7),p3t=new Me(iIe);function v1(t){const e=Fne.get(t);if(e)return e;let i=d3t;if(t)if(t===pE)i=pE;else if(t===fE)i=fE;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)hO(r)||hO(s)?i=pE:(dO(r)||dO(s))&&(i=fE);else{const n=t.wkt2??t.wkt;if(n){const a=n.toUpperCase();a===m3t?i=pE:a===g3t&&(i=fE)}}}return Fne.set(t,i),i}const Fne=new Map;function f3t(){Fne.clear()}const m3t=pE.wkt.toUpperCase(),g3t=fE.wkt.toUpperCase();function Hhe(t,e,i,r){return t!=null&&(zr(e,r)?(O1(i,t),!0):(au[0]=t[0],au[1]=t[1],au[2]=0,!!io(au,e,0,au,r,0)&&(i[0]=au[0],i[1]=au[1],au[0]=t[2],au[1]=t[3],au[2]=0,!!io(au,e,0,au,r,0)&&(i[2]=au[0],i[3]=au[1],!0))))}const au=I();function Jc(t,e,i,r){if(Zc(t.spatialReference,i)){kV[0]=t.x,kV[1]=t.y;const n=t.z;return kV[2]=n??r??0,io(kV,t.spatialReference,0,e,i,0)}const s=u1(t,i);return!!s&&(e[0]=s?.x,e[1]=s?.y,e[2]=s?.z??r??0,!0)}async function lG(t,e,i,r,s){return await om(t.spatialReference,i,null,s),Jc(t,e,i,r)}const kV=I();let r_=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&aO(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*MSe);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,MSe));e++)this._items.push(this._allocator())}};const MSe=1024;function Pp(){return[0,0,0,1]}function y3t(t){return[t[0],t[1],t[2],t[3]]}function v3t(t,e,i,r){return[t,e,i,r]}const Whe=Pp();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Whe,clone:y3t,create:Pp,fromValues:v3t},Symbol.toStringTag,{value:"Module"}));let CP=class w2{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&aO(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new w2(Ke)}static createVec3f64(){return new w2(I)}static createVec4f64(){return new w2(li)}static createMat3f64(){return new w2(Jr)}static createMat4f64(){return new w2(ut)}static createQuatf64(){return new w2(Pp)}get test(){}};const Igi=CP.createVec2f64(),Xe=CP.createVec3f64(),Zhe=CP.createVec4f64();CP.createMat3f64();const Yhe=CP.createMat4f64(),_3t=CP.createQuatf64();function s_(t){return t?{origin:Tr(t.origin),vector:Tr(t.vector)}:{origin:I(),vector:I()}}function $je(t,e){const i=x3t.get();return i.origin=t,i.vector=e,i}function Dgi(t,e=s_()){return b3t(t.origin,t.vector,e)}function b3t(t,e,i=s_()){return me(i.origin,t),me(i.vector,e),i}function pB(t,e,i=s_()){return me(i.origin,t),Ae(i.vector,e,t),i}function Cje(t,e){const i=Ae(Xe.get(),e,t.origin),r=Le(t.vector,i),s=Le(t.vector,t.vector),n=Ce(r/s,0,1),a=Ae(Xe.get(),he(Xe.get(),t.vector,n),i);return Le(a,a)}function kgi(t,e,i){return zne(t,e,0,1,i)}function Lgi(t,e,i){return $e(i,t.origin,he(i,t.vector,e))}function zne(t,e,i,r,s){const{vector:n,origin:a}=t,o=Ae(Xe.get(),e,a),l=Le(n,o)/ea(n);return he(s,n,Ce(l,i,r)),$e(s,s,t.origin)}function Fgi(t,e){if(Mje(t,$je(e.origin,e.direction),!1,cG)){const{tA:i,pB:r,distance2:s}=cG;if(i>=0&&i<=1)return s;if(i<0)return Mn(t.origin,r);if(i>1)return Mn($e(Xe.get(),t.origin,t.vector),r)}return null}function w3t(t,e,i){return!!Mje(t,e,!0,cG)&&(me(i,cG.pA),!0)}function Mje(t,e,i,r){const n=t.origin,a=$e(Xe.get(),n,t.vector),o=e.origin,l=$e(Xe.get(),o,e.vector),u=Xe.get(),d=Xe.get();if(u[0]=n[0]-o[0],u[1]=n[1]-o[1],u[2]=n[2]-o[2],d[0]=l[0]-o[0],d[1]=l[1]-o[1],d[2]=l[2]-o[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=Xe.get();if(f[0]=a[0]-n[0],f[1]=a[1]-n[1],f[2]=a[2]-n[2],Math.abs(f[0])<1e-6&&Math.abs(f[1])<1e-6&&Math.abs(f[2])<1e-6)return!1;const g=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],v=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],_=u[0]*f[0]+u[1]*f[1]+u[2]*f[2],x=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],S=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*x-v*v;if(Math.abs(S)<1e-6)return!1;let T=(g*v-_*x)/S,M=(g+v*T)/x;i&&(T=Ce(T,0,1),M=Ce(M,0,1));const E=Xe.get(),P=Xe.get();return E[0]=n[0]+T*f[0],E[1]=n[1]+T*f[1],E[2]=n[2]+T*f[2],P[0]=o[0]+M*d[0],P[1]=o[1]+M*d[1],P[2]=o[2]+M*d[2],r.tA=T,r.tB=M,r.pA=E,r.pB=P,r.distance2=Mn(E,P),!0}const cG={tA:0,tB:0,pA:I(),pB:I(),distance2:0},x3t=new r_(()=>s_());function zgi(t,e,i){const r=Le(t,e)/Le(t,t);return he(i,t,r)}function Dw(t,e){return Le(t,e)/Ve(t)}function Jhe(t,e){const i=Le(t,e)/(Ve(t)*Ve(e));return-Ao(i)}function Eje(t,e,i){Re(LV,t),Re(CQ,e);const r=Le(LV,CQ),s=Ao(r),n=At(LV,LV,CQ);return Le(n,i)<0?2*Math.PI-s:s}const LV=I(),CQ=I();function eL(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function S3t(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return xe(t,i,r,s),t}function Ngi(t,e,i){i=i||t;const r=Le(t,e);xe(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Re(i,i)}function Qhe(t,e,i){Math.abs(t[0])>Math.abs(t[1])?xe(e,0,1,0):xe(e,1,0,0),At(i,t,e),At(e,i,t),Re(i,i),Re(e,e)}function FV(t,e,i,r,s,n){const a=t+(e-t)*s;return a+(i+(r-i)*s-a)*n}function Aje(t,e,i,r=I()){const s=Ve(t),n=Ve(e),a=Le(t,e)/(s*n);if(a<.9999999999999999){const o=Math.acos(a),l=((1-i)*s+i*n)/Math.sin(o),u=l/s*Math.sin((1-i)*o),d=l/n*Math.sin(i*o);return he(hS,t,u),he(dS,e,d),$e(r,hS,dS)}return cr(r,t,e,i)}function Vgi(t,e,i,r=I(),s=I()){const n=Ve(t),a=Ve(e),o=Le(t,e)/(n*a);if(o<.9999999999999999){const l=Math.acos(o),u=Math.sin(l),d=Math.sin(i*l),f=Math.sin((1-i)*l),g=(1-i)*n+i*a;{const v=g/u,_=v/a*d;he(hS,t,v/n*f),he(dS,e,_),$e(r,hS,dS)}{const v=1/n*(-Math.cos((1-i)*l)*l*g+f*(-n+a));he(hS,t,v);const _=1/a*(Math.cos(i*l)*l*g+d*(-n+a));he(dS,e,_),$e(s,hS,dS),he(s,s,1/u)}return s}return cr(r,t,e,i),Ae(s,e,t),Re(s,s),s}function lH(t,e,i){t=Re(hS,t),e=Re(dS,e);const r=Ao(Le(t,e));if(i){const s=At(T3t,t,e);if(Le(s,i)<0)return-r}return r}function fB(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],a=(n-i)/(n-s);return a*t[r-1][1]+(1-a)*t[r][1]}}function jgi(t,e,i,r){Ae(ESe,e,t),Ae(ASe,i,t),At(r,ESe,ASe),Re(r,r),r[3]=-Le(t,r)}function Ugi(t,e){if(xe(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)$e(e,e,t[i]);he(e,e,1/t.length)}}const ESe=I(),ASe=I(),T3t=I(),hS=I(),dS=I();function Ui(t=dk){return[t[0],t[1],t[2],t[3]]}function Oje(t=dk[0],e=dk[1],i=dk[2],r=dk[3]){return Khe(t,e,i,r,Zhe.get())}function Xhe(t,e){return Khe(e[0],e[1],e[2],e[3],t)}function Bgi(t){return t}function Khe(t,e,i,r,s=Ui()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Pje(t,e,i){return me(i,t),i[3]=e,i}function Qg(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Fh(t,e,i,r=Ui()){const s=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],o=t[0]-e[0],l=t[1]-e[1],u=t[2]-e[2],d=n*u-a*l,f=a*o-s*u,g=s*l-n*o,v=d*d+f*f+g*g,_=Math.abs(v-1)>1e-5&&v>1e-12?1/Math.sqrt(v):1;return r[0]=d*_,r[1]=f*_,r[2]=g*_,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Rje(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e(dI,r);let a=s,o=!1;for(;a<i-1&&!o;)e(VC,a),a++,o=!di(dI,VC);if(!o)return!1;for(a=Math.max(a,n),o=!1;a<i&&!o;)e(G2,a),a++,Ae(zV,dI,VC),Re(zV,zV),Ae(NV,VC,G2),Re(NV,NV),o=!di(dI,G2)&&!di(VC,G2)&&Math.abs(Le(zV,NV))<$3t;return o?(Fh(dI,VC,G2,t),!0):(r!==0||s!==1||n!==2)&&Rje(t,e,i,0,1,2)}function qgi(t,e,i=!0){const r=e.length/3;return Rje(t,(s,n)=>xe(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const $3t=.99619469809,dI=I(),VC=I(),G2=I(),zV=I(),NV=I();function Nne(t,e,i){return e!==t&&Xhe(t,e),t[3]=-Le(t,i),t}function C3t(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Vne(t,e,i,r){return At(G2,e,t),Qg(i,G2,r)}function Ije(t,e,i,r){return cH(RF(t,e,Ae(Xe.get(),i,e),R3t,r))}function MP(t,e,i){return e!=null&&cH(RF(t,e.origin,e.direction,I3t,i))}function Dje(t,e,i){return cH(RF(t,e.origin,e.vector,0,i))}function M3t(t,e,i){return cH(RF(t,e.origin,e.vector,1,i))}function tL(t,e){return Ya(t,e)>=0}function E3t(t,e){const i=Le(t,e.ray.direction),r=-Ya(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function A3t(t,e){const i=Le(t,e.ray.direction),r=-Ya(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function ede(t,e,i){const r=he(Xe.get(),t,-t[3]),s=P3t(t,Ae(Xe.get(),e,r),Xe.get());return $e(i,s,r),i}function O3t(t,e,i,r){const s=t,n=Xe.get(),a=Xe.get();Qhe(s,n,a);const o=Ae(Xe.get(),i,e),l=Dw(n,o),u=Dw(a,o),d=Dw(s,o);return xe(r,l,u,d)}function P3t(t,e,i){const r=he(Xe.get(),t,Le(t,e));return Ae(i,e,r),i}function jne(t,e){return Math.abs(Ya(t,e))}function Ya(t,e){return Le(t,e)+t[3]}function cH(t){return t===0||t===1}function RF(t,e,i,r,s){const n=Le(t,i),a=Ya(t,e);if(n===0)return a>=0?2:3;let o=-a/n;return 1&r&&(o=Ce(o,0,1)),!(4&r)&&o<0||!(8&r)&&o>1?a>=0?2:3:($e(s,e,he(s,i,o)),a>=0?0:1)}const dk=[0,0,1,0],R3t=12,I3t=8;function $n(t){return t?OSe(Tr(t.origin),Tr(t.direction)):OSe(I(),I())}function OSe(t,e){return{origin:t,direction:e}}function Ggi(t,e){return E0(t.origin,e.origin)&&E0(t.direction,e.direction)}function um(t,e){const i=L3t.get();return i.origin=t,i.direction=e,i}function uG(t,e=$n()){return ide(t.origin,t.direction,e)}function tde(t,e,i=$n()){return me(i.origin,t),Ae(i.direction,e,t),i}function ide(t,e,i=$n()){return me(i.origin,t),me(i.direction,e),i}function D3t(t,e){const i=At(Xe.get(),Re(Xe.get(),t.direction),Ae(Xe.get(),e,t.origin));return Le(i,i)}function k3t(t,e,i){const r=Le(t.direction,Ae(i,e,t.origin));return $e(i,t.origin,he(i,t.direction,r)),i}function Hgi(t,e,i,r){const s=t.origin,n=e.origin,a=t.direction,o=e.direction,l=Le(Re(EQ,a),Re(PSe,o));if(Math.abs(l)>=1)return null;const u=At(EQ,a,o),d=xi(MQ,n,s),f=b0(RSe,a[0],a[1],a[2],-o[0],-o[1],-o[2],u[0],u[1],u[2]),g=_$(RSe,f);if(g==null)return[i,r];const v=Le(xe(EQ,g[0],g[3],g[6]),d),_=Le(xe(PSe,g[1],g[4],g[7]),d);return $e(i,s,he(MQ,a,v)),$e(r,n,he(MQ,o,_)),[i,r]}const L3t=new r_(()=>$n()),MQ=I(),EQ=I(),PSe=I(),RSe=Jr(),AQ=()=>re.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function n_(t=Hje){return{plane:Ui(t.plane),origin:Tr(t.origin),basis1:Tr(t.basis1),basis2:Tr(t.basis2)}}function F3t(t,e,i){const r=J3t.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=Oje(0,0,0,0),uH(r),r}function A$(t,e=n_()){return rde(t.origin,t.basis1,t.basis2,e)}function z3t(t,e){me(e.origin,t.origin),me(e.basis1,t.basis1),me(e.basis2,t.basis2),Xhe(e.plane,t.plane)}function rde(t,e,i,r=n_()){return me(r.origin,t),me(r.basis1,e),me(r.basis2,i),uH(r),Z3t(r,"fromValues()"),r}function uH(t){Vne(t.basis2,t.basis1,t.origin,t.plane)}function kje(t,e,i){t!==i&&A$(t,i);const r=he(Xe.get(),B0(t),e);return $e(i.origin,i.origin,r),i.plane[3]-=e,i}function N3t(t,e,i){return Lje(e,i),kje(i,ode(t,t.origin),i),i}function V3t(t,e){const i=t.basis1[0],r=t.basis2[1],[s,n]=t.origin;return o7(s-i,n-r,s+i,n+r,e)}function Lje(t,e=n_()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return xe(e.origin,t[0]+i,t[1]+r,0),xe(e.basis1,i,0,0),xe(e.basis2,0,r,0),Khe(0,0,1,0,e.plane),e}function sde(t,e,i){return!!MP(t.plane,e,i)&&qje(t,i)}function j3t(t,e,i){if(sde(t,e,i))return i;const r=Fje(t,e,Xe.get());return $e(i,e.origin,he(Xe.get(),e.direction,Bi(e.origin,r)/Ve(e.direction))),i}function Fje(t,e,i){const r=hG.get();Gje(t,e,r,hG.get());let s=Number.POSITIVE_INFINITY;for(const n of cde){const a=lde(t,n,hH.get()),o=Xe.get();if(Dje(r,a,o)){const l=L1(Xe.get(),e.origin,o),u=Math.abs(Ao(Le(e.direction,l)));u<s&&(s=u,me(i,o))}}return s===Number.POSITIVE_INFINITY?Nje(t,e,i):i}function zje(t,e){return(e-t)/e}function Nje(t,e,i){if(sde(t,e,i))return i;const r=hG.get(),s=hG.get();Gje(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const a of cde){const o=lde(t,a,hH.get()),l=Xe.get();if(M3t(r,o,l)){const u=D3t(e,l);if(!tL(s,l))continue;u<n&&(n=u,me(i,l))}}return nde(t,e.origin)<n&&Vje(t,e.origin,i),i}function Vje(t,e,i){const r=ede(t.plane,e,Xe.get()),s=zne(ISe(t,t.basis1),r,-1,1,Xe.get()),n=zne(ISe(t,t.basis2),r,-1,1,Xe.get());return Ae(i,$e(Xe.get(),s,n),t.origin),i}function jje(t,e,i){const{origin:r,basis1:s,basis2:n}=t,a=Ae(Xe.get(),e,r),o=Dw(s,a),l=Dw(n,a),u=Dw(B0(t),a);return xe(i,o,l,u)}function nde(t,e){const i=jje(t,e,Xe.get()),{basis1:r,basis2:s}=t,n=Ve(r),a=Ve(s),o=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-a,0),u=i[2];return o*o+l*l+u*u}function U3t(t,e){return Math.sqrt(nde(t,e))}function B3t(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of cde){const s=lde(t,r,hH.get()),n=Cje(s,e);n>i&&(i=n)}return Math.sqrt(i)}function ade(t,e){return tL(t.plane,e)&&qje(t,e)}function q3t(t,e,i,r){return W3t(t,i,r)}function ode(t,e){const i=-t.plane[3];return Dw(B0(t),e)-i}function G3t(t,e,i,r){const s=ode(t,e),n=he(Y3t,B0(t),i-s);return $e(r,e,n),r}function Uje(t,e){return di(t.basis1,e.basis1)&&di(t.basis2,e.basis2)&&di(t.origin,e.origin)}function Bje(t,e,i){return t!==i&&A$(t,i),Kl(jC,e),Yc(jC,jC),Ft(i.basis1,t.basis1,jC),Ft(i.basis2,t.basis2,jC),Ft(i.plane,t.plane,jC),Ft(i.origin,t.origin,e),Nne(i.plane,i.plane,i.origin),i}function H3t(t,e,i,r){return t!==r&&A$(t,r),Cp(OQ,e,i),Ft(r.basis1,t.basis1,OQ),Ft(r.basis2,t.basis2,OQ),uH(r),r}function B0(t){return t.plane}function W3t(t,e,i){switch(e){case 0:me(i,t.basis1),Re(i,i);break;case 1:me(i,t.basis2),Re(i,i);break;case 2:me(i,B0(t))}return i}function qje(t,e){const i=Ae(Xe.get(),e,t.origin),r=ea(t.basis1),s=ea(t.basis2),n=Le(t.basis1,i),a=Le(t.basis2,i);return-n-r<0&&n-r<0&&-a-s<0&&a-s<0}function ISe(t,e){const i=hH.get();return me(i.origin,t.origin),me(i.vector,e),i}function lde(t,e,i){const{basis1:r,basis2:s,origin:n}=t,a=he(Xe.get(),r,e.origin[0]),o=he(Xe.get(),s,e.origin[1]);$e(i.origin,a,o),$e(i.origin,i.origin,n);const l=he(Xe.get(),r,e.direction[0]),u=he(Xe.get(),s,e.direction[1]);return he(i.vector,$e(l,l,u),2),i}function Z3t(t,e){Math.abs(Le(t.basis1,t.basis2)/(Ve(t.basis1)*Ve(t.basis2)))>1e-6&&AQ().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Le(t.basis1,B0(t)))>1e-6&&AQ().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Le(B0(t),t.origin)-t.plane[3])>1e-6&&AQ().warn(e,"Plane offset is not consistent with plane origin")}function Gje(t,e,i,r){const s=B0(t);Vne(s,e.direction,e.origin,i),Vne(i,s,e.origin,r)}const Hje={plane:Ui(),origin:Ye(0,0,0),basis1:Ye(1,0,0),basis2:Ye(0,1,0)},hG=new r_(Ui),hH=new r_(s_),Y3t=I(),J3t=new r_(()=>n_()),cde=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],jC=ut(),OQ=ut(),Q3t=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:ode,axisAt:q3t,cameraFrustumCoverage:zje,closestPoint:Nje,closestPointOnSilhouette:Fje,copy:A$,copyWithoutVerify:z3t,create:n_,distance:U3t,distance2:nde,distanceToSilhouette:B3t,elevate:kje,equals:Uje,extrusionContainsPoint:ade,fromAABoundingRect:Lje,fromValues:rde,getExtent:V3t,intersectRay:sde,intersectRayClosestSilhouette:j3t,normal:B0,projectPoint:Vje,projectPointLocal:jje,rotate:H3t,setAltitudeAt:G3t,setExtent:N3t,transform:Bje,up:Hje,updateUnboundedPlane:uH,wrap:F3t},Symbol.toStringTag,{value:"Module"}));function DSe(t,e){const i=Ve(t),r=Qh(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return xe(e,i,r,s),e}const Wje=Is();function EP(t,e,i,r){return new Array(t,e,i,r)}function Is(){return EP(0,0,0,0)}function ude(t,e){return EP(t[0],t[1],t[2],e)}function X3t(t){return EP(t[0],t[1],t[2],t[3])}function AP(t,e,i){return Zje(t,e[0],e[1],e[2],i)}function Zje(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Yje(t,e){return Jje(t,e)}function Jje(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _1(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function K3t(t){return EP(t[0],t[1],t[2],t[3])}function eEt(t){t[0]=0,t[1]=0,t[2]=0,t[3]=0}function O$(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=e,t}function qg(t){return t[3]}function q0(t,e){return xe(e,t[0],t[1],t[2])}function Li(t){return xe(pG,t[0],t[1],t[2])}function OP(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}function Une(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}function Qje(t,e,i,r){t[0]=e,t[1]=i,t[2]=r}function jO(t,e,i){OP(t,Ft(pG,e,i))}function Xje(t,e,i,r,s){t[0]=e,t[1]=i,t[2]=r,t[3]=s}function tEt(t){return $i(t[0],t[1],t[2],t[3])}function iEt(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function rEt(t,e,i){return t!==i&&_1(t,i),i}function sEt(t,e){return e}function a_(t,e,i){if(e==null||!e6e(t,e,dG))return!1;let{t0:r,t1:s}=dG;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:a}=e;i[0]=n[0]+a[0]*r,i[1]=n[1]+a[1]*r,i[2]=n[2]+a[2]*r}return!0}function Kje(t,e,i){const r=tde(e,i);if(!e6e(t,r,dG))return[];const{origin:s,direction:n}=r,{t0:a,t1:o}=dG,l=u=>{const d=I();return Fr(d,s,n,u),dH(t,d,d)};return Math.abs(a-o)<_n()?[l(a)]:[l(a),l(o)]}const dG={t0:0,t1:0};function e6e(t,e,i){const{origin:r,direction:s}=e,n=nEt;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const a=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(a===0)return!1;const o=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=o*o-4*a*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const u=Math.sqrt(l);return i.t0=(-o-u)/(2*a),i.t1=(-o+u)/(2*a),!0}const nEt=I();function Bne(t,e){return a_(t,e,null)}function aEt(t,e,i){if(a_(t,e,i))return i;const r=PP(t,e,Xe.get());return $e(i,e.origin,he(Xe.get(),e.direction,Bi(e.origin,r)/Ve(e.direction))),i}function PP(t,e,i){const r=Xe.get(),s=Yhe.get();At(r,e.origin,e.direction);const n=qg(t);At(i,r,e.origin),he(i,i,1/Ve(i)*n);const a=i6e(t,e.origin),o=Jhe(e.origin,i);return Cp(s,o+a,r),Ft(i,i,s),i}function hde(t,e,i,r){const s=qg(t),n=s*s,a=e+.5*Math.PI,o=i*i+n-2*Math.cos(a)*i*s,l=Math.sqrt(o),u=o-n;if(u<=0)return .5;const d=Math.sqrt(u),f=Math.acos(d/l)-Math.asin(s/(l/Math.sin(a)));return Math.min(1,(f+.5*r)/r)}function oEt(t,e,i){return a_(t,e,i)?i:(k3t(e,Li(t),i),dH(t,i,i))}function dH(t,e,i){const r=Ae(Xe.get(),e,Li(t)),s=he(Xe.get(),r,t[3]/Ve(r));return $e(i,s,Li(t))}function t6e(t,e){const i=Ae(Xe.get(),e,Li(t)),r=ea(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function i6e(t,e){const i=Ae(Xe.get(),e,Li(t)),r=Ve(i),s=qg(t),n=s+Math.abs(s-r);return Ao(s/n)}const PQ=I();function r6e(t,e,i,r){const s=Ae(PQ,e,Li(t));switch(i){case 0:{const n=DSe(s,PQ)[2];return xe(r,-Math.sin(n),Math.cos(n),0)}case 1:{const n=DSe(s,PQ),a=n[1],o=n[2],l=Math.sin(a);return xe(r,-l*Math.cos(o),-l*Math.sin(o),Math.cos(a))}case 2:return Re(r,s);default:return}}function s6e(t,e){const i=Ae(qne,e,Li(t));return Ve(i)-t[3]}function lEt(t,e,i,r){const s=s6e(t,e),n=r6e(t,e,2,qne),a=he(qne,n,i-s);return $e(r,e,a)}function cEt(t,e){const i=Mn(Li(t),e),r=qg(t);return i<=r*r}function uEt(t,e,i=Is()){const r=Bi(Li(t),q0(e,kSe)),s=t[3],n=e[3];return r+n<s?(_1(t,i),i):r+s<n?(_1(e,i),i):(cr(pG,Li(t),q0(e,kSe),(r+n-s)/(2*r)),AP(i,pG,(r+s+n)/2),i)}const pG=I(),kSe=I(),pH=Is(),qne=I(),hEt=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Wje,altitudeAt:s6e,angleToSilhouette:i6e,axisAt:r6e,cameraFrustumCoverage:hde,clear:eEt,clone:K3t,closestPoint:oEt,closestPointOnSilhouette:PP,containsPoint:cEt,copy:_1,copyCenter:Une,create:Is,distanceToSilhouette:t6e,elevate:iEt,equals:Jje,exactEquals:Yje,fromCenterAndRadius:ude,fromRadius:O$,fromValues:EP,fromVec4:X3t,getCenter:q0,getCenterTemp:Li,getExtent:sEt,getRadius:qg,intersectLine:Kje,intersectRay:a_,intersectRayClosestSilhouette:aEt,intersectsRay:Bne,projectPoint:dH,set:Zje,setAltitudeAt:lEt,setCenter:OP,setCenterFromValues:Qje,setExtent:rEt,setFromCenterAndRadius:AP,setFromValues:Xje,setTransformedCenter:jO,tmpSphere:pH,toVec4:tEt,union:uEt},Symbol.toStringTag,{value:"Module"}));function dEt(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function pEt(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function fEt(t,e){return t.operations.getExtent(t.value,e),e}function mEt(t){return{operations:t,value:t.create()}}function n6e(t,e,i=mEt(t)){return i.operations=t,t.copy(e,i.value),i}function gEt(t){return n6e(hEt,EP(0,0,0,xr(t).radius))}const LSe=2**50;function yEt(){return n6e(Q3t,rde([0,0,0],[LSe,0,0],[0,LSe,0]))}function vEt(t,e,i){return t.operations.axisAt(t.value,e,2,i)}function _Et(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function bEt(t,e,i){return t.operations.intersectRay(t.value,e,i)}function wEt(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function xEt(t,e){return t.operations.altitudeAt(t.value,e)}function a6e(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function SEt(t,e,i,r){return e!==r&&Ln(r,e),xe(UC,r[12],r[13],r[14]),a6e(t,UC,i,UC),r[12]=UC[0],r[13]=UC[1],r[14]=UC[2],r}function RQ(t,e,i){return t.operations.elevate(t.value,e,i.value)}const UC=I();function FSe(t,e,i,r,s){return s[0]=Le(t,e),s[1]=Le(t,i),s[2]=Le(t,r),s}function Gne(t,e,i,r,s){me(i,t),me(VV,e),Re(VV,VV),At(r,VV,i),At(s,r,i)}function TEt(t,e){return t?v1(e):e.isGeographic?Me.PlateCarree:e}const VV=I();function $Et(t){return 32+t.length}const o6e=16;function dde(t){if(!t)return 0;let e=Kv;for(const i in t)t.hasOwnProperty(i)&&(e+=pde(t[i],!1));return e}function fG(t){if(!t)return 0;if(typeof t[0]=="number")return n$(t);if(Array.isArray(t))return CEt(t);let e=Kv;for(const i in t)t.hasOwnProperty(i)&&(e+=pde(t[i]));return e}function CEt(t){const e=t.length;if(e===0||typeof t[0]=="number")return l6e(t,8);let i=c6e;for(let r=0;r<e;r++)i+=pde(t[r]);return i}function pde(t,e=!0){switch(typeof t){case"object":return e?fG(t):Kv;case"string":return $Et(t);case"number":return o6e;case"boolean":return 4;default:return 8}}function n$(...t){return t.reduce((e,i)=>e+(i?lP(i)?i.byteLength+fde:Array.isArray(i)?l6e(i,o6e):0:0),0)}function l6e(t,e){return c6e+t.length*e}const Kv=32,c6e=16,fde=145;function MEt(t,e=!1){return t<=Hc?e?new Array(t).fill(0):new Array(t):new Uint32Array(t)}let zSe=class Hne{constructor(e){AEt(e);const{location:i,data:r}=e;this.location=Object.freeze(se(i));const s=this.location.width,n=this.location.height;let a=!0,o=!0;const l=Math.ceil(s*n/32),u=MEt(l);let d=0;for(let f=0;f<r.length;f++){const g=f%32;r[f]?(o=!1,u[d]|=1<<g):a=!1,g===31&&++d}o?(this._availability="unavailable",this.byteSize=40):a?(this._availability="available",this.byteSize=40):(this._availability=u,this.byteSize=40+n$(u))}getAvailability(e,i){if(this._availability==="unavailable"||this._availability==="available")return this._availability;const r=(e-this.location.top)*this.location.width+(i-this.location.left),s=r%32,n=r>>5,a=this._availability;return n<0||n>a.length?"unknown":a[n]&1<<s?"available":"unavailable"}static fromDefinition(e,i){const r=e.service.request||Si,{row:s,col:n,width:a,height:o}=e,l={query:{f:"json"}};return i=i?{...l,...i}:l,r(EEt(e),i).then(u=>u.data).catch(u=>{if(u?.details?.httpStatus===422)return{location:{top:s,left:n,width:a,height:o},valid:!0,data:new Array(a*o).fill(0)};throw u}).then(u=>{if(u.location&&(u.location.top!==s||u.location.left!==n||u.location.width!==a||u.location.height!==o))throw new q("tilemap:location-mismatch","Tilemap response for different location than requested",{response:u,definition:{top:s,left:n,width:a,height:o}});return Hne.fromJSON(u)})}static fromJSON(e){return Object.freeze(new Hne(e))}};function NSe(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function EEt(t){let e;if(t.service.tileServers?.length){const r=t.service.tileServers;e=`${r&&r.length?r[t.row%r.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}else e=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;const i=t.service.query;return i&&(e=`${e}?${i}`),e}function AEt(t){if(!t?.location)throw new q("tilemap:missing-location","Location missing from tilemap response");if(t.valid===!1)throw new q("tilemap:invalid","Tilemap response was marked as invalid");if(!t.data)throw new q("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(t.data))throw new q("tilemap:data-mismatch","Data must be an array of numbers");if(t.data.length!==t.location.width*t.location.height)throw new q("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}var x2;function VSe(t,e,i){return new q("tile-map:tile-unavailable","Tile is not available",{level:t,row:e,col:i})}var qw;let Ob=(qw=class extends be{constructor(e){super(e),this._pendingTilemapRequests={},this.request=Si,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new Ihe(2097152),this.addHandles(X(()=>{const{layer:e}=this;return[e?.parsedUrl,e?.tileServers,e?.apiKey,e?.customParameters]},()=>this._initializeTilemapDefinition(),Yt))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(e,i,r){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return"unavailable";const s=this._tilemapFromCache(e,i,r,this._tmpTilemapDefinition);return s?s.getAvailability(i,r):"unknown"}fetchAvailability(e,i,r,s){return!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD?Promise.reject(VSe(e,i,r)):this._fetchTilemap(e,i,r,s).catch(n=>n).then(n=>{if(n instanceof zSe){const a=n.getAvailability(i,r);if(a==="unavailable")throw VSe(e,i,r);return a}if(Zr(n))throw n;return"unknown"})}fetchAvailabilityUpsample(e,i,r,s,n){s.level=e,s.row=i,s.col=r;const a=this.layer.tileInfo;a.updateTileInfo(s);const o=this.fetchAvailability(e,i,r,n).catch(l=>{if(Zr(l))throw l;if(a.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,n);throw l});return this._fetchAvailabilityUpsamplePrefetch(e,i,r,n,o),o}async _fetchAvailabilityUpsamplePrefetch(e,i,r,s,n){if(!this._prefetchingEnabled)return;const a=`prefetch-${e}-${i}-${r}`;if(this.hasHandles(a))return;const o=new AbortController;n.then(()=>o.abort(),()=>o.abort());let l=!1;const u=bi(()=>{l||(l=!0,o.abort())});if(this.addHandles(u,a),await EPe(10,o.signal).catch(()=>{}),l||(l=!0,this.removeHandles(a)),sa(o))return;const d=new pF(e,i,r),f={...s,signal:o.signal},g=this.layer.tileInfo;for(let v=0;x2._prefetches.length<x2._maxPrefetch&&g.upsampleTile(d);++v){const _=this.fetchAvailability(d.level,d.row,d.col,f);x2._prefetches.push(_);const x=()=>{x2._prefetches.removeUnordered(_)};_.then(x,x)}}static cleanupTilemapCache(){this._prefetches.prune()}_fetchTilemap(e,i,r,s){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return Promise.reject(new q("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const n=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,i,r,n);if(a)return Promise.resolve(a);const o=s?.signal;return s={...s,signal:null},new Promise((l,u)=>{Mo(o,()=>u(ti()));const d=NSe(n);let f=this._pendingTilemapRequests[d];if(!f){f=zSe.fromDefinition(n,s).then(v=>(this._tilemapCache.put(d,v,v.byteSize),v));const g=()=>{delete this._pendingTilemapRequests[d]};this._pendingTilemapRequests[d]=f,f.then(g,g)}f.then(l,u)})}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:i,customParameters:r}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:cO({...e.query,...r,token:i??e.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,i,r,s){s.level=e,s.row=i-i%this.size,s.col=r-r%this.size;const n=NSe(s);return this._tilemapCache.get(n)}get test(){}},x2=qw,qw._maxPrefetch=4,qw._prefetches=new Ai({initialSize:x2._maxPrefetch}),qw);c([p({constructOnly:!0})],Ob.prototype,"layer",void 0),c([p({constructOnly:!0})],Ob.prototype,"minLOD",void 0),c([p({constructOnly:!0})],Ob.prototype,"maxLOD",void 0),c([p({constructOnly:!0})],Ob.prototype,"request",void 0),c([p({constructOnly:!0})],Ob.prototype,"size",void 0),Ob=x2=c([R("esri.layers.support.TilemapCache")],Ob);const u6e=Symbol("WebScene");function Wne(t){return t==="global"?1:2}function IQ(t){return t===1?"global":"local"}function vm(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function h6e(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}let Wgi=class{constructor(e,i,r,s,n){this.spatialReference=e,this._position=n!==void 0?[i,r,s??0,n??0]:s!==void 0?[i,r,s??0]:[i,r],this._flags=(s!==void 0?1:0)+(n!==void 0?2:0)}get hasZ(){return!(1&~this._flags)}get hasM(){return!(2&~this._flags)}get type(){return"point"}get x(){return this._position[0]}get y(){return this._position[1]}get z(){return this.hasZ?this._position[2]:void 0}get m(){return this.hasM?this._position[3]:void 0}};function Co(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(pI.x=t[0],pI.y=t[1],pI.z=t[2],pI.spatialReference=e,Jc(pI,i,r,s))}const pI=vm(0,0,0,Me.WGS84);function P$(t,e,i){return!!Co(t,e,jV,i.spatialReference)&&(i.x=jV[0],i.y=jV[1],i.z=jV[2],!0)}async function d6e(t,e,i,r){return await om(e,i.spatialReference,null,r),P$(t,e,i)}const jV=I();function p6e(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),a=Math.cos(e),o=i;return o[0]=-r,o[4]=-n*s,o[8]=a*s,o[12]=0,o[1]=s,o[5]=-n*r,o[9]=a*r,o[13]=0,o[2]=0,o[6]=a,o[10]=n,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,o}function OEt(t,e,i){return p6e(t,e,i),Yc(i,i),i}function IF(t,e,i,r){const s=Lke(t,r);if(s==null)return!1;const n=s.source.spatialReferenceId,a=s.dest.spatialReferenceId;if(n===a&&!DQ(a)&&(n!==0||zr(t,r)))return A7(i,e),!0;if(DQ(a)){const l=gD[n][10],u=gD[10][a];return l!=null&&u!=null&&(l(e,0,W_,0),u(W_,0,Z_,0),p6e(UV*W_[0],UV*W_[1],i),i[12]=Z_[0],i[13]=Z_[1],i[14]=Z_[2],!0)}const o=DQ(n);if((a===3||a===11||a===2||a===5)&&(n===2||o||n===3||n===5)){const l=gD[n][10],u=gD[10][a];return l!=null&&u!=null&&(l(e,0,W_,0),u(W_,0,Z_,0),o?OEt(UV*W_[0],UV*W_[1],i):lm(i),i[12]=Z_[0],i[13]=Z_[1],i[14]=Z_[2],!0)}return!1}function DQ(t){return t===1||t===6||t===8||t===4}const UV=zt(1),W_=I(),Z_=I();function fH(t){return t?{ray:$n(t.ray),c0:t.c0,c1:t.c1}:{ray:$n(),c0:0,c1:Number.MAX_VALUE}}function PEt(t,e=fH()){return uG(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function REt(t,e,i=fH()){const r=Ve(t.vector);return ide(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function Ygi(t,e){return f6e(t,t.c0,e)}function Jgi(t,e){return f6e(t,t.c1,e)}function f6e(t,e,i){return $e(i,t.ray.origin,he(i,t.ray.direction,e))}new r_(()=>fH());function mde(t){return t?[Ui(t[0]),Ui(t[1]),Ui(t[2]),Ui(t[3]),Ui(t[4]),Ui(t[5])]:[Ui(),Ui(),Ui(),Ui(),Ui(),Ui()]}function m6e(){return[I(),I(),I(),I(),I(),I(),I(),I()]}function g6e(t,e){for(let i=0;i<RP;i++)Xhe(t[i],e[i]);return t}function y6e(t,e,i,r=zEt){const s=Cn(Yhe.get(),e,t);Kl(s,s);for(let n=0;n<LEt;++n){const a=zu(Zhe.get(),FEt[n],s);xe(r[n],a[0]/a[3],a[1]/a[3],a[2]/a[3])}v6e(i,r)}function v6e(t,e){Fh(e[4],e[0],e[3],t[0]),Fh(e[1],e[5],e[6],t[1]),Fh(e[4],e[5],e[1],t[2]),Fh(e[3],e[2],e[6],t[3]),Fh(e[0],e[1],e[2],t[4]),Fh(e[5],e[4],e[7],t[5])}function ww(t,e){for(let i=0;i<RP;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function IEt(t,e){return b6e(t,PEt(e,w6e.get()))}function Qgi(t,e){for(let i=0;i<RP;i++){const r=t[i];if(!A3t(r,e))return!1}return!0}function DEt(t,e,i){return b6e(t,REt(e,i,w6e.get()))}function _6e(t,e){for(let i=0;i<RP;i++)if(Ya(t[i],e)>0)return!1;return!0}function b6e(t,e){for(let i=0;i<RP;i++)if(!E3t(t[i],e))return!1;return!0}const kEt={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},RP=6,LEt=8,FEt=[$i(-1,-1,-1,1),$i(1,-1,-1,1),$i(1,1,-1,1),$i(-1,1,-1,1),$i(-1,-1,1,1),$i(1,-1,1,1),$i(1,1,1,1),$i(-1,1,1,1)],w6e=new r_(fH),zEt=m6e();function NEt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function VEt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function jEt(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function UEt(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var Zne;let pi=Zne=class extends be{constructor(t){super(t),this._ray=$n(),this._viewport=$i(0,0,1,1),this._padding=$i(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Cs(1,1e3),this._viewDirty=!0,this._viewMatrix=ut(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ut(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ut(),this._frustumDirty=!0,this._frustum=mde(),this._fullViewport=li(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=I(),this._up=I(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Ae(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Ln(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),xe(I(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),xe(I(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),xe(I(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=y1(li(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&J5(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=y1(li(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&J5(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[3],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[2],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(t){this.width=t-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(t){this.height=t-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){S0(this._padding,t)||(this._viewport[0]+=t[3]-this._padding[3],this._viewport[1]+=t[2]-this._padding[2],this._viewport[2]-=t[1]+t[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=t[0]+t[2]-(this._padding[0]+this._padding[2]),qc(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Cn(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return Kl(ut(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ut()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return jEt(this._fov,this.width,this.height)}set fovX(t){this._fov=NEt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return UEt(this._fov,this.width,this.height)}set fovY(t){this._fov=VEt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Bi(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Kl(this._viewInverseTransposeMatrix,this.viewMatrix),Yc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const{near:e,far:i}=this;return 2*e*i/(i+e-t*(i-e))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,a=-r/2+this.column*n,o=a+n,l=-i/2+this.row*s,u=l+s,d=u5e(ut(),a*(1+2*this._padding[3]/t),o*(1+2*this._padding[1]/t),l*(1+2*this._padding[2]/e),u*(1+2*this._padding[0]/e),this.near,this.far),f=this._get("projectionMatrix");return f&&pue(f,d)?f:d}copyFrom(t){me(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,qc(this._viewport,t.viewport),this.notifyChange("_viewport"),qc(this._padding,t.padding),this.notifyChange("_padding"),na(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Ln(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(g6e(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ln(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),qc(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return new Zne().copyFrom(this)}equals(t){return di(this.eye,t.eye)&&di(this.center,t.center)&&di(this.up,t.up)&&S0(this._viewport,t.viewport)&&S0(this._padding,t.padding)&&bq(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||nG(t.screenPadding,this.screenPadding)>=e||nG(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;xi(jn,t.eye,t.center),xi(Im,this.eye,this.center);const i=Le(jn,Im),r=r$(jn),s=r$(Im),n=5e-4;return i*i>=(1-1e-10)*r*s&&zO(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(Dw(this.viewForward,Ae(jn,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=yn()){return t[0]=(this.padding[3]+this.width/2)/this.pixelRatio,t[1]=(this.padding[0]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[3]+this.width*e,t[1]=this.padding[2]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Ri&&me(Ri,t),Ri[3]=1,zu(Ri,Ri,this.projectionMatrix);const i=Math.abs(Ri[3]);he(Ri,Ri,1/i);const r=this.fullViewport;e[0]=yt(0,r[0]+r[2],.5+.5*Ri[0]),e[1]=yt(0,r[1]+r[3],.5+.5*Ri[1]),e[2]=.5*(Ri[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Ri[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Ri[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Ri[2]=(2*t[2]-1)*t[3],Ri[3]=t[3],this.inverseProjectionMatrix!=null&&(zu(Ri,Ri,this.inverseProjectionMatrix),e[0]=Ri[0],e[1]=Ri[1],e[2]=Ri[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,kQ),this.renderToScreen(kQ,e),e}projectToRenderScreen(t,e){if(Ri[0]=t[0],Ri[1]=t[1],Ri[2]=t[2],Ri[3]=1,zu(Ri,Ri,this.viewProjectionMatrix),Ri[3]===0)return null;const i=Ri;he(i,i,1/Math.abs(Ri[3]));const r=this.fullViewport,s=yt(0,r[0]+r[2],.5+.5*i[0]),n=yt(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,kQ),e)}unprojectFromRenderScreen(t,e){if(Cn(BV,this.projectionMatrix,this.viewMatrix),!Kl(BV,BV))return null;const i=this.fullViewport;return Ri[0]=2*(t[0]-i[0])/i[2]-1,Ri[1]=2*(t[1]-i[1])/i[3]-1,Ri[2]=2*t[2]-1,Ri[3]=1,zu(Ri,Ri,BV),Ri[3]===0?null:(e[0]=Ri[0]/Ri[3],e[1]=Ri[1]/Ri[3],e[2]=Ri[2]/Ri[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,a=Math.max(s-i/2,0),o=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),u=-Math.min(this.fullHeight-n-r/2,0),d=i-l- -Math.min(this.fullWidth-s-i/2,0),f=r-u- -Math.min(n-r/2,0);return[Math.round(a),Math.round(o),Math.round(d),Math.round(f)]}computeUp(t){t===1?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){Ae(jn,this.center,this.eye);const t=Ve(this.center);t<1?di(this._up,L0)&&(me(this._up,L0),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Le(jn,this.center))>.9999*Ve(jn)*t||(At(Im,jn,this.center),At(Im,Im,jn),Re(Im,Im),di(this._up,Im)||(me(this._up,Im),this.notifyChange("_up"),this._markViewDirty()))}_computeUpLocal(){L1(jn,this.eye,this.center),Math.abs(jn[2])<=.9999&&(he(jn,jn,jn[2]),xe(jn,-jn[0],-jn[1],1-jn[2]),Re(jn,jn),di(this._up,jn)||(me(this._up,jn),this.notifyChange("_up"),this._markViewDirty()))}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?di(t,e)||(me(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):re.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(y6e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(O7(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};c([p()],pi.prototype,"_viewport",void 0),c([p()],pi.prototype,"_padding",void 0),c([p()],pi.prototype,"_fov",void 0),c([p()],pi.prototype,"_nearFar",void 0),c([p()],pi.prototype,"_viewDirty",void 0),c([p()],pi.prototype,"_viewMatrix",void 0),c([p()],pi.prototype,"_pixelRatio",void 0),c([p()],pi.prototype,"pixelRatio",null),c([p()],pi.prototype,"row",void 0),c([p()],pi.prototype,"column",void 0),c([p()],pi.prototype,"_rows",void 0),c([p()],pi.prototype,"rows",null),c([p()],pi.prototype,"_columns",void 0),c([p()],pi.prototype,"columns",null),c([p()],pi.prototype,"eye",null),c([p()],pi.prototype,"center",null),c([p()],pi.prototype,"_center",void 0),c([p()],pi.prototype,"up",null),c([p()],pi.prototype,"_up",void 0),c([p()],pi.prototype,"viewMatrix",null),c([p({readOnly:!0})],pi.prototype,"viewForward",null),c([p({readOnly:!0})],pi.prototype,"viewUp",null),c([p({readOnly:!0})],pi.prototype,"viewRight",null),c([p({readOnly:!0})],pi.prototype,"nearFar",null),c([p()],pi.prototype,"near",null),c([p()],pi.prototype,"far",null),c([p()],pi.prototype,"viewport",null),c([p({readOnly:!0})],pi.prototype,"screenViewport",null),c([p({readOnly:!0})],pi.prototype,"screenPadding",null),c([p()],pi.prototype,"x",null),c([p()],pi.prototype,"y",null),c([p()],pi.prototype,"width",null),c([p()],pi.prototype,"height",null),c([p()],pi.prototype,"fullWidth",null),c([p()],pi.prototype,"fullHeight",null),c([p({readOnly:!0})],pi.prototype,"_aspect",null),c([p()],pi.prototype,"padding",null),c([p({readOnly:!0})],pi.prototype,"projectionMatrix",null),c([p({readOnly:!0})],pi.prototype,"inverseProjectionMatrix",null),c([p()],pi.prototype,"fov",null),c([p()],pi.prototype,"fovX",null),c([p()],pi.prototype,"fovY",null),c([p()],pi.prototype,"viewInverseTransposeMatrix",null),c([p({readOnly:!0})],pi.prototype,"_projectionMatrixInternal",null),c([p()],pi.prototype,"relativeElevation",void 0),pi=Zne=c([R("esri.views.3d.webgl.RenderCamera")],pi);const wr=pi,Ri=li(),BV=ut(),jn=I(),Im=I(),kQ=Dg();var f0;let $o=(f0=class{constructor(e=1/0,i=-1/0){this.near=e,this.far=i}set(e,i){this.near=e,this.far=i}union(e){e!=null&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far))}within(e){return this.near<=e&&e<=this.far}equals(e){return this.near===e.near&&this.far===e.far}},f0.Zero=new f0(0,0),f0.Infinite=new f0,f0),kw=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.distance==null?null:(he(qV,this.ray.direction,this.distance),Ve(qV))}withinDistance(e){return!!td(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!td(this)&&(he(qV,this.ray.direction,this.distance),$e(e,this.ray.origin,qV),!0)}getTransformedNormal(e){return me(fI,this.normal),fI[3]=0,zu(fI,fI,this.transformation),me(e,fI),Re(e,e)}constructor(e){this.intersector=4,this.normal=I(),this.transformation=ut(),this._ray=$n(),this.init(e)}init(e){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=4,uG(e,this._ray)}set(e,i,r,s,n,a,o){this.intersector=e,this.distance=r,me(this.normal,s??L0),Ln(this.transformation,n??gl),this.target=i,this.drapedLayerOrder=a,this.renderPriority=o}copy(e){uG(e.ray,this._ray),this.intersector=e.intersector,this.distance=e.distance,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.renderPriority=e.renderPriority,me(this.normal,e.normal),Ln(this.transformation,e.transformation)}};function td(t){return t?.distance!=null}const qV=I(),fI=li();let BEt=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.primitiveIndex=r}},Yne=class extends kw{constructor(){super(...arguments),this.intersector=1}},qEt=class extends BEt{constructor(e,i){super(e.object,e.geometryId,e.primitiveIndex),this.center=Tr(i)}};function mH(t){return td(t)&&t.intersector===1&&!!t.target&&"center"in t.target}let GEt=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerViewUids=[],this.store=2,this.normalRequired=!0,this.excludeLabels=!1}};function HEt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function mG(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function gde(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>_n()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function gH(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=i[0],l=i[1],u=i[2],d=i[3];return t[0]=r*d+a*o+s*u-n*l,t[1]=s*d+a*l+n*o-r*u,t[2]=n*d+a*u+r*l-s*o,t[3]=a*d-r*o-s*l-n*u,t}function WEt(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],a=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l+a*o,t[1]=s*l+n*o,t[2]=n*l-s*o,t[3]=a*l-r*o,t}function ZEt(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],a=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*o,t[1]=s*l+a*o,t[2]=n*l+r*o,t[3]=a*l-s*o,t}function YEt(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],a=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*o,t[1]=s*l-r*o,t[2]=n*l+a*o,t[3]=a*l-n*o,t}function JEt(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function mB(t,e,i,r){const s=e[0],n=e[1],a=e[2],o=e[3];let l,u,d,f,g,v=i[0],_=i[1],x=i[2],S=i[3];return u=s*v+n*_+a*x+o*S,u<0&&(u=-u,v=-v,_=-_,x=-x,S=-S),1-u>_n()?(l=Math.acos(u),d=Math.sin(l),f=Math.sin((1-r)*l)/d,g=Math.sin(r*l)/d):(f=1-r,g=r),t[0]=f*s+g*v,t[1]=f*n+g*_,t[2]=f*a+g*x,t[3]=f*o+g*S,t}function QEt(t){const e=sF,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),a=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*s),t[3]=a*Math.cos(2*Math.PI*s),t}function XEt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=i*i+r*r+s*s+n*n,o=a?1/a:0;return t[0]=-i*o,t[1]=-r*o,t[2]=-s*o,t[3]=n*o,t}function Lw(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function x6e(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,a=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*a+a]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+a]-e[3*a+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[a]=(e[3*a+s]+e[3*s+a])*r}return t}function KEt(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),a=Math.cos(e),o=Math.sin(i),l=Math.cos(i),u=Math.sin(r),d=Math.cos(r);return t[0]=n*l*d-a*o*u,t[1]=a*o*d+n*l*u,t[2]=a*l*u-n*o*d,t[3]=a*l*d+n*o*u,t}function eAt(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const tAt=qc,Jne=Or,iAt=Lhe,rAt=gH,sAt=y1,nAt=zhe,aAt=sH,S6e=Fhe,oAt=S6e,T6e=rH,lAt=T6e,yde=KVe,cAt=S0,uAt=J5;function hAt(t,e,i){const r=Le(e,i);return r<-.999999?(At(Dm,dAt,e),Ph(Dm)<1e-6&&At(Dm,pAt,e),Re(Dm,Dm),mG(t,Dm,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(At(Dm,e,i),t[0]=Dm[0],t[1]=Dm[1],t[2]=Dm[2],t[3]=1+r,yde(t,t))}const Dm=I(),dAt=Ye(1,0,0),pAt=Ye(0,1,0);function fAt(t,e,i,r,s,n){return mB(jSe,e,s,n),mB(USe,i,r,n),mB(t,jSe,USe,2*n*(1-n)),t}const jSe=Pp(),USe=Pp();function mAt(t,e,i,r){const s=gAt;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],yde(t,x6e(t,s))}const gAt=Jr();Object.freeze(Object.defineProperty({__proto__:null,add:iAt,calculateW:JEt,conjugate:Lw,copy:tAt,dot:nAt,equals:uAt,exactEquals:cAt,fromEuler:KEt,fromMat3:x6e,getAxisAngle:gde,identity:HEt,invert:XEt,len:oAt,length:S6e,lerp:aAt,mul:rAt,multiply:gH,normalize:yde,random:QEt,rotateX:WEt,rotateY:ZEt,rotateZ:YEt,rotationTo:hAt,scale:sAt,set:Jne,setAxes:mAt,setAxisAngle:mG,slerp:mB,sqlerp:fAt,sqrLen:lAt,squaredLength:T6e,str:eAt},Symbol.toStringTag,{value:"Module"}));let DF=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},ki=class extends DF{constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};const UO=1e-6,mI=I(),GV=I();function yAt(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new MAt(t);Xne(mI,n.minProj,n.maxProj),pk(mI,mI,.5),ip(GV,n.maxProj,n.minProj);const a=Qne(GV),o=new EAt;o.quality=a,s<14&&(t=new DF(new Float64Array(n.buffer,112,42),3));const l=I(),u=I(),d=I(),f=I(),g=I(),v=I(),_=I();switch(vAt(n,t,_,l,u,d,f,g,v,o)){case 1:return void HSe(mI,GV,e);case 2:return void $At(t,f,e)}_At(t,_,l,u,d,f,g,v,o),$6e(t,o.b0,o.b1,o.b2,iA,rA);const x=I();ip(x,rA,iA),o.quality=Qne(x),o.quality<a?C6e(o.b0,o.b1,o.b2,iA,rA,x,e):HSe(mI,GV,e)}function vAt(t,e,i,r,s,n,a,o,l,u){return bAt(t,r,s),Kne(r,s)<UO?1:(ip(a,r,s),jo(a,a),wAt(e,r,a,n)<UO?2:(ip(o,s,n),jo(o,o),ip(l,n,r),jo(l,l),rp(i,o,a),jo(i,i),S2(e,i,a,o,l,u),0))}const gI=I(),yI=I(),yd=I(),vd=I(),_d=I(),Y_=I(),J_=I(),Q_=I();function _At(t,e,i,r,s,n,a,o,l){xAt(t,e,i,gI,yI),gI[0]!==void 0&&(ip(yd,gI,i),jo(yd,yd),ip(vd,gI,r),jo(vd,vd),ip(_d,gI,s),jo(_d,_d),rp(Y_,vd,n),jo(Y_,Y_),rp(J_,_d,a),jo(J_,J_),rp(Q_,yd,o),jo(Q_,Q_),S2(t,Y_,n,vd,yd,l),S2(t,J_,a,_d,vd,l),S2(t,Q_,o,yd,_d,l)),yI[0]!==void 0&&(ip(yd,yI,i),jo(yd,yd),ip(vd,yI,r),jo(vd,vd),ip(_d,yI,s),jo(_d,_d),rp(Y_,vd,n),jo(Y_,Y_),rp(J_,_d,a),jo(J_,J_),rp(Q_,yd,o),jo(Q_,Q_),S2(t,Y_,n,vd,yd,l),S2(t,J_,a,_d,vd,l),S2(t,Q_,o,yd,_d,l))}function bAt(t,e,i){let r=Kne(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const a=Kne(t.maxVert[n],t.minVert[n]);a>r&&(r=a,s=n)}Gh(e,t.minVert[s]),Gh(i,t.maxVert[s])}const bd=[0,0,0];function wAt(t,e,i,r){const{data:s,size:n}=t;let a=Number.NEGATIVE_INFINITY,o=0;for(let l=0;l<s.length;l+=n){bd[0]=s[l]-e[0],bd[1]=s[l+1]-e[1],bd[2]=s[l+2]-e[2];const u=i[0]*bd[0]+i[1]*bd[1]+i[2]*bd[2],d=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],f=bd[0]*bd[0]+bd[1]*bd[1]+bd[2]*bd[2]-u*u/d;f>a&&(a=f,o=l)}return Gh(r,s,o),a}const xa=Ke();function xAt(t,e,i,r,s){TAt(t,e,xa,s,r);const n=E6e(i,e);xa[1]-UO<=n&&(r[0]=void 0),xa[0]+UO>=n&&(s[0]=void 0)}const BSe=I(),qSe=I(),GSe=I(),BC=I(),qC=I(),HV=I();function S2(t,e,i,r,s,n){if(M6e(e)<UO)return;rp(BSe,i,e),rp(qSe,r,e),rp(GSe,s,e),tA(t,e,xa),qC[1]=xa[0],BC[1]=xa[1],HV[1]=BC[1]-qC[1];const a=[i,r,s],o=[BSe,qSe,GSe];for(let l=0;l<3;++l){tA(t,a[l],xa),qC[0]=xa[0],BC[0]=xa[1],tA(t,o[l],xa),qC[2]=xa[0],BC[2]=xa[1],HV[0]=BC[0]-qC[0],HV[2]=BC[2]-qC[2];const u=Qne(HV);u<n.quality&&(Gh(n.b0,a[l]),Gh(n.b1,e),Gh(n.b2,o[l]),n.quality=u)}}const SAt=I();function tA(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const a=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],a),i[1]=Math.max(i[1],a)}}function TAt(t,e,i,r,s){const{data:n,size:a}=t;Gh(r,n),Gh(s,r),i[0]=E6e(SAt,e),i[1]=i[0];for(let o=a;o<n.length;o+=a){const l=n[o]*e[0]+n[o+1]*e[1]+n[o+2]*e[2];l<i[0]&&(i[0]=l,Gh(r,n,o)),l>i[1]&&(i[1]=l,Gh(s,n,o))}}function HSe(t,e,i){i.center=t,i.halfSize=he(e,e,.5),i.quaternion=Whe}const Iy=I(),GC=I(),vI=I(),iA=I(),rA=I(),WSe=I();function $At(t,e,i){Gh(Iy,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Iy[0]=0:Math.abs(e[1])>Math.abs(e[2])?Iy[1]=0:Iy[2]=0,M6e(Iy)<UO&&(Iy[0]=Iy[1]=Iy[2]=1),rp(GC,e,Iy),jo(GC,GC),rp(vI,e,GC),jo(vI,vI),$6e(t,e,GC,vI,iA,rA),ip(WSe,rA,iA),C6e(e,GC,vI,iA,rA,WSe,i)}function $6e(t,e,i,r,s,n){tA(t,e,xa),s[0]=xa[0],n[0]=xa[1],tA(t,i,xa),s[1]=xa[0],n[1]=xa[1],tA(t,r,xa),s[2]=xa[0],n[2]=xa[1]}const _x=I(),_I=I(),WV=I(),km=kIe(1,0,0,0,1,0,0,0,1),CAt=Pp();function C6e(t,e,i,r,s,n,a){km[0]=t[0],km[1]=t[1],km[2]=t[2],km[3]=e[0],km[4]=e[1],km[5]=e[2],km[6]=i[0],km[7]=i[1],km[8]=i[2],a.quaternion=AAt(CAt,km),Xne(_x,r,s),pk(_x,_x,.5),pk(_I,t,_x[0]),pk(WV,e,_x[1]),Xne(_I,_I,WV),pk(WV,i,_x[2]),a.center=$e(_I,_I,WV),a.halfSize=he(_x,n,.5)}const lh=7;let MAt=class{constructor(e){this.minVert=new Array(lh),this.maxVert=new Array(lh);const i=64*lh;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,lh),r+=8*lh,this.maxProj=new Float64Array(this.buffer,r,lh),r+=8*lh;for(let l=0;l<lh;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<lh;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<lh;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(lh),n=new Array(lh),{data:a,size:o}=e;for(let l=0;l<a.length;l+=o){let u=a[l];u<this.minProj[0]&&(this.minProj[0]=u,s[0]=l),u>this.maxProj[0]&&(this.maxProj[0]=u,n[0]=l),u=a[l+1],u<this.minProj[1]&&(this.minProj[1]=u,s[1]=l),u>this.maxProj[1]&&(this.maxProj[1]=u,n[1]=l),u=a[l+2],u<this.minProj[2]&&(this.minProj[2]=u,s[2]=l),u>this.maxProj[2]&&(this.maxProj[2]=u,n[2]=l),u=a[l]+a[l+1]+a[l+2],u<this.minProj[3]&&(this.minProj[3]=u,s[3]=l),u>this.maxProj[3]&&(this.maxProj[3]=u,n[3]=l),u=a[l]+a[l+1]-a[l+2],u<this.minProj[4]&&(this.minProj[4]=u,s[4]=l),u>this.maxProj[4]&&(this.maxProj[4]=u,n[4]=l),u=a[l]-a[l+1]+a[l+2],u<this.minProj[5]&&(this.minProj[5]=u,s[5]=l),u>this.maxProj[5]&&(this.maxProj[5]=u,n[5]=l),u=a[l]-a[l+1]-a[l+2],u<this.minProj[6]&&(this.minProj[6]=u,s[6]=l),u>this.maxProj[6]&&(this.maxProj[6]=u,n[6]=l)}for(let l=0;l<lh;++l){let u=s[l];Gh(this.minVert[l],a,u),u=n[l],Gh(this.maxVert[l],a,u)}}},EAt=class{constructor(){this.b0=Ye(1,0,0),this.b1=Ye(0,1,0),this.b2=Ye(0,0,1),this.quality=0}};function Qne(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function Xne(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function ip(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function pk(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Gh(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function rp(t,e,i){const r=e[0],s=e[1],n=e[2],a=i[0],o=i[1],l=i[2];t[0]=s*l-n*o,t[1]=n*a-r*l,t[2]=r*o-s*a}function jo(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function M6e(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function Kne(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function E6e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function AAt(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let a=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*a,a=.5/a,t[3]=(e[3*s+n]-e[3*n+s])*a,t[s]=(e[3*s+r]+e[3*r+s])*a,t[n]=(e[3*n+r]+e[3*r+n])*a}return t}let A6e=class gB{constructor(e=Aa,i=NAt,r=Whe){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){return gB.fromData(this._data)}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new gB;return i._copyFromData(e),i}static fromJSON(e){return new gB(e.center,e.halfSize,e.quaternion)}copy(e){this._copyFromData(e.data)}_copyFromData(e){for(let i=0;i<10;++i)this._data[i]=e[i]}get center(){return xe(Xe.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return xe(Xe.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return Jne(_3t.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=this._data,r=Jne(fs,i[6],i[7],i[8],i[9]);for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*i[3],n[1]=(2&s?-1:1)*i[4],n[2]=(4&s?-1:1)*i[5],Eu(n,n,r),n[0]+=i[0],n[1]+=i[1],n[2]+=i[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){mi[0]=this._data[0]-e[0],mi[1]=this._data[1]-e[1],mi[2]=this._data[2]-e[2];const i=this.getQuaternion(s0);return Lw(fs,i),Eu(mi,mi,fs),FO(mi,mi),Dy[0]=Math.min(mi[0],this._data[3]),Dy[1]=Math.min(mi[1],this._data[4]),Dy[2]=Math.min(mi[2],this._data[5]),zO(Dy,mi)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;mi[0]=r[0]-e[0],mi[1]=r[1]-e[1],mi[2]=r[2]-e[2];const s=e[3],n=s+i;return!(r$(mi)>n*n)&&(fs[0]=-r[6],fs[1]=-r[7],fs[2]=-r[8],fs[3]=r[9],Eu(mi,mi,fs),FO(mi,mi),Dy[0]=Math.min(mi[0],r[3]),Dy[1]=Math.min(mi[1],r[4]),Dy[2]=Math.min(mi[2],r[5]),zO(Dy,mi)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=fs;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],mi[0]=e[0]-s[0],mi[1]=e[1]-s[1],mi[2]=e[2]-s[2];const a=Eu(mi,mi,fs),o=Eu(Dy,i,fs);let l=-1/0,u=1/0;const d=this.getHalfSize(sA);for(let f=0;f<3;f++){const g=a[f],v=o[f],_=d[f]+r;if(Math.abs(v)>1e-6){const x=(_-g)/v,S=(-_-g)/v;l=Math.max(l,Math.min(x,S)),u=Math.min(u,Math.max(x,S))}else if(g>_||g<-_)return!1}return l<=u}projectedArea(e,i,r,s){const n=this.getQuaternion(s0);Lw(fs,n),mi[0]=e[0]-this._data[0],mi[1]=e[1]-this._data[1],mi[2]=e[2]-this._data[2],Eu(mi,mi,fs);const a=this.getHalfSize(sA),o=mi[0]<-a[0]?-1:mi[0]>a[0]?1:0,l=mi[1]<-a[1]?-1:mi[1]>a[1]?1:0,u=mi[2]<-a[2]?-1:mi[2]>a[2]?1:0,d=Math.abs(o)+Math.abs(l)+Math.abs(u);if(d===0)return 1/0;const f=d===1?4:6,g=6*(o+3*l+9*u+13);R5(E3,n),cF(E3,E3,a);const v=this.getCenter(Nf);for(let S=0;S<f;S++){const T=RAt[g+S];xe(mi,((1&T)<<1)-1,(2&T)-1,((4&T)>>1)-1),Ql(mi,mi,E3),$e(bx,v,mi),bx[3]=1,zu(bx,bx,i);const M=1/Math.max(1e-6,bx[3]);Qp[2*S]=bx[0]*M,Qp[2*S+1]=bx[1]*M}const _=2*f-2;let x=Qp[0]*(Qp[3]-Qp[_+1])+Qp[_]*(Qp[1]-Qp[_-1]);for(let S=2;S<_;S+=2)x+=Qp[S]*(Qp[S+3]-Qp[S-1]);return Math.abs(x)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(s0);return Lw(fs,i),Eu(mi,e,fs),Math.abs(mi[0]*this._data[3])+Math.abs(mi[1]*this._data[4])+Math.abs(mi[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(s0),r=R5(E3,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),a=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-a,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+a}transform(e,i,r,s=0,n=v1(r),a=v1(i),o=e$(i,a)){if(r===n)i.isGeographic?LAt(this,e,i,s,a):kAt(this,e,i,s,a,o);else if(i.isWGS84&&(r.isWebMercator||E5(r)))IAt(i,this,r,e,s);else if(i.isWebMercator&&E5(r))DAt(i,this,r,e,s);else{const l=this.getCenter(Nf);l[2]+=s,io(l,i,0,l,r,0),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(s0),e.halfSize=this.getHalfSize(sA))}}};const fs=Pp(),s0=Pp(),OAt=Pp(),mi=I(),Dy=I(),bx=li();function PAt(t,e=new A6e){return yAt(t,e),e}const Qp=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],RAt=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function O6e(t,e,i,r,s){const n=t.getQuaternion(s0);s.quaternion=n,Lw(fs,n);const a=t.getCenter(Nf),o=t.getHalfSize(sA);if(r===1){Eu(Gr,a,fs),FO(Pf,Gr),XFe(uh,Pf,o),xi(uh,Pf,uh);const l=Ve(uh);$e(uh,Pf,o);const u=Ve(uh);if(l<i)s.center=a,xe(Gr,i,i,i),s.halfSize=$e(Gr,o,Gr);else{const d=u>0?1+e/u:1,f=l>0?1+i/l:1,g=(f+d)/2,v=(f-d)/2;he(uh,Pf,v),s.halfSize=Fr(uh,uh,o,g),he(uh,Pf,g),Fr(uh,uh,o,v),QFe(Gr,Gr),Que(Gr,uh,Gr);const _=t.getQuaternion(OAt);s.center=Eu(Gr,Gr,_)}}else{s.center=Fr(Gr,a,L0,(i+e)/2);const l=Eu(Gr,L0,fs);FO(l,l),s.halfSize=Fr(Pf,o,l,(i-e)/2)}return s}function IAt(t,e,i,r,s){e.getCenter(Nf),Nf[2]+=s;const n=v1(i);io(Nf,t,0,Nf,n,0),P6e(n,e,Nf,i,r)}function DAt(t,e,i,r,s){e.getCenter(Nf),Nf[2]+=s,P6e(t,e,Nf,i,r)}function P6e(t,e,i,r,s){const n=e.getQuaternion(s0),a=R5(E3,n),o=e.getHalfSize(sA);for(let l=0;l<8;++l){for(let u=0;u<3;++u)Eg[u]=o[u]*(l&1<<u?-1:1);for(let u=0;u<3;++u){let d=i[u];for(let f=0;f<3;++f)d+=Eg[f]*a[3*f+u];yB[3*l+u]=d}}io(yB,t,0,yB,r,0,8),PAt(FAt,s)}function kAt(t,e,i,r,s=v1(i),n=e$(i,s)){t.getCorners(ZSe),t.getCenter(Eg),Eg[2]+=r,IF(i,Eg,ch,s),e.setCenter(ch[12],ch[13],ch[14]);const a=2*Math.sqrt(1+ch[0]+ch[5]+ch[10]);fs[0]=(ch[6]-ch[9])/a,fs[1]=(ch[8]-ch[2])/a,fs[2]=(ch[1]-ch[4])/a,fs[3]=.25*a;const o=t.getQuaternion(s0);e.quaternion=gH(fs,fs,o),Lw(fs,fs),xe(Pf,0,0,0);const l=e.getCenter(zAt);for(const u of ZSe)u[2]+=r,n(u,0,u,0),xi(Gr,u,l),Eu(Gr,Gr,fs),FO(Gr,Gr),KFe(Pf,Pf,Gr);e.halfSize=Pf}function LAt(t,e,i,r,s=v1(i)){const n=xr(i),a=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter(Eg),Eg[2]+=r,io(Eg,i,0,Eg,s,0),e.center=Eg;const o=t.getQuaternion(s0);e.quaternion=o,Lw(fs,o),xe(Gr,0,0,1),Eu(Gr,Gr,fs);const l=t.getHalfSize(sA);xe(Gr,l[0]*Math.abs(Gr[0]),l[1]*Math.abs(Gr[1]),l[2]*Math.abs(Gr[2])),he(Gr,Gr,n.inverseFlattening),$e(Gr,l,Gr),e.halfSize=he(Gr,Gr,a)}const yB=new Array(24),FAt=new DF(yB,3),Eg=I(),Nf=I(),zAt=I(),sA=I(),E3=Jr(),ch=ut(),ZSe=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Gr=I(),Pf=I(),uh=I(),NAt=l1(-1,-1,-1);function oyi(t){return Array.from(t)}let VAt=class{constructor(){this._transform=ut(),this._transformInverse=new ZV({value:this._transform},Kl,ut),this._transformInverseTranspose=new ZV(this._transformInverse,Yc,ut),this._transformTranspose=new ZV({value:this._transform},Yc,ut),this._transformInverseRotation=new ZV({value:this._transform},PIe,Jr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Ln(this._transform,e)}multiplyTransform(e){Cn(this._transform,this._transform,e)}set(e){Ln(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},ZV=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},jAt=class{constructor(e=0){this.offset=e,this.tmpVertex=I()}applyToVertex(e,i,r){const s=xe(vde,e,i,r),n=$e(R6e,s,this.localOrigin),a=this.offset/Ve(n);return Fr(this.tmpVertex,s,n,a),this.tmpVertex}applyToAabb(e){const i=GAt,r=HAt,s=WAt;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const a=l=>{const u=this.applyToVertex(l[0],l[1],l[2]);for(let d=0;d<3;++d)e[d]=Math.min(e[d],u[d]),e[d+3]=Math.max(e[d+3],u[d])};for(let l=1;l<8;++l){for(let u=0;u<3;++u)s[u]=l&1<<u?r[u]:i[u];a(s)}let o=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(o|=1<<l);if(o!==0&&o!==7){for(let l=0;l<8;++l)if((o&l)===0){for(let u=0;u<3;++u)s[u]=o&1<<u?0:l&1<<u?i[u]:r[u];a(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},UAt=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=I(),this._tmpMbs=Is(),this._tmpObb=new A6e,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Ve(e)}applyToVertex(e,i,r){const s=xe(vde,e,i,r),n=xe(R6e,e,i,r+this.componentLocalOriginLength),a=this._totalOffset/Ve(n);return Fr(this._tmpVertex,s,n,a),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,a=e[3],o=e[4],l=e[5]+i,u=Math.abs(r),d=Math.abs(s),f=Math.abs(n),g=Math.abs(a),v=Math.abs(o),_=Math.abs(l),x=.5*(1+Math.sign(r*a))*Math.min(u,g),S=.5*(1+Math.sign(s*o))*Math.min(d,v),T=.5*(1+Math.sign(n*l))*Math.min(f,_),M=Math.max(u,g),E=Math.max(d,v),P=Math.max(f,_),O=Math.sqrt(x*x+S*S+T*T),D=Math.sign(u+r),L=Math.sign(d+s),F=Math.sign(f+n),j=Math.sign(g+a),N=Math.sign(v+o),B=Math.sign(_+l),U=this._totalOffset;if(O<U)return e[0]-=(1-D)*U,e[1]-=(1-L)*U,e[2]-=(1-F)*U,e[3]+=j*U,e[4]+=N*U,e[5]+=B*U,e;const Q=U/Math.sqrt(M*M+E*E+P*P),H=U/O,J=H-Q,Z=-J;return e[0]+=r*(D*Z+H),e[1]+=s*(L*Z+H),e[2]+=n*(F*Z+H),e[3]+=a*(j*J+Q),e[4]+=o*(N*J+Q),e[5]+=l*(B*J+Q),e}applyToMbs(e){const i=Li(e),r=Ve(i),s=this._totalOffset/r,n=Fr(I6e,i,i,s),a=e[3]+e[3]*this._totalOffset/r;return AP(this._tmpMbs,n,a),this._tmpMbs}applyToObb(e){return O6e(e,this._totalOffset,this._totalOffset,1,this._tmpObb),this._tmpObb}},BAt=class{constructor(e=0){this.offset=e,this.sphere=Is(),this.tmpVertex=I()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=xe(vde,e,i,r),a=Ft(n,n,s),o=this.offset/Ve(a);Fr(a,a,a,o);const l=this.objectTransform.inverse;return Ft(this.tmpVertex,a,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Ve(e);Fr(e,e,e,r);const s=this.offset/Ve(i);Fr(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Li(e),r=Ve(i),s=this.offset/r,n=Fr(I6e,i,i,s),a=e[3]+e[3]*this.offset/r;return AP(this.sphere,n,a),this.sphere}};const YSe=new BAt;function eae(t){return t!=null?(YSe.offset=t,YSe):null}const JSe=new UAt;function QSe(t){return t!=null?(JSe.offset=t,JSe):null}const XSe=new jAt;function qAt(t){return t!=null?(XSe.offset=t,XSe):null}const b1="terrain",vde=I(),R6e=I(),GAt=I(),HAt=I(),WAt=I(),I6e=I(),BO=1e-5;let Zu=class{constructor(e){this.options=new GEt,this._results=new ZAt,this.transform=new VAt,this.camera=new wr,this.tolerance=BO,this.verticalOffset=null,this._ray=$n(),this._rayEnd=I(),this._rayBeginTransformed=I(),this._rayEndTransformed=I(),this.viewingMode=e??1}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(tde(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&uG(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===2?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,$e(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r??BO;const a=eae(this.verticalOffset);if(e&&e.length>0){const o=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const u=l.getSpatialQueryAccelerator?.();u!=null?(a!=null?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,o,a):u.forEachAlongRay(this._ray.origin,this._ray.direction,o),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(o)):l.objects.forEach(d=>o(d))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=eae(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:a,id:o}=n;if(!a.visible)continue;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),Ft(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ft(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),a.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(u,d,f,g)=>this.handleObjectIntersection({object:e,geometryId:o,primitiveIndex:f},u,d,l,g))}}handleObjectIntersection(e,i,r,s,n){if(i<0||this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,i))return;const a=n?this._results.hud:this._results;e=n?new qEt(e,n):e;const o=n?l=>l.set(1,e,i,r):l=>l.set(4,e,i,r,s);if((a.min.distance==null||i<a.min.distance)&&o(a.min),this.options.store!==0&&(a.max.distance==null||i>a.max.distance)&&o(a.max),this.options.store===2)if(n){const l=new Yne(this._ray);o(l),this._results.hud.all.push(l)}else{const l=new kw(this._ray);o(l),this._results.all.push(l)}}sortResults(e=this._results.all){e.sort((i,r)=>i.distance!==r.distance?(i.distance??0)-(r.distance??0):i.drapedLayerOrder!==r.drapedLayerOrder?KSe(i.drapedLayerOrder,r.drapedLayerOrder):KSe(i.renderPriority,r.renderPriority))}};function KSe(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}let ZAt=class{constructor(){this.min=new kw($n()),this.max=new kw($n()),this.hud={min:new Yne($n()),max:new Yne($n()),all:new Array},this.ground=new kw($n()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}};function D6e(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,gG,r)!=null&&Rnt(i,gG)}function yH(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function R$(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),YAt(t,s.ray,X_)||me(X_,s.center);const n=t.state.constraints,a=n.minimumPoiDistance;if(Mn(s.eye,X_)<a){const o=n.collision.enabled;me(wx,s.viewForward),he(wx,wx,a),o?s.eye=Ae(gG,X_,wx):$e(X_,s.eye,wx);const l=t.renderCoordsHelper,u=l.getAltitude(s.eye),d=n.collision.elevationMargin;o&&u<d&&(Ae(wx,X_,s.eye),s.eye=l.setAltitude(gG,d,s.eye),$e(X_,s.eye,wx))}return s.center=X_,s}function eTe(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=yH(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic;let n=tTe.get(t);n===void 0&&(n=new wr,tTe.set(t,n)),n.eye=e,n.center=i;const{far:a}=s.compute(n,t.renderDataExtent,$o.Infinite,r),o=a*a;return Mn(e,i)>o}function YAt(t,e,i){let r=tae[t.viewingMode];r||(r=new Zu(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,tae[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||eTe(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||eTe(t,e.origin,i))||!!s&&JAt(e,i,xr(t.spatialReference).radius)}function JAt(t,e,i){const r=Le(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return he(e,t.direction,s/Ve(t.direction)),$e(e,e,t.origin),!0}let tae={};function QAt(){tae={}}const gG=I(),X_=I(),wx=I(),tTe=new WeakMap;function XAt(t,e){const i=[],r=[];return YV(i,t,e,0),YV(r,i,e,1),YV(i,r,e,2),YV(r,i,e,3),r}function YV(t,e,i,r){const s=KAt(i,r);if(t.length=0,e.length){s(JV,e[0],e[0])===1&&bI(t,e[0]);for(let n=0;n<e.length;n++){const a=e[n===e.length-1?0:n+1];switch(s(JV,e[n],a)){case 1:bI(t,a);break;case 3:bI(t,Lq(JV));break;case 2:bI(t,Lq(JV)),bI(t,a)}}}}function bI(t,e){t.length!==0&&l7(t.at(-1),e)||t.push(e)}function KAt(t,e){const i=e===0||e===2?0:1,r=t[e],s=e===0||e===1?1:-1,n=i===0?1:0;return(a,o,l)=>{if(o[i]<r&&l[i]<r)return s===1?0:1;if(o[i]>r&&l[i]>r)return s===1?1:0;const u=(l[n]-o[n])/(l[i]-o[i]),d=o[n]+u*(r-o[i]);return a[i]=r,a[n]=d,(o[i]<r?1:-1)*s>0?2:3}}const JV=Ke(),eOt=I(),QV=I();function _de(){return{direction:I(),up:I()}}function k6e(t,e,i,r,s){let n=Re(eOt,t),a=Le(n,r);const o=a>0;a=Math.abs(a),a>.99&&(a=Math.abs(Le(e,r)),a<.99?(me(n,e),o&&he(n,n,-1)):n=null);let l=0;if(n){he(QV,r,Le(r,n)),Ae(n,n,QV);const d=Le(n,s)/(Ve(n)*Ve(s));At(QV,n,s),l=(Le(QV,r)>0?1:-1)*to(Ao(d))}const u=to(Ao(-Le(r,t)/Ve(t)));return i?(i.heading=l,i.tilt=u,i):{heading:l,tilt:u}}function L6e(t,e,i,r){Ae(iTe,i,e),Dje(r,$je(e,iTe),t)||t===i||me(t,i)}const iTe=I(),F6e=Ye(0,1,0),z6e=Ye(0,0,1),wI=ut(),ky=I(),Ly=I();function N6e(t,e,i,r=_de()){const{direction:s,up:n}=r;return a5e(wI,-zt(e)),OO(wI,wI,zt(i)),Ft(s,z6e,wI),he(s,s,-1),Ft(n,F6e,wI),r}function tOt(t,e,i,r){return k6e(e,i,r,z6e,F6e)}function iOt(t,e,i,r){const s=N6e(t,i,r),n=I();return he(n,s.direction,-e),$e(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function rOt(t){return to(t)}function sOt(t){return zt(t)}function nOt(t,e,i,r,s){const n=t.renderSpatialReference,a=t.spatialReference??e.spatialReference;return Jc(e,ky,n),Jc(e,Ly,n),ky[0]-=i/2,Ly[0]+=i/2,ky[1]-=r/2,Ly[1]+=r/2,Co(ky,n,ky,a),Co(Ly,n,Ly,a),s?(s.xmin=ky[0],s.ymin=ky[1],s.xmax=Ly[0],s.ymax=Ly[1],s.spatialReference=a):s=new It(ky[0],ky[1],Ly[0],Ly[1],a),s}function aOt(t,e){const i=t.frustum,{renderCoordsHelper:r}=t,s=r.getAltitude(e),n=t.spatialReference,a=t.state.camera.eye,o=[],l=i.planes[5];for(let u=0;u<4;u++){const d=i.lines[u];r.intersectInfiniteManifold(um(d.origin,d.direction),s,If)||oOt(If,i,r,d.endpoint,s),L6e(If,a,If,l),o.push(Cs(If[0],If[1]))}return lOt(XAt(o,r.extent),r,n)}function oOt(t,e,i,r,s){const n=e.lines[11].direction,a=(s-i.getAltitude(r))/n[2];Fr(t,r,n,a)}function lOt(t,e,i){const r=t.map(s=>(xe(If,s[0],s[1],0),e.fromRenderCoords(If,If,i),[If[0],If[1]]));return r.length<=2?new Wr({spatialReference:i}):(r.push(r[0].slice()),p7(r)||r.reverse(),new Wr({rings:[r],spatialReference:i}))}const If=I(),cOt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:tOt,eyeForCenterWithHeadingTilt:iOt,eyeTiltToLookAtTilt:sOt,headingTiltToDirectionUp:N6e,lookAtTiltToEyeTilt:rOt,toArea:aOt,toExtent:nOt},Symbol.toStringTag,{value:"Module"}));var eT;let V6e=(eT=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=mde(),this._points=m6e(),this.lines=new Array(12),this._origin=I(),this._direction=I(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:I(),endpoint:null}}update(e){y6e(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),me(this._origin,e.eye),me(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)me(this._points[i],e[i]);v6e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return ww(this.frustum,e)}intersectsRay(e){return IEt(this.frustum,e)}intersectsLineSegment(e,i){return DEt(this.frustum,e,i)}intersectsPoint(e){return _6e(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;LQ(this.lines[i],e[i],e[r]),LQ(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),LQ(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}},eT.planePointIndices=kEt,eT.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]],eT);function LQ(t,e,i){t.origin=e,t.endpoint=i,L1(t.direction,e,i)}function bde(t){return Ce((t-iae)/(uOt-iae),0,1)}const iae=1e5,uOt=1e6,rae=1e4,vB=Ye(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),FQ=3,zQ=Ye(FQ*parseFloat(65e-8.toFixed(6)),FQ*parseFloat(1881e-9.toFixed(6)),FQ*parseFloat(85e-9.toFixed(6))),hOt=3996e-9,dOt=Ye(parseFloat(Number(vB[0]+zQ[0]).toFixed(6)),parseFloat(Number(vB[1]+zQ[1]).toFixed(6)),parseFloat(Number(vB[2]+zQ[2]).toFixed(6)));function pOt(t,e,i){return t===1?new mOt(e,i):new fOt(e,i)}let fOt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=xr(i),this._unitInMeters=Yr(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s){const{eye:n,center:a}=e;let o=n[2]*this._unitInMeters;const l=o,u=o-s,d=this._elevationProvider?.visibleElevationBounds;d&&(o=u>=0?l-this._unitInMeters*d.min:this._unitInMeters*d.max-l),i??=new It({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});const f={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},g=Math.max(f.x,f.y,f.z);Ae(Pb,a,n),Oc[0]=Pb[0]>0?i.xmax:i.xmin,Oc[1]=Pb[1]>0?i.ymax:i.ymin,Oc[2]=Pb[2]>0?g/2:-g/2,Ae(Oc,Oc,n),Re(Pb,Pb);const v=1.1*Le(Oc,Pb)*this._unitInMeters,_=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),x=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),S=x*yOt*this._unitInMeters,T=x*vOt*this._unitInMeters,M=Ce((o-T)/(S-T),0,1)**3,E=Math.min(yt(_,v,M),_)*Math.max(Math.log(Math.abs(u)),1);return j6e(Math.min(E,Math.max(34064e4,g))/this._unitInMeters,_B,this._unitInMeters,A3)}},mOt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=xr(i)}compute(e,i,r,s){const{eye:n}=e,a=Ve(n),o=a-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),u=Math.abs(o-s),d=Math.max(u,Math.abs(o)),f=this._elevationProvider?.visibleElevationBounds.max??0,g=bde(d),v=Math.sqrt(d*(d+2*l)),_=a+this._referenceEllipsoid.radius,x=1.2*yt(v,_,g),S=(Math.log(d)-rTe)/(gOt-rTe);j6e(x,Ce(_B-S*(_B-sTe),sTe,_B),1,A3);const T=this._referenceEllipsoid.radius+f,M=this._referenceEllipsoid.radius+this._referenceEllipsoid.atmosphereHeight,E=Math.max(T,M),P=a-E;if(g>0&&P>vH){const O=Re(Oc,he(Oc,e.eye,-1)),D=Re(Pb,e.viewForward),L=Ao(Le(O,D)),F=.5*e.fovY,j=Math.cos(F);let N=$o.Infinite.near;if(L<=F)N=P*j;else{const U=Re(Oc,e.viewUp),Q=Math.tan(F),H=he(Oc,U,Q),J=Re(Oc,Ae(Oc,D,H)),Z=ide(e.eye,J,bOt),K=O$(_Ot,E);if(a_(K,Z,Oc)){const ee=Ae(Oc,Oc,e.eye);N=Ve(ee)*j}}const B=.99*Math.min(r.near,N);if(B<$o.Infinite.near&&B>A3.near){const U=yt(A3.near,B,g);A3.near=U}}return A3}};function j6e(t,e,i,r){const s=vH/i,n=t/e;return n>s?(r.far=t,r.near=n):(r.near=s,r.far=r.near*e),r}const rTe=7.983,gOt=16.994,_B=2e4,sTe=100,vH=2,yOt=.001,vOt=1e-4,Oc=I(),Pb=I(),A3={near:0,far:0},_Ot=Is(),bOt=$n();function G0(t,e,i){t.worldUpAtPosition(e,nTe),Ae(NQ,i,e);const r=Ve(NQ);return r===0?0:Ao(Le(NQ,nTe)/r)}const nTe=I(),NQ=I();function aTe(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return wOt(t,e.longitude,e.latitude,i.longitude,i.latitude)}function wOt(t,e,i,r,s){const n=zt(i),a=zt(s),o=n-a,l=zt(e)-zt(r),u=Math.sin(o/2),d=Math.sin(l/2),f=2*Qh(Math.sqrt(u*u+Math.cos(n)*Math.cos(a)*d*d))*t;return Math.round(1e4*f)/1e4}function xOt(t,e,i){const r=e.spatialReference,s=xr(r),n=new Ue(e.x,t.y,r),a=new Ue(i.x,t.y,r),o=new Ue(t.x,e.y,r),l=new Ue(t.x,i.y,r);return{lon:aTe(s.radius,n,a),lat:aTe(s.radius,o,l)}}function SOt(t,e,i){const r=e/i,s=zt(t),n=Math.sin(r/2),a=Math.cos(s),o=2*Qh(Math.sqrt(n*n/(a*a)));return to(o)}function TOt(t,e){return t/15}function oTe(t,e){const i=t?.[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=TOt(i);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const U6e=Ye(0,0,1),B6e=Re(I(),Ye(1,1,1)),xI=ut(),Jb=I(),HC=I();function q6e(t,e,i,r=_de()){At(Jb,t,U6e),Le(Jb,Jb)===0&&At(Jb,t,B6e),Cp(xI,-zt(e),t),Uh(xI,xI,-zt(i),Jb);const{up:s,direction:n}=r;return At(s,Jb,t),Re(s,s),Ft(s,s,xI),Re(n,t),fp(n,n),Ft(n,n,xI),r}function $Ot(t,e,i,r){const s=Jb,n=HC;return Re(s,t),At(HC,s,U6e),Le(HC,HC)===0&&At(HC,s,B6e),At(n,HC,s),k6e(e,i,r,s,n)}function COt(t,e,i,r){const s={eye:I(),up:null,tilt:r,heading:i},n=Jb;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const a=e,o=zt(i),l=zt(r),u=Math.sin(o),d=Math.cos(o),f=Math.sin(l),g=Math.cos(l),v=Ve(n);let _;if(Math.abs(l)<1e-8)_=a+v;else{const Z=v/f,K=Qh(a/Z),ee=Math.PI-l-K;_=Z*Math.sin(ee)}const x=g*a,S=a*a*(f*f),T=d*d*S,M=_-x,E=M*M,P=T*(T+E-n[1]*n[1]);if(P<0)return he(s.eye,n,_/v),s.tilt=0,XV(s,t);const O=Math.sqrt(P),D=n[1]*M,L=T+E;let F;if(F=d>0?-O+D:O+D,Math.abs(L)<1e-8)return v<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=a):he(s.eye,n,_/v),s.tilt=0,VQ(s.eye),XV(s,t);s.eye[1]=F/L;const j=u*u*S,N=f*a,B=d*N*s.eye[1],U=s.eye[1]*s.eye[1],Q=1-U,H=Math.sqrt(Q),J=T*U+j-2*B*H*M+Q*E;return Math.abs(J)<1e-8?(he(s.eye,n,_/v),s.tilt=0,VQ(s.eye),XV(s,t)):(s.eye[0]=(Q*(_*n[0]-x*n[0])-N*H*(n[0]*s.eye[1]*d+n[2]*u))/J,s.eye[2]=(Q*(_*n[2]-x*n[2])-N*H*(n[2]*s.eye[1]*d-n[0]*u))/J,he(s.eye,s.eye,_),VQ(s.eye),XV(s,t))}function VQ(t){const e=t[1];t[1]=-t[2],t[2]=e}function XV(t,e){const i=q6e(e,t.heading,t.tilt);return t.up=i.up,t}function MOt(t,e,i){const r=Ve(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=Qh(i/(s/Math.sin(t)));return to(t-n)}function EOt(t,e,i){const r=zt(t),s=Ve(e);return Qh(i/(s/Math.sin(r)))+r}function AOt(t,e,i,r,s){let n,a,o,l;const u=e.latitude,d=xr(t.spatialReference).radius,f=e.longitude,g=SOt(u,i,d)/2;n=f-g,a=f+g;const v=zt(u),_=(1+Math.sin(v))/(1-Math.sin(v)),x=(_+1)*Math.tan(r/d/2),S=x*x;function T(E){const P=Math.PI/2;return(E=art.normalize(E,-P))>P&&(E=Math.PI-E),E}if(o=1.5*Math.PI-2*Math.atan(.5*(x+Math.sqrt(4*_+S))),l=o+r/d,o=T(o),l=T(l),l<o){const E=l;l=o,o=E}if(o=Math.max(to(o),-90),l=Math.min(to(l),90),a=CFe.monotonic(n,a),a-n>180){const E=(a-n-180)/2;n+=E,a-=E}const M=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Me.WGS84;return s?(s.xmin=n,s.ymin=o,s.xmax=a,s.ymax=l,s.spatialReference=M):s=new It(n,o,a,l,M),t.spatialReference&&t.spatialReference.isWebMercator&&_0(s,!1,s),s}function OOt(t,e){const{renderCoordsHelper:i}=t,r=t.state.camera.clone(),s=new V6e(i);r.near=vH,s.update(r);const n=i.getAltitude(e),a=t.spatialReference,o=i.referenceEllipsoid.radius,l=r.eye,u=1+Bi(l,e)/(o+n),d=Math.sqrt(u*u-1),{minCurvature:f,maxCurvature:g,minSamples:v,maxSamples:_}=DOt,x=IOt(t),S=Ce((d-f)/(g-f),0,1),T=Math.round(yt(v,_,S)),M=r.aboveGround,E=s.planes[5],P=[],O=Qg(Aa,kOt,Ui()),D=Qg(Aa,LOt,Ui());Or(jQ,0,0,0,0);const L=j=>{};for(let j=0;j<4;j++){const N=j===1&&!M||j===3&&M?1-x:0,B=j===1&&M||j===3&&!M?x:1,U=s.lines[j],Q=s.lines[j===3?0:j+1];for(let H=0;H<T;H++){const J=H/T,Z=H===0?0:yt(N,B,j===1?1-(1-J)**2:j===3?J**2:J),K=cr(zOt,U.origin,Q.origin,Z),ee=Aje(U.direction,Q.direction,Z,FOt);i.intersectManifoldClosestSilhouette(um(K,ee),n,Ic),L6e(Ic,l,Ic,E),P.push(Tr(Ic)),P.length!==0&&L(zO(P.at(-1),Ic));const _e=(tL(O,Ic)?1:0)|(tL(D,Ic)?2:0);jQ[_e]=1}}P.length>2&&L(zO(P[0],P.at(-1)));const F=POt(rH(jQ)>1?ROt(G6e(P,O),D):[P],i,a);return new Wr({rings:F,spatialReference:a})}function POt(t,e,i){const r=2*_n();return t.map(s=>{const n=[];let a=!1;for(const o of s)e.fromRenderCoords(o,Ic,i),Math.abs(o[0])<r&&Math.abs(o[1])<r?(n.push([null,Ic[1]]),n.push([null,Ic[1]]),a=!0):n.push([Ic[0],Ic[1]]);if(a)for(let o=0;o<n.length;o++){const l=n[o];if(l[0]!=null)continue;const u=n[o+1],d=n.at(o===0?-1:o-1);l[0]=d[0],o++;const f=n.at(o===n.length-1?0:o+1);u[0]=f[0]}return n.push(n[0]),p7(n)||n.reverse(),n})}function ROt(t,e){const i=[];for(const r of t)i.push(...G6e(r,e));return i}function G6e(t,e){const i=[],r=[],s=_n();for(let a=0;a<t.length;a++){const o=t[a],l=a===t.length-1?t[0]:t[a+1],u=pB(o,l,NOt),d=RF(e,u.origin,u.vector,0,Ic);switch(d){case 2:i.push(o);break;case 3:r.push(o);break;case 0:case 1:{const[f,g,v]=d===0?[1,i,r]:[-1,r,i],_=e,x=Fr(I(),Ic,_,f*s),S=Fr(I(),Ic,_,f*-s);g.push(o),g.push(x),v.push(S)}}}const n=[];return i.length&&n.push(i),r.length&&n.push(r),n}function IOt(t){const{renderCoordsHelper:e,state:{camera:i}}=t,{center:r,eye:s}=i,n=Math.abs(e.getAltitude(r)),a=Math.abs(Math.PI/2-G0(e,r,s));return O$(lTe,e.referenceEllipsoid.radius+n),hde(lTe,a,i.distance,i.fovY)}const DOt={minCurvature:zt(5),maxCurvature:zt(50),minSamples:1,maxSamples:6},kOt=Ye(1,0,0),LOt=Ye(0,1,0),FOt=I(),zOt=I(),Ic=I(),lTe=Is(),NOt=s_(),jQ=li(),VOt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:$Ot,eyeForCenterWithHeadingTilt:COt,eyeTiltToLookAtTilt:EOt,headingTiltToDirectionUp:q6e,lookAtTiltToEyeTilt:MOt,toArea:OOt,toExtent:AOt},Symbol.toStringTag,{value:"Module"}));function V1({state:t}){return t.isGlobal?VOt:cOt}function kF(t,e,i,r,s){return V1(t).directionToHeadingTilt(e,i,r,s)}const ps={OPAQUE:"opaque-color",TRANSPARENT:"transparent-color",COMPOSITE:"composite-color",FINAL:"final-color"},wt={SSAO:"ssao",LASERLINES:"laserline-color",ANTIALIASING:"aa-color",HIGHLIGHTS:"highlight-color",MAGNIFIER:"magnifier-color",OCCLUDED:"occluded-color",VIEWSHED:"viewshed-color",CUTFILL_DEPTH:"cutfill-depth",CUTFILL_COLOR:"cutfill-color",OPAQUE_TERRAIN:"opaque-terrain-color",OPAQUE_ENVIRONMENT:"opaque-environment-color",TRANSPARENT_ENVIRONMENT:"transparent-environment-color",FOCUSAREA:"focusarea",FOCUSAREA_COLOR:"focusarea-color"};function qO(t,e,i){const r=t.renderSpatialReference,s=kF(t,e.eye,e.viewForward,e.up,jOt);let n=t.spatialReference;return Co(e.eye,r,WC,n)||(n=Me.WGS84,Co(e.eye,r,WC,n)),i==null?i=new tc(new Ue(WC,n),s.heading,s.tilt,to(e.fov)):(i.position.x=WC[0],i.position.y=WC[1],i.position.z=WC[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=to(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function Sg(t,e){if(!e)return null;const i=t.renderSpatialReference,r=V1(t).headingTiltToDirectionUp,s=I();if(!Jc(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);he(n.direction,n.direction,t.state.camera.distance),$e(n.direction,n.direction,s);const a=R$(t,s,n.direction,n.up);return a.fov=zt(e.fov),a.row=e.layout.row,a.rows=e.layout.rows,a.column=e.layout.column,a.columns=e.layout.columns,a}const WC=I(),jOt={heading:0,tilt:0};function yG(t){return t.type==="point"}let UOt=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function H6e(t){return"array"in t}function Lg(t,e,i="ground"){if(yG(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(H6e(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}function iL(t,e){return t!=null&&(e==null||(e===2?!t.isGeographic||t.isWGS84||t.wkid===4490:t.isWebMercator||t.isWGS84||t.wkid===4490||t.wkid===104971||t.wkid===104905||t.wkid===104903))}const wde=()=>re.getLogger("esri.views.3d.support.cameraUtils"),W6e=96*39.37,sae=1,BOt=8,qOt=5,Z6e=1,q4=I();function I$(t){return t.spatialReference??Me.WGS84}function GOt(t,e,i,r,s){return V1(t).headingTiltToDirectionUp(e,i,r,s)}function rL(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper;return e/=r,i.width/2/i.pixelRatio/(W6e/e)/Math.tan(i.fovX/2)}function a$(t,e){const{camera:i}=t.state,{unitInMeters:r}=t.renderCoordsHelper,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;return W6e/(n/s)*r}function Y6e(t,e,i,r){const s=r.levelAtScale(e),n=J6e(kF(t,i.eye,i.viewForward,i.up).tilt),a=Math.max(s-n,0);return r.scaleAtLevel(a)}function cTe(t,e,i){const r=i.levelAtScale(t),s=J6e(e);return i.scaleAtLevel(r+s)}function J6e(t){return 2*((t>90?180-t:t)/90)**2}function HOt(t,e,i=0){const r=t.basemapTerrain?.tilingScheme;if(!r)return 0;const s=xr(t.spatialReference).radius,n=t.state.viewingMode===2?e.eye[2]:Ve(e.eye)-s;return Y6e(t,a$(t,Math.abs(n-i)),e,r)}function WOt(t,e,i=0){const r=Sg(t,e);return r?HOt(t,r,i):0}const ZOt=1,YOt=100;function JOt(t,e,i,r){if(e===0)return 0;const s=t.state.contentCamera,n=Bi(s.eye,i),a=t.basemapTerrain?.tilingScheme;if(!a)return wde().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),n;let o=n;const l=kF(t,s.eye,s.viewForward,s.up),u=l.tilt>90;if(t.state.isLocal){const _=(rL(t,cTe(e,l.tilt,a))-Math.abs(s.eye[2]-r[2]))/Math.cos(zt(l.tilt));return o=u?o-_:o+_,o}let d=1/0,f=0,g=sL(t,l.heading,l.tilt,i,n,1);if(!g)return o;const v=Ve(r);for(;d>ZOt&&f<YOt;){const _=Ve(g.eye),x=u?180-g.tilt:g.tilt,S=zt(x),T=Math.sin(S)*_,M=Math.cos(S)*_,E=rL(t,cTe(e,g.tilt,a)),P=u?v-E:v+E,O=Qh(T/P),D=Math.cos(O)*P-M,L=Bi(g.eye,i);o=u?L-D:L+D,g=sL(t,l.heading,l.tilt,i,o,1);const F=Sde(t,g,to(s.fov));if(!g||!F)return o;const j=WOt(t,F,v-xr(t.spatialReference).radius);d=Math.abs(e-j),++f}return o}async function QOt(t,e,i,r,s,n){return _H(t,e,rL(t,i),r,s,n)}function XOt(t,e,i,r,s,n){return Sde(t,sL(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function _H(t,e,i,r,s,n){const a=await X6e(t,r.heading,r.tilt,e,i,s,n);return ct(n),uUe(t,a,r.fov,n)}function Q6e(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,q4,t.spatialReference)&&t.elevationProvider&&(Lg(t.elevationProvider,q4)??0)>q4[2]-Z6e)}async function KOt(t,e,i){if(Q6e(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,q4,s))return!1;const[a,o,l]=q4,u=await r.queryElevation(a,o,l,s,"ground",i)??0;return ct(i),u>l-Z6e}async function ePt(t,e,i){const r=I();if(e==null)return me(r,t.state.camera.center);if(e instanceof Ue){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:a}=t,o=e.spatialReference;if(await lG(e,r,s,0,{signal:i}),ct(i),e.z==null&&n!=null&&a!=null){const l=await a.queryElevation(e.x,e.y,e.z??0,o,"ground",i);ct(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return me(r,e)}function tPt(t,e){const i=I();if(e==null)return me(i,t.state.camera.center);if(e instanceof Ue){if(!Jc(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Lg(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return me(i,e)}function sL(t,e,i,r,s,n){return K6e(t,e,i,r instanceof Ue?r:null,tPt(t,r),s,n)}async function X6e(t,e,i,r,s,n,a){const o=r instanceof Ue?r:null,l=await ePt(t,r,a);return ct(a),eUe(t,e,i,o,l,s,n,a)}function K6e(t,e,i,r,s,n,a){if(s==null||!r&&(r=new Ue({spatialReference:I$(t)}),!P$(s,t.renderSpatialReference,r)))return null;const o=tUe(t,e,i,s,n,a);if(iUe(t,i,a)&&Q6e(t,o.eye)){const{tilt:l,mode:u}=rUe(t,i,s,n);return K6e(t,e,l,r,s,n,u)}return sUe(o,s)}async function eUe(t,e,i,r,s,n,a,o){r||(r=new Ue({spatialReference:I$(t)}),await d6e(s,t.renderSpatialReference,r,{signal:o})||(r=null)),ct(o);const l=tUe(t,e,i,s,n,a);if(iUe(t,i,a)&&await KOt(t,l.eye,o)){ct(o);const{tilt:u,mode:d}=rUe(t,i,s,n);return eUe(t,e,u,r,s,n,d,o)}return sUe(l,s)}function tUe(t,e,i,r,s,n){const a=sPt(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,V1(t).eyeForCenterWithHeadingTilt)(r,s,a.heading,a.tilt)}function iUe(t,e,i){const r=t.map.ground.navigationConstraint;return i===1&&t.state.isGlobal&&e>0&&(r==null||r.type==="stay-above")}function rUe(t,e,i,r){const s=cUe(t,i,r,aPt(t,r,e,i));return{tilt:s,mode:e-s<1?0:1}}function sUe(t,e){return{...t,center:Tr(e)}}function nUe(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&iL(s,1)||i.isLocal&&r.equals(s)}function aUe(t,e){let i,r,s;if(t.state.isGlobal){const d=new Ue(e.xmin,e.ymin,e.spatialReference),f=new Ue(e.xmax,e.ymax,e.spatialReference),g=e.spatialReference.isGeographic?CFe:vvt;i=new Ue({x:g.center(d.x,f.x),y:(f.y+d.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const v=xr(e.spatialReference),_=xOt(i,d,f);r=_.lon,s=_.lat,g.diff(d.x,f.x)>g.range/2&&(r+=v.halfCircumference),r=Math.min(r,v.halfCircumference),s=Math.min(s,v.halfCircumference)}else{const d=t.renderSpatialReference??e.spatialReference;d.equals(e.spatialReference)||(e=Pa(e,d)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const f=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new Ue({x:e.xmin+.5*r,y:e.ymin+.5*s,z:f,spatialReference:d})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,a=t.state.camera,o=1/Math.tan(a.fovX/2),l=1/Math.tan(a.fovY/2),u=1/Math.tan(a.fov/2);return{center:i,distance:Math.max(.5*r*o,.5*s*l,.5*n*u)/sae}}async function oUe(t,e,i,r,s,n){const a=nUe(t,e)?e:await z0(e,t.spatialReference,{signal:n});ct(n);const{center:o,distance:l}=aUe(t,a),u=await X6e(t,i,r,o,l,s,n);return ct(n),uUe(t,u,t.camera.fov,n)}function bB(t,e,i,r,s,n){let a;try{a=nUe(t,e)?e:Pa(e,t.spatialReference)}catch{return null}const{center:o,distance:l}=aUe(t,a),u=sL(t,i,r,o,l,s);return u==null?null:Sde(t,u,t.camera.fov,n)}function lUe(t,e,i){const r=t.renderSpatialReference,s=new Ue({spatialReference:I$(t)});if(!P$(i,r,s))return null;const n=Math.tan(e.fovX/2),a=Math.tan(e.fovY/2),o=CF(e.eye,i),l=2*o*n*sae,u=2*o*a*sae;return V1(t).toExtent(t,s,l,u)}function iPt(t,e){return V1(t).toArea(t,e)}function rPt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>BOt)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return Bi(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>qOt}function sPt(t,e,i,r,s,n){let a=0;return n===1&&rPt(t,r,s)?(e=0,a=nPt(t,s,i,r)):a=xde(t,r,s,i),a=t.state.constraints.clampTilt(s,a),{heading:e,tilt:i=cUe(t,r,s,a)}}const vG=.7;function nPt(t,e,i,r){const s=xde(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const a=n.min*(1-vG)+n.max*vG;return Math.min(s,a)}function aPt(t,e,i,r){let s=xde(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-vG)+s*vG}function cUe(t,e,i,r){return V1(t).lookAtTiltToEyeTilt(r,e,i)}function xde(t,e,i,r){return V1(t).eyeTiltToLookAtTilt(r,e,i)}function Sde(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new Ue({spatialReference:I$(t)});return P$(e.eye,s,n)?(r??=new tc,r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function uUe(t,e,i,r){const s=t.renderSpatialReference,n=new Ue({spatialReference:I$(t)});return await d6e(e.eye,s,n,{signal:r}),ct(r),new tc(n,e.heading,e.tilt,i)}function oPt(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(e);wde().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function hUe(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(e);wde().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}let nL=class extends Ju{queryElevation(e){const i=this.projectIfRequired(e,this.spatialReference);if(!i)return null;switch(e.type){case"point":return lPt(e,i,this);case"polyline":return cPt(e,i,this);case"multipoint":return uPt(e,i,this);default:return null}}projectIfRequired(e,i){if(e==null)return null;const r=e.spatialReference;if(r.equals(i))return e;const s=eF(e,i);return s||re.getLogger(this).error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${i.wkid})`),s}};function lPt(t,e,i){return t.hasZ=!0,t.z=i.elevationAt(e.x,e.y),t}function cPt(t,e,i){Ag.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],a=e.paths[s];for(let o=0;o<n.length;o++){const l=n[o],u=a[o];Ag.x=u[0],Ag.y=u[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Ag.x,Ag.y)}}return t.hasZ=!0,t}function uPt(t,e,i){Ag.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],a=e.points[s];Ag.x=a[0],Ag.y=a[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Ag.x,Ag.y)}return t.hasZ=!0,t}nL=c([R("esri.layers.support.ElevationSampler")],nL);const Ag=new Ue,hPt=12;var ya;let Df=(ya=class{constructor(e){const i=ya.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=A1(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((u,d)=>(d.level<u.minLod.level&&(u.minLod=d),u.max=Math.max(u.max,d.level),u),{minLod:r.lods[0],max:-1/0}),n=s.minLod,a=2**n.level;let o=n.resolution*a,l=n.scale*a;this.levels=new Array(s.max+1);for(let u=0;u<this.levels.length;u++)this.levels[u]={resolution:o,scale:l,tileSize:[o*r.size[0],o*r.size[1]]},o/=2,l/=2}clone(){return new ya(this.toTileInfo())}toTileInfo(){return new _o({dpi:this.dpi,origin:new Ue({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new ba({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],a=n.tileSize[0],o=n.tileSize[1];s[0]=this.origin[0]+r*a,s[2]=this.origin[0]+(r+1)*a,s[3]=this.origin[1]-i*o,s[1]=this.origin[1]-(i+1)*o}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=ibe(e[0]),i[1]=cte(e[1]),i[2]=ibe(e[2]),i[3]=cte(e[3])):this._isGCS&&(i[0]=zt(e[0]),i[1]=zt(e[1]),i[2]=zt(e[2]),i[3]=zt(e[3]))}getExtentGeometry(e,i,r,s=new It){return this.getExtent(e,i,r,Lm),s.spatialReference=this.spatialReference,s.xmin=Lm[0],s.ymin=Lm[1],s.xmax=Lm[2],s.ymax=Lm[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(ya.checkUnsupported(e))return!1;const r=new ya(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let a=.5*n;return!yl(r.origin[0],this.origin[0],a)||!yl(r.origin[1],this.origin[1],a)?!1:(a=.5*n/2**s/this.pixelSize*hPt,yl(n,r.levels[s].resolution,a))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;ya.computeRowColExtent(e,n,this.origin,Lm);let a=Lm[1],o=Lm[3],l=Lm[0],u=Lm[2];const d=u-l,f=o-a;if(d*f>r){const g=Math.floor(Math.sqrt(r));f>g&&(a=a+Math.floor(.5*f)-Math.floor(.5*g),o=a+g),d>g&&(l=l+Math.floor(.5*d)-Math.floor(.5*g),u=l+g)}for(let g=a;g<o;g++)for(let v=l;v<u;v++)s.push([0,g,v]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-o*n[1],i[2]=this.origin[0]+u*n[0],i[3]=this.origin[1]-a*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!jle(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new q("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?Tde():e.lods.length<1?new q("tilingscheme:generic","Tiling scheme must have at least one level"):ya.isPowerOfTwo(e)?ya.hasGapInLevels(e)?new q("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):ya.tileSizeSupported(e)?ya.hasOriginPerLODs(e)?new q("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new q("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new q("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=Yr(i),a=1.2*Math.max(r,s),o=256,l=a/o,u=l*n*(96/.0254),d=new ya(new _o({size:[o,o],origin:new Ue({x:e[0]-.5*(a-r),y:e[3]+.5*(a-s)}),lods:[new ba({level:0,resolution:l,scale:u})],spatialReference:i}));return d.ensureMaxLod(20),d}static makeWebMercatorAuxiliarySphere(e){const i=new ya(ya.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new ya(new _o({size:[i,i],origin:new Ue({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new ba({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}},ya.WebMercatorAuxiliarySphereTileInfo=new _o({size:[256,256],origin:new Ue({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Me.WebMercator}),spatialReference:Me.WebMercator,lods:[new ba({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),ya.WebMercatorAuxiliarySphere=ya.makeWebMercatorAuxiliarySphere(19),ya);function Tde(){return new q("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}const Lm=fi(),mE=64,fk=512,dPt=2.5,$de=srt(Qee/10),dUe=2,pUe=fi();Df.WebMercatorAuxiliarySphere.getExtent(0,0,0,pUe);const pPt=fi([-180,-90,180,90]),fPt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",mPt="Surface extent is too large for tile resolution at level 0.",Zn=4;let gE=class extends nL{constructor(e){super(e),this.noDataValue=$de}};c([p({constructOnly:!0})],gE.prototype,"view",void 0),c([p({readOnly:!0})],gE.prototype,"noDataValue",void 0),gE=c([R("esri.views.support.GroundViewElevationSampler")],gE);let O3=class extends gE{initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get demResolution(){return this.view.basemapTerrain.demResolution}get extent(){const e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;const i=iF(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){return this.view.basemapTerrain?.spatialReference??Me.WGS84}elevationAt(e,i){if(this.extent==null||!hl(this.extent,e,i)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return re.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,i,0,this.spatialReference,"ground")??this.noDataValue}};c([p({readOnly:!0})],O3.prototype,"demResolution",null),c([p({readOnly:!0})],O3.prototype,"extent",null),c([p()],O3.prototype,"spatialReference",null),O3=c([R("esri.views.support.GroundElevationSampler")],O3);let P3=class extends gE{get demResolution(){return this.view.basemapTerrain.demResolution}get extent(){return this.view.map.allLayers.reduce((e,i)=>i.type!=="integrated-mesh"&&i.type!=="integrated-mesh-3dtiles"||!i.fullExtent?e:e?e.union(i.fullExtent):i.fullExtent.clone(),null)}get spatialReference(){return this.view.spatialReference}elevationAt(e,i){return this.extent!=null&&hl(this.extent,e,i)?this.view.elevationProvider.getElevation(e,i,0,this.spatialReference,"im")??this.noDataValue:this.noDataValue}};c([p({readOnly:!0})],P3.prototype,"demResolution",null),c([p({readOnly:!0})],P3.prototype,"extent",null),c([p()],P3.prototype,"spatialReference",null),P3=c([R("esri.views.support.IntegratedMeshElevationSampler")],P3);let sg=class extends be{constructor(e){super(e),this.view=null,this.layerViews=new ke}initialize(){this.addHandles(vs(()=>this.view?.map?.ground,async e=>e.load())),this.view.type==="3d"&&this.addHandles([X(()=>this.view.map?.basemap,()=>this._groundLayersChanged(),{initial:!0}),X(()=>this.view.map?.basemap?.groundLayers,e=>{this._groundLayersChanged(),e?.on("after-changes",()=>this._groundLayersChanged())},{initial:!0}),X(()=>this.view.basemapView?.groundLayerViews,e=>{this._groundLayersChanged(),e?.on("after-changes",()=>this._groundLayersChanged())},{initial:!0}),vs(()=>this.view.type==="3d"&&(this.view?.basemapTerrain??!1),async()=>{this._groundLayersChanged()})])}_groundLayersChanged(){const{view:e}=this;if(e!=null&&e.type==="3d"){const i=e.basemapTerrain;if(i){const r=e.map?.basemap?.groundLayers.some(s=>!!e.basemapView?.groundLayerViews.find(n=>n.layer===s)&&"replacesTerrain"in s&&s.replacesTerrain);i.enable(!r)}}}get ground(){return this.view?.map?.ground}destroy(){this._set("view",null),this.layerViews.destroyAll()}get elevationSampler(){return this.view.type==="3d"?new O3({view:this.view}):null}get integratedMeshElevationSampler(){return this.view?new P3({view:this.view}):null}get extent(){const{view:e}=this;return e?.ready?lUe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(({updating:e})=>e)}get suspended(){return this.view?.suspended??!0}};c([p({readOnly:!0})],sg.prototype,"elevationSampler",null),c([p({readOnly:!0})],sg.prototype,"integratedMeshElevationSampler",null),c([p({readOnly:!0})],sg.prototype,"extent",null),c([p({type:Boolean,readOnly:!0})],sg.prototype,"updating",null),c([p({constructOnly:!0})],sg.prototype,"view",void 0),c([p({type:ke,readOnly:!0})],sg.prototype,"layerViews",void 0),c([p({readOnly:!0})],sg.prototype,"suspended",null),sg=c([R("esri.views.GroundView")],sg);const gPt=sg;let Mh=class extends w$(gPt){constructor(e){super(e)}initialize(){super.initialize(),this.addHandles(vs(()=>this._terrainSurface,e=>e.on("elevation-change",i=>this._elevationChange(i)))),this.addHandles(vs(()=>this._integratedMeshGroundLayerView,e=>{this.removeHandles(uTe),e&&this.addHandles(e.elevationProvider.on("elevation-change",i=>this._elevationChange(i)),uTe)}))}_elevationChange(e){this.emit("elevation-change",e)}get _integratedMeshGroundLayerView(){const e=this.ground?.integratedMeshGround;if(e)return this.view.basemapView?.groundLayerViews.find(i=>i.layer===e)}get _terrainSurface(){return this.view.basemapTerrain}get _usingTerrain(){return this._terrainSurface?.enabled??!1}get _usingIntegratedMesh(){return this._integratedMeshGroundLayerView?.visible??!1}get spatialReference(){return this._terrainSurface?.spatialReference}intersect(e,i,r,s){this._source?.intersect(e,i,r,s)}get updating(){return!this.suspended&&((this._source?.updating??!1)||this.layerViews.some(({updating:e})=>e))}get elevationQueryCache(){return this._usingTerrain?this._terrainSurface?.elevationQueryCache:null}get extentAABR(){return this._terrainSurface?.extent}get suspended(){return this._source?.suspended??!1}get ready(){return this._source?.ready??!0}updateOverlayParameters(){this._terrainSurface?.updateOverlayParameters()}get _source(){return this._usingTerrain?this._terrainSurface:this._usingIntegratedMesh?this._integratedMeshGroundLayerView:null}requestRender(e){this.view.stage.renderView?.requestRender(e)}};c([p({readOnly:!0})],Mh.prototype,"_integratedMeshGroundLayerView",null),c([p({readOnly:!0})],Mh.prototype,"_terrainSurface",null),c([p({readOnly:!0})],Mh.prototype,"_usingTerrain",null),c([p({readOnly:!0})],Mh.prototype,"_usingIntegratedMesh",null),c([p({readOnly:!0})],Mh.prototype,"spatialReference",null),c([p({type:Boolean,readOnly:!0})],Mh.prototype,"updating",null),c([p({readOnly:!0})],Mh.prototype,"elevationQueryCache",null),c([p({readOnly:!0})],Mh.prototype,"extentAABR",null),c([p({readOnly:!0})],Mh.prototype,"suspended",null),c([p({readOnly:!0})],Mh.prototype,"ready",null),Mh=c([R("esri.views.3d.GroundView3D")],Mh);const uTe=Symbol("integratedMeshHandleKey"),SI=()=>W(()=>import("./TileLayerView3D-D-Yn8w-1.js"),__vite__mapDeps([278,279,280,281,282,283,181,182,183,184,185,179,180])),hTe=()=>W(()=>import("./ElevationLayerView3D-DfdnfO2y.js"),__vite__mapDeps([284,123,279,280,179])),dTe={"base-dynamic":()=>W(()=>import("./BaseDynamicLayerView3D-C2vu_sAf.js"),__vite__mapDeps([285,286,287,288,289,290,279,179,180])),"base-elevation":hTe,"base-tile":SI,"bing-maps":SI,"building-scene":()=>W(()=>import("./BuildingSceneLayerView3D-pDLiHbgO.js"),__vite__mapDeps([291,292,293,294,295,296,194,77,185,297,18,298,299,300,301,302,303,304,305,15,89,88,306,307,186,308,309,13,14,188,16,17,19,1,2,3,4,20,21,310,279,179])),catalog:()=>W(()=>import("./CatalogLayerView3D-BsVtQ0jz.js"),__vite__mapDeps([311,279,199,179])),"catalog-dynamic-group":()=>W(()=>import("./CatalogDynamicGroupLayerView3D-BgFbDwCt.js"),__vite__mapDeps([312,279,201,179])),"catalog-footprint":()=>W(()=>import("./CatalogFootprintLayerView3D-HOsxDQbn.js"),__vite__mapDeps([313,314,315,188,190,14,21,306,307,186,102,316,112,113,317,318,140,319,305,15,185,320,183,16,17,18,13,19,1,2,3,4,20,189,191,11,12,153,279,37,35,36,321,193,70,192,194,179,180,203])),csv:()=>W(()=>import("./CSVLayerView3D-BMAJgxpT.js"),__vite__mapDeps([322,314,315,188,190,14,21,306,307,186,102,316,112,113,317,318,140,319,305,15,185,320,183,16,17,18,13,19,1,2,3,4,20,189,191,11,12,153,279,37,35,36,321,193,70,192,194,179,180])),dimension:()=>W(()=>import("./DimensionLayerView3D-DIcFi97c.js"),__vite__mapDeps([323,279,324,179])),elevation:hTe,feature:()=>W(()=>import("./FeatureLayerView3D-C_D5GJec.js"),__vite__mapDeps([325,314,315,188,190,14,21,306,307,186,102,316,112,113,317,318,140,319,305,15,185,320,183,16,17,18,13,19,1,2,3,4,20,189,191,11,12,153,279,37,35,36,321,193,70,192,194,179,180])),"gaussian-splat":()=>W(()=>import("./GaussianSplatLayerView3D-DX-ZPU6z.js"),__vite__mapDeps([326,327,279,179])),geojson:()=>W(()=>import("./GeoJSONLayerView3D-GhHo_V17.js"),__vite__mapDeps([328,314,315,188,190,14,21,306,307,186,102,316,112,113,317,318,140,319,305,15,185,320,183,16,17,18,13,19,1,2,3,4,20,189,191,11,12,153,279,37,35,36,321,193,70,192,194,179,180])),graphics:()=>W(()=>import("./GraphicsLayerView3D-Ci7VUdAs.js"),__vite__mapDeps([329,279,317,330,319,305,15,185,320,307,179,186])),group:()=>W(()=>import("./GroupLayerView3D-8yttFWTW.js"),__vite__mapDeps([331,207,179])),imagery:()=>W(()=>import("./ImageryLayerView3D-ClBB95Jk.js"),__vite__mapDeps([332,286,287,288,289,290,279,179,180,283,181,86,333,210,101,102,334,211,141,188,84,185])),"integrated-mesh":()=>W(()=>import("./IntegratedMeshLayerView3D-CPBLhhvE.js"),__vite__mapDeps([335,298,299,300,301,302,296,194,77,303,304,305,15,185,89,88,306,307,186,279,179])),"integrated-mesh-3dtiles":()=>W(()=>import("./IntegratedMesh3DTilesLayerView3D-DItK19IL.js"),__vite__mapDeps([336,299,300,304,89,279,303,179])),"line-of-sight":()=>W(()=>import("./LineOfSightLayerView3D-BqCeUoSC.js"),__vite__mapDeps([337,279,324,179])),"map-image":()=>W(()=>import("./MapImageLayerView3D-Dy-N83Ed.js"),__vite__mapDeps([338,286,287,288,289,290,279,179,180,282,283,181,182,183,184,185,222,223,188])),media:()=>W(()=>import("./MediaLayerView3D-CSCLh6h8.js").then(t=>t.M),__vite__mapDeps([339,226,67,279,340,341,342,343,344,288,289,290,179,229,186])),"ogc-feature":()=>W(()=>import("./OGCFeatureLayerView3D-CiT5oFCI.js"),__vite__mapDeps([345,314,315,188,190,14,21,306,307,186,102,316,112,113,317,318,140,319,305,15,185,320,183,16,17,18,13,19,1,2,3,4,20,189,191,11,12,153,279,37,35,36,321,193,70,192,194,179,180,231])),"open-street-map":SI,"oriented-imagery":()=>W(()=>import("./FeatureLayerView3D-C_D5GJec.js"),__vite__mapDeps([325,314,315,188,190,14,21,306,307,186,102,316,112,113,317,318,140,319,305,15,185,320,183,16,17,18,13,19,1,2,3,4,20,189,191,11,12,153,279,37,35,36,321,193,70,192,194,179,180])),"point-cloud":()=>W(()=>import("./PointCloudLayerView3D-CvREyq_M.js"),__vite__mapDeps([346,300,16,17,18,13,14,19,1,2,3,4,20,21,279,310,296,194,77,75,76,307,347,185,179,186])),viewshed:()=>W(()=>import("./ViewshedLayerView3D-hJCOpwrX.js"),__vite__mapDeps([348,279,324,179])),voxel:()=>W(()=>import("./VoxelLayerView3D-BwIZ5W6r.js"),__vite__mapDeps([349,279,350,347,185,179])),route:()=>W(()=>import("./RouteLayerView3D-CPRucA82.js"),__vite__mapDeps([351,233,234,279,330,319,305,15,185,320,307,321,179,186])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?W(()=>import("./SceneLayerView3D-Dqe0c3gM.js"),__vite__mapDeps([352,18,183,298,299,300,301,302,296,194,77,303,304,305,15,185,89,88,306,307,186,279,353,309,13,14,188,179,308,16,17,19,1,2,3,4,20,21,310,347])):W(()=>import("./SceneLayerGraphicsView3D-DtuYSgu3.js"),__vite__mapDeps([354,301,300,302,296,194,77,303,279,318,140,319,305,15,185,320,183,16,17,18,13,14,19,1,2,3,4,20,21,189,191,307,353,309,188,179,306,347,186])),stream:()=>W(()=>import("./StreamLayerView3D-D9Riprhz.js"),__vite__mapDeps([355,315,188,190,14,21,306,307,186,102,316,112,113,317,318,140,319,305,15,185,320,183,16,17,18,13,19,1,2,3,4,20,189,191,11,12,153,279,71,72,52,73,37,35,36,321,179,236])),tile:SI,"imagery-tile":()=>W(()=>import("./ImageryTileLayerView3D-DPtDIdnZ.js"),__vite__mapDeps([356,84,279,280,86,333,210,101,102,287,334,215,217,141,188,214,185,179,180])),"vector-tile":()=>W(()=>import("./VectorTileLayerView3D-CmCkXO2U.js"),__vite__mapDeps([357,239,57,36,54,155,160,146,147,95,279,280,179])),wcs:()=>W(()=>import("./ImageryTileLayerView3D-DPtDIdnZ.js"),__vite__mapDeps([356,84,279,280,86,333,210,101,102,287,334,215,217,141,188,214,185,179,180])),"web-tile":SI,wfs:()=>W(()=>import("./WFSLayerView3D-XWsNChNg.js"),__vite__mapDeps([358,314,315,188,190,14,21,306,307,186,102,316,112,113,317,318,140,319,305,15,185,320,183,16,17,18,13,19,1,2,3,4,20,189,191,11,12,153,279,37,35,36,321,193,70,192,194,179,180])),wms:()=>W(()=>import("./WMSLayerView3D-BNEWB7a_.js"),__vite__mapDeps([359,286,287,288,289,290,279,179,180,244,245,188])),wmts:()=>W(()=>import("./WMTSLayerView3D--o5he7vv.js"),__vite__mapDeps([360,279,280,281,179,180])),"geo-rss":null,kml:null,"knowledge-graph-sublayer":null,"knowledge-graph":null,"link-chart":null,"map-notes":null,parquet:null,"subtype-group":null,unknown:null,unsupported:null,video:null};function yPt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new q(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const pTe={hasLayerViewModule:t=>dTe[t.type]!=null,importLayerView:t=>{const e=dTe[t.type];if(e==null)throw yPt(t);return e(t)}},vPt={"area-measurement":()=>W(()=>import("./AreaMeasurementAnalysisView3D-bCRAjPp_.js"),__vite__mapDeps([361,362,248,363,364,365,334,366,289,340,341,342,367,368,290,369,370,371,372,373,374,375,376,377,378,379,380,381,316,343,344,382])),dimension:()=>W(()=>import("./DimensionAnalysisView3D-c8qu3ZIM.js"),__vite__mapDeps([383,362,248,367,365,368,384,364,334,366,289,377,378,340,341,342,385,370,371,372,373,374,375,376,386,288,290,369,381,316,343,344,382,380,379,387])),"direct-line-measurement":()=>W(()=>import("./DirectLineMeasurementAnalysisView3D-BWVW06gL.js"),__vite__mapDeps([388,362,248,364,365,334,366,289,367,368,370,371,372,373,374,375,376,369,363,377,378,340,341,342,380,381,316,343,344])),"elevation-profile":()=>W(()=>import("./ElevationProfileAnalysisView3D-BCyIyrn1.js"),__vite__mapDeps([389,362,248,249,250,251,252,253,254,255,256,66,257,258,259,260,261,262,390,369,391,372,365,373,334,392,393,29])),"line-of-sight":()=>W(()=>import("./LineOfSightAnalysisView3D-BYB1LDtI.js"),__vite__mapDeps([394,362,248,395,364,365,334,366,289,396,397,373,380,378,340,341,342,374])),slice:()=>W(()=>import("./SliceAnalysisView3D-C6vMLYK5.js"),__vite__mapDeps([398,362,248,399,292,293,294,295,296,194,77,185,400,401,364,365,334,366,289,290,385,402,288,377,378,340,341,342,380,379,369])),viewshed:()=>W(()=>import("./ViewshedAnalysisView3D-D43jZsVu.js"),__vite__mapDeps([403,395,362,248,364,365,334,366,289,377,378,340,341,342,404,405,390,369,401,371,372,373,380,379,374])),"volume-measurement":()=>W(()=>import("./VolumeMeasurementAnalysisView3D-D3X5xhUY.js"),__vite__mapDeps([406,362,248,364,365,334,366,289,407,20,319,393,29,367,368,391,372,373,392,369,400,401,399,290,377,378,340,341,342,408,271,409,410,262,344]))};function _Pt(t){const e=vPt[t.type];if(!e)throw new q("analysis-view-module-import-utils:analysis-not-supported",`Analysis "${t.type}" is not supported`);return e()}let yv=class extends be{constructor(e){super(e),this.collision=new mk,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===2?null:this._get("altitude")||null}set altitude(e){this.mode!==2?this._set("altitude",e):re.getLogger(this).warn("Altitude constraint is ignored in local scenes")}get mode(){return this.state.viewingMode}clampAltitude(e){return this.altitude?Ce(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Ce(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===2?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=UQ)=>(r.min=qo.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?fB([[4e3,qo.max],[1e4,zt(88)],[6e6,zt(88)]]):()=>qo.max;return(i,r=UQ)=>(r.min=qo.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?fB([[4e3,qo.max],[5e4,zt(88)],[6e6,zt(88)],[2e7,qo.min]]):fB([[3e5,qo.max],[3e6,zt(88)],[6e6,zt(88)],[2e7,qo.min]]);return(i,r=UQ)=>(r.min=qo.min,r.max=e(i),r)}};function bPt(t){return{min:-2e5,max:4*t.radius}}c([p()],yv.prototype,"altitude",null),c([p({readOnly:!0})],yv.prototype,"collision",void 0),c([p()],yv.prototype,"distance",void 0),c([p({readOnly:!0})],yv.prototype,"minimumPoiDistance",void 0),c([p()],yv.prototype,"tilt",void 0),c([p({constructOnly:!0})],yv.prototype,"state",void 0),yv=c([R("esri.views.3d.state.Constraints")],yv);const fTe=bPt(Ci),qo={min:zt(.5),max:zt(179.5)},UQ={min:0,max:0};let mk=class extends be{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};c([p({type:Boolean})],mk.prototype,"enabled",void 0),c([p({type:Number})],mk.prototype,"elevationMargin",void 0),mk=c([R("esri.views.3d.state.Constraints.CollisionConstraint")],mk);let yE=class extends E1{constructor(){super(...arguments),this.min=fTe.min,this.max=fTe.max}};c([p({type:Number})],yE.prototype,"min",void 0),c([p({type:Number})],yE.prototype,"max",void 0),yE=c([R("esri.views.3d.constraints.AltitudeConstraint")],yE);let Bv=class extends E1{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};c([p({type:Number,value:1e-8})],Bv.prototype,"near",null),c([wi("near")],Bv.prototype,"castNear",null),c([p({type:Number,value:1e-8})],Bv.prototype,"far",null),c([wi("far")],Bv.prototype,"castFar",null),c([p({type:["auto","manual"]})],Bv.prototype,"mode",void 0),Bv=c([R("esri.views.3d.constraints.ClipDistanceConstraint")],Bv);const nae={min:to(qo.min),max:to(qo.max)};let H2=class extends E1{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Ce(e,nae.min,nae.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};c([p({type:["auto","manual"]})],H2.prototype,"mode",void 0),c([p({type:Number,value:nae.max})],H2.prototype,"max",null),c([wi("max")],H2.prototype,"castMax",null),H2=c([R("esri.views.3d.constraints.TiltConstraint")],H2);let W2=class extends E1{constructor(e){super(e),this.tilt=new H2,this.altitude=new yE,this.clipDistance=new Bv}};c([p({type:H2,nonNullable:!0})],W2.prototype,"tilt",void 0),c([p({type:yE,nonNullable:!0})],W2.prototype,"altitude",void 0),c([p({type:Bv,nonNullable:!0})],W2.prototype,"clipDistance",void 0),W2=c([R("esri.views.3d.constraints.Constraints")],W2);function mTe(t){return zr(t,pE)||XL(t)?{wkid:104971}:zr(t,fE)||KL(t)?{wkid:104903}:Me.WGS84}let TI=class{constructor(e,i,r,s,n,a,o,l,u=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=a,this.cloudHeight=o,this.raymarchingSteps=l,this.median=u}};const Vo={sunny:new TI([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],0),cloudy:new TI([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],2,.6),rainy:new TI([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],2,.4),snowy:new TI([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],1,.65),foggy:new TI([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],0)};Vo.default=Vo.sunny;function Iu(){return new Float32Array(3)}function aae(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function pr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function fUe(){return Iu()}function mUe(){return pr(1,1,1)}function gUe(){return pr(1,0,0)}function yUe(){return pr(0,1,0)}function vUe(){return pr(0,0,1)}const wPt=fUe(),xPt=mUe(),SPt=gUe(),TPt=yUe(),$Pt=vUe();Object.freeze(Object.defineProperty({__proto__:null,ONES:xPt,UNIT_X:SPt,UNIT_Y:TPt,UNIT_Z:$Pt,ZEROS:wPt,clone:aae,create:Iu,fromValues:pr,ones:mUe,unitX:gUe,unitY:yUe,unitZ:vUe,zeros:fUe},Symbol.toStringTag,{value:"Module"}));const Qd=ie("esri-mobile")?64:128,CPt=Qd/128,wf=Math.ceil(Math.sqrt(Qd)),T0=(Qd+2)*wf,MPt=1e5,KV=128,EPt=T0/1560,A=(t,...e)=>{let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i};function we(t,e,i=""){return t?e:i}A.int=t=>Math.round(t).toString(),A.float=t=>t.toPrecision(8);function no(t,e=!0){t.attributes.add("position","vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.main.add(A`
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?A`uv = position * 0.5 + vec2(0.5);`:""}
  `)}let Ki=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={0:null,1:null,2:null},s)switch(r){case void 0:break;case 0:this.bind[0]=s;break;case 1:this.bind[1]=s;break;case 2:this.bind[2]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},GO=class extends Ki{constructor(e,i){super(e,"bool",1,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},rc=class extends Ki{constructor(e,i,r){super(e,"vec2",1,(s,n,a)=>s.setUniform2fv(e,i(n,a),r))}},_t=class extends Ki{constructor(e,i,r){super(e,"float",1,(s,n,a)=>s.setUniform1f(e,i(n,a),r))}},_m=class extends Ki{constructor(e,i,r){super(e,"mat3",1,(s,n,a)=>s.setUniformMatrix3fv(e,i(n,a),r))}},Gt=class extends Ki{constructor(e,i){super(e,"sampler2D",1,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function LF(t){t.code.add(A`vec2 sphereIntersect(vec3 start, vec3 dir, float distance) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * distance;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`)}let APt=class{};const $r=APt,zyi=new $r,Cde=()=>re.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let _Ue=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},Gi=class extends _Ue{constructor(){super(...arguments),this.vertex=new gTe,this.fragment=new gTe,this.attributes=new IPt,this.varyings=new DPt,this.extensions=new kPt,this.outputs=new LPt}get fragmentUniforms(){return this.fragment.uniforms.entries}get attributeNames(){return this.attributes.names}get builder(){return this}generate(e,i=!1){const r=this.extensions.generateSource(e),s=this.attributes.generateSource(e),n=this.varyings.generateSource(e),a=e==="vertex"?this.vertex:this.fragment,o=a.uniforms.generateSource(),l=a.code.generateSource(),u=a.main.generateSource(i),d=e==="vertex"?NPt:zPt,f=a.constants.generateSource(),g=this.outputs.generateSource(e);return`#version 300 es
${r.join(`
`)}
${d}
${f.join(`
`)}
${o.join(`
`)}
${s.join(`
`)}
${n.join(`
`)}
${g.join(`
`)}
${l.join(`
`)}
${u.join(`
`)}`}generateBind(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const a=n.bind[0];a&&i.set(n.name,a)}),this.fragment.uniforms.entries.forEach(n=>{const a=n.bind[0];a&&i.set(n.name,a)});const r=Array.from(i.values()),s=r.length;return n=>{for(let a=0;a<s;++a)r[a](e,n)}}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const a=n.bind[1];a&&i.set(n.name,a)}),this.fragment.uniforms.entries.forEach(n=>{const a=n.bind[1];a&&i.set(n.name,a)});const r=Array.from(i.values()),s=r.length;return(n,a)=>{for(let o=0;o<s;++o)r[o](e,n,a)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const a=n.bind[2];a&&i.set(n.name,a)}),this.fragment.uniforms.entries.forEach(n=>{const a=n.bind[2];a&&i.set(n.name,a)});const r=Array.from(i.values()),s=r.length;return(n,a,o)=>{for(let l=0;l<s;++l)r[l](e,o,n,a)}}},OPt=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new q("shaderbuilder:duplicate-uniform",`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Cde().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(({name:e,arraySize:i,type:r})=>i!=null?`uniform ${r} ${e}[${i}];`:`uniform ${r} ${e};`)}get entries(){return Array.from(this._entries.values())}},PPt=class{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {
 ${this._bodies.join(`
`)||""} 
}`];if(e)throw new q("shaderbuilder:missing-main","Shader does not contain main function body.");return[]}},RPt=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},gTe=class extends _Ue{constructor(){super(...arguments),this.uniforms=new OPt(this),this.main=new PPt(this),this.code=new RPt(this),this.constants=new FPt(this)}get builder(){return this}},IPt=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}get names(){return this._entries.map(([e])=>e)}},DPt=class{constructor(){this._entries=new Map}add(e,i,r){this._entries.has(e)?Cde().warn(`Ignoring duplicate varying ${i} ${e}`):this._entries.set(e,{type:i,invariant:r?.invariant??!1})}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push((r.invariant&&e==="vertex"?"invariant ":"")+(r.type==="int"?"flat ":"")+(e==="vertex"?"out":"in")+` ${r.type} ${s};`)),i}};var m0;let kPt=(m0=class{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?m0.ALLOWLIST_VERTEX:m0.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}},m0.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],m0.ALLOWLIST_VERTEX=[],m0);var g0;let LPt=(g0=class{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);s?.name!==e||s?.type!==i?this._entries.set(r,{name:e,type:i}):Cde().warn(`Fragment shader output location ${r} occupied`)}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:g0.DEFAULT_NAME,type:g0.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}},g0.DEFAULT_TYPE="vec4",g0.DEFAULT_NAME="fragColor",g0),FPt=class Kr{constructor(e){this._stage=e,this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=Kr._numberToFloatStr(r);break;case"int":s=Kr._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${Kr._numberToFloatStr(r[0])},                            ${Kr._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${Kr._numberToFloatStr(r[0])},                            ${Kr._numberToFloatStr(r[1])},                            ${Kr._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${Kr._numberToFloatStr(r[0])},                            ${Kr._numberToFloatStr(r[1])},                            ${Kr._numberToFloatStr(r[2])},                            ${Kr._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${Kr._numberToIntStr(r[0])},                             ${Kr._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${Kr._numberToIntStr(r[0])},                             ${Kr._numberToIntStr(r[1])},                             ${Kr._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${Kr._numberToIntStr(r[0])},                             ${Kr._numberToIntStr(r[1])},                             ${Kr._numberToIntStr(r[2])},                             ${Kr._numberToIntStr(r[3])})`;break;case"uvec2":s=`uvec2(${Kr._numberToIntStr(r[0])},                             ${Kr._numberToIntStr(r[1])})`;break;case"uvec3":s=`uvec3(${Kr._numberToIntStr(r[0])},                             ${Kr._numberToIntStr(r[1])},                             ${Kr._numberToIntStr(r[2])})`;break;case"uvec4":s=`uvec4(${Kr._numberToIntStr(r[0])},                             ${Kr._numberToIntStr(r[1])},                             ${Kr._numberToIntStr(r[2])},                             ${Kr._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>Kr._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const zPt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp int;
  precision highp sampler2D;
  precision highp usampler2D;
  precision highp sampler2DArray;
  precision highp sampler2DShadow;
#else
  precision mediump float;
  precision mediump int;
  precision mediump sampler2D;
  precision mediump usampler2D;
  precision mediump sampler2DArray;
  precision mediump sampler2DShadow;
#endif`,NPt=`precision highp float;
 precision highp sampler2D;
 precision highp usampler2D;
 precision highp sampler2DArray;
 precision highp sampler2DShadow;


 invariant gl_Position;
 `;let Mde=class extends $r{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.lastSlice=!1,this.viewMatrix=Jr()}};const nA=ie("esri-mobile")?1024:2048;function bUe(t){const e=new Gi;e.include(no,!1);const i=e.fragment;return i.include(LF),i.uniforms.add(new _t("cloudRadius",r=>r.cloudRadius),new _t("power",r=>yt(35,120,r.absorption)),new _t("sigmaE",r=>1+r.absorption),new _t("density",r=>yt(0,.3,r.density)),new _t("cloudSize",r=>yt(0,.02,Math.max(.01,1-r.cloudSize))),new _t("detailSize",r=>yt(0,.2,Math.max(.01,1-r.detailSize))),new _t("smoothness",r=>yt(0,.5,1-r.smoothness)),new _t("cloudHeight",r=>yt(0,1500,r.cloudHeight)),new _t("coverage",r=>r.coverage),new _m("view",r=>r.viewMatrix),new Gt("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new rc("cloudVariables",r=>oi(VPt,r.coverage,r.absorption)),new GO("lastSlice",r=>r.lastSlice)),i.constants.add("halfCubeMapSize","float",.5*nA),i.code.add(A`
    const int STEPS = ${t.steps===0?A`16`:t.steps===1?A`100`:A`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord;
      xy.x -= halfCubeMapSize;
      xy.y = lastSlice ? fragCoord.y - halfCubeMapSize : fragCoord.y;

      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(A`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${A.float(T0)};
      const float dataWidth = ${A.float(T0)};
      const float tileRows = ${A.float(wf)};
      const vec3 atlasDimensions = vec3(${A.float(Qd)}, ${A.float(Qd)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${A.float(CPt)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${A.float(EPt)} * p) / ${A.float(T0)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(A`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(A`float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}
float multipleOctaves(float extinction, float mu, float stepL) {
float attenuation = 1.0;
float contribution = 1.0;
float phaseAttenuation = 1.0;
float luminance = 0.0;
for (int i = 0; i < 4; i++) {
float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
attenuation *= 0.2;
contribution *= 0.6;
phaseAttenuation *= 0.5;
}
return luminance;
}`),i.code.add(A`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(A`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.main.add(A`if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
float cloudDistance = cloudRadius + cloudStart;
float rayStartDistance = dot(viewPos, viewPos) - (cloudDistance * cloudDistance);
vec2 rayStartIntersect = sphereIntersect(viewPos, rayDir, rayStartDistance);
float rayEndDistance = dot(viewPos, viewPos) - ((cloudDistance + cloudHeight) * (cloudDistance + cloudHeight));
vec2 rayEndIntersect = sphereIntersect(viewPos, rayDir, rayEndDistance);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);`),e}const VPt=Ke(),jPt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Mde,build:bUe,cubeMapSize:nA},Symbol.toStringTag,{value:"Module"}));let Hi=class{constructor(e,i){this._module=e,this._load=i}get(){return this._module}async reload(){return this._module=await this._load(),this._module}};function G4(t){return t===4||t===5||t===6||t===7||t===8}function BQ(t){return oae(t)||t===3}function Ede(t){return t===9||t===10}function UPt(t){return wUe(t)||Ede(t)}function wUe(t){return t===0}function Ps(t){return wUe(t)||aA(t)}function Yyi(t){return Ps(t)||t===10}function H4(t){return Ps(t)||Ede(t)}function oae(t){return H4(t)||Ade(t)}function Ade(t){return t===2}function aA(t){return t===1}function BPt(t){return Ade(t)||G4(t)}let yTe=class{constructor(e,i,r){this._context=e,this.locations=r,this._textures=new Map,this.source=Bl()?i:null,i.attributeNames.forEach(s=>{r.has(s)||console.error(`Missing VertexAttributeLocation for ${s} used in shader`)}),this._glProgram=e.programCache.acquire(i.generate("vertex",!0),i.generate("fragment",!0),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=i.generateBind(this),this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this)}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i,r){this._glProgram.setUniform1f(e,i,r)}setUniform2fv(e,i,r){this._glProgram.setUniform2fv(e,i,r)}setUniform3fv(e,i,r){this._glProgram.setUniform3fv(e,i,r)}setUniform4fv(e,i,r){this._glProgram.setUniform4fv(e,i,r)}setUniformMatrix3fv(e,i,r){this._glProgram.setUniformMatrix3fv(e,i,!1,r)}setUniformMatrix4fv(e,i,r){this._glProgram.setUniformMatrix4fv(e,i,!1,r)}setUniformMatrices4fv(e,i,r){this._glProgram.setUniformMatrices4fv(e,i,!1,r)}setUniform1fv(e,i,r){this._glProgram.setUniform1fv(e,i,r)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform2iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e,i){let r=e.locations;if(i){const s=new Map(r);i.forEach((n,a)=>s.set(a,r.size+n)),r=s}r.size!==this.locations.size&&console.error(`VertexAttributeLocations are incompatible: ${r}, ${this.locations}`),this.locations.forEach((s,n)=>{r.get(n)!==s&&console.error(`VertexAttributeLocations are incompatible: Program has ${n} at position ${s}, VAO has it at position ${r.get(n)}.`)})}stop(){this._textures.clear()}bindTexture(e,i){i?.glName||(Bl()&&console.error(`Texture sampler ${e} has no given Texture in ${new Error().stack} `),i=this._context.emptyTexture);const r=this._ensureTextureUnit(e,i);this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit)}_ensureTextureUnit(e,i){let r=this._textures.get(e);return r==null?(r={texture:i,unit:this._textures.size},this._textures.set(e,r)):r.texture=i,r}};function D$(t,e,i=32774,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function o_(t,e,i,r,s=32774,n=32774,a=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const qPt=D$(0,771),Ode=D$(1,0),GPt=D$(1,1),j1=D$(1,771),Xg=o_(770,1,771,771),HPt=o_(0,0,768,1),Pde={face:1029,mode:2305},WPt={face:1028,mode:2305},xUe=t=>t===2?Pde:t===1?WPt:null,FF={zNear:0,zFar:1},Fi={r:!0,g:!0,b:!0,a:!0};function ZPt(t){return rRt.intern(t)}function YPt(t){return sRt.intern(t)}function JPt(t){return nRt.intern(t)}function QPt(t){return aRt.intern(t)}function XPt(t){return oRt.intern(t)}function KPt(t){return lRt.intern(t)}function eRt(t){return cRt.intern(t)}function tRt(t){return uRt.intern(t)}function iRt(t){return hRt.intern(t)}function _i(t){return dRt.intern(t)}let ny=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function ay(t){return"["+t.join(",")+"]"}const rRt=new ny(SUe,t=>({__tag:"Blending",...t}));function SUe(t){return t?ay([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const sRt=new ny(TUe,t=>({__tag:"Culling",...t}));function TUe(t){return t?ay([t.face,t.mode]):null}const nRt=new ny($Ue,t=>({__tag:"PolygonOffset",...t}));function $Ue(t){return t?ay([t.factor,t.units]):null}const aRt=new ny(CUe,t=>({__tag:"DepthTest",...t}));function CUe(t){return t?ay([t.func]):null}const oRt=new ny(MUe,t=>({__tag:"StencilTest",...t}));function MUe(t){return t?ay([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const lRt=new ny(EUe,t=>({__tag:"DepthWrite",...t}));function EUe(t){return t?ay([t.zNear,t.zFar]):null}const cRt=new ny(AUe,t=>({__tag:"ColorWrite",...t}));function AUe(t){return t?ay([t.r,t.g,t.b,t.a]):null}const uRt=new ny(OUe,t=>({__tag:"StencilWrite",...t}));function OUe(t){return t?ay([t.mask]):null}const hRt=new ny(PUe,t=>({__tag:"DrawBuffers",...t}));function PUe(t){return t?ay(t.buffers):null}const dRt=new ny(pRt,t=>({blending:ZPt(t.blending),culling:YPt(t.culling),polygonOffset:JPt(t.polygonOffset),depthTest:QPt(t.depthTest),stencilTest:XPt(t.stencilTest),depthWrite:KPt(t.depthWrite),colorWrite:eRt(t.colorWrite),stencilWrite:tRt(t.stencilWrite),drawBuffers:iRt(t.drawBuffers)}));function pRt(t){return t?ay([SUe(t.blending),TUe(t.culling),$Ue(t.polygonOffset),CUe(t.depthTest),MUe(t.stencilTest),EUe(t.depthWrite),AUe(t.colorWrite),OUe(t.stencilWrite),PUe(t.drawBuffers)]):null}let fRt=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}};const mRt=()=>re.getLogger("esri.views.3d.webgl.ShaderTechnique");let er=class{constructor(e,i,r,s){this.primitiveType=Sr.TRIANGLES,this.key=i.key,this._program=new yTe(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i),this.reload=async n=>{n&&await r.reload(),this.key.equals(i.key)||mRt().warn("Configuration was changed after construction, cannot reload shader.",r),jt(this._program),this._program=new yTe(e.rctx,r.get().build(i),s),this._pipeline=this.initializePipeline(i)}}destroy(){this._program=jt(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,i){return this._pipeline}initializePipeline(e){return _i({blending:j1,colorWrite:Fi})}};function pS(t,e){return BPt(t)?{buffers:[Zq]}:e??null}function Rp(t){let e=0;return new Map(t.map(({name:i,count:r})=>{const s=[i,e];return r===16?e+=4:r===9?e+=3:++e,s}))}function bH(t){const e=new Map;let i=0;return t.forEach(r=>r.forEach(({name:s,count:n})=>{e.set(s,i),n===16?i+=4:n===9?i+=3:++i})),e}function gRt(t){return bH(Array.from(t.values()).map(({layout:e})=>e))}let hm=class{constructor(e,i,r,s,n,a=!1,o=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=a,this.divisor=o}};const wH=[],yRt=[new hm("position",3,Di.FLOAT,0,12)],Rde=[new hm("position",2,Di.FLOAT,0,8)],wn=Rp(Rde),tvi=Rp(yRt),zF=[new hm("position",2,Di.FLOAT,0,12),new hm("uv0",2,Di.HALF_FLOAT,8,12)],vRt=[new hm("position",2,Di.FLOAT,0,16),new hm("uv0",2,Di.FLOAT,8,16)];let qQ=class extends er{constructor(e,i){super(e,i,new Hi(jPt,()=>W(()=>Promise.resolve().then(()=>lri),void 0)),wn)}initializePipeline(e){return _i({blending:D$(32769,32770,32774,e.writeTextureChannels===0?[1,1,0,0]:[0,0,1,1]),depthTest:{func:515},colorWrite:Fi})}},_Rt=class{constructor(e){this._bits=[...e]}equals(e){return E0(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}},Tl=class extends $r{constructor(){super(),this._parameterBits=this._parameterBits?.map(()=>0)??[],this._parameterNames??=[]}get key(){return this._key??=new _Rt(this._parameterBits),this._key}decode(e=this.key){const i=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map(s=>`    ${s}: ${this[s]}`).join(`
`);return this._parameterBits=i,r}};function ue(t={}){return(e,i)=>{e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:e._parameterNames?.slice()??[],configurable:!0,writable:!0}),e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:e._parameterBits?.slice()??[0],configurable:!0,writable:!0}),e._parameterNames.push(i);const r=t.count||2,s=Math.ceil(Math.log2(r)),n=e._parameterBits;let a=0;for(;n[a]+s>16;)a++,a>=n.length&&n.push(0);const o=n[a],l=(1<<s)-1<<o;n[a]+=s,t.count?Object.defineProperty(e,i,{get(){return(this._parameterBits[a]&l)>>o},set(u){if(this[i]!==u){if(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~l|+u<<o&l,typeof u!="number")throw new q("internal:invalid-shader-configuration",`Configuration value for ${i} must be a number, got ${typeof u}`);if(t.count==null)throw new q("internal:invalid-shader-configuration",`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(e,i,{get(){return!!((this._parameterBits[a]&l)>>o)},set(u){if(this[i]!==u&&(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~l|+u<<o&l,typeof u!="boolean"))throw new q("internal:invalid-shader-configuration",`Configuration value for ${i} must be boolean, got ${typeof u}`)}})}}let lae=class extends Tl{constructor(){super(...arguments),this.steps=0,this.writeTextureChannels=0}};c([ue({count:3})],lae.prototype,"steps",void 0),c([ue({count:2})],lae.prototype,"writeTextureChannels",void 0);let Ide=class extends $r{constructor(){super(...arguments),this.weatherTile=Cs(0,0)}};function RUe(t){const e=new Gi;return e.include(no,!1),e.fragment.code.add(A`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===0&&(e.fragment.code.add(A`float saturate(float x) {
return clamp(x, 0.0, 1.0);
}`),e.fragment.code.add(A`vec3 modulo(vec3 m, float n) {
return mod(mod(m, n) + n, n);
}
vec3 hash(vec3 p3, float frequency) {
p3 = modulo(p3, frequency);
p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yxz + 33.33);
return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
}`),e.fragment.code.add(A`vec3 fade(vec3 t) {
return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
}`),e.fragment.code.add(A`
    float gradientNoise(vec3 p, float frequency) {
      vec3 i = floor(p);
      vec3 f = fract(p);
      vec3 u = fade(f);
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequency = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequency;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${A.float(wf)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${A.float(8)});

      float worley0 = worley(p, ${A.float(2)} * 2.0);
      float worley1 = worley(p, ${A.float(2)} * 8.0);
      float worley2 = worley(p, ${A.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${A.float(2)});
      float worley1 = worley(p, ${A.float(2)} * 2.0);
      float worley2 = worley(p, ${A.float(2)} * 4.0);
      float worley3 = worley(p, ${A.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)),e.fragment.uniforms.add(new rc("weatherTile",i=>i.weatherTile)).code.add(A`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${A.float(KV)});

      // Get global coordinates of p
      p += weatherTile * ${A.float(KV)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${A.float(MPt)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.mode===0?e.fragment.main.add(A`
      float padWidth = 1.0;
      float paddedSize = ${A.float(Qd)} + 2.0 * padWidth;
      float tileCount = ${A.float(wf)} * ${A.float(wf)};
      vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

      bool padCell = false;
      if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      bool startPadX = false;
      bool startPadY = false;
      bool endPadX = false;
      bool endPadY = false;

      if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
        startPadX = true;
      }

      if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
        startPadY = true;
      }

      if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
        endPadX = true;
      }

      if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
        endPadY = true;
      }

      vec2 padding = vec2(2.0 * padWidth) * tile;
      vec2 uv;

      if (padCell) {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;

        if (startPadX) {
          pixel.x += ${A.float(Qd)};
        }

        if (startPadY) {
          pixel.y += ${A.float(Qd)};
        }

        if (endPadX) {
          pixel.x -= ${A.float(Qd)};
        }

        if (endPadY) {
          pixel.y -= ${A.float(Qd)};
        }

        uv = vec2(pixel.xy / ${A.float(Qd)});
      } else {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;
        uv = vec2(pixel.xy / ${A.float(Qd)});
      }

      vec3 p_ = get3Dfrom2D(uv);
      vec3 p = p_;
      p.z /= (${A.float(wf)} * ${A.float(wf)});

      float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      float worleyNoise = getTextureForPointWorley(p);

      fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      p_ = mod(p_ + 1.0, ${A.float(wf)} * ${A.float(wf)});
      p = p_;
      p.z /= (${A.float(wf)} * ${A.float(wf)});

      worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      worleyNoise = getTextureForPointWorley(p);

      fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      vec2 mapUV = ${A.float(KV)} * (gl_FragCoord.xy / ${A.float(T0)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor.ba = vec2(0.0, map);
      `):e.fragment.main.add(A`
      vec2 mapUV = ${A.float(KV)} * (gl_FragCoord.xy / ${A.float(T0)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor = vec4(map);
    `),e}const bRt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Ide,build:RUe},Symbol.toStringTag,{value:"Module"}));let wB=class extends Tl{constructor(){super(...arguments),this.mode=0}};c([ue({count:2})],wB.prototype,"mode",void 0);let GQ=class extends er{constructor(e,i){super(e,i,new Hi(bRt,()=>W(()=>Promise.resolve().then(()=>cri),void 0)),wn)}initializePipeline(e){return _i({blending:e.mode===0?Ode:o_(0,1,1,0),depthTest:{func:519},colorWrite:Fi})}};const vTe=()=>re.getLogger("esri.views.webgl.BufferObject"),wRt=!!ie("esri-tests-disable-gpu-memory-measurements");let id=class R3{static createIndex(e,i,r){return new R3(e,34963,i,r)}static createUniform(e,i,r){return new R3(e,35345,i,r)}static createPixelPack(e,i=35041,r){const s=new R3(e,35051,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=35040,r){return new R3(e,35052,i,r)}static createTransformFeedback(e,i=35044,r){const s=new R3(e,35982,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(mn.BufferObject,this),this._glName=this._context.gl.createBuffer(),Au(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(this.bufferType===34963){if(this._indexType===Di.UNSIGNED_INT)return 4*this._size;if(this._indexType===Di.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return wRt?0:this.sizeBytes}get _isVAOAware(){return this.bufferType===34963||this.bufferType===34962}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(mn.BufferObject,this),this._context=null):this._glName&&vTe().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===34963&&i!=null)switch(this._indexType=i,i){case Di.UNSIGNED_SHORT:e*=2;break;case Di.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===34963&&(TS(e)?this._indexType=Di.UNSIGNED_BYTE:G9(e)?(i/=2,this._indexType=Di.UNSIGNED_SHORT):Cle(e)&&(i/=4,this._indexType=Di.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),Au(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:a}=this._context;a.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),Au(a),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=xRt(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&vTe().warn("Potential problem getting subdata: requested data exceeds buffer size!");const a=this._context.gl;this.bufferType===35982?(this._context.bindBuffer(this,35982),a.getBufferSubData(35982,i,e,r,s),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),a.getBufferSubData(36662,i,e,r,s),this._context.unbindBuffer(36662))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function xRt(t){return ket(t)}let SRt=class{constructor(e,i=0,r=i,s=!1,n=1){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=s,this.samples=n}};function TRt(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*rhe(t.internalFormat)}const $Rt=!!ie("esri-tests-disable-gpu-memory-measurements");let IUe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=2,this._context.instanceCounter.increment(mn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:a,multisampled:o}=i;o?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,a,s,n):r.renderbufferStorage(r.RENDERBUFFER,a,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return $Rt?0:TRt(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(mn.Renderbuffer,this),this._context=null)}};const CRt=()=>re.getLogger("esri.views.webgl.FramebufferObject");var Ig;let U1=(Ig=class{constructor(e,i,r){if(this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(mn.FramebufferObject,this),i!=null){const s=ARt(e,i);s!=null&&(this._colorAttachments.set(Hr,s),Qb(s)?this._validateTextureDescriptor(s.descriptor):this._validateRenderbufferDescriptor(s.descriptor)),this._validateColorAttachmentPoint(Hr)}if(r!=null)if(MRt(r))this._depthStencilTexture=Qb(r)?r:new qi(e,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=cae(r)?r:new IUe(e,r);this._depthStencilBuffer=s,this._validateRenderbufferDescriptor(s.descriptor)}}dispose(){const{_colorAttachments:e,_glName:i}=this;if(e.size===0&&!this._depthStencilBuffer&&!this._depthStencilTexture&&!i)return;const{_context:r}=this,s=r.getBoundFramebufferObject();e.forEach((n,a)=>this.detachColorTexture(a)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),r.gl.deleteFramebuffer(i),this._glName=null,r.bindFramebuffer(s===this?null:s),r.instanceCounter.decrement(mn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){const e=this._colorAttachments.get(Hr);return Qb(e)?e:null}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return(this._colorAttachments.get(Hr)??this._depthStencilTexture??this._depthStencilBuffer)?.descriptor?.width??0}get height(){return(this._colorAttachments.get(Hr)??this._depthStencilTexture??this._depthStencilBuffer)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((e,[i,r])=>e+r.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&Qb(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=Hr){if(!e)return;this._validateColorAttachmentPoint(i);const{descriptor:r}=e;this._validateTextureDescriptor(r),this.detachColorTexture(i)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=Hr){const i=this._colorAttachments.get(e);if(!i)return;const r=Qb(i);return this._initialized&&this._context.temporaryBindFramebufferObject(this,()=>{if(r)this._framebufferTexture2D(null,e);else{const s=this._context.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,e,s.RENDERBUFFER,null)}}),this._colorAttachments.delete(e),r?i:void 0}setColorTextureTarget(e,i=Hr,r=0){const s=this._colorAttachments.get(i);s&&(e===35866?this._framebufferTextureLayer(s.glName,i,36160,0,r):this._framebufferTexture2D(s.glName,i,e,36160,0))}attachDepthStencil(e){if(e)switch(e.type){case 1:return this._attachDepthStencilTexture(e);case 2:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const{descriptor:i}=e,{pixelFormat:r,dataType:s}=i;r===34041||r===6402?r!==34041||s===Ns.UNSIGNED_INT_24_8?r!==6402||s===Ns.UNSIGNED_INT||s===Ns.UNSIGNED_SHORT?(this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,ej(r))),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e):console.error("Depth texture must have data type of UNSIGNED_INT or UNSIGNED_SHORT!"):console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"):console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!")}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&this._context.temporaryBindFramebufferObject(this,()=>{this._framebufferTexture2D(null,ej(e.descriptor.pixelFormat))}),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderbufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const{gl:r}=this._context,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(36160,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const{_context:i}=this,r=i.getBoundFramebufferObject();i.bindFramebuffer(this);const{gl:s}=i,n=this._getGLAttachmentPoint(e.descriptor);s.framebufferRenderbuffer(36160,n,s.RENDERBUFFER,null),i.bindFramebuffer(r)}return this._depthStencilBuffer=null,e}invalidateAttachments(e){const{_context:i}=this;i.temporaryBindFramebufferObject(this,()=>i.gl.invalidateFramebuffer(36160,e),!0)}copyToTexture(e,i,r,s,n,a,o){(e<0||i<0||n<0||a<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==3553&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+r>this.width||i+s>this.height||n+r>l.width||a+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const u=this._context,d=u.bindTexture(o,qi.TEXTURE_UNIT_FOR_UPDATES);u.setActiveTexture(qi.TEXTURE_UNIT_FOR_UPDATES),u.bindFramebuffer(this),u.gl.copyTexSubImage2D(3553,0,n,a,e,i,r,s),u.bindTexture(d,qi.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,a,o){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,a,o)}async readPixelsAsync(e,i,r,s,n,a,o){const{gl:l}=this._context,u=id.createPixelPack(this._context,35041,o.byteLength);this._context.bindBuffer(u);const d=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,a,0),this._context.unbindBuffer(35051),this._context.bindFramebuffer(d),await u.getSubDataAsync(o),u.dispose()}resize(e,i){if(this.width===e&&this.height===i)return;const r={width:e,height:i};if(fS(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(fS(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),Bl())){const{gl:s}=this._context;s.checkFramebufferStatus(36160)!==s.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!")}}initializeAndBind(e=36160){const{gl:i}=this._context;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>{if(Qb(s)){const a=_Te(s);a===35866?this._framebufferTextureLayer(s.glName,n,e,0,0):this._framebufferTexture2D(s.glName,n,a,e)}else if(cae(s)){const a=this._context.gl;a.framebufferRenderbuffer(e,n,a.RENDERBUFFER,s.glName)}}),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else if(this._depthStencilTexture){const s=ej(this._depthStencilTexture.descriptor.pixelFormat);this._framebufferTexture2D(this._depthStencilTexture.glName,s,_Te(this._depthStencilTexture),e)}Bl()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=Hr,r=3553,s=36160,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_framebufferTextureLayer(e,i=Hr,r=36160,s=0,n=0){this._context.gl.framebufferTextureLayer(r,i,e,s,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(36160,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=jt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,ej(this._depthStencilTexture.descriptor.pixelFormat))),this._depthStencilTexture=jt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==3553&&e.target!==34067&&e.target!==35866&&console.error("Texture type must be TEXTURE_2D, TEXTURE_2D_ARRAY or TEXTURE_CUBE_MAP!"),fS(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderbufferDescriptor(e){fS(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case mp.DEPTH_COMPONENT16:case mp.DEPTH_COMPONENT24:case mp.DEPTH_COMPONENT32F:return wze;case Jg.DEPTH24_STENCIL8:case Jg.DEPTH32F_STENCIL8:return To;case 36168:return nbt;default:return Hr}}_validateColorAttachmentPoint(e){if(Ig._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;Ig._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-Hr;i+1>Ig._MAX_COLOR_ATTACHMENTS&&re.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Ig._MAX_COLOR_ATTACHMENTS} color attachments`)}},Ig._MAX_COLOR_ATTACHMENTS=-1,Ig);function Qb(t){return xH(t)===1}function cae(t){return xH(t)===2}function MRt(t){return Qb(t)||DUe(t)}function DUe(t){return xH(t)===0}function ERt(t){return xH(t)===3||t!=null&&"samples"in t}function xH(t){return t!=null&&"type"in t?t.type:null}function ARt(t,e){return Qb(e)||cae(e)?e:DUe(e)?new qi(t,e):ERt(e)?new IUe(t,e):null}function fS(t,e){const i=Math.max(t.width,t.height);if(i>e){CRt().warnOnce(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function _Te(t){return t.descriptor.target===34067?34069:t.descriptor.target===35866?35866:3553}function ej(t){return t===6402?wze:To}let xB=class extends be{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Ide,this._configuration=new wB,this._fbo=new U1(e.context.renderContext.rctx,new ar(T0)),e.context.techniques.precompile(GQ,new wB);const i=new wB;i.mode=1,e.context.techniques.precompile(GQ,i)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?1:0;const e=this.context.techniques.get(GQ,this._configuration);return e.compiled&&(this._texture=this._render(e)),this._texture}updateWeatherMap(e){l7(this._passParameters.weatherTile,e)||(na(this._passParameters.weatherTile,e),this._needsRender=!0)}destroy(){this._fbo=jt(this._fbo)}_render(e){if(!this._fbo)return null;const i=this.context.renderContext.rctx,r=i.getViewport();return i.setViewport(0,0,T0,T0),i.bindFramebuffer(this._fbo),i.bindTechnique(e,this.context.renderContext.bind,this._passParameters),i.screen.draw(),i.setViewport(r.x,r.y,r.width,r.height),this._needsRender=!1,this._fbo.colorTexture}};c([p({constructOnly:!0})],xB.prototype,"context",void 0),xB=c([R("esri.views.3d.environment.NoiseTextureAtlas")],xB);let _c=class extends be{constructor(e){super(e),this._state=ta(0),this._passParameters=new Mde,this._weatherTileCount=128,this._sliceIndex=0,this._tileIndex=0,this._tilesPerSlice=1,this.coverage=yt(Vo.default.coverage[0],Vo.default.coverage[1],.5),this.density=yt(Vo.default.density[0],Vo.default.density[1],.5),this.absorption=yt(Vo.default.absorption[0],Vo.default.absorption[1],.5),this.cloudSize=yt(Vo.default.cloudSize[0],Vo.default.cloudSize[1],.5),this.detailSize=yt(Vo.default.detailSize[0],Vo.default.detailSize[1],.5),this.smoothness=yt(Vo.default.smoothness[0],Vo.default.smoothness[1],.5),this.cloudHeight=yt(Vo.default.cloudHeight[0],Vo.default.cloudHeight[1],.5),this.raymarchingSteps=Vo.default.raymarchingSteps,this._viewMatrix=ut(),this._dirty=!0,this.readyToRun=!0,this._configuration=new lae}initialize(){const e=xr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius;const i=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(Tt.CLOUDS_GENERATOR,this),X(()=>this.coverage,i,Yt),X(()=>this.density,i,Yt),X(()=>this.absorption,i,Yt),X(()=>this.cloudSize,i,Yt),X(()=>this.detailSize,i,Yt),X(()=>this.smoothness,i,Yt),X(()=>this.cloudHeight,i,Yt),X(()=>this.raymarchingSteps,i,Yt)]);const r=Lq(this._computeWeatherTile());let s=0;this.addHandles(X(()=>{const n=this._computeWeatherTile();return l7(r,n)||(++s,na(r,n)),s},i))}destroy(){this.destroyCubeMap(),this._passParameters.noiseTexture=Pe(this._passParameters.noiseTexture)}_precompile(){this._configuration.steps=this.raymarchingSteps,this._configuration.writeTextureChannels=0,this.context.techniques.precompile(qQ,this._configuration),this._configuration.writeTextureChannels=1,this.context.techniques.precompile(qQ,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case 0:this._tilesPerSlice=1;break;case 1:this._tilesPerSlice=4;break;case 3:case 2:this._tilesPerSlice=8;break;default:this.raymarchingSteps}return this._configuration.writeTextureChannels=1-this.parameters.readChannels,this._configuration.steps=this.raymarchingSteps,this.context.techniques.get(qQ,this._configuration)}_computeWeatherTile(){const{camera:e,environment:i}=this.view,{latitude:r,longitude:s}=e.position;if(r==null||s==null)return f1;oi(Xp,(r+90)/180,(s+180)/360);const n=Math.floor(this._weatherTileCount*Math.abs(2*Xp[0]-1));Xp[0]=Math.floor(2*this._weatherTileCount*Xp[0]),Xp[1]=Math.floor(4*(this._weatherTileCount-n)*Xp[1]);let a=0,o=0;if(i?.lighting?.type!=="virtual"&&i?.lighting?.date!=null){const l=new Date(i.lighting.date);l.setUTCHours(i.lighting.date.getUTCHours()+(i.lighting.displayUTCOffset??0)),a=31*l.getUTCMonth()+l.getUTCDate(),o=l.getUTCFullYear()}return Xp[0]=(Xp[0]+a)%(2*this._weatherTileCount),Xp[1]=(Xp[1]+o%100)%(4*this._weatherTileCount),Xp}get state(){return this._state.value}set state(e){this._state.value=e}get usedMemory(){return(this._fbo?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){return this._passParameters.noiseTexture??=new xB({context:this.context}),this._passParameters.noiseTexture}_ensureFrameBufferCube(e){const i=this.context.renderContext.rctx;if(this._fbo==null){const r=new ar(e,e/2);r.target=35866,r.depth=6,r.wrapMode=33071,this._fbo=new U1(i,r),this.parameters.data=this,this.parameters.absorption=this.absorption,this.parameters.coverage=this.coverage}return i.unbindTexture(this._fbo.colorTexture),this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=jt(this._fbo),this.parameters.data=null}applyPreset(e,i){const r=e.median,s=n=>{const a=yt(n[0],n[1],r);return i<.5?yt(n[0],a,2*i):yt(a,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps,this._precompile()}setDirty(){this._dirty=this.readyToRun=!0}runTask(e){if(this.state===3)return Oa;this._dirty&&(this._sliceIndex=this._tileIndex=0,this.state=1,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);const i=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!i.compiled)return Oa;const r=ORt[this._sliceIndex],s=PRt[this._sliceIndex];d5e(this._viewMatrix,RRt,r,s),P1(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,a=n.getViewport(),o=nA/this._tilesPerSlice,l=this._tileIndex*o;n.setViewport(0,l,nA,o);const u=this._ensureFrameBufferCube(nA);return n.bindFramebuffer(u),this._passParameters.lastSlice=this._sliceIndex===5,n.bindTechnique(i,this.context.renderContext.bind,this._passParameters),u.setColorTextureTarget(35866,Hr,this._sliceIndex),n.screen.draw(),n.gl.flush(),n.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._sliceIndex===5&&this._tileIndex===this._tilesPerSlice?(this._sliceIndex=this._tileIndex=0,this.state=2,this.readyToRun=!1):this._tileIndex===this._tilesPerSlice&&(++this._sliceIndex,this._tileIndex=0),e.madeProgress(),Oa}};c([p({constructOnly:!0})],_c.prototype,"context",void 0),c([p({constructOnly:!0})],_c.prototype,"view",void 0),c([p({constructOnly:!0})],_c.prototype,"requestRender",void 0),c([p()],_c.prototype,"coverage",void 0),c([p()],_c.prototype,"density",void 0),c([p()],_c.prototype,"absorption",void 0),c([p()],_c.prototype,"cloudSize",void 0),c([p()],_c.prototype,"detailSize",void 0),c([p()],_c.prototype,"smoothness",void 0),c([p()],_c.prototype,"cloudHeight",void 0),c([p()],_c.prototype,"raymarchingSteps",void 0),c([p()],_c.prototype,"readyToRun",void 0),_c=c([R("esri.views.3d.environment.CloudsRenderer")],_c);const ORt=[pr(1,0,0),pr(-1,0,0),pr(0,1,0),pr(0,-1,0),pr(0,0,1),pr(0,0,1)],PRt=[pr(0,0,-1),pr(0,0,-1),pr(0,0,-1),pr(0,0,-1),pr(0,1,0),pr(0,1,0)],RRt=c1(),Xp=zue();function pvi(t){return SH(t,!0)}function SH(t,e){if(Array.isArray(t)){if(t.length<Hc)return t}else if(t.length<Hc)return Array.from(t);let i=!0,r=!0;return t.some((s,n)=>(i=i&&s===0,r=r&&s===n,!i&&!r)),i?kde(t.length):r?IP(t.length):lP(t)&&t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:IRt(t,!e)}function IRt(t,e){for(const i of t){if(i>=65536)return lP(t)?t:new Uint32Array(t);i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function fvi(t){return t<=Hc?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function mvi(t){return t<=Hc?new Array(t):new Uint32Array(t)}let gk=Dde(131072);const kUe=[0],HQ=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function IP(t){return t===1?kUe:t<Hc?Array.from(new Uint16Array(HQ.buffer,0,t)):t<HQ.length?new Uint16Array(HQ.buffer,0,t):(t>gk.length&&(gk=Dde(Math.max(2*gk.length,t))),new Uint32Array(gk.buffer,0,t))}function Dde(t){const e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}let yk=new Uint8Array(65536);function kde(t){if(t===1)return kUe;if(t<Hc)return new Array(t).fill(0);if(t>yk.length){const e=Math.max(2*yk.length,t);yk=new Uint8Array(e)}return new Uint8Array(yk.buffer,0,t)}function DRt(){gk=Dde(131072),yk=new Uint8Array(65536)}let Zo=class extends Ki{constructor(e,i,r){super(e,"vec3",0,(s,n)=>s.setUniform3fv(e,i(n),r))}},Pr=class extends Ki{constructor(e,i,r){super(e,"vec3",1,(s,n,a)=>s.setUniform3fv(e,i(n,a),r))}},_l=class extends Ki{constructor(e,i,r){super(e,"mat4",0,(s,n)=>s.setUniformMatrix4fv(e,i(n),r))}};function LUe(t){const e=new Gi;return e.attributes.add("position","vec3"),e.attributes.add("instanceFeatureAttribute","float"),e.vertex.uniforms.add(new Zo("cameraPosition",i=>i.camera.eye),new Pr("offset",(i,r)=>kRt(i,r)),new _t("width",i=>i.width),new _t("time",i=>i.time),new _l("proj",i=>i.camera.projectionMatrix),new _l("view",i=>i.camera.viewMatrix)),e.varyings.add("vUv","vec2"),e.vertex.code.add(A`vec3 hash31(float p){
vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yzx + 33.33);
return fract((p3.xxy + p3.yzz) * p3.zyx);
}
float hash11(float p){
p = fract(p * 0.1031);
p *= p + 33.33;
p *= p + p;
return fract(p);
}
vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
}`),e.vertex.main.add(A`
      vUv = position.xz;
      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundredths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===0?A`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:A`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
  `),e.fragment.uniforms.add(new _t("opacity",i=>i.opacity),new Zo("particleColor",i=>LRt(i,t))),e.fragment.main.add(A`
    float d = length(vUv - vec2(0.5));

    ${t.type===0?A`d = 0.35 * smoothstep(0.5, 0.0, d);`:A`d = smoothstep(0.5, 0.1, d);`}
    fragColor = opacity * vec4(particleColor * d, d);
  `),e}function kRt(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=JFe(uae,xe(uae,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return xi(n,i,he(n,n,t.width))}function LRt(t,e){const i=e.type===0?zRt:FRt,r=he(uae,i,NRt),s=t.camera.eye;Re(bTe,s);const n=Math.max(0,Le(bTe,t.lighting.mainLight.direction));return cr(r,r,i,n)}const uae=I(),bTe=I(),FRt=Ye(1,1,1),zRt=Ye(.85,.85,.85),NRt=.7,VRt=Object.freeze(Object.defineProperty({__proto__:null,build:LUe},Symbol.toStringTag,{value:"Module"}));let jRt=class extends $r{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=0}},wTe=class extends er{constructor(e,i){super(e,i,new Hi(VRt,()=>W(()=>Promise.resolve().then(()=>uri),void 0)),new Map([["position",0],["instanceFeatureAttribute",1]]))}initializePipeline(){return _i({blending:j1,depthTest:{func:515},colorWrite:Fi})}},FUe=class extends Tl{constructor(){super(...arguments),this.type=0}};c([ue({count:2})],FUe.prototype,"type",void 0);function bl(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{const s=t.fields.get(r),n=s.constructor.ElementCount,a=URt(s.constructor.ElementType),o=s.offset,l=s.optional?.glNormalized??!1;return new hm(r,n,a,o,i,l,e)})}function URt(t){switch(t){case"u8":return Di.UNSIGNED_BYTE;case"u16":return Di.UNSIGNED_SHORT;case"u32":return Di.UNSIGNED_INT;case"i8":return Di.BYTE;case"i16":return Di.SHORT;case"i32":return Di.INT;case"f16":return Di.HALF_FLOAT;case"f32":return Di.FLOAT;default:throw new Error("BufferType not supported in WebGL")}}let Lde=globalThis.Float16Array;function zUe(...t){return new(Lde??Float32Array)(...t)}function NF(){return Lde}let Gf=!!Lde;var GA;let NUe=(GA=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const a=this.TypedArrayConstructor;s===void 0&&(s=9*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=e*this.typedBufferStride,o=r*i.typedBufferStride;for(let l=0;l<9;++l)s[a++]=n[o++]}get buffer(){return this.typedBuffer.buffer}},GA.ElementCount=9,GA);var HA;let VUe=(HA=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const a=this.TypedArrayConstructor;s===void 0&&(s=16*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){this.copyFromTypedBuffer(e,i.typedBuffer,r*i.typedBufferStride)}copyFromTypedBuffer(e,i,r){const s=this.typedBuffer;let n=e*this.typedBufferStride;for(let a=0;a<16;++a)s[n++]=i[r++]}get buffer(){return this.typedBuffer.buffer}},HA.ElementCount=16,HA);var WA;let l_=(WA=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const a=this.TypedArrayConstructor;s===void 0&&(s=a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}},WA.ElementCount=1,WA);var ZA;let c_=(ZA=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=2;const a=this.TypedArrayConstructor;s===void 0&&(s=2*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,oi(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=e*this.typedBufferStride,o=r*i.typedBufferStride;s[a++]=n[o++],s[a]=n[o]}get buffer(){return this.typedBuffer.buffer}},ZA.ElementCount=2,ZA);var YA;let u_=(YA=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const a=this.TypedArrayConstructor;s===void 0&&(s=3*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,xe(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=e*this.typedBufferStride,o=r*i.typedBufferStride;s[a++]=n[o++],s[a++]=n[o++],s[a]=n[o]}get buffer(){return this.typedBuffer.buffer}},YA.ElementCount=3,YA);var JA;let h_=(JA=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const a=this.TypedArrayConstructor;s===void 0&&(s=4*a.BYTES_PER_ELEMENT);const o=i.byteLength===0?0:r;this.typedBuffer=n==null?new a(i,o):new a(i,o,(n-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=s/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Or(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let a=e*this.typedBufferStride,o=r*i.typedBufferStride;s[a++]=n[o++],s[a++]=n[o++],s[a++]=n[o++],s[a]=n[o]}get buffer(){return this.typedBuffer.buffer}},JA.ElementCount=4,JA);const Il=li();let BRt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function xt(t,e="Assertion"){if(!t){const i=new Error(e).stack;throw new BRt(`${e} at ${i}`)}}function ZC(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function jUe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],a=(r[0]-t[0])/e[0];n>a&&(s=n,n=a,a=s);let o=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(o>l&&(s=o,o=l,l=s),n>l||o>a)return!1;o>n&&(n=o),l<a&&(a=l);let u=(i[2]-t[2])/e[2],d=(r[2]-t[2])/e[2];return u>d&&(s=u,u=d,d=s),!(n>d||u>a)&&(d<a&&(a=d),!(a<0))}function tj(t,e,i,r,s,n=Ke()){const a=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),o=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(a===0)return!1;const l=o/a;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function xTe(t,e,i,r,s){Il[0]=t[0],Il[1]=t[1],Il[2]=t[2],Il[3]=1,zu(Il,Il,e),s.length>2&&(s[2]=-Il[2]),zu(Il,Il,i),xt(Il[3]!==0),s[0]=Il[0]/Il[3],s[1]=Il[1]/Il[3],s[2]=Il[2]/Il[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function qRt(t,e){return Math.log(t)/Math.log(e)}function GRt(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}var QA;let HRt=(QA=class extends l_{constructor(e,i=0,r,s){xt(Gf),super(NF(),e,i,r,s),this.elementType="f16"}},QA.ElementType="f16",QA);var XA;let aL=(XA=class extends l_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}},XA.ElementType="f32",XA);var tT;let UUe=(tT=class extends c_{constructor(e,i=0,r,s){xt(Gf),super(NF(),e,i,r,s),this.elementType="f16"}slice(e,i){return this.sliceBuffer(tT,e,i)}},tT.ElementType="f16",tT);var iT;let _G=(iT=class extends c_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(iT,e,i)}},iT.ElementType="f32",iT);var rT;let BUe=(rT=class extends u_{constructor(e,i=0,r,s){xt(Gf),super(NF(),e,i,r,s),this.elementType="f16"}slice(e,i){return this.sliceBuffer(rT,e,i)}},rT.ElementType="f16",rT);var Gw;let Fw=(Gw=class extends u_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Gw,e,i)}static fromTypedArray(e,i){return new Gw(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}},Gw.ElementType="f32",Gw);var sT;let qUe=(sT=class extends h_{constructor(e,i=0,r,s){xt(Gf),super(NF(),e,i,r,s),this.elementType="f16"}slice(e,i){return this.sliceBuffer(sT,e,i)}},sT.ElementType="f16",sT);var nT;let o$=(nT=class extends h_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(nT,e,i)}},nT.ElementType="f32",nT);var aT;let GUe=(aT=class extends NUe{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(aT,e,i)}},aT.ElementType="f32",aT);var oT;let HUe=(oT=class extends NUe{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(oT,e,i)}},oT.ElementType="f64",oT);var lT;let WUe=(lT=class extends VUe{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(lT,e,i)}},lT.ElementType="f32",lT);var cT;let ZUe=(cT=class extends VUe{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(cT,e,i)}},cT.ElementType="f64",cT);var uT;let YUe=(uT=class extends l_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(uT,e,i)}},uT.ElementType="f64",uT);var hT;let JUe=(hT=class extends c_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(hT,e,i)}},hT.ElementType="f64",hT);var Hw;let QUe=(Hw=class extends u_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Hw,e,i)}static fromTypedArray(e,i){return new Hw(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}},Hw.ElementType="f64",Hw);var dT;let XUe=(dT=class extends h_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(dT,e,i)}},dT.ElementType="f64",dT);var pT;let bG=(pT=class extends l_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(pT,e,i)}},pT.ElementType="u8",pT);var fT;let KUe=(fT=class extends c_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(fT,e,i)}},fT.ElementType="u8",fT);var Ww;let WRt=(Ww=class extends u_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Ww,e,i)}static fromTypedArray(e,i){return new Ww(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}},Ww.ElementType="u8",Ww);var mT;let rd=(mT=class extends h_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(mT,e,i)}},mT.ElementType="u8",mT);var gT;let eBe=(gT=class extends l_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(gT,e,i)}},gT.ElementType="u16",gT);var yT;let tBe=(yT=class extends c_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(yT,e,i)}},yT.ElementType="u16",yT);var vT;let ZRt=(vT=class extends u_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(vT,e,i)}},vT.ElementType="u16",vT);var _T;let iBe=(_T=class extends h_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(_T,e,i)}},_T.ElementType="u16",_T);var bT;let rBe=(bT=class extends l_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(bT,e,i)}},bT.ElementType="u32",bT);var wT;let YRt=(wT=class extends c_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(wT,e,i)}},wT.ElementType="u32",wT);var xT;let JRt=(xT=class extends u_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(xT,e,i)}},xT.ElementType="u32",xT);var ST;let QRt=(ST=class extends h_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(ST,e,i)}},ST.ElementType="u32",ST);var TT;let sBe=(TT=class extends l_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(TT,e,i)}},TT.ElementType="i8",TT);var $T;let nBe=($T=class extends c_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer($T,e,i)}},$T.ElementType="i8",$T);var CT;let XRt=(CT=class extends u_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(CT,e,i)}},CT.ElementType="i8",CT);var MT;let KRt=(MT=class extends h_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(MT,e,i)}},MT.ElementType="i8",MT);var ET;let eIt=(ET=class extends l_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(ET,e,i)}},ET.ElementType="i16",ET);var AT;let wG=(AT=class extends c_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(AT,e,i)}},AT.ElementType="i16",AT);var OT;let tIt=(OT=class extends u_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(OT,e,i)}},OT.ElementType="i16",OT);var PT;let aBe=(PT=class extends h_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(PT,e,i)}},PT.ElementType="i16",PT);var RT;let iIt=(RT=class extends l_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(RT,e,i)}},RT.ElementType="i32",RT);var IT;let rIt=(IT=class extends c_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(IT,e,i)}},IT.ElementType="i32",IT);var DT;let sIt=(DT=class extends u_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(DT,e,i)}},DT.ElementType="i32",DT);var kT;let nIt=(kT=class extends h_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(kT,e,i)}},kT.ElementType="i32",kT);function STe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":case"f16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let TTe=class oBe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new oBe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const a=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(a)}else{const a=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(a)}return this}get usedMemory(){return this.byteLength}dispose(){}},aIt=class lBe{constructor(e){this._stride=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:lIt(i[1].constructor)})))}freeze(){return this}get locations(){return Rp(bl(this))}vec2f16(e,i){return this._appendField(e,Gf?UUe:_G,i),this}vec2f(e,i){return this._appendField(e,_G,i),this}vec2f64(e,i){return this._appendField(e,JUe,i),this}vec3f16(e,i){return this._appendField(e,Gf?BUe:Fw,i),this}vec3f(e,i){return this._appendField(e,Fw,i),this}vec3f64(e,i){return this._appendField(e,QUe,i),this}vec4f16(e,i){return this._appendField(e,Gf?qUe:o$,i),this}vec4f(e,i){return this._appendField(e,o$,i),this}vec4f64(e,i){return this._appendField(e,XUe,i),this}mat3f(e,i){return this._appendField(e,GUe,i),this}mat3f64(e,i){return this._appendField(e,HUe,i),this}mat4f(e,i){return this._appendField(e,WUe,i),this}mat4f64(e,i){return this._appendField(e,ZUe,i),this}vec4u8(e,i){return this._appendField(e,rd,i),this}f16(e,i){return this._appendField(e,Gf?HRt:aL,i),this}f32(e,i){return this._appendField(e,aL,i),this}f64(e,i){return this._appendField(e,YUe,i),this}u8(e,i){return this._appendField(e,bG,i),this}u16(e,i){return this._appendField(e,eBe,i),this}i8(e,i){return this._appendField(e,sBe,i),this}vec2i8(e,i){return this._appendField(e,nBe,i),this}vec2i16(e,i){return this._appendField(e,wG,i),this}vec2u8(e,i){return this._appendField(e,KUe,i),this}vec2u16(e,i){return this._appendField(e,tBe,i),this}vec4u16(e,i){return this._appendField(e,iBe,i),this}vec4i16(e,i){return this._appendField(e,aBe,i),this}u32(e,i){return this._appendField(e,rBe,i),this}_appendField(e,i,r){this._fields.has(e)&&xt(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*STe(i.ElementType),n=this._stride;this._fields.set(e,{constructor:i,size:s,offset:n,optional:r}),this._alignFields()}_alignFields(){let e=0,i=1;this._fields.forEach(r=>{const s=STe(r.constructor.ElementType);e=Math.floor((e+s-1)/s)*s,r.offset=e,e+=r.size,i=Math.max(i,s)}),e=Math.floor((e+i-1)/i)*i,this._stride=e}createBuffer(e){return new TTe(this,e)}createView(e){return new TTe(this,e)}clone(){const e=new lBe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){return this._stride}get fields(){return this._fields}};function Qu(){return new aIt}let Svi=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:cBe(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const oIt=[aL,_G,Fw,o$,GUe,WUe,YUe,JUe,QUe,XUe,HUe,ZUe,bG,KUe,WRt,rd,eBe,tBe,ZRt,iBe,rBe,YRt,JRt,QRt,sBe,nBe,XRt,KRt,eIt,wG,tIt,aBe,iIt,rIt,sIt,nIt];function cBe(t){return`${t.ElementType}_${t.ElementCount}`}function lIt(t){return uBe.get(t)}const uBe=new Map;oIt.forEach(t=>uBe.set(cBe(t),t));let Nc=class extends be{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=ps.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([X(()=>this.view.ready,e=>{e&&this.view.stage?.renderer.addRenderNode(this)},Yt)])}destroy(){this.view.stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new q("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view.stage.renderView.renderingContext.gl}get techniques(){return this.view.stage.renderView.techniques}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,i=this.view.stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return i.fbo?.initializeAndBind(),i}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){switch(e){case 2:this.view.state.fading=!0;case 1:this.view.stage?.renderView.requestRender(e);case 0:case void 0:this._dirty=!0}}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view.stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view.stage.renderView.renderingContext}get renderContext(){return this.view.stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find(({name:i})=>i===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};c([p({constructOnly:!0})],Nc.prototype,"view",void 0),c([p({constructOnly:!0})],Nc.prototype,"consumes",void 0),c([p()],Nc.prototype,"produces",void 0),c([p({readOnly:!0})],Nc.prototype,"techniques",null),Nc=c([R("esri.views.3d.webgl.RenderNode")],Nc);let Fg=class extends Nc{constructor(){super(...arguments),this.produces="disabled",this.consumes={required:[wt.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=wt.OPAQUE_ENVIRONMENT,this.requestRender(1)}_disable(){this.produces="disabled",this.requestRender(1)}};c([p()],Fg.prototype,"produces",void 0),c([p()],Fg.prototype,"consumes",void 0),Fg=c([R("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],Fg);let NS=class extends Fg{constructor(){super(...arguments),this.consumes={required:[wt.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=wt.TRANSPARENT_ENVIRONMENT,this.requestRender(1)}};c([p()],NS.prototype,"consumes",void 0),NS=c([R("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],NS);const WQ=()=>re.getLogger("esri.views.webgl.VertexArrayObject");let H0=class hBe{constructor(e,i,r,s){this._context=e,this._indexBuffer=r,this._buffers=i instanceof Map?i:new Map([["geometry",i]]),this._baseInstances=s==null?new Map:typeof s=="number"?new Map([["geometry",s]]):s,this.locations=gRt(this._buffers)}get glName(){return this._glName}get context(){return this._context}get buffers(){return this._buffers}buffer(e="geometry"){return this.buffers.get(e)}get indexBuffer(){return this._indexBuffer}getByteLength(e){return this.buffer(e)?.sizeBytes??0}vertexCount(e){const i=this.buffer(e);return i?i.sizeBytes/i.layout[0].stride:0}get usedMemory(){return Array.from(this._buffers.values()).reduce((e,i)=>e+i.usedMemory,this._indexBuffer?.usedMemory??0+(this._buffers.size+(this._indexBuffer?1:0))*fde)}dispose(){this._context?(this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this._indexBuffer=jt(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&WQ().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(mn.VertexArrayObject,this)),this._context=null):this._glName&&WQ().warn("Leaked WebGL VAO")}bind(e=this.locations){const i=this._context.gl;this._glName?i.bindVertexArray(this._glName):(this._context.instanceCounter.increment(mn.VertexArrayObject,this),this._glName=i.createVertexArray(),i.bindVertexArray(this._glName),this._bindLayout(e))}_bindLayout(e){const{_buffers:i,_indexBuffer:r}=this;if(i||WQ().error("Vertex buffer dictionary is empty!"),i.forEach((s,n)=>xze(this._context,e,s,this._baseInstances.get(n)??0)),r!=null){const s=this._context.gl;this._context.gl.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}}unbind(){this._context.gl.bindVertexArray(null)}shallowCloneWithBaseInstances(e){return new hBe(this._context,this._buffers,this._indexBuffer,e)}},bm=class extends H0{},vn=class extends id{constructor(e,i,r,s=35044){super(e,34962,s,r),this.layout=i}},SB=class extends NS{constructor(e){super(e),this._hasSnowCover=!1,this._rainSpeed=.1,this._snowSpeed=.01,this._numParticles=0,this._passParameters=new jRt,this._configuration=new FUe;const{view:i,type:r}=e;this._configuration.type=r==="rainy"?0:1,i.stage.renderView.techniques.precompile(wTe,this._configuration),this._passParameters.time=0,this._passParameters.radius=xr(i.spatialReference).radius,this.addHandles([X(()=>i.environment.weather,s=>{s.type===r&&this.addHandles([X(()=>s.precipitation,n=>this._adjustParticles(n),bt),X(()=>s.type==="snowy"&&s.snowCover==="enabled",n=>this._hasSnowCover=n,bt)])},bt)]),this.addHandles(X(()=>i.stage?.renderer.renderContext.bind.clouds.fadeFactor??1,s=>{this._passParameters.opacity=s,s===1&&(this.removeHandles("opacity"),this.addHandles(X(()=>i.stage?.renderer.renderContext.bind.clouds.opacity??1,n=>this._passParameters.opacity=n,bt),"opacity"))},Ht),"opacity")}initialize(){this.addHandles([X(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),bt)])}_adjustParticles(e){const r=e<.5?yt(0,.35,2*e):yt(.35,1,2*(e-.5));this._numParticles=$Te*r}destroy(){this._numParticles=0,this._vao=jt(this._vao),this._instanceIdBuffer=jt(this._instanceIdBuffer)}fadeOut(e){this.removeAllHandles(),this.addHandles(X(()=>this.renderContext?.bind.clouds.fadeFactor??1,i=>{this._passParameters.opacity=1-i,i===1&&(this.removeAllHandles(),e())}),"opacity")}get snowCover(){return this._hasSnowCover?this._passParameters.opacity:null}updateAnimation(e){const i=(this.type==="rainy"?this._rainSpeed:this._snowSpeed)*Ole(e.time)%1e5;return this._passParameters.time!==i&&(this._passParameters.time=i,!0)}render(e){const i=this.renderingContext,r=Math.round(this._numParticles*this._passParameters.opacity),s=e.find(({name:o})=>o===wt.TRANSPARENT_ENVIRONMENT);if(r<1)return s;const n=this.techniques.get(wTe,this._configuration);if(!n.compiled)return this.requestRender(1),s;const a=i.bindTechnique(n,this.bindParameters,this._passParameters);return this._vao??=cIt(i),i.bindVAO(this._vao),this._bindInstanceIdBuffer(a.locations),a.assertCompatibleVertexAttributeLocations(this._vao,Rp(CTe)),i.drawArraysInstanced(Sr.TRIANGLES,0,3,r),i.unbindBuffer(34962),s}_bindInstanceIdBuffer(e){const i=this.renderingContext;if(this._instanceIdBuffer)return void i.bindBuffer(this._instanceIdBuffer);const r=IP($Te);this._instanceIdBuffer=new vn(i,CTe,new Float32Array(r)),xze(i,e,this._instanceIdBuffer,0)}};function cIt(t){const e=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new bm(t,new vn(t,bl(uIt),e))}c([p({constructOnly:!0})],SB.prototype,"type",void 0),SB=c([R("esri.views.3d.environment.Precipitation")],SB);const $Te=25e4,uIt=Qu().vec3f("position").freeze(),CTe=bl(Qu().f32("instanceFeatureAttribute"),1);var hae;let vk=hae=class extends ae{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new hae({cloudCover:this.cloudCover})}};c([st({cloudy:"cloudy"}),p({json:{write:{isRequired:!0}}})],vk.prototype,"type",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],vk.prototype,"cloudCover",void 0),vk=hae=c([R("esri.views.3d.environment.CloudyWeather")],vk);const hIt=vk;var dae;let _k=dae=class extends ae{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new dae({fogStrength:this.fogStrength})}};c([st({foggy:"foggy"}),p({json:{write:{isRequired:!0}}})],_k.prototype,"type",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_k.prototype,"fogStrength",void 0),_k=dae=c([R("esri.views.3d.environment.FoggyWeather")],_k);const dIt=_k;var pae;let I3=pae=class extends ae{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new pae({cloudCover:this.cloudCover,precipitation:this.precipitation})}};c([st({rainy:"rainy"}),p({json:{write:{isRequired:!0}}})],I3.prototype,"type",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],I3.prototype,"cloudCover",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],I3.prototype,"precipitation",void 0),I3=pae=c([R("esri.views.3d.environment.RainyWeather")],I3);const pIt=I3;var fae;let T2=fae=class extends ae{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new fae({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};c([st({snowy:"snowy"}),p({json:{write:{isRequired:!0}}})],T2.prototype,"type",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T2.prototype,"cloudCover",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T2.prototype,"precipitation",void 0),c([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],T2.prototype,"snowCover",void 0),T2=fae=c([R("esri.views.3d.environment.SnowyWeather")],T2);const fIt=T2;var mae;let bk=mae=class extends ae{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new mae({cloudCover:this.cloudCover})}};c([st({sunny:"sunny"}),p({json:{write:{isRequired:!0}}})],bk.prototype,"type",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],bk.prototype,"cloudCover",void 0),bk=mae=c([R("esri.views.3d.environment.SunnyWeather")],bk);const xG=bk,Fde={key:"type",base:xG,typeMap:{sunny:xG,cloudy:hIt,rainy:pIt,snowy:fIt,foggy:dIt}},mIt=Object.keys(Fde.typeMap);function gIt(t,e){return!!mIt.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const mS=1e4,yIt=1e5,dBe={required:[]},vIt={required:[2]};let pBe=class extends be{precompile(e){return!!this.acquireTechniques(e)}consumes(){return dBe}get usedMemory(){return 0}get renderOccludedFlags(){return 1}get isDecoration(){return!1}get readyToRun(){return!1}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmitters(){return!1}forEachGeometry(e){}},VF=class extends pBe{},Ivi=class extends pBe{},$2=class extends VF{constructor(e){super(e),this.produces=new Map([]),this._clouds=ta(null),this._incarnation=0,this._precipitation=null}initialize(){this.view.stage?.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?.stage?.removeRenderPlugin(this),this._set("view",null)}get updating(){return!!this._clouds.value?.readyToRun}get weatherAvailable(){return Ve(this.view.state.camera.eye)-xr(this.view.spatialReference).radius<=mS}get usedMemory(){return this._clouds.value?.usedMemory??0}_fadeOutPrecipitation(){this._precipitation&&(this._precipitationOutgoing?.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut(()=>this._precipitationOutgoing=Pe(this._precipitationOutgoing)),this._precipitation=null,++this._incarnation)}get _snowCover(){return this._precipitationOutgoing?.snowCover??this._precipitation?.snowCover??0}get weather(){return this.view?.environmentManager?.weatherEnabled?this.view.environment.weather:null}initializeRenderContext(e){this._context=e;const i=this.view,r=()=>this._requestRender();this.addHandles([X(()=>this._precipitation,r,Ht),X(()=>this._clouds.value?.state,r,Ht),X(()=>i.state.mode,r,Ht),X(()=>this._updateClouds(),r,Ht),X(()=>this._updatePrecipitation(),r,Ht),X(()=>this.weather,s=>this._initWeather(s))])}uninitializeRenderContext(){this._context=null,this._clouds.value=Pe(this._clouds.value),this._precipitation=Pe(this._precipitation),this._precipitationOutgoing=Pe(this._precipitationOutgoing)}prepareRender(e){const{bind:i,time:r}=e;if(this.view.state.viewingMode===1){if(i.clouds.data){i.clouds.fade(i.camera,r,this.view.qualitySettings.fadeDuration);const s=this._clouds.value;s&&s.state===0&&s.coverage===0&&!s.readyToRun&&s.destroyCubeMap()}i.snowCover=this._snowCover}}acquireTechniques(){return[]}render(){}_requestRender(){this._context?.requestRender()}_initWeather(e){const i=this._context;if(!e||!i)return void(this._clouds.value=Pe(this._clouds.value));if(this._clouds.value)return;const r=this.view;this._clouds.value=new _c({context:i,view:r,requestRender:()=>this._requestRender()})}_updateClouds(){const e=this.view.environment.weather;return e==null||this._clouds.value==null||this._clouds.value.applyPreset(Vo[e.type],_It(e)),++this._incarnation}_updatePrecipitation(){const e=this.view.environment.weather;if(e.type===this._precipitation?.type)return this._incarnation;this._fadeOutPrecipitation();const i=e.type==="rainy"||e.type==="snowy",r=this._context;return i&&r&&(this._precipitation=new SB({view:this.view,type:e.type}),++this._incarnation),this._incarnation}hasHighlight(){return!1}get test(){}};function _It(t){switch(t.type){case"rainy":case"snowy":case"cloudy":case"sunny":return t.cloudCover;case"foggy":return t.fogStrength}}c([p({constructOnly:!0})],$2.prototype,"view",void 0),c([p({type:Boolean,readOnly:!0})],$2.prototype,"updating",null),c([p()],$2.prototype,"weatherAvailable",null),c([p()],$2.prototype,"_context",void 0),$2=c([R("esri.views.3d.environment.EnvironmentRenderer")],$2);var TH=Math.PI,gn=Math.sin,xo=Math.cos,zde=Math.tan,fBe=Math.asin,Nde=Math.atan2,mBe=Math.acos,Sa=TH/180,gBe=864e5,yBe=2440588,vBe=2451545,bIt={dec:0,ra:0};function wIt(t){return t.valueOf()/gBe-.5+yBe}function ij(t){return new Date((t+.5-yBe)*gBe)}function TB(t){return wIt(t)-vBe}var SG=23.4397*Sa;function _Be(t,e){return Nde(gn(t)*xo(SG)-zde(e)*gn(SG),xo(t))}function Vde(t,e){return fBe(gn(e)*xo(SG)+xo(e)*gn(SG)*gn(t))}function bBe(t,e,i){return Nde(gn(t),xo(t)*gn(e)-zde(i)*xo(e))}function wBe(t,e,i){return fBe(gn(e)*gn(i)+xo(e)*xo(i)*xo(t))}function xBe(t,e){return Sa*(280.16+360.9856235*t)-e}function SBe(t){return Sa*(357.5291+.98560028*t)}function TBe(t){return Sa*(1.9148*gn(t)+.02*gn(2*t)+3e-4*gn(3*t))}function $Be(t,e){return t+e+102.9372*Sa+TH}function CBe(t,e){var i=SBe(t),r=$Be(i,TBe(i));return e||(e={dec:0,ra:0}),e.dec=Vde(r,0),e.ra=_Be(r,0),e}var Dc={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,e,i,r){var s=Sa*-i,n=Sa*e,a=TB(t),o=CBe(a,bIt),l=xBe(a,s)-o.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=bBe(l,n,o.dec),r.altitude=wBe(l,n,o.dec),r}},$B=[[-.83,"sunrise","sunset"]];Dc.addTime=function(t,e,i){$B.push([t,e,i])};var MBe=9e-4;function xIt(t,e){return Math.round(t-MBe-e/(2*TH))}function MTe(t,e,i){return MBe+(t+e)/(2*TH)+i}function ETe(t,e,i){return vBe+t+.0053*gn(e)-.0069*gn(2*i)}function SIt(t,e,i){return mBe((gn(t)-gn(e)*gn(i))/(xo(e)*xo(i)))}function ATe(t){var e=Sa*(134.963+13.064993*t),i=Sa*(93.272+13.22935*t),r=Sa*(218.316+13.176396*t)+6.289*Sa*gn(e),s=5.128*Sa*gn(i),n=385001-20905*xo(e);return{ra:_Be(r,s),dec:Vde(r,s),dist:n}}Dc.getTimes=function(t,e,i){var r=Sa*-i,s=Sa*e,n=xIt(TB(t),r),a=MTe(0,r,n),o=SBe(a),l=TBe(o),u=$Be(o,l),d=Vde(u,0),f=ETe(a,o,u);function g(P){return ETe(MTe(SIt(P,s,d),r,n),o,u)}function v(P){var O=(gn(P)-gn(s)*gn(d))/(xo(s)*xo(d));return O<-1?Dc.PolarException.MIDNIGHT_SUN:O>1?Dc.PolarException.POLAR_NIGHT:Dc.PolarException.NORMAL}var _,x,S,T,M,E={solarNoon:ij(f),nadir:ij(f-.5),polarException:Dc.PolarException.NORMAL};for(_=0,x=$B.length;_<x;_+=1)M=f-((T=g((S=$B[_])[0]*Sa))-f),E[S[1]]=ij(M),E[S[2]]=ij(T);return E.polarException=v($B[0][0]*Sa),E},Dc.getMoonPosition=function(t,e,i){var r=Sa*-i,s=Sa*e,n=TB(t),a=ATe(n),o=xBe(n,r)-a.ra,l=wBe(o,s,a.dec);return l+=.017*Sa/zde(l+10.26*Sa/(l+5.1*Sa)),{azimuth:bBe(o,s,a.dec),altitude:l,distance:a.dist}},Dc.getMoonFraction=function(t){var e=TB(t),i=CBe(e),r=ATe(e),s=149598e3,n=mBe(gn(i.dec)*gn(r.dec)+xo(i.dec)*xo(r.dec)*xo(i.ra-r.ra)),a=Nde(s*gn(n),r.dist-s*xo(n));return(1+xo(a))/2};const ql={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let rj=class{constructor(e,i){this.direct=e,this.ambient=i}};function TIt(t,e,i,r,s,n){xe(n.ambient.color,1,1,1),n.ambient.intensity=ql.global.ambient,xe(n.direct.color,1,1,1),n.direct.intensity=ql.global.direct;const a=e[2],o=Ce((Math.abs(a)-ql.local.altitude)/(ql.global.altitude-ql.local.altitude),0,1);let l;if(n.globalFactor=o,t!=null&&(l=Dc.getTimes(t,e[1],e[0])),o<1){let u;if(t!=null)u=PIt(t,l,r);else{const d=ABe(r);u={direct:{intensity:ql.local.directAtNoon*d.direct,color:Ye(1,1,1)},ambient:{intensity:ql.local.ambientAtNoon*d.ambient,color:Ye(1,1,1)},timeOfDay:"early afternoon"}}cr(n.ambient.color,u.ambient.color,n.ambient.color,o),n.ambient.intensity=yt(u.ambient.intensity,n.ambient.intensity,o),cr(n.direct.color,u.direct.color,n.direct.color,o),n.direct.intensity=yt(u.direct.intensity,n.direct.intensity,o),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?OIt(t,l):1,t!=null?$It(t,e,i,n.direct.directionToLightSource):EBe(s,i,n.direct.directionToLightSource)}function EBe(t,e,i){e===1?Re(QQ,t.eye):xe(QQ,0,0,1),he(XQ,t.viewForward,-1);const r=lH(XQ,QQ),s=Math.max(r-2*KQ,0),n=.85*s/(s+1),a=Math.max(KQ,r-KQ-n);Cp(jTe,-a,t.viewRight),Ft(i,XQ,jTe),$e(i,i,he(RIt,t.viewRight,IIt)),Re(i,i)}function $It(t,e,i,r){const s=AIt,n=lm(EIt);if(i===1)Dc.getPosition(t,0,0,s),xe(r,0,0,-1),OO(n,n,-s.azimuth),E7(n,n,-s.altitude),Ft(r,r,n);else{const a=ql.planarDirection,o=a.globalAngles,l=e[2];let u=(Math.abs(l)-a.localAltitude)/(a.globalAltitude-a.localAltitude);u=Ce(u,0,1),u<1?(Dc.getPosition(t,e[1],e[0],s),s.azimuth=(1-u)*s.azimuth+u*o.azimuth,s.altitude=(1-u)*s.altitude+u*o.altitude):(s.azimuth=o.azimuth,s.altitude=o.altitude),xe(r,0,-1,0),PO(n,n,-s.azimuth),OO(n,n,-s.altitude),Ft(r,r,n)}}function CIt(t,e){if(e===1)return!0;const i=ql.planarDirection;return Math.abs(t)<i.localAltitude}const MIt=Ye(.5773502691896258,-.5773502691896258,.5773502691896258);let OTe=class{constructor(){this.ambient={color:Ye(1,1,1),intensity:.55},this.direct={color:Ye(1,1,1),intensity:.55,directionToLightSource:Tr(MIt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const EIt=ut(),AIt={azimuth:0,altitude:0};function OIt(t,e){const i=t.valueOf();let r,s;e.polarException===Dc.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===Dc.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-Ce(Math.abs(i-n)/432e5,0,1)}function ABe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new rj(1,1);case"rainy":return new rj(.4,1.2);case"snowy":return new rj(.5,1.3);case"foggy":return new rj(.2,1.6)}}function PTe(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const ZQ=Ye(.01,.01,.01),gae=Ye(1,.6,.5),yae=Ye(1,.98,.98),RTe=Ye(1,1,1),YQ=Ye(.8,.8,1),vae=Ye(.8,.8,1),_ae=Ye(.98,.98,1),ITe=Ye(1,1,1),JQ=Cs(.01,ql.local.ambientAtNight),bae=Cs(ql.local.directAtTwilight,ql.local.ambientAtTwilight),wae=Cs(.9*ql.local.directAtNoon,ql.local.ambientAtNoon),DTe=Cs(ql.local.directAtNoon,ql.local.ambientAtNoon),kTe=wae,LTe=yae,FTe=_ae,zTe=bae,NTe=gae,VTe=vae;function PIt(t,e,i){const r=t.valueOf();let s,n;e.polarException===Dc.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Dc.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const a=n-s,o=s+a/2,l=a/4,u=o-l,d=o+l,f=.06*a,g=s-f/2,v=s+f/2,_=n-f/2,x=n+f/2,S=Ke(),T=I(),M=I();let E="";if(r<g||r>x)na(S,JQ),me(T,ZQ),me(M,YQ),E="night";else if(r<v){const D=(r-g)/(v-g);Ou(S,JQ,bae,D),cr(T,ZQ,gae,D),cr(M,YQ,vae,D),E="sun rising"}else if(r<u){const D=(r-v)/(u-v);Ou(S,bae,wae,D),cr(T,gae,yae,D),cr(M,vae,_ae,D),E="early morning"}else if(r<o){const D=(r-u)/(o-u);Ou(S,wae,DTe,D),cr(T,yae,RTe,D),cr(M,_ae,ITe,D),E="late morning"}else if(r<d){const D=(r-o)/(d-o);Ou(S,DTe,kTe,D),cr(T,RTe,LTe,D),cr(M,ITe,FTe,D),E="early afternoon"}else if(r<_){const D=(r-d)/(_-d);Ou(S,kTe,zTe,D),cr(T,LTe,NTe,D),cr(M,FTe,VTe,D),E="late afternoon"}else if(r<x){const D=(r-_)/(x-_);Ou(S,zTe,JQ,D),cr(T,NTe,ZQ,D),cr(M,VTe,YQ,D),E="sun setting"}let P=0;switch(i){case"rainy":case"foggy":P=.8;break;case"snowy":P=.5}P>0&&(PTe(T,P),PTe(M,P));const O=ABe(i);return{direct:{intensity:S[0]*O.direct,color:T},ambient:{intensity:S[1]*O.ambient,color:M},timeOfDay:E}}const jTe=ut(),QQ=I(),XQ=I(),RIt=I(),KQ=.25,IIt=.2;let jde=class{constructor(e=c1()){this.intensity=e}},OBe=class{constructor(e=c1(),i=Ye(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},TG=class{constructor(e=c1(),i=Ye(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},PBe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}},mf=class extends Ju{constructor(e){super(e),this._tmpLightParameters=new OTe,this._defaultLightParameters=new OTe,this._tmpDate=new Date,this._tmpTz={hours:0,minutes:0,seconds:0},this._viewHandlesKey="viewHandles",this._trackingEnabled=!1,this._mainLight=new TG,this._ambientLight=new jde,this._moonLight=new OBe,this._disableWeather=!1,this._renderer=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!!this._renderer?.updating||!this._canProjectCameraPosition}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===1&&QL(this._view.spatialReference)}get _weatherAvailable(){return this.weatherEnabled&&this._renderer?.weatherAvailable}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){const e=this._view?.stateManager?.camera?.position?.spatialReference??Me.WGS84,i=mTe(e);return rw(e,i)}connectView(e){if(this._renderer)return;this._renderer=new $2({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([X(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Ht),X(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Ht),X(()=>e.environment.lighting.directShadowsEnabled,i,Ht),X(()=>e.qualitySettings.ambientOcclusion,i,Ht),X(()=>e.qualitySettings.reflections,i,Ht),X(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Ht),X(()=>[e.environment.weather.type,this.weatherEnabled],()=>this._updateLighting(null,1),Ht),X(()=>e.environment.weather.type==="snowy"&&e.environment.weather.snowCover,i,Ht),X(()=>e.environment,s=>s.setComputeWeatherAvailable(()=>this._weatherAvailable),bt),X(()=>e.viewingMode,()=>this._resetReferencePosition(!0),bt),X(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),bt),X(()=>e.state.camera,r,bt),vs(()=>this._canProjectCameraPosition,r,Ht)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Pe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;i?.type!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if(i?.type!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(e),this._referencePositionGeographic!=null)){const r=oTe(this._referencePositionGeographic,this._tmpTz);r!=null&&(i.autoUpdate(null,r),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;if(!r)return;const{position:s}=r,n=s.spatialReference??Me.WGS84,a=mTe(n);if(!Jc(s,sj,a))return this._referencePositionGeographic==null?void 0:(this._referencePositionGeographic=null,void this._updateLighting());this._referencePositionGeographic?m1(this._referencePositionGeographic,sj)||(me(this._referencePositionGeographic,sj),this.notifyChange("referencePositionGeographic")):this._referencePositionGeographic=Tr(sj),this._autoUpdateTimezone(this._referencePositionGeographic,e)||this._updateLighting(e)}_updateLighting(e,i=0){const r=this._view,{lighting:s}=r.environment,n=s.type==="virtual",a=this._referencePositionGeographic,o=a!=null?this._tmpLightParameters:this._defaultLightParameters;if(a){e??=n?null:s.date;const v=this._weatherAvailable?r.environment.weather.type:"disabled";TIt(e,a,r.state.viewingMode,v,r.state.camera,o)}else n&&EBe(r.state.camera,r.state.viewingMode,o.direct.directionToLightSource);const l=this._mainLight,u=o.direct;he(l.intensity,u.color,u.intensity*Math.PI),me(l.direction,u.directionToLightSource),l.specularStrength=o.specularStrength,l.environmentStrength=o.environmentStrength;const d=this._ambientLight;he(d.intensity,o.ambient.color,o.ambient.intensity);const f=this._moonLight;cr(f.intensity,DIt,kIt,o.globalFactor);const g=(1-.5*o.globalFactor)*(1-.4*o.noonFactor*(1-o.globalFactor));he(f.intensity,f.intensity,g),me(f.direction,u.directionToLightSource),this._view.stage?.renderer.updateLighting([l,d,f],o.noonFactor,o.globalFactor,this._weatherAvailable?i:0),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=this._tmpDate;r.setTime((i||this._view.environment.lighting.date).getTime());const s=oTe(e,this._tmpTz);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const a=r.getUTCHours()-(s.hours-n.hours),o=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(a),r.setUTCMinutes(o),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view.stage;if(!e)return;const i=this._referencePositionGeographic==null||CIt(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._weatherAvailable,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._referencePositionGeographic=null,e&&this._cameraHandler()}get test(){}};c([p({type:Boolean,readOnly:!0})],mf.prototype,"updating",null),c([p()],mf.prototype,"_disableWeather",void 0),c([p()],mf.prototype,"weatherEnabled",null),c([p()],mf.prototype,"_weatherAvailable",null),c([p()],mf.prototype,"referencePositionGeographic",null),c([p()],mf.prototype,"_referencePositionGeographic",void 0),c([p()],mf.prototype,"_renderer",void 0),c([p()],mf.prototype,"_canProjectCameraPosition",null),mf=c([R("esri.views.3d.environment.EnvironmentManager")],mf);const DIt=Ye(.22,.22,.33),kIt=Ye(.22,.22,.22),sj=I();var xae,KA;let Rd=(KA=class extends ae{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,i){return i.datetime!=null&&new Date(i.datetime)||null}writeDate(e,i,r){i[r]=e.getTime()}readDirectShadowsEnabled(e,i){return!!i.directShadows}writedirectShadowsEnabled(e,i,r){e&&(i[r]=e)}writeDisplayUTCOffset(e,i){e!=null&&(i.displayUTCOffset=e)}clone(){return new xae(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date)),e}},xae=KA,KA);c([p({readOnly:!0,type:["sun"],json:{write:!0}})],Rd.prototype,"type",void 0),c([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],Rd.prototype,"date",void 0),c([Oe("date",["datetime"])],Rd.prototype,"readDate",null),c([Ie("date")],Rd.prototype,"writeDate",null),c([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Rd.prototype,"directShadowsEnabled",void 0),c([Oe("directShadowsEnabled",["directShadows"])],Rd.prototype,"readDirectShadowsEnabled",null),c([Ie("directShadowsEnabled")],Rd.prototype,"writedirectShadowsEnabled",null),c([p({type:Number,json:{write:!0}})],Rd.prototype,"displayUTCOffset",void 0),c([Ie("displayUTCOffset")],Rd.prototype,"writeDisplayUTCOffset",null),Rd=xae=c([R("esri.webscene.SunLighting")],Rd);const l$=Rd;var D3;let k3=D3=class extends w$(l$){static calculateTimezoneOffset({hours:t,minutes:e,seconds:i}){return Math.round(t+e/60+i/3600)}constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate"))}static fromWebsceneLighting(t){return new D3(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t)))}autoUpdate(t,e){const i=D3.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t))));const s=D3.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(nj.target=this,nj.timezoneOffset=s,this.emit("timezone-will-change",nj),nj.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new D3({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};c([p({type:Boolean})],k3.prototype,"cameraTrackingEnabled",void 0),c([p({type:Date})],k3.prototype,"defaultDate",null),c([p({type:Date})],k3.prototype,"date",null),k3=D3=c([R("esri.views.3d.environment.SunLighting")],k3);const nj={target:null,timezoneOffset:0},C2=k3;var Sae,eO;let wk=(eO=class extends ae{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Sae(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}},Sae=eO,eO);c([p({readOnly:!0,type:["virtual"],json:{write:{isRequired:!0}}})],wk.prototype,"type",void 0),c([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],wk.prototype,"directShadowsEnabled",void 0),wk=Sae=c([R("esri.webscene.VirtualLighting")],wk);const jF=wk;var CB;let MB=CB=class extends w$(jF){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new CB({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new CB(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};c([p({type:Boolean})],MB.prototype,"cameraTrackingEnabled",void 0),MB=CB=c([R("esri.views.3d.environment.VirtualLighting")],MB);const xk=MB,LIt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:C2,virtual:xk}},RBe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:l$,virtual:jF}};let EB=class extends ae{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};c([p({readOnly:!0,json:{read:!1}})],EB.prototype,"type",void 0),EB=c([R("esri.webscene.background.Background")],EB);const IBe=EB;var Tae;let Sk=Tae=class extends IBe{constructor(t){super(t),this.type="color",this.color=new Je([0,0,0,1])}clone(){return new Tae(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};c([st({color:"color"},{readOnly:!0}),p({json:{write:{isRequired:!0}}})],Sk.prototype,"type",void 0),c([p(e_({nonNullable:!0,colorRequiredOnWrite:!0}))],Sk.prototype,"color",void 0),Sk=Tae=c([R("esri.webscene.background.ColorBackground")],Sk);const DBe=Sk,UTe={base:IBe,key:"type",typeMap:{color:DBe}};function FIt(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const zIt={types:UTe,json:{read:FIt(UTe),write:{overridePolicy:(t,e,i)=>({enabled:!i?.isPresentation})}}};var $ae;const BTe=(t,e,i)=>({enabled:!i?.isPresentation});var tO;let Rb=(tO=class extends ae{constructor(e){super(e),this.lighting=new l$,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){gIt(e?.type,re.getLogger(this))&&this._set("weather",e)}clone(){return new $ae(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?jF.prototype.clone.call(this.lighting):l$.prototype.clone.call(this.lighting),background:se(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}},$ae=tO,tO);c([p({types:RBe,nonNullable:!0,json:{write:!0}})],Rb.prototype,"lighting",void 0),c([p(zIt)],Rb.prototype,"background",void 0),c([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:BTe}}})],Rb.prototype,"atmosphereEnabled",void 0),c([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:BTe}}})],Rb.prototype,"starsEnabled",void 0),c([p({types:Fde,nonNullable:!0,json:{write:!0},value:new xG})],Rb.prototype,"weather",null),Rb=$ae=c([R("esri.webscene.Environment")],Rb);const UF=Rb;var Tk,iO;let M2=(iO=class extends UF{constructor(e){super(e),this.lighting=this.castLighting(),this._computeWeatherAvailable=void 0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){const i=e.cloneConstructProperties();return new Tk({...i,lighting:i.lighting?i.lighting.type==="virtual"?xk.fromWebsceneLighting(i.lighting):C2.fromWebsceneLighting(i.lighting):void 0})}get weatherAvailable(){return this._computeWeatherAvailable?.()??!1}setComputeWeatherAvailable(e){this._computeWeatherAvailable=e}castLighting(e){return this._convertLightingWithDestroy(e)}applyLighting(e){this.lighting=this._convertLightingWithDestroy(e)}_convertLightingWithDestroy(e){const i=this._convertLighting(e);return i!==e&&this.addHandles(W9(i)),i}_convertLighting(e){return e?e instanceof C2||e instanceof xk?e:e instanceof l$?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(e):new C2({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):e instanceof jF?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new xk({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):sm(LIt,e):new C2}clone(){return new Tk({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:se(this.background)})}cloneWithWebsceneEnvironment(e){return new Tk({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:se(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):C2.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):xk.fromWebsceneLighting(e.lighting);default:return e.lighting,C2.fromWebsceneLighting(e.lighting)}}},Tk=iO,iO);c([p({nonNullable:!0})],M2.prototype,"lighting",void 0),c([p()],M2.prototype,"_computeWeatherAvailable",void 0),c([p({readOnly:!0})],M2.prototype,"weatherAvailable",null),c([wi("lighting")],M2.prototype,"castLighting",null),M2=Tk=c([R("esri.views.3d.environment.SceneViewEnvironment")],M2);const L3=M2;let nd=class{constructor(e=15,i=0,r=0,s=null,n=null,a=0){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=a}};function oL(t,e){return(t&e)!==0}function $G(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const k$=new nd(0);function kBe(t,e,i,r){return e=e||t.viewForward,me(r,e),he(r,r,Math.sign(Le(e,i))),r}function Gvi(t,e,i,r){return BIt(t,e,i,jIt(r,e,i,!0))}function NIt(t,e,i,r){const s=Le(i,Ae(t,r,e));return $e(t,e,he(t,i,s))}const VIt={dir:I(),len:0,clip:Ke()};function jIt(t,e,i,r){const s=VIt;return t?(i&&r&&(s.len=Bi(e,i)),me(s.dir,t)):(s.len=Bi(e,i),Ae(s.dir,i,e),he(s.dir,s.dir,1/s.len)),s}function UIt(t,e,i){const r=Le(t,i.dir),s=-Ya(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function BIt(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!UIt(t[s],e,r))return!1;return!0}function qIt(t,e,i=k$){const r=Ude(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,a=kBe(e,i.interactionDirection,WIt(t,e,Math.sign(r),QIt),JIt),o=me(XIt,e.viewForward),l=s.intersectInfiniteManifold(um(e.eye,a),n,eX);return e.eye=l??s.setAltitude(eX,n,e.eye),e.center=NIt(eX,e.eye,o,e.center),!0}function Ude(t,e,i=k$){if(!GIt(t,i)||!t.state.constraints.altitude)return 0;const r=ZIt(t.state.constraints.altitude,YIt);HIt(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=Ce(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function GIt(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==2||!oL(e.selection,1))}function HIt(t,e,i){const r=e.interactionType;if(r===0)return;const{min:s,max:n}=i,{interactionStartCamera:a,interactionFactor:o}=e;if(!a)return;const l=r===2||r===1,u=Ude(t,a),d=u===0?0:t.renderCoordsHelper.getAltitude(a.eye);i.min=s,i.max=n,$G(u,d,l,o,.05*d,i)}function WIt(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),he(r,r,i),r}function ZIt(t,e){return e.min=t.min,e.max=t.max,e}const YIt={min:0,max:0},JIt=I(),QIt=I(),XIt=I(),eX=I();function Bde(t,e,i=k$){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;aj.min=0,aj.max=r,eDt(t,i,aj);const s=qde(t,e),n=aj.max-s;return n>=-1e-6?0:n}function KIt(t,e,i=k$){const r=Bde(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=qde(t,e)+r,a=me(iDt,e.eye),o=kBe(e,i.interactionDirection,tDt(e,s.renderLocation,nDt),sDt);if(!a_(ude(s.renderLocation,n),um(e.eye,o),oj))return!1;e.eye=oj;const l=Ae(rDt,e.eye,a);e.center=$e(oj,e.center,l);const u=t.renderCoordsHelper.getAltitude(e.center),d=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,u,oj);return d!=null&&(e.center=d),!0}function eDt(t,e,i){const r=e.interactionType;if(r===0)return;const{min:s,max:n}=i,{interactionStartCamera:a,interactionFactor:o}=e;if(!a)return;const l=r===1||r===4,u=Bde(t,a),d=u===0?0:qde(t,a);i.min=s,i.max=n,$G(u,d,l,o,.05*d,i)}function qde(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Bi(e.eye,i.renderLocation):0}function tDt(t,e,i){return L1(i,t.eye,e)}const aj={min:0,max:0},iDt=I(),rDt=I(),sDt=I(),nDt=I(),oj=I();function DP(t,e,i=0){const r=t.state.constraints.collision;if(!r.enabled)return!1;const s=yH(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),a=s+r.elevationMargin;if(n>=a)return!1;const o=Ve(e.eye);if(Ae(lj,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(aDt,a,e.eye),i===1)e.center=$e(lj,e.eye,lj);else if(i===2){const l=(o-n+a)/o;e.center=he(lj,e.center,l)}return!0}const lj=I(),aDt=I();function LBe(t,e,i,r=!0){$I.eyeCenterDistance=0,$I.requiresTwoSteps=!1;const s=Gde(t,e,i,k$,$I);if(s===0)return!1;switch(Cp(cj,-s,e.viewRight),i.tiltMode){case 1:Ft(K_,e.viewForward,cj),he(K_,K_,$I.eyeCenterDistance),e.center=$e(ow,e.eye,K_);break;case 0:Ae(K_,e.center,e.eye),Ft(K_,K_,cj),e.eye=Ae(ow,e.center,K_);break;default:i.tiltMode}return e.up=Ft(ow,e.up,cj),!$I.requiresTwoSteps||!r||LBe(t,e,i,!1)}function Gde(t,e,i,r=k$,s){if(!t.state.constraints.tilt)return 0;const n=Math.min(e.relativeElevation*AB,e.distance),a=t.state.constraints.tilt(n,gDt);return mDt(t,i,a),r.interactionType===2&&oL(r.selection,2)&&FBe(t,r.interactionStartCamera,a),i.tiltMode===1||r.tiltMode===1?lDt(t,e,a,s):oDt(t,e,a)}function oDt(t,e,i){const r=G0(t.renderCoordsHelper,e.center,e.eye),s=r-Ce(r,i.min,i.max);return lL(s)?s:0}function lDt(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return uDt(t,e,i,r);case"local":return cDt(t,e,i,r)}}function cDt(t,e,i,r){const s=G0(t.renderCoordsHelper,e.center,e.eye),n=Ce(s,i.min,i.max),a=s-n;if(!lL(a))return 0;if(r){const o=Math.abs(t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),l=t.renderCoordsHelper.getAltitude(e.eye)-o,u=Math.max(Math.cos(n),1e-4);Math.abs(u)>1e-4?r.eyeCenterDistance=l/u:r.eyeCenterDistance=e.distance}return a}function uDt(t,e,i,r){const s=hDt(t,e,yDt),n=Ce(s.tiltAtCenter,i.min,i.max);if(!lL(s.tiltAtCenter-n))return 0;let a,o;return s.centerIsOnSurface?(a=dDt(s),o=pDt(s,a)):(a=s.constraints.clampTilt(s.distance,s.tiltAtCenter),r&&a<Math.PI/2&&(r.requiresTwoSteps=!0,a=Math.PI/2-1e-5),o=fDt(s,a)),r&&(r.eyeCenterDistance=Cae(s,a)),o}function hDt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+xr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,ow);return i.distance=Math.min(e.relativeElevation*AB,e.distance),i.centerIsOnSurface=!1,n!=null?(i.distance=Math.min(e.relativeElevation*AB,Bi(e.eye,n)),i.tiltAtCenter=G0(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=G0(t.renderCoordsHelper,e.center,e.eye):(PP(O$(pH,s),e.ray,ow),i.distance=Math.min(e.relativeElevation*AB,Bi(e.eye,ow)),i.tiltAtCenter=Ao(-Le(e.viewForward,Re(ow,ow)))),i.radius=s,i.eyeRadius=Ve(e.eye),i.constraints=t.state.constraints,i}function lL(t){return Math.abs(t)>1e-9}function dDt(t){const{constraints:e,distance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const a=Cae(t,n);if(e.clampTilt(a,r)===n)return n;let o=0;for(;o<10&&lL(n-s);){const l=(s+n)/2,u=Cae(t,l);lL(e.clampTilt(u,l)-l)?s=l:n=l,o++}return n}function Cae(t,e){if(!t.centerIsOnSurface)return t.distance;const i=Math.PI-Ce(e,0,Math.PI),r=Qh(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const a=Math.PI-r,o=Math.PI-i-a;return Math.sin(o)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function pDt(t,e){const i=Qh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Qh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function fDt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function mDt(t,e,i){if(e.interactionType===0)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:a}=i,o=Gde(t,r,k$,e),l=o===0?0:G0(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=a,e.interactionType===2?(oL(e.selection,2)&&FBe(t,r,i),$G(o,l,!0,s,qTe,i)):$G(o,l,!1,s,qTe,i)}function FBe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=ea(e.center),n=Math.sqrt(s),a=e.distance,o=xr(t.spatialReference).radius,l=r.altitude.min+o,u=r.altitude.max+o,d=(l*l-a*a-s)/(-2*n*a),f=(u*u-a*a-s)/(-2*n*a);i.min=Math.max(i.min,Math.min(Math.PI-Ao(f),i.max)),i.max=Math.min(i.max,Math.PI-Ao(d))}const K_=I(),cj=ut(),ow=I(),qTe=zt(5),AB=30,gDt={min:0,max:0},yDt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,distance:0,tiltAtCenter:0},$I={eyeCenterDistance:0,requiresTwoSteps:!1};function As(t,e,i=wDt,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let o=0;o<xDt;o++){let l=0;for(const u of bDt)if(oL(i.selection,u.type)){const d=Math.abs(u.error(t,r,i));u.apply(t,r,i)&&(s=!0,l+=d)}if(l===0)break}const n=oL(i.selection,8),a=vDt(i.interactionType,t);return n&&DP(t,r,a)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function vDt(t,e){switch(t){case 4:return 1;case 5:return e.state.isGlobal?2:1;default:return 0}}function sp(t){const e=Math.min(1,t/150);return Jre(e)}function _Dt(t,e,i){return Gde(t,e,i)*e.distance}const bDt=[{type:1,error:_Dt,apply:LBe},{type:2,error:Ude,apply:qIt},{type:4,error:Bde,apply:KIt}],wDt=new nd,xDt=5;let GTe=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=I(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=Tr(HTe),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotate(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===1){const n=(Ve(this.center)+Ve(e.center))/2;i.pan=lH(this.center,e.center)*n}else i.pan=Bi(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===1?Aje(e.center,i.center,r.pan,this.center):cr(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?yt(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=yt(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=yt(s,n,r.rotate),this._fov=yt(e.fov,i.fov,r.fov)}copyFrom(e){me(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,me(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,WTe);me(this.center,e.center),Ae(Do,e.center,e.eye),Ql(Do,Do,i),Ql(tb,e.up,i),this._distance=Ve(Do),this._distance!==0&&(Do[0]/=this._distance,Do[1]/=this._distance,Do[2]/=this._distance),this._pitch=SDt(Do),this._yaw=TDt(Do,tb),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,WTe);R1(i,i),this._axisAngleVec3(OB,this._pitch-Math.PI/2,HTe,Do),this._axisAngleVec3(gS,this._yaw,Do,Do),this._axisAngleVec3(OB,this._pitch-Math.PI/2,gS,tb),this._axisAngleVec3(gS,this._yaw,tb,tb),he(Do,Do,this._distance),Ql(Do,Do,i),Ql(tb,tb,i),e.center=this.center,e.eye=Ae(Do,this.center,Do),e.up=tb,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),a=Math.sin(i);return he(hh,r,n),At(Su,e,r),he(Su,Su,a),he(eb,e,(1-n)*Le(e,r)),$e(s,$e(s,hh,Su),eb)}_lookAtOrientation(e,i=Jr()){return this._upAtLookAt(e,eb),At(hh,this.direction,eb),Re(hh,hh),hh[0]===0&&hh[1]===0&&hh[2]===0&&me(hh,OB),At(Su,eb,hh),Re(Su,Su),i[0]=hh[0],i[1]=Su[0],i[2]=eb[0],i[3]=hh[1],i[4]=Su[1],i[5]=eb[1],i[6]=hh[2],i[7]=Su[2],i[8]=eb[2],i}_upAtLookAt(e,i){return this.viewingMode===2?me(i,gS):Re(i,e)}};function SDt(t){return Math.PI-lH(gS,t)}function TDt(t,e){const i=$Dt;return Math.abs(e[2])<.5?(me(i,e),t[2]>0&&he(i,i,-1)):me(i,t),At(Su,i,gS),Re(Su,Su),lH(OB,Su,gS)}const hh=I(),Su=I(),eb=I(),Do=I(),tb=I(),$Dt=I(),gS=L0,HTe=Yce,OB=Zce,WTe=Jr();let CDt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new hze(()=>new GTe(e)),this._current=new GTe(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,a=Ae(MDt,i.center,e.center),o=Ve(a);o>=1e-5?(a[0]/=o,a[1]/=o,a[2]/=o):(a[0]=0,a[1]=1,a[0]=0),me(s.direction,a),me(n.direction,a),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){this._animation.cameraAt(e,this._current),this._current.copyToRenderCamera(i)}step(e,i){this.finished||(this.currentTime=this.currentTime+TPe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const MDt=I();let e0=class extends be{constructor(e){super(e),this.state=0}get running(){return this.state===2}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.destroyed||!!this.canStop&&(this.state=3,!0)}finishController(){this.state=4}};c([p({constructOnly:!0})],e0.prototype,"view",void 0),c([p({readOnly:!0})],e0.prototype,"running",null),c([p()],e0.prototype,"state",void 0),c([p({readOnly:!0})],e0.prototype,"isInteractive",null),e0=c([R("esri.views.3d.state.controllers.CameraController")],e0);let cL=class extends e0{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(ti()),this._asyncResult=null),this.state===4||this.state===3?(cP(e),this.state===4?e.resolve():e.reject(ti())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=2,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==0&&this.state!==2||(this.viewAnimation.state===j0.state.FINISHED?this.finish():this.viewAnimation.state===j0.state.STOPPED&&(this.state=3))}onControllerEnd(e){this.viewAnimation==null||this.viewAnimation.done||(this.state===4?this.viewAnimation.finish():this.state===3&&this.viewAnimation.stop()),this._asyncResult&&(this.state===4?this._asyncResult.resolve():this._asyncResult.reject(ti()))}finish(){this.finishController()}};cL=c([R("esri.views.3d.state.controllers.AnimationController")],cL);let yS=class extends cL{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.type="point-to-point",this.mode="interaction"}initialize(){this.animation=new CDt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new j0}get isInteractive(){return this.mode==="interaction"}begin(e,i){this.stepController=(n,a)=>{this.animation.step(n,a),this.animation.finished&&this.finishController()};const r=this.animationSettings(i);$k.copyFrom(this.view.state.camera);const s=new Zu(this.view.state.viewingMode);this._intersectionHelper.intersectRay($k.ray,s,ZTe)&&($k.center=ZTe),this.animation.update($k,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}onControllerEnd(e){this.stepController&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e),this.stepController=void 0}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?tse[e.easing]:e.easing}}};c([p({constructOnly:!0})],yS.prototype,"mode",void 0),c([p({readOnly:!0})],yS.prototype,"isInteractive",null),yS=c([R("esri.views.3d.state.controllers.PointToPointAnimationController")],yS);let $k=new wr;const ZTe=I();function EDt(){$k=new wr}function YTe(t){return t!=null&&"type"in t&&t.type==="point-to-point"}function $H(t=ODt){return[t[0],t[1],t[2],t[3]]}function uL(t,e){return ADt(t[0],t[1],t[2],e,Zhe.get())}function ADt(t,e,i,r,s=$H()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Hde(t,e,i){return At(i,t,e),Re(i,i),i[3]=Jhe(t,e),i}const ODt=[0,0,1,0];function Qvi(t,e,i=$n()){return Wde(t,Ff(e),i),Re(i.direction,i.direction),i}function Wde(t,e,i){return PDt(t,t.screenToRender(e,Xe.get()),i)}function PDt(t,e,i){if(e==null)return null;const r=na(Xe.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=na(Xe.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Xe.get());return n==null?null:(Ae(i.direction,n,i.origin),i)}function kP(t,e,i){return Zde(t,t.screenToRender(e,Xe.get()),i)}function Zde(t,e,i){me(i.origin,t.eye);const r=xe(Xe.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,Xe.get());return s==null?null:(Ae(i.direction,s,i.origin),i)}function Yde(t,e,i,r){const s=kP(e,i,RDt);return a_(t,s,r)}const RDt=$n(),zBe=30,CG=[1,3e8],NBe=8,MG=[200,1508e5],VBe=5,jBe=50,IDt=5,DDt=10,BF=80,tX=90,w1=1e-6,L$={exclude:new Set([b1])};function VS(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function Mae(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function x1(t,e,i){const r=Cp(Yhe.get(),i[3],i);r==null||f5e(r,gl)||(Ae(br,t.eye,e),Ft(br,br,r),t.eye=$e(br,br,e),Ae(br,t.center,e),Ft(br,br,r),t.center=$e(br,br,e),t.up=Ft(br,t.up,r))}function kDt(t,e,i,r){return MP(t,Wde(e,i,Xde),r)}function Eae(t,e,i,r){return MP(t,kP(e,i,Xde),r)}function Jde(t,e,i,r){const s=Xe.get();let n=1-i;Ae(s,e,t.eye);const a=Ve(s);let o=a*(1-n);n>=0&&o<r&&(o=r,n=-(o-a)/a),Math.abs(a-o)<w1||(he(s,s,n),t.eye=$e(br,t.eye,s),t.center=cr(br,t.center,e,n))}function UBe(t,e,i){e.getScreenCenter(JTe),Yde(t,e,JTe,br)&&(e.center=br);const r=e.distance,s=r*i;if(Math.abs(r-s)<w1)return;const n=he(Xe.get(),e.viewForward,s);e.eye=Ae(br,e.center,n)}const JTe=yn();function iX(t,e){xe(e,0,0,0);for(const i of t)$e(e,e,i);he(e,e,1/t.length)}function PB(t,e,i,r){return Math.sin(t/Ve(e))*(i+r.radius)}function QTe(t,e,i,r){return PB(Math.PI/2,e,i,r)+(t-Math.PI/2)}const XTe={Elevation:3e4,Angle:zt(16)},BBe=zt(80);function qBe(t,e,i,r,s,n){const a=I(),o=Is();let l=!0,u=!0;return t.intersectScreen(i,a,n)?o[3]=Ve(a):(u=!1,e.aboveGround&&s!==0?o[3]=Math.max(Ve(e.center),.9*r):o[3]=Ve(e.eye)-e.relativeElevation,s===1?hL(o,e,i,a):l=Yde(o,e,i,a)),{sphere:o,scenePickPoint:l?a:null,hasGeometryIntersection:u}}function qF(t,e,i,r){const s=t.relativeElevation;if(s>XTe.Elevation&&r==="global")return 1;kP(t,e,sX);const n=Math.sign(s),a=i.worldUpAtPosition(t.eye,br);return-n*Le(a,sX.direction)<Math.sin(XTe.Angle)*Ve(sX.direction)?0:1}function GBe(t,e,i){Ae(rX,i,e),t.eye=Ae(br,t.eye,rX),t.center=Ae(br,t.center,rX)}const rX=I();function hL(t,e,i,r){const s=kP(e,i,Xde);return s!=null&&(PP(t,s,uj),a_(t,s,r)?!(Mn(uj,s.origin)<Mn(r,s.origin))||(me(r,uj),!1):(Ae(YC,e.eye,e.center),Re(YC,YC),Pje(YC,-Le(Re(YC,YC),uj),KTe),MP(KTe,s,r),!1))}const uj=I(),YC=I(),KTe=Ui();function HBe(t,e,i,r,s,n){let a=0;if(At(OG,t,e),Ae(fj,t,e),Ve(t)<=s||!r.aboveGround){At(i,fj,r.eye);const o=Le(t,e)/(Ve(t)*Ve(e));if(o<.9999)a=Ao(o);else{const u=Ve(At(I(),t,e))/(Ve(t)*Ve(e));a=Qh(u)}const l=Math.cos(Ce(Kw.normalize(zt(n)),0,BBe));a=-a-Math.max(0,Ve(e)-s)/(l*s)}else Ae(e$e,r.eye,r.center),At(i,fj,e$e),a=-Ve(fj)/s;return Re(i,i),he(i,i,Ve(OG)),a}const e$e=I();function t$e(t,e,i,r){let s,n;const a=Math.cos(Ce(Kw.normalize(zt(r)),0,BBe));return s=e>i?-(e-i)/(a*i):e<-i?Math.PI-(e+i)/(a*i):Ao(e/i),n=t>i?-(t-i)/(a*i):t<-i?Math.PI-(t+i)/(a*i):Ao(t/i),(n-s)*i}function LDt(t,e,i,r,s,n,a,o,l,u){const d=t$e(t[2],e[2],n[3],o),f=l?t$e(t[0],e[0],n[3],180):e[0]-t[0],g=Math.sin(a)*f-Math.cos(a)*d,v=Math.cos(a)*f+Math.sin(a)*d;Re(br,s);const _=l?g/Math.sqrt(Math.abs(n[3]**2-Le(i,br)**2)):g/n[3],x=v/Math.sqrt(Math.abs(n[3]**2-Le(i,r)**2));oi(u,_,x)}function WBe(t,e,i,r,s,n,a,o,l,u){At(OG,t,e),Gne(n.up,n.eye,hj,dj,pj),Gne([0,0,1],n.eye,$0,zw,QBe),me(i,zw),me(r,$0),Re(i,i),he(i,i,Ve(OG)),FSe(t,Re(dj,dj),Re(pj,pj),Re(hj,hj),i$e),FSe(e,dj,pj,hj,r$e),LDt(i$e,r$e,t,$0,zw,a,o,l,u,s)}function FDt(t,e,i,r,s,n,a){Cp(EG,s,r),Cp(AG,a,n),Cn(vE,EG,AG),Ae(e,t,i),Ft(e,e,vE),$e(e,e,i)}function ZBe(t,e,i,r,s,n){Cp(EG,r,i),Cp(AG,n,s),Cn(vE,EG,AG),Ae(br,t.eye,e),Ft(br,br,vE),t.eye=$e(br,br,e),Ae(br,t.center,e),Ft(br,br,vE),t.center=$e(br,br,e),Ae(br,t.up,e),Ft(br,br,vE),t.up=$e(br,br,e)}const xx={Pole:.95,Angle:zt(18),Tilt:45,TiltHysteresisMargin:1e-7};let JC=!1;function Qde(t,e,i,r,s,n){const a=Math.abs(r)>Math.PI-xx.Angle||Math.abs(r)<xx.Angle,o=(Math.abs(t[2])<i*xx.Pole||Math.abs(e)>i)&&n;return a&&o?!JC&&s<xx.Tilt-xx.TiltHysteresisMargin?JC=!0:JC&&s>xx.Tilt+xx.TiltHysteresisMargin&&(JC=!1):JC=!1,JC}function YBe(t,e,i,r,s,n){if(n)Hde(i,r,s$e),x1(e,Li(t),s$e);else{const a=HBe(i,r,n$e,e,t[3],s);x1(e,Li(t),uL(n$e,a))}}function JBe(t,e,i,r,s,n,a){const o=a?20:1,l=1e-12;let u,d;me(Sx,r),Ck.copyFrom(e);for(let f=0;f<o&&Mn(i,Sx)>l&&(u=Mn(i,Sx),WBe(i,Sx,zw,$0,CI,Ck,t,s,n,a),ZBe(Ck,Li(t),$0,CI[1],zw,CI[0]),FDt(Sx,Sx,Li(t),$0,CI[1],zw,CI[0]),d=Mn(i,Sx),d<u||f===0);f++)e.copyFrom(Ck)}function zDt(t,e,i,r,s,n,a){Qde(i,Le(e.up,i),t[3],-Kw.normalize(zt(s)),n,e.aboveGround)?JBe(t,e,i,r,-Kw.normalize(zt(s)),n,a):YBe(t,e,i,r,n,a)}function NDt(t,e,i,r,s,n){const{eye:a}=t;Gne([0,0,1],a,$0,zw,QBe);const o=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,u=Math.max(Math.sqrt(Math.abs(1-Le(t.center,$0)**2/Ve(t.center)**2)),.5),d=(Math.sin(n)*l+Math.cos(n)*o)/u,f=-Math.cos(n)*l+Math.sin(n)*o;switch(Uh(r.pan.matrix,r.pan.matrix,d,$0),r.pan.enabled=!0,s.mode){case"pan":Uh(r.pan.matrix,r.pan.matrix,f,zw),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function VDt(t,e,i,r,s){const{eye:n,viewRight:a}=t,o=At(Xe.get(),a,n),l=e.translation[0]*i.pan;switch(l!==0&&(Uh(r.pan.matrix,r.pan.matrix,-l,o),r.pan.enabled=!0),s.mode){case"pan":{const u=e.translation[1]*i.pan;u!==0&&(Uh(r.pan.matrix,r.pan.matrix,u,a),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function jDt(t,e,i,r,s,n,a,o,l){Qde(t.center,Le(t.up,t.center),Ve(t.center),-Kw.normalize(zt(n)),a,e.aboveGround)?NDt(e,i,r,o,l,-Kw.normalize(zt(s))):VDt(e,i,r,o,l)}function LP(t,e,i=1/0){const r=Math.abs(Le(t,e));return Math.min(i,1/r)}const $0=I(),zw=I(),QBe=I(),hj=I(),dj=I(),pj=I(),i$e=I(),r$e=I(),CI=Ke(),s$e=$H(),EG=ut(),AG=ut(),vE=ut(),Sx=I(),br=I(),fj=I();let Ck=new wr;const OG=I(),n$e=I();function UDt(){Ck=new wr}const Xde={origin:I(),direction:I()},sX={origin:I(),direction:I()},a$e=.6,nX=4,BDt=60;let PG=class extends yS{constructor(){super(...arguments),this._zoomLocation=I(),this._tmpCamera=new wr,this._tmpViewDir=I(),this._tmpRayDir=$n(),this._targetOnSphere=I(),this._tmpCenter=I(),this._beginCamera=new wr,this._constraintOptions=new nd(7,1,null,this._beginCamera),this._sphere=Is()}initialize(){this._intersector=new Zu(this.view.state.viewingMode)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this._intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?L$:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:me(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:NO}}_updateCamera(e,i,r,s){const n=qF(e,r,this.view.renderCoordsHelper,this.view.viewingMode),a=Math.abs(this.view.camera.position.z),o=this._zoomLocation;Re(gj,e.eye),he(gj,gj,-1),kP(e,r,this._tmpRayDir),Re(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=Ce(LP(gj,this._tmpRayDir.direction,NBe)*a,MG[0],MG[1]);if(n===1){let u=a$e**i;this._sphere[3]=Ve(o),Ae(this._tmpViewDir,e.center,e.eye);const d=Math.min(Ve(this._tmpViewDir),l);let f=d*u;if(u<=1&&f<nX&&(f=nX,u=f/d),Math.abs(d-f)<w1)return;const g=Ve(e.center);if(this._sphere[3]!==g){const v=this._sphere[3]+u*(g-this._sphere[3]);e.center=he(mj,e.center,v/g)}he(this._tmpViewDir,this._tmpViewDir,-u),e.eye=$e(mj,e.center,this._tmpViewDir),As(this.view,e,this._constraintOptions),Mn(o,e.center)>1e-12&&Yde(this._sphere,e,r,this._targetOnSphere)&&zDt(this._sphere,e,o,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=a$e**Math.abs(i);const d=i>0?1:-1;Ae(this._tmpViewDir,o,e.eye);const f=Ve(this._tmpViewDir),g=this.view.stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,BDt);let v=g??l;s&&i>0&&(v=Math.min(v,f)),he(this._tmpRayDir.direction,this._tmpRayDir.direction,v),$e(o,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=v*u;const x=Math.max(nX,1.01*e.nearFar[0]);if(i>0&&_<x&&(_=x,u=_/v),Math.abs(v-_)<w1)return;he(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-u)),e.eye=$e(mj,e.eye,this._tmpRayDir.direction),e.center=$e(mj,e.center,this._tmpRayDir.direction),Re(this._tmpRayDir.direction,this._tmpRayDir.direction),this._constraintOptions.interactionDirection=this._tmpRayDir.direction,As(this.view,e,this._constraintOptions),this._constraintOptions.interactionDirection=null}DP(this.view,e)}};PG=c([R("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],PG);const mj=I(),gj=I();let RB,IB=null;const oA=new Map;async function Kvi(t){IB==null&&(RB==null&&(RB=W(()=>import("./VoxelWasmPerSceneView-B0e9x6Ax.js"),__vite__mapDeps([411,350]))),IB=await RB);const e=t.view;let i=oA.get(e);return i||(i=new IB.default({view:e}),oA.set(e,i)),i.addVoxelLayer(t)}function dL(t){return oA.get(t)}function e0i(t){const e=t.view,i=oA.get(e);i&&i.removeVoxelLayer(t)<1&&(oA.delete(e),oA.size===0&&(RB=null,IB=null))}const qDt=.6,GDt=4,HDt=60;let RG=class extends yS{constructor(){super(...arguments),this._zoomLocation=I(),this._tmpCamera=new wr,this._tmpRayDir=I(),this._tmpCenter=I(),this._beginCamera=new wr,this._constraintOptions=new nd(15,1,null,this._beginCamera)}step(e,i){if(!this.running)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=new Zu(this.view.state.viewingMode);let n=!1;e>0?(n=this._intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.basemapTerrain.invisible?L$:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:me(this._zoomLocation,this._tmpCamera.center);const a=qDt**e;let o=this.view.stage.renderView.getMinimalDepthForArea(dL(this.view),i[0],i[1],this.view.state.camera,HDt);Ae(yj,this._tmpCamera.eye,this._zoomLocation),Re(yj,yj);const l=Math.abs(this.view.camera.position.z),u=Ce(LP(WDt,yj,NBe)*l,MG[0],MG[1]);o=o??u;const d=I();Ae(d,this._zoomLocation,this._tmpCamera.eye),(o<Ve(d)||!n)&&(Re(d,d),$e(this._zoomLocation,this._tmpCamera.eye,he(d,d,o))),this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:NO}}_updateCamera(e,i,r){Ae(this._tmpRayDir,r,e.eye);const s=Ve(this._tmpRayDir);let n=s*i;const a=i<=1,o=Math.max(GDt,1.01*e.nearFar[0]);n!==0&&(a&&n<o&&(n=o,i=n/s),Math.abs(s-n)<w1||(he(this._tmpRayDir,this._tmpRayDir,i),e.eye=Ae(o$e,r,this._tmpRayDir),e.center=cr(o$e,e.center,r,1-i),As(this.view,e,this._constraintOptions)))}};RG=c([R("esri.views.3d.state.controllers.ZoomStepControllerLocal")],RG);const o$e=I(),WDt=Ye(0,0,1),yj=I();let ZDt=class extends _s{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(Yue(i,"primary")){const r=this._view.state.isGlobal?new PG({view:this._view,mode:"animation"}):new RG({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.step(Math.log(.5)/Math.log(.6),yn(i.x,i.y)),e.stopPropagation()}}},DB=class extends be{constructor(e){super(e)}initialize(){this.addHandles(this.view.elevationProvider.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController||e.context!=="ground")return;const i=this.view.state.camera;e.spatialReference!=null&&D6e(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>DP(this.view,e,1))}};c([p({constructOnly:!0})],DB.prototype,"view",void 0),DB=c([R("esri.views.3d.state.SurfaceCollisionConstraint")],DB);let Mk=class extends be{constructor(e){super(e),this.nearFarHeuristic=pOt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){const e=()=>this._updateNearFar();this.addHandles([X(()=>[this.view.constraints.clipDistance.near,this.view.constraints.clipDistance.far],()=>this._clipDistanceNearFarChanged()),this.view.state.events.on("before-camera-change",({camera:i,sceneDepthRange:r})=>this._updateCameraNearFar(i,r)),X(()=>this.view.constraints.clipDistance.mode,e),X(()=>this.view.stage.renderer.sceneDepthRange.value,e,Ht),X(()=>this.view.renderDataExtent,e,Ht),X(()=>this.view.basemapTerrain.visibleElevationBounds,e,Ht),X(()=>[this.view.constraints.altitude.min,this.view.constraints.altitude.max],()=>this._updateAltitude(),Ht),X(()=>this.view.constraints.tilt.max,()=>this._updateTiltMax(),Ht),X(()=>this.view.constraints.tilt.mode,()=>this._updateTilt(),Ht),X(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Ht),X(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state.constraints.collision.enabled],()=>this._updateCollision(),Ht)]),this.view.state.isLocal&&this.addHandles(X(()=>this.view.renderDataExtent,i=>this._updateLocalSurfaceDistance(i),Yt)),this._updateNearFar(),this.view.state.viewingMode!==2&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new DB({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints.clipDistance;e.mode!=="auto"&&this.view.state.updateCamera(i=>l$e(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e,i){const r=this.view.constraints.clipDistance;r.mode==="manual"?l$e(e,r):this._updateCameraNearFarAuto(e,r,i)}_updateCameraNearFarAuto(e,i,r=this.view.stage.renderer.sceneDepthRange.value){const s=yH(this.view,e.eye),n=this.nearFarHeuristic.compute(e,this.view.renderDataExtent,r,s);e.near=n.near,e.far=n.far,i&&i.autoUpdate(e.near,e.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;i!==r.enabled&&(r.enabled=i,i&&this._reapplyConstraints(8),this.view.constraints.tilt.mode==="auto"&&this._updateTiltAuto())}_updateAltitude(){const e=this.view.constraints.altitude;this.view.state.viewingMode===1?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints.tilt;e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints.tilt;e.mode==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(zt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints.tilt;if(e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(to(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=15){this.view.state.updateCamera(i=>As(this.view,i,new nd(e,0,null)))}};function l$e(t,e){e&&(t.near=e.near,t.far=e.far)}c([p({constructOnly:!0})],Mk.prototype,"view",void 0),c([p({readOnly:!0})],Mk.prototype,"surfaceCollisionConstraint",void 0),Mk=c([R("esri.views.3d.state.ConstraintsManager")],Mk);let W4=class extends e0{constructor(e){super(e)}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=2,this.addHandles(this.view.elevationProvider.on("elevation-change",e=>this._elevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}_elevationChangeEvent(e){e.spatialReference!=null&&!D6e(this.view,this.desiredCamera,e.extent,e.spatialReference)||e.context!=="ground"||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),DP(this.view,e,1)||this.constraintEnabled||(this.state=3)})}};c([p({constructOnly:!0})],W4.prototype,"desiredCamera",null),W4=c([R("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],W4);const YDt=.66;function XBe(t){return 360-JL.normalize(t)}function CH(t){return JL.normalize(360-t)}function KBe(t,e,i){const r=e.camera;if(r!=null)return JDt(r,I$(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:a}=t8e(t,e.rotation,i);if(s.type==="point")return XDt(t,e,s,n,a);const o=s.extent;return o==null?null:bB(t,o,n.heading,n.tilt,a)}async function e8e(t,e,i,r){const s=e.camera;if(s!=null)return QDt(s,I$(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:a,mode:o}=t8e(t,e.rotation,i);if(n.type==="point")return KDt(t,e,n,a,o,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return oUe(t,l,a.heading,a.tilt,o,r)}function JDt(t,e){const i=t.position;let r;try{r=u1(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function QDt(t,e,i){const r=t.position,s=await z0(r,e,{signal:i});ct(i);const n=t.clone();return n.position=s.clone(),n}function t8e(t,e,i){const r=qO(t,t.state.camera);let s=1;return e!=null&&(r.heading=XBe(e),s=0),i!=null&&(r.tilt=i),{camera:r,mode:s}}function XDt(t,e,i,r,s){const n=t.spatialReference;let a;try{a=u1(i.clone(),n)}catch{return null}if(!a)return null;const o=e.scale!=null?rL(t,e.scale):t.state.camera.distance;return XOt(t,a,o,r,s)}async function KDt(t,e,i,r,s,n){const a=t.spatialReference,o=await z0(i.clone(),a,{signal:n});ct(n);const l=e.scale!=null?rL(t,e.scale):t.state.camera.distance;return _H(t,o,l,r,s,n)}function i8e(t,e,i=null){return i==null&&(i=new ys),epe(t,null,e.clone(),i)}async function r8e(t,e,i){const r=ckt(t,e);if(!r)throw new q("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new tc({fov:t.camera.fov}),n=new ys({camera:s});if(r.target instanceof ys)return Tx(await ikt(t,r.target,r,i,n));if(r.target instanceof tc)return Tx(await n8e(t,r.target,i,n));const a=r.scale!=null||r.zoom!=null;if(r.target instanceof It){const u=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Tx(a||u?await Aae(t,r,r.target.center,s,i,n):await akt(t,r,r.target,s,i,n))}const o=new hkt,l=a?ekt(t,r):void 0;if(await s8e(t,r.target,l,o,i),isFinite(o.boundingBox[0])){let u;if(Pue(o.boundingBox,Ks),Rh.x=Ks[0],Rh.y=Ks[1],Rh.z=Ks[2],Rh.spatialReference=t.spatialReference,isFinite(Rh.z)&&o.hasZ?u=TLe(o.boundingBox):(Rh.z=void 0,u=Int(Rue(o.boundingBox,dkt))),a||u)return Tx(await Aae(t,r,Rh,s,i,n));const d=ukt(t,o.screenSpaceObjects);return Tx(await lkt(t,r,Rh,o.boundingBox,d,s,i,n))}return r.position?Tx(await skt(t,r,s,n,i)):Tx(await nkt(t,r,s,i,n))}function Kde(t,e){return e.scale==null&&e.zoom!=null?hUe(t,e.zoom):e.scale}function ekt(t,e){const i=Kde(t,e);return i?Gxt(i):void 0}function MH(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=XBe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function epe(t,e,i,r){const s=t.spatialReference||Me.WGS84;if(e??=Sg(t,i),e==null)return r;const n=new Ue({spatialReference:s});return P$(e.center,t.renderSpatialReference,n)&&(r.targetGeometry=n,r.scale=a$(t,e.distance),r.rotation=CH(i.heading),r.camera=i),r}async function IG(t,e,i,r){const s=()=>new q("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let f;switch(e.type){case"point":f=e;break;case"multipoint":case"polyline":f=e.extent?.center;break;case"extent":f=e.center;break;case"polygon":{const g=nDe(e);f=g?Ue.fromJSON(g):null;break}}f!=null&&n&&t.elevationProvider?(f=await z0(f,n,{signal:r}),Ks[2]=Lg(t.elevationProvider,f)??0):Ks[2]=0}const a=pkt[e.type],o=new Array;if(a(e,e.hasZ?f=>{o.push([f[0],f[1],f[2]])}:f=>{o.push([f[0],f[1]])},Ks),o.length===0)throw s();const l=e.spatialReference,u=t.spatialReference,d=await z0(new Ho({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:o}),u,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[f,g,v]of d.points)Ks[0]=f,Ks[1]=g,Ks[2]=v,kO(i.boundingBox,Ks);else for(const[f,g]of d.points)Ks[0]=f,Ks[1]=g,kO(i.boundingBox,Ks)}async function tkt(t,e,i,r,s){const n=await Sp(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await IG(t,e.geometry,r,s);const a=n.value,o=await Sp(a.whenGraphicBounds(e,{minDemResolution:i}));if(o.ok===!1||!o.value)return void await IG(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:u}=o.value;wLe(r.boundingBox,u),l&&l.forEach(d=>{r.screenSpaceObjects.push(d)}),isFinite(u[2])&&(r.hasZ=!0)}async function s8e(t,e,i,r,s){if(Array.isArray(e)&&e.length===2){const n=e[0],a=e[1];if(typeof n=="number"&&typeof a=="number")return Rh.x=n,Rh.y=a,Rh.z=void 0,Rh.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:Me.WGS84,void await IG(t,Rh,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(n=>s8e(t,n,i,r,s))):e instanceof Qa?await IG(t,e,r,s):e instanceof ms&&await tkt(t,e,i,r,s)}async function ikt(t,e,i,r,s){if(e.camera)return n8e(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=CH(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=Kde(t,i);return n!=null&&(s.scale=n),s.camera=await e8e(t,s,i.tilt,r),s}async function n8e(t,e,i,r){const s=t.spatialReference,n=await z0(e.position,s,{signal:i}),a=e.clone();return a.position=n,epe(t,null,a,r)}async function rkt(t,e,i,r,s,n,a){const o=t.renderSpatialReference;return await lG(e,aX,o,0,{signal:a}),await lG(i,_j,o,0,{signal:a}),n.targetGeometry=new Ue(e),s.position=new Ue(i),Ae(DG,aX,_j),kF(t,_j,DG,r.up,s),n.scale=a$(t,Bi(_j,aX)),n.rotation=CH(s.heading),n.camera=s,n}async function Aae(t,e,i,r,s,n){n.targetGeometry=i.clone();const a=R$(t);if(e.position)return rkt(t,n.targetGeometry,e.position,a,r,n,s);if(e.zoomFactor){const l=a.distance/e.zoomFactor,u=he(Ks,a.viewForward,-l);a.eye=$e(Ks,a.center,u),n.scale=a$(t,l)}qO(t,a,r);const o=MH(r,e)?0:1;if(!e.zoomFactor){const l=Kde(t,e);if(l==null){await lG(n.targetGeometry,Ks,t.renderSpatialReference,0,{signal:s});const u=_6e(a.frustum,Ks)?Bi(a.eye,Ks):a.distance;n.camera=await _H(t,n.targetGeometry,u,r,o),n.scale=a$(t,u)}else n.scale=l,n.camera=await QOt(t,n.targetGeometry,n.scale,r,o,s)}return n}async function skt(t,e,i,r,s){const n=R$(t);me(DG,n.viewForward),kF(t,n.eye,DG,n.up,oX);const a=t.spatialReference,{position:o}=e;if(o){const l=await z0(o,a,{signal:s});i.position=l}else i.position=new Ue;return i.heading=e.heading!=null?e.heading:oX.heading,i.tilt=e.tilt!=null?e.tilt:oX.tilt,epe(t,null,i,r)}async function nkt(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=R$(t),{spatialReference:a,renderSpatialReference:o}=t,l=new Ue({spatialReference:a});return P$(n.center,o,l)?Aae(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),MH(s.camera,e),s}async function akt(t,e,i,r,s,n){n.targetGeometry=i.clone();const a=R$(t);qO(t,a,r);const o=MH(r,e)?0:1;return n.camera=await oUe(t,i,r.heading,r.tilt,o,s),n}function okt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Lg(t.elevationProvider,i)),xe(Ks,i.x,i.y,n),IF(t.spatialReference,Ks,c$e,t.renderSpatialReference),P1(vj,c$e),R1(vj,vj),Wu(MI);const a=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let _=0;_<a.length;_++){const x=a[_];let S=r[x[2]];isFinite(S)||(S=n),xe(Ks,r[x[0]],r[x[1]],S),Co(Ks,t.spatialReference,Ks,t.renderSpatialReference),kO(MI,Ql(Ks,Ks,vj))}const o=M$(MI),l=k1(MI),u=E$(MI),d=1/Math.tan(e.fovX/2),f=1/Math.tan(e.fovY/2),g=.5*Math.sqrt(o*o+u*u)*Math.max(f,d)+.5*l,v=.5*l*f+.5*Math.max(o,u);return Math.max(g,v)/s}async function lkt(t,e,i,r,s,n,a,o){o.targetGeometry=i.clone();const l=R$(t),u=okt(t,l,i,r,s);qO(t,l,n);const d=MH(n,e)?0:1;return o.camera=await _H(t,o.targetGeometry,u,n,d,a),o.scale=a$(t,u),o}function ckt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function Tx(t){return t?.camera!=null&&(t.rotation=CH(t.camera.heading)),t}function ukt(t,e){const i=YDt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}let hkt=class{constructor(){this.hasZ=!1,this.boundingBox=Wu(),this.screenSpaceObjects=new Array}};const Ks=I(),c$e=ut(),vj=Jr(),MI=nc(),dkt=fi(),DG=I(),_j=I(),aX=I(),oX={heading:0,tilt:0},Rh=new Ue,pkt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let a=0;a<n.length;a++)i[0]=n[a][0],i[1]=n[a][1],r&&(i[2]=n[a][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let a=0;a<n.length;a++)i[0]=n[a][0],i[1]=n[a][1],r&&(i[2]=n[a][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(xe(i,t.xmin,t.ymin,t.zmin)),e(xe(i,t.xmax,t.ymin,t.zmin)),e(xe(i,t.xmin,t.ymax,t.zmin)),e(xe(i,t.xmax,t.ymax,t.zmin)),e(xe(i,t.xmin,t.ymin,t.zmax)),e(xe(i,t.xmax,t.ymin,t.zmax)),e(xe(i,t.xmin,t.ymax,t.zmax)),e(xe(i,t.xmax,t.ymax,t.zmax))):(e(xe(i,t.xmin,t.ymin,i[2])),e(xe(i,t.xmax,t.ymin,i[2])),e(xe(i,t.xmin,t.ymax,i[2])),e(xe(i,t.xmax,t.ymax,i[2])))}},fkt=Object.freeze(Object.defineProperty({__proto__:null,create:r8e,fromCamera:i8e,toCameraAsync:e8e,toCameraSync:KBe},Symbol.toStringTag,{value:"Module"}));let mkt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const a=new AbortController;this._options.signal!=null&&Mo(this._options.signal,()=>this.abort()),this._abortController=a,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController(),this._reject(ti())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await qu(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await r8e(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){const i=!!(this._target instanceof ys&&this._target.camera||this._target instanceof tc),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,a=n&&n.spatialReference,o=a?a.wkid:"none",l=this.view.spatialReference?.wkid;return this._reject(new q("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${o}, view: ${l})`,{camera:r})),null}const s=Sg(this.view,r);return s==null?(this._reject(new q("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new q("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.running||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new W4({view:this.view,desiredCamera:e.camera}),DP(this.view,e.camera,1)):As(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const o=this.view.state.cameraController;s&&(o&&o.running?YTe(o)&&o.viewAnimation!=null&&o.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===4&&(this.view.state.cameraController=s))},a=o=>{if(this.view.state!=null)switch(i.state){case 4:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case 0:case 1:case 2:case 3:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(o)}}};r.when(n,o=>a(o)),i.asyncResult={resolve:()=>a(),reject:o=>a(o)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return YTe(r)&&(r.updateStateFromViewAnimation(),r.running&&(e=r,i=e.viewAnimation)),e==null&&(e=new yS({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e),e.state===1)?(i?.stop(),this._reject(new q("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null):e}},on=class extends be{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=u$e,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,getDevicePixelRatioOverride:()=>this._devicePixelRatioOverride,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?u$e:0}},this._propertiesPool=new V0({frustum:()=>new V6e(null)},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new gkt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([tn(()=>this.view.state.events,"before-camera-change",({camera:e})=>e&&this._updateElevation(e)),X(()=>this.view.state?.camera,(e,i)=>this._cameraChangedHandler(e,i),Ht)]),vs(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([Hg({prepare:()=>this._prepareFrame()}),X(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(wj)}),tn(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Pe(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=qO(this.view,this.view.state.camera,kB);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){if(this._updatePropertyBeforeReady("camera",e))return;this.view.elevationProvider.enableCache(!0);const i=Sg(this.view,e);i?this.setStateCamera(i,{applyConstraints:!1})||re.getLogger(this).warnOnce("#camera=","There is a currently active camera controller that has priority."):re.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider.enableCache(!1)}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=qO(this.view,this.view.state.contentCamera,kB);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=Sg(this.view,e);this.view.state.contentCamera=i??null}installContentCameraReset(e){if(this.removeHandles(lX),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=F5(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([X(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(lX),this.test.contentCameraResetState.clear())}),X(()=>this.zoom,a=>{a!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(a-i)/2),Math.abs(a-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),X(()=>this.view.state.camera,a=>{const o=Mn(s,a.center);this.test.contentCameraResetState.set("camera.center",o/r),o>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],lX),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():re.getLogger(this).error("#center=","Invalid center",e):re.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):re.getLogger(this).error("#center=","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){const e=this._get("extent");return e?Wr.fromExtent(e):null}return iPt(this.view,this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=lUe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#extent=","Invalid extent",e):re.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):re.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");const e=this.view.basemapTerrain.tilingScheme,i=this.view.pointsOfInterest.cameraOnSurface.scale;return e&&i?Y6e(this.view,i,this.view.state.contentCamera,e):this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[0]/r),a=Math.round(i[1]/r),o=Math.round(i[2]/r),l=Math.round(i[3]/r);return s!=null&&s.top===n&&s.right===a&&s.bottom===o&&s.left===l?s:{top:n,right:a,bottom:o,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,bj),this.view.state.updateCamera(i=>i.padding=bj))}_paddingToArray(e,i,r){e?Or(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Or(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return ia((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?i8e(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e){if(!this.isCompatible(e)){const i=e.camera!=null?e.camera.position:e.targetGeometry,r=i!=null&&i.spatialReference;return void re.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||re.getLogger(this).error("#viewpoint=","Invalid viewpoint",e)}else re.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?oPt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view.stage.renderView.renderingContext?.parameters.maxTextureSize;return r&&fS(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?.stage?.renderer.isFeatureEnabled(8)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?.stage?.renderer;return e&&(e.isFeatureEnabled(8,2)||e.isFeatureEnabled(8,1)||e.isFeatureEnabled(8,0))}preinit(e){return!(this._isOverridden("center")&&!rw(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!rw(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!rw(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||rw(this.viewpoint.targetGeometry?.spatialReference,e)&&rw(this.viewpoint.camera?.position?.spatialReference,e))}init(){this._constraintsManager=new Mk({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===2&&this.addHandles(vs(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(wj),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),wj)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(wj),this._constraintsManager=Pe(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new mkt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(R$(this.view),{applyConstraints:!1})}step(e){const i=this.view.state?.cameraController;i?.stepController&&this.view.state.updateCamera(r=>i.stepController(e,r))}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of vkt){const n=e.has(r),a=this._isOverridden(r);!n&&a&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||a)&&s.forEach(o=>e.add(o))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof tc)return void this.setStateCamera(Sg(this.view,e),{applyConstraints:!1});if(e instanceof ys){if(e.targetGeometry instanceof It){const n=bB(this.view,e.targetGeometry,0,.5,0);return void(n!=null&&this.setStateCamera(Sg(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=bB(this.view,e,0,.5,0);i!=null&&this.setStateCamera(Sg(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&ykt.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof ys?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof tc?this.isCompatible(e.position):e.spatialReference&&!Wke(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=_kt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=vv){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),a=sL(this.view,s,n,e,i,1);return a==null?null:(r.copyFrom(this.view.state.camera),r.eye=a.eye,r.center=a.center,r.up=a.up,r)}_centerToCamera(e){let i;if(e.hasZ)i=this.view.state.camera.distance;else{const{centerOnContent:r}=this.view.pointsOfInterest;r.runTask(),i=r.distance}return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=bB(this.view,e,i,r,1,kB);return s?Sg(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view,r=i.pointsOfInterest.centerOnContent;r.runTask();const s=r.renderLocation,n=i.pointsOfInterest.cameraOnSurface.renderLocation,a=JOt(i,e,s,n);return this._centerPointAtDistanceToCamera(s,a)}_zoomToCamera(e){return this._scaleToCamera(hUe(this.view,e))}_viewpointToCamera(e){return Sg(this.view,KBe(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&As(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new W4({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i,stage:r}=this.view;if(!e||!i||!r||r.destroyed||r.destroying)return;this._windowDevicePixelRatio=window.devicePixelRatio;const s=this._computeCanvasSize();if(s.width!==0&&s.height!==0&&(i.width===s.width&&i.height===s.height||(i.width=s.width,i.height=s.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===s.width&&n.fullHeight===s.height&&n.pixelRatio===s.pixelRatio||(vv.copyFrom(n),vv.pixelRatio!==s.pixelRatio&&(this._paddingToArray(this.padding,s.pixelRatio,bj),vv.padding=bj),vv.fullWidth=s.width,vv.fullHeight=s.height,vv.pixelRatio=s.pixelRatio,this.view.state.camera=vv),this._updateState()}}_updateElevation(e){const i=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,r=this.view.basemapTerrain?.spatialReference,s=r?yH(this.view,e.eye):0;e.relativeElevation=i-s}_updateState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=0:this.view.interacting?this.view.state.mode=1:(this.view.state.mode===0&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=1:this.view.state.mode=2),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateState())}};c([p({type:tc,dependsOn:["view.state.camera","ready"]})],on.prototype,"camera",null),c([p({type:tc,dependsOn:["view.state.contentCamera","ready"]})],on.prototype,"contentCamera",null),c([p({type:Ue})],on.prototype,"center",null),c([p()],on.prototype,"visibleArea",null),c([p({type:It})],on.prototype,"extent",null),c([p({readOnly:!0})],on.prototype,"frustum",null),c([p()],on.prototype,"_constraintsManager",void 0),c([p({readOnly:!0})],on.prototype,"constraintsManager",null),c([p()],on.prototype,"_initialViewpoint",null),c([p({readOnly:!0})],on.prototype,"hasInitialView",null),c([p({readOnly:!0,type:Boolean})],on.prototype,"ready",void 0),c([p({type:Number})],on.prototype,"scale",null),c([p()],on.prototype,"padding",null),c([p({readOnly:!0})],on.prototype,"screenCenter",null),c([p({constructOnly:!0})],on.prototype,"view",void 0),c([p({type:ys})],on.prototype,"viewpoint",null),c([p({type:Number})],on.prototype,"zoom",null),c([p({readOnly:!0})],on.prototype,"_rasterPixelRatio",null),c([p({readOnly:!0})],on.prototype,"_usePhysicalPixelRendering",null),c([p({readOnly:!0})],on.prototype,"_usePhysicalPixelRenderingAny",null),c([p()],on.prototype,"_windowDevicePixelRatio",void 0),c([p()],on.prototype,"_devicePixelRatioOverride",void 0),on=c([R("esri.views.3d.state.ViewStateManager")],on);let gkt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const ykt=new Set(["camera","viewpoint","extent","scale","center","zoom"]),vkt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],_kt={heading:0,tilt:0};let kB=new tc,vv=new wr;const bj=li(),wj="pending-initial-view",lX="content-camera-reset",u$e=300,bkt=100;function wkt(){kB=new tc,vv=new wr}let Hf=class extends e0{constructor(){super(...arguments),this.startCamera=new wr,this.currentCamera=new wr,this._isInteractive=!1,this._interactingTimeoutHandle=void 0}get isInteractive(){return this._isInteractive}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=2,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._isInteractive=!0,this._interactingTimeoutHandle?.remove(),this._interactingTimeoutHandle=m$.setTimeout(()=>{this._isInteractive=!1,this._interactingTimeoutHandle=void 0},bkt),this.view.state.updateCamera(e=>this.stepController(0,e))}};c([p({readOnly:!0})],Hf.prototype,"isInteractive",null),c([p()],Hf.prototype,"_isInteractive",void 0),Hf=c([R("esri.views.3d.state.controllers.InteractiveController")],Hf);let Z4=class extends Hf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=0,this._rotScale=0,this._lastPoint=Ke(),this._tmpWorldUp=I(),this._tmpViewDir=I(),this._tmpRotCurPoint=Ke(),this._tmpTransf=ut(),this._tmpAxis=I(),this._tmpPivotPoint=I(),this._pivotPos=I(),this._constraintOptions=new nd(15,2,0,this.startCamera)}initialize(){this._rotScale=this.pivot===0?3:1.5}begin(e){if(this.running){switch(this.pivot){case 1:me(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=3,this._constraintOptions.tiltMode=1,this._constraintOptions.selection=0;break;case 0:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.basemapTerrain.invisible?L$:{});i||me(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=2,this._constraintOptions.tiltMode=0,this._constraintOptions.selection=11;break}}VS(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=I();Ae(s,this._pivotPos,r.eye);const n=Ve(s),a=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,h$e);let o=Math.max(LP(h$e,r.viewForward,IDt)*a,DDt);i&&(o=Math.min(n,o));const l=yn(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),u=qF(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let d=this.view.stage.renderView.getMinimalDepthForArea(dL(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*tX,tX),f=this.view.stage.renderView.getMinimalDepthForArea(dL(this.view),e[0],e[1],r,tX);d==null&&f==null||(d=d??f??0,f=f==null||u===1?d:f,o=d>f?f:d,o=i?Math.min(o,n):o),Re(s,s),me(this._pivotPos,$e(this._tmpPivotPoint,r.eye,he(this._tmpPivotPoint,s,o)))}update(e){if(this.running){switch(this.pivot){case 1:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case 0:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}As(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),VS(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,a=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Ae(this._tmpViewDir,r,s);const o=Ve(this._tmpViewDir),l=Ao(Le(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===1){n*=-.5;const u=.5*Math.PI-l,d=.5*Math.PI*.99;n=u-Math.max(-d,Math.min(d,u+n))}return n=Ce(n+l,qo.min,qo.max)-l,At(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===0&&(a=-a),Cp(this._tmpTransf,a,this._tmpWorldUp),Uh(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),Ft(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ft(cX,e.up,this._tmpTransf),$e(cX,s,this._tmpViewDir),na(this._lastPoint,this._tmpRotCurPoint),cX}};c([p()],Z4.prototype,"pivot",void 0),Z4=c([R("esri.views.3d.state.controllers.RotateController")],Z4);const cX=I(),h$e=I();let uX=class extends _s{constructor(e,i,r,s){super(!0),this._view=e,this.pointerActions=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Jue(e.data,this.pointerActions))return;const r=yn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new Z4({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function xkt(t,e){return{type:r1(e),value:t,unit:e}}function p0i(t){return{value:t}}function Yh(t,e){return{type:r1(e),value:t,unit:e}}function EH(t,e){return{type:r1(e),value:t,unit:e}}function f0i(t,e){return{type:r1(e),value:t,unit:e}}function AH(t,e,i="arithmetic"){return{type:r1(e),value:t,unit:e,rotationType:i}}function tpe(t,e){const i=Skt(t,e);return t.type==="angle"?AH(i,e,t.rotationType):xkt(i,e)}function Skt(t,e){return yi(t.value,t.unit,e)}function m0i(t,e){return t==null?e:e==null||t.value>yi(e.value,e.unit,t.unit)?t:e}function g0i(t,e){return t==null?null:{...t,value:t.value*e}}function Tkt(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const y0i=Yh(0,"meters"),v0i=EH(0,"square-meters");AH(0,"radians");const _0i=AH(0,"degrees"),b0i=AH(0,"degrees","geographic");function a8e(t,e,i){return t.units[e][i]}function Mp(t,e,i,r=2,s="abbr"){return`${k0(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${a8e(t,i,s)}`}function GF(t,e,i,r=2,s="abbr"){return`${k0(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${a8e(t,i,s)}`}function $kt(t,e,i,r=2,s="abbr"){const n=uce(e,i);return Mp(t,yi(e,i,n),n,r,s)}function Ckt(t,e,i,r=2,s="abbr"){const n=uce(e,i);return GF(t,yi(e,i,n),n,r,s)}function Mkt(t,e,i,r=2,s="abbr"){const n=hce(e,i);return Mp(t,yi(e,i,n),n,r,s)}function Ekt(t,e,i,r=2,s="abbr"){const n=hce(e,i);return GF(t,yi(e,i,n),n,r,s)}function Akt(t,e,i,r=2,s="abbr"){const n=dce(e,i);return Mp(t,yi(e,i,n),n,r,s)}function Okt(t,e,i,r=2,s="abbr"){const n=dce(e,i);return GF(t,yi(e,i,n),n,r,s)}function Pkt(t,e,i,r=2,s="abbr"){const n=pce(e,i);return Mp(t,yi(e,i,n),n,r,s)}function Rkt(t,e,i,r=2,s="abbr"){const n=pce(e,i);return GF(t,yi(e,i,n),n,r,s)}function Ikt(t,e,i,r=2,s="abbr"){const n=aIe(e,i);return Mp(t,yi(e,i,n),n,r,s)}function Dkt(t,e,i,r=2,s="abbr"){const n=oIe(e,i);return Mp(t,yi(e,i,n),n,r,s)}function kkt(t,e,i,r=2,s="abbr"){const n=lIe(e,i);return Mp(t,yi(e,i,n),n,r,s)}function Lkt(t,e,i,r=2,s="abbr"){const n=cIe(e,i);return Mp(t,yi(e,i,n),n,r,s)}const Fkt=(t,e)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:e,minimumFractionDigits:e,signDisplay:t>0?"never":"exceptZero"});function pL(t,e,i,r,s,n=JL,a=!0){let o=n.normalize(Tkt(yi(t,e,"degrees"),i,r),0,a);const l=Fkt(o,s??2);return o=zkt(o,l),k0(o,l)}const d$e=new Map;function zkt(t,e){const i=JSON.stringify(e);let r=d$e.get(i);return r||(r=new Intl.NumberFormat("en-US",e),d$e.set(i,r)),/^[-+]?360\.?0*?$/.test(r.format(t))?0:t}const p$e=["B","kB","MB","GB","TB"];function w0i(t,e){let i=(e=Math.round(e))===0?0:Math.floor(Math.log(e)/Math.log(1024));i=Ce(i,0,p$e.length-1);const r=k0(e/1024**i,{maximumFractionDigits:2});return Q0(t.units.bytes[p$e[i]],{fileSize:r})}const xj="esri-fov-overlay",Sj={base:xj,outer:`${xj}-outer`,reset:`${xj}-reset`,text:`${xj}-text`};let _v=class extends ym{constructor(e){super(e),this.onReset=()=>{},this._messagesCommon=null,this._messagesUnits=null,this.fov=null}render(){return Rt("div",{class:Sj.outer},Rt("div",{class:Sj.base},Rt("p",{class:Sj.text},this._overlay),Rt("p",{class:Sj.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){const{fov:e,_messagesUnits:i}=this;if(!i||e==null)return"";const r=pL(to(e),"degrees","arithmetic","arithmetic",0),s=Nkt/(2*Math.tan(e/2));return`${r} | ${Mp(i,s,"millimeters",0,"abbr")} |`}get _reset(){return this._messagesUnits&&this.fov!=null?"":""}};c([p()],_v.prototype,"onReset",void 0),c([p(),gp("esri/t9n/common")],_v.prototype,"_messagesCommon",void 0),c([p(),gp("esri/core/t9n/Units")],_v.prototype,"_messagesUnits",void 0),c([p()],_v.prototype,"fov",void 0),c([p()],_v.prototype,"_overlay",null),c([p()],_v.prototype,"_reset",null),_v=c([R("esri.widgets.FovOverlay")],_v);const Nkt=Math.sqrt(1872);let lA=class extends Hf{constructor(e){super(e),this.onStop=null,this._timeOutId=void 0,this._onReset=()=>{this._startSize=this._lastDrag=null,this._setFov(Vkt),this.updateTimeout()},this._center=I(),this._viewForward=I(),this._constraints=new nd(15,1)}begin(e){Bkt(e)?this._showOverlay().fov=e.fov:(this._lastDrag=e[1],this._startSize=null,this._ensureStartSize(this.view.state.camera))}updateTimeout(){clearTimeout(this._timeOutId),this._timeOutId=setTimeout(this.onStop,1500)}update(e){if(this._lastDrag==null)return this._lastDrag=e[1],this._startSize=null,void this._ensureStartSize(this.view.state.camera);const i=-(this._lastDrag-e[1])/2;this._lastDrag=e[1],this.step(i)}step(e){if(!this.running)return void(this._startSize=this._lastDrag=null);const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),s=to(r.fov)+e,n=zt(Ce(s,jkt,Ukt));n!==r.fov?this._setFov(n):this._showOverlay().fov=r.fov}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(e){super.onControllerEnd(e),this._startSize=this._lastDrag=null,this.hideOverlay()}_showOverlay(){return this._overlay||(this._overlay=new L4({id:"esri.FovOverlay",node:new _v({onReset:this._onReset})}),this.view.ui.add(this._overlay)),this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=Pe(this._overlay))}_setFov(e){const i=this.view.state,r=this.currentCamera.copyFrom(i.camera),s=this._ensureStartSize(r)/Math.tan(e/2),n=$e(hX,this._center,he(hX,this._viewForward,-s));r.eye=n,r.fov=e,this._constraints.interactionStartCamera=i.camera,this._constraints.interactionFactor=sp(this.currentCamera.height-i.camera.height),As(this.view,this.currentCamera,this._constraints),this.begin(r),this.commitCamera()}_ensureStartSize(e){if(this._startSize==null){me(this._viewForward,e.viewForward);const i=this.view.stage.renderView.getMinimalDepthForArea(null,e.fullWidth/e.pixelRatio*.5,e.fullHeight/e.pixelRatio*.5,e,BF),r=Bi(e.eye,this.view.pointsOfInterest.centerOnContent.renderLocation),s=i??r;$e(this._center,e.eye,he(hX,this._viewForward,s)),this._startSize=s*Math.tan(e.fov/2)}return this._startSize}};c([p()],lA.prototype,"onStop",void 0),lA=c([R("esri.views.3d.state.controllers.FovController")],lA);const Vkt=zt(new tc().fov),jkt=10,Ukt=150,hX=I();function Bkt(t){return!Array.isArray(t)}const f$e=12;let Oae=class extends Hf{constructor(){super(...arguments),this._pickPoint=I(),this._tmpP0=Ke(),this._panAxisAngle=$H(),this._tmpRayDir=I(),this._tmpRayDirPick=I(),this._targetOnSphere=I(),this._navigationMode=1,this._tmpRay={origin:I(),direction:I()},this.dragBeginPoint=yn(),this._normalizedAnchorPoint=Ke(),this._constraintOptions=new nd(7,1,0,this.startCamera),this._sphere=Is(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;na(this.dragBeginPoint,e),VS(this.startCamera,e,this._normalizedAnchorPoint);const i=xr(this.view.spatialReference),r=qBe(this._intersectionHelper,this.startCamera,e,i.radius,0,this.view.basemapTerrain.invisible?L$:{});if(this._navigationMode=qF(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navigationMode===1)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;kP(this.startCamera,e,this._tmpRay),Re(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(Ae(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Ve(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,m$e);const a=Ce(LP(m$e,this._tmpRay.direction,zBe)*n,CG[0],CG[1]),o=this.view.stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,BF);let l=o??a;s!=null&&(l=Math.min(l,s)),this._hasPickPoint=!0,he(this._tmpRay.direction,this._tmpRay.direction,l),$e(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.running){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navigationMode===1){Ae(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Ve(this._tmpRayDir);VS(this.currentCamera,e,this._tmpP0);const r=(this._normalizedAnchorPoint[1]-this._tmpP0[1])*f$e;let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<w1)return;if(this._hasPickPoint&&s<i){const a=1-(1-s/i)*(1-this._sphere[3]/Ve(this.currentCamera.center));this.currentCamera.center=he(Tj,this.currentCamera.center,a)}he(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=$e(Tj,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=sp(nm(this.dragBeginPoint,e)),As(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(hL(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Hde(this._pickPoint,this._targetOnSphere,this._panAxisAngle),x1(this.currentCamera,Li(this._sphere),this._panAxisAngle))}else{const i=Ve(this._tmpRay.direction);VS(this.currentCamera,e,this._tmpP0);const r=(this._normalizedAnchorPoint[1]-this._tmpP0[1])*f$e;let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<w1)return;he(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=$e(Tj,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=$e(Tj,this.currentCamera.center,this._tmpRayDir),Re(this._tmpRayDir,this._tmpRayDir),this._constraintOptions.interactionDirection=this._tmpRayDir,As(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}DP(this.view,this.currentCamera),this.commitCamera()}}finish(){this.running&&this.finishController()}};Oae=c([R("esri.views.3d.state.controllers.ZoomControllerGlobal")],Oae);const Tj=I(),m$e=I();let Pae=class extends Hf{constructor(){super(...arguments),this._tmpP=I(),this._tmpDir=I(),this._tmpN=I(),this._tmpP0=Ke(),this._tmpPoi=I(),this._tmpRayDir=I(),this.dragBeginPoint=yn(),this._normalizedAnchorPoint=Ke(),this._constraintOptions=new nd(15,1,0,this.startCamera,I()),this._plane=Ui()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;na(this.dragBeginPoint,e),VS(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.basemapTerrain.invisible?L$:{});Ae(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Ve(this._tmpDir);Re(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z),n=Ce(LP(qkt,this._tmpDir,zBe)*s,CG[0],CG[1]),a=this.view.stage.renderView.getMinimalDepthForArea(dL(this.view),e[0],e[1],this.view.state.camera,BF);let o=a??n;i&&(o=Math.min(o,r)),he(this._tmpDir,this._tmpDir,o),$e(this._tmpP,this.startCamera.eye,this._tmpDir),Ae(this._tmpN,this.startCamera.eye,this.startCamera.center),Re(this._tmpN,this._tmpN),this._tmpN[1]<0&&fp(this._tmpN,this._tmpN),Qg(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.running)return;kDt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||me(this._tmpPoi,this.currentCamera.center),VS(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);na(this._normalizedAnchorPoint,this._tmpP0),Ae(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Ve(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(me(this._constraintOptions.interactionDirection,this._tmpRayDir),he(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<w1||(he(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=$e($x,this.currentCamera.eye,this._tmpRayDir),cr($x,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?$x[2]=Math.max(this.startCamera.center[2],$x[2]):$x[2]=Math.min(this.startCamera.center[2],$x[2]),this.currentCamera.center=$x,this._constraintOptions.interactionFactor=sp(nm(this.dragBeginPoint,e)),As(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}finish(){this.running&&this.finishController()}};Pae=c([R("esri.views.3d.state.controllers.ZoomControllerLocal")],Pae);const $x=I(),qkt=Ye(0,0,1);let Gkt=class extends _s{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i,this._fovModifier=r,this.registerIncoming("drag",[r],s=>this._handleZoom(s)),this.registerIncoming("drag",s=>this._handleZoom(s))}_handleZoom(e){const i=e.data;if(i.pointers.size>1||!Jue(e.data,this.pointerActions))return;const r=yn(i.center.x,i.center.y);switch(i.action){case"start":{this._cameraController?.finish();const s=this._view,n=e.modifiers.has(this._fovModifier);this._cameraController=n?new lA({view:s,onStop:()=>this._stopController()}):s.state.isGlobal?new Oae({view:s}):new Pae({view:s}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break}case"update":this._cameraController?.update(r);break;case"end":this._cameraController instanceof lA?this._cameraController.updateTimeout():this._stopController()}e.stopPropagation()}_stopController(){this._cameraController?.finish(),this._cameraController=null}},vS=class extends Hf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new wr,this._headingStart=0,this._constraintOptions=new nd(15,0,0,new wr,null,1)}handleEventGamepad(e){const i=Zre(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||DU(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,U1e(this._keysButtonState,this._transformation)}directionActive(e){return this._keysButtonState[e]===1}countActiveDirections(){return this._keysButtonState.reduce((e,i)=>i>0?e+1:e,0)}deactivateDirection(e){this._keysButtonState[e]=0;const i=U1e(this._keysButtonState,this._transformation);DU(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Cx),this._applyDisabledMovementTypes(Cx),this._applyPan(Cx.pan),this._applyRotate(Cx.rotate),this._applyZoom(Cx.zoom),this._applyAscend(Cx.ascend),this._constraintOptions.interactionType=0,this._constraintOptions.selection=8,As(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;Ae(cc,i.center,i.eye),Ft(cc,cc,e.matrix),i.center=$e(cc,cc,i.eye),i.up=Ft(cc,i.up,e.matrix),this._constraintOptions.interactionType=3,this._constraintOptions.selection=7,As(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=Ft(cc,i.eye,e.matrix),i.center=Ft(cc,i.center,e.matrix),this.view.state.isGlobal&&(i.up=Ft(cc,i.up,e.matrix)),this._constraintOptions.interactionType=4,this._constraintOptions.selection=15,As(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=$e(cc,this.currentCamera.eye,he(Xe.get(),i,e)),me(EI,i),fp(EI,EI),this._constraintOptions.interactionDirection=EI,this._constraintOptions.interactionType=1,this._constraintOptions.selection=7,As(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Xe.get());if(this._constraintOptions.interactionDirection=me(EI,i),this.view.state.isGlobal){const r=Ve(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=he(cc,this.currentCamera.eye,s),this.currentCamera.center=he(cc,this.currentCamera.center,s)}else{const r=he(Xe.get(),i,e);this.currentCamera.eye=$e(cc,this.currentCamera.eye,r),this.currentCamera.center=$e(cc,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=5,this._constraintOptions.selection=8,As(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=7,As(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){Xkt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,cc)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,a=this._transformation,o=this.view.navigation.gamepad,l=xe(Xe.get(),n[0],n[1],0);Re(l,l);const u=a.translation[0]*e.pan;if(u!==0){const x=he(Xe.get(),s,u);$p(r.pan.matrix,r.pan.matrix,x),r.pan.enabled=!0}switch(o.mode){case"pan":{const x=-a.translation[1]*e.pan;if(x!==0){const S=he(Xe.get(),l,x);$p(r.pan.matrix,r.pan.matrix,S),r.pan.enabled=!0}r.zoom=a.zoom*e.zoom;break}case"zoom":r.zoom=(-a.translation[1]+a.zoom)*e.zoom;break;default:o.mode}const d=a.translation[2]*e.ascend;r.ascend=d;const f=-a.heading*e.rotate;f!==0&&(Uh(r.rotate.matrix,r.rotate.matrix,f,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Xe.get())),r.rotate.enabled=!0);const g=a.tilt*e.rotate,v=G0(this.view.renderCoordsHelper,i.center,i.eye),_=Ce(v+g,qo.min,qo.max)-v;_&&(Uh(r.rotate.matrix,r.rotate.matrix,_,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,a=this._transformation,o=this.view.navigation.gamepad,l=At(Xe.get(),n,s);Re(l,l),fp(l,l),jDt(this.startCamera,i,a,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Cx.pan,this._tmpCamera);const u=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,d=a.translation[2]*e.ascend;r.ascend=d;const f=-a.heading*e.rotate;f!==0&&(Uh(r.rotate.matrix,r.rotate.matrix,f,this._tmpCamera.eye),r.rotate.enabled=!0);const g=a.tilt*e.rotate,v=this._clampTiltDeltaGlobalToValidRange(g,i.ray,u);v!==0&&(Uh(r.rotate.matrix,r.rotate.matrix,v,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=a.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=xr(this.view.spatialReference),n=PB(qo.min,i.origin,r,s);let a=0,o=0;const l=Xe.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const u=G0(this.view.renderCoordsHelper,l,i.origin);a=PB(u,i.origin,r,s),o=PB(qo.max,i.origin,r,s)}else{PP(O$(pH,r+s.radius),i,l);const u=Math.PI+Jhe(i.direction,l);a=QTe(u,i.origin,r,s),o=QTe(qo.max,i.origin,r,s)}return Ce(a+e,n,o)-a}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),a=i+Math.abs(n-i);return s.setAltitude(r,a,e),a}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=GOt(this.view,i,0,o8e,Qkt),a=r.intersectManifoldClosestSilhouette(um(i,n),e,Xe.get()),o=Bi(i,a),l=r.intersectManifoldClosestSilhouette(um(i,L1(Xe.get(),i,s.center)),e,Xe.get()),u=Bi(i,l);return Math.min(o,u)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,a=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Xe.get());if(n){const o=Ae(Xe.get(),e,a),l=Ve(o);he(o,o,1/l);const u=Re(Xe.get(),e),d=Ao(Le(u,o));return l*Math.sin(Math.min(Wkt,d))}{const o=me(Xe.get(),e);return i.setAltitude(o,this._filteredSurfaceElevation),Bi(a,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Zkt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+xr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,a=Xe.get(),o=this._getPointAbsoluteSurfaceElevation(s.eye,i,a),l=this._clampedDistanceToSurface(i,a),u=s.width/2,d=g$e*s.width,f=g$e*s.width,g=l*Math.tan(.5*s.fovX)/u,v=g/r,_=g/this._computeHeadingRotateRadius(a),x=o-i;return{pan:(n?v:g)*d*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(d*e/u)*x-x),zoom:2**(d*e/u)*l-l,rotate:Ce(_*f,Ykt,Jkt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&lm(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&lm(e.rotate.matrix))}static activatesFor(e,i){const r=Zre(i,e.navigation.gamepad,Hkt);return!(i.action==="end"||DU(r))}};c([p({constructOnly:!0})],vS.prototype,"gamepadDevice",void 0),c([p({constructOnly:!0})],vS.prototype,"disableMovements",void 0),vS=c([R("esri.views.3d.state.controllers.GamepadKeyboardController")],vS);const Hkt={translation:[0,0,0],heading:0,tilt:0,zoom:0},o8e=80,Wkt=zt(o8e),g$e=.75,Zkt=5,Ykt=zt(30),Jkt=zt(80),Cx={zoom:0,ascend:0,pan:{enabled:!1,matrix:ut()},rotate:{enabled:!1,matrix:ut()}},cc=I(),EI=I(),Qkt=_de();function Xkt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,lm(t.pan.matrix),t.rotate.enabled=!1,lm(t.rotate.matrix)}let Kkt=class extends _s{constructor(e){super(!0),this._view=e,this._watchHandles=new X0,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([X(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Yt),X(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad?.running;if(r||vS.activatesFor(this._view,e.data)){if(!r){const s=new vS({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s),s.state!==1&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}},e4t=class extends _s{constructor(e,i){super(!0),this._view=e,this._keyToDirection=new Map,this._keyToAction=new Map,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2},this._stickyKeyTimeoutHandle=void 0,this._stickyKeyDuration=200,this._addKeysMapping(i),this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=Xue(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}setStickyKeyDuration(e){this._stickyKeyDuration=e}_addKeysMapping(e){this._addKeyMapping(e.pan.left,0),this._addKeyMapping(e.pan.right,1),this._addKeyMapping(e.pan.forward,2),this._addKeyMapping(e.pan.backward,3),this._addKeyMapping(e.pan.up,4),this._addKeyMapping(e.pan.down,5),this._addKeyMapping(e.lookAround.headingLeft,6),this._addKeyMapping(e.lookAround.headingRight,7),this._addKeyMapping(e.lookAround.tiltUp,8),this._addKeyMapping(e.lookAround.tiltDown,9),this._addKeyMapping(e.zoom.zoomIn,10),this._addKeyMapping(e.zoom.zoomOut,11),this._addKeyAction(e.reset.heading,()=>this._resetHeading()),this._addKeyAction(e.reset.tilt,()=>this._resetTilt())}_addKeyMapping(e,i){for(const r of this._eachKey(e))this._keyToDirection.set(r,i)}*_eachKey(e){typeof e=="string"?yield e:yield*e}_addKeyAction(e,i){for(const r of this._eachKey(e))this._keyToAction.set(r,i)}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToAction.get(e.data.key);if(i!=null)return e.stopPropagation(),void i();const r=this._keyToDirection.get(e.data.key);if(r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new vS({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running)){if(e.stopPropagation(),this._cameraControllerKeyboard.directionActive(r)||(this._cameraControllerKeyboard.activateDirection(r),this._cameraControllerKeyboard.countActiveDirections()>1||!this._isPanning(r)))return;this._stickyKeyDuration>0&&(this._stickyKeyTimeoutHandle=setTimeout(()=>{this._stickyKeyTimeoutHandle=void 0,this._stickyDirection!=null&&this._stickyDirection!==void 0&&(this._cameraControllerKeyboard?.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)},this._stickyKeyDuration))}}_handleStop(){this._cameraControllerKeyboard?.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey||!this._cameraControllerKeyboard?.running)return;const i=this._keyToDirection.get(e.data.key);if(i==null)return;e.stopPropagation();const r=this._stickyKeyTimeoutHandle===void 0;this._stickyKeyTimeoutHandle===void 0||this._cameraControllerKeyboard?.countActiveDirections()!==1?(this._cameraControllerKeyboard?.deactivateDirection(i),r&&(this._stickyDirection=void 0)):this._stickyDirection=i}_isPanning(e){return e<=3}_resetHeading(){this._view.goTo({heading:0}).catch(()=>{})}_resetTilt(){this._view.goTo({tilt:0}).catch(()=>{})}},t4t=class extends _s{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",[i],r=>this._handleFov(r)),this.registerIncoming("mouse-wheel",r=>this._handleZoom(r))}_handleZoom(e){if(!this._mouseWheelZoomEnabled)return;const i=e.data;this._zoomController?.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new PG({view:this._view,mode:"interaction"}):new RG({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._zoomController)),this._zoomController.step(-i.deltaY/60,yn(i.x,i.y)),e.preventDefault(),e.stopPropagation()}_handleFov(e){this._mouseWheelZoomEnabled&&(this._fovController?.running||(this._zoomController?.finish(),this._fovController?.hideOverlay(),this._fovController=new lA({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),this._fovController.state!==1)?(this._fovController.updateTimeout(),this._fovController.step(e.data.deltaY/20),e.preventDefault(),e.stopPropagation()):this._stopFovController())}get _mouseWheelZoomEnabled(){return this._view.navigation.actionMap.mouseWheel==="zoom"}_stopFovController(){this._fovController?.finish(),this._fovController=null}},kG=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},c$=class extends cL{constructor(){super(...arguments),this._beginCamera=new wr,this._elapsedTime=0,this.constraintOptions=new nd(15,4,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new j0}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTime=this._elapsedTime+e,this.momentumStep(this._elapsedTime,i),As(this.view,i,this.constraintOptions),this.momentum.isFinished(this._elapsedTime)&&this.finishController()}};c$=c([R("esri.views.3d.state.controllers.momentum.MomentumController")],c$);let Y4=class extends c${constructor(e){super(e),this.interactionType=4,this._tmpPan=I()}momentumStep(e,i){const r=this.momentum.value(e);he(this._tmpPan,this.momentum.direction,r),i.eye=Ae(y$e,i.eye,this._tmpPan),i.center=Ae(y$e,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};c([p({constructOnly:!0})],Y4.prototype,"momentum",void 0),Y4=c([R("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],Y4);const y$e=I(),i4t=I(),$j=I();let LB=class extends c${constructor(e){super(e),this.interactionType=4}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);me($j,i.eye),Re($j,$j),At(this.momentum.axis2,$j,this.momentum.axis1),ZBe(i,i4t,this.momentum.axis1,r,this.momentum.axis2,s)}};c([p({constructOnly:!0})],LB.prototype,"momentum",void 0),LB=c([R("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],LB);let Z2=class extends c${constructor(e){super(e),this.interactionType=2}momentumStep(e,i){const r=this.momentum.value(e);x1(i,this.center,uL(this.axis,r))}set center(e){this._set("center",Tr(e))}set axis(e){this._set("axis",Tr(e))}};c([p({constructOnly:!0})],Z2.prototype,"center",null),c([p({constructOnly:!0})],Z2.prototype,"axis",null),c([p({constructOnly:!0})],Z2.prototype,"momentum",void 0),Z2=c([R("esri.views.3d.state.controllers.momentum.RotationMomentumController")],Z2);let _E=class extends c${constructor(e){super(e),this.interactionType=1,this.constraintOptions.interactionDirection=I()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;me(r,i.eye);const s=this.momentum.valueDelta(0,e);Jde(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),L1(r,i.eye,r)}set zoomCenter(e){this._set("zoomCenter",Tr(e))}};c([p({constructOnly:!0})],_E.prototype,"momentum",void 0),c([p({constructOnly:!0})],_E.prototype,"zoomCenter",null),_E=c([R("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],_E);let E2=class extends c${constructor(e){super(e),this.radius=0,this.interactionType=1,this._tmpSceneCenter=I(),this._tmpZoomAxisAngle=$H(),this._sphere=Is()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);UBe(this._sphere,i,r),this.constraintOptions.interactionType=1,As(this.view,i,this.constraintOptions),hL(this._sphere,i,this.screenCenter,this._tmpSceneCenter),Hde(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),x1(i,Li(this._sphere),this._tmpZoomAxisAngle),this.constraintOptions.interactionType=4}set screenCenter(e){this._set("screenCenter",yn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Tr(e))}};c([p({constructOnly:!0})],E2.prototype,"momentum",void 0),c([p({constructOnly:!0})],E2.prototype,"radius",void 0),c([p({constructOnly:!0})],E2.prototype,"screenCenter",null),c([p({constructOnly:!0})],E2.prototype,"sceneCenter",null),E2=c([R("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],E2);let kf=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},OH=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},r4t=class extends OH{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},l8e=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new kf(.6),this._screen=[new kf(.4),new kf(.4)],this._scene=[new kf(.6),new kf(.6),new kf(.6)],this._tmpDirection=I()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){xe(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ve(this._tmpDirection);s>0&&he(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new r4t(e,i,r,n==null?0:s/n,this._tmpDirection)}},v$e=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const _$e=1e-5;let s4t=class extends OH{constructor(e,i,r,s,n,a=0,o){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=a,this.axis2=o}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},n4t=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=I(),this._tmpAxis2=I(),this._tmpAngles=Ke(),this._time=new kf(.3),this._screen=[new kf(.4),new kf(.4)],this._angle1=new v$e(.6),this._angle2=new v$e(.6),this._axis1=I(),this._axis2=I(),this._lastScene=I()}addMomentumDirectRotation(e,i,r,s,n,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let o=HBe(this._lastScene,i,this._tmpAxis2,s,n,a);this._angle2.update(0),ea(this._tmpAxis2)<_$e?o=0:Re(this._axis1,this._tmpAxis2),this._angle1.update(o),me(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,a,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;WBe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,a,o,!1),ea(this._tmpAxis2)<_$e?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Re(this._axis1,this._tmpAxis1),Re(this._axis2,this._tmpAxis2)),me(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,a=this._angle2.filteredValue,o=s==null||a==null?0:a/s;return new s4t(e,i,r,s==null||n==null?0:n/s,this._axis1,o,this._axis2)}},c8e=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new kf(.8),this.time=new kf(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Ce(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new OH(e,i,r)}},u8e=class extends c8e{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},a4t=class extends OH{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},h8e=class extends c8e{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new a4t(e,i,r)}},Rae=class extends Hf{constructor(){super(...arguments),this._smoothRotation=new kG(.05),this._rotationAxis=I(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Ui(),this._beginRadius=0,this._smoothScaling=new kG(.05),this._zoomCenterScreen=yn(),this._zoomMomentumEstimator=new h8e,this._rotationMomentumEstimator=new u8e,this._panSphericalMomentumEstimator=new n4t,this._panPlanarMomentumEstimator=new l8e,this._adjustedSphere=Is(),this._tmp3d=I(),this._tmpScreenPointArray=yn(),this._beginScreenPoint=yn(),this._beginScenePoint=I(),this._screenPickPoint=yn(),this._scenePickPoint=I(),this._navigationMode=1,this._sphere=Is(),this._pointerCount=0,this._tmpInteractionDirection=I(),this._beginCamera=new wr,this._constraintOptions=new nd(15,0,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-Kw.normalize(zt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Ff(e.center,this._screenPickPoint),na(this._beginScreenPoint,this._screenPickPoint);const i=qBe(this._intersectionHelper,this.startCamera,this._screenPickPoint,xr(this.view.spatialReference).radius,1,this.view.basemapTerrain.invisible?L$:{});i.scenePickPoint!=null&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,me(this._beginScenePoint,this._scenePickPoint),this._navigationMode=qF(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navigationMode===0&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navigationMode===1?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navigationMode===1?new E2({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new _E({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Z2({view:this.view,momentum:r,center:q0(this._sphere,I()),axis:this._rotationAxis});if(this._navigationMode===1){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new LB({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new Y4({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=fp(this._tmp3d,this.startCamera.viewForward);Qg(this._scenePickPoint,r,this._panningPlane);const s=yn(this._screenPickPoint[0],0),n=I(),a=Ve(this.startCamera.eye);this._adjustedSphere[3]=a<this._sphere[3]?a-100:this._sphere[3],hL(this._adjustedSphere,this.startCamera,s,n);const o=I(),l=I(),u=I();Ae(o,this._scenePickPoint,this.currentCamera.eye);const d=Ve(o);Re(o,o);const f=VBe*Math.max(Math.abs(this.view.camera.position.z),jBe),g=this.view.stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,BF);let v=g??f;i&&(v=Math.min(v,d)),me(u,$e(l,this.currentCamera.eye,he(l,o,v))),this._panningPlane[3]=-Le(this._panningPlane,u),this.startCamera.center=$e(l,this.startCamera.eye,he(l,this.startCamera.viewForward,v));const _=Ff(e.center,this._tmpScreenPointArray);Eae(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),UBe(this._sphere,this.currentCamera,this._smoothScaling.value),Ff(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=1,this._constraintOptions.interactionFactor=sp(e.radius-this._beginRadius),As(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=Ff(e.center,this._tmpScreenPointArray);hL(this._sphere,this.currentCamera,i,this._tmp3d),Qde(this._beginScenePoint,Le(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera.aboveGround)?(JBe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(YBe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=4,this._constraintOptions.interactionFactor=sp(nm(this._screenPickPoint,i)),As(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Re(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||fp(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+Mae(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),x1(this.currentCamera,Li(this._sphere),uL(this._rotationAxis,n)),this._constraintOptions.interactionType=2,this._constraintOptions.interactionFactor=sp(e.radius*r),As(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=Ff(e.center,this._tmpScreenPointArray);Eae(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(GBe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=4,this._constraintOptions.interactionFactor=sp(nm(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),As(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Jde(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=1,this._constraintOptions.interactionFactor=sp(e.radius-this._beginRadius),As(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){me(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||fp(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=Mae(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const a=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(a,.001*e.timestamp),x1(this.currentCamera,Li(this._sphere),uL(this._rotationAxis,a)),this._constraintOptions.interactionType=2,this._constraintOptions.interactionFactor=sp(e.radius*a),As(this.view,this.currentCamera,this._constraintOptions)}};Rae=c([R("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],Rae);const b$e=Ye(0,0,1);let Iae=class extends Hf{constructor(){super(...arguments),this._rotationValueSmooth=new kG(.05),this._scalingValueSmooth=new kG(.05),this._planeHorizontal=Ui(),this._planeVertical=Ui(),this._rotationMomentumEstimator=new u8e,this._panMomentumEstimator=new l8e(300,12,.9),this._zoomMomentumEstimator=new h8e,this._beginRadius=0,this._beginCenter=I(),this._beginAngle=0,this._tmpPoints=[],this._navigationMode=1,this._beginCenterScreen=yn(),this._tmpCentroid3d=I(),this._tmpCentroid2d=yn(),this._tmp2d=yn(),this._pointerCount=0,this._beginCamera=new wr,this._constraintOptions=new nd(15,0,0,this._beginCamera)}begin(e){if(!this.running)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Ff(e.center,this._beginCenterScreen),Pje(b$e,0,this._planeHorizontal);const r=I(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.basemapTerrain.invisible?L$:{}),n=I();fp(n,this.startCamera.viewForward);const a=I();me(a,b$e);const o=Le(n,a);this._navigationMode=qF(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=LP(a,this.startCamera.viewForward,VBe)*Math.max(Math.abs(this.view.camera.position.z),jBe);Nne(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||C3t(this._planeHorizontal,this._planeHorizontal);const u=I(),d=I(),f=I();Ae(u,r,this.currentCamera.eye);const g=Ve(u);if(Re(u,u),this._navigationMode===0){he(a,a,o),Ae(this._planeVertical,n,a),Re(this._planeVertical,this._planeVertical),Nne(this._planeVertical,this._planeVertical,r);const v=this.view.stage.renderView.getMinimalDepthForArea(dL(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,BF);let _=v??l;s&&(_=Math.min(_,g)),me(f,$e(d,this.currentCamera.eye,he(d,u,_))),this._planeVertical[3]=-Le(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),iX(this._tmpPoints,this._beginCenter)}else{const v=s?g:l;me(f,$e(d,this.currentCamera.eye,he(d,u,v))),this._planeHorizontal[3]=-Le(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),iX(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navigationMode===1?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,a=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=a,this._scalingValueSmooth.update(n),Jde(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=1,this._constraintOptions.interactionFactor=sp(Math.abs(e.radius-this._beginRadius)),As(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),iX(this._tmpPoints,this._tmpCentroid3d),Ff(e.center,this._tmpCentroid2d),GBe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=4,this._constraintOptions.interactionFactor=sp(nm(this._beginCenterScreen,this._tmpCentroid2d)),As(this.view,this.currentCamera,this._constraintOptions),i){const n=s,a=this._rotationValueSmooth.value,o=a+Mae(e.angle-a),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(o);const u=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(u,.001*e.timestamp);const d=this._planeHorizontal;x1(this.currentCamera,n,uL(d,u)),this._constraintOptions.interactionType=2,this._constraintOptions.interactionFactor=sp(Math.abs(e.radius*u)),As(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new _E({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Z2({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new Y4({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let a=0;return e.forEach(o=>{n[0]=o.x,n[1]=o.y,s[a]===void 0&&(s[a]=I()),Eae(i,r,n,s[a]),a+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};Iae=c([R("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],Iae);let w$e=class extends _s{constructor(e,i,r){super(!0),this._view=e,this.pointerActions=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Jue(e.data,this.pointerActions))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.running&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.running?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller?.running){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Rae({view:this._view}):new Iae({view:this._view})}},o4t=class extends _s{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},l4t=class extends _s{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){const i=this._invert?-1:1,r=yn(0,e.data.delta*i);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new Z4({view:this._view,pivot:0}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}},c4t=class extends _s{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new $F({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,a=1/0;for(const{x,y:S}of i.pointers.values())r=Math.max(r,x),s=Math.min(s,x),n=Math.max(n,S),a=Math.min(a,S);let o=-1/0,l=1/0,u=-1/0,d=1/0;for(const{x,y:S}of e.pointers.values())o=Math.max(o,x),l=Math.min(l,x),u=Math.max(u,S),d=Math.min(d,S);const f=r-s,g=n-a,v=o-l,_=u-d;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(v-f)<=this._maxDelta&&Math.abs(_-g)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const a=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-a.y))}),r>=this._threshold}},bv=class extends be{constructor(){super(...arguments),this.mode="default",this._updateMode=({mode:e,dragPrimary:i,dragSecondary:r,dragTertiary:s})=>{e==="pro"&&(r="zoom",s=i==="pan"?"rotate":"pan");const n={dragPrimary:i,dragSecondary:r,dragTertiary:s};this._modeDragPan&&(this._modeDragPan.pointerActions=k4("pan",n)),this._modeDragRotate&&(this._modeDragRotate.pointerActions=k4("rotate",n)),this._modeDragZoom&&(this._modeDragZoom.pointerActions=k4("zoom",n))}}destroy(){this.disconnect()}get primaryDragAction(){return this.view.navigation.actionMap.dragPrimary}set primaryDragAction(e){const{actionMap:i}=this.view.navigation;i.dragPrimary=e,i.dragSecondary=e==="pan"?"rotate":"pan"}get updating(){return!!this._inputManager?.updating}get latestPointerInfo(){return this._inputManager?.latestPointerInfo}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.removeAllHandles(),this.view.viewEvents.disconnect(),this._modeDragPan=null,this._modeDragRotate=null,this._modeDragZoom=null,this._modeKeyboardNavigation=null,this._inputManager=Pe(this._inputManager),this._source=Pe(this._source)}connect(){const e=this.view;this._source=new tze(this.view.surface,e.input);const i=[new aze,new oze,new lze,new sze(this.view.navigation),new c4t],r=new zd({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new ize],Br.INTERNAL);const s={fov:"Shift",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:["u","U"],down:["j","J"]},lookAround:{headingLeft:["a","A"],headingRight:["d","D"],tiltUp:["w","W"],tiltDown:["s","S"],modifier:"b"},zoom:{zoomIn:["+","="],zoomOut:["-","_"]},reset:{heading:["n","N"],tilt:["p","P"]}};this._modeDragPan=new w$e(e,["primary"]),this._modeDragRotate=new uX(e,["secondary"],0),this._modeDragZoom=new Gkt(e,["tertiary"],s.fov),this._modeKeyboardNavigation=new e4t(e,s),r.installHandlers("navigation",[new o4t(e),new ZDt(e),new Kkt(e),new t4t(e,s.fov),new uX(e,["primary"],1,[s.lookAround.modifier]),new uX(e,["secondary"],0,[s.lookAround.modifier]),new w$e(e,["tertiary"],[s.lookAround.modifier]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new l4t(e)],Br.INTERNAL),this.view.viewEvents.connect(r),this.addHandles([X(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Yt),X(()=>{const{actionMap:n}=this.view.navigation,{dragPrimary:a,dragSecondary:o,dragTertiary:l}=n;return{mode:this.mode,dragPrimary:a,dragSecondary:o,dragTertiary:l}},this._updateMode,bt)])}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}get test(){}};c([p()],bv.prototype,"view",void 0),c([p({type:["default","pro"]})],bv.prototype,"mode",void 0),c([p({readOnly:!0})],bv.prototype,"updating",null),c([p()],bv.prototype,"latestPointerInfo",null),c([p()],bv.prototype,"multiTouchActive",null),c([p()],bv.prototype,"_inputManager",void 0),bv=c([R("esri.views.3d.input.SceneInputManager")],bv);const u4t=bv;let ln=class extends be{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};c([p()],ln.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),c([p()],ln.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),c([p()],ln.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),c([p()],ln.prototype,"DECONFLICTOR_SHOW_GRID",void 0),c([p()],ln.prototype,"LABELS_SHOW_BORDER",void 0),c([p()],ln.prototype,"TEXT_SHOW_BASELINE",void 0),c([p()],ln.prototype,"TEXT_SHOW_BORDER",void 0),c([p()],ln.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),c([p()],ln.prototype,"OVERLAY_SHOW_CENTER",void 0),c([p()],ln.prototype,"SHOW_POI",void 0),c([p()],ln.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),c([p()],ln.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),c([p()],ln.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),c([p()],ln.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),c([p()],ln.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),c([p()],ln.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),c([p()],ln.prototype,"I3S_TREE_SHOW_TILES",void 0),c([p()],ln.prototype,"I3S_SHOW_MODIFICATIONS",void 0),c([p()],ln.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),c([p()],ln.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),c([p()],ln.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),c([p()],ln.prototype,"LINE_WIREFRAMES",void 0),ln=c([R("esri.views.3d.support.debugFlags")],ln);const bn=new ln;let Wa,HO,Dae=!1,kae=!1,Lae=!1,Fae=!1,J4=null;function h4t(t){const e=kae?t():null;if(!e?.bins)return;d8e();const i=HO;let r=0;for(let s=0;s<e.numX;s++)for(let n=0;n<e.numY;n++){const a=e.bins[s][e.numY-1-n];r+=a.length;const o=s*e.sizeX,l=(s+1)*e.sizeX,u=n*e.sizeY,d=(n+1)*e.sizeY;i.fillText(a.length.toFixed(),o+5,u+15),p8e(o,l,u,d,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.numVisible,70,50),i.fillText("total numTests: "+e.numTests,70,30)}function d4t(t){Lae=bn.DECONFLICTOR_SHOW_VISIBLE,Fae=bn.DECONFLICTOR_SHOW_INVISIBLE,Dae=Lae||Fae,kae=bn.DECONFLICTOR_SHOW_GRID,J4=null,Dae||kae?(HO&&Wa&&HO.clearRect(0,0,Wa.width,Wa.height),J4=()=>p4t(t)):Wa&&(Wa.parentElement.removeChild(Wa),Wa=null)}function d8e(){J4&&(J4(),J4=null)}function p4t(t){Wa==null&&(Wa=document.createElement("canvas"),Wa.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Wa),Wa.style.position="absolute",Wa.style.width="100%",Wa.style.height="100%",Wa.style.display="block",Wa.style.pointerEvents="none",HO=Wa.getContext("2d"),HO.font="12px Arial");const{width:e,height:i}=t.state.camera;Wa.width=e,Wa.height=i}function p8e(t,e,i,r,s){d8e();const n=Wa.height,a=HO;a.beginPath(),a.lineWidth=1,a.strokeStyle=s,a.moveTo(t,n-i),a.lineTo(e,n-i),a.stroke(),a.lineTo(e,n-r),a.stroke(),a.lineTo(t,n-r),a.stroke(),a.lineTo(t,n-i),a.stroke(),a.closePath()}function f8e(t,e,i=!1){Dae&&(e&&Lae||!e&&Fae)&&p8e(t[0],t[2],t[1],t[3],i?e?"pink":"grey":e?"green":"red")}let f4t=class{constructor(e,i,r){this._setVisibility=e,this._canConflict=i,this._compare=r,this.done=!1,this._items=new Array,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null}destroy(){this._generator=null,this._accBins=null,this._items.length=0}reset(e,i){this._initBins(e,i),this._items.length=0,this.done=!1,this._generator=null}add(e){this._items.push(e)}run(e){this._generator??=this._run(e),this.done=!!this._generator.next(e).done}*_run(e){yield*this._sort(e),yield*this._deconflict(e),h4t(()=>({bins:this._accBins,numX:this._accBinsNumX,numY:this._accBinsNumY,sizeX:this._accBinsSizeX,sizeY:this._accBinsSizeY,numTests:0,numVisible:this._items.length}))}*_sort(e){for(const i of SPe(this._items,0,this._items.length,this._compare))e.madeProgress(),e.done&&(e=yield)}_isConflicted(e){let i=!0;return this._forEachBin(e.aabr,r=>(i=!1,r.some(s=>this._canConflict(s,e)&&vce(s.aabr,e.aabr))))||i}*_deconflict(e){for(const i of this._items){e.done&&(e=yield);const r=!this._isConflicted(i);this._setVisibility(i,r),f8e(i.aabr,r),r&&this._addToBins(i),e.madeProgress()}}_initBins(e,i){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const s=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)s.push(new Ai)}}else for(let r=0;r<this._accBinsNumX;r++)for(let s=0;s<this._accBinsNumY;s++)this._accBins[r][s].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=i/this._accBinsNumY}_addToBins(e){this._forEachBin(e.aabr,i=>i.push(e))}_forEachBin(e,i){if(!this._accBins)return!1;const r=Math.max(Math.floor(e[0]/this._accBinsSizeX),0),s=Math.max(Math.floor(e[1]/this._accBinsSizeY),0),n=Math.min(Math.floor(e[2]/this._accBinsSizeX),this._accBinsNumX-1),a=Math.min(Math.floor(e[3]/this._accBinsSizeY),this._accBinsNumY-1);for(let o=r;o<=n;o++)for(let l=s;l<=a;l++)if(i(this._accBins[o][l]))return!0;return!1}},m4t=class{constructor(e){this._gl=e,this._sync=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0)}poll(){const e=this._gl,i=e.clientWaitSync(this._sync,e.SYNC_FLUSH_COMMANDS_BIT,0);if(i===e.WAIT_FAILED)throw new Error("clientWaitSync failed");return i!==e.TIMEOUT_EXPIRED}destroy(){this._gl.deleteSync(this._sync),this._sync=null}},A2=class extends Nc{constructor(e){super(e),this.category=ps.COMPOSITE,this.readyToRun=!1,this.done=!0,this._origin=I(),this._textureWidth=256,this._uploadBuffer=new Float32Array(3*this._textureWidth),this._counter=0,this._width=0,this._height=0,this._pixelBufferSize=0,this._pipeline=_i({colorWrite:Fi}),this._format=0}initialize(){const e=this.view.resourceController.scheduler.registerTask(Tt.GRAPHICS_CORE,this);this.addHandles(e),this.produces="disabled",this.consumes.required=[this.category],this.formatOverride&&(this._format=this.formatOverride)}destroy(){this._program=jt(this._program);const e=this.gl;this._sync=Pe(this._sync),this._pixelBuffer&&(e.deleteBuffer(this._pixelBuffer),this._pixelBuffer=null,this._pixelBufferSize=0),this._texture=jt(this._texture)}precompile(){this._ensureProgram(this.renderingContext)}render(e){const i=e.find(({name:d})=>d===this.category);if(this._sync)return i;this.produces="disabled";const r=this.renderingContext,s=this.gl,n=i.getTexture(s.DEPTH_STENCIL_ATTACHMENT);if(!n)return i;const a=this.view.stage.renderer.fboCache.acquire(this._width,this._height,"hud visibility",9);r.bindFramebuffer(a.fbo),r.setPipelineState(this._pipeline);const o=this._ensureProgram(r);r.useProgram(o);const l=0;r.bindTexture(n,l),o.setUniform1i("depthTex",l);const u=1;return r.bindTexture(this._texture,u),o.setUniform1i("positionTex",u),Cn(dX,this.camera.viewMatrix,A7(dX,this._origin)),o.setUniformMatrix4fv("view",dX),o.setUniformMatrix4fv("proj",this.camera.projectionMatrix),o.setUniform1i("count",this._counter),r.screen.draw(),this._pixelBuffer||(this._pixelBuffer=s.createBuffer()),this._format===0&&(this._format=s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT)===6403&&s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE)===Di.FLOAT?6403:6408),this._pixelBufferSize=this._width*this._height*(this._format===6403?4:16),s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pixelBuffer),s.bufferData(s.PIXEL_PACK_BUFFER,this._pixelBufferSize,s.STREAM_READ),s.readPixels(0,0,this._width,this._height,this._format,Di.FLOAT,0),this._sync=new m4t(s),a.release(),setTimeout(()=>this.readyToRun=!0,0),i}runTask(){if(!this._sync)return void(this.readyToRun=!1);try{if(!this._sync.poll())return Oa}catch{return this.readyToRun=!1,void(this._sync=Pe(this._sync))}this.readyToRun=!1,this._sync=Pe(this._sync);const e=this.gl;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pixelBuffer),this._cpuBuffer=new Float32Array(this._width*this._height*(this._format===6403?1:4)),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._cpuBuffer),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),this.done=!0}init(e,i){const r=this._textureWidth;if(this._width=r,this._height=Math.ceil(e/r),this._counter=0,this._texture?.dispose(),this._height===0)return;const s=new ar(this._width,this._height);s.pixelFormat=6407,s.dataType=Ns.FLOAT,s.samplingMode=9728,this._texture=new qi(this.renderingContext,s),this.done=!1,xe(this._origin,Math.fround(i[0]),Math.fround(i[1]),Math.fround(i[2]))}addPosition(e){const i=this._width;if(this._counter>=i*this._height)return-1;const r=this._counter%i;return xi(Cj,e,this._origin),this._uploadBuffer[3*r+0]=Cj[0],this._uploadBuffer[3*r+1]=Cj[1],this._uploadBuffer[3*r+2]=Cj[2],r===i-1&&this._flush(),this._counter++}start(){if(this._width===0||this._height===0)return;const e=this._width;this._counter%e>0&&this._flush(),this.produces=this.category,this.requestRender(1)}getOcclusion(e){return this._cpuBuffer?.[this._format===6403?e:4*e]??-1}get usedMemory(){return(this._texture?.usedMemory??0)+this._pixelBufferSize+4*(this._uploadBuffer?.length??0)+4*(this._cpuBuffer?.length??0)}_flush(){const e=this._width,i=Math.floor(this._counter/e);this._texture?.updateData(0,0,i,e,1,this._uploadBuffer)}_ensureProgram(e){return this._program??=e.programCache.acquire(g4t,y4t,wn),this._program}};c([p()],A2.prototype,"category",void 0),c([p()],A2.prototype,"formatOverride",void 0),c([p()],A2.prototype,"readyToRun",void 0),c([p()],A2.prototype,"done",void 0),A2=c([R("esri.views.3d.webgl-engine.lib.GPUPointOcclusionQuery")],A2);const g4t=`#version 300 es
precision highp float;
in vec2 position;

void main() {
    gl_Position = vec4(position, 0.0, 1.0);
}`,y4t=`#version 300 es
precision highp float;
out highp vec4 fragColor;

uniform highp mat4 proj;
uniform highp mat4 view;

uniform highp int count;

uniform highp sampler2D depthTex;
uniform highp sampler2D positionTex;

float linearizeDepth(float depth) {
  float depthNdc = depth * 2.0 - 1.0;
  float c1 = proj[3][2];
  float c2 = proj[2][2];
  return -c1 / (depthNdc + c2 + 1e-7);
}

void main() {
  int u = int(floor(gl_FragCoord.x));
  int v = int(floor(gl_FragCoord.y));
  if (u + v * textureSize(positionTex, 0).x >= count) {
    fragColor = vec4(-1);
    return;
  }
  vec4 posWorld = vec4(texelFetch(positionTex, ivec2(u, v), 0).rgb, 1.0);

  vec4 posView = view * posWorld;
  vec4 projected = proj * posView;

  vec3 clipPos = projected.xyz / projected.w;

  if (clipPos.x < -1.0 || clipPos.x > 1.0 || clipPos.y < -1.0 || clipPos.y > 1.0) {
    fragColor = vec4(-1);
    return;
  }

  vec3 uvDepth = 0.5 * clipPos + vec3(0.5);

  float depth = texture(depthTex, uvDepth.xy).r;

  if (uvDepth.z <= depth) {
    fragColor = vec4(0);
    return;
  }

  fragColor = vec4(linearizeDepth(depth) - linearizeDepth(uvDepth.z));
}
`,Cj=I(),dX=ut();let zae=class{constructor(){this._scale=0,this._angleFactor=0,this._minScale=0}update(e,i,r,s){r?(this._scale=Math.min(r.divisor/(i-r.offset),1),this._angleFactor=v4t(e),this._minScale=s!=null?Math.min(r.minPixelSize/s,1):0):(this._scale=1,this._minScale=1,this._angleFactor=1)}apply(e){const{_scale:i,_angleFactor:r,_minScale:s}=this;return e*Ce(yt(i,1,r),s,1)}applyVec2(e,i){e[0]=this.apply(i[0]),e[1]=this.apply(i[1])}},m8e=class{constructor(){this.evaluator=new zae,this.alignmentEvaluator=new zae}update(e,i,r,s,n,a){this.evaluator.update(e,i,r,s),this.alignmentEvaluator.update(e,i,n??r,(n?a:null)??s)}};function v4t(t){return Math.abs(t)**3}function l_i(t){return!!t&&!0}let _4t=class{constructor(){this.distance=0,this.fovY=0}},x$e=class{constructor(){this.camera=new _4t,this.offset=0,this.divisor=0,this.minPixelSize=0}};function b4t(t){return t instanceof Float32Array&&t.length>=16}function w4t(t){return Array.isArray(t)&&t.length>=16}function x4t(t){return b4t(t)||w4t(t)}function Ep(){return!!ie("enable-feature:objectAndLayerId-rendering")}let ipe=class{constructor(e){this.field=e}},S4t=class extends ipe{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[0,0,0],this.fallback=[0,0,0]}},S$e=class extends ipe{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}},T4t=class extends ipe{constructor(e,i=0){super(e),this.fallback=i,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},$4t=class{};function AI(t){return t!=null}function Ma(t,e){t&&t.push(e)}function C4t(t,e,i,r=ut()){const s=t||0,n=e||0,a=i||0;return s!==0&&PO(r,r,-s/180*Math.PI),n!==0&&OO(r,r,n/180*Math.PI),a!==0&&E7(r,r,a/180*Math.PI),r}function ib(t,e,i,r,s){const n=t.minSize,a=t.maxSize;if(t.useSymbolValue){const o=r.symbolSize[i];return e.minSize[i]=o,e.maxSize[i]=o,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=1,!0}if(AI(t.field))return AI(t.stops)?t.stops.length===2&&Yx(t.stops[0].size)&&Yx(t.stops[1].size)?(T$e(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=1,!0):(Ma(s,"Could not convert size info: stops only supported with 2 elements"),!1):Yx(n)&&Yx(a)&&AI(t.minDataValue)&&AI(t.maxDataValue)?(T$e(n,a,t.minDataValue,t.maxDataValue,e,i),e.type[i]=1,!0):t.valueUnit==="unknown"?(Ma(s,"Could not convert size info: proportional size not supported"),!1):VO[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/VO[t.valueUnit],e.type[i]=1,!0):(Ma(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!AI(t.field)){if(t.stops?.[0]&&Yx(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=1,!0;if(Yx(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=1,!0}return Ma(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function T$e(t,e,i,r,s,n){const a=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=a>0?t:e,s.maxSize[n]=a>0?e:t,s.offset[n]=t-i*a,s.factor[n]=a}function M4t(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return Ma(r,"Could not convert size info: unsupported property"),null;if(!E5e(t.field))return Ma(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Ma(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new S4t(t.field),me(e.size.fallback,i.fallbackSize);let s;switch(t.axis){case"width":return s=ib(t,e.size,0,i,r),s?e:null;case"height":return s=ib(t,e.size,2,i,r),s?e:null;case"depth":return s=ib(t,e.size,1,i,r),s?e:null;case"width-and-depth":return s=ib(t,e.size,0,i,r),s&&ib(t,e.size,1,i,r),s?e:null;case null:case void 0:case"all":return s=ib(t,e.size,0,i,r),s=s&&ib(t,e.size,1,i,r),s=s&&ib(t,e.size,2,i,r),s?e:null;default:return Ma(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function E4t(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===1&&(n*=e.modelSize[s],t.type[s]=2),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==0)r=0;else if(t.type[1]!==0)r=1;else{if(t.type[2]===0)return Ma(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)t.type[s]===0&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function $$e(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function A4t(t,e,i,r){if(t.normalizationField)return Ma(r,"Could not convert color info: unsupported property"),null;if(D1(t.field)){if(!t.stops)return Ma(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Ma(r,"Could not convert color info: too many color stops"),null;e.color=new S$e(t.field);const s=t.stops;for(let n=0;n<8;++n){const a=s[Math.min(n,s.length-1)];e.color.values[n]=a.value,$$e(e.color.colors,n,a.color)}qc(e.color.fallback,i.fallbackColor)}}else{if(!(t.stops&&t.stops.length>=0))return Ma(r,"Could not convert color info: no field and no colors/stops"),null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color=new S$e(null);for(let n=0;n<8;n++)e.color.values[n]=1/0,$$e(e.color.colors,n,s);qc(e.color.fallback,i.fallbackColor)}}return e}function O4t(t,e,i,r){if(t.normalizationField)return Ma(r,"Could not convert opacity info: unsupported property"),null;if(D1(t.field)){if(!t.stops)return Ma(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Ma(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new T4t(t.field,i.fallbackColor[3]);const s=t.stops;for(let n=0;n<8;++n){const a=s[Math.min(n,s.length-1)];e.opacity.values[n]=a.value,e.opacity.opacityValues[n]=a.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Ma(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const s=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:i.fallbackColor[3]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=s}}return e}function pX(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function P4t(t,e,i){if(!D1(t.field))return Ma(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Ma(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return pX(t,e.rotation,0),e;case"roll":return pX(t,e.rotation,1),e;case null:case void 0:case"heading":return pX(t,e.rotation,2),e;default:return Ma(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let g_i=class{constructor({supports:e,modelSize:i,symbolSize:r,unitInMeters:s,anchor:n,scale:a,rotation:o,fallbackColor:l,fallbackSize:u}){this.supports=e,this.modelSize=i??nS(),this.symbolSize=r??nS(),this.unitInMeters=s??1,this.anchor=n??c1(),this.scale=a??nS(),this.rotation=o??c1(),this.fallbackColor=l??Nhe(),this.fallbackSize=u??nS()}};function g8e(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return Ma(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?M4t(n,s,e,i):s;case"color":return e.supports.color?A4t(n,s,e,i):s;case"opacity":return e.supports.opacity?O4t(n,s,e,i):null;case"rotation":return e.supports.rotation?P4t(n,s,i):s;default:return null}},new $4t);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!E4t(r.size,e,i)?null:r:null}let R4t=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function __i(t,e){if(!t||Ep()||bn.TESTS_DISABLE_FAST_UPDATES)return null;const i=g8e(t.visualVariables,e);return i?new R4t(i,v8e(i,e),!!i.size):null}function b_i(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=g8e(e.visualVariables,i);return!!s&&!!(Mj(r.size,s.size,"size")&&Mj(r.color,s.color,"color")&&Mj(r.rotation,s.rotation,"rotation")&&Mj(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=v8e(s,i),t.requiresShaderTransformation=!!s.size,!0)}function Mj(t,e,i){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let y8e=class extends $r{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}};function v8e(t,e){const i=new y8e(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,lm(Q4),C4t(e.rotation[2],e.rotation[0],e.rotation[1],Q4),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||Jr(),P1(i.vvSymbolRotationMatrix,Q4)),i}function x_i(t,e,i){if(!t.vvSize)return i;Ln(rb,i);const r=t.vvSymbolRotationMatrix;return sy(Q4,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Cn(rb,rb,Q4),_8e(C$e,t,e),n5e(rb,rb,C$e),$p(rb,rb,t.vvSymbolAnchor),rb}function _8e(t,e,i){if(!e.vvSize)return xe(t,1,1,1),t;if(Number.isNaN(i[0]))return me(t,e.vvSize.fallback);for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=Ce(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function fX(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:NaN}const rb=ut(),C$e=I(),Q4=ut();function PH(t){t.vertex.code.add(A`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(A`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(A`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return size * clamp(mix(factor.x, 1.0, factor.y), factor.z, 1.0);
}`),t.vertex.code.add(A`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(A`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return size * clamp(mix(factor.x, 1.0, factor.y), factor.z, 1.0);
}`),t.vertex.code.add(A`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function b8e(t){t.uniforms.add(new Pr("screenSizePerspective",e=>w8e(e.screenSizePerspective,e.screenSizePerspectiveMinPixelReferenceSize)))}function RH(t){t.uniforms.add(new Pr("screenSizePerspectiveAlignment",e=>w8e(e.screenSizePerspectiveAlignment||e.screenSizePerspective,e.screenSizePerspectiveAlignment?null:e.screenSizePerspectiveMinPixelReferenceSize)))}function w8e(t,e){const i=e!=null&&t!=null?Math.min(t.minPixelSize/e,1):0;return t?xe(M$e,t.divisor,t.offset,i):xe(M$e,0,0,0)}const M$e=I();let yp=class extends Ki{constructor(e,i,r){super(e,"vec3",2,(s,n,a,o)=>s.setUniform3fv(e,i(n,a,o),r))}},Vs=class extends Ki{constructor(e,i,r){super(e,"float",0,(s,n)=>s.setUniform1f(e,i(n),r))}},rpe=class extends Ki{constructor(e,i,r){super(e,"mat4",2,(s,n,a)=>s.setUniformMatrix4fv(e,i(n,a),r))}};function W0(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Aa):t.uniforms.add(new yp("cameraPosition",(i,r)=>xe(x8e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function u0(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new _l("proj",r=>r.camera.projectionMatrix),new rpe("view",(r,s)=>$p(E$e,s.camera.viewMatrix,r.origin)),new yp("localOrigin",r=>r.origin));const i=({camera:r})=>xe(x8e,r.viewInverseTransposeMatrix[3],r.viewInverseTransposeMatrix[7],r.viewInverseTransposeMatrix[11]);t.uniforms.add(new _l("proj",r=>r.camera.projectionMatrix),new _l("view",r=>$p(E$e,r.camera.viewMatrix,i(r))),new Zo("localOrigin",r=>i(r)))}const E$e=ut(),x8e=I();function spe(t){t.uniforms.add(new _l("viewNormal",e=>e.camera.viewInverseTransposeMatrix))}function HF(t){t.uniforms.add(new Vs("pixelRatio",e=>e.camera.pixelRatio/e.overlayStretch))}let Ca=class extends Ki{constructor(e,i,r){super(e,"vec4",1,(s,n,a)=>s.setUniform4fv(e,i(n,a),r))}},M_i=class{constructor(e){this.screenLength=d1(e.screenLength),this.minWorldLength=e.minWorldLength??0,this.maxWorldLength=e.maxWorldLength??1/0}};function S8e(t,e){const i=t.vertex;e.hasVerticalOffset?(T8e(i),e.hasScreenSizePerspective&&(t.include(PH),RH(i),W0(t.vertex,e)),i.code.add(A`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?A`vec3 worldNormal = normalize(worldPos + localOrigin);`:A`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?A`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:A`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(A`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const I4t=li();function T8e(t){t.uniforms.add(new Ca("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,a=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),o=i.camera.pixelRatio||1;return Or(I4t,n*o,a,r,s)}))}let Go=class extends Ki{constructor(e,i,r){super(e,"vec4",0,(s,n)=>s.setUniform4fv(e,i(n),r))}};const $8e=.5;function C8e(t,e){t.include(PH),t.attributes.add("position","vec3"),t.attributes.add("normal","vec3"),t.attributes.add("centerOffsetAndDistance","vec4");const i=t.vertex;u0(i,e),W0(i,e),i.uniforms.add(new Go("viewport",r=>r.camera.fullViewport),new _t("polygonOffset",r=>r.shaderPolygonOffset),new Vs("cameraGroundRelative",r=>r.camera.aboveGround?1:-1)),e.hasVerticalOffset&&T8e(i),i.code.add(A`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(A`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.terrainDepthTest?A.float(0):A`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||spe(i),e.draped||(i.uniforms.add(new Vs("perDistancePixelRatio",r=>Math.tan(r.camera.fovY/2)/(r.camera.fullViewport[2]/2))),i.code.add(A`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${A.float($8e)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&HF(i),e.hasScreenSizePerspective&&RH(i),i.code.add(A`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?A`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":A`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}let npe=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context?.stippleTextures}get _markerTextures(){return this._techniques.context?.markerTextures}getTechnique(e,i){return this._techniques.get(e,this._material.getConfiguration(this._output,i))}ensureResources(e){return 2}},M8e=class extends npe{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){super.dispose(),this._texture=Lr(this._texture),this._textureNormal=Lr(this._textureNormal),this._textureEmissive=Lr(this._textureEmissive),this._textureOcclusion=Lr(this._textureOcclusion),this._textureMetallicRoughness=Lr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?2:1}get textureBindParameters(){return new E8e(this._texture?.glTexture??null,this._textureNormal?.glTexture??null,this._textureEmissive?.glTexture??null,this._textureOcclusion?.glTexture??null,this._textureMetallicRoughness?.glTexture??null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Lr(this._texture),this._acquire(e,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if(Ea(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Lr(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},D4t=class extends $r{constructor(e=null){super(),this.textureEmissive=e}},E8e=class extends D4t{constructor(e,i,r,s,n,a,o){super(r),this.texture=e,this.textureNormal=i,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=a,this.normalTextureTransformMatrix=o}},k4t=class extends Tl{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}},Wf=class extends k4t{constructor(){super(...arguments),this.output=0,this.oitPass=0,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=1,this.instanced=!1,this.writeDepth=!0}};c([ue({count:11})],Wf.prototype,"output",void 0),c([ue({count:3})],Wf.prototype,"oitPass",void 0),c([ue()],Wf.prototype,"hasSlicePlane",void 0),c([ue()],Wf.prototype,"hasHighlightMixTexture",void 0);function A8e(t,e,i,r,s,n){let a=i.screenLength*t.pixelRatio;s!=null&&(O$e.update(r,e,s,n),a=O$e.apply(a));const o=a*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Ce(o*e,i.minWorldLength,i.maxWorldLength)}const L4t=Iet();function A$e(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?Array.isArray(t[r])&&L4t(s,t[r])||(t[r]=s.slice(),i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}const X4={multiply:1,ignore:2,replace:3,tint:4},O$e=new zae;let IH=class{constructor(e,i){this.id=Gc(),this.supportsEdges=!1,this._renderPriority=0,this._parameters=new i,A$e(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){A$e(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&(this.parameters.renderOccluded&e.renderOccludedMask)!==0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:0}get hasEmissions(){return!1}getConfiguration(e,i,r=new Wf){return r.output=e,r.hasHighlightMixTexture=e===9&&i.highlightMixTexture!=null,r}},F4t=class extends $r{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}};function z4t(t,e,i,r=1){const{data:s,indices:n}=t,a=e.typedBuffer,o=e.typedBufferStride,l=n.length;if(i*=o,r===1)for(let u=0;u<l;++u)a[i]=s[n[u]],i+=o;else for(let u=0;u<l;++u){const d=s[n[u]];for(let f=0;f<r;f++)a[i]=d,i+=o}}function K4(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,a=e.typedBufferStride,o=s.length;i*=a;for(let l=0;l<o;++l){const u=2*s[l];n[i]=r[u],n[i+1]=r[u+1],i+=a}}function ape(t,e,i,r=1){const{data:s,indices:n}=t,a=e.typedBuffer,o=e.typedBufferStride,l=n.length;if(i*=o,r===1)for(let u=0;u<l;++u){const d=3*n[u];a[i]=s[d],a[i+1]=s[d+1],a[i+2]=s[d+2],i+=o}else for(let u=0;u<l;++u){const d=3*n[u];for(let f=0;f<r;++f)a[i]=s[d],a[i+1]=s[d+1],a[i+2]=s[d+2],i+=o}}function fL(t,e,i,r=1){const{data:s,indices:n}=t,a=e.typedBuffer,o=e.typedBufferStride,l=n.length;if(i*=o,r===1)for(let u=0;u<l;++u){const d=4*n[u];a[i]=s[d],a[i+1]=s[d+1],a[i+2]=s[d+2],a[i+3]=s[d+3],i+=o}else for(let u=0;u<l;++u){const d=4*n[u];for(let f=0;f<r;++f)a[i]=s[d],a[i+1]=s[d+1],a[i+2]=s[d+2],a[i+3]=s[d+3],i+=o}}function P$e(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function ope(t,e,i,r,s=1){if(!e)return void ape(t,i,r,s);const{data:n,indices:a}=t,o=i.typedBuffer,l=i.typedBufferStride,u=a.length,d=e[0],f=e[1],g=e[2],v=e[4],_=e[5],x=e[6],S=e[8],T=e[9],M=e[10],E=e[12],P=e[13],O=e[14];r*=l;let D=0,L=0,F=0;const j=P7(e)?N=>{D=n[N]+E,L=n[N+1]+P,F=n[N+2]+O}:N=>{const B=n[N],U=n[N+1],Q=n[N+2];D=d*B+v*U+S*Q+E,L=f*B+_*U+T*Q+P,F=g*B+x*U+M*Q+O};if(s===1)for(let N=0;N<u;++N)j(3*a[N]),o[r]=D,o[r+1]=L,o[r+2]=F,r+=l;else for(let N=0;N<u;++N){j(3*a[N]);for(let B=0;B<s;++B)o[r]=D,o[r+1]=L,o[r+2]=F,r+=l}}function lpe(t,e,i,r,s=1){if(!e)return void ape(t,i,r,s);const{data:n,indices:a}=t,o=e,l=i.typedBuffer,u=i.typedBufferStride,d=a.length,f=o[0],g=o[1],v=o[2],_=o[4],x=o[5],S=o[6],T=o[8],M=o[9],E=o[10],P=!fue(o),O=1e-6,D=1-O;r*=u;let L=0,F=0,j=0;const N=P7(o)?B=>{L=n[B],F=n[B+1],j=n[B+2]}:B=>{const U=n[B],Q=n[B+1],H=n[B+2];L=f*U+_*Q+T*H,F=g*U+x*Q+M*H,j=v*U+S*Q+E*H};if(s===1)if(P)for(let B=0;B<d;++B){N(3*a[B]);const U=L*L+F*F+j*j;if(U<D&&U>O){const Q=1/Math.sqrt(U);l[r]=L*Q,l[r+1]=F*Q,l[r+2]=j*Q}else l[r]=L,l[r+1]=F,l[r+2]=j;r+=u}else for(let B=0;B<d;++B)N(3*a[B]),l[r]=L,l[r+1]=F,l[r+2]=j,r+=u;else for(let B=0;B<d;++B){if(N(3*a[B]),P){const U=L*L+F*F+j*j;if(U<D&&U>O){const Q=1/Math.sqrt(U);L*=Q,F*=Q,j*=Q}}for(let U=0;U<s;++U)l[r]=L,l[r+1]=F,l[r+2]=j,r+=u}}function N4t(t,e,i,r,s=1){if(!e)return void fL(t,i,r,s);const{data:n,indices:a}=t,o=e,l=i.typedBuffer,u=i.typedBufferStride,d=a.length,f=o[0],g=o[1],v=o[2],_=o[4],x=o[5],S=o[6],T=o[8],M=o[9],E=o[10],P=!fue(o),O=1e-6,D=1-O;if(r*=u,s===1)for(let L=0;L<d;++L){const F=4*a[L],j=n[F],N=n[F+1],B=n[F+2],U=n[F+3];let Q=f*j+_*N+T*B,H=g*j+x*N+M*B,J=v*j+S*N+E*B;if(P){const Z=Q*Q+H*H+J*J;if(Z<D&&Z>O){const K=1/Math.sqrt(Z);Q*=K,H*=K,J*=K}}l[r]=Q,l[r+1]=H,l[r+2]=J,l[r+3]=U,r+=u}else for(let L=0;L<d;++L){const F=4*a[L],j=n[F],N=n[F+1],B=n[F+2],U=n[F+3];let Q=f*j+_*N+T*B,H=g*j+x*N+M*B,J=v*j+S*N+E*B;if(P){const Z=Q*Q+H*H+J*J;if(Z<D&&Z>O){const K=1/Math.sqrt(Z);Q*=K,H*=K,J*=K}}for(let Z=0;Z<s;++Z)l[r]=Q,l[r+1]=H,l[r+2]=J,l[r+3]=U,r+=u}}function O8e(t,e,i,r,s=1){const{data:n,indices:a}=t,o=i.typedBuffer,l=i.typedBufferStride,u=a.length;if(r*=l,e===n.length&&e===4){o[r]=n[0],o[r+1]=n[1],o[r+2]=n[2],o[r+3]=n[3];const d=new Uint32Array(i.typedBuffer.buffer,i.start),f=l/4,g=d[r/=4];r+=f;const v=u*s;for(let _=1;_<v;++_)d[r]=g,r+=f;return}if(s!==1)if(e!==4)for(let d=0;d<u;++d){const f=3*a[d];for(let g=0;g<s;++g)o[r]=n[f],o[r+1]=n[f+1],o[r+2]=n[f+2],o[r+3]=255,r+=l}else for(let d=0;d<u;++d){const f=4*a[d];for(let g=0;g<s;++g)o[r]=n[f],o[r+1]=n[f+1],o[r+2]=n[f+2],o[r+3]=n[f+3],r+=l}else{if(e===4){for(let d=0;d<u;++d){const f=4*a[d];o[r]=n[f],o[r+1]=n[f+1],o[r+2]=n[f+2],o[r+3]=n[f+3],r+=l}return}for(let d=0;d<u;++d){const f=3*a[d];o[r]=n[f],o[r+1]=n[f+1],o[r+2]=n[f+2],o[r+3]=255,r+=l}}}function V4t(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,a=e.typedBufferStride,o=s.length,l=r[0];i*=a;for(let u=0;u<o;++u)n[i]=l,i+=a}function R$e(t,e,i,r){Ae(Mx,t,e);const s=Math.max(Math.sqrt(Ve(Mx)),1e-4);he(Mx,Mx,1/s),i[r++]=Mx[0],i[r++]=Mx[1],i[r++]=Mx[2],i[r++]=s}const Mx=I();function P8e(t,e,i,r,s=1){const n=e.typedBuffer,a=e.typedBufferStride;if(r*=a,s===1)for(let o=0;o<i;++o)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=a;else for(let o=0;o<i;++o)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=a}function j4t(t,e,i,r,s,n,a){let o={numItems:0,numVerticesPerItem:0};for(const l of i.fields.keys()){const u=t.get(l),d=u?.indices;if(u&&d)l==="position"&&(o={numItems:1,numVerticesPerItem:d.length}),U4t(l,u,r,s,n,a);else if(l==="olidColor"&&e!=null){const f=t.get("position")?.indices;if(f){const g=f.length;P8e(e,n.getField(l,rd),g,a)}}}return o}function U4t(t,e,i,r,s,n){switch(t){case"position":{xt(e.size===3);const a=s.getField(t,Fw);xt(!!a,`No buffer view for ${t}`),ope(e,i,a,n);break}case"normal":{xt(e.size===3);const a=s.getField(t,Fw);xt(!!a,`No buffer view for ${t}`),lpe(e,r,a,n);break}case"normalCompressed":case"profileRight":case"profileUp":{xt(e.size===2);const a=s.getField(t,wG);xt(!!a,`No buffer view for ${t}`),K4(e,a,n);break}case"uv0":{xt(e.size===2);const a=s.getField(t,UUe)??s.getField(t,_G);xt(!!a,`No buffer view for ${t}`),K4(e,a,n);break}case"uvi":{xt(e.size===2);const a=s.getField(t,wG);xt(!!a,`No buffer view for ${t}`),K4(e,a,n);break}case"color":case"symbolColor":{const a=s.getField(t,rd);xt(!!a,`No buffer view for ${t}`),xt(e.size===3||e.size===4),O8e(e,e.size,a,n);break}case"colorFeatureAttribute":case"opacityFeatureAttribute":case"sizeFeatureAttribute":{const a=s.getField(t,aL)??s.getField(t,aL);xt(!!a,`No buffer view for ${t}`),xt(e.size===1),V4t(e,a,n);break}case"tangent":{xt(e.size===4);const a=s.getField(t,o$);xt(!!a,`No buffer view for ${t}`),N4t(e,i,a,n);break}case"profileVertexAndNormal":{xt(e.size===4);const a=s.getField(t,qUe)??s.getField(t,o$);xt(!!a,`No buffer view for ${t}`),fL(e,a,n);break}case"profileAuxData":{xt(e.size===3);const a=s.getField(t,BUe)??s.getField(t,Fw);xt(!!a,`No buffer view for ${t}`),ape(e,a,n);break}}}let z_i=class extends $r{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function B4t(t,e){D8e(t,e,new Pr("slicePlaneOrigin",(i,r)=>cpe(e,i,r)),new Pr("slicePlaneBasis1",(i,r)=>WO(e,i,r,r.slicePlane?.basis1)),new Pr("slicePlaneBasis2",(i,r)=>WO(e,i,r,r.slicePlane?.basis2)))}function xw(t,e){D8e(t,e,new yp("slicePlaneOrigin",(i,r)=>cpe(e,i,r)),new yp("slicePlaneBasis1",(i,r)=>WO(e,i,r,r.slicePlane?.basis1)),new yp("slicePlaneBasis2",(i,r)=>WO(e,i,r,r.slicePlane?.basis2)))}function R8e(t,e){I8e(t,e,new yp("slicePlaneOrigin",(i,r)=>cpe(e,i,r)),new yp("slicePlaneBasis1",(i,r)=>WO(e,i,r,r.slicePlane?.basis1)),new yp("slicePlaneBasis2",(i,r)=>WO(e,i,r,r.slicePlane?.basis2)))}const q4t=A`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function I8e(t,e,...i){e.hasSlicePlane?(t.uniforms.add(...i),t.code.add(q4t)):t.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function D8e(t,e,...i){I8e(t,e,...i),e.hasSlicePlane?t.code.add(`
    void discardBySlice(vec3 pos) {
      if (sliceByPlane(pos)) {
        discard;
      }
    }

    vec4 applySliceOutline(vec4 color, vec3 pos) {
      SliceFactors factors = calculateSliceFactors(pos);

      factors.front /= 2.0 * fwidth(factors.front);
      factors.side0 /= 2.0 * fwidth(factors.side0);
      factors.side1 /= 2.0 * fwidth(factors.side1);
      factors.side2 /= 2.0 * fwidth(factors.side2);
      factors.side3 /= 2.0 * fwidth(factors.side3);

      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth
      if (sliceByFactors(factors)) {
        return color;
      }

      float outlineFactor = (1.0 - step(0.5, factors.front))
        * (1.0 - step(0.5, factors.side0))
        * (1.0 - step(0.5, factors.side1))
        * (1.0 - step(0.5, factors.side2))
        * (1.0 - step(0.5, factors.side3));

      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);
    }

    vec4 applySlice(vec4 color, vec3 pos) {
      return sliceEnabled() ? applySliceOutline(color, pos) : color;
    }
  `):t.code.add(A`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function k8e(t,e,i){return t.instancedDoublePrecision?xe(G4t,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function L8e(t,e){return t!=null?Ae(LG,e.origin,t):e.origin}function F8e(t,e,i){return t.hasSliceTranslatedView?e!=null?$p(H4t,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function cpe(t,e,i){if(i.slicePlane==null)return Aa;const r=k8e(t,e,i),s=L8e(r,i.slicePlane),n=F8e(t,r,i);return n!=null?Ft(LG,s,n):s}function WO(t,e,i,r){if(r==null||i.slicePlane==null)return Aa;const s=k8e(t,e,i),n=L8e(s,i.slicePlane),a=F8e(t,s,i);return a!=null?($e(OI,r,n),Ft(LG,n,a),Ft(OI,OI,a),Ae(OI,OI,LG)):r}const G4t=I(),LG=I(),OI=I(),H4t=ut();function upe(t,e){if(e.output!==10)return t.vertex.code.add(A`void forwardObjectAndLayerIdColor() {}`),void t.fragment.code.add(A`void outputObjectAndLayerIdColor() {}`);const i=e.instanced;t.varyings.add("objectAndLayerIdColorVarying","vec4");const r=i?"instanceOlidColor":"olidColor";t.attributes.add(r,"vec4"),t.vertex.code.add(A`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${r} * 0.003921568627451;
    }`),t.fragment.code.add(A`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}let FG=class extends Ki{constructor(e,i){super(e,"bool",0,(r,s)=>r.setUniform1b(e,i(s)))}};function DH(t){t.uniforms.add(new FG("alignPixelEnabled",e=>e.alignPixelEnabled)),t.code.add(A`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(A`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}let Z0=class extends Ki{constructor(e,i,r){super(e,"vec2",0,(s,n)=>s.setUniform2fv(e,i(n),r))}};function Ip(t){t.uniforms.add(new Z0("zProjectionMap",e=>W4t(e.camera))),t.code.add(A`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(A`float delinearizeDepth(float linearDepth) {
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
float depthNdc = (-c1/linearDepth) - c2 - 1e-7;
float depthNonlinear01 = (depthNdc + 1.0 ) / 2.0;
return depthNonlinear01;
}`),t.code.add(A`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(A`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function W4t(t){const e=t.projectionMatrix;return oi(Z4t,e[14],e[10])}const Z4t=Ke();let Jo=class extends Ki{constructor(e,i){super(e,"sampler2D",0,(r,s)=>r.bindTexture(e,i(s)))}};function WF(t,{occlusionPass:e,terrainDepthTest:i,cullAboveTerrain:r}){const{vertex:s,fragment:n,varyings:a}=t;if(!i)return s.code.add("void forwardViewPosDepth(vec3 pos) {}"),void n.code.add(`${e?"bool":"void"} discardByTerrainDepth() { ${we(e,"return false;")}}`);a.add("viewPosDepth","float",{invariant:!0}),s.code.add(`void forwardViewPosDepth(vec3 pos) {
    viewPosDepth = pos.z;
  }`),n.include(Ip),n.uniforms.add(new Jo("terrainDepthTexture",o=>o.terrainDepth?.attachment)).code.add(A`
    ${e?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${e?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${r?">":"<="} linearDepth) discard;`}
    }`)}function Y4t(t,e){const{vertex:i,fragment:r}=t;t.include(WF,e),i.include(DH),i.main.add(A`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),r.main.add(A`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)}function z8e(t){t.vertex.uniforms.add(new Vs("renderTransparentlyOccludedHUD",e=>e.hudRenderStyle===0?1:e.hudRenderStyle===1?0:.75),new Go("viewport",e=>e.camera.fullViewport),new Jo("hudVisibilityTexture",e=>e.hudVisibility?.getTexture())),t.vertex.include(DH),t.vertex.code.add(A`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function hpe(t){const{fragment:e}=t;e.code.add(A`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(uvec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return texel[lic];
}
uint readLevelBits(uvec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}let J4t=class extends Ki{constructor(e,i){super(e,"ivec2",0,(r,s)=>r.setUniform2iv(e,i(s)))}},N8e=class extends Ki{constructor(e,i){super(e,"int",0,(r,s)=>r.setUniform1i(e,i(s)))}},Q4t=class extends Ki{constructor(e,i){super(e,"usampler2D",0,(r,s)=>r.bindTexture(e,i(s)))}};function FP(t,e){const{fragment:i}=t,{output:r,draped:s,hasHighlightMixTexture:n}=e;r===9?(i.uniforms.add(new N8e("highlightLevel",a=>a.highlightLevel??0),new J4t("highlightMixOrigin",a=>a.highlightMixOrigin)),t.outputs.add("fragHighlight","uvec2",0),t.include(hpe),n?i.uniforms.add(new Q4t("highlightMixTexture",a=>a.highlightMixTexture)).code.add(A`uvec2 getAccumulatedHighlight() {
return texelFetch(highlightMixTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
uvec2 combinedHighlight = getAccumulatedHighlight();
combinedHighlight[li] |= bits;
fragHighlight = combinedHighlight;
}
}`):i.code.add(A`void outputHighlight(bool occluded) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
}`),s?i.code.add(A`bool isHighlightOccluded() {
return false;
}`):i.uniforms.add(new Jo("depthTexture",a=>a.mainDepth)).code.add(A`bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}`),i.code.add(A`void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`)):i.code.add(A`void calculateOcclusionAndOutputHighlight() {}`)}function B1(t){t.code.add(A`struct MaskedColor {
vec4 color;
bvec4 mask;
};`)}function V8e(t){t.include(B1),t.code.add(A`
    MaskedColor createMaskedFromUInt8NaNColor(vec4 color) {
      return MaskedColor(color * ${A.float(1/254)}, equal(color, vec4(255)));
    }
  `)}function dpe(t){t.include(B1),t.code.add(A`vec4 maskedColorSelectOrOne(MaskedColor color) {
return vec4(
color.mask.r ? 1.0 : color.color.r,
color.mask.g ? 1.0 : color.color.g,
color.mask.b ? 1.0 : color.color.b,
color.mask.a ? 1.0 : color.color.a
);
}
MaskedColor multiplyMaskedColors(MaskedColor color1, MaskedColor color2) {
vec4 masked1 = maskedColorSelectOrOne(color1);
vec4 masked2 = maskedColorSelectOrOne(color2);
return MaskedColor(masked1 * masked2, bvec4(ivec4(color1.mask) & ivec4(color2.mask)));
}`)}function ppe(t){t.include(B1),t.code.add(A`MaskedColor createMaskedFromNaNColor(vec4 color) {
return MaskedColor(color, isnan(color));
}`)}let X4t=class extends Ki{constructor(e,i,r,s){super(e,"vec4",1,(n,a,o)=>n.setUniform4fv(e,i(a,o),s),r)}},Lu=class extends Ki{constructor(e,i,r,s){super(e,"float",1,(n,a,o)=>n.setUniform1fv(e,i(a,o),s),r)}},K4t=class extends y8e{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}};const mX=8;function jS(t,e){const{vertex:i,attributes:r}=t;e.hasVVInstancing&&(e.hasVVSize||e.hasVVColor)&&r.add("instanceFeatureAttribute","vec4"),e.hasVVSize?(i.uniforms.add(new Pr("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new Pr("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new Pr("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new Pr("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new Pr("vvSizeFallback",s=>s.vvSize.fallback)),i.uniforms.add(new _m("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new Pr("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(A`vec3 vvScale(vec4 _featureAttribute) {
if (isnan(_featureAttribute.x)) {
return vvSizeFallback;
}
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(A`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 scale = max(vvScale(_featureAttribute), eps);
        return vec4(vvSymbolRotationMatrix * _normal / scale, 1.0);
      }

      ${e.hasVVInstancing?A`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(A`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vertex.include(B1),e.hasVVColor?(i.constants.add("vvColorNumber","int",mX),i.uniforms.add(new Lu("vvColorValues",s=>s.vvColor.values,mX),new X4t("vvColorColors",s=>s.vvColor.colors,mX),new Ca("vvColorFallback",s=>s.vvColor.fallback,{supportsNaN:!0})),e.hasVVInstancing&&(t.vertex.include(dpe),t.vertex.include(ppe)),i.code.add(A`
      vec4 interpolateVVColor(float value) {
        if (isnan(value)) {
          return vvColorFallback;
        }

        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVVInstancing?A`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }

            MaskedColor applyVVColor(MaskedColor color) {
              return multiplyMaskedColors(color, createMaskedFromNaNColor(vvColor()));
            }
            `:A`
            vec4 vvColor() {
              return vec4(1.0);
            }

            MaskedColor applyVVColor(MaskedColor color) {
              return color;
            }
            `}
    `)):i.code.add(A`vec4 vvColor() {
return vec4(1.0);
}
MaskedColor applyVVColor(MaskedColor color) {
return color;
}`)}function zP(t){t.code.add(A`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}let mL=class extends Ki{constructor(e,i,r){super(e,"vec4",2,(s,n,a)=>s.setUniform4fv(e,i(n,a),r))}};const ls=1/255.5;function j8e(t){const e=new Gi,{signedDistanceFieldEnabled:i,occlusionTestEnabled:r,horizonCullingEnabled:s,pixelSnappingEnabled:n,hasScreenSizePerspective:a,debugDrawLabelBorder:o,hasVVSize:l,hasVVColor:u,hasRotation:d,occludedFragmentFade:f,sampleSignedDistanceFieldTexelCenter:g}=t;e.include(C8e,t),e.vertex.include(R8e,t);const{occlusionPass:v,output:_,oitPass:x}=t;if(v)return e.include(Y4t,t),e;const{vertex:S,fragment:T}=e;e.include(PH),e.include(jS,t),e.include(upe,t),r&&e.include(z8e),T.include(zP),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2");const M=_===9,E=M&&r;E&&e.varyings.add("voccluded","float"),S.uniforms.add(new Go("viewport",F=>F.camera.fullViewport),new rc("screenOffset",(F,j)=>oi(FB,2*F.screenOffset[0]*j.camera.pixelRatio,2*F.screenOffset[1]*j.camera.pixelRatio)),new rc("anchorPosition",F=>ZO(F)),new Ca("materialColor",F=>F.color),new _t("materialRotation",F=>F.rotation),new Gt("tex",F=>F.texture)),HF(S),i&&(S.uniforms.add(new Ca("outlineColor",F=>F.outlineColor)),T.uniforms.add(new Ca("outlineColor",F=>I$e(F)?F.outlineColor:Tn),new _t("outlineSize",F=>I$e(F)?F.outlineSize:0))),s&&S.uniforms.add(new mL("pointDistanceSphere",(F,j)=>{const N=j.camera.eye,B=F.origin;return $i(B[0]-N[0],B[1]-N[1],B[2]-N[2],Ci.radius)})),n&&S.include(DH),a&&(b8e(S),RH(S)),o&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add("uv0","vec2"),e.attributes.add("uvi","vec4"),e.attributes.add("color","vec4"),e.attributes.add("size","vec2"),e.attributes.add("rotation","float"),(l||u)&&e.attributes.add("featureAttribute","vec4"),S.code.add(s?A`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return b > 0.0 && b < a && b * b  > a * c;
}`:A`bool behindHorizon(vec3 posModel) { return false; }`),S.main.add(A`
    ProjectHUDAux projectAux;
    vec4 posProj = projectPositionHUD(projectAux);
    forwardObjectAndLayerIdColor();

    if (rejectBySlice(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    if (behindHorizon(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    vec2 inputSize;
    ${we(a,A`
        inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
        vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,A`
        inputSize = size;
        vec2 screenOffsetScaled = screenOffset;`)}
    ${we(l,A`inputSize *= vvScale(featureAttribute).xx;`)}

    vec2 combinedSize = inputSize * pixelRatio;
    vec4 quadOffset = vec4(0.0);

    ${we(r,A`
    bool visible = testHUDVisibility(posProj);
    if (!visible) {
      vtc = vec2(0.0);
      ${we(o,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
      return;
    }`)}
    ${we(E,A`voccluded = visible ? 0.0 : 1.0;`)}
  `);const P=A`
      vec2 uv = mix(uvi.xy, uvi.zw, bvec2(uv0));
      vec2 texSize = vec2(textureSize(tex, 0));
      uv = mix(vec2(1.0), uv / texSize, lessThan(uv, vec2(${t5t})));
      quadOffset.xy = (uv0 - anchorPosition) * 2.0 * combinedSize;

      ${we(d,A`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,O=n?i?A`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:A`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:A`posProj += quadOffset;`;S.main.add(A`
    ${P}
    ${u?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${we(_===10,A`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${A.float(ls)};
    ${we(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${A.float(ls)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${O}
      gl_Position = posProj;
    }

    vtc = uv;

    ${we(o,A`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),T.uniforms.add(new Gt("tex",F=>F.texture)),f&&!M&&T.uniforms.add(new Jo("depthMap",F=>F.mainDepth),new Vs("occludedOpacity",F=>F.hudOccludedFragmentOpacity));const D=o?A`(isBorder > 0.0 ? 0.0 : ${A.float(ls)})`:A.float(ls),L=A`
    ${we(o,A`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    vec2 samplePos = vtc;

    ${we(g,A`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      samplePos += (vec2(1.0, -1.0) * texelSize) * scaleFactor;`)}

    ${i?A`
      vec4 fillPixelColor = vcolor;

      // Get distance in output units (i.e. pixels)

      float sdf = texture(tex, samplePos).r;
      float pixelDistance = sdf * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - pixelDistance, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(pixelDistance) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${D} ||
          fillPixelColor.a + outlinePixelColor.a < ${A.float(ls)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${we(!M,A`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${D}) {
          discard;
        }

        ${we(!M,A`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-pixelDistance/vsize.x*2.0, 0.0, 1.0), clamp(pixelDistance/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:A`
          vec4 texColor = texture(tex, samplePos, -0.5);
          if (texColor.a < ${D}) {
            discard;
          }
          ${we(!M,A`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${we(f&&!M,A`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${we(!M&&o,A`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(_){case 0:case 1:e.outputs.add("fragColor","vec4",0),_===1&&e.outputs.add("fragEmission","vec4",1),x===1&&e.outputs.add("fragAlpha","float",_===1?2:1),T.main.add(A`
        ${L}
        ${we(x===2,A`fragColor.rgb /= fragColor.a;`)}
        ${we(_===1,A`fragEmission = vec4(0.0);`)}
        ${we(x===1,A`fragAlpha = fragColor.a;`)}`);break;case 10:T.main.add(A`
        ${L}
        outputObjectAndLayerIdColor();`);break;case 9:e.include(FP,t),T.main.add(A`
        ${L}
        outputHighlight(${we(E,A`voccluded == 1.0`,A`false`)});`)}return e}function I$e(t){return t.outlineColor[3]>0&&t.outlineSize>0}function ZO(t){return t.textureIsSignedDistanceField?e5t(t.anchorPosition,t.distanceFieldBoundingBox,FB):na(FB,t.anchorPosition),FB}function e5t(t,e,i){oi(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1])}const FB=Ke(),gL=32e3,t5t=A.float(gL),i5t=Object.freeze(Object.defineProperty({__proto__:null,build:j8e,calculateAnchorPosition:ZO,fullUV:gL},Symbol.toStringTag,{value:"Module"})),r5t=o_(1,0,1,771);function kH(t,e=!1){switch(t){case 0:return e?j1:Xg;case 1:return r5t;case 2:case 3:return null}}function U8e(t){if(t.draped)return null;switch(t.oitPass){case 0:case 2:return t.writeDepth?FF:null;case 1:case 3:return null}}const s5t=5e5,fpe={factor:-1,units:-2};function n5t({oitPass:t,enableOffset:e}){return e&&t===1?fpe:null}function mpe(t,e=513){return t===0||t===2?e:515}function US(t,e){const i=aA(e);return t===1?i?{buffers:[Hr,vl,ihe]}:{buffers:[Hr,vl]}:i?{buffers:[Hr,vl]}:null}let a5t=class extends er{constructor(e,i){super(e,i,new Hi(i5t,()=>W(()=>Promise.resolve().then(()=>hri),void 0)),bH([B8e,G8e()].map(bl))),this.primitiveType=i.occlusionPass?Sr.POINTS:Sr.TRIANGLE_STRIP}initializePipeline(e){const{oitPass:i,hasPolygonOffset:r,draped:s,output:n,depthTestEnabled:a,occlusionPass:o}=e,l=a&&!s&&i!==1&&!o&&n!==9;return _i({blending:Ps(n)?kH(i,!0):null,depthTest:a&&!s?{func:515}:null,depthWrite:l?FF:null,drawBuffers:US(i,n),colorWrite:Fi,polygonOffset:r?o5t:null})}};const o5t={factor:0,units:-4},B8e=Qu().vec2u8("uv0",{glNormalized:!0}),q8e=Qu().vec3f("position").vec3f("normal").vec4i16("uvi").vec4u8("color").vec2f("size").f32("rotation").vec4f("centerOffsetAndDistance").vec4f("featureAttribute"),l5t=q8e.clone().vec4u8("olidColor");function G8e(){return Ep()?l5t:q8e}let pa=class extends Wf{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.olidColorInstanced=!1,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.hasVVInstancing=!1,this.snowCover=!1}};c([ue()],pa.prototype,"screenCenterOffsetUnitsEnabled",void 0),c([ue()],pa.prototype,"occlusionTestEnabled",void 0),c([ue()],pa.prototype,"signedDistanceFieldEnabled",void 0),c([ue()],pa.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),c([ue()],pa.prototype,"hasVVSize",void 0),c([ue()],pa.prototype,"hasVVColor",void 0),c([ue()],pa.prototype,"hasVerticalOffset",void 0),c([ue()],pa.prototype,"hasScreenSizePerspective",void 0),c([ue()],pa.prototype,"hasRotation",void 0),c([ue()],pa.prototype,"debugDrawLabelBorder",void 0),c([ue()],pa.prototype,"hasPolygonOffset",void 0),c([ue()],pa.prototype,"depthTestEnabled",void 0),c([ue()],pa.prototype,"pixelSnappingEnabled",void 0),c([ue()],pa.prototype,"draped",void 0),c([ue()],pa.prototype,"terrainDepthTest",void 0),c([ue()],pa.prototype,"cullAboveTerrain",void 0),c([ue()],pa.prototype,"occlusionPass",void 0),c([ue()],pa.prototype,"occludedFragmentFade",void 0),c([ue()],pa.prototype,"horizonCullingEnabled",void 0),c([ue()],pa.prototype,"isFocused",void 0);let gpe=class extends IH{constructor(e,i){super(e,m5t),this.produces=new Map([[13,r=>H4(r)&&!this.parameters.drawAsLabel],[14,r=>H4(r)&&this.parameters.drawAsLabel],[12,()=>this.parameters.occlusionTest],[18,r=>this.parameters.draped&&H4(r)]]),this._visible=!0,this._configuration=new pa(i)}getConfiguration(e,i){const r=this.parameters.draped;return super.getConfiguration(e,i,this._configuration),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=r,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.hasVVSize=!!this.parameters.vvSize,this._configuration.hasVVColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===12,this._configuration.occludedFragmentFade=!r&&this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||i.slot===12,Ps(e)&&(this._configuration.debugDrawLabelBorder=!!bn.LABELS_SHOW_BORDER),this._configuration.oitPass=i.oitPass,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration}intersect(e,i,r,s,n,a){const{options:{selectionMode:o,hud:l,excludeLabels:u},point:d,camera:f}=r,{parameters:g}=this;if(!o||!l||u&&g.isLabel||!e.visible||!d||!f)return;const v=e.attributes.get("featureAttribute"),_=v==null?null:X5(v.data,jae),{scaleX:x,scaleY:S}=Uae(_,g,f.pixelRatio);P1(zB,i),e.attributes.has("featureAttribute")&&h5t(zB);const T=e.attributes.get("position"),M=e.attributes.get("size"),E=e.attributes.get("normal"),P=e.attributes.get("rotation"),O=e.attributes.get("centerOffsetAndDistance");xt(T.size>=3);const D=ZO(g),L=this.parameters.centerOffsetUnits==="screen";for(let F=0;F<T.data.length/T.size;F++){const j=F*T.size;xe(Dr,T.data[j],T.data[j+1],T.data[j+2]),Ft(Dr,Dr,i),Ft(Dr,Dr,f.viewMatrix);const N=F*O.size;if(xe(Xs,O.data[N],O.data[N+1],O.data[N+2]),!L&&(Dr[0]+=Xs[0],Dr[1]+=Xs[1],Xs[2]!==0)){const U=Xs[2];Re(Xs,Dr),Ae(Dr,Dr,he(Xs,Xs,U))}const B=F*E.size;if(xe(Y2,E.data[B],E.data[B+1],E.data[B+2]),Nae(Y2,zB,f,e5),Bae(this.parameters,Dr,e5,f,cA),f.applyProjection(Dr,qr),qr[0]>-1){L&&(Xs[0]||Xs[1])&&(qr[0]+=Xs[0]*f.pixelRatio,Xs[1]!==0&&(qr[1]+=cA.alignmentEvaluator.apply(Xs[1])*f.pixelRatio),f.unapplyProjection(qr,Dr)),qr[0]+=this.parameters.screenOffset[0]*f.pixelRatio,qr[1]+=this.parameters.screenOffset[1]*f.pixelRatio,qr[0]=Math.floor(qr[0]),qr[1]=Math.floor(qr[1]);const U=F*M.size;_a[0]=M.data[U],_a[1]=M.data[U+1],cA.evaluator.applyVec2(_a,_a);const Q=Z8e*f.pixelRatio;let H=0;g.textureIsSignedDistanceField&&(H=Math.min(g.outlineSize,.5*_a[0])*f.pixelRatio/2),_a[0]*=x,_a[1]*=S;const J=F*P.size,Z=g.rotation+P.data[J];if(Vae(d,qr[0],qr[1],_a,Q,H,Z,g,D)){const K=r.ray;if(Ft(zG,Dr,Kl(W8e,f.viewMatrix)),qr[0]=d[0],qr[1]=d[1],f.unprojectFromRenderScreen(qr,Dr)){const ee=I();me(ee,K.direction);const _e=1/Ve(ee);he(ee,ee,_e),a(Bi(K.origin,Dr)*_e,ee,-1,zG)}}}}}intersectDraped(e,i,r,s,n){const a=e.attributes.get("position"),o=e.attributes.get("size"),l=e.attributes.get("rotation"),u=this.parameters,d=ZO(u),f=e.attributes.get("featureAttribute"),g=f==null?null:X5(f.data,jae),{scaleX:v,scaleY:_}=Uae(g,u,e.screenToWorldRatio),x=p5t*e.screenToWorldRatio;for(let S=0;S<a.data.length/a.size;S++){const T=S*a.size,M=a.data[T],E=a.data[T+1],P=S*o.size;_a[0]=o.data[P],_a[1]=o.data[P+1];let O=0;u.textureIsSignedDistanceField&&(O=Math.min(u.outlineSize,.5*_a[0])*e.screenToWorldRatio/2),_a[0]*=v,_a[1]*=_;const D=S*l.size,L=u.rotation+l.data[D];Vae(r,M,E,_a,x,O,L,u,d)&&s(n.distance,n.normal,-1)}}createBufferWriter(){return new g5t}applyShaderOffsetsView(e,i,r,s,n,a,o){const l=Nae(i,r,n,e5);return this._applyVerticalGroundOffsetView(e,l,n,o),Bae(this.parameters,o,l,n,a),this._applyPolygonOffsetView(o,l,s[3],n,o),this._applyCenterOffsetView(o,s,o),o}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&me(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const a=s.aboveGround?1:-1;let o=Math.sign(r);o===0&&(o=a);const l=a*o;if(this.parameters.shaderPolygonOffset<=0)return me(n,e);const u=Ce(Math.abs(i.cosAngle),.01,1),d=1-Math.sqrt(1-u*u)/u/s.viewport[2];return he(n,e,l>0?d:1/d),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=Ve(e),a=r.aboveGround?1:-1,o=r.computeRenderPixelSizeAtDist(n)*$8e,l=he(Dr,i.normal,a*o);return $e(s,e,l),s}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&me(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Re(Y2,r),xi(r,r,he(Y2,Y2,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&me(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&me(s,e),n){const a=r.aboveGround?1:-1,o=a*Math.sign(i[3]);s[2]-=(o||a)*n}return s}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:i,outlineColor:r}=this.parameters,s=e[3]>=ls||i>=ls&&r[3]>=ls;return this._visible&&s}createGLMaterial(e){return new c5t(e)}calculateRelativeScreenBounds(e,i,r=fi()){return u5t(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}},c5t=class extends M8e{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(a5t,e)}};function u5t(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function Nae(t,e,i,r){return x4t(e)&&(e=P1(d5t,e)),Ql(r.normal,t,e),Ft(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Le(H8e,f5t),r}function h5t(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],l=t[7],u=t[8],d=1/Math.sqrt(e*e+i*i+r*r),f=1/Math.sqrt(s*s+n*n+a*a),g=1/Math.sqrt(o*o+l*l+u*u);return t[0]=e*d,t[1]=i*d,t[2]=r*d,t[3]=s*f,t[4]=n*f,t[5]=a*f,t[6]=o*g,t[7]=l*g,t[8]=u*g,t}function Vae(t,e,i,r,s,n,a,o,l){let u=e-s-r[0]*l[0],d=u+r[0]+2*s,f=i-s-r[1]*l[1],g=f+r[1]+2*s;const v=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&v!=null&&(u+=r[0]*v[0],f+=r[1]*v[1],d-=r[0]*(1-v[2]),g-=r[1]*(1-v[3]),u-=n,d+=n,f-=n,g+=n),oi(D$e,e,i),$Ie(PI,t,D$e,zt(a)),PI[0]>u&&PI[0]<d&&PI[1]>f&&PI[1]<g}const cA=new m8e,Dr=I(),Y2=I(),qr=li(),H8e=I(),zG=I(),PI=Ke(),D$e=Ke(),zB=Jr(),d5t=Jr(),W8e=ut(),Ej=li(),Xs=I(),gX=I(),jae=li(),e5={normal:H8e,cosAngle:0},Z8e=1,p5t=2,_a=Cs(0,0),f5t=Ye(0,0,1);class m5t extends E8e{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1,this.color=Q5(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=Cs(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=Q5(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=li(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusStyle="bright",this.draped=!1,this.isLabel=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}class g5t{constructor(){this.layout=B8e,this.instanceLayout=G8e()}elementCount(e){return e.get("position").indices.length}elementCountBaseInstance(e){return e.get("uv0").indices.length}write(e,i,r,s,n,a){const{position:o,normal:l,color:u,size:d,rotation:f,centerOffsetAndDistance:g,featureAttribute:v,uvi:_}=n;ope(r.get("position"),e,o,a),lpe(r.get("normal"),i,l,a);const x=r.get("position").indices.length;let S=0,T=0,M=gL,E=gL;const P=r.get("uvi")?.data;P&&P.length>=4&&(S=P[0],T=P[1],M=P[2],E=P[3]);for(let O=0;O<x;++O){const D=a+O;_.setValues(D,S,T,M,E)}if(O8e(r.get("color"),4,u,a),K4(r.get("size"),d,a),z4t(r.get("rotation"),f,a),r.get("centerOffsetAndDistance")?fL(r.get("centerOffsetAndDistance"),g,a):P$e(g,a,x),r.get("featureAttribute")?fL(r.get("featureAttribute"),v,a):P$e(v,a,x),s!=null){const O=r.get("position")?.indices;if(O){const D=O.length,L=n.getField("olidColor",rd);P8e(s,L,D,a)}}return{numVerticesPerItem:1,numItems:x}}writeBaseInstance(e,i){const{uv0:r}=i;K4(e.get("uv0"),r,0)}intersect(e,i,r,s,n,a,o){const{options:{selectionMode:l,hud:u,excludeLabels:d},point:f,camera:g}=s;if(!l||!u||d&&i.isLabel||!f)return;const v=this.instanceLayout.createView(e),{position:_,normal:x,rotation:S,size:T,featureAttribute:M,centerOffsetAndDistance:E}=v,P=i.centerOffsetUnits==="screen",O=ZO(i);if(_==null||x==null||S==null||T==null||E==null||g==null)return;const D=M==null?null:M.getVec(0,jae),{scaleX:L,scaleY:F}=Uae(D,i,g.pixelRatio),j=_.count;for(let N=0;N<j;N++){if(_.getVec(N,Dr),r!=null&&$e(Dr,Dr,r),Ft(Dr,Dr,g.viewMatrix),E.getVec(N,Ej),xe(Xs,Ej[0],Ej[1],Ej[2]),!P&&(Dr[0]+=Xs[0],Dr[1]+=Xs[1],Xs[2]!==0)){const B=Xs[2];Re(Xs,Dr),Ae(Dr,Dr,he(Xs,Xs,B))}if(x.getVec(N,Y2),Nae(Y2,zB,g,e5),Bae(i,Dr,e5,g,cA),g.applyProjection(Dr,qr),qr[0]>-1){P&&(Xs[0]||Xs[1])&&(qr[0]+=Xs[0]*g.pixelRatio,Xs[1]!==0&&(qr[1]+=cA.alignmentEvaluator.apply(Xs[1])*g.pixelRatio),g.unapplyProjection(qr,Dr)),qr[0]+=i.screenOffset[0]*g.pixelRatio,qr[1]+=i.screenOffset[1]*g.pixelRatio,qr[0]=Math.floor(qr[0]),qr[1]=Math.floor(qr[1]),T.getVec(N,_a),cA.evaluator.applyVec2(_a,_a);const B=Z8e*g.pixelRatio;let U=0;i.textureIsSignedDistanceField&&(U=Math.min(i.outlineSize,.5*_a[0])*g.pixelRatio/2),_a[0]*=L,_a[1]*=F;const Q=S.get(N),H=i.rotation+Q;if(Vae(f,qr[0],qr[1],_a,B,U,H,i,O)){const J=s.ray;if(Ft(zG,Dr,Kl(W8e,g.viewMatrix)),qr[0]=f[0],qr[1]=f[1],g.unprojectFromRenderScreen(qr,Dr)){const Z=I();me(Z,J.direction);const K=1/Ve(Z);he(Z,Z,K),o(Bi(J.origin,Dr)*K,Z,N,zG)}}}}}}function Uae(t,e,i){return t==null||e.vvSize==null?{scaleX:i,scaleY:i}:(_8e(gX,e,t),{scaleX:gX[0]*i,scaleY:gX[1]*i})}function Bae(t,e,i,r,s){if(!t.verticalOffset?.screenLength){const l=Ve(e);return s.update(i.cosAngle,l,t.screenSizePerspective,t.screenSizePerspectiveMinPixelReferenceSize,t.screenSizePerspectiveAlignment,null),e}const n=Ve(e),a=t.screenSizePerspectiveAlignment??t.screenSizePerspective,o=A8e(r,n,t.verticalOffset,i.cosAngle,a,t.screenSizePerspectiveMinPixelReferenceSize);return s.update(i.cosAngle,n,t.screenSizePerspective,t.screenSizePerspectiveMinPixelReferenceSize,t.screenSizePerspectiveAlignment,null),he(i.normal,i.normal,o),$e(e,e,i.normal)}const Fy=I(),yX=I(),QC=li(),RI=li(),vX=I(),y5t=ut(),v5t=Is(),_X=$n(),_5t=I(),b5t=fi();class w5t{constructor(e){this.id=e,this.aabr=fi(),this.altitude=0,this.distance=0,this.distanceToOccluder=0,this.culled=!1,this.visible=!1,this.priority=0}}function x5t(t,e){const i=t.distanceToOccluder!==0&&t.distance>t.distanceToOccluder,r=e.distanceToOccluder!==0&&e.distance>e.distanceToOccluder;return i!==r?+i-+r:t.priority!==e.priority?e.priority-t.priority:t.distance!==e.distance?t.distance-e.distance:t.visible!==e.visible?+e.visible-+t.visible:t.id-e.id}class S5t{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this._info=null,this._labelInfo=null}ensureInfo(e){let i=this.getInfo(e);return i||(i=new w5t(this.graphics3DGraphic.graphic.uid),this._setInfo(e,i)),i}getInfo(e){return e===16?this._labelInfo:this._info}removeInfo(e){this._setInfo(e,null)}_setInfo(e,i){e===16?this._labelInfo=i:this._info=i}}class T5t{constructor(){this.camera=new wr,this.slicePlane=n_(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.equals(e.camera)||this.camera.copyFrom(e.camera),A$(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let Xb=class extends be{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new T5t,this._state=0,this._checkOcclusion=new Map,this._active=new Map,this._checkOcclusionIterator=null,this._activeIterator=null,this._occlusionQueryUids=new Array,this._updatingHandles=new tm,this._deconflictor=new f4t((e,i)=>{e.visible=i,this._setGraphicVisibility(this._active.get(e.id),i)},(e,i)=>e.id!==i.id,x5t),this._baseOccludedVisibility=10,this._altitudeFactor=2,this._minAltitudeDifference=100}initialize(){this._updatingHandles.add(()=>(this.view?.map?.ground?.opacity??0)>0,()=>this.setDirty()),this._updatingHandles.add(()=>this.view.ready,()=>{this._occlusionQuery=null,this.setDirty()})}destroy(){this._occlusionQuery=null,this._updatingHandles.destroy(),this._deconflictor.destroy(),this._checkOcclusion.clear(),this._active.clear()}setDirty(){!this._dirty&&(this._active.size>0||this._checkOcclusion.size>0)&&(this._dirty=!0,this.notifyChange("_readyToRun"))}setPriority(t,e){const i=this._active.get(t.graphic.uid)?.getInfo(this.visibilityGroup);i&&(i.priority=e)}get _readyToRun(){return this._state!==0||this._dirty}get updating(){return this._readyToRun||this._updatingHandles.updating}get updatingProgress(){if(!this.updating)return 1;const t=this._state/5;return this._dirty?.5*t:t}get readyToRun(){return this.view.ready&&this.view.state!=null&&this._readyToRun}get usedMemory(){return this._occlusionQuery?.usedMemory??0+4*(this._occlusionQueryUids?.length??0)}runTask(t){switch(this._state){case 0:this._startUpdate(),t.madeProgress();case 1:if(this._state=1,!this._processCheckOcclusion(t))return;case 2:if(this._state=2,this._occlusionQuery&&!this._occlusionQuery.done)return Oa;this._readOcclusionQueryResult(),t.madeProgress();case 3:if(this._state=3,!this._collectActiveGraphics(t))return;case 4:if(this._state=4,this._deconflictor.run(t),!this._deconflictor.done)return;default:this._state=0,this.notifyChange("_readyToRun")}}setGraphicsActive(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i))}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?.geometries.length??0)!==1?!1:e?.geometries[0]?.material instanceof gpe}_startUpdate(){d4t(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._deconflictor.reset(t,e),this._resetIterators(),this._occlusionQueryUids.length=0,this._checkOcclusion.size||(this._occlusionQuery=Pe(this._occlusionQuery))}addToActiveGraphics(t){t.ensureInfo(this.visibilityGroup),this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){$5t(t,this.visibilityGroup),t.removeInfo(this.visibilityGroup),this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}addToCheckOcclusion(t){this._checkOcclusion.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromCheckOcclusion(t){this._checkOcclusion.delete(t.graphics3DGraphic.graphic.uid)}_processCheckOcclusion(t){if(this._checkOcclusion.size===0)return!0;const e=this._ensureCheckOcclusionIterator(),i=this._viewState.camera,r=Yc(y5t,i.viewInverseTransposeMatrix),s=this.view.map.ground.opacity>0,n=this.view.viewingMode==="global"&&s&&i.relativeElevation>0?v5t:null;let a=0;n!=null&&(jO(n,Aa,i.viewMatrix),n[3]=xr(this.view.spatialReference).radius,a=t6e(n,Aa));const o=fi();for(;;){if(t.done)return!1;t.madeProgress();const l=e.next();if(l.done===!0)break;const u=l.value,d=u.graphics3DGraphic;if(d.destroyed||!d.isVisible(1,8))continue;const f=A5t(d,this.visibilityGroup);let g=null,v=!0;for(const _ of f){if(!this.layerSupportsDeconfliction(_))continue;g=O5t,this._projectHudLayer(_,i,g),R0(o);const x=_.stageObject.geometries[0].material;if(this._expandBoundingRect(o,i,_,x,g),g.isOutsideScreen){v=!1;break}if(this._isCulledBySlice(u,g.positionView)){v=!1;break}if(n!=null&&E5t(g,n,a)){v=!1;break}Ft(yX,g.positionView,r),g.altitude=this.view.renderCoordsHelper.getAltitude(yX);const S=u.ensureInfo(this.visibilityGroup);if(S.altitude=g.altitude,S.distance=g.distance,S.distanceToOccluder=g.distanceToOccluder,S.culled=!1,O1(S.aabr,o),x.parameters.occlusionTest)break;this._ensureOcclusionQuery().addPosition(yX)===this._occlusionQueryUids.length&&this._occlusionQueryUids.push(d.graphic.uid);break}if(this._active.has(d.graphic.uid)&&(!v||!g)){const _=u.ensureInfo(this.visibilityGroup);_.visible=!g,_.culled=!0}}return this._checkOcclusionIterator=null,this._occlusionQueryUids.length||(this._occlusionQuery=Pe(this._occlusionQuery)),this._occlusionQuery?.start(),!0}_readOcclusionQueryResult(){if(!this._occlusionQuery||!this._occlusionQueryUids.length)return;const t=this._viewState.camera,e=this.view.renderCoordsHelper.getAltitude(t.eye);for(let i=0;i<this._occlusionQueryUids.length;i++){const r=this._occlusionQueryUids[i],s=this._checkOcclusion.get(r);if(!s)continue;const n=this._occlusionQuery.getOcclusion(i)??-1,a=s.getInfo(this.visibilityGroup);a&&(a.distanceToOccluder=n>0?a.distance-n:0);const o=n<=0||this._occludedVisibility(a?.distanceToOccluder??0,a?.distance??n,a?.altitude??0,e);this._active.has(r)?a&&(a.culled=!o,a.visible=o):this._setGraphicVisibility(s,o)}this._occlusionQueryUids.length=0}_collectActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=this.visibilityGroup===16;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._activeIterator=null,!0;const s=r.value,n=s.getInfo(this.visibilityGroup);n&&(!(!i||s.graphics3DGraphic.isVisible())||n.culled?(f8e(n.aabr,!1,!0),this._setGraphicVisibility(s,n.visible)):this._deconflictor.add(n))}return!1}_occludedVisibility(t,e,i,r){const s=Math.max(this._minAltitudeDifference,Math.abs(i-r))-this._minAltitudeDifference;return t===0||e-t<=this._baseOccludedVisibility+this._altitudeFactor*s}_resetIterators(){this._checkOcclusionIterator=null,this._activeIterator=null}_ensureCheckOcclusionIterator(){return this._checkOcclusionIterator??=this._checkOcclusion.values(),this._checkOcclusionIterator}_ensureActiveGraphicsIterator(){return this._activeIterator??=this._active.values(),this._activeIterator}_ensureOcclusionQuery(){return this._occlusionQuery??=new A2({view:this.view}),this._occlusionQueryUids.length||this._occlusionQuery.init(this._checkOcclusion.size,this._viewState.camera.eye),this._occlusionQuery}_projectHudLayer(t,e,i){const r=t.stageObject,s=r.geometries[0],n=s.material;Ft(Fy,Li(r.boundingVolumeWorldSpace.bounds),e.viewMatrix);const a=s.attributes,o=a.get("normal").data,l=a.get("centerOffsetAndDistance").data;n.applyShaderOffsetsView(Fy,o,r.transformation,l,e,i.screenSizePerspectiveEvaluators,Fy),Or(QC,Fy[0],Fy[1],Fy[2],1),zu(RI,QC,e.projectionMatrix),he(i.positionNDC,RI,1/RI[3]),n.applyShaderOffsetsNDC(i.positionNDC,l,e,i.positionNDC,vX),i.distanceWithoutPolygonOffset=e.depthNDCToWorld(vX[2]),i.distance=vX[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:e.depthNDCToWorld(i.positionNDC[2]),Or(RI,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),zu(QC,RI,e.inverseProjectionMatrix),y1(QC,QC,1/QC[3]),xe(i.positionView,Fy[0],Fy[1],Fy[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&ade(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,r,{positionNDC:s,screenSizePerspectiveEvaluators:n}){const a=i.getScreenSize(C5t);n.evaluator.applyVec2(a,a),a[0]*=e.pixelRatio,a[1]*=e.pixelRatio;const o=_q(r.calculateRelativeScreenBounds(a,n.alignmentEvaluator.apply(e.pixelRatio),b5t),yt(0,e.fullWidth,.5+.5*s[0]),yt(0,e.fullHeight,.5+.5*s[1])),l=this.marginFactor;if(l!==0){const u=l*Math.min(So(o),Zl(o));o[0]-=u,o[1]-=u,o[2]+=u,o[3]+=u}VE(t,o,t)}_setGraphicVisibility(t,e){const i=t?.graphics3DGraphic;i&&!i.destroyed&&(i.setVisibilityFlag(this.visibilityGroup,8,e),this.visibilityGroup===16&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function $5t(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,8,!0)}c([p({constructOnly:!0})],Xb.prototype,"view",void 0),c([p({type:Boolean,readOnly:!0})],Xb.prototype,"_readyToRun",null),c([p({type:Boolean,readOnly:!0})],Xb.prototype,"updating",null),c([p({readOnly:!0})],Xb.prototype,"_updatingHandles",void 0),Xb=c([R("esri.views.3d.layers.graphics.Deconflictor")],Xb);const C5t=Ke();class M5t{constructor(){this.positionView=I(),this.positionNDC=I(),this.altitude=0,this.distance=0,this.distanceToOccluder=0,this.distanceWithoutPolygonOffset=0,this.screenSizePerspectiveEvaluators=new m8e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1||e[2]>=1}}function E5t(t,e,i){return me(_X.direction,t.positionView),xe(_X.origin,0,0,0),!!a_(e,_X,_5t)&&t.distanceWithoutPolygonOffset>i}function A5t(t,e){return e===16?t.labelLayers:t.layers}const O5t=new M5t,P5t=2e3;let NB=class extends Xb{constructor(e){super(e),this.visibilityGroup=16,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.readyToRun)return Oa;const i=performance.now();if(this.view.state.mode!==2&&i-this._lastDeconfliction<P5t)return Oa;const r=super.runTask(e);return this.state===0&&(this._lastDeconfliction=i),r}};c([p({constructOnly:!0})],NB.prototype,"parent",void 0),NB=c([R("esri.views.3d.layers.graphics.LabelDeconflictor")],NB);let qae=class extends Xb{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=1,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._updatingHandles.add(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),this._updatingHandles.add(()=>this.view?.slice?.plane,()=>{this._updateSlicePlane(),this._slicePlaneChanged(),this.setDirty()},Yt),this.addHandles(X(()=>this.view.basemapTerrain?.updating||this.view.graphicsView?.updating||this.view.allLayerViews.some(e=>e.updating),(e,i)=>{!e&&i&&this.setDirty()},Ht)),this._frameTask=this.view.resourceController.scheduler.registerTask(Tt.GRAPHICS_DECONFLICTOR,this),this._labels=new NB({view:this.view,parent:this})}destroy(){this._labels=Pe(this._labels),this._frameTask=Xi(this._frameTask)}get marginFactor(){return this._marginFactor}get usedMemory(){return super.usedMemory+this._labels.usedMemory}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){const i=super.runTask(e);return this.readyToRun||this._labels.setDirty(),i}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?.slice?.plane;e!=null&&Bje(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){for(const e of this._contexts.keys())if(e.symbolCreationContext.slicePlaneEnabled)return void this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labelsEnabledChanged(e,i),featureReductionChange:()=>this._enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),screenSizePerspectiveEnabledChanged:()=>this._screenSizePerspectiveEnabledChange(),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new S5t(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),this.addToCheckOcclusion(n),bX(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&(this._labels.addToCheckOcclusion(n),this._labels.addToActiveGraphics(n));const a=!this._graphicSupportsDeconfliction(r)||!bX(e);r.setVisibilityFlag(1,8,a)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this.removeFromCheckOcclusion(s),this._labels.removeFromActiveGraphics(s),this._labels.removeFromCheckOcclusion(s),e.delete(r),this.setDirty())}_enabledChanged(e,i){bX(e)?i.forEach(r=>this.addToActiveGraphics(r)):(i.forEach(r=>this.removeFromActiveGraphics(r)),R5t(e))}_labelsEnabledChanged(e,i){e.labelsEnabled?(i.forEach(r=>this._labels.addToCheckOcclusion(r)),i.forEach(r=>this._labels.addToActiveGraphics(r))):(i.forEach(r=>this._labels.removeFromCheckOcclusion(r)),i.forEach(r=>this._labels.removeFromActiveGraphics(r)))}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}_screenSizePerspectiveEnabledChange(){this.setDirty()}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i?.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function bX(t){const e=t.layer;return!(!e?.featureReduction||e.featureReduction.type!=="selection")}function R5t(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(1,8,!0))}qae=c([R("esri.views.3d.layers.graphics.GraphicsDeconflictor")],qae);function Y8e(t){return"declaredClass"in t}function k$e(t){return"declaredClass"in t}function I5t(t){return"declaredClass"in t}function D5t(t,e,i){return t?I5t(t)?(t.origin!==i&&(t.origin=i),t):new ms({layer:e,sourceLayer:e,origin:i,visible:t.visible,symbol:se(t.symbol),attributes:se(t.attributes),geometry:J8e(t.geometry)}):null}function J8e(t){return t==null?null:Y8e(t)?t:wp(k5t(t))}function k5t(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:a,y:o,z:l,m:u}=t;return{x:a,y:o,z:l,m:u,spatialReference:n}}case"polygon":{const{rings:a,hasZ:o,hasM:l}=t;return{rings:L$e(a),hasZ:o,hasM:l,spatialReference:n}}case"polyline":{const{paths:a,hasZ:o,hasM:l}=t;return{paths:L$e(a),hasZ:o,hasM:l,spatialReference:n}}case"extent":{const{xmin:a,xmax:o,ymin:l,ymax:u,zmin:d,zmax:f,mmin:g,mmax:v,hasZ:_,hasM:x}=t;return{xmin:a,xmax:o,ymin:l,ymax:u,zmin:d,zmax:f,mmin:g,mmax:v,hasZ:_,hasM:x,spatialReference:n}}case"multipoint":{const{points:a,hasZ:o,hasM:l}=t;return{points:X8e(a)?Q8e(a):a,hasZ:o,hasM:l,spatialReference:n}}default:return}}function L$e(t){return L5t(t)?t.map(e=>Q8e(e)):t}function Q8e(t){return t.map(e=>Array.from(e))}function L5t(t){for(const e of t)if(e.length!==0)return X8e(e);return!1}function X8e(t){return t.length>0&&(NL(t[0])||VL(t[0]))}function F5t(t,e){if(!t)return null;let i;if(k$e(t)){if(e==null)return t.clone();if(k$e(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=vm(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function ibi(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return Me.fromJSON(n)}const wX=()=>re.getLogger("esri.layers.support.labelFormatUtils"),xX={type:"simple",evaluate:()=>null},z5t={getAttribute:(t,e)=>t.field(e)};async function N5t(t,e,i){if(!t||!t.symbol||!e)return xX;const r=t.where,s=tH(t);let n;if(s.type==="arcade"){const a=D5e(s.expression),o=e.get(a);if(o&&(q5e(o)||_F(o)||_ue(o)))n={type:"simple",evaluate(l){const u="attributes"in l?l.attributes?.[o.name]:l.field(o.name);return u==null?"":u.toString()}};else{const l=await h$t(s.expression,i);if(l==null)return xX;n={type:"arcade",evaluate(u,d){try{const f="attributes"in u?l.repurposeFeature(u,e):u;f.contextTimeZone=d??null;const g=l.evaluate(f,{$view:{timeZone:d}});if(g!=null)return g.toString()}catch(f){wX().error(new q("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:f,feature:u,expression:s}))}return null},needsHydrationToEvaluate:()=>Phe(s.expression)==null}}}else n={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,o=>{const l=o.slice(1,-1),u=e.get(l);if(!u)return o;let d=null;return d="attributes"in a?a?.attributes?.[u.name]:a.field(u.name),d==null?"":V5t(d,u)})};if(r){let a;try{a=await yue(r,e)}catch(l){return wX().error(new q("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),xX}const o=n.evaluate;n.evaluate=(l,u)=>{const d="attributes"in l?void 0:z5t;try{if(a.testFeature(l,d))return o(l,u)}catch(f){wX().error(new q("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:f}))}return null}}return n}function V5t(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=Eft(e),a=+t;if(n!=null&&s!=null&&n<=a&&a<=s)return i.name}}let r=t;return bue(e)?r=o1(r,Nct("short-date")):_F(e)&&(r=k0(+r)),r||""}let j5t=class{constructor(e,i){this.renderer=e,this.symbol=i,this.color=null,this.size=null,this.opacity=null,this.outlineSize=null,this.heading=null,this.tilt=null,this.roll=null}};function sbi(t,e,i,r,s,n,a,o,l,u,d){const f=Z5t[d.mode];let g,v,_=0;if(io(t,e,i,r,l.spatialReference,s,o))return f?.requiresAlignment(d)?(_=f.applyElevationAlignmentBuffer(r,s,n,a,o,l,u,d),g=n,v=a):(g=r,v=s),io(g,l.spatialReference,v,n,u.spatialReference,a,o)?_:void 0}function ype(t,e,i,r,s){const n=(yG(t)?t.z:H6e(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const a=Lg(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=a,void(s.z=a)}case"relative-to-ground":{const a=Lg(e,t,"ground")??0,o=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=o,s.sampledElevation=a,void(s.z=o+a)}case"relative-to-scene":{const a=Lg(e,t,"scene")??0,o=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=o,s.sampledElevation=a,void(s.z=o+a)}case"absolute-height":{const a=i.geometryZWithOffset(n,r),o=Lg(e,t,"ground")??0;return s.verticalDistanceToGround=a-o,s.sampledElevation=o,void(s.z=a)}default:return void(s.z=0)}}function nbi(t,e,i,r){return ype(t,e,i,r,bE),bE.z}function U5t(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:1:t.onTheGroundChanged}function F$e(t){return t==="relative-to-ground"||t==="relative-to-scene"}function abi(t){return t!=="absolute-height"}function K8e(t,e,i,r,s){ype(e,i,s,r,bE),eqe(t,bE.verticalDistanceToGround);const n=bE.sampledElevation,a=Ln(Y5t,t.transformation);return Aj[0]=e.x,Aj[1]=e.y,Aj[2]=bE.z,IF(e.spatialReference,Aj,a,r.spatialReference)?t.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function eqe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute("centerOffsetAndDistance");r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],"centerOffsetAndDistance"))}}function B5t(t,e,i,r,s,n){let a=0;const o=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const u=t[e],d=t[e+1],f=t[e+2],g=n.getElevation(u,d,f,o,"ground")??0;a+=g,i[r]=u,i[r+1]=d,i[r+2]=g,e+=3,r+=3}return a/s}function q5t(t,e,i,r,s,n,a,o){let l=0;const u=o.calculateOffsetRenderUnits(a),d=o.featureExpressionInfoContext,f=n.spatialReference;e*=3,r*=3;for(let g=0;g<s;++g){const v=t[e],_=t[e+1],x=t[e+2],S=n.getElevation(v,_,x,f,"ground")??0;l+=S,i[r]=v,i[r+1]=_,i[r+2]=d==null?x+S+u:S+u,e+=3,r+=3}return l/s}function G5t(t,e,i,r,s,n,a,o){let l=0;const u=o.calculateOffsetRenderUnits(a),d=o.featureExpressionInfoContext,f=n.spatialReference;e*=3,r*=3;for(let g=0;g<s;++g){const v=t[e],_=t[e+1],x=t[e+2],S=n.getElevation(v,_,x,f,"scene")??0;l+=S,i[r]=v,i[r+1]=_,i[r+2]=d==null?x+S+u:S+u,e+=3,r+=3}return l/s}function H5t(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function W5t(t,e,i,r,s,n,a,o){const l=o.calculateOffsetRenderUnits(a),u=o.featureExpressionInfoContext;e*=3,r*=3;for(let d=0;d<s;++d){const f=t[e],g=t[e+1],v=t[e+2];i[r]=f,i[r+1]=g,i[r+2]=u==null?v+l:l,e+=3,r+=3}return 0}let tqe=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};const Z5t={"absolute-height":{applyElevationAlignmentBuffer:W5t,requiresAlignment:H5t},"on-the-ground":{applyElevationAlignmentBuffer:B5t,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:q5t,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:G5t,requiresAlignment:()=>!0}},Y5t=ut(),bE=new tqe,Aj=I();function J5t(t){if(t.length<Hc)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return ePe(t)?NF().from(t):G9(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let iqe=class rqe{get center(){return Ye(this._data[0],this._data[1],this._data[2])}get radius(){return this._data[3]}get bbMin(){return Ye(this._data[4],this._data[5],this._data[6])}get bbMax(){return Ye(this._data[7],this._data[8],this._data[9])}constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._data=[.1,0,0,0,0,0,0,0,0,0],this._children=void 0,xt(e.length>=1),xt(r.size===3||r.size===4);const{data:s,size:n,indices:a}=r;xt(a.length%this._numIndexPerPrimitive===0),xt(a.length>=e.length*this._numIndexPerPrimitive);const o=e.length;let l=n*a[this._numIndexPerPrimitive*e[0]];Ex.clear(),Ex.push(l);const u=Ye(s[l],s[l+1],s[l+2]),d=Tr(u);for(let _=0;_<o;++_){const x=this._numIndexPerPrimitive*e[_];for(let S=0;S<this._numIndexPerPrimitive;++S){l=n*a[x+S],Ex.push(l);let T=s[l];u[0]=Math.min(T,u[0]),d[0]=Math.max(T,d[0]),T=s[l+1],u[1]=Math.min(T,u[1]),d[1]=Math.max(T,d[1]),T=s[l+2],u[2]=Math.min(T,u[2]),d[2]=Math.max(T,d[2])}}for(let _=0;_<3;++_)this._data[4+_]=u[_],this._data[7+_]=d[_];const f=cr(I(),this.bbMin,this.bbMax,.5);let g=.5*Math.max(Math.max(d[0]-u[0],d[1]-u[1]),d[2]-u[2]),v=g*g;for(let _=0;_<Ex.length;++_){l=Ex.at(_);const x=s[l]-f[0],S=s[l+1]-f[1],T=s[l+2]-f[2],M=x*x+S*S+T*T;if(M<=v)continue;const E=Math.sqrt(M),P=.5*(E-g);g+=P,v=g*g;const O=P/E;f[0]+=x*O,f[1]+=S*O,f[2]+=T*O}this._data[3]=g;for(let _=0;_<3;++_)this._data[0+_]=f[_];Ex.clear()}getChildren(){if(this._children||Mn(this.bbMin,this.bbMax)<=1)return this._children;const e=cr(I(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let d=0;d<8;++d)s[d]=0;const{data:n,size:a,indices:o}=this.position;for(let d=0;d<i;++d){let f=0;const g=this._numIndexPerPrimitive*this.primitiveIndices[d];let v=a*o[g],_=n[v],x=n[v+1],S=n[v+2];for(let T=1;T<this._numIndexPerPrimitive;++T){v=a*o[g+T];const M=n[v],E=n[v+1],P=n[v+2];M<_&&(_=M),E<x&&(x=E),P<S&&(S=P)}_<e[0]&&(f|=1),x<e[1]&&(f|=2),S<e[2]&&(f|=4),r[d]=f,++s[f]}let l=0;for(let d=0;d<8;++d)s[d]>0&&++l;if(l<2)return;const u=new Array(8);for(let d=0;d<8;++d)u[d]=s[d]>0?new Uint32Array(s[d]):void 0;for(let d=0;d<8;++d)s[d]=0;for(let d=0;d<i;++d){const f=r[d];u[f][s[f]++]=this.primitiveIndices[d]}this._children=new Array;for(let d=0;d<8;++d)u[d]!==void 0&&this._children.push(new rqe(u[d],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Ex.prune()}};const Ex=new Ai({deallocator:null});let sqe=class{constructor(e){this.id=Gc(),this._attributes=new Map;for(const[i,r]of e)this._attributes.set(i,{...r,indices:SH(r.indices)})}get attributes(){return this._attributes}};function Q5t(t){return t?{p0:Tr(t.p0),p1:Tr(t.p1),p2:Tr(t.p2)}:{p0:I(),p1:I(),p2:I()}}function X5t(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],a=i[1]-t[1];return .5*Math.abs(r*a-s*n)}function K5t(t,e,i){return Ae(SX,e,t),Ae(z$e,i,t),.5*Ve(At(SX,SX,z$e))}new r_(s_);new r_(()=>Q5t());const SX=I(),z$e=I();function eLt(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;xe(e,0,0,0),xe(Hd,0,0,0);let n=0,a=0;for(let o=0;o<s.length-2;o+=3){const l=s[o]*i,u=s[o+1]*i,d=s[o+2]*i;xe(Ja,r[l],r[l+1],r[l+2]),xe(n0,r[u],r[u+1],r[u+2]),xe(Oj,r[d],r[d+1],r[d+2]);const f=K5t(Ja,n0,Oj);f?($e(Ja,Ja,n0),$e(Ja,Ja,Oj),he(Ja,Ja,1/3*f),$e(e,e,Ja),n+=f):($e(Hd,Hd,Ja),$e(Hd,Hd,n0),$e(Hd,Hd,Oj),a+=3)}return(a!==0||n!==0)&&(n!==0?(he(e,e,1/n),!0):a!==0&&(he(e,Hd,1/a),!0))}function tLt(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;xe(e,0,0,0);let n=-1,a=0;for(let o=0;o<s.length;o++){const l=s[o]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],a++),n=l}return a>1&&he(e,e,1/a),a>0}function iLt(t,e,i){if(!t)return!1;xe(i,0,0,0),xe(Hd,0,0,0);let r=0,s=0;const{size:n,data:a,indices:o}=t,l=o.length-1,u=l+(e?2:0);for(let d=0;d<u;d+=2){const f=d<l?d+1:0,g=o[d<l?d:l]*n,v=o[f]*n;Ja[0]=a[g],Ja[1]=a[g+1],Ja[2]=a[g+2],n0[0]=a[v],n0[1]=a[v+1],n0[2]=a[v+2],he(Ja,$e(Ja,Ja,n0),.5);const _=CF(Ja,n0);_>0?($e(i,i,he(Ja,Ja,_)),r+=_):r===0&&($e(Hd,Hd,Ja),s++)}return r!==0?(he(i,i,1/r),!0):s!==0&&(he(i,Hd,1/s),!0)}const Ja=I(),n0=I(),Oj=I(),Hd=I();let nqe=class{constructor(){this.uid=Gc()}},aqe=class extends nqe{constructor(e){super(),this.highlightName=e,this.channel=0}},rLt=class extends nqe{constructor(){super(...arguments),this.channel=1}},Qc=class oqe extends sqe{constructor(e,i,r=null,s=0,n=null,a=-1,o){super(i),this.material=e,this.mapPositions=r,this.type=s,this.olidColor=n,this.edgeIndicesLength=a,this.baseGeometry=o,this._highlights=null,this._highlightOptionsCounts=null,this.visible=!0,this._boundingInfo=null;const l=this.positionAttribute;l!=null&&this.edgeIndicesLength<0&&(this.edgeIndicesLength=l.indices.length)}instantiate(e={}){const i=new oqe(e.material||this.material,[],this.mapPositions,this.type,this.olidColor,this.edgeIndicesLength,this.baseGeometry);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:J5t(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r?this._attributes.set(e,{...r,exclusive:!0,data:i}):Bl()&&console.warn(`Setting undefined attribute ${e} data`)}get positionAttribute(){return this.attributes.get("position")??this.baseGeometry?.attributes.get("position")}get indexCount(){return this._attributes.values().next().value?.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo??=this._calculateBoundingInfo(),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===0?this._computeAttachmentOriginTriangles(e):this.type===2?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&Ft(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.positionAttribute;return eLt(i,e)}_computeAttachmentOriginLines(e){const i=this.positionAttribute;return iLt(i,sLt(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.positionAttribute;return tLt(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.positionAttribute;if(!e||e.indices.length===0)return null;const i=this.type===0?3:1;xt(e.indices.length%i===0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=IP(e.indices.length/i);return new iqe(r,i,e)}get transformation(){return this._transformation??gl}set transformation(e){this._transformation=e&&e!==gl?bLe(e):null}get highlights(){return this._highlights||nLt}get hasHighlights(){return(this._highlightOptionsCounts?.size??0)>0}foreachHighlightOptions(e){this._highlightOptionsCounts?.forEach((i,r)=>e(r))}allocateIdAndHighlight(e){const i=new aqe(e);return this.addHighlight(i)}addHighlight(e){this._ensureHighlights().add(e);const{highlightName:i}=e,r=(this._highlightOptionsCounts?.get(i)??0)+1;return this._ensureHighlightOptionsCounts().set(i,r),e}_ensureHighlights(){let e=this._highlights;return e||(e=new Set,this._highlights=e),e}_ensureHighlightOptionsCounts(){let e=this._highlightOptionsCounts;return e||(e=new Map,this._highlightOptionsCounts=e),e}removeHighlight(e){if(this._highlights?.delete(e)){const{highlightName:i}=e,r=this._highlightOptionsCounts?.get(i)??0;r<=1?this._highlightOptionsCounts?.delete(i):this._ensureHighlightOptionsCounts().set(i,r-1)}}};function sLt(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const nLt=new Set;function lqe(t){return t.mapPositions!=null}function dbi(t,e,i,r,s){const n=t.stageObject,a=n.geometries;let o=0;for(const l of a){if(!lqe(l))continue;const{update:u,averageGeometrySampledElevation:d}=uqe(l,e,i,r,s);o+=d,u&&n.geometryVertexAttributeUpdated(l,"position")}return o/a.length}function aLt(t,e,i,r,s,n){const a=t.stageObject,o=e.centerInElevationSR;let l=0;r(o,Du),a.usesVerticalDistanceToGround?(eqe(a,Du.verticalDistanceToGround),l=Du.sampledElevation):e.mode!=="absolute-height"&&(l=Du.sampledElevation);const u=Ln(oLt,n??a.transformation),d=xe(cqe,u[12],u[13],u[14]);bn.TESTS_DISABLE_OPTIMIZATIONS?(kc[0]=o[0],kc[1]=o[1],kc[2]=Du.z,IF(i,kc,u,s.spatialReference)&&(n?Ln(n,u):a.transformation=u)):s.setAltitudeOfTransformation(Du.z,u);const f=vpe/s.unitInMeters;return(Math.abs(u[12]-d[0])>=f||Math.abs(u[13]-d[1])>=f||Math.abs(u[14]-d[2])>=f)&&(n?Ln(n,u):a.transformation=u),l}const oLt=ut();function pbi(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const a=e.centerInElevationSR;r(a,Du);const o=e.mode!=="absolute-height"?Du.sampledElevation:0,l=n.instanceData,u=t.instanceIndex,d=lLt;l.getGlobalTransform(u,d);const f=xe(cqe,d[12],d[13],d[14]);bn.TESTS_DISABLE_OPTIMIZATIONS?(kc[0]=a[0],kc[1]=a[1],kc[2]=Du.z,IF(i,kc,d,s.spatialReference)&&l.setGlobalTransform(u,d)):s.setAltitudeOfTransformation(Du.z,d);const g=vpe/s.unitInMeters;return(bn.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(d[12]-f[0])>=g||Math.abs(d[13]-f[1])>=g||Math.abs(d[14]-f[2])>=g)&&l.setGlobalTransform(u,d),o}function fbi(t,e,i,r,s){const n=t.stageObject,a=n.geometries;if(a.length===0)return 0;let o=0,l=null,u=0,d=!1;for(const f of a){if(!lqe(f))continue;const g=f.attributes.get("position");if(g!==l){const{update:v,averageGeometrySampledElevation:_}=uqe(f,e,i,r,s);u=_,l=g,d=v}d&&n.geometryVertexAttributeUpdated(f,"position"),o+=u}return o/a.length}const vpe=.01,kc=I(),wd=I(),XC=I(),lLt=ut(),cqe=I(),Du=new tqe;function uqe(t,e,i,r,s){let n=!1;const a=t.transformation,o=e.requiresSampledElevationInfo;wd[0]=a[12],wd[1]=a[13],wd[2]=a[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute("position"),u=l.data,d=l.size,f=u.length/d,g=new UOt(t.mapPositions,i);let v=0,_=0;for(let x=0;x<f;x++){if(XC[0]=u[v],XC[1]=u[v+1],XC[2]=u[v+2],r(g,Du),o&&(_+=Du.sampledElevation),bn.TESTS_DISABLE_OPTIMIZATIONS)u[v]=g.array[g.offset],u[v+1]=g.array[g.offset+1],u[v+2]=Du.z,io(u,i,v,u,s.spatialReference,v,1),u[v]-=wd[0],u[v+1]-=wd[1],u[v+2]-=wd[2],n=!0;else{kc[0]=u[v]+wd[0],kc[1]=u[v+1]+wd[1],kc[2]=u[v+2]+wd[2],s.setAltitude(kc,Du.z),u[v]=kc[0]-wd[0],u[v+1]=kc[1]-wd[1],u[v+2]=kc[2]-wd[2];const S=vpe/s.unitInMeters;(Math.abs(XC[0]-u[v])>=S||Math.abs(XC[1]-u[v+1])>=S||Math.abs(XC[2]-u[v+2])>=S)&&(n=!0)}v+=d,g.offset+=3}return _/=f,{update:n,averageGeometrySampledElevation:_}}let cLt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var Gae,LT;let Ek=(LT=class extends nt(ae){constructor(e){super(e),this.type="georeferenced",this.origin=null}},Gae=LT,LT.absolute=new Gae,LT);c([st({georeferenced:"georeferenced"},{readOnly:!0})],Ek.prototype,"type",void 0),c([p({type:[Number],nonNullable:!1,json:{write:!0}})],Ek.prototype,"origin",void 0),Ek=Gae=c([R("esri.geometry.support.MeshGeoreferencedVertexSpace")],Ek);let Ak=class extends nt(ae){constructor(e){super(e),this.type="local",this.origin=I()}};c([st({local:"local"},{readOnly:!0})],Ak.prototype,"type",void 0),c([p({type:[Number],nonNullable:!0,json:{write:!0}})],Ak.prototype,"origin",void 0),Ak=c([R("esri.geometry.support.MeshLocalVertexSpace")],Ak);function ybi(t){return t.origin==null}function hqe(t){return t.origin!=null}function vbi(t){return hqe(t.vertexSpace)}function uLt(t,e){if(!hqe(t))return null;const[i,r,s]=t.origin;return new Ue({x:i,y:r,z:s,spatialReference:e})}function _bi(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,a=[i,r,s??0];return(e?.vertexSpace??hLt(n))==="local"?new Ak({origin:a}):new Ek({origin:a})}function hLt(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function bbi(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&di(t.origin,e.origin))}function dqe(t,e){if(t.type==="point")return sb(t,e,!1);if(Y8e(t))switch(t.type){case"extent":return sb(t.center,e,!1);case"polygon":return sb(V$e(t),e,!1);case"polyline":return sb(N$e(t),e,!0);case"mesh":return sb(uLt(t.vertexSpace,t.spatialReference)??t.extent.center,e,!1);case"multipoint":return}else switch(t.type){case"extent":return sb(dLt(t),e,!0);case"polygon":return sb(V$e(t),e,!0);case"polyline":return sb(N$e(t),e,!0);case"multipoint":return}}function N$e(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=tDe(e,eDe(e)/2);return vm(i[0],i[1],i[2],t.spatialReference)}function dLt(t){return vm(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function V$e(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=aDe(t.rings,!!t.hasZ);return vm(i[0],i[1],i[2],t.spatialReference)}function sb(t,e,i){const r=i?t:F5t(t);return e&&t?Jke(t,r,e)?r:null:r}function wbi(t){if(!t)return 0;switch(t.type){case"point":return t.z;case"extent":return t.zmax;case"polygon":return t.hasZ?t.rings.reduce((e,i)=>i.reduce((r,s)=>Math.max(r,s[2]),e),-1/0):void 0;case"polyline":return t.hasZ?t.paths.reduce((e,i)=>i.reduce((r,s)=>Math.max(r,s[2]),e),-1/0):void 0;case"mesh":return t.extent.zmax;case"multipoint":return}}function xbi(t,e,i,r=0){if(t){e||(e=fi());const s=t;let n=.5*s.width*(i-1),a=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=a/20:s.height<1e-7*s.width&&(a+=n/20),Or(e,s.xmin-n-r,s.ymin-a-r,s.xmax+n+r,s.ymax+a+r),e}return null}function TX(t,e,i=null){const r=eA(nH);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],t.length>3&&(r[3]=t[3])),e!=null&&(r[3]=e),i&&y1(r,r,i),r}function Sbi(t,e,i,r,s,n){for(let a=0;a<3;++a)n[a]=t?.[a]!=null?t[a]:i?.[a]!=null?i[a]:s[a];return n[3]=e??r??s[3],n}function Tbi(t=Wce,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,a=0;for(let o=2;o>=0;o--){const l=t[o],u=l!=null,d=o===0&&!n&&!u,f=i[o];let g;l==="symbol-value"||d?g=f!==0?e[o]/f:1:u&&l!=="proportional"&&isFinite(l)&&(g=f!==0?l/f:1),g!=null&&(s[o]=g,n=g,a=Math.max(a,Math.abs(g)))}for(let o=2;o>=0;o--)s[o]==null?s[o]=n:s[o]===0&&(s[o]=.001*a)}for(let n=2;n>=0;n--)s[n]/=r;return F5(s)}function pLt(t){return t.isPrimitive!=null}function $bi(t){return fLt(pLt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function fLt(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function Cbi(t,e,i,r=ut()){return t&&PO(r,r,-t/180*Math.PI),e&&OO(r,r,e/180*Math.PI),i&&E7(r,r,i/180*Math.PI),r}function mLt(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Yr(e),s=M$(t)*r,n=E$(t)*r,a=k1(t)*(e.isGeographic?1:r);return s===0&&n===0&&a===0?i.minDemResolutionForPoints:.01*Math.max(s,n,a)}let Mbi=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterial=i,this.hasSlicePlane=r}},pqe=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,a=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._sharedResource=r,this.elevationAligner=s,this.elevationContext=n,this._edgeState=a,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}get usedMemory(){return this.graphics3DSymbolLayer.usedMemory}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const a=j$e(s.baseMaterial);s.edgeMaterial.objectTransparency!==a&&(s.edgeMaterial.objectTransparency=a,this.resetEdgeObject(i)),n.stage.renderer.withEdgeView(o=>o.updateAllComponentOpacities(r,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(a=>{a.updateAllComponentMaterials(r,s.edgeMaterial,e,!i),s.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r){if(this.elevationAligner==null)return;const s=(n,a)=>ype(n,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i),this.resetEdgeObject(r)}alignWithAbsoluteElevation(e,i,r){const s=(n,a)=>{a.sampledElevation=e,a.verticalDistanceToGround=0,a.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,this.graphics3DSymbolLayer.view.spatialReference,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=I()){return me(e,Li(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=nc()){const i=this.stageObject.boundingVolumeObjectSpace;return xLe(e,i.min),SLe(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(zy)&&(Ft(zy,zy,i),$e(e.render.origin,e.render.origin,zy),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const a=this.getBoundingBoxObjectSpace(n),o=gLt,l=TLe(a)?1:o.length;for(let d=0;d<l;d++){const f=o[d];nb[0]=a[f[0]],nb[1]=a[f[1]],nb[2]=a[f[2]],Ft(nb,nb,this.stageObject.transformation),Ax[3*d]=nb[0],Ax[3*d+1]=nb[1],Ax[3*d+2]=nb[2]}if(!e(Ax,0,l))return null;Wu(a);let u=null;this.calculateRelativeScreenBounds&&(u=this.calculateRelativeScreenBounds());for(let d=0;d<3*l;d+=3){for(let f=0;f<3;f++)a[f]=Math.min(a[f],Ax[d+f]),a[f+3]=Math.max(a[f+3],Ax[d+f]);u&&r.push({location:Ax.slice(d,d+3),screenSpaceBoundingRect:u})}if(i?.service&&this.elevationContext.mode!=="absolute-height"){Pue(a,zy);const d=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let f=0;if(i.useViewElevation)f=i.service.getElevation(zy[0],zy[1],d)??0;else try{const g=mLt(a,i.service.spatialReference,i);f=await i.service.queryElevation(zy[0],zy[1],s,g,d)??0}catch{}igt(a,0,0,-this.alignedSampledElevation+f)}return a}addObjectState(e){e.stateType===0&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===1&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(a=>{n?this._addOrUpdateEdgeObject(i,a,e):a.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=j$e(e.baseMaterial);e.edgeMaterial.objectTransparency=s,i.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then(()=>this._stageLayer?.sync())}};function j$e(t){return t.transparent?0:1}const Ax=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],nb=I(),zy=I(),gLt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let yLt=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const vLt=3,_Lt=3,bLt=10;function Jh(t,e=!1){return t<=Hc?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Pbi(t){return Array.isArray(t)?t.length<Hc?t:new Float32Array(t):t.length<Hc?Array.from(t):t}function U$e(t){return(Array.isArray(t)?t.length:t.byteLength/8)<=Hc?Array.from(t):new Float32Array(t)}function Rbi(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function B$e(t,e){const i=t[e],r=t[e+1],s=t[e+2];return Math.sqrt(i*i+r*r+s*s)}function wLt(t,e){const i=t[e],r=t[e+1],s=t[e+2],n=1/Math.sqrt(i*i+r*r+s*s);t[e]*=n,t[e+1]*=n,t[e+2]*=n}function q$e(t,e,i){t[e]*=i,t[e+1]*=i,t[e+2]*=i}function xLt(t,e,i,r,s,n=e){(s=s||t)[n]=t[e]+i[r],s[n+1]=t[e+1]+i[r+1],s[n+2]=t[e+2]+i[r+2]}function SLt(){return G$e??=TLt(),G$e}function TLt(){const i=new ki([0,0,0,255,255,0,255,255],[0,1,2,3],2,!0);return new sqe([["uv0",i]])}let G$e=null;const $X=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],$Lt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],CLt=[0,0,1,0,1,1,0,1],MLt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],fqe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)fqe[6*t+e]=t;const O2=new Array(36);for(let t=0;t<6;t++)O2[6*t]=0,O2[6*t+1]=1,O2[6*t+2]=2,O2[6*t+3]=2,O2[6*t+4]=3,O2[6*t+5]=0;function ELt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=$X[r][0]*e[0],i[3*r+1]=$X[r][1]*e[1],i[3*r+2]=$X[r][2]*e[2];return new Qc(t,[["position",new ki(i,MLt,3,!0)],["normal",new ki($Lt,fqe,3)],["uv0",new ki(CLt,O2,2)]])}const CX=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],ALt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],OLt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],PLt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function RLt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=CX[r][0]*e[0],i[3*r+1]=CX[r][1]*e[1],i[3*r+2]=CX[r][2]*e[2];return new Qc(t,[["position",new ki(i,OLt,3,!0)],["normal",new ki(ALt,PLt,3)]])}const VB=pr(-.5,0,-.5),jB=pr(.5,0,-.5),UB=pr(0,0,.5),BB=pr(0,.5,0),KC=Iu(),eM=Iu(),uA=Iu(),hA=Iu(),dA=Iu();Ae(KC,VB,BB),Ae(eM,VB,jB),At(uA,KC,eM),Re(uA,uA),Ae(KC,jB,BB),Ae(eM,jB,UB),At(hA,KC,eM),Re(hA,hA),Ae(KC,UB,BB),Ae(eM,UB,VB),At(dA,KC,eM),Re(dA,dA);const MX=[VB,jB,UB,BB],ILt=[0,-1,0,uA[0],uA[1],uA[2],hA[0],hA[1],hA[2],dA[0],dA[1],dA[2]],DLt=[0,1,2,3,1,0,3,2,1,3,0,2],kLt=[0,0,0,1,1,1,2,2,2,3,3,3];function LLt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=MX[r][0]*e[0],i[3*r+1]=MX[r][1]*e[1],i[3*r+2]=MX[r][2]*e[2];return new Qc(t,[["position",new ki(i,DLt,3,!0)],["normal",new ki(ILt,kLt,3)]])}function Ibi(t,e,i,r,s={uv:!0}){const n=-Math.PI,a=2*Math.PI,o=-Math.PI/2,l=Math.PI,u=Math.max(3,Math.floor(i)),d=Math.max(2,Math.floor(r)),f=(u+1)*(d+1),g=Jh(3*f),v=Jh(3*f),_=Jh(2*f),x=[];let S=0;for(let E=0;E<=d;E++){const P=[],O=E/d,D=o+O*l,L=Math.cos(D);for(let F=0;F<=u;F++){const j=F/u,N=n+j*a,B=Math.cos(N)*L,U=Math.sin(D),Q=-Math.sin(N)*L;g[3*S]=B*e,g[3*S+1]=U*e,g[3*S+2]=Q*e,v[3*S]=B,v[3*S+1]=U,v[3*S+2]=Q,_[2*S]=j,_[2*S+1]=O,P.push(S),++S}x.push(P)}const T=new Array;for(let E=0;E<d;E++)for(let P=0;P<u;P++){const O=x[E][P],D=x[E][P+1],L=x[E+1][P+1],F=x[E+1][P];E===0?(T.push(O),T.push(L),T.push(F)):E===d-1?(T.push(O),T.push(D),T.push(L)):(T.push(O),T.push(D),T.push(L),T.push(L),T.push(F),T.push(O))}const M=[["position",new ki(g,T,3,!0)],["normal",new ki(v,T,3,!0)]];return s.uv&&M.push(["uv0",new ki(_,T,2,!0)]),s.offset&&(M[0][0]="offset",M.push(["position",new ki(Float64Array.from(s.offset),kde(T.length),3,!0)])),new Qc(t,M)}function FLt(t,e,i,r){const s=mqe(e,i,r);return new Qc(t,s)}function mqe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const u=r*(1+Math.sqrt(5))/2;s=[-r,u,0,r,u,0,-r,-u,0,r,-u,0,0,-r,u,0,r,u,0,-r,-u,0,r,-u,u,0,-r,u,0,r,-u,0,-r,-u,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let u=0;u<s.length;u+=3)q$e(s,u,t/B$e(s,u));let a={};function o(u,d){u>d&&([u,d]=[d,u]);const f=u.toString()+"."+d.toString();if(a[f])return a[f];let g=s.length;return s.length+=3,xLt(s,3*u,s,3*d,s,g),q$e(s,g,t/B$e(s,g)),g/=3,a[f]=g,g}for(let u=0;u<e;u++){const d=n.length,f=new Array(4*d);for(let g=0;g<d;g+=3){const v=n[g],_=n[g+1],x=n[g+2],S=o(v,_),T=o(_,x),M=o(x,v),E=4*g;f[E]=v,f[E+1]=S,f[E+2]=M,f[E+3]=_,f[E+4]=T,f[E+5]=S,f[E+6]=x,f[E+7]=M,f[E+8]=T,f[E+9]=S,f[E+10]=T,f[E+11]=M}n=f,a={}}const l=U$e(s);for(let u=0;u<l.length;u+=3)wLt(l,u);return[["position",new ki(U$e(s),n,3,!0)],["normal",new ki(l,n,3,!0)]]}function Dbi(t,{normal:e,position:i,color:r,rotation:s,size:n,centerOffsetAndDistance:a,uvi:o,featureAttribute:l,olidColor:u=null}={}){const d=i?Tr(i):I(),f=e?Tr(e):Ye(0,0,1),g=r?[r[0],r[1],r[2],r.length>3?r[3]:255]:[255,255,255,255],v=n!=null&&n.length===2?n:[1,1],_=s!=null?[s]:[0],x=kde(1),S=[["position",new ki(d,x,3,!0)],["normal",new ki(f,x,3,!0)],["color",new ki(g,x,4,!0)],["size",new ki(v,x,2)],["rotation",new ki(_,x,1,!0)]];if(o&&S.push(["uvi",new ki(o,x,o.length)]),a!=null){const T=[a[0],a[1],a[2],a[3]];S.push(["centerOffsetAndDistance",new ki(T,x,4)])}if(l){const T=[l[0],l[1],l[2],l[3]];S.push(["featureAttribute",new ki(T,x,4)])}return new Qc(t,S,null,1,u,void 0,SLt())}const zLt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function kbi(t,e=zLt){const i=new Array(12);for(let u=0;u<4;u++)for(let d=0;d<3;d++)i[3*u+d]=e[u][d];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],a=[0,0,1,0,1,1,0,1],o=[255,255,255,255],l=[["position",new ki(i,r,3,!0)],["normal",new ki(s,n,3,!0)],["uv0",new ki(a,r,2,!0)],["color",new ki(o,n,4,!0)]];return new Qc(t,l)}function NLt(t,e,i,r,s=!0,n=!0){let a=0;const o=e,l=t;let u=pr(0,a,0),d=pr(0,a+l,0),f=pr(0,-1,0),g=pr(0,1,0);r&&(a=l,d=pr(0,0,0),u=pr(0,a,0),f=pr(0,1,0),g=pr(0,-1,0));const v=[d,u],_=[f,g],x=i+2,S=Math.sqrt(l*l+o*o);if(r)for(let O=i-1;O>=0;O--){const D=O*(2*Math.PI/i),L=pr(Math.cos(D)*o,a,Math.sin(D)*o);v.push(L);const F=pr(l*Math.cos(D)/S,-o/S,l*Math.sin(D)/S);_.push(F)}else for(let O=0;O<i;O++){const D=O*(2*Math.PI/i),L=pr(Math.cos(D)*o,a,Math.sin(D)*o);v.push(L);const F=pr(l*Math.cos(D)/S,o/S,l*Math.sin(D)/S);_.push(F)}const T=new Array,M=new Array;if(s){for(let O=3;O<v.length;O++)T.push(1),T.push(O-1),T.push(O),M.push(0),M.push(0),M.push(0);T.push(v.length-1),T.push(2),T.push(1),M.push(0),M.push(0),M.push(0)}if(n){for(let O=3;O<v.length;O++)T.push(O),T.push(O-1),T.push(0),M.push(O),M.push(O-1),M.push(1);T.push(0),T.push(2),T.push(v.length-1),M.push(1),M.push(2),M.push(_.length-1)}const E=Jh(3*x);for(let O=0;O<x;O++)E[3*O]=v[O][0],E[3*O+1]=v[O][1],E[3*O+2]=v[O][2];const P=Jh(3*x);for(let O=0;O<x;O++)P[3*O]=_[O][0],P[3*O+1]=_[O][1],P[3*O+2]=_[O][2];return[["position",new ki(E,T,3,!0)],["normal",new ki(P,M,3,!0)]]}function H$e(t,e,i,r,s,n=!0,a=!0){return new Qc(t,NLt(e,i,r,s,n,a))}function VLt(t,e,i,r,s,n,a){const o=s?aae(s):pr(1,0,0),l=n?aae(n):pr(0,0,0);a??=!0;const u=Iu();Re(u,o);const d=Iu();he(d,u,Math.abs(e));const f=Iu();he(f,d,-.5),$e(f,f,l);const g=pr(0,1,0);Math.abs(1-Le(u,g))<.2&&xe(g,0,0,1);const v=Iu();At(v,u,g),Re(v,v),At(g,v,u);const _=2*r+(a?2:0),x=r+(a?2:0),S=Jh(3*_),T=Jh(3*x),M=Jh(2*_),E=new Array(3*r*(a?4:2)),P=new Array(3*r*(a?4:2));a&&(S[3*(_-2)]=f[0],S[3*(_-2)+1]=f[1],S[3*(_-2)+2]=f[2],M[2*(_-2)]=0,M[2*(_-2)+1]=0,S[3*(_-1)]=S[3*(_-2)]+d[0],S[3*(_-1)+1]=S[3*(_-2)+1]+d[1],S[3*(_-1)+2]=S[3*(_-2)+2]+d[2],M[2*(_-1)]=1,M[2*(_-1)+1]=1,T[3*(x-2)]=-u[0],T[3*(x-2)+1]=-u[1],T[3*(x-2)+2]=-u[2],T[3*(x-1)]=u[0],T[3*(x-1)+1]=u[1],T[3*(x-1)+2]=u[2]);const O=(N,B,U)=>{E[N]=B,P[N]=U};let D=0;const L=Iu(),F=Iu();for(let N=0;N<r;N++){const B=N*(2*Math.PI/r);he(L,g,Math.sin(B)),he(F,v,Math.cos(B)),$e(L,L,F),T[3*N]=L[0],T[3*N+1]=L[1],T[3*N+2]=L[2],he(L,L,i),$e(L,L,f),S[3*N]=L[0],S[3*N+1]=L[1],S[3*N+2]=L[2],M[2*N]=N/r,M[2*N+1]=0,S[3*(N+r)]=S[3*N]+d[0],S[3*(N+r)+1]=S[3*N+1]+d[1],S[3*(N+r)+2]=S[3*N+2]+d[2],M[2*(N+r)]=N/r,M[2*N+1]=1;const U=(N+1)%r;O(D++,N,N),O(D++,N+r,N),O(D++,U,U),O(D++,U,U),O(D++,N+r,N),O(D++,U+r,U)}if(a){for(let N=0;N<r;N++){const B=(N+1)%r;O(D++,_-2,x-2),O(D++,N,x-2),O(D++,B,x-2)}for(let N=0;N<r;N++){const B=(N+1)%r;O(D++,N+r,x-1),O(D++,_-1,x-1),O(D++,B+r,x-1)}}const j=[["position",new ki(S,E,3,!0)],["normal",new ki(T,P,3,!0)],["uv0",new ki(M,E,2,!0)]];return new Qc(t,j)}function Lbi(t,e,i,r,s,n){r=r||10,s=s==null||s,xt(e.length>1);const a=[[0,0,0]],o=[],l=[];for(let u=0;u<r;u++){o.push([0,-u-1,-(u+1)%r-1]);const d=u/r*2*Math.PI;l.push([Math.cos(d)*i,Math.sin(d)*i])}return jLt(t,l,e,a,o,s,n)}function jLt(t,e,i,r,s,n,a=pr(0,0,0)){const o=e.length,l=Jh(i.length*o*3+(6*r.length||0)),u=Jh(i.length*o*3+(r?6:0)),d=new Array,f=new Array;let g=0,v=0;const _=I(),x=I(),S=I(),T=I(),M=I(),E=I(),P=I(),O=I(),D=I(),L=I(),F=I(),j=I(),N=I(),B=Ui();xe(D,0,1,0),Ae(x,i[1],i[0]),Re(x,x),n?($e(O,i[0],a),Re(S,O)):xe(S,0,0,1),W$e(x,S,D,D,M,S,Z$e),me(T,S),me(j,M);for(let ee=0;ee<r.length;ee++)he(E,M,r[ee][0]),he(O,S,r[ee][2]),$e(E,E,O),$e(E,E,i[0]),l[g++]=E[0],l[g++]=E[1],l[g++]=E[2];u[v++]=-x[0],u[v++]=-x[1],u[v++]=-x[2];for(let ee=0;ee<s.length;ee++)d.push(s[ee][0]>0?s[ee][0]:-s[ee][0]-1+r.length),d.push(s[ee][1]>0?s[ee][1]:-s[ee][1]-1+r.length),d.push(s[ee][2]>0?s[ee][2]:-s[ee][2]-1+r.length),f.push(0),f.push(0),f.push(0);let U=r.length;const Q=r.length-1;for(let ee=0;ee<i.length;ee++){let _e=!1;ee>0&&(me(_,x),ee<i.length-1?(Ae(x,i[ee+1],i[ee]),Re(x,x)):_e=!0,$e(L,_,x),Re(L,L),$e(F,i[ee-1],T),Qg(i[ee],L,B),MP(B,um(F,_),O)?(Ae(O,O,i[ee]),Re(S,O),At(M,L,S),Re(M,M)):W$e(L,T,j,D,M,S,Z$e),me(T,S),me(j,M)),n&&($e(O,i[ee],a),Re(N,O));for(let Ne=0;Ne<o;Ne++)if(he(E,M,e[Ne][0]),he(O,S,e[Ne][1]),$e(E,E,O),Re(P,E),u[v++]=P[0],u[v++]=P[1],u[v++]=P[2],$e(E,E,i[ee]),l[g++]=E[0],l[g++]=E[1],l[g++]=E[2],!_e){const G=(Ne+1)%o;d.push(U+Ne),d.push(U+o+Ne),d.push(U+G),d.push(U+G),d.push(U+o+Ne),d.push(U+o+G);for(let le=0;le<6;le++){const de=d.length-6;f.push(d[de+le]-Q)}}U+=o}const H=i[i.length-1];for(let ee=0;ee<r.length;ee++)he(E,M,r[ee][0]),he(O,S,r[ee][1]),$e(E,E,O),$e(E,E,H),l[g++]=E[0],l[g++]=E[1],l[g++]=E[2];const J=v/3;u[v++]=x[0],u[v++]=x[1],u[v++]=x[2];const Z=U-o;for(let ee=0;ee<s.length;ee++)d.push(s[ee][0]>=0?U+s[ee][0]:-s[ee][0]-1+Z),d.push(s[ee][2]>=0?U+s[ee][2]:-s[ee][2]-1+Z),d.push(s[ee][1]>=0?U+s[ee][1]:-s[ee][1]-1+Z),f.push(J),f.push(J),f.push(J);const K=[["position",new ki(l,d,3,!0)],["normal",new ki(u,f,3,!0)]];return new Qc(t,K)}function Fbi(t,e,i,r,s){const n=q5(3*e.length),a=new Array(2*(e.length-1));let o=0,l=0;for(let d=0;d<e.length;d++){for(let f=0;f<3;f++)n[o++]=e[d][f];d>0&&(a[l++]=d-1,a[l++]=d)}const u=[["position",new ki(n,a,3,!0)]];if(i&&i.length===e.length&&i[0].length===3){const d=Jh(3*i.length);let f=0;for(let g=0;g<e.length;g++)for(let v=0;v<3;v++)d[f++]=i[g][v];u.push(["normal",new ki(d,a,3,!0)])}return r&&u.push(["color",new ki(r,IP(r.length/4),4)]),new Qc(t,u,null,2)}function zbi(t,e,i,r,s,n=0){const a=new Array(18),o=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let u=0;u<6;u++)a[3*u]=o[u][0],a[3*u+1]=o[u][1],a[3*u+2]=o[u][2];return new Qc(t,[["position",new ki(a,l,3,!0)]])}function Nbi(t,e){const i=t.getMutableAttribute("position").data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],a=i[r+2];xe(tM,s,n,a),Ft(tM,tM,e),i[r]=tM[0],i[r+1]=tM[1],i[r+2]=tM[2]}}function ULt(t,e=t){const i=t.attributes,r=i.get("position").data,s=i.get("normal").data;if(s){const n=e.getMutableAttribute("normal").data;for(let a=0;a<s.length;a+=3){const o=s[a+1];n[a+1]=-s[a+2],n[a+2]=o}}if(r){const n=e.getMutableAttribute("position").data;for(let a=0;a<r.length;a+=3){const o=r[a+1];n[a+1]=-r[a+2],n[a+2]=o}}}function EX(t,e,i,r,s){return!(Math.abs(Le(e,t))>s)&&(At(i,t,e),Re(i,i),At(r,i,t),Re(r,r),!0)}function W$e(t,e,i,r,s,n,a){return EX(t,e,s,n,a)||EX(t,i,s,n,a)||EX(t,r,s,n,a)}const Z$e=.99619469809,tM=I();let _pe=class{constructor(e){this.layerViewUid=e}},ZF=class extends _pe{constructor(e,i){super(e),this.graphicUid=i}},BLt=class extends ZF{constructor(e,i,r,s,n){super(e,i),this.layerViewUid=e,this.graphicUid=i,this.triangleNr=r,this.baseBoundingSphere=s,this.numLodLevels=n}};function bpe(t){return td(t)&&t.intersector===3&&!!t.target}let qLt=class{constructor(e,i,r,s){this.material=e,this.buffer=i,this.numVertices=r,this.boundingInfo=s,this.bufferWriter=e.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+fde}get renderGeometry(){return this}intersect(e,i,r,s,n,a,o,l){const u=this.bufferWriter,d=this.buffer;u.intersect(d,this.material.parameters,null,e,r,s,(f,g,v)=>gqe(f,g,v,e,i,a,o,n,l))}},GLt=class{constructor(e){this.engineGeometry=e;const i=this.material,r=this.engineGeometry,s=r.attributes,n=r.boundingInfo,a=i.createBufferWriter(),o=a.layout,l=a.elementCount(s),u=o.createBuffer(l);a.write(null,null,s,null,u,0),this.renderGeometry=new qLt(i,u.buffer,l,n)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,i)=>e+n$(i.data,i.indices),0)}intersect(e,i,r,s,n,a,o,l){const u=this.engineGeometry;this.material.intersect(u,e.transform.transform,e,r,s,(d,f,g)=>gqe(d,f,g,e,i,a,o,n,l))}};function gqe(t,e,i,r,s,n,a,o,l){if(t<0||s&&!s(r.rayBegin,r.rayEnd,t))return;const u=new BLt(n.layerViewUid,n.graphicUid(o),i,a,l);if((r.results.min.distance==null||t<r.results.min.distance)&&r.results.min.set(3,u,t,e,r.transform.transform),(r.results.max.distance==null||t>r.results.max.distance)&&r.results.max.set(3,u,t,e,r.transform.transform),r.options.store===2){const d=new kw(r.results.min.ray);d.set(3,u,t,e,r.transform.transform),r.results.all.push(d)}}let HLt=class{constructor(e,i=null){this.geometry=e,this.textures=i}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}},WLt=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=SS(this.components.map(n=>n.geometry));this.numVertices=s.reduce((n,a)=>n+a.numVertices,0)}},ZLt=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){const e=[];return this.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),SS(e)}getTextures(){const e=new Array;return this.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),SS(e)}getGeometries(){const e=new Array;return this.levels.forEach(i=>i.components.forEach(r=>{e.push(r.geometry)})),SS(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>e!=null)}computeUsedMemory(){const e=this.getGeometries(),i=this.getTextures(),r=e.reduce((s,n)=>s+n.computeUsedMemory(),0);return i.reduce((s,n)=>s+n.usedMemory,0)+r}};function Zbi(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function YLt(t,e){const i=(r,s,n=!1)=>new ZLt(r.map(a=>{const o=s(a.tesselation);return n&&ULt(o),new WLt([new HLt(new GLt(o))],a.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>FLt(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>ELt(e,1));case"cone":return i(AX,r=>H$e(e,1,.5,r,!1),!0);case"inverted-cone":return i(AX,r=>H$e(e,1,.5,r,!0),!0);case"cylinder":return i(AX,r=>VLt(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>LLt(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>RLt(e,1),!0);default:return}}const AX=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let Wd=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new yqe}},wpe=class extends Wd{constructor(e){super(e),this.estimated=!0}},JLt=class extends Wd{constructor(e,i){super(i),this.numComplexities=e}},QLt=class extends wpe{constructor(e,i){super(i),this.numComplexities=e}},yqe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function XLt(t){return t.type==="fill"}function KLt(t){return t.type==="extrude"}function eFt(t){return t&&t.enabled&&(KLt(t)||XLt(t))&&t.edges!=null}function tFt(t){return t&&t.enabled&&t.edges||null}function ewi(t,e){return iFt(tFt(t),e)}function iFt(t,e){if(t==null)return null;const i=t.color!=null?X5(Je.toUnitRGBA(t.color)):$i(0,0,0,0),r=d1(t.size),s=d1(t.extensionLength);switch(t.type){case"solid":return rFt({color:i,size:r,extensionLength:s,...e});case"sketch":return sFt({color:i,size:r,extensionLength:s,...e});default:return}}function rFt(t){return{...nFt,...t,type:0}}function sFt(t){return{...aFt,...t,type:1}}const nFt={color:$i(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:1,hasSlicePlane:!1},aFt={color:$i(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:1,hasSlicePlane:!1};let LH=class{constructor(e=0,i=!1,r=!0){this.tolerance=e,this.isVerticalRay=i,this.normalRequired=r}};const Pj=nc();function oFt(t,e,i,r,s,n){if(!t.visible)return;const a=xi(xqe,r,i),o=(d,f,g)=>n(d,g,f),{tolerance:l}=e,u=new LH(l,!1,e.options.normalRequired);if(t.boundingInfo)xt(t.type===0),vqe(t.boundingInfo,i,a,l,s,u,o);else{const d=t.positionAttribute,f=d.indices;bqe(i,a,0,f.length/3,f,d.data,d.stride,s,u,o)}}const lFt=I();function vqe(t,e,i,r,s,n,a){if(t==null)return;const o=_Ft(i,lFt);if(xLe(Pj,t.bbMin),SLe(Pj,t.bbMax),s?.applyToAabb(Pj),wqe(Pj,e,o,r)){const{primitiveIndices:l,position:u}=t,d=l?l.length:u.indices.length/3;if(d>bFt){const f=t.getChildren();if(f!==void 0){for(const g of f)vqe(g,e,i,r,s,n,a);return}}pFt(e,i,0,d,u.indices,u.data,u.stride,l,s,n,a)}}const Sw=I();function cFt(t,e,i,r,s,n,a,o,l){const{data:u,stride:d}=n;bqe(t,xi(xqe,e,t),i,r,s,u,d,a,o,l)}function iwi(t,e,i,r){if(!i.visible)return;const s=(l,u,d)=>r(l,d,u),{boundingInfo:n}=i;if(n){const{bbMin:l,bbMax:u}=n;if(t<l[0]||t>u[0]||e<l[1]||e>u[1])return}const a=i.positionAttribute,o=a.indices;uFt(t,e,0,o.length/3,o,a,s)}function uFt(t,e,i,r,s,n,a){const{data:o,stride:l}=n;for(let u=i;u<r;++u){const d=3*u,f=l*s[d],g=l*s[d+1],v=l*s[d+2],_=o[f+0]-t,x=o[f+1]-e,S=o[g+0]-t,T=o[g+1]-e,M=o[v+0]-t,E=o[v+1]-e,P=M*T-E*S,O=_*E-x*M,D=S*x-T*_;(P<0||O<0||D<0)&&(P>0||O>0||D>0)||a(0,u,null)}}function _qe(t,e,i,r,s,n,a,o,l,u=null,d=0){const f=t[0],g=t[1],v=t[2],_=e[0],x=e[1],S=e[2];for(let T=i;T<r;++T){const M=d+(u?u[T]:T),E=3*M,P=a*s[E],O=n[P],D=n[P+1],L=n[P+2],F=a*s[E+1],j=n[F],N=n[F+1],B=n[F+2],U=a*s[E+2],Q=j-O,H=N-D,J=B-L,Z=n[U]-O,K=n[U+1]-D,ee=n[U+2]-L,_e=x*ee-K*S,Ne=S*Z-ee*_,G=_*K-Z*x,le=Q*_e+H*Ne+J*G;if(Math.abs(le)<=zH)continue;const de=f-O,Se=g-D,je=v-L,Be=de*_e+Se*Ne+je*G;if(le>0){if(Be<0||Be>le)continue}else if(Be>0||Be<le)continue;const pt=Se*J-H*je,Dt=je*Q-J*de,at=de*H-Q*Se,Bt=_*pt+x*Dt+S*at;if(le>0){if(Bt<0||Be+Bt>le)continue}else if(Bt>0||Be+Bt<le)continue;const kt=(Z*pt+K*Dt+ee*at)/le;kt>=0&&l(kt,M,o?FH(Q,H,J,Z,K,ee,Sw):null)}}function hFt(t,e,i,r,s,n,a,o){const l=t[0],u=t[1],d=t[2],f=e[0],g=e[1],v=e[2];for(let _=i;_<r;++_){const x=3*_,S=x+1,T=x+2,M=n*x,E=s[M],P=s[M+1],O=s[M+2],D=n*S,L=n*T,F=s[D]-E,j=s[D+1]-P,N=s[D+2]-O,B=s[L]-E,U=s[L+1]-P,Q=s[L+2]-O,H=g*Q-U*v,J=v*B-Q*f,Z=f*U-B*g,K=F*H+j*J+N*Z;if(Math.abs(K)<=zH)continue;const ee=l-E,_e=u-P,Ne=d-O,G=ee*H+_e*J+Ne*Z;if(K>0){if(G<0||G>K)continue}else if(G>0||G<K)continue;const le=_e*N-j*Ne,de=Ne*F-N*ee,Se=ee*j-F*_e,je=f*le+g*de+v*Se;if(K>0){if(je<0||G+je>K)continue}else if(je>0||G+je<K)continue;const Be=(B*le+U*de+Q*Se)/K;Be>=0&&o(Be,_,a?FH(F,j,N,B,U,Q,Sw):null)}}function dFt(t,e,i,r,s,n,a,o,l,u,d,f=null,g=0){const v=t[0],_=t[1],x=t[2],S=e[0],T=e[1],M=e[2];for(let E=i;E<r;++E){const P=g+(f?f[E]:E),O=3*P,D=a*s[O],L=n[D],F=n[D+1],j=n[D+2],N=a*s[O+1],B=n[N],U=n[N+1],Q=n[N+2],H=a*s[O+2],J=n[H],Z=n[H+1],K=n[H+2],ee=j-l,_e=o/Math.sqrt(L*L+F*F+ee*ee),Ne=L+L*_e,G=F+F*_e,le=j+ee*_e,de=Q-l,Se=o/Math.sqrt(B*B+U*U+de*de),je=B+B*Se,Be=U+U*Se,pt=Q+de*Se,Dt=K-l,at=o/Math.sqrt(J*J+Z*Z+Dt*Dt),Bt=je-Ne,kt=Be-G,Lt=pt-le,Xt=J+J*at-Ne,Ge=Z+Z*at-G,Wt=K+Dt*at-le,Ze=T*Wt-Ge*M,We=M*Xt-Wt*S,St=S*Ge-Xt*T,vt=Bt*Ze+kt*We+Lt*St;if(Math.abs(vt)<=zH)continue;const Nt=v-Ne,tt=_-G,Qe=x-le,et=Nt*Ze+tt*We+Qe*St;if(vt>0){if(et<0||et>vt)continue}else if(et>0||et<vt)continue;const ht=tt*Lt-kt*Qe,ri=Qe*Bt-Lt*Nt,Wi=Nt*kt-Bt*tt,zi=S*ht+T*ri+M*Wi;if(vt>0){if(zi<0||et+zi>vt)continue}else if(zi>0||et+zi<vt)continue;const ci=(Xt*ht+Ge*ri+Wt*Wi)/vt;ci>=0&&d(ci,P,u?FH(Bt,kt,Lt,Xt,Ge,Wt,Sw):null)}}function pFt(t,e,i,r,s,n,a,o,l,u,d){const f=t[0],g=t[1],v=t[2],_=e[0],x=e[1],S=e[2],{normalRequired:T}=u;for(let M=i;M<r;++M){const E=o[M],P=3*E,O=a*s[P];let D=n[O],L=n[O+1],F=n[O+2];const j=a*s[P+1];let N=n[j],B=n[j+1],U=n[j+2];const Q=a*s[P+2];let H=n[Q],J=n[Q+1],Z=n[Q+2];l!=null&&([D,L,F]=l.applyToVertex(D,L,F,M),[N,B,U]=l.applyToVertex(N,B,U,M),[H,J,Z]=l.applyToVertex(H,J,Z,M));const K=N-D,ee=B-L,_e=U-F,Ne=H-D,G=J-L,le=Z-F,de=x*le-G*S,Se=S*Ne-le*_,je=_*G-Ne*x,Be=K*de+ee*Se+_e*je;if(Math.abs(Be)<=zH)continue;const pt=f-D,Dt=g-L,at=v-F,Bt=pt*de+Dt*Se+at*je;if(Be>0){if(Bt<0||Bt>Be)continue}else if(Bt>0||Bt<Be)continue;const kt=Dt*_e-ee*at,Lt=at*K-_e*pt,Xt=pt*ee-K*Dt,Ge=_*kt+x*Lt+S*Xt;if(Be>0){if(Ge<0||Bt+Ge>Be)continue}else if(Ge>0||Bt+Ge<Be)continue;const Wt=(Ne*kt+G*Lt+le*Xt)/Be;Wt>=0&&d(Wt,E,T?FH(K,ee,_e,Ne,G,le,Sw):null)}}function bqe(t,e,i,r,s,n,a,o,l,u){const d=e,f=wFt,g=Math.abs(d[0]),v=Math.abs(d[1]),_=Math.abs(d[2]),x=g>=v?g>=_?0:2:v>=_?1:2,S=x,T=d[S]<0?2:1,M=(x+T)%3,E=(x+(3-T))%3,P=d[M]/d[S],O=d[E]/d[S],D=1/d[S],L=fFt,F=mFt,j=gFt,{normalRequired:N}=l;for(let B=i;B<r;++B){const U=3*B,Q=a*s[U];xe(f[0],n[Q+0],n[Q+1],n[Q+2]);const H=a*s[U+1];xe(f[1],n[H+0],n[H+1],n[H+2]);const J=a*s[U+2];xe(f[2],n[J+0],n[J+1],n[J+2]),o&&(me(f[0],o.applyToVertex(f[0][0],f[0][1],f[0][2],B)),me(f[1],o.applyToVertex(f[1][0],f[1][1],f[1][2],B)),me(f[2],o.applyToVertex(f[2][0],f[2][1],f[2][2],B))),xi(L,f[0],t),xi(F,f[1],t),xi(j,f[2],t);const Z=L[M]-P*L[S],K=L[E]-O*L[S],ee=F[M]-P*F[S],_e=F[E]-O*F[S],Ne=j[M]-P*j[S],G=j[E]-O*j[S],le=Ne*_e-G*ee,de=Z*G-K*Ne,Se=ee*K-_e*Z;if((le<0||de<0||Se<0)&&(le>0||de>0||Se>0))continue;const je=le+de+Se;if(je===0)continue;const Be=le*(D*L[S])+de*(D*F[S])+Se*(D*j[S]);if(Be*Math.sign(je)<0)continue;const pt=Be/je;pt>=0&&u(pt,B,N?yFt(f):null)}}const fFt=I(),mFt=I(),gFt=I();function FH(t,e,i,r,s,n,a){return xe(NG,t,e,i),xe(VG,r,s,n),At(a,NG,VG),Re(a,a),a}function yFt(t){return xi(NG,t[1],t[0]),xi(VG,t[2],t[0]),At(Sw,NG,VG),Re(Sw,Sw),Sw}const NG=I(),VG=I();function vFt(t,e,i){return xe(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function _Ft(t,e){return xe(e,1/t[0],1/t[1],1/t[2])}function wqe(t,e,i,r){return xpe(t,e,i,r,1/0)}function xpe(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],a=(t[3]+r-e[0])*i[0];let o=Math.min(n,a),l=Math.max(n,a);const u=(t[1]-r-e[1])*i[1],d=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(u,d)),l<0||(o=Math.max(o,Math.min(u,d)),o>l))return!1;const f=(t[2]-r-e[2])*i[2],g=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(f,g)),!(l<0)&&(o=Math.max(o,Math.min(f,g)),!(o>l)&&o<s)}const bFt=1e3,zH=1e-7,xqe=I(),wFt=[I(),I(),I()];let xFt=class{constructor(e){this.layout=e}elementCount(e){return e.get("position").indices.length}write(e,i,r,s,n,a){return j4t(r,s,this.layout,e,i,n,a)}intersect(e,i,r,s,n,a,o){const l=this.layout.createView(e).getField("position",Fw);if(l==null)return;const u=xi(SFt,a,n),d=0,f=l.count/3,g=s.options.normalRequired,v=(_,x,S)=>o(_,S,x);hFt(n,u,d,f,l.typedBuffer,l.typedBufferStride,g,v)}};const SFt=I();function YF(t,e){switch(t.fragment.code.add(A`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`),e.normalType){case 1:t.attributes.add("normalCompressed","vec2"),t.vertex.code.add(A`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case 0:t.attributes.add("normal","vec3"),t.vertex.code.add(A`vec3 normalModel() {
return normal;
}`);break;default:e.normalType;case 2:case 3:}}function Sqe({code:t,uniforms:e},i){e.add(new Vs("dpDummy",()=>1)),t.add(A`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 hiD = hiA + hiB;
vec3 loD = loA + loB;
return  dpDummy * hiD + loD;
}`)}let Tqe=class extends Ki{constructor(e,i,r){super(e,"mat3",2,(s,n,a)=>s.setUniformMatrix3fv(e,i(n,a),r))}},Spe=class extends Ki{constructor(e,i,r){super(e,"mat4",1,(s,n,a)=>s.setUniformMatrix4fv(e,i(n,a),r))}};function t5(t,e){const{attributes:i,vertex:r,varyings:s,fragment:n}=t;r.include(Sqe,e),i.add("position","vec3"),s.add("vPositionWorldCameraRelative","vec3"),s.add("vPosition_view","vec3",{invariant:!0}),r.uniforms.add(new Pr("transformWorldFromViewTH",a=>a.transformWorldFromViewTH),new Pr("transformWorldFromViewTL",a=>a.transformWorldFromViewTL),new _m("transformViewFromCameraRelativeRS",a=>a.transformViewFromCameraRelativeRS),new Spe("transformProjFromView",a=>a.transformProjFromView),new Tqe("transformWorldFromModelRS",a=>a.transformWorldFromModelRS),new yp("transformWorldFromModelTH",a=>a.transformWorldFromModelTH),new yp("transformWorldFromModelTL",a=>a.transformWorldFromModelTL)),r.code.add(A`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(A`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?A`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:A`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),n.uniforms.add(new Pr("transformWorldFromViewTL",a=>a.transformWorldFromViewTL)),r.code.add(A`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),n.code.add(A`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let TFt=class extends $r{constructor(){super(...arguments),this.transformWorldFromViewTH=I(),this.transformWorldFromViewTL=I(),this.transformViewFromCameraRelativeRS=Jr(),this.transformProjFromView=ut()}},$Ft=class extends $r{constructor(){super(...arguments),this.transformWorldFromModelRS=Jr(),this.transformWorldFromModelTH=I(),this.transformWorldFromModelTL=I()}};function NH(t,e){switch(e.normalType){case 0:case 1:t.include(YF,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new Tqe("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new _m("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)).code.add(A`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case 2:t.vertex.code.add(A`void forwardNormal() {}`);break;default:e.normalType;case 3:}}let $qe=class extends TFt{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Jr()}},Cqe=class extends $Ft{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Jr(),this.toMapSpace=li()}};const Y$e={func:513},J$e={func:519},jG={mask:255},CFt={mask:0},MFt=t=>({function:{func:517,ref:t,mask:t},operation:{fail:7680,zFail:7680,zPass:7680}}),EFt=t=>({function:{func:519,ref:t,mask:t},operation:{fail:7680,zFail:7680,zPass:7681}}),Tpe={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},Hae={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},AFt={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},OFt={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};let PFt=class{constructor(e,i,r){this.elementSize=i.stride,this._buffer=new vn(e,bl(i,1)),this.resize(r)}destroy(){this._buffer.dispose()}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this.elementSize,s=i*this.elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this.elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this.elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},Q$e=class{constructor(e){this.localTransform=e.localTransform,this.globalTransform=e.globalTransform,this.modelOrigin=e.modelOrigin,this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelScaleFactors=e.modelScaleFactors,this.boundingSphere=e.boundingSphere,this.featureAttribute=e.getField("instanceFeatureAttribute",o$),this.color=e.getField("instanceColor",rd),this.olidColor=e.getField("instanceOlidColor",rd),this.state=e.getField("state",bG),this.lodLevel=e.getField("lodLevel",bG)}},II=class extends be{constructor(e,i){super(e),this.events=new gm,this._capacity=0,this._size=0,this._next=0,this._highlightOptionsMap=new Map,this._highlightOptionsMapPrev=new Map,this._layout=DFt(i),this._capacity=UG,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Q$e(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,1),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;xt(e>=0&&e<this._capacity&&!!(1&i.get(e)),"invalid instance handle"),this._getStateFlag(e,18)?this._setStateFlags(e,32):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;xt(e>=0&&e<this._capacity&&!!(1&i.get(e)),"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=ou,s=Kp;i.localTransform.getMat(e,X$e),i.globalTransform.getMat(e,OX);const n=Cn(OX,OX,X$e);xe(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),P1(s,n),i.model.setMat(e,s);const a=S3t(ou,n);a.sort(),i.modelScaleFactors.set(e,0,a[1]),i.modelScaleFactors.set(e,1,a[2]),_$(s,s),R1(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,64),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,Kp),r.modelOrigin.getVec(e,ou),i[0]=Kp[0],i[1]=Kp[1],i[2]=Kp[2],i[3]=0,i[4]=Kp[3],i[5]=Kp[4],i[6]=Kp[5],i[7]=0,i[8]=Kp[6],i[9]=Kp[7],i[10]=Kp[8],i[11]=0,i[12]=ou[0],i[13]=ou[1],i[14]=ou[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ou,this,e),i*=Math.max(ou[0],ou[1],ou[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ou,this,e),i*=RFt(ou[0],ou[1],ou[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute?.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute?.getVec(e,i)}setColor(e,i){this._view.color?.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.olidColor?.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,4,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,4)}setHighlight(e,i){const{_highlightOptionsMap:r}=this,s=r.get(e);i?i!==s&&(r.set(e,i),this._setStateFlag(e,8,!0),this.events.emit("instance-highlight-changed")):s&&(r.delete(e),this._setStateFlag(e,8,!1),this.events.emit("instance-highlight-changed"))}get highlightOptionsMap(){return this._highlightOptionsMap}getHighlightStateFlag(e){return this._getStateFlag(e,8)}geHighlightOptionsPrev(e){const i=this._highlightOptionsMapPrev.get(e)??null;return this._highlightOptionsMapPrev.delete(e),i}getHighlightName(e){const i=this.highlightOptionsMap.get(e)??null;return i?this._highlightOptionsMapPrev.set(e,i):this._highlightOptionsMapPrev.delete(e),i}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(UG,Math.floor(this._capacity*B9)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Q$e(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;1&e.get(i);)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function RFt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}c([p({constructOnly:!0})],II.prototype,"shaderTransformation",void 0),c([p()],II.prototype,"_size",void 0),c([p({readOnly:!0})],II.prototype,"size",null),II=c([R("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],II);const IFt=Qu().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("instanceModel").mat3f("instanceModelNormal").vec2f("modelScaleFactors");function DFt(t){return Mqe(IFt.clone(),t).u8("state").u8("lodLevel")}function Mqe(t,e){return e.instancedFeatureAttribute&&t.vec4f("instanceFeatureAttribute"),e.instancedColor&&t.vec4u8("instanceColor"),Ep()&&t.vec4u8("instanceOlidColor"),t}const ou=I(),Kp=Jr(),X$e=ut(),OX=ut(),UG=64;let kFt=class{constructor(e){this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelOriginHi=e.instanceModelOriginHi,this.modelOriginLo=e.instanceModelOriginLo,this.featureAttribute=e.getField("instanceFeatureAttribute",o$),this.color=e.getField("instanceColor",rd),this.olidColor=e.getField("instanceOlidColor",rd)}},fwi=class{constructor(e,i){this._rctx=e,this._layout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){xt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){xt(this._updating,"not updating"),this.size<Pet*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){xt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),xt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){xt(this._updating,"not updating"),xt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(UG,Math.floor(this._capacity*B9));this._resize(e)}_shrink(){const e=Math.max(UG,Math.floor(this._capacity*Oet));this._resize(e)}_resize(e){if(xt(this._updating,"not updating"),e===this._capacity)return;const i=new PFt(this._rctx,this._layout,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);xt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new kFt(this._layout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const LFt=Qu().vec3f("instanceModelOriginHi").vec3f("instanceModelOriginLo").mat3f("instanceModel").mat3f("instanceModelNormal");function FFt(t){return Mqe(LFt.clone(),t)}function gwi({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:a}){return t==null&&e==null&&s==null&&(n==null||di(n,Aa))&&a==null&&(r==null||r===1)&&(i==null||i===1)}function ywi({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:a}){return t==null&&e==null&&s==null&&(n==null||di(n,Aa))&&a==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const Eqe=l1(1,1,.5),vwi=l1(0,.6,.2),_wi=l1(0,1,.2);function Aqe(t){t.vertex.code.add(A`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function Oqe(t){t.varyings.add("linearDepth","float",{invariant:!0})}function Pqe(t,e){Oqe(t),t.vertex.code.add(A`
    void forwardLinearDepth(float _linearDepth) { ${we(e,"linearDepth = _linearDepth;")} }
  `)}function $pe(t){t.vertex.uniforms.add(new Z0("nearFar",e=>e.camera.nearFar))}function Rqe(t){t.vertex.code.add(A`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function zFt(t,e){const{vertex:i}=t,r=G4(e.output);r&&(t.include(t5,e),Pqe(t,!0),$pe(t),Rqe(t)),i.code.add(A`
    void forwardLinearDepthToWriteShadowMap() {
      ${we(r,"forwardLinearDepth(calculateLinearDepth(nearFar, vPosition_view.z));")}
    }
  `)}function Tw(t){Rqe(t),t.vertex.code.add(A`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(A`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}function Iqe(t,e){e.instancedColor?(t.attributes.add("instanceColor","vec4"),t.vertex.include(B1),t.vertex.include(V8e),t.vertex.include(dpe),t.vertex.code.add(A`
      MaskedColor applyInstanceColor(MaskedColor color) {
        return multiplyMaskedColors( color, createMaskedFromUInt8NaNColor(${"instanceColor"}));
      }
    `)):t.vertex.code.add(A`MaskedColor applyInstanceColor(MaskedColor color) {
return color;
}`)}function NFt(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function VFt(t,e){const i=t.length;for(let r=0;r<i;++r)wE[0]=t[r],e[r]=wE[0];return e}function jFt(t,e){const i=t.length;for(let r=0;r<i;++r)wE[0]=t[r],wE[1]=t[r]-wE[0],e[r]=wE[1];return e}const wE=new Float32Array(2),K$e=Jr();function Dqe(t,e){const{hasModelTransformation:i,instancedDoublePrecision:r,instanced:s,output:n,hasVertexTangents:a}=e;i&&(t.vertex.uniforms.add(new Spe("model",l=>l.modelTransformation??gl)),t.vertex.uniforms.add(new _m("normalLocalOriginFromModel",l=>(RIe(K$e,l.modelTransformation??gl),K$e)))),s&&r&&(t.attributes.add("instanceModelOriginHi","vec3"),t.attributes.add("instanceModelOriginLo","vec3"),t.attributes.add("instanceModel","mat3"),t.attributes.add("instanceModelNormal","mat3"));const o=t.vertex;r&&(o.include(Sqe,e),o.uniforms.add(new Zo("viewOriginHi",l=>VFt(xe(Rj,l.camera.viewInverseTransposeMatrix[3],l.camera.viewInverseTransposeMatrix[7],l.camera.viewInverseTransposeMatrix[11]),Rj)),new Zo("viewOriginLo",l=>jFt(xe(Rj,l.camera.viewInverseTransposeMatrix[3],l.camera.viewInverseTransposeMatrix[7],l.camera.viewInverseTransposeMatrix[11]),Rj)))),o.code.add(A`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?A`
          // Issue: (should be resolved now with invariant position) https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -instanceModelOriginHi, -instanceModelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),o.code.add(A`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),n===3&&(spe(o),o.code.add(A`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),a&&o.code.add(A`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const Rj=I();let q1=class extends Ki{constructor(e,i){super(e,"int",1,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function kqe(t,e){t.varyings.add("colorMixMode","int"),t.varyings.add("opacityMixMode","int"),t.vertex.uniforms.add(new q1("symbolColorMixMode",i=>X4[i.colorMixMode])),e.hasSymbolColors?(t.vertex.include(B1),t.vertex.include(V8e),t.vertex.include(dpe),t.attributes.add("symbolColor","vec4"),t.vertex.code.add(A`
    MaskedColor applySymbolColor(MaskedColor color) {
      return multiplyMaskedColors(color, createMaskedFromUInt8NaNColor(${"symbolColor"}));
    }
  `)):t.vertex.code.add(A`MaskedColor applySymbolColor(MaskedColor color) {
return color;
}`),t.vertex.code.add(A`
    void forwardColorMixMode(bvec4 mask) {
      colorMixMode = mask.r ? ${A.int(X4.ignore)} : symbolColorMixMode;
      opacityMixMode = mask.a ? ${A.int(X4.ignore)} : symbolColorMixMode;
    }
  `)}function h0(t,e){switch(e.textureCoordinateType){case 1:return t.attributes.add("uv0","vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(A`void forwardTextureCoordinates() { vuv0 = uv0; }`);case 2:return t.attributes.add("uv0","vec2"),t.attributes.add("uvRegion","vec4"),t.varyings.add("vuv0","vec2"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(A`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case 0:return void t.vertex.code.add(A`void forwardTextureCoordinates() {}`);case 3:return}}function VH(t,e){e.hasVertexColors?(t.attributes.add("color","vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(A`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(A`
      void forwardNormalizedVertexColor() { vColor = color * ${A.float(1/255)}; }
    `)):t.vertex.code.add(A`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Cpe(t,e){switch(e.output){case 4:case 5:case 6:case 7:t.fragment.code.add(A`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth){
float fragDepth = _calculateFragDepth(_linearDepth);
gl_FragDepth = fragDepth;
}`);break;case 8:t.fragment.code.add(A`void outputDepth(float _linearDepth){
gl_FragDepth = _linearDepth;
}`)}}let jH=class extends Ki{constructor(e,i,r){super(e,"float",2,(s,n,a)=>s.setUniform1f(e,i(n,a),r))}};function xE(t,e){Lqe(t,e,new _t("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function UFt(t,e){Lqe(t,e,new jH("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Lqe(t,e,i){const r=t.fragment,s=e.alphaDiscardMode,n=s===0;s!==2&&s!==3||r.uniforms.add(i),r.code.add(A`
    void discardOrAdjustAlpha(inout vec4 color) {
      ${s===1?"color.a = 1.0;":`if (color.a < ${n?A.float(ls):"textureAlphaCutoff"}) {
              discard;
             } ${we(s===2,"else { color.a = 1.0; }")}`}
    }
  `)}function Fqe(t,e){const{vertex:i,fragment:r,varyings:s}=t,{hasColorTexture:n,alphaDiscardMode:a}=e,o=n&&a!==1,{output:l,normalType:u,hasColorTextureTransform:d}=e;switch(l){case 2:u0(i,e),t.include(Tw),r.include(xw,e),t.include(h0,e),o&&r.uniforms.add(new Gt("tex",f=>f.texture)),i.main.add(A`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),t.include(xE,e),r.main.add(A`
        discardBySlice(vpos);
        ${we(o,A`vec4 texColor = texture(tex, ${d?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}`);break;case 4:case 5:case 6:case 7:case 10:u0(i,e),t.include(Tw),t.include(h0,e),t.include(jS,e),t.include(Cpe,e),r.include(xw,e),t.include(upe,e),$pe(t),s.add("depth","float",{invariant:!0}),o&&r.uniforms.add(new Gt("tex",f=>f.texture)),i.main.add(A`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),t.include(xE,e),r.main.add(A`
        discardBySlice(vpos);
        ${we(o,A`vec4 texColor = texture(tex, ${d?"colorUV":"vuv0"});
               discardOrAdjustAlpha(texColor);`)}
        ${l===10?A`outputObjectAndLayerIdColor();`:A`outputDepth(depth);`}`);break;case 3:{u0(i,e),t.include(Tw),t.include(YF,e),t.include(NH,e),t.include(h0,e),t.include(jS,e),o&&r.uniforms.add(new Gt("tex",g=>g.texture)),u===2&&s.add("vPositionView","vec3",{invariant:!0});const f=u===0||u===1;i.main.add(A`
        vpos = getVertexInLocalOriginSpace();
        ${f?A`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:A`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();`),r.include(xw,e),t.include(xE,e),r.main.add(A`
        discardBySlice(vpos);
        ${we(o,A`vec4 texColor = texture(tex, ${d?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}

        ${u===2?A`vec3 normal = screenDerivativeNormal(vPositionView);`:A`vec3 normal = normalize(vNormalWorld);
                    if (gl_FrontFacing == false){
                      normal = -normal;
                    }`}
        fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case 9:u0(i,e),t.include(Tw),t.include(h0,e),t.include(jS,e),o&&r.uniforms.add(new Gt("tex",f=>f.texture)),i.main.add(A`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),r.include(xw,e),t.include(xE,e),t.include(FP,e),r.main.add(A`
        discardBySlice(vpos);
        ${we(o,A`vec4 texColor = texture(tex, ${d?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        calculateOcclusionAndOutputHighlight();`)}}function BFt(t){t.fragment.code.add(A`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function UH(t,e){const{textureCoordinateType:i}=e;if(i===0||i===3)return;t.include(h0,e);const r=i===2;r&&t.include(BFt),t.fragment.code.add(A`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${r?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}let S1=class extends Ki{constructor(e,i){super(e,"sampler2D",2,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function zqe(t,e){const i=t.fragment,{hasVertexTangents:r,doubleSidedMode:s,hasNormalTexture:n,textureCoordinateType:a,bindType:o,hasNormalTextureTransform:l}=e;r?(t.attributes.add("tangent","vec4"),t.varyings.add("vTangent","vec4"),s===2?i.code.add(A`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(A`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(A`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),n&&a!==0&&(t.include(UH,e),i.uniforms.add(o===1?new Gt("normalTexture",u=>u.textureNormal):new S1("normalTexture",u=>u.textureNormal)),l&&(i.uniforms.add(new rc("scale",u=>u.scale??gFe)),i.uniforms.add(new _m("normalTextureTransformMatrix",u=>u.normalTextureTransformMatrix??b$))),i.code.add(A`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),l&&i.code.add(A`mat3 normalRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(A`return tangentSpace * rawNormal;
}`))}const Nqe=3e5,BG=5e5;let Mpe=class extends Ki{constructor(e,i,r){super(e,"vec2",2,(s,n,a,o)=>s.setUniform2fv(e,i(n,a,o),r))}};const PX=4;function Vqe(){const t=new Gi,e=t.fragment;t.include(no);const i=(PX+1)/2,r=1/(2*i*i);return e.include(Ip),e.uniforms.add(new Gt("depthMap",s=>s.depthTexture),new S1("tex",s=>s.colorTexture),new Mpe("blurSize",s=>s.blurSize),new _t("projScale",(s,n)=>{const a=n.camera.distance;return a>5e4?Math.max(0,s.projScale-(a-5e4)):s.projScale})),e.code.add(A`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${A.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.main.add(A`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${A.int(PX)}; r <= ${A.int(PX)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),t}const qFt=Object.freeze(Object.defineProperty({__proto__:null,build:Vqe},Symbol.toStringTag,{value:"Module"}));let eCe=class extends er{constructor(e,i){super(e,i,new Hi(qFt,()=>W(()=>Promise.resolve().then(()=>dri),void 0)),wn)}initializePipeline(){return _i({colorWrite:Fi})}};const GFt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let HFt=class extends $r{constructor(){super(...arguments),this.projScale=1}},WFt=class extends HFt{constructor(){super(...arguments),this.intensity=1}},ZFt=class extends $r{},YFt=class extends ZFt{constructor(){super(...arguments),this.blurSize=Ke()}};function BH(t){t.fragment.uniforms.add(new Go("projInfo",e=>JFt(e.camera))),t.fragment.uniforms.add(new Z0("zScale",e=>QFt(e.camera))),t.fragment.code.add(A`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function JFt(t){const e=t.projectionMatrix;return e[11]===0?Or(tCe,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Or(tCe,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const tCe=li();function QFt(t){return t.projectionMatrix[11]===0?oi(iCe,0,1):oi(iCe,1,0)}const iCe=Ke(),rCe=16;function jqe(){const t=new Gi,e=t.fragment;return t.include(no),t.include(BH),e.include(Ip),e.uniforms.add(new Vs("radius",i=>qH(i.camera))).code.add(A`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(A`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.outputs.add("fragOcclusion","float"),e.uniforms.add(new Gt("normalMap",i=>i.normalTexture),new Gt("depthMap",i=>i.depthTexture),new _t("projScale",i=>i.projScale),new Gt("rnm",i=>i.noiseTexture),new rc("rnmScale",(i,r)=>oi(sCe,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new _t("intensity",i=>i.intensity),new Z0("screenSize",i=>oi(sCe,i.camera.fullWidth,i.camera.fullHeight))).main.add(A`
    float depth = depthFromTexture(depthMap, uv);

    // Early out if depth is out of range, such as in the sky
    if (depth >= 1.0 || depth <= 0.0) {
      fragOcclusion = 1.0;
      return;
    }

    // get the normal of current fragment
    ivec2 iuv = ivec2(uv * vec2(textureSize(normalMap, 0)));
    vec4 norm4 = texelFetch(normalMap, iuv, 0);
    if(norm4.a != 1.0) {
      fragOcclusion = 1.0;
      return;
    }
    vec3 norm = normalize(norm4.xyz * 2.0 - 1.0);

    float currentPixelDepth = linearizeDepth(depth);
    vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

    float sum = 0.0;
    vec3 tapPixelPos;

    vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

    // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
    // bug or deviation from CE somewhere else?
    float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

    for(int i = 0; i < ${A.int(rCe)}; ++i) {
      vec2 unitOffset = reflect(sphere[i], fres).xy;
      vec2 offset = vec2(-unitOffset * radius * ps);

      // don't use current or very nearby samples
      if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
        continue;
      }

      vec2 tc = vec2(gl_FragCoord.xy + offset);
      if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
      vec2 tcTap = tc / screenSize;
      float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

      tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

      sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
    }

    // output the result
    float A = max(1.0 - sum * intensity / float(${A.int(rCe)}), 0.0);

    // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
    A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

    fragOcclusion = A;
  `),t}function qH(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const sCe=Ke(),XFt=Object.freeze(Object.defineProperty({__proto__:null,build:jqe,getRadius:qH},Symbol.toStringTag,{value:"Module"}));let nCe=class extends er{constructor(e,i){super(e,i,new Hi(XFt,()=>W(()=>Promise.resolve().then(()=>pri),void 0)),wn)}initializePipeline(){return _i({colorWrite:Fi})}};const Ok=2;let F3=class extends Nc{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=wt.SSAO,this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new WFt,this._drawParameters=new YFt}initialize(){const e=Uint8Array.from(atob(GFt),r=>r.charCodeAt(0)),i=new ar(32);i.wrapMode=33071,i.pixelFormat=6407,i.wrapMode=10497,i.hasMipmap=!0,this._passParameters.noiseTexture=new qi(this.renderingContext,i,e),this.techniques.precompile(nCe),this.techniques.precompile(eCe),this.addHandles(X(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=jt(this._passParameters.noiseTexture)}render(e){const i=e.find(({name:D})=>D==="normals"),r=i?.getTexture(),s=i?.getTexture(To);if(!r||!s)return;const n=this.techniques.get(nCe),a=this.techniques.get(eCe);if(!n.compiled||!a.compiled)return this._enableTime=performance.now(),void this.requestRender(1);this._enableTime===0&&(this._enableTime=performance.now());const o=this.renderingContext,l=this.view.qualitySettings.fadeDuration,u=this.bindParameters,d=u.camera,f=d.relativeElevation,g=Ce((BG-f)/(BG-Nqe),0,1),v=l>0?Math.min(l,performance.now()-this._enableTime)/l:1,_=v*g;this._passParameters.normalTexture=r,this._passParameters.depthTexture=s,this._passParameters.projScale=1/d.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*KFt/qH(d)**6*_;const x=d.fullViewport[2],S=d.fullViewport[3],T=this.fboCache.acquire(x,S,"ssao input",2);o.bindFramebuffer(T.fbo),o.setViewport(0,0,x,S),o.bindTechnique(n,u,this._passParameters,this._drawParameters),o.screen.draw();const M=Math.round(x/Ok),E=Math.round(S/Ok),P=this.fboCache.acquire(M,E,"ssao blur",0);o.bindFramebuffer(P.fbo),this._drawParameters.colorTexture=T.getTexture(),oi(this._drawParameters.blurSize,0,Ok/S),o.bindTechnique(a,u,this._passParameters,this._drawParameters),o.setViewport(0,0,M,E),o.screen.draw(),T.release();const O=this.fboCache.acquire(M,E,wt.SSAO,0);return o.bindFramebuffer(O.fbo),o.setViewport(0,0,x,S),o.setClearColor(1,1,1,0),o.clear(16384),this._drawParameters.colorTexture=P.getTexture(),oi(this._drawParameters.blurSize,Ok/x,0),o.bindTechnique(a,u,this._passParameters,this._drawParameters),o.setViewport(0,0,M,E),o.screen.draw(),o.setViewport4fv(d.fullViewport),P.release(),v<1&&this.requestRender(2),O}};c([p()],F3.prototype,"consumes",void 0),c([p()],F3.prototype,"produces",void 0),c([p({constructOnly:!0})],F3.prototype,"isEnabled",void 0),F3=c([R("esri.views.3d.webgl-engine.effects.ssao.SSAO")],F3);const KFt=.5;function GH(t,e){e.receiveAmbientOcclusion?(t.uniforms.add(new Jo("ssaoTex",i=>i.ssao?.getTexture())),t.constants.add("blurSizePixelsInverse","float",1/Ok),t.code.add(A`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):t.code.add(A`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function Uqe(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Zo("lightingAmbientSH0",({lighting:s})=>xe(aCe,s.sh.r[0],s.sh.g[0],s.sh.b[0]))),i.code.add(A`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new Go("lightingAmbientSH_R",({lighting:s})=>Or(Ny,s.sh.r[0],s.sh.r[1],s.sh.r[2],s.sh.r[3])),new Go("lightingAmbientSH_G",({lighting:s})=>Or(Ny,s.sh.g[0],s.sh.g[1],s.sh.g[2],s.sh.g[3])),new Go("lightingAmbientSH_B",({lighting:s})=>Or(Ny,s.sh.b[0],s.sh.b[1],s.sh.b[2],s.sh.b[3]))),i.code.add(A`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new Zo("lightingAmbientSH0",({lighting:s})=>xe(aCe,s.sh.r[0],s.sh.g[0],s.sh.b[0])),new Go("lightingAmbientSH_R1",({lighting:s})=>Or(Ny,s.sh.r[1],s.sh.r[2],s.sh.r[3],s.sh.r[4])),new Go("lightingAmbientSH_G1",({lighting:s})=>Or(Ny,s.sh.g[1],s.sh.g[2],s.sh.g[3],s.sh.g[4])),new Go("lightingAmbientSH_B1",({lighting:s})=>Or(Ny,s.sh.b[1],s.sh.b[2],s.sh.b[3],s.sh.b[4])),new Go("lightingAmbientSH_R2",({lighting:s})=>Or(Ny,s.sh.r[5],s.sh.r[6],s.sh.r[7],s.sh.r[8])),new Go("lightingAmbientSH_G2",({lighting:s})=>Or(Ny,s.sh.g[5],s.sh.g[6],s.sh.g[7],s.sh.g[8])),new Go("lightingAmbientSH_B2",({lighting:s})=>Or(Ny,s.sh.b[5],s.sh.b[6],s.sh.b[7],s.sh.b[8]))),i.code.add(A`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==1&&e.pbrMode!==2||i.code.add(A`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const aCe=I(),Ny=li();function dm(t){t.uniforms.add(new Zo("mainLightDirection",e=>e.lighting.mainLight.direction))}function Y0(t){t.uniforms.add(new Zo("mainLightIntensity",e=>e.lighting.mainLight.intensity))}function ezt(t){dm(t.fragment),Y0(t.fragment),t.fragment.code.add(A`vec3 applyShading(vec3 shadingNormal, float shadow) {
float dotVal = clamp(dot(shadingNormal, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}function tzt(t){t.code.add(A`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG) {
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.code.add(A`float integratedRadiance(float cosTheta2, float roughness) {
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.code.add(A`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness) {
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function JF(t){const e=3.141592653589793,i=.3183098861837907;t.constants.add("PI","float",e),t.constants.add("LIGHT_NORMALIZATION","float",i),t.constants.add("INV_PI","float",i),t.constants.add("HALF_PI","float",1.570796326794897),t.constants.add("TWO_PI","float",6.28318530717958)}function Epe(t,e){t.include(JF),e.pbrMode!==1&&e.pbrMode!==2&&e.pbrMode!==5&&e.pbrMode!==6||(t.code.add(A`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),t.code.add(A`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==1&&e.pbrMode!==2||(t.include(tzt),t.code.add(A`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),t.code.add(A`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`))}function izt(t,e){t.include(JF),t.code.add(A`
  struct PBRShadingWater {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),t.code.add(A`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),t.code.add(A`float normalDistributionWater(float NdotH, float roughness) {
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),t.code.add(A`float geometricOcclusionKelemen(float LoH) {
return 0.25 / (LoH * LoH);
}`),t.code.add(A`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max) {
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}function rzt(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function RX(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function pA(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function Bqe(t){return(t+1)*(t+1)}function szt(t){return Ce(Math.floor(Math.sqrt(t)-1),0,2)}function qqe(t,e,i){const r=t[0],s=t[1],n=t[2],a=i||[];return a.length=Bqe(e),e>=0&&(a[0]=.28209479177),e>=1&&(a[1]=.4886025119*r,a[2]=.4886025119*n,a[3]=.4886025119*s),e>=2&&(a[4]=1.09254843059*r*s,a[5]=1.09254843059*s*n,a[6]=.31539156525*(3*n*n-1),a[7]=1.09254843059*r*n,a[8]=.54627421529*(r*r-s*s)),a}function nzt(t,e){const i=Bqe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function azt(t,e){const i=szt(e.r.length);for(const r of t)fp(Wae,r.direction),qqe(Wae,i,a0),rzt(a0,qB),RX(a0,r.intensity[0],iM),pA(e.r,iM),RX(a0,r.intensity[1],iM),pA(e.g,iM),RX(a0,r.intensity[2],iM),pA(e.b,iM);return e}function ozt(t,e){qqe(Wae,0,a0);for(const i of t)e.r[0]+=a0[0]*qB[0]*i.intensity[0]*4*Math.PI,e.g[0]+=a0[0]*qB[0]*i.intensity[1]*4*Math.PI,e.b[0]+=a0[0]*qB[0]*i.intensity[2]*4*Math.PI;return e}function lzt(t,e,i,r){nzt(e,r),xe(i.intensity,0,0,0);let s=!1;const n=czt,a=uzt,o=hzt;n.length=0,a.length=0,o.length=0;for(const l of t)l instanceof TG&&!s?(me(i.direction,l.direction),me(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof TG||l instanceof OBe?n.push(l):l instanceof jde?a.push(l):l instanceof PBe&&o.push(l);azt(n,r),ozt(a,r);for(const l of o)pA(r.r,l.r),pA(r.g,l.g),pA(r.b,l.b)}const czt=[],uzt=[],hzt=[],a0=[0],iM=[0],Wae=I(),qB=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let oCe=class{constructor(){this.color=I(),this.intensity=1}},dzt=class{constructor(){this.direction=I(),this.ambient=new oCe,this.diffuse=new oCe}};const Gqe=.4;let IX=class{constructor(){this._shOrder=2,this._legacy=new dzt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new PBe,this._mainLight=new TG(I(),Ye(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){lzt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),this.updateLegacy()}updateLegacy(){me(this._legacy.direction,this._mainLight.direction);const e=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*e,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*e,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*e,he(this._legacy.diffuse.color,this._mainLight.intensity,e),me(Ij,this._legacy.diffuse.color),he(Ij,Ij,Gqe*this.globalFactor),$e(this._legacy.ambient.color,this._legacy.ambient.color,Ij)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),me(this._mainLight.direction,e.mainLight.direction),me(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(cr(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=yt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=yt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),me(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=yt(e.globalFactor,i.globalFactor,r),this.noonFactor=yt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=yt(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=yt(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=yt(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s];this.updateLegacy()}};const Ij=I();function pzt(t){t.code.add(A`float mapChannel(float x, vec2 p) {
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),t.code.add(A`vec3 blackLevelSoftCompression(vec3 color, float averageAmbientRadiance) {
vec2 p = vec2(0.02, 0.0075) * averageAmbientRadiance;
return vec3(mapChannel(color.x, p), mapChannel(color.y, p), mapChannel(color.z, p));
}`)}function NP(t){t.code.add(A`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}function HH(t){t.constants.add("ambientBoostFactor","float",Gqe)}function YO(t){t.uniforms.add(new Vs("lightingGlobalFactor",e=>e.lighting.globalFactor))}function JO(t,e){const i=t.fragment,{pbrMode:r,spherical:s,hasColorTexture:n}=e;i.include(GH,e),r!==0&&i.include(Epe,e),t.include(Uqe,e),i.include(JF),i.include(NP,e);const a=!(r===2&&!n);switch(a&&i.include(pzt),i.code.add(A`
    const float GAMMA_SRGB = ${A.float(EO)};
    const float INV_GAMMA_SRGB = 0.4761904;
    ${we(r!==0,"const float GROUND_REFLECTANCE = 0.2;")}
  `),HH(i),YO(i),dm(i),i.code.add(A`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${s?A`normalize(vPosWorld)`:A`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Y0(i),i.code.add(A`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),r){case 0:case 4:case 3:t.include(ezt),i.code.add(A`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case 1:case 2:i.code.add(A`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight,
vec3 viewDir, vec3 groundNormal, vec3 mrr, float additionalAmbientIrradiance) {
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, groundNormal), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, groundNormal), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(A`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new FG("hasFillLights",o=>o.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(A`vec3 ambientDir = vec3(5.0 * groundNormal[1] - groundNormal[0] * groundNormal[2], - 5.0 * groundNormal[0] - groundNormal[2] * groundNormal[1], groundNormal[1] * groundNormal[1] + groundNormal[0] * groundNormal[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new Vs("lightingSpecularStrength",o=>o.lighting.mainLight.specularStrength),new Vs("lightingEnvironmentStrength",o=>o.lighting.mainLight.environmentStrength)).code.add(A`vec3 horizonRingDir = inputs.RdotNG * groundNormal - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE);`),i.code.add(A`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent;
        ${a?A`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:A`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case 5:case 6:dm(i),Y0(i),i.code.add(A`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`)}}function fzt(t,e){const i=t.fragment;switch(i.code.add(A`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case 0:i.code.add(A`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case 1:i.code.add(A`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case 2:i.code.add(A`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case 3:}}function Ape(t,e){const i=e.pbrMode,r=t.fragment;if(i!==2&&i!==0&&i!==1)return void r.code.add(A`void applyPBRFactors() {}`);if(i===0)return void r.code.add(A`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(i===2)return void r.code.add(A`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:s,hasMetallicRoughnessTextureTransform:n,hasOcclusionTexture:a,hasOcclusionTextureTransform:o,bindType:l}=e;(s||a)&&t.include(UH,e),r.code.add(A`vec3 mrr;
float occlusion;`),s&&r.uniforms.add(l===1?new Gt("texMetallicRoughness",u=>u.textureMetallicRoughness):new S1("texMetallicRoughness",u=>u.textureMetallicRoughness)),a&&r.uniforms.add(l===1?new Gt("texOcclusion",u=>u.textureOcclusion):new S1("texOcclusion",u=>u.textureOcclusion)),r.uniforms.add(l===1?new Pr("mrrFactors",u=>u.mrrFactors):new yp("mrrFactors",u=>u.mrrFactors)),r.code.add(A`
    ${we(s,A`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${we(a,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${a?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${we(s,`applyMetallicRoughness(${n?"metallicRoughnessUV":"vuv0"});`)}
      ${we(a,`applyOcclusion(${o?"occlusionUV":"vuv0"});`)}
    }
  `)}function mzt(t,e){const i=Ps(e.output)&&e.receiveShadows;i&&Pqe(t,!0),t.vertex.code.add(A`
    void forwardLinearDepthToReadShadowMap() { ${we(i,"forwardLinearDepth(gl_Position.w);")} }
  `)}let gzt=class extends Ki{constructor(e,i,r,s){super(e,"mat4",2,(n,a,o,l)=>n.setUniformMatrices4fv(e,i(a,o,l),s),r)}},yzt=class extends Ki{constructor(e,i,r,s){super(e,"mat4",1,(n,a,o)=>n.setUniformMatrices4fv(e,i(a,o),s),r)}};function Hqe(t){t.fragment.uniforms.add(new yzt("shadowMapMatrix",(e,i)=>i.shadowMap.getShadowMapMatrices(e.origin),4)),Wqe(t)}function vzt(t){t.fragment.uniforms.add(new gzt("shadowMapMatrix",(e,i)=>i.shadowMap.getShadowMapMatrices(e.origin),4)),Wqe(t)}function Wqe(t){const{fragment:e}=t;e.uniforms.add(new Go("cascadeDistances",i=>i.shadowMap.cascadeDistances),new N8e("numCascades",i=>i.shadowMap.numCascades)),e.code.add(A`const vec3 invalidShadowmapUVZ = vec3(0.0, 0.0, -1.0);
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
vec3 calculateUVZShadow(in vec3 _worldPos, in float _linearDepth, in ivec2 shadowMapSize) {
int i = _linearDepth < cascadeDistances[1] ? 0 : _linearDepth < cascadeDistances[2] ? 1 : _linearDepth < cascadeDistances[3] ? 2 : 3;
if (i >= numCascades) {
return invalidShadowmapUVZ;
}
mat4 shadowMatrix = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
vec3 lvpos = lightSpacePosition(_worldPos, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return invalidShadowmapUVZ;
}
vec2 uvShadow = cascadeCoordinates(i, shadowMapSize, lvpos);
return vec3(uvShadow, lvpos.z);
}`)}function Ope(t){t.fragment.code.add(A`float readShadowMapUVZ(vec3 uvzShadow, sampler2DShadow _shadowMap) {
return texture(_shadowMap, uvzShadow);
}`)}let qG=class extends Ki{constructor(e,i){super(e,"sampler2DShadow",0,(r,s)=>r.bindTexture(e,i(s)))}},Ppe=class extends $r{constructor(){super(...arguments),this.origin=I()}};function Rpe(t,e){e.receiveShadows&&t.include(Hqe),Zqe(t,e)}function Ipe(t,e){e.receiveShadows&&t.include(vzt),Zqe(t,e)}function Zqe(t,e){t.fragment.uniforms.add(new Vs("lightingGlobalFactor",s=>s.lighting.globalFactor));const{receiveShadows:i,spherical:r}=e;t.include(mzt,e),i&&_zt(t),t.fragment.code.add(A`
    float readShadow(float additionalAmbientScale, vec3 vpos) {
      return ${i?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":we(r,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};
    }
  `)}function _zt(t){t.include(Ope),t.fragment.uniforms.add(new qG("shadowMap",({shadowMap:e})=>e.depthTexture)).code.add(A`float readShadowMap(const in vec3 _worldPos, float _linearDepth) {
vec3 uvzShadow = calculateUVZShadow(_worldPos, _linearDepth, textureSize(shadowMap,0));
if (uvzShadow.z < 0.0) {
return 0.0;
}
return readShadowMapUVZ(uvzShadow, shadowMap);
}`)}function bzt(t,e){e.hasColorTextureTransform?(t.varyings.add("colorUV","vec2"),t.vertex.uniforms.add(new _m("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??b$)).code.add(A`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(A`void forwardColorUV(){}`)}function wzt(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==0?(t.varyings.add("normalUV","vec2"),t.vertex.uniforms.add(new _m("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??b$)).code.add(A`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(A`void forwardNormalUV(){}`)}function xzt(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==0?(t.varyings.add("emissiveUV","vec2"),t.vertex.uniforms.add(new _m("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??b$)).code.add(A`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(A`void forwardEmissiveUV(){}`)}function Szt(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==0?(t.varyings.add("occlusionUV","vec2"),t.vertex.uniforms.add(new _m("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??b$)).code.add(A`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(A`void forwardOcclusionUV(){}`)}function Tzt(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==0?(t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.uniforms.add(new _m("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??b$)).code.add(A`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(A`void forwardMetallicRoughnessUV(){}`)}function Dpe(t){t.include(zP),t.code.add(A`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${A.int(1)}) {
        return allMixed;
      }
      if (mode == ${A.int(2)}) {
        return internalMixed;
      }
      if (mode == ${A.int(3)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${A.int(2)}) {
        return internalMixed;
      }
      if (mode == ${A.int(3)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function kpe(t,e){e.snowCover&&(t.uniforms.add(new Vs("snowCover",i=>i.snowCover)).code.add(A`float getSnow(vec3 normal, vec3 groundNormal) {
return smoothstep(0.5, 0.55, dot(normal, groundNormal)) * snowCover;
}
float getRealisticTreeSnow(vec3 faceNormal, vec3 shadingNormal, vec3 groundNormal) {
float snow = min(1.0, smoothstep(0.5, 0.55, dot(faceNormal, groundNormal)) +
smoothstep(0.5, 0.55, dot(-faceNormal, groundNormal)) +
smoothstep(0.0, 0.1, dot(shadingNormal, groundNormal)));
return snow * snowCover;
}`),t.code.add(A`vec3 applySnowToMRR(vec3 mrr, float snow) {
return mix(mrr, vec3(0.0, 1.0, 0.04), snow);
}`))}function G1(t){t.code.add(A`
    const float GAMMA = ${A.float(EO)};
    const float INV_GAMMA = ${A.float(1/EO)};

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)}const $zt=1,Czt=1;function Mzt(t,e){if(!Ps(e.output))return;t.fragment.include(G1);const{emissionSource:i,hasEmissiveTextureTransform:r,bindType:s}=e,n=i===3||i===4||i===5;n&&(t.include(UH,e),t.fragment.uniforms.add(s===1?new Gt("texEmission",f=>f.textureEmissive):new S1("texEmission",f=>f.textureEmissive)));const a=i===2||n;a&&t.fragment.uniforms.add(s===1?new Pr("emissiveBaseColor",f=>f.emissiveBaseColor):new yp("emissiveBaseColor",f=>f.emissiveBaseColor));const o=i!==0;o&&!(i===7||i===6||i===4||i===5)&&t.fragment.uniforms.add(s===1?new _t("emissiveStrength",f=>f.emissiveStrength):new jH("emissiveStrength",f=>f.emissiveStrength));const l=i===7,u=i===5,d=i===1||i===6||l;t.fragment.code.add(A`
    vec4 getEmissions(vec3 symbolColor) {
      vec4 emissions = ${a?u?"emissiveSource == 0 ? vec4(emissiveBaseColor, 1.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(emissiveBaseColor, 1.0)":d?l?"emissiveSource == 0 ? vec4(0.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(linearizeGamma(symbolColor), 1.0)":"vec4(0.0)"};
      ${we(n,`${we(u,`if(emissiveSource == 0) {
              vec4 emissiveFromTex = textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
              emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);
           }`,`vec4 emissiveFromTex = textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});
           emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);`)}
        emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      ${we(o,`emissions.rgb *= emissiveStrength * ${A.float(Czt)};`)}
      return emissions;
    }
  `)}function WH(t,e){t.include(FP,e),t.include(Mzt,e),t.fragment.include(zP);const{output:i,oitPass:r,discardInvisibleFragments:s,snowCover:n}=e,a=i===10,o=aA(i),l=Ps(i)&&r===1,u=Ps(i)&&r!==1;let d=0;(u||o||l)&&t.outputs.add("fragColor","vec4",d++),o&&t.outputs.add("fragEmission","vec4",d++),l&&t.outputs.add("fragAlpha","float",d++),t.fragment.code.add(A`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition, vec3 emissiveSymbolColor ${we(n,", float snow")}) {
      ${we(a,"finalColor.a = 1.0;")}

      ${we(s,`if (finalColor.a < ${A.float(ls)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${we(l,A`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${we(u,"fragColor = finalColor;")}
      ${we(o,`fragEmission = ${we(n,"mix(finalColor.a * getEmissions(emissiveSymbolColor), vec4(0.0), snow);","finalColor.a * getEmissions(emissiveSymbolColor);")}`)}
      calculateOcclusionAndOutputHighlight();
      ${we(a,"outputObjectAndLayerIdColor();")}
    }
  `)}function Yqe(t){const e=new Gi,{attributes:i,vertex:r,fragment:s,varyings:n}=e,{output:a,normalType:o,offsetBackfaces:l,spherical:u,snowCover:d,pbrMode:f,textureAlphaPremultiplied:g,instancedDoublePrecision:v,hasVertexColors:_,hasVertexTangents:x,hasColorTexture:S,hasNormalTexture:T,hasNormalTextureTransform:M,hasColorTextureTransform:E}=t;if(u0(r,t),i.add("position","vec3"),n.add("vpos","vec3",{invariant:!0}),e.include(jS,t),e.include(Dqe,t),e.include(S8e,t),e.include(bzt,t),!Ps(a))return e.include(Fqe,t),e;e.include(wzt,t),e.include(xzt,t),e.include(Szt,t),e.include(Tzt,t),W0(r,t),e.include(YF,t),e.include(Tw);const P=o===0||o===1;return P&&l&&e.include(Aqe),e.include(zqe,t),e.include(NH,t),e.include(Iqe,t),n.add("vPositionLocal","vec3"),e.include(h0,t),e.include(kqe,t),e.include(VH,t),r.uniforms.add(new Ca("externalColor",O=>O.externalColor,{supportsNaN:!0})),n.add("vcolorExt","vec4"),e.include(WF,t),r.include(B1),r.include(ppe),e.include(v?Rpe:Ipe,t),r.main.add(A`
    forwardNormalizedVertexColor();

    MaskedColor maskedColor =
      applySymbolColor(applyVVColor(applyInstanceColor(createMaskedFromNaNColor(externalColor))));

    vcolorExt = maskedColor.color;
    forwardColorMixMode(maskedColor.mask);

    vpos = getVertexInLocalOriginSpace();
    vPositionLocal = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    ${we(P,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
    vpos = addVerticalOffset(vpos, localOrigin);
    ${we(x,"vTangent = dpTransformVertexTangent(tangent);")}
    gl_Position = transformPosition(proj, view, vpos);
    ${we(P&&l,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();

    if (opacityMixMode != ${A.int(X4.ignore)} && vcolorExt.a < ${A.float(ls)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    }
    forwardLinearDepthToReadShadowMap();
  `),e.include(JO,t),s.include(GH,t),e.include(xE,t),s.include(xw,t),e.include(WH,t),W0(s,t),s.uniforms.add(r.uniforms.get("localOrigin"),new Pr("ambient",O=>O.ambient),new Pr("diffuse",O=>O.diffuse),new _t("opacity",O=>O.opacity),new _t("layerOpacity",O=>O.layerOpacity)),S&&s.uniforms.add(new Gt("tex",O=>O.texture)),e.include(Ape,t),s.include(Epe,t),s.include(Dpe),e.include(fzt,t),s.include(kpe,t),HH(s),YO(s),Y0(s),s.main.add(A`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${S?A`
            vec4 texColor = texture(tex, ${E?"colorUV":"vuv0"});
            ${we(g,"texColor.rgb /= texColor.a;")}
            discardOrAdjustAlpha(texColor);`:A`vec4 texColor = vec4(1.0);`}
    shadingParams.viewDirection = normalize(vpos - cameraPosition);
    ${o===2?A`vec3 normal = screenDerivativeNormal(vPositionLocal);`:A`shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
    applyPBRFactors();
    float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

    vec3 posWorld = vpos + localOrigin;

    float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
    float shadow = readShadow(additionalAmbientScale, vpos);

    vec3 matColor = max(ambient, diffuse);
    vec3 albedo = mixExternalColor(${we(_,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
    float opacity_ = layerOpacity * mixExternalOpacity(${we(_,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, opacityMixMode);

    ${T?`mat3 tangentSpace = computeTangentSpace(${x?"normal":"normal, vpos, vuv0"});
            vec3 shadingNormal = computeTextureNormal(tangentSpace, ${M?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
    vec3 normalGround = ${u?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

    ${we(d,A`
          float snow = getSnow(normal, normalGround);
          albedo = mix(albedo, vec3(1), snow);
          shadingNormal = mix(shadingNormal, normal, snow);
          ssao = mix(ssao, 1.0, snow);`)}

    vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

    ${f===1||f===2?A`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            ${we(d,"mrr = applySnowToMRR(mrr, snow);")}
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, additionalAmbientIrradiance);`:A`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
    vec4 finalColor = vec4(shadedColor, opacity_);
    outputColorHighlightOID(finalColor, vpos, albedo ${we(d,", snow")});
  `),e}const Ezt=Object.freeze(Object.defineProperty({__proto__:null,build:Yqe},Symbol.toStringTag,{value:"Module"}));let Azt=class extends $qe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Eqe,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=2,this.instanced=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.instanceColorEncodesAlphaIgnore=!1,this.emissiveStrength=0,this.emissiveSource=1,this.emissiveBaseColor=Aa,this.instancedDoublePrecision=!1,this.normalType=0,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=l1(.2,.2,.2),this.diffuse=l1(.8,.8,.8),this.externalColor=$i(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=I(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.drivenOpacity=!1,this.writeDepth=!0,this.customDepthTest=0,this.textureAlphaMode=0,this.textureAlphaCutoff=ls,this.textureAlphaPremultiplied=!1,this.renderOccluded=1,this.isDecoration=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}},Nwi=class extends Cqe{constructor(){super(...arguments),this.origin=I(),this.slicePlaneLocalOrigin=this.origin}},Jqe=class extends er{constructor(e,i,r=new Hi(Ezt,()=>W(()=>Promise.resolve().then(()=>fri),void 0))){const s=[bl(Qqe(i))];i.instanced&&i.instancedDoublePrecision&&s.push(bl(FFt(i))),super(e,i,r,bH(s))}_makePipeline(e,i){const{oitPass:r,output:s,transparent:n,cullFace:a,customDepthTest:o,hasOccludees:l}=e;return _i({blending:Ps(s)&&n?kH(r):null,culling:Pzt(e)?xUe(a):null,depthTest:{func:mpe(r,Ozt(o))},depthWrite:U8e(e),drawBuffers:pS(s,US(r,s)),colorWrite:Fi,stencilWrite:l?jG:null,stencilTest:l?i?Hae:Tpe:null,polygonOffset:n5t(e)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Ozt(t){switch(t){case 1:return 515;case 0:case 3:return 513;case 2:return 516}}function Pzt(t){return t.cullFace!==0||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}function Qqe(t){const e=Qu().vec3f("position");return t.normalType===1?e.vec2i16("normalCompressed",{glNormalized:!0}):e.vec3f("normal"),t.hasVertexTangents&&e.vec4f("tangent"),t.hasTextures&&e.vec2f16("uv0"),t.hasVertexColors&&e.vec4u8("color"),t.hasSymbolColors&&e.vec4u8("symbolColor"),!t.instanced&&Ep()&&e.vec4u8("olidColor"),e}let Ji=class extends Wf{constructor(e){super(),this.spherical=e,this.alphaDiscardMode=1,this.doubleSidedMode=0,this.pbrMode=0,this.cullFace=0,this.normalType=0,this.customDepthTest=0,this.emissionSource=0,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.instanced=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0,this.draped=!1}get textureCoordinateType(){return this.hasTextures?1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||this.emissionSource===3||this.hasOcclusionTexture}get hasVVInstancing(){return this.instanced}get discardInvisibleFragments(){return this.transparent}};c([ue({count:4})],Ji.prototype,"alphaDiscardMode",void 0),c([ue({count:3})],Ji.prototype,"doubleSidedMode",void 0),c([ue({count:7})],Ji.prototype,"pbrMode",void 0),c([ue({count:3})],Ji.prototype,"cullFace",void 0),c([ue({count:3})],Ji.prototype,"normalType",void 0),c([ue({count:3})],Ji.prototype,"customDepthTest",void 0),c([ue({count:8})],Ji.prototype,"emissionSource",void 0),c([ue()],Ji.prototype,"hasVertexColors",void 0),c([ue()],Ji.prototype,"hasSymbolColors",void 0),c([ue()],Ji.prototype,"hasVerticalOffset",void 0),c([ue()],Ji.prototype,"hasColorTexture",void 0),c([ue()],Ji.prototype,"hasMetallicRoughnessTexture",void 0),c([ue()],Ji.prototype,"hasOcclusionTexture",void 0),c([ue()],Ji.prototype,"hasNormalTexture",void 0),c([ue()],Ji.prototype,"hasScreenSizePerspective",void 0),c([ue()],Ji.prototype,"hasVertexTangents",void 0),c([ue()],Ji.prototype,"hasOccludees",void 0),c([ue()],Ji.prototype,"instanced",void 0),c([ue()],Ji.prototype,"instancedDoublePrecision",void 0),c([ue()],Ji.prototype,"hasModelTransformation",void 0),c([ue()],Ji.prototype,"offsetBackfaces",void 0),c([ue()],Ji.prototype,"hasVVSize",void 0),c([ue()],Ji.prototype,"hasVVColor",void 0),c([ue()],Ji.prototype,"receiveShadows",void 0),c([ue()],Ji.prototype,"receiveAmbientOcclusion",void 0),c([ue()],Ji.prototype,"textureAlphaPremultiplied",void 0),c([ue()],Ji.prototype,"instancedFeatureAttribute",void 0),c([ue()],Ji.prototype,"instancedColor",void 0),c([ue()],Ji.prototype,"writeDepth",void 0),c([ue()],Ji.prototype,"transparent",void 0),c([ue()],Ji.prototype,"enableOffset",void 0),c([ue()],Ji.prototype,"terrainDepthTest",void 0),c([ue()],Ji.prototype,"cullAboveTerrain",void 0),c([ue()],Ji.prototype,"snowCover",void 0),c([ue()],Ji.prototype,"hasColorTextureTransform",void 0),c([ue()],Ji.prototype,"hasEmissionTextureTransform",void 0),c([ue()],Ji.prototype,"hasNormalTextureTransform",void 0),c([ue()],Ji.prototype,"hasOcclusionTextureTransform",void 0),c([ue()],Ji.prototype,"hasMetallicRoughnessTextureTransform",void 0);function Xqe(t){const e=new Gi,{attributes:i,vertex:r,fragment:s,varyings:n}=e,{output:a,offsetBackfaces:o,pbrMode:l,snowCover:u,spherical:d}=t,f=l===1||l===2;if(u0(r,t),i.add("position","vec3"),n.add("vpos","vec3",{invariant:!0}),e.include(jS,t),e.include(Dqe,t),e.include(S8e,t),e.include(WF,t),!Ps(a))return e.include(Fqe,t),e;W0(e.vertex,t),e.include(YF,t),e.include(Tw),o&&e.include(Aqe),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3",{invariant:!0}),e.include(h0,t),e.include(kqe,t),e.include(Iqe,t),e.include(VH,t),r.include(B1),r.include(ppe),r.uniforms.add(new Ca("externalColor",_=>_.externalColor,{supportsNaN:!0})),n.add("vcolorExt","vec4"),e.include(t.instancedDoublePrecision?Rpe:Ipe,t),r.main.add(A`
    forwardNormalizedVertexColor();

    MaskedColor maskedColorExt =
      applySymbolColor(applyVVColor(applyInstanceColor(createMaskedFromNaNColor(externalColor))));

    vcolorExt = maskedColorExt.color;
    forwardColorMixMode(maskedColorExt.mask);

    bool alphaCut = opacityMixMode != ${A.int(X4.ignore)} && vcolorExt.a < ${A.float(ls)};
    vpos = getVertexInLocalOriginSpace();

    localvpos = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
    vpos = addVerticalOffset(vpos, localOrigin);
    vec4 basePosition = transformPosition(proj, view, vpos);

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardTextureCoordinates();
    forwardLinearDepthToReadShadowMap();
    gl_Position = alphaCut ? vec4(1e38, 1e38, 1e38, 1.0) :
    ${we(o,"offsetBackfacingClipPosition(basePosition, vpos, vNormalWorld, cameraPosition);","basePosition;")}
  `);const{hasColorTexture:g,hasColorTextureTransform:v}=t;return e.include(JO,t),s.include(GH,t),e.include(xE,t),s.include(xw,t),e.include(WH,t),W0(s,t),dm(s),HH(s),YO(s),s.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Pr("ambient",_=>_.ambient),new Pr("diffuse",_=>_.diffuse),new _t("opacity",_=>_.opacity),new _t("layerOpacity",_=>_.layerOpacity)),g&&s.uniforms.add(new Gt("tex",_=>_.texture)),e.include(Ape,t),s.include(Epe,t),s.include(Dpe),s.include(kpe,t),Y0(s),s.main.add(A`
      discardBySlice(vpos);
      discardByTerrainDepth();
      vec4 texColor = ${g?`texture(tex, ${v?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${we(g,`${we(t.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}
        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = readShadow(additionalAmbientScale, vpos);
      vec3 matColor = max(ambient, diffuse);
      ${t.hasVertexColors?A`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, opacityMixMode);`:A`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, opacityMixMode);`}

      vec3 shadingNormal = normalize(vNormalWorld);
      vec3 groundNormal = ${d?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};

      ${we(u,`vec3 faceNormal = screenDerivativeNormal(vpos);
         float snow = getRealisticTreeSnow(faceNormal, shadingNormal, groundNormal);
         albedo = mix(albedo, vec3(1), snow);`)}

      ${A`albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}

      ${f?A`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            ${we(u,"mrr = applySnowToMRR(mrr, snow);")}
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, groundNormal, mrr, additionalAmbientIrradiance);`:A`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos, albedo ${we(u,", 1.0")});`),e}const Rzt=Object.freeze(Object.defineProperty({__proto__:null,build:Xqe},Symbol.toStringTag,{value:"Module"}));let Izt=class extends Jqe{constructor(e,i){super(e,i,new Hi(Rzt,()=>W(()=>Promise.resolve().then(()=>mri),void 0)))}},Kqe=class extends IH{constructor(e,i){super(e,kzt),this.materialType="default",this.supportsEdges=!0,this.intersectDraped=void 0,this.produces=new Map([[2,r=>(BQ(r)||G4(r))&&!this.transparent],[4,r=>(BQ(r)||G4(r))&&this.transparent&&this.parameters.writeDepth],[8,r=>(BQ(r)||G4(r))&&this.transparent&&!this.parameters.writeDepth]]),this._layout=Qqe(this.parameters),this._configuration=new Ji(i.spherical)}isVisibleForOutput(e){return e!==4&&e!==6&&e!==5||this.parameters.castShadows}get visible(){const{layerOpacity:e,colorMixMode:i,opacity:r,externalColor:s}=this.parameters;return e*(i==="replace"?1:r)*(i==="ignore"||isNaN(s[3])?1:s[3])>=ls}get _hasEmissiveBase(){return!!this.parameters.emissiveTextureId||!di(this.parameters.emissiveBaseColor,Aa)}get hasEmissions(){return this.parameters.emissiveStrength>0&&(this.parameters.emissiveSource===0&&this._hasEmissiveBase||this.parameters.emissiveSource===1)}getConfiguration(e,i){const{parameters:r,_configuration:s}=this,{treeRendering:n,doubleSided:a,doubleSidedType:o}=r;return super.getConfiguration(e,i,this._configuration),s.hasNormalTexture=r.hasNormalTexture,s.hasColorTexture=r.hasColorTexture,s.hasMetallicRoughnessTexture=r.hasMetallicRoughnessTexture,s.hasOcclusionTexture=r.hasOcclusionTexture,s.hasVertexTangents=!n&&r.hasVertexTangents,s.instanced=r.instanced,s.instancedDoublePrecision=r.instancedDoublePrecision,s.hasVVColor=!!r.vvColor,s.hasVVSize=!!r.vvSize,s.hasVerticalOffset=r.verticalOffset!=null,s.hasScreenSizePerspective=r.screenSizePerspective!=null,s.hasSlicePlane=r.hasSlicePlane,s.alphaDiscardMode=r.textureAlphaMode,s.normalType=n?0:r.normalType,s.transparent=this.transparent,s.writeDepth=r.writeDepth,s.customDepthTest=r.customDepthTest??0,s.hasOccludees=i.hasOccludees,s.cullFace=r.hasSlicePlane?0:r.cullFace,s.cullAboveTerrain=i.cullAboveTerrain,s.hasModelTransformation=!n&&r.modelTransformation!=null,s.hasVertexColors=r.hasVertexColors,s.hasSymbolColors=r.hasSymbolColors,s.doubleSidedMode=n?2:a&&o==="normal"?1:a&&o==="winding-order"?2:0,s.instancedFeatureAttribute=r.instancedFeatureAttribute,s.instancedColor=r.instancedColor,Ps(e)?(s.terrainDepthTest=i.terrainDepthTest,s.receiveShadows=r.receiveShadows,s.receiveAmbientOcclusion=r.receiveAmbientOcclusion&&i.ssao!=null):(s.terrainDepthTest=!1,s.receiveShadows=s.receiveAmbientOcclusion=!1),s.textureAlphaPremultiplied=!!r.textureAlphaPremultiplied,s.pbrMode=r.usePBR?r.isSchematic?2:1:0,s.emissionSource=r.emissionSource,s.offsetBackfaces=!(!this.transparent||!r.offsetTransparentBackfaces),s.oitPass=i.oitPass,s.enableOffset=i.camera.relativeElevation<s5t,s.snowCover=i.snowCover>0,s.hasColorTextureTransform=!!r.colorTextureTransformMatrix,s.hasNormalTextureTransform=!!r.normalTextureTransformMatrix,s.hasEmissionTextureTransform=!!r.emissiveTextureTransformMatrix,s.hasOcclusionTextureTransform=!!r.occlusionTextureTransformMatrix,s.hasMetallicRoughnessTextureTransform=!!r.metallicRoughnessTextureTransformMatrix,s}intersect(e,i,r,s,n,a){if(this.parameters.verticalOffset!=null){const o=r.camera;xe(kX,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case 1:l=Re(lCe,kX);break;case 2:l=me(lCe,Nzt)}let u=0;const d=Ae(Vzt,kX,o.eye),f=Ve(d),g=he(d,d,1/f);let v=null;this.parameters.screenSizePerspective&&(v=Le(l,g)),u+=A8e(o,f,this.parameters.verticalOffset,v??0,this.parameters.screenSizePerspective,null),he(l,l,u),Ql(DX,l,r.transform.inverseRotation),s=Ae(Fzt,s,DX),n=Ae(zzt,n,DX)}oFt(e,r,s,n,eae(r.verticalOffset),a)}createGLMaterial(e){return new Dzt(e)}createBufferWriter(){return new xFt(this._layout)}get transparent(){return Lzt(this.parameters)}},Dzt=class extends M8e{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return xe(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(i.treeRendering?Izt:Jqe,e)}},kzt=class extends Azt{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}get hasNormalTexture(){return!this.treeRendering&&!!this.normalTextureId}get hasColorTexture(){return!!this.textureId}get hasMetallicRoughnessTexture(){return!this.treeRendering&&!!this.metallicRoughnessTextureId}get hasOcclusionTexture(){return!this.treeRendering&&!!this.occlusionTextureId}get emissionSource(){return this.treeRendering?0:this.emissiveTextureId!=null&&this.emissiveSource===0?3:this.usePBR?this.emissiveSource===0?2:1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||this.emissionSource===3||this.hasOcclusionTexture}};function Lzt(t){const{drivenOpacity:e,opacity:i,externalColor:r,layerOpacity:s,texture:n,textureId:a,textureAlphaMode:o,colorMixMode:l}=t,u=r[3];return e||i<1&&l!=="replace"||u<1&&l!=="ignore"||s<1||(n!=null||a!=null)&&o!==1&&o!==2&&l!=="replace"}const Fzt=I(),zzt=I(),Nzt=Ye(0,0,1),lCe=I(),DX=I(),kX=I(),Vzt=I(),eGe=new wpe({});function Wwi(t){return t.type==="web-style"?eGe:Lpe(t.symbolLayers.toArray().map(e=>tGe(t,e)))}function Lpe(t){let e=0,i=0,r=0,s=!1,n=0;const a=new yqe;for(const o of t)o!=null&&(e+=o.verticesPerFeature,i+=o.verticesPerCoordinate,r+=o.drawCallsPerFeature,a.bytesPerFeature+=o.memory.bytesPerFeature,a.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,a.resourceBytes+=o.memory.resourceBytes,a.draped.bytesPerFeature+=o.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,s=s||o.estimated,++n);return s?new QLt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:a}):new JLt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:a})}function Zwi(t){const e=Lpe(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const LX={};function tGe(t,e){const i=jzt(t,e),r=eFt(e)?2:0;switch(e.type){case"extrude":return new Wd({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new Wd({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new Wd({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new Wd({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new Wd({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return e.resource?.href?new wpe({verticesPerFeature:100,memory:i}):{...Uzt(e.resource?.primitive??mgt),memory:i};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=bLt;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":n=vLt;break;case"miter":case"bevel":n=1;break;default:return}const a=2*s,o=s*n*2,l=o+a;let u=-2*o-a;switch(e.cap){case"none":break;case"butt":case"square":u+=2*(s-1);break;case"round":u+=2*(s*(_Lt-1)*2+s);break;default:return}return new Wd({verticesPerFeature:u,verticesPerCoordinate:l,memory:i})}case"text":{const s=t.type==="label-3d"?0:2;return new Wd({verticesPerFeature:6,memory:i,drawCallsPerFeature:s})}case"icon":return new Wd({verticesPerFeature:6,memory:i});default:return}}function jzt(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?ll.EXTRUDE_EDGES:ll.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?ll.FILL_OUTLINE:ll.FILL;case"water":return ll.FILL;case"line":return e.join==="round"?ll.LINE_ROUND:ll.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return ll.PATH_ROUND_CIRCLE;case"quad":return ll.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return ll.PATH_MITER_CIRCLE;case"quad":return ll.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?ll.OBJECT_POINT:ll.OBJECT_POLYGON;case"icon":case"text":return i?ll.ICON_POINT:ll.ICON_POLYGON;default:return}}function Uzt(t){const e=LX[t];if(e)return e;const i=Bzt(YLt(t,new Kqe({},{spherical:!0})).levels);return LX[t]=new Wd({verticesPerFeature:i}),LX[t]}function Bzt(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const ll={ICON_POINT:{bytesPerFeature:2658,bytesPerFeatureLabel:3484,resourceBytes:0,draped:{bytesPerFeature:1845,bytesPerFeatureLabel:3498}},ICON_POLYGON:{bytesPerFeature:3086,bytesPerFeatureLabel:2996,resourceBytes:0,draped:{bytesPerFeature:2694,bytesPerFeatureLabel:3014}},OBJECT_POINT:{bytesPerFeature:497,bytesPerFeatureLabel:2933,resourceBytes:0,draped:{bytesPerFeature:497,bytesPerFeatureLabel:2933}},OBJECT_POLYGON:{bytesPerFeature:867,bytesPerFeatureLabel:2491,resourceBytes:0,draped:{bytesPerFeature:867,bytesPerFeatureLabel:2491}},LINE_MITER:{bytesPerFeature:2337,bytesPerFeatureLabel:2658,resourceBytes:0,draped:{bytesPerFeature:1864,bytesPerFeatureLabel:2656}},LINE_ROUND:{bytesPerFeature:2341,bytesPerFeatureLabel:2672,resourceBytes:0,draped:{bytesPerFeature:1873,bytesPerFeatureLabel:2643}},PATH_MITER_CIRCLE:{bytesPerFeature:22374,bytesPerFeatureLabel:2558,resourceBytes:0,draped:{bytesPerFeature:22374,bytesPerFeatureLabel:2558}},PATH_ROUND_CIRCLE:{bytesPerFeature:24004,bytesPerFeatureLabel:2598,resourceBytes:0,draped:{bytesPerFeature:24004,bytesPerFeatureLabel:2598}},PATH_MITER_QUAD:{bytesPerFeature:24040,bytesPerFeatureLabel:2940,resourceBytes:0,draped:{bytesPerFeature:24040,bytesPerFeatureLabel:2940}},PATH_ROUND_QUAD:{bytesPerFeature:23088,bytesPerFeatureLabel:2886,resourceBytes:0,draped:{bytesPerFeature:23088,bytesPerFeatureLabel:2886}},FILL:{bytesPerFeature:3059,bytesPerFeatureLabel:2838,resourceBytes:0,draped:{bytesPerFeature:2352,bytesPerFeatureLabel:2808}},FILL_OUTLINE:{bytesPerFeature:3093,bytesPerFeatureLabel:2632,resourceBytes:0,draped:{bytesPerFeature:2480,bytesPerFeatureLabel:2601}},EXTRUDE:{bytesPerFeature:5075,bytesPerFeatureLabel:2559,resourceBytes:0,draped:{bytesPerFeature:5075,bytesPerFeatureLabel:2559}},EXTRUDE_EDGES:{bytesPerFeature:2843,bytesPerFeatureLabel:2139,resourceBytes:0,draped:{bytesPerFeature:2843,bytesPerFeatureLabel:2139}}};if(ie("esri-tests-disable-symbol-memory-estimators"))for(const t in ll){const e=ll[t];e.bytesPerFeature=0,e.bytesPerFeatureLabel=0,e.draped.bytesPerFeature=0,e.draped.bytesPerFeatureLabel=0}const qzt=()=>re.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Gzt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function Ywi(t){const e=t?.expression;if(typeof e=="string"){const i=rGe(e);if(i!=null)return{cachedResult:i}}return null}async function Jwi(t,e,i,r){const s=t?.expression;if(typeof s!="string")return null;const n=rGe(s);if(n!=null)return{cachedResult:n};const a=await p1();ct(i);const o=a.arcadeUtils,l=o.createSyntaxTree(s);return o.dependsOnView(l)?(r?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(l),context:o.createExecContext(null,{sr:e}),modules:a}}}function Hzt(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function Wzt(t,e){if(t!=null&&!iGe(t)){if(!e||!t.arcade)return void qzt().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=J8e(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Zzt(t){if(t!=null){if(iGe(t))return t.cachedResult;const e=t.arcade;let i=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function Qwi(t,e=!1){let i=t?.featureExpressionInfo;const r=i?.expression;return e||r==="0"||(i=null),i??null}const Yzt={cachedResult:0};function iGe(t){return t.cachedResult!=null}function rGe(t){return t==="0"?0:null}let cCe=class sGe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.mode=null,this.centerInElevationSR=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=vhe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Zzt(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=a2t(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}setFeatureExpressionInfoContext(e){this._featureExpressionInfoContext=e}updateFeatureExpressionInfoContextForGraphic(e,i,r){e.arcade?(this._featureExpressionInfoContext=Gzt(e),this.updateFeatureExpressionFeature(i,r)):this._featureExpressionInfoContext=e}updateFeatureExpressionFeature(e,i){const r=this.featureExpressionInfoContext;r?.arcade&&(r.cachedResult=void 0,Wzt(this._featureExpressionInfoContext,e.geometry?Hzt(r.arcade.modules,e,i):null))}static fromElevationInfo(e){const i=new sGe;return e!=null&&i.setFromElevationInfo(e),i}},Fpe=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=0,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===1?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===2?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=1},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=2,!Zr(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Rs(this._abortController):this._loadStatus===0&&(this._loadStatus=2),this._loader=null}};function Kwi(t){switch(t){case"multiply":default:return 1;case"ignore":return 2;case"replace":return 3;case"tint":return 4}}function Jzt(t,e,i){if(t==null||e===2)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Ce(Math.round(t[3]*GG),0,GG),s=r===0||e===4?0:e===3?Kzt:eNt;i[0]=Ce(Math.round(t[0]*rM),0,rM),i[1]=Ce(Math.round(t[1]*rM),0,rM),i[2]=Ce(Math.round(t[2]*rM),0,rM),i[3]=r+s}function Qzt(t,e){for(let i=0;i<4;i++)t[i]=Xzt(e[i]);return t}function Xzt(t){return isNaN(t)?255:t*(254/255)}const rM=255,GG=85,Kzt=GG,eNt=2*GG,Ox=()=>re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let tNt=class extends Fpe{constructor(e,i,r,s,n=!0){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this._drivenOpacityFallbackAlwaysOpaque=n,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=Ox(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new cCe,this.updateComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=uCe(this._context.renderer,n)),this._updateElevationContext()}destroy(){this.complexity=null,this._materials.length=0,super.destroy()}get view(){return this._context.stage.view}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get estimatedMemory(){const{complexity:e}=this;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}get usedMemory(){return this.estimatedMemory}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=uCe(e,this._drivenOpacityFallbackAlwaysOpaque);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size||r.rotation!==i.rotation}get needsDrivenTransparentPass(){return this._hasDrivenColorOrOpacity&&!this._drivenProperties.opacityAlwaysOpaque}get _hasDrivenColorOrOpacity(){return this._drivenProperties.color||this._drivenProperties.opacity}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,a="polygons"in e?e.polygons:null,o=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&a&&a.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&Ox().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):Ox().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}get needsUpdateFocus(){return!1}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(Ox().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(Ox().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return Ox().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":rDe(e)}return!0}_defaultElevationInfoNoZ(){return iNt}_defaultElevationInfoZ(){return rNt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.setFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.setFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}createElevationContextForGraphic(e){const i=new cCe;return this.updateElevationContextForGraphic(i,e),i}updateElevationContextForGraphic(e,i){const r=i.geometry,s=this.getDefaultElevationInfo(r);e.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,e.mode=this.getGeometryElevationMode(r,s),e.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&e.mode==="on-the-ground";n&&(e.mode="relative-to-ground",e.offsetMeters=0);const a=n?Yzt:this._elevationContext.featureExpressionInfoContext;a?e.updateFeatureExpressionInfoContextForGraphic(a,i,this._context.layer):e.setFeatureExpressionInfoContext(null)}prepareSymbolLayerPatch(e){}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=hCe){const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.color?r:e?r*(this._drivenProperties.opacity?1:e.a):i.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,i=hCe){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return TX(null,r);const s=e!=null?Je.toUnitRGB(e):Wce;return TX(s,r)}_getDrivenUInt8Color({color:e,opacity:i},r,s){const{color:n,opacity:a}=this._drivenProperties,o=Je.toUnitRGBA(r)??(s?nH:Tn),l=n?e??o:null,u=e||r||s,d=n?null:o[3];return TX(l,a&&u?i??d:null,255)}_getDrivenUInt8ColorWithNaNSupport({color:e,opacity:i},r,s){const n=r?X5(Je.toUnitRGBA(r)):$i(NaN,NaN,NaN,s?NaN:0);return this._drivenProperties.color&&e!=null&&qc(n,e),this._drivenProperties.opacity&&i!=null&&(n[3]=i),y1(n,n,255),Qzt(n,n)}isFastUpdatesEnabled(){return this._fastUpdates!=null}updateComplexity(){this.complexity=this.computeComplexity()}computeComplexity(){return tGe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"screenSizePerspectiveEnabled":return this.layerScreenSizePerspectiveChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==2}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=1;return e?.forEach(n=>{const a=i(n);if(a!=null){const o=n.graphic;this.updateElevationContextForGraphic(a.elevationContext,o),a.needsElevationUpdates=r(a.elevationContext.mode)}else s=2}),s}applyRendererDiff(e,i){return 0}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?fX(i.size.field,e):0,s=i.color?fX(i.color.field,e):0,n=i.opacity?fX(i.opacity.field,e):0;return $i(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&Ox().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function uCe(t,e){const i={color:!1,opacity:!1,opacityAlwaysOpaque:e,size:!1,rotation:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(i.color=!0,r.stops)for(let s=0;s<r.stops.length;s++){const n=r.stops[s].color;n&&n.a<1&&(i.opacityAlwaysOpaque=!1)}break;case"opacity":i.opacity=!0,i.opacityAlwaysOpaque=!1;break;case"size":i.size=!0;break;case"rotation":i.rotation=!0}}),i}const iNt={mode:"on-the-ground",offset:0,unit:"meters"},rNt={mode:"absolute-height",offset:0,unit:"meters"},hCe={hasIntrinsicColor:!1},t1i=$i(NaN,NaN,NaN,NaN);function nGe(t){return t==="position"}function sNt(t,e){return t==null&&(t=[]),t.push(e),t}function nNt(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function i1i(t,e,i,r,s){Dj[0]=t.get(e,0),Dj[1]=t.get(e,1),Dj[2]=t.get(e,2),NFt(Dj,Px,3),i.set(s,0,Px[0]),r.set(s,0,Px[1]),i.set(s,1,Px[2]),r.set(s,1,Px[3]),i.set(s,2,Px[4]),r.set(s,2,Px[5])}const Dj=I(),Px=new Float32Array(6);let aGe=class{constructor(e={}){this.id=Gc(),this._highlightIds=new Set,this._shaderTransformation=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerViewUid=e.layerViewUid,e.isElevationSource&&(this.lastValidElevationBB=new oGe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get layer(){return this._layer}set layer(e){xt(this._layer==null||e==null,"Object3D can only be added to a single Layer"),this._layer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e);for(const i of this._highlightIds)e.addHighlight(i);this._emit("geometryAdded",{object:this,geometry:e}),this._highlightIds.size&&this._emit("highlightChanged",this),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];if(i){for(const r of this._highlightIds)i.removeHighlight(r);this._emit("geometryRemoved",{object:this,geometry:i}),this._highlightIds.size&&this._emit("highlightChanged",this),this._invalidateBoundingVolume()}}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),nGe(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new rLt;for(const i of this._geometries)i.occludees=sNt(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=nNt(i.occludees,e);this._emit("occlusionChanged",this)}highlight(e){const i=new aqe(e);for(const r of this._geometries)r.addHighlight(i);return this._emit("highlightChanged",this),this._highlightIds.add(i),i}removeHighlight(e){this._highlightIds.delete(e);for(const i of this._geometries)i.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===0?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,i){return Cn(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=ut()){return Cn(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new dCe,this._validateBoundingVolume(this._bvWorldSpace,0)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new dCe,this._validateBoundingVolume(this._bvObjectSpace,1)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===1;for(const s of this._geometries){const n=s.boundingInfo;n&&aNt(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}OP(e.bounds,cr(FX,e.min,e.max,.5));for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const a=r?s.transformation:this.getCombinedShaderTransformation(s),o=eL(a);Ft(FX,n.center,a);const l=Bi(FX,Li(e.bounds)),u=n.radius*o;e.bounds[3]=Math.max(e.bounds[3],l+u)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this.layer&&e&&this.layer.notifyObjectBBChanged(this,e)}_emit(e,i){this.layer?.events.emit(e,i)}get geometries(){return this._geometries}get transformation(){return this._transformation??gl}set transformation(e){this._transformation=Ln(this._transformation??ut(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?Ln(this._shaderTransformation??ut(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}get test(){}},oGe=class{constructor(){this._data=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]}get min(){return Ye(this._data[0],this._data[1],this._data[2])}get max(){return Ye(this._data[3],this._data[4],this._data[5])}minWith(e){const{_data:i}=this;i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.min(i[2],e[2])}maxWith(e){const{_data:i}=this;i[3]=Math.max(i[3],e[0]),i[4]=Math.max(i[4],e[1]),i[5]=Math.max(i[5],e[2])}assignMinMax(e,i){for(let r=0;r<3;++r)this._data[0+r]=e[r],this._data[3+r]=i[r]}isEmpty(){return this._data[3]<this._data[0]&&this._data[4]<this._data[1]&&this._data[5]<this._data[2]}},dCe=class extends oGe{constructor(){super(...arguments),this.bounds=Is()}};function aNt(t,e,i){const r=t.bbMin,s=t.bbMax;if(P7(i)){const n=xe(oNt,i[12],i[13],i[14]);return $e(dh,r,n),$e(ef,s,n),e.minWith(dh),void e.maxWith(ef)}if(Ft(dh,r,i),di(r,s))return e.minWith(dh),void e.maxWith(dh);Ft(ef,s,i),e.minWith(dh),e.minWith(ef),e.maxWith(dh),e.maxWith(ef);for(let n=0;n<3;++n)me(dh,r),me(ef,s),dh[n]=s[n],ef[n]=r[n],Ft(dh,dh,i),Ft(ef,ef,i),e.minWith(dh),e.minWith(ef),e.maxWith(dh),e.maxWith(ef)}const oNt=I(),dh=I(),ef=I(),FX=I();function lNt(t,e,i,r,s){if(lGe(t,e))return null;i.localOrigin=hNt(t,e);const n=new aGe({geometries:[i],castShadow:!1,layerViewUid:t.layerViewUid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:K8e(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function a1i(t,e,i,r){return lGe(e,i)?null:K8e(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function lGe(t,e){const i=t.clippingExtent;return!!i&&(Jc(e,$w,t.elevationProvider.spatialReference),!egt(i,$w))}function cNt(t,e,i){const r=t.elevationContext,s=i.spatialReference;Jc(e,$w,s),r.centerInElevationSR=Ye($w[0],$w[1],e.hasZ?$w[2]:0)}function uNt(t){switch(t.type){case"point":return t;case"polygon":case"extent":return dqe(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=tDe(e,eDe(e)/2);return vm(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.extent.center}return null}function hNt(t,e){return Jc(e,$w,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin($w)}const $w=I();function dNt(t){t.include(Ip),t.uniforms.add(new Jo("geometryDepthTexture",e=>e.geometryDepth?.attachment)),t.code.add(A`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}function cGe(t){const e=new Gi,{vertex:i,fragment:r}=e,{terrainDepthTest:s}=t;return i.include(DH),e.include(C8e,t),e.vertex.include(R8e,t),e.attributes.add("uv0","vec2"),i.uniforms.add(new Go("viewport",n=>n.camera.fullViewport),new _t("lineSize",(n,a)=>n.size>0?Math.max(1,n.size)*a.camera.pixelRatio:0),new Z0("pixelToNDC",n=>oi(pCe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new _t("borderSize",(n,a)=>n.borderColor?a.camera.pixelRatio:0),new rc("screenOffset",(n,a)=>oi(pCe,n.horizontalScreenOffset*a.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),s&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(z8e),t.hasScreenSizePerspective&&RH(i),i.main.add(A`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${we(t.occlusionTestEnabled,A`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${t.hasScreenSizePerspective?A`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${we(s,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${we(t.hudDepth,t.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?A`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:A`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),r.uniforms.add(new Ca("uColor",n=>n.color??Tn),new Ca("borderColor",n=>n.borderColor??Tn)),s&&(r.include(dNt,t),r.uniforms.add(new Z0("inverseViewport",n=>n.inverseViewport))),r.main.add(A`
    ${we(s,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${we(!t.hudDepth,A`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),e}const pCe=Ke(),pNt=Object.freeze(Object.defineProperty({__proto__:null,build:cGe},Symbol.toStringTag,{value:"Module"}));let fNt=class extends er{constructor(e,i){super(e,i,new Hi(pNt,()=>W(()=>Promise.resolve().then(()=>gri),void 0)),uGe.locations)}initializePipeline(e){const{hudDepth:i,terrainDepthTest:r}=e,s={func:r?519:513};return _i(i?{depthTest:s,depthWrite:FF}:{blending:o_(1,770,771,771),depthTest:s,colorWrite:Fi})}};const uGe=Qu().vec3f("position").vec3f("normal").vec2f16("uv0").vec4f("centerOffsetAndDistance");let Ib=class extends Wf{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}};c([ue()],Ib.prototype,"screenCenterOffsetUnitsEnabled",void 0),c([ue()],Ib.prototype,"occlusionTestEnabled",void 0),c([ue()],Ib.prototype,"hasVerticalOffset",void 0),c([ue()],Ib.prototype,"hasScreenSizePerspective",void 0),c([ue()],Ib.prototype,"hudDepth",void 0),c([ue()],Ib.prototype,"hudDepthAlignStart",void 0),c([ue()],Ib.prototype,"terrainDepthTest",void 0);let zX=class extends IH{constructor(e,i){super(e,hGe),this.intersectDraped=void 0,this.produces=new Map([[15,r=>Ps(r)],[16,r=>Ps(r)]]),this._configuration=new Ib(i),this._uniqueMaterialIdentifier=Zae(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){return super.getConfiguration(e,i,this._configuration),this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=i.slot===16,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=ls||(this.parameters.borderColor?.[3]??0)>=ls}intersect(){}createGLMaterial(e){return new mNt(e)}createBufferWriter(){return new gNt}validateParameters(e){this._uniqueMaterialIdentifier=Zae(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}};function Zae({renderOccluded:t,isDecoration:e,horizontalScreenOffset:i,color:r,size:s,occlusionTest:n,shaderPolygonOffset:a,hudDepthAlignStart:o,centerOffsetUnits:l,hasSlicePlane:u,screenSizePerspective:d,verticalOffset:f,borderColor:g}){return Get`${t}:${e}:${i}:[${r}]:${s}:${n}:${a}:${o}:${l}:${u}:${d!=null}:{${f?.screenLength}:${f?.minWorldLength}:${f?.maxWorldLength}}:[${g}]`}let mNt=class extends npe{beginSlot(e){return this.getTechnique(fNt,e)}},hGe=class extends F4t{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=$i(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const fCe=[ep(0,0),ep(1,0),ep(0,1),ep(1,0),ep(1,1),ep(0,1)];let gNt=class{constructor(){this.layout=uGe}elementCount(e){return 6*e.get("position").indices.length}write(e,i,r,s,n,a){ope(r.get("position"),e,n.position,a,6),lpe(r.get("normal"),i,n.normal,a,6),fL(r.get("centerOffsetAndDistance"),n.centerOffsetAndDistance,a,6);for(let o=0;o<fCe.length;++o)n.uv0.setVec(a+o,fCe[o]);return null}};var FT;let yNt=(FT=class extends tNt{constructor(e,i){super(e,null,i,bNt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new zX(this._materialParameters,this._context.spherical)}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new hGe,i=this.symbol,r=i.callout;if(r.color){const a=Je.toUnitRGBA(r.color);a[3]*=this._getLayerOpacity(),e.color=a}else e.color=Tn;if(e.size=d1(r.size||0),i.verticalOffset){const{screenLength:a,minWorldLength:o,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:d1(a),minWorldLength:o||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?Je.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s&&!ie("enable-feature:non-occluded-hud"),s&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this.view.screenSizePerspective.parameters:null,e}_defaultElevationInfoNoZ(){return _Nt}createGraphics3DGraphic(e,i){const r=e.renderingInfo,s=e.graphic,n=this.createElevationContextForGraphic(s,r.elevationOffset||0),a=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(a.type==="cim"||!a.symbolLayers.some(u=>u.type==="object"||u.type==="text"));if(a.type!=="label-3d"&&o||a.type==="point-3d"&&a.symbolLayers.every(u=>u.type==="text"&&!Tgt(u)))return null;const l=dqe(s.geometry);return l==null?null:this._createAs3DShape(l,n,r,s.uid,i)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerScreenSizePerspectiveChanged(){const e=this._context.screenSizePerspectiveEnabled?this.view.screenSizePerspective.parameters:null;this._materials[0]?.setParameters({screenSizePerspective:e})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=U5t(FT.elevationModeChangeTypes,r,s);return n!==1||e?.forEach(a=>{const o=i(a);o!=null&&this.graphics3DGraphicLayerElevationInfoChanged(a.graphic,o)}),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}createElevationContextForGraphic(e,i=0){const r=super.createElevationContextForGraphic(e);return r.addOffsetRenderUnits(i),r}updateElevationContextForGraphic(e,i,r=0){super.updateElevationContextForGraphic(e,i),e.addOffsetRenderUnits(r)}graphics3DGraphicLayerElevationInfoChanged(e,i){const{elevationContext:r,metadata:s}=i;this.updateElevationContextForGraphic(r,e,s?.elevationOffset??0),i.needsElevationUpdates=F$e(r.mode)}computeComplexity(){return new Wd({verticesPerFeature:6})}_getOrCreateMaterial(e,i){const r=this._perInstanceMaterialParameters(e),s=Zae(r);if(s===this._materials[0]?.uniqueMaterialIdentifier)return this._materials[0];if(i){let n=i.get(s);return n==null&&(n=new zX(r,this._context.spherical),i.set(s,n)),n}return new zX(r,this._context.spherical)}_createAs3DShape(e,i,r,s,n){const a=this._context.layerViewUid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerViewUid:a}),l=this._getOrCreateMaterial(r,n),u=new Qc(l,vNt(r),null,1,o),d=lNt(this._context,e,u,i,s);if(d==null)return null;const f=new pqe(this,d.object,null,aLt,i);return f.metadata=new yLt(r.elevationOffset),f.alignedSampledElevation=d.sampledElevation,f.needsElevationUpdates=F$e(i.mode),cNt(f,e,this._context.elevationProvider),f}},FT.elevationModeChangeTypes={definedChanged:1,staysOnTheGround:1,onTheGroundChanged:2},FT);function vNt(t){const{translation:e,centerOffset:i}=t,r=new ki(e?[e[0],e[1],e[2]]:[0,0,0],NX,3,!0),s=new ki(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],NX,4,!0);return[["position",r],["normal",new ki([0,0,1],NX,3,!0)],["centerOffsetAndDistance",s]]}const NX=[0],_Nt={mode:"relative-to-ground",offset:0},bNt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let wNt=class extends j5t{constructor(e,i,r=I(),s=li(),n=0,a="world",o=0){super(e,i),this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=a,this.elevationOffset=o}},xNt=class extends cLt{};const mCe=()=>re.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function SNt(t,e){if(!DLe(t))return mCe().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=TNt[t.callout.type];return i?new i(t,e):(mCe().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const TNt={line:yNt};function m1i(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function $Nt(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function QF(t){if($Nt(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function CNt({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function MNt({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function ENt({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function ANt({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function XF({scale:t,translate:e},i){return i*t[0]+e[0]}function KF({scale:t,translate:e},i){return i*t[1]+e[1]}function yL({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function vL({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function zpe(t,e){return t&&e?INt:t&&!e?PNt:!t&&e?RNt:ONt}const ONt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=XF(t,r[0]),n=KF(t,r[1]);i[0]=[s,n];const{scale:a,originPosition:o}=t,l=a[0],u=o==="lowerLeft"?a[1]:-a[1];for(let d=1;d<e.length;d++){const[f,g]=e[d];s+=l*f,n+=u*g,i[d]=[s,n]}return i},PNt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=XF(t,r[0]),n=KF(t,r[1]);i[0]=[s,n,yL(t,r[2])];const{scale:a,originPosition:o}=t,l=a[0],u=o==="lowerLeft"?a[1]:-a[1];for(let d=1;d<e.length;d++){const[f,g,v]=e[d];s+=l*f,n+=u*g,i[d]=[s,n,yL(t,v)]}return i},RNt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=XF(t,r[0]),n=KF(t,r[1]);i[0]=[s,n,vL(t,r[2])];const{scale:a,originPosition:o}=t,l=a[0],u=o==="lowerLeft"?a[1]:-a[1];for(let d=1;d<e.length;d++){const[f,g,v]=e[d];s+=l*f,n+=u*g,i[d]=[s,n,vL(t,v)]}return i},INt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=XF(t,r[0]),n=KF(t,r[1]);i[0]=[s,n,yL(t,r[2]),vL(t,r[3])];const{scale:a,originPosition:o}=t,l=a[0],u=o==="lowerLeft"?a[1]:-a[1];for(let d=1;d<e.length;d++){const[f,g,v,_]=e[d];s+=l*f,n+=u*g,i[d]=[s,n,yL(t,v),vL(t,_)]}return i};function dGe(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function g1i(t,e,i){const r=QF(t);return e.x=CNt(r,i.x),e.y=MNt(r,i.y),i.z!=null&&(e.z=ENt(r,i.z)),i.m!=null&&(e.m=ANt(r,i.m)),e}function DNt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=QF(t);e.points=zpe(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function kNt(t,e,i,r=i?.z!=null,s=i?.m!=null){if(i==null)return e;const n=QF(t);return e.x=XF(n,i.x),e.y=KF(n,i.y),r&&(e.z=yL(n,i.z)),s&&(e.m=vL(n,i.m)),e}function LNt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=QF(t);e.rings=dGe(n,zpe(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function FNt(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=QF(t);e.paths=dGe(n,zpe(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}function y1i(){return ie("curve-densification-coarse-segments")}function zNt(){return ie("curve-densification-max-segments")}function v1i(){return ie("curve-densification-min-segments")}function _1i(){return ie("curve-densification-pixel-deviation")}let b1i=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function x1i(t){return t.geometry!=null}let S1i=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function $1i(t,e){const i=cDe.fromJSON(t.geometryType),r=Me.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,a=e?.maxStringAttributeLength,o=e?.maxStringAttributeFields;let l;const u=t.features.map(d=>{const f=NNt(d,i,r,t.objectIdFieldName),g=f.geometry;if(qNt(f.attributes,o,a,v=>{l??=[];const _=BNt(f,n);_!=null&&l.push({objectId:_,attribute:v})}),g!=null&&s)switch(g.type){case"point":f.geometry=kNt(s,g,g);break;case"multipoint":f.geometry=DNt(s,g,g);break;case"polygon":f.geometry=LNt(s,g,g);break;case"polyline":f.geometry=FNt(s,g,g);break;case"extent":case"mesh":f.geometry=g}return f});return{geometryType:i,features:u,spatialReference:r,fields:t.fields?.map(d=>vo.fromJSON(d))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function NNt(t,e,i,r){return{uid:Gc(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:VNt(t.geometry,e,i),visible:!0}}function VNt(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function jNt(t){if(t==null)return 0;switch(t.type){case"point":return Kv+10+8+24;case"polyline":case"polygon":{let e=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.type==="polyline"?t.paths:t.rings;if((t.type==="polyline"?t.curvePaths:t.curveRings)?.length){const n=3*zNt()*128;e=8*n*i+128*n+32*(r.length+1)}else e=fG(r);return Kv+64+e+34}case"multipoint":{const e=fG(t.points);return Kv+e+64+34+32}case"extent":return Kv+10+64+34;case"mesh":{const e=t.vertexAttributes;return Kv+n$(e.position,e.normal,e.uv,e.tangent)}default:return Kv}}function C1i(t){let e=32;return e+=dde(t.attributes),e+=3,e+=8+jNt(t.geometry),e}function M1i(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function E1i(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function A1i(t,e){switch(Wu(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)EJ(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)EJ(e,t.rings[i],!!t.hasZ);break;case"multipoint":EJ(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}return e}function UNt(t,e){switch(R0(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)iJ(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)iJ(e,t.rings[i]);break;case"multipoint":iJ(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function BNt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function qNt(t,e,i,r){if(e?.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}function Npe(t,e){return t?e?4:3:e?3:2}function GNt(t,e,i,r){if(!e?.lengths.length)return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const s=t.coords,n=[],a=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:o,coords:l}=e,u=Npe(i,r);let d=0;for(const f of o){const g=HNt(a,l,d,f,i,r);g&&n.push(g),d+=f*u}if(n.sort((f,g)=>{let v=f[2]-g[2];return v===0&&i&&(v=f[4]-g[4]),v}),n.length){let f=6*n[0][2];s[0]=n[0][0]/f,s[1]=n[0][1]/f,i&&(f=6*n[0][4],s[2]=f!==0?n[0][3]/f:0),(s[0]<a[0]||s[0]>a[1]||s[1]<a[2]||s[1]>a[3]||i&&(s[2]<a[4]||s[2]>a[5]))&&(s.length=0)}if(!s.length){const f=e.lengths[0]?WNt(l,0,o[0],i,r):null;if(!f)return null;s[0]=f[0],s[1]=f[1],i&&f.length>2&&(s[2]=f[2])}return t}function HNt(t,e,i,r,s,n){const a=Npe(s,n);let o=i,l=i+a,u=0,d=0,f=0,g=0,v=0;for(let x=0,S=r-1;x<S;x++,o+=a,l+=a){const T=e[o],M=e[o+1],E=e[o+2],P=e[l],O=e[l+1],D=e[l+2];let L=T*O-P*M;g+=L,u+=(T+P)*L,d+=(M+O)*L,s&&(L=T*D-P*E,f+=(E+D)*L,v+=L),T<t[0]&&(t[0]=T),T>t[1]&&(t[1]=T),M<t[2]&&(t[2]=M),M>t[3]&&(t[3]=M),s&&(E<t[4]&&(t[4]=E),E>t[5]&&(t[5]=E))}if(g>0&&(g*=-1),v>0&&(v*=-1),!g)return null;const _=[u,d,.5*g];return s&&(_[3]=f,_[4]=.5*v),_}function WNt(t,e,i,r,s){const n=Npe(r,s);let a=e,o=e+n,l=0,u=0,d=0,f=0;for(let g=0,v=i-1;g<v;g++,a+=n,o+=n){const _=t[a],x=t[a+1],S=t[a+2],T=t[o],M=t[o+1],E=t[o+2],P=r?YNt(_,x,S,T,M,E):ZNt(_,x,T,M);if(P)if(l+=P,r){const O=QNt(_,x,S,T,M,E);u+=P*O[0],d+=P*O[1],f+=P*O[2]}else{const O=JNt(_,x,T,M);u+=P*O[0],d+=P*O[1]}}return l>0?r?[u/l,d/l,f/l]:[u/l,d/l]:i>0?r?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function ZNt(t,e,i,r){const s=i-t,n=r-e;return Math.sqrt(s*s+n*n)}function YNt(t,e,i,r,s,n){const a=r-t,o=s-e,l=n-i;return Math.sqrt(a*a+o*o+l*l)}function JNt(t,e,i,r){return[t+.5*(i-t),e+.5*(r-e)]}function QNt(t,e,i,r,s,n){return[t+.5*(r-t),e+.5*(s-e),i+.5*(n-i)]}const Rx=2;let Bu=class z3{constructor(e=[],i=[]){this.lengths=e??[],this.coords=i??[]}static fromJSON(e){return new z3(e.lengths,e.coords)}static fromRect(e){const[i,r,s,n]=e,a=s-i,o=n-r;return new z3([5],[i,r,a,0,0,o,-a,0,0,-o])}get isPoint(){return this.lengths.length===0&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}get usedMemory(){return 64+n$(this.lengths,this.coords)}area(){let e=0,i=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];if(s<3)continue;let n=this.coords[Rx*i],a=this.coords[Rx*i+1];for(let o=1;o<s;o+=1){const l=this.coords[Rx*(o+i)],u=this.coords[Rx*(o+i)+1];e+=-.5*(l-n)*(u+a),n=l,a=u}i+=s}return e}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[Rx*(n+i)],this.coords[Rx*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let a=1;a<n;a++)i[2*(s+a)]+=i[2*(s+a)-2],i[2*(s+a)+1]+=i[2*(s+a)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new z3([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*Rx,r=this.coords.slice(0,i);return e?(e.set(r),new z3(this.lengths,e)):new z3(Array.from(this.lengths),Array.from(r))}},QO=class GB{constructor(e=null,i={},r,s,n=0){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=n}static fromJSON(e){const i=e.geometry?Bu.fromJSON(e.geometry):null,r=e.centroid?Bu.fromJSON(e.centroid):null,s=e.objectId;return new GB(i,e.attributes,r,s)}weakClone(){const e=new GB(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),i=new GB(e,{...this.attributes},this.centroid?.clone(),this.objectId);return i.displayId=this.displayId,i}ensureCentroid(e){return this.centroid??=GNt(new Bu,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+dde(this.attributes)+(this.geometry?.usedMemory??0)}};function O1i(t){return!!t.geometry?.coords?.length}let XNt=class pGe{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new pGe;return e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function Yo(t,e){return t?e?4:3:e?3:2}const ZH=()=>re.getLogger("esri.layers.graphics.featureConversionUtils"),Vpe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},KNt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},gCe=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},eVt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},tVt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function jpe(t,e,i,r){if(t){if(i)return e&&r?tVt:gCe;if(e&&r)return eVt}else if(e&&r)return gCe;return KNt}function VX({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function jX({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function UX({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function BX({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function qX({scale:t,translate:e},i,r){return i*t[r]+e[r]}function P1i(t,e,i){return t?e?i?qpe(t):Upe(t):i?Bpe(t):YH(t):null}function YH(t){const e=t.coords;return{x:e[0],y:e[1]}}function fGe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function Upe(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function iVt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function Bpe(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function rVt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function qpe(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function sVt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function nVt(t,e,i,r){let s=YH;i&&r?s=qpe:i?s=Upe:r&&(s=Bpe);for(const n of e){const{geometry:a,attributes:o}=n,l=a!=null?s(a):null;t.push({attributes:o,geometry:l})}return t}function Gpe(t,e){return t&&e?sVt:t?iVt:e?rVt:fGe}function aVt(t,e,i,r,s){const n=Gpe(i,r);for(const a of e){const o=a.geometry!=null?n(new Bu,a.geometry):null;t.push(new QO(o,a.attributes,null,wF(a,s)))}return t}function oVt(t,e,i=Gpe(e.z!=null,e.m!=null)){return i(t,e)}function lVt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?mGe(s,i,r):null});return t}function mGe(t,e,i){if(t==null)return null;const r=Yo(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const a=[];for(let o=0;o<r;o++)a.push(t.coords[n+o]);s.push(a)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function cVt(t,e,i,r,s){const n=Yo(i,r);for(const a of e){const o=a.geometry!=null?gGe(new Bu,a.geometry,n):null;t.push(new QO(o,a.attributes,null,wF(a,s)))}return t}function gGe(t,e,i=Yo(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let a=0;a<i;a++)r[s++]=n[a];return t}function uVt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?yGe(s,i,r):null});return t}function yGe(t,e,i){if(!t)return null;const r=Yo(e,i),{coords:s,lengths:n}=t,a=[];let o=0;for(const l of n){const u=[];for(let d=0;d<l;d++){const f=[];for(let g=0;g<r;g++)f.push(s[o++]);u.push(f)}a.push(u)}return e?i?{paths:a,hasZ:e,hasM:i}:{paths:a,hasZ:e}:i?{paths:a,hasM:i}:{paths:a}}function hVt(t,e,i,r,s){const n=Yo(i,r);for(const a of e){const o=a.geometry!=null?vGe(new Bu,a.geometry,n):null,l=a.centroid!=null?oVt(new Bu,a.centroid):null;t.push(new QO(o,a.attributes,l,wF(a,s)))}return t}function vGe(t,e,i=Yo(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const a of e.paths){for(const o of a)for(let l=0;l<i;l++)s[n++]=o[l];r.push(a.length)}return t}function dVt(t,e,i,r){for(const{geometry:s,attributes:n,centroid:a}of e){const o=s!=null?_Ge(s,i,r):null;if(a!=null){const l=YH(a);t.push({attributes:n,centroid:l,geometry:o})}else t.push({attributes:n,geometry:o})}return t}function _Ge(t,e,i){if(!t)return null;const r=Yo(e,i),{coords:s,lengths:n}=t,a=[];let o=0;for(const l of n){const u=[];for(let d=0;d<l;d++){const f=[];for(let g=0;g<r;g++)f.push(s[o++]);u.push(f)}a.push(u)}return e?i?{rings:a,hasZ:e,hasM:i}:{rings:a,hasZ:e}:i?{rings:a,hasM:i}:{rings:a}}function pVt(t,e,i,r,s){for(const n of e){const a=n.geometry!=null?bGe(new Bu,n.geometry,i,r):null,o=wF(n,s);n.centroid!=null?t.push(new QO(a,n.attributes,fGe(new Bu,n.centroid),o)):t.push(new QO(a,n.attributes,null,o))}return t}function bGe(t,e,i=e.hasZ,r=e.hasM){return fVt(t,e.rings,i,r)}function fVt(t,e,i,r){const s=Yo(i,r),{lengths:n,coords:a}=t;let o=0;C0(t);for(const l of e){for(const u of l)for(let d=0;d<s;d++)a[o++]=u[d];n.push(l.length)}return t}const fA=[],i5=[];function R1i(t,e,i,r,s){fA[0]=t;const[n]=wGe(i5,fA,e,i,r,s);return pm(fA),pm(i5),n}function wGe(t,e,i,r,s,n){if(pm(t),!i){for(const a of e){const o=wF(a,n);t.push(new QO(null,a.attributes,null,o))}return t}switch(i){case"esriGeometryPoint":return aVt(t,e,r,s,n);case"esriGeometryMultipoint":return cVt(t,e,r,s,n);case"esriGeometryPolyline":return hVt(t,e,r,s,n);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return pVt(t,e,r,s,n);default:ZH().error("convertToFeatureSet:unknown-geometry",new q("internal:geometry",`Unable to parse unknown geometry type '${i}'`)),pm(t)}return t}function I1i(t,e,i,r){i5[0]=t,xGe(fA,i5,e,i,r);const s=fA[0];return pm(fA),pm(i5),s}function mVt(t,e,i){if(t==null)return null;const r=new Bu;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),Ece(t)?Gpe(e??t.z!=null,i??t.m!=null)(r,t):AS(t)?bGe(r,t,e,i):Ace(t)?vGe(r,t,Yo(e,i)):Mce(t)?gGe(r,t,Yo(e,i)):void ZH().error("convertFromGeometry:unknown-geometry",new q("internal:geometry",`Unable to parse unknown geometry type '${t}'`))}function gVt(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=YH;return i&&r?n=qpe:i?n=Upe:r&&(n=Bpe),n(s)}case"esriGeometryMultipoint":return mGe(s,i,r);case"esriGeometryPolyline":return yGe(s,i,r);case"esriGeometryPolygon":return _Ge(s,i,r);default:return ZH().error("convertToGeometry:unknown-geometry",new q("internal:geometry",`Unable to parse unknown geometry type '${e}'`)),null}}function yVt(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function xGe(t,e,i,r,s){if(pm(t),i==null)return yVt(t,e);switch(i){case"esriGeometryPoint":return nVt(t,e,r,s);case"esriGeometryMultipoint":return lVt(t,e,r,s);case"esriGeometryPolyline":return uVt(t,e,r,s);case"esriGeometryPolygon":return dVt(t,e,r,s);default:ZH().error("convertToFeatureSet:unknown-geometry",new q("internal:geometry",`Unable to parse unknown geometry type '${i}'`))}return t}function D1i(t){const{spatialReference:e,transform:i,fields:r,hasM:s,hasZ:n,features:a,geometryType:o,exceededTransferLimit:l,queryGeometry:u,queryGeometryType:d}=t,f={features:xGe([],a,o,n,s),fields:r,geometryType:o,spatialReference:e,queryGeometry:gVt(u,d,!1,!1)};return i&&(f.transform=i),l&&(f.exceededTransferLimit=l),s&&(f.hasM=s),n&&(f.hasZ=n),f}function k1i(t,e){const i=new XNt,{hasM:r,hasZ:s,features:n,spatialReference:a,geometryType:o,exceededTransferLimit:l,transform:u,fields:d}=t;return d&&(i.fields=d),i.geometryType=o??null,i.spatialReference=a??null,n&&wGe(i.features,n,o,s,r,e),l&&(i.exceededTransferLimit=l),r&&(i.hasM=r),s&&(i.hasZ=s),u&&(i.transform=u),i}function L1i(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&vCe(n.geometry,n.geometry,r,s,e),n.centroid!=null&&vCe(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function F1i(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let a=0;a<r.length;a++){const o=r[a],l=o.weakClone();l.geometry=new Bu,yCe(l.geometry,o.geometry,s,n,i,t),o.centroid&&(l.centroid=new Bu,yCe(l.centroid,o.centroid,s,n,"esriGeometryPoint",t)),r[a]=l}return e.transform=t,e}function yCe(t,e,i,r,s,n,a=i,o=r){if(C0(t),!e?.coords.length)return null;const l=Vpe[s],{coords:u,lengths:d}=e,f=Yo(i,r),g=Yo(i&&a,r&&o),v=jpe(i,r,a,o);if(!d.length)return v(t.coords,u,0,0,VX(n,u[0]),jX(n,u[1])),C0(t,f,0),t;let _,x,S,T,M=0,E=0,P=E;for(const O of d){if(O<l)continue;let D=0;E=P,S=_=VX(n,u[M]),T=x=jX(n,u[M+1]),v(t.coords,u,E,M,S,T),D++,M+=f,E+=g;for(let L=1;L<O;L++,M+=f)S=VX(n,u[M]),T=jX(n,u[M+1]),S===_&&T===x||(v(t.coords,u,E,M,S-_,T-x),E+=g,D++,_=S,x=T);D>=l&&(t.lengths.push(D),P=E)}return pm(t.coords,P),t.coords.length?t:null}function z1i(t,e,i,r,s,n,a=i,o=r){if(C0(t),!e?.coords.length)return null;const l=Vpe[s],{coords:u,lengths:d}=e,f=Yo(i,r),g=Yo(i&&a,r&&o),v=jpe(i,r,a,o);if(!d.length)return v(t.coords,u,0,0,u[0],u[1]),C0(t,f,0),t;let _=0;const x=n*n;for(const S of d){if(S<l){_+=S*f;continue}const T=t.coords.length/g,M=_,E=_+(S-1)*f;v(t.coords,u,t.coords.length,M,u[M],u[M+1]),Yae(t.coords,u,f,x,v,M,E),v(t.coords,u,t.coords.length,E,u[E],u[E+1]);const P=t.coords.length/g-T;P>=l?t.lengths.push(P):pm(t.coords,T*g),_+=S*f}return t.coords.length?t:null}function vVt(t,e,i,r){const s=t[e],n=t[e+1],a=t[i],o=t[i+1],l=t[r],u=t[r+1];let d=a,f=o,g=l-d,v=u-f;if(g!==0||v!==0){const _=((s-d)*g+(n-f)*v)/(g*g+v*v);_>1?(d=l,f=u):_>0&&(d+=g*_,f+=v*_)}return g=s-d,v=n-f,g*g+v*v}function Yae(t,e,i,r,s,n,a){let o,l=r,u=0;for(let d=n+i;d<a;d+=i)o=vVt(e,d,n,a),o>l&&(u=d,l=o);l>r&&(u-n>i&&Yae(t,e,i,r,s,n,u),s(t,e,t.length,u,e[u],e[u+1]),a-u>i&&Yae(t,e,i,r,s,u,a))}function N1i(t,e,i,r){if(!e?.coords?.length)return null;const s=Yo(i,r);let n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let d=0;d<u.length;d+=s){const f=u[d],g=u[d+1];n=Math.min(n,f),o=Math.max(o,f),a=Math.min(a,g),l=Math.max(l,g)}}return Hie(t)?rgt(t,n,a,o,l):o7(n,a,o,l,t),t}function vCe(t,e,i,r,s){const{coords:n,lengths:a}=e,o=Yo(i,r);if(!n.length)return t!==e&&C0(t),t;cP(s);const{originPosition:l,scale:u,translate:d}=s,f=wVt;f.originPosition=l;const g=f.scale;g[0]=u[0]??1,g[1]=-(u[1]??1),g[2]=u[2]??1,g[3]=u[3]??1;const v=f.translate;if(v[0]=d[0]??0,v[1]=d[1]??0,v[2]=d[2]??0,v[3]=d[3]??0,!a.length){for(let x=0;x<o;++x)t.coords[x]=qX(f,n[x],x);return t!==e&&C0(t,o,0),t}let _=0;for(let x=0;x<a.length;x++){const S=a[x];t.lengths[x]=S;for(let E=0;E<o;++E)t.coords[_+E]=qX(f,n[_+E],E);let T=t.coords[_],M=t.coords[_+1];_+=o;for(let E=1;E<S;E++,_+=o){T+=n[_]*g[0],M+=n[_+1]*g[1],t.coords[_]=T,t.coords[_+1]=M;for(let P=2;P<o;++P)t.coords[_+P]=qX(f,n[_+P],P)}}return t!==e&&C0(t,n.length,a.length),t}function V1i(t,e,i,r,s,n){if(C0(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let a=0;a<e.coords.length;a++)t.coords.push(e.coords[a]);else{const a=Yo(i,r),o=jpe(i,r,s,n),l=e.coords;for(let u=0;u<l.length;u+=a)o(t.coords,l,t.coords.length,u,l[u],l[u+1])}return t}function _Vt(t,e,i,r){let s=0,n=t[r*e],a=t[r*(e+1)];for(let o=1;o<i;o++){const l=n+t[r*(e+o)],u=a+t[r*(e+o)+1],d=(l-n)*(u+a);n=l,a=u,s+=d}return .5*s}function j1i(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let a=0;a<r.length;a++){const o=r[a];n+=_Vt(i,s,o,e),s+=o}return Math.abs(n)}function bVt(t,e,i,r){return t*r-i*e===0&&t*i+e*r>0}function U1i(t,e,i,r,s){const n=Yo(r,s);if(!t.lengths.length){if(t.coords.length<2)return null;const[f,g]=t.coords,v=UX(e,f),_=BX(e,g);return new Bu([],[v,_])}const a=new Bu([],[0,0]),o=Vpe[i],l=i==="esriGeometryPolygon"||i==="esriGeometryPolyline";let u=0,d=0;for(let f=0;f<t.lengths.length;f++){const g=t.lengths[f],v=d;let _=UX(e,t.coords[n*u]),x=BX(e,t.coords[n*u+1]);a.coords[d++]=_,a.coords[d++]=x;let S=0,T=0,M=1;for(let E=1;E<g;E++){const P=UX(e,t.coords[n*(E+u)]),O=BX(e,t.coords[n*(E+u)+1]);if(P!==_||O!==x){const D=P-_,L=O-x;l&&bVt(S,T,D,L)?(a.coords[d-2]+=D,a.coords[d-1]+=L,_+=D,x+=L):(a.coords[d++]=P,a.coords[d++]=O,_=P,x=O,S=D,T=L,M+=1)}}M<o?d=v:a.lengths.push(M),u+=g}return a.lengths.length===0?null:a}function C0(t,e=0,i=0){pm(t.lengths,i),pm(t.coords,e)}function pm(t,e=0){t.length!==e&&(t.length=e)}const wVt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},_Ce=new Wc(()=>nc(),t=>F7(t,$Le),null,10,5),xVt=fi();let SVt=class{get labelLayers(){return this._labelLayers||zet}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,i,r){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=255,++i.referenced}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(16))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=1,i){const r=i?this._visibleFlags|i|16*i:this._visibleFlags;return e===1?!(15&~r):!(255&~r)}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===16)this._forEachLabelGraphic(a=>a.setVisibility(n));else{this._forEachSymbolLayerGraphic(o=>o.setVisibility(n));const a=this.isVisible(16);this._forEachLabelGraphic(o=>o.setVisibility(a))}return!0}getVisibilityFlag(e,i){return(this._visibleFlags&e*i)!==0}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=fi(),UNt(i,this._extent);const r=i.spatialReference;if(!zr(r,e)&&!Hhe(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Wr.fromExtent(s.type==="mesh"?s.extent:s)),mVt(s,i,r)}get usedMemory(){let e=dde(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:I(),num:0},draped:{origin:Ke(),num:0}};for(const i of this.layers)i?.computeAttachmentOrigin(e);return e.render.num>1&&he(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Nh(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Wu(n.boundingBox):n.boundingBox=Wu(),n.requiresDrapedElevation=!1,await rue(this.layers,async a=>{if(a==null)return;const o=a.type==="draped"?i:e,l=_Ce.acquire(),u=await a.getProjectedBoundingBox(o,r,n.screenSpaceObjects,s,l);isFinite(u[2])&&isFinite(u[5])||(n.requiresDrapedElevation=!0),u&&wLe(n.boundingBox,l),_Ce.release(l)}),Xmt(n.boundingBox)||dte(Rue(n.boundingBox,xVt))?n:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(i=>i.updateHighlights(e))}_forEachGraphicList(e,i){e?.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},q1i=class{constructor(e,i,r,s){this.scheduler=e,this.schedule=i,this.layerViewUid=r,this.compressionTracker=s,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===1}},TVt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};const $Vt=2216,CVt=4096;function SGe(t){return $Vt+CVt*t.symbolLayers.length+t.complexity.memory.resourceBytes}let MVt=class extends Fpe{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];if(!GX){const{make:n}=await W(()=>import("./Graphics3DSymbolLayerFactory-Cul0xCMl.js"),__vite__mapDeps([412,407,20,319,393,29,55,56,50,54,57,47,113,112,334,392,387,369,413,414,31,32,415,302,416,144,417,290,143,418,366,289]));GX=n}for(let n=0;n<r;n++){const a=i.at(n);if(a.enabled===!1)continue;kj.renderPriority=1-(1+n)/r,kj.renderPriorityStep=1/r,kj.ignoreDrivers=a.ignoreDrivers;const o=GX(this.symbol,a,this._context,kj),l=GL(e,()=>{this.symbolLayers[n]=null,o.destroy()});l&&s.push(l),this.symbolLayers[n]=o}if(await rue(this.symbolLayers,async(n,a)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[a]=null}}),s.forEach(n=>n.remove()),ct(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}get needsUpdateFocus(){return this.symbolLayers.some(e=>e?.needsUpdateFocus===!0)}createGraphics3DGraphic(e,i){const{graphic:r}=e,s=this.symbolLayers.map(n=>n?.createGraphics3DGraphic(e)??null);return new SVt(r,i||this,s)}get complexity(){return Lpe(this.symbolLayers.map(e=>e?.complexity))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],a=o=>{const l=o.layers[s];return l instanceof pqe?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,a))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==1?0:this.symbolLayers.reduce((r,s)=>r!==0&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,2)}prepareSymbolPatch(e){if(this.loadStatus===2||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const a=r[n];if(a){const o={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(o),e.symbolStatePatches.push(...o.symbolLayerStatePatches),o.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,u)=>{const d=l.layers[n];d!=null&&o.graphics3DGraphicPatches.forEach(f=>f(d,u))})}})}updateGeometry(e){return this._updateGeometryOrTransform(e,(i,r)=>!!i.updateGeometry&&i.updateGeometry(e.graphic,r))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,a)=>!!n.updateTransform&&n.updateTransform(a,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=!1,i=!1;for(const r of this.symbolLayers)if(r!=null){if(r.loadStatus===0)return 3;r.isFastUpdatesEnabled()?i=!0:e=!0}return i?e?2:1:e?0:4}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(wl).filter(o=>o.queryForSnapping!=null).map(o=>o.queryForSnapping(e,i,r,s)),a=await Promise.all(n);return ct(s),a.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get usedMemory(){return SGe(this)}},GX=null;const kj=new TVt;let EVt=class extends Fpe{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:eGe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):0}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e)}updateTransform(e,i,r,s){return this.graphics3DSymbol?.updateTransform(e,i,r,s)??!1}onRemoveGraphic(){}get needsUpdateFocus(){return!1}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??3}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}get usedMemory(){return SGe(this)}};function Jae(t){return t instanceof EVt?t.graphics3DSymbol:t instanceof MVt?t:null}const Y1i=1.2,J1i=Tn,AVt=4;let OVt=class{constructor(e,i="center",r=!1,s=Ke(),n=$i(0,0,0,-1),a="world",o=I(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=a,this.translation=o,this.elevationOffset=l}},PVt=class{constructor(e,i="center",r="center",s=null,n=Ke(),a=!0){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n,this.isFocused=a}};function Qae(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function RVt(t){const{size:e}=t.definition,i=t.fontString(e);let r=bCe.get(i);if(!r){const s=Qae(DVt,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(kVt);r=new IVt(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),bCe.set(i,r)}return r}const bCe=new Map;let IVt=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const DVt={canvas:null},kVt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),HG=1;let LVt=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=Qae(wCe,Lj,Lj).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let a=0,o=0,l=0,u=0,d=0;this._lines.forEach((T,M)=>{const E=e.measureText(T),P=E.width/i,O=P+s;this._textWidths.push(P),this._lineWidths.push(O),a=Math.max(a,O),u=Math.max(u,E.actualBoundingBoxAscent/i),d=Math.max(d,E.actualBoundingBoxDescent/i),M===0&&(o=E.actualBoundingBoxAscent/i),M===this._lines.length-1&&(l=E.actualBoundingBoxDescent/i)});const f=RVt(this._parameters),g=Math.max(u,f.maxAscent),v=Math.max(d,f.maxDescent),_=o,x=this._parameters.definition.font.decoration==="underline"?v:l,S=a;this._metricsCached=new zVt(_,x,g,v,S)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*FVt}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,HG)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case 0:return this._horizontalPadding;case 1:return(this.displayWidth-this._lineWidths[e])/2;case 2:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,a=this._haloSize,o=this._firstLineYOffset+this._metrics.firstLineAscent;i+=a,r+=o;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,a,o),this._parameters.setFontProperties(e,this._renderedFontSize);for(let u=0;u<this._lines.length;++u){const d=this._lines[u],f=this._getLineXOffset(u);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,d,i+f,r),this._renderLineDecoration(e,i+f,r,this._textWidths[u])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,d,i+this._getLineXOffset(u),r),this._renderLineDecoration(e,i+f,r,this._textWidths[u]),r+=this._lineSpacing}if(bn.TEXT_SHOW_BASELINE){e.strokeStyle=xCe,e.setLineDash([2,2]),e.lineWidth=1;let u=n+o;for(let d=0;d<this._lines.length;++d)this._drawLine(e,[s,u],[s+this.displayWidth,u]),u+=this._lineSpacing}if(bn.TEXT_SHOW_BORDER&&(e.strokeStyle=xCe,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const u=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,u),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const a=1,o=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":r+=2*o;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(o+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,a=this.renderedHeight;s!==0?(s=Ce(s,0,Math.floor(a/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+a-s),e.arcTo(i+n,r+a,i+n-s,r+a,s),e.lineTo(i+s,r+a),e.arcTo(i,r+a,i,r+a-s,s),e.closePath()):e.rect(i,r,n,a)}_renderHalo(e,i,r,s,n){const a=this.renderedWidth,o=this.renderedHeight,l=Qae(wCe,Math.max(a,Lj),Math.max(o,Lj)),u=l.getContext("2d");u.clearRect(0,0,a,o),this._parameters.setFontProperties(u,this._renderedFontSize),u.fillStyle=this._parameters.haloStyle,u.strokeStyle=this._parameters.haloStyle;const d=this._renderedHaloSize<3;u.lineJoin=d?"miter":"round",d?this._renderHaloEmulated(u,s,n):this._renderHaloNative(u,s,n);let f=n;for(let g=0;g<this._lines.length;++g){const v=this._getLineXOffset(g);this._renderLineDecoration(u,s+v,f,this._textWidths[g],!0),f+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,a,o,this._toRenderUnit(i),this._toRenderUnit(r),a,o),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],a=this._getLineXOffset(s);for(const[o,l]of TGe)this._fillText(e,n,i+a+this._haloSize*o,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const a=this._lines[n],o=this._getLineXOffset(n),l=5,u=.1;for(let d=0;d<l;d++){const f=1-(l-1)*u+d*u;e.lineWidth=this._toRenderUnit(f*s),this._strokeText(e,a,i+o,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),a=this._toRenderUnit(r[0]),o=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,u=Math.ceil(s+a)-.5,d=Math.floor(n)+.5,f=Math.ceil(n+o)-.5;e.beginPath(),e.moveTo(l,d),e.lineTo(u,d),e.lineTo(u,f),e.lineTo(l,f),e.lineTo(l,d),e.stroke()}};const TGe=[];for(let e=0;e<360;e+=360/16)TGe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);const wCe={canvas:null},FVt=.2,Lj=512,xCe="rgb(255, 0, 255, 0.5)";let zVt=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const DI=()=>re.getLogger("esri.views.3d.layers.graphics.labelPlacement");let SCe=class{constructor(e,i,r,s=null){this._graphic=e,this._symbol=i,this._class=r,this._disablePlacement=s}get placement(){const e=this._verticalOffsetPlacement;if(e==null)return null;const i=this._getPlacementInfo(e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset,a=new OVt(n,r,s);return this._calculatePlacementOffsets(a,i)}get _verticalOffsetPlacement(){const e=this._class.labelPlacement,{_symbol:i,_graphic:r}=this,s=Jae(r.graphics3DSymbol),n=s?.symbol.type==="point-3d"?s.symbol:null,a=np[e]||this._defaultPlacementInfo;return n?.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i?.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:a&&NVt(a.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(DI().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}_getPlacementInfo(e){if(e.anchor)return e;const i=this._class.labelPlacement,r=np[i],s=r||this._defaultPlacementInfo;return i&&!r&&DI().warnOnce(`the requested label placement '${i}' is currently unsupported in SceneView.`),this._validatePlacementInfo(s)}_calculatePlacementOffsets(e,i){const r=this._graphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":this._setPointSpecificPlacement(e,i);break;case"mesh":this._setMeshSpecificPlacement(e,i);break;case"polygon":this._setPolygonSpecificPlacement(e,i)}const s=AVt-HG;return e.screenOffset[0]+=s*i.normalizedOffset[0],e.screenOffset[1]+=s*i.normalizedOffset[1],e}get _defaultPlacementInfo(){const e=this._graphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Aa,anchor:"center"};case"polygon":return this._firstSymbolLayer?.type==="extrude"?np["above-center"]:{placement:"center-center",normalizedOffset:Aa,anchor:"center"};case"point":case"mesh":return np["above-center"];default:return}}_validatePlacementInfo(e){const i=this._graphic.graphic.geometry;if(i==null)return null;if(this._disablePlacement!=null){const s=this._class.labelPlacement;return s?(DI().warnOncePerTick(TCe(s,this._disablePlacement.logEntityDescription)),this._defaultPlacementInfo):e}const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":{const s=this._class.labelPlacement;if(s)return np[s]&&DI().warnOnce(TCe(s,`'${r}' geometries`)),this._defaultPlacementInfo;break}case"point":case"mesh":return e}return e}_setPointSpecificPlacement(e,i){const r=this._firstSymbolLayer;if(r==null)return;const s=this._graphic.layers[0];switch(s!=null?s.getCenterObjectSpace(e.translation):xe(e.translation,0,0,0),r.type){case"icon":case"text":this._setHUDSpecificPlacement(e,i,s);break;case"object":HX(e,i,s)}}_setMeshSpecificPlacement(e,i){const r=this._firstSymbolLayer;r!=null&&r.type==="fill"&&HX(e,i,this._graphic.layers[0])}_setPolygonSpecificPlacement(e,i){const r=this._firstSymbolLayer;if(r!=null&&r.type==="extrude"){const s=this._graphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(r5),Pue(r5,e.translation),e.translation[2]=k1(r5)/2):xe(e.translation,0,0,0),HX(e,i,s)}}_setHUDSpecificPlacement(e,i,r){const{_graphic:s}=this,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)e.hasLabelVerticalOffset||e.anchor==="center"||(np[this._class.labelPlacement]&&DI().warnOncePerTick(`the requested placement '${i.placement}' is currently unsupported for draped graphics`),e.anchor="center");else{const a=this._normalizedSymbolAnchorPos;e.screenOffset[0]=n[0]/2*(i.normalizedOffset[0]-a[0]);const o=n[1]/2*(i.normalizedOffset[1]-a[1]);e.hasLabelVerticalOffset?(e.centerOffset[1]=o,e.centerOffsetUnits="screen"):e.screenOffset[1]=o}}get _firstSymbolLayer(){const e=this._graphic.graphics3DSymbol,i=Jae(e);return i!=null?i.symbol.symbolLayers.at(0):null}get _normalizedSymbolAnchorPos(){const e=this._graphic.layers[0],i=e?.stageObject.geometries[0].material??null;if(i&&i instanceof gpe){const r=i.parameters.anchorPosition;kI[0]=2*(r[0]-.5),kI[1]=2*(r[1]-.5)}else kI[0]=0,kI[1]=0;return kI}};function TCe(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function HX(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(r5):r5,s=Ye(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const a=t.translation[2],o=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=a+o;const l=Ve(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function NVt(t){return t==="above-center"}const np={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},$Ce={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in $Ce){const e=$Ce[t],i=np[t];e.forEach(r=>{np[r]=i})}Object.freeze&&(Object.freeze(np),Object.keys(np).forEach(t=>{Object.freeze(np[t]),Object.freeze(np[t]?.normalizedOffset)}));const kI=[0,0],r5=nc(),rxi=Object.freeze({left:0,center:.5,right:1}),sxi=Object.freeze({"bottom-left":Cs(0,0),bottom:Cs(.5,0),"bottom-right":Cs(1,0),left:Cs(0,.5),center:Cs(.5,.5),right:Cs(1,.5),"top-left":Cs(0,1),top:Cs(.5,1),"top-right":Cs(1,1)});function VVt(t){switch(t){case"left":return 0;case"right":return 2;default:return 1}}function CCe(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function jVt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function nxi(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function axi(t){return t==="middle"?"center":t}function oxi(t,e){switch(t){case"top":return oi(e,0,HG);case"bottom":return oi(e,0,-HG);default:return na(e,f1)}}const $Ge="arial-unicode-ms",MCe="woff2",ECe=new Map,CGe=new Set;let UVt=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function BVt(t){const e=WVt(t),i=HVt(t),r=ECe.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${fr.fontsUrl}/woff2/${i}.${MCe}') format('${MCe}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const a=s.load().then(()=>(n.add(s),s));return ECe.set(e,new UVt(s,a)),CGe.add(s),a}function qVt(t){return CGe.has(t)}function GVt(t){if(!t)return $Ge;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function HVt(t){const e=MGe(t)+EGe(t);return GVt(t.family)+(e.length>0?e:"-regular")}function WVt(t){const e=MGe(t)+EGe(t);return(t.family||$Ge)+(e.length>0?e:"-regular")}function MGe(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function EGe(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let ZVt=class AGe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=ACe(e.color),this.haloStyle=YVt(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?ACe(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){const r=e?.material?.color,s=Je.toUnitRGBA(r)??Tn,n=e.size!=null?d1(e.size):12,a=e.lineHeight,o=e.background!=null?Je.toUnitRGBA(e.background.color):Tn,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},u=e.halo,d=u?.color!=null&&u.size>0?{size:d1(u.size),color:Je.toUnitRGBA(u.color)}:{size:0,color:Tn},f=new AGe({color:s,size:n,background:{color:o,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:a,font:l,halo:d,pixelRatio:i});if(e.font){let g=!1;const v=f.fontString(n);try{g=(await document.fonts.load(v)).some(_=>!qVt(_))}catch{re.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${v}'. Some text symbology may be rendered using the default browser font.`)}if(!g&&!JVt.has(e.font.family))try{await BVt(e.font)}catch{}}return f}};function YVt(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function ACe(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const JVt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),Cw=16;function T1(t,e){return e=Math.floor(e/Cw)*Cw,Math.min(Math.round(t/Cw)*Cw,e)}function WX(t,e){return e=Math.floor(e/Cw)*Cw,Math.min(Math.ceil(t/Cw)*Cw,e)}function QVt(t,e){const[i,r]=OGe(t,e);return t.width===i&&t.height===r?t:PGe(t,i,r)}function OGe({width:t,height:e},{maxPreferredTexturePixels:i,maxTextureSize:r}){const s=Math.max(t,e),n=t*e;if(s<=r&&n<=i)return[t,e];const a=Math.min(Math.sqrt(i/n),r/s);return[T1(Math.round(t*a),r),T1(Math.round(e*a),r)]}function PGe(t,e,i){if(t instanceof ImageData)return PGe(XVt(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function XVt(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new q("texture:context-failed","Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}const ab=4096;let SE=class extends be{constructor(e){super(e),this.id=Gc(),this.events=new gm,this._glTexture=null,this._atlas=new ejt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view.stage,this._stage.addTexture(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=jt(this._glTexture),this._frameWorker=Xi(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get loaded(){return this._glTexture!=null}get glTexture(){return this._glTexture}static get maxSize(){return s5=0,[ab-ob-s5,ab-ob-s5-OCe]}load(e){if(this._glTexture)return this._glTexture;const i=new ar;return i.wrapMode=33071,i.samplingMode=9987,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new qi(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Tt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Xi(this._frameWorker),this._glTexture&&(this._stage.removeTexture(this),this._glTexture=jt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.width=e.width,this._canvas.height=e.height}_resizeAtlas(e,i){const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,this._glTexture?.resize(e,i),this._glTexture?.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(n=>this._uvCallbacks.get(n.textRenderer.key)?.forEach(a=>a(n.uv))),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let a=n.cursors.get(s);if(!a){if(n.height<n.nextY+s)return!1;a=[new PCe(n.nextY)],n.cursors.set(s,a),n.nextY+=s}let o=a.find(l=>n.width>=l.x+r);if(o==null){if(n.height<n.nextY+s)return!1;o=new PCe(n.nextY),n.nextY+=s,a.push(o)}return e.setNewPosition(o),this._elements.set(i,e),this._elementsToRender.set(i,e),o.x+=r,!0}_ensureCallbacks(e){const i=this._uvCallbacks.get(e);if(i)return i;const r=new Set;return this._uvCallbacks.set(e,r),r}_addCallback(e,i){this._ensureCallbacks(e).add(i)}_removeCallback(e,i){const r=this._uvCallbacks.get(e);return!(!r?.delete(i)||r.size!==0)&&(this._uvCallbacks.delete(e),!0)}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,a=s+ob,o=n+ob+OCe;if(!this._addAtlasElement(e,i,a,o)){if(this._canRepack)this._reset();else if(r.width<a){const l=WX(Math.max(a,1.5*r.width),ab);this._resizeAtlas(l,r.height)}else{const l=r.nextY+o,u=WX(Math.max(l,1.5*r.height),ab);if(u>r.height)this._resizeAtlas(r.width,u);else if(r.width<ab){const d=WX(1.5*r.width,ab);this._resizeAtlas(d,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-ob,i[1]-ob,r.renderedWidth+2*ob,r.renderedHeight+2*ob),r.render(this._ctx,i[0],i[1]),this._uvCallbacks.get(r.key)?.forEach(s=>s(e.uv))}get readyToRun(){return this.updating}runTask(e){if(this._glTexture==null)return Oa;for(;this._needsRepack&&(this._canRepack||this._atlas.height<ab&&this._atlas.height<ab);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(e,i){const r=e.key;this._addCallback(r,i);let s=this._elements.get(r);return s?S0(s.uv,Tn)||i(s.uv):(s=new KVt(e),this._processAddition(s),this.setDirty()),{remove:()=>this._removeText(e,i)}}_removeText(e,i){const r=e.key;this._elements.get(r)&&this._removeCallback(r,i)&&(this._elements.delete(r),this._elementsToRender.delete(r),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}get usedMemory(){return(this._glTexture?.usedMemory??0)+(this._canvas?.width??0)*(this._canvas?.height??0)*4}};c([p({constructOnly:!0})],SE.prototype,"view",void 0),c([p({type:Boolean})],SE.prototype,"updating",void 0),SE=c([R("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],SE);const ob=2,OCe=2;let KVt=class{constructor(e){this.textRenderer=e,this._uv=li(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return Tn;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return Or(this._uv,this._xOffset,this._yOffset+i,this._xOffset+e,this._yOffset)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},ejt=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=s5}},PCe=class{constructor(e){this.y=e,this.x=s5}},s5=0;const tjt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let ijt=class RGe{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Uo,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),Uo.clearPool(),Xae[0]=null,P2.prune(),R2.prune()}add(e){const i=Array.from(e);this._grow(i);const r=Uo.acquire();for(const s of i)++this._objectCount,this._isDegenerate(s)?this._degenerateObjects.add(s):(r.init(this._root),this._add(s,r));Uo.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=Uo.acquire();for(const s of e){const n=i??_1(this.objectToBoundingSphere(s),hjt);Pk(n[3])?(r.init(this._root),rjt(s,n,r)):this._degenerateObjects.delete(s)}Uo.release(r),this._shrink()}update(e,i){if(!Pk(i[3])&&this._isDegenerate(e))return;const r=ujt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=um(e,i);Ix(this._root,n=>{if(!njt(s,n))return!1;const a=n.node;return a.terminals.forAll(o=>{this._intersectsObject(s,o)&&r(o)}),a.residents!==null&&a.residents.forAll(o=>{this._intersectsObject(s,o)&&r(o)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=um(e,i);Ix(this._root,a=>{if(!ajt(n,a,s))return!1;const o=a.node;return o.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),o.residents!==null&&o.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){Ix(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let a=1/0,o=1/0,l=null;const u=ZX(e,i),d=f=>{if(--n,!s(f))return;const g=this.objectToBoundingSphere(f);if(!ww(r,g))return;const v=Kb(e,i,Li(g)),_=v-g[3],x=v+g[3];_<a&&(a=_,o=x,l=f)};return RCe(this._root,f=>{if(n<=0||!ww(r,f.bounds)||(he(xd,u,f.halfSize),$e(xd,xd,Li(f.bounds)),Kb(e,i,xd)>o))return!1;const g=f.node;return g.terminals.forAll(v=>d(v)),g.residents!==null&&g.residents.forAll(v=>d(v)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,a,o){let l=-1/0,u=1/0;const d={setRange:x=>{r===1?(l=Math.max(l,x.near),u=Math.min(u,x.far)):(l=Math.max(l,-x.far),u=Math.min(u,-x.near))}};d.setRange(s);const f=Kb(i,r,e),g=ZX(i,r),v=ZX(i,-r),_=x=>{if(!o(x))return;const S=this.objectToBoundingSphere(x),T=Kb(i,r,Li(S))-f,M=T-S[3],E=T+S[3];M>u||E<l||!ww(a,S)||n(x,d)};RCe(this._root,x=>{if(!ww(a,x.bounds)||(he(xd,g,x.halfSize),$e(xd,xd,Li(x.bounds)),Kb(i,r,xd)-f>u)||(he(xd,v,x.halfSize),$e(xd,xd,Li(x.bounds)),Kb(i,r,xd)-f<l))return!1;const S=x.node;return S.terminals.forAll(T=>_(T)),S.residents!==null&&S.residents.forAll(T=>_(T)),!0},i,r)}forEachNode(e){Ix(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=qg(i),s=q0(i,I()),n=l=>{const u=this.objectToBoundingSphere(l),d=qg(u),f=r+d;return!(Mn(Li(u),s)-f*f<=0)||e(l)};let a=!0;const o=l=>{a&&(a=n(l))};Ix(this._root,l=>{const u=qg(l.bounds),d=r+u;if(Mn(Li(l.bounds),s)-d*d>0)return!1;const f=l.node;return f.terminals.forAll(o),a&&f.residents!==null&&f.residents.forAll(o),a}),a&&this.forEachDegenerateObject(o)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||Bne(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||Bne(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=Uo.acquire().init(e);this._add(i.at(r),s),Uo.release(s)}}_grow(e){if(ICe(e,i=>this.objectToBoundingSphere(i),Vy),Pk(Vy[3])&&!this._fitsInsideTree(Vy))if(IGe(this._root.node))_1(Vy,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(Vy);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Vy,i):this._growRootAsSubNode(i),Uo.release(i)}}_rebuildTree(e,i){Une(JX,i.bounds),JX[3]=i.halfSize,ICe([e,JX],s=>s,QX);const r=Uo.acquire().init(this._root);this._root.initFrom(null,QX,QX[3]),this._root.increaseHalfSize(1.25),Ix(r,s=>(this.add(s.node.terminals.data),s.node.residents!==null&&this.add(s.node.residents.data),!0)),Uo.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return Ix(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,a=this._root.halfSize;for(let l=0;l<3;l++){const u=n[l]-a-(r[l]-i),d=r[l]+i-(n[l]+a),f=Math.max(0,Math.ceil(u/(2*a))),g=Math.max(0,Math.ceil(d/(2*a)))+1,v=2**Math.ceil(Math.log(f+g)*Math.LOG2E);s=Math.max(s,v),Fj[l].min=f,Fj[l].max=g}for(let l=0;l<3;l++){let u=Fj[l].min,d=Fj[l].max;const f=(s-(u+d))/2;u+=Math.ceil(f),d+=Math.floor(f);const g=n[l]-a-u*a*2;YX[l]=g+(d+u)*a}const o=s*a;return YX[3]=o*kGe,Uo.acquire().initFrom(null,YX,o,0)}_growRootAsSubNode(e){const i=this._root.node;Une(Vy,this._root.bounds),Vy[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Vy,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!Pk(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){const i=e.children.map(n=>n?this._nodeToJSON(n):null),r=e.residents?.map(n=>this.objectToBoundingSphere(n)),s=e.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new RGe(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}};var Kd;let Uo=(Kd=class{constructor(){this.bounds=Is(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??Kd.createEmptyNode(),i&&_1(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*kGe}advance(e){let i=this.node.children[e];i||(i=Kd.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=DGe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i?.(this,-1),!0;if(this.isLeaf()){if(!r)return i?.(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i?.(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Ai({shrink:!0}),residents:new Ai({shrink:!0})}}static acquire(){return Kd._pool.acquire()}static release(e){Kd._pool.release(e)}static clearPool(){Kd._pool.prune()}},Kd._pool=new Wc(()=>new Kd),Kd);function Ix(t,e){let i=Uo.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(Uo.acquire().init(i).advance(s));Uo.release(i)}}function RCe(t,e,i,r=1){let s=Uo.acquire().init(t);const n=[s];for(cjt(i,r,kCe);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const o=kCe[a];s.node.children[o]&&n.push(Uo.acquire().init(s).advance(o))}Uo.release(s)}}function rjt(t,e,i){P2.clear();const r=i.advanceTo(e,(s,n)=>{P2.push(s.node),P2.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=P2.length-2;s>=0&&sjt(P2.data[s],P2.data[s+1]);s-=2);}function sjt(t,e){return e>=0&&(t.children[e]=null),!!IGe(t)&&(t.residents===null&&(t.residents=new Ai({shrink:!0})),!0)}function njt(t,e){return WG(Li(e.bounds),2*-e.halfSize,Ih),WG(Li(e.bounds),2*e.halfSize,Dh),jUe(t.origin,t.direction,Ih,Dh)}function ajt(t,e,i){return WG(Li(e.bounds),2*-e.halfSize,Ih),WG(Li(e.bounds),2*e.halfSize,Dh),i.applyToMinMax(Ih,Dh),jUe(t.origin,t.direction,Ih,Dh)}function IGe(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function ojt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function ljt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function WG(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function ICe(t,e,i){Ih[0]=1/0,Ih[1]=1/0,Ih[2]=1/0,Dh[0]=-1/0,Dh[1]=-1/0,Dh[2]=-1/0;for(const r of t){const s=e(r);Pk(s[3])&&(ojt(Ih,s),ljt(Dh,s))}OP(i,cr(djt,Ih,Dh,.5)),i[3]=Math.max(Dh[0]-Ih[0],Dh[1]-Ih[1],Dh[2]-Ih[2])/2}function cjt(t,e,i){if(!R2.length)for(let r=0;r<8;++r)R2.push({index:0,distance:0});for(let r=0;r<8;++r){const s=DGe[r];R2.data[r].index=r,R2.data[r].distance=Kb(t,e,s)}R2.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=R2.data[r].index}function ZX(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=Kb(t,e,DCe[s]);n<r&&(r=n,i=DCe[s])}return i}function Kb(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function Pk(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}const DGe=[Ye(-1,-1,-1),Ye(1,-1,-1),Ye(-1,1,-1),Ye(1,1,-1),Ye(-1,-1,1),Ye(1,-1,1),Ye(-1,1,1),Ye(1,1,1)],DCe=[Ye(-1,-1,-1),Ye(-1,-1,1),Ye(-1,1,-1),Ye(-1,1,1),Ye(1,-1,-1),Ye(1,-1,1),Ye(1,1,-1),Ye(1,1,1)],kGe=Math.sqrt(3),Xae=[null];function ujt(t){return Xae[0]=t,Xae}const YX=Is(),xd=I(),Ih=I(),Dh=I(),P2=new Ai,hjt=Is(),Vy=Is(),JX=Is(),QX=Is(),Fj=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],R2=new Ai,kCe=[0,0,0,0,0,0,0,0],djt=I();let LGe=class{constructor(e,i,r=""){this.stage=e,this.apiLayerViewUid=r,this.id=Gc(),this.events=new gm,this.visible=!0,this.sliceable=!1,this._objectsAdded=new Array,this._handles=new X0,this._objects=new Map,this._pickable=!0,this.visible=i?.visible??!0,this._pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??0,e.addLayer(this);for(const s of tjt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.removeLayer(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}getObject(e){return this._objects.get(e)}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.set(e.id,e),e.layer=this,this.events.emit("layerObjectAdded",e),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.delete(e.id)&&(this.events.emit("layerObjectRemoved",e),e.layer=null,this._octree!=null&&(Uc(this._objectsAdded,e)||this._octree.remove([e])))}addMany(e){for(const i of e)this._objects.set(i.id,i),i.layer=this;this.events.emit("layerObjectsAdded",e),this._octree!=null&&this._objectsAdded.push(...e)}removeMany(e){const i=new Array;for(const r of e)this._objects.delete(r.id)&&i.push(r);if(i.length!==0&&(this.events.emit("layerObjectsRemoved",i),i.forEach(r=>r.layer=null),this._octree!=null)){for(let r=0;r<i.length;)Uc(this._objectsAdded,i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}commit(){this.stage.commitLayer(this)}sync(){this.updatePolicy!==1&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.size>50?(this._octree=new ijt(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.values())):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded),this._objectsAdded.length=0),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Pe(this._octree),this._objectsAdded.length=0}get test(){}};function fxi(t){return t&&typeof t.highlight=="function"}function pjt(t){return t&&typeof t.maskOccludee=="function"}function Kae(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function fjt(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(FGe(i,r))return Kae(e,i,r)}return!0}function FGe(t,e){return t!=null&&t>0||e!=null&&e>0}function mxi(t){return!t?.minScale||!t.maxScale||t.minScale>=t.maxScale}const HB=()=>!ie("disable-feature:layer-based-scale-visibility");function gxi(t,e,i){return new q("layerview:spatial-reference-incompatible",`The spatial reference of this ${t} (wkid: ${e??"undefined"}) is incompatible with the spatial reference of the view (wkid: ${i??"undefined"}).`,{})}let LCe=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.textureAtlasHandles=[],this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},mjt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0,this.graphics=new Map,this.scaleVisibility=null}},gjt=class{constructor(e,i,r,s,n,a,o,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=a,this.disablePlacement=o,this.active=l,this.labelClassAbortController=new AbortController,this._labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new LGe(e,{pickable:!0},r.owner.layerViewUid)}destroy(){this.stageLayer.destroy()}get labelClassContexts(){return this._labelClassContexts}setLabelClassContext(e,i){this._labelClassContexts[e]=i}resetLabelClassContext(){this._labelClassContexts.length=0}},I2=class extends be{constructor(e){super(e),this._hudMaterials=new Map,this._calloutMaterials=new Map,this._dirty=!1,this._focusAreasLabelsQueue=new wO,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([X(()=>this.view.state?.camera,()=>this.setDirty()),X(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),X(()=>this.view.focusAreasView?.polygons,()=>this._updateFocus()),this.view.resourceController.scheduler.registerTask(Tt.LABELER,this)]),HB()&&this.addHandles(X(()=>this.view.scale,()=>this._updateScaleVisibility())),this._textTextureAtlas=new SE({view:this.view})}dispose(){this.removeAllHandles(),this._textTextureAtlas=jt(this._textTextureAtlas),this._hudMaterials.clear(),this._calloutMaterials.clear(),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),tf.graphic=null,tf.renderingInfo=null,tf.layer=null}_updateFocus(){this._focusAreasLabelsQueue.clear(),this._labelingContexts.forEach(e=>{e.graphics.forEach(i=>{this._focusAreasLabelsQueue.push({graphic3DGraphic:i,labelingContext:e})})})}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new LCe(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(16,1,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(16,1,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){if(this._textTextureAtlas)for(const i of e.graphics3DGraphic.labelLayers){if(!i.labelClass)continue;const r=e.textRenderers[i.labelClassContextIndex];r&&(e.textureAtlasHandles.push(this._textTextureAtlas.addText(r,s=>vjt(i.stageObject,s))),yjt(i.stageObject,r))}}_removeLabelTextureFromAtlas(e){e.textureAtlasHandles.forEach(i=>i.remove()),e.textureAtlasHandles.length=0}get readyToRun(){return this.view.ready&&(this._dirty||this.deconflictor.readyToRun||this._focusAreasLabelsQueue.length>0)}runTask(e){return this._updateLabels(e),this._applyFocusAreasUpdates(e),!this._dirty&&this.deconflictor.readyToRun&&this.deconflictor.runTask(e),Oa}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(zj(i))this._dirty=!0;else if(XX(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else for(const[r,s]of i.labelsToInitialize)if(this._ensureGraphics3DResources(s)&&(this._labels.set(r,s),this.deconflictor.setDirty(),e.madeProgress()),(s.visible&&s.textInitialized||!s.visible&&s.hasGraphics3DResources)&&(i.labelsToInitialize.delete(r),e.madeProgress()),e.done){this._dirty=!0;break}}this._dirty||this.notifyChange("updating")}}_applyFocusAreasUpdates(e){for(;this._focusAreasLabelsQueue.length>0&&!e.done;){e.madeProgress();const{graphic3DGraphic:i,labelingContext:r}=this._focusAreasLabelsQueue.pop();if(i.labelLayers.length===0||!r.active)continue;const s=uNt(i.graphic.geometry);if(s==null)continue;const n=this.view.focusAreasView?.containsGeometry(s)??!0;i.labelLayers.forEach(a=>{a.stageObject.geometries.some(o=>o.material.parameters.isFocused!==n)&&(this._removeGraphic(r,i),this._addGraphic(r,i),this.setDirty())})}this._focusAreasLabelsQueue.length===0&&(this.notifyChange("readyToRun"),this.notifyChange("updating"))}async _createLabelClassContextAsync(e){const i=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),ct(i),e.scaleVisibility?.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=s.labelingInfo?.filter(a=>!!a.symbol);!n||n.length===0||(await rue(n,async(a,o)=>{const l=a.symbol,u=Jae(r.getOrCreateGraphics3DSymbol(l));if(u==null)return void re.getLogger(this).error("Failed to create Graphics3DSymbol for label");await u.load(),ct(i);let d=null;DLe(l)&&l.hasVisibleCallout()&&(d=SNt(l,r.symbolCreationContext),await d.load(),ct(i));const f=await Sp(N5t(a,e.layer.fieldsIndex,this.view.spatialReference));if(ct(i),f.ok===!0){const g=await this._createTextRenderParameters(u.symbol);ct(i);const v=new mjt(a,u,d,g,f.value);this._updateLabelClassContextVisibility(v),e.setLabelClassContext(o,v)}else re.getLogger(this).error(`Label expression failed to evaluate: ${f.error}`)}),ct(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(Zr(i))throw i;e.resetLabelClassContext()}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return i?.type!=="text"?null:ZVt.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)r&&--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Rs(i),e.resetLabelClassContext(),e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,a){if(!this._textTextureAtlas)return null;const o=new PVt(r,CCe(r.anchor),jVt(r.anchor),e.text,Cs(e.displayWidth,e.displayHeight));return tf.graphic=i,tf.layer=s,tf.renderingInfo=null,n.createLabel(tf,o,this._hudMaterials,this._textTextureAtlas,()=>a.placement?.elevationOffset??null)}_createLineCalloutGraphic(e,i,r,s,n){tf.graphic=e,tf.layer=n;const a=s.screenOffset[0];return tf.renderingInfo=new wNt(null,i,s.translation,s.centerOffset,a,s.centerOffsetUnits,s.elevationOffset),r.createGraphics3DGraphic(tf,this._calloutMaterials)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(XX(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const a=i.graphic,o=r.layer,l=Nj(r.layer);for(let u=0;u<s.length;u++){const d=e.textRenderers[u],f=e.textLabelPlacements[u],g=s[u];if(d==null||f==null||g==null)continue;const v=g.graphics3DSymbol,_=_jt(v),x=v.symbolLayers[0];if(!x)continue;x.setElevationInfoOverride(r.elevationInfoOverride);const S=new SCe(i,_,g.labelClass),T=this._createTextSymbolGraphic(d,a,f,o,x,S);if(T==null)return!1;T.labelClass=g.labelClass,T.labelClassContextIndex=u,i.addLabelGraphic(T,r.stageLayer),this.deconflictor.setPriority(i,g.textRenderParameters?.definition.size??0),i.setVisibilityFlag(16,1,l),i.setVisibilityFlag(16,2,g.scaleVisibility??!0),i.setVisibilityFlag(16,8,!1),HB()&&g.graphics.set(a.uid,i),n=!0;const M=g.graphics3DCalloutSymbolLayer;if(M&&f.hasLabelVerticalOffset){M.setElevationInfoOverride(r.elevationInfoOverride);const E=this._createLineCalloutGraphic(a,_,M,f,o);E!=null&&(g.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(E,r.stageLayer))}break}return n&&r.scaleVisibility?.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r.labelClass==null)continue;i[r.labelClassContextIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(XX(r))return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const a=r[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,a?.textRenderParameters==null)continue;const o=a.labelFunction;let l;if(o.type==="arcade")try{const T=o.needsHydrationToEvaluate()?D5t(s,i.layer,null):s;l=o.evaluate(T)}catch{l=null}else l=o.evaluate(s);if(l==null||l===""||/^\s+$/.test(l))continue;const u=a.graphics3DSymbol;if(!u.symbolLayers[0])continue;const d=e.graphics3DGraphic,f=u.symbol?.type==="label-3d"?u.symbol:null,g=a.labelClass,v=i.disablePlacement,_=new SCe(d,f,g,v).placement;if(_==null)continue;const x=CCe(_.anchor),S=VVt(x);e.textRenderers[n]=new LVt(l,S,a.textRenderParameters,SE.maxSize),e.textLabelPlacements[n]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new LCe(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n.labelClass!=null&&!e.labelClassContexts[n.labelClassContextIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(i.graphic,n))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),e.labelClassContexts.forEach(n=>n?.graphics.delete(r)),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){if(!r)continue;const s=new Map;i.graphics.forEach(a=>s.set(a.graphic.uid,a));const n=a=>a.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const a=o=>o.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,a)}}}_visibilityInfoChange(e){const i=Nj(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=r?.emptySymbolLabelSupported||!1,n=r?.elevationInfoOverride||null,a=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,l=new gjt(this.view.stage,o,e,i,s,n,a,Nj(o));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:u=>this._addGraphic(l,u),removeGraphic:u=>this._removeGraphic(l,u),updateGraphicGeometry:u=>this._updateGraphicGeometry(l,u),layerLabelsEnabled:()=>Nj(l.layer),labelingInfoChange:u=>this._labelingInfoChange(l,u),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),screenSizePerspectiveEnabledChanged:()=>this._globalPropertyChanged("screenSizePerspectiveEnabled",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}_updateScaleVisibility(){for(const e of this._labelingContexts)if(e.active&&!zj(e))for(const i of e.labelClassContexts)this._updateLabelClassContextVisibility(i)}_updateLabelClassContextVisibility(e){if(!e||!HB())return;const{labelClass:i,graphics:r}=e,s={minScale:i.minScale,maxScale:i.maxScale},n=fjt(s,this.view.scale),a=e.scaleVisibility==null||e.scaleVisibility!==n;e.scaleVisibility=n,a&&r.size&&(r.forEach(o=>o.setVisibilityFlag(16,2,n)),this.deconflictor.setDirty(),this.setDirty())}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.textureAtlasHandles.length?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>zj(e))||this._focusAreasLabelsQueue.length>0}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(zj(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get usedMemory(){return this._textTextureAtlas?.usedMemory??0}get test(){}};function yjt(t,e){t.geometries[0].setAttributeData("size",[e.displayWidth,e.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],"size")}function vjt(t,e){t.geometries[0].setAttributeData("uvi",e),t.geometryVertexAttributeUpdated(t.geometries[0],"uvi",!0)}function zj(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function XX(t){return(t?.length??0)===0}function _jt(t){return t.symbol?.type==="label-3d"?t.symbol:null}function Nj(t){return!!t.labelsVisible&&!!t.labelingInfo?.some(e=>!!e.symbol)}c([p({constructOnly:!0})],I2.prototype,"view",void 0),c([p({constructOnly:!0})],I2.prototype,"deconflictor",void 0),c([p()],I2.prototype,"_textTextureAtlas",void 0),c([p({type:Boolean,readOnly:!0})],I2.prototype,"updating",null),I2=c([R("esri.views.3d.layers.graphics.Labeler")],I2);const tf=new xNt(null,null,null);let bjt=class{constructor(e){this._layerView=e,this._lodGlobalDirty=!1}destroy(){this._index=null,this._lodGlobalHandling=null,this._removeNodes=null}startNodeLoading(e,i,r){this._maxLodLevel=r.maxLodLevel,this._index=i,this._removeNodes=e}shouldLoadNode(e){if(e==null)return!1;const i=this._index.nodeTraversalState(e);return!!this._isChosenMaxLOD(i)||!!i.isChosen&&this._childrenRequireLoading(e)}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return this._index!=null&&this._lodGlobalDirty===!0}lodGlobalHandling(e){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;const i=this._layerView.view.resourceController.memoryController.usedMemory,r=Math.max(0,Math.floor(10*(i-1)));Fm.clear(),this._lodGlobalHandling(this._index.rootNode,r,!1,!!this._layerView.nodeCrossfadingEnabled);const s=Fm.length;this._removeNodes(Fm,e);const n=Fm.length<s;return Fm.length!==0&&(this._lodGlobalDirty=!0),Fm.clear(),n}_lodGlobalHandling(e,i,r,s){if(e==null)return!1;const n=e.index,a=this._index,o=this._layerView,l=a.nodeTraversalState(e),u=this._isChosenMaxLOD(l),d=e.resources.isEmpty;if(u&&d)return e.childrenLoaded>0&&this._removeChildrenRecursive(e),!0;const f=o.isNodeLoaded(n);if(s&&f&&u){const T=!r&&this.hasNoVisibleChildren(e);o.fadeNode(n,0,!T)}const g=f&&(!o.isNodeFullyFadedIn||o.isNodeFullyFadedIn(n));if(f&&(o.updateNodeState(n,u?1:0),u))return g&&this._removeChildrenRecursive(e),g;const v=e.childCount>0;let _=v;if(v)for(let T=0;T<e.childCount;T++){const M=a.getChildIndex(n,T),E=a.getNode(M);E!=null?!a.isGeometryVisible(M)||this._lodGlobalHandling(E,i,r||g,s)||(_=!1):a.isNodeVisible(M)&&(_=!1)}const x=f&&!u&&(_||Fm.length<i);x&&Fm.push(n),!s||x||!f||r||_||o.fadeNode(n,0,!1);const S=e.resources.isEmpty;return _||g&&!x||S}_removeChildrenRecursive(e){this._index.traverseDescendants(e,i=>((this._layerView.isNodeLoaded(i.index)||this._layerView.isNodeReloading(i.index))&&Fm.push(i.index),i.childrenLoaded>0))}hasNoVisibleChildren(e){let i=!0;return this._index.traverseDescendants(e,r=>!(!i||!this._index.isNodeVisible(r.index))&&(this._layerView.isNodeLoaded(r.index)?(i=!1,!1):r.childrenLoaded>0)),i}_childrenRequireLoading(e){let i=!1,r=!0;return this._index.traverseDescendants(e,s=>{if(!r||!this._index.isNodeVisible(s.index))return!1;const n=this._index.nodeTraversalState(s);return this._isChosenMaxLOD(n)&&this._index.isGeometryVisible(s.index)&&(i=!0),this._layerView.isNodeLoaded(s.index)?(r=!1,!1):s.childrenLoaded>0}),r&&i}_isChosenMaxLOD(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)}static cleanupI3SLodHandling(){Fm.prune()}};const Fm=new Ai({deallocator:null});let zGe=class{constructor(e="scene"){this.context=e,this.extent=R0(),this.spatialReference=null}};const wjt=1,FCe=Symbol("layerHandles");let sM=class extends Ju{get spatialReference(){return this.view.spatialReference}constructor(e){super(e),this._elevationOffset=0}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper,this._intersectLayers=[this.stageLayer],this._intersector=new Zu(this.view.state.viewingMode),this._intersector.options.store=0;const e=this._computeLayerExtent(this.spatialReference,this.stageLayer);this._zmin=e[2],this._zmax=e[5];const i=this.stageLayer.events;this.addHandles([i.on(["layerObjectAdded","layerObjectRemoved","transformationChanged","shaderTransformationChanged"],r=>this._objectChanged(r)),i.on(["geometryAdded","geometryRemoved"],({object:r})=>this._objectChanged(r)),i.on("attributesChanged",({attribute:r,object:s})=>nGe(r)&&this._objectChanged(s))],FCe)}destroy(){this.removeHandles(FCe)}elevationInfoChanged(){const e=this.layer!=null?this.layer.elevationInfo:null;if(e!=null&&e.mode!=="on-the-ground"){const i=ed(this.layer.spatialReference),r=vhe(e.unit??"meters");this._elevationOffset=(e.offset??0)*r/i}else this._elevationOffset=0}getElevation(e,i,r,s){if(uc[0]=e,uc[1]=i,uc[2]=r,!this._renderCoordsHelper.toRenderCoords(uc,s,uc))return re.getLogger(this).error("could not project point for elevation alignment"),null;const n=this._elevationOffset,a=this._zmin+n,o=this._zmax+n;this._renderCoordsHelper.setAltitude(zCe,o,uc),this._renderCoordsHelper.setAltitude(NCe,a,uc);const l=u=>!!u.lastValidElevationBB;return this._intersector.reset(zCe,NCe,null),this._intersector.intersect(this._intersectLayers,null,wjt,null,l),this._intersector.results.min.getIntersectionPoint(uc)?this._renderCoordsHelper.getAltitude(uc):null}_objectChanged(e){const i=this.spatialReference;if(!e.lastValidElevationBB||!i)return;Wu(jy);const r=e.lastValidElevationBB;r.isEmpty()||this._expandExtent(i,r.min,r.max,jy);const{min:s,max:n}=e.boundingVolumeWorldSpace;this._expandExtent(i,s,n,jy),Rue(jy,Rk.extent),this._zmin=Math.min(this._zmin,jy[2]),this._zmax=Math.max(this._zmax,jy[5]),Rk.spatialReference=i,this.emit("elevation-change",Rk),Rk.spatialReference=null,r.assignMinMax(s,n)}_computeLayerExtent(e,i){return Wu(jy),e!=null&&i.objects.forEach(r=>this._expandExtent(e,r.boundingVolumeWorldSpace.min,r.boundingVolumeWorldSpace.max,jy)),jy}_expandExtent(e,i,r,s){for(let n=0;n<8;++n)uc[0]=1&n?i[0]:r[0],uc[1]=2&n?i[1]:r[1],uc[2]=4&n?i[2]:r[2],this._renderCoordsHelper.fromRenderCoords(uc,uc,e),kO(s,uc);return s}};c([p({constructOnly:!0})],sM.prototype,"layer",void 0),c([p({constructOnly:!0})],sM.prototype,"stageLayer",void 0),c([p({constructOnly:!0})],sM.prototype,"view",void 0),c([p()],sM.prototype,"spatialReference",null),sM=c([R("esri.views.3d.layers.support.StageLayerElevationProvider")],sM);const jy=Wu(),Rk=new zGe;function xjt(){Rk.spatialReference=null}const uc=I(),zCe=I(),NCe=I();let Ik=class extends be{get parameters(){return this._parameters}get labelParameters(){return this._labelParameters}get _calculations(){return this.view.state.isGlobal?new Tjt(this.view.renderCoordsHelper?.referenceEllipsoid.radius??0):new Sjt}constructor(e){super(e),this._parameters=new x$e,this._labelParameters=new x$e}initialize(){this.addHandles([X(()=>({distance:this.view.pointsOfInterest?.centerOnSurfaceInfrequent?.distance??0,fovY:this.view.state.camera.fovY}),e=>this._update(e),bt)])}_update(e){const i=this._updateParameters(this._parameters,WB,e),r=this._updateParameters(this._labelParameters,Cjt,e);return i||r}_updateParameters(e,i,r){if(e&&e.camera.fovY===r.fovY&&e.camera.distance===r.distance)return!1;const{scaleStart:s,scaleFallOffRange:n}=i,{fovY:a,distance:o}=r;this._calculations.calculateCurvatureDependentParameters(KX,i,r);const l=this._calculations.surfaceCoverageCompensation(r,KX),{tiltAngle:u,scaleFallOffFactor:d}=KX,f=Math.sin(u)*o,g=.5*Math.PI-u-a*(.5-s*l),v=f/Math.cos(g),_=g+a*n*l,x=(v-d*(f/Math.cos(_)))/(1-d);return e.camera.fovY=r.fovY,e.camera.distance=r.distance,e.offset=x,e.divisor=v-x,e.minPixelSize=i.minPixelSize,!0}};c([p({constructOnly:!0})],Ik.prototype,"view",void 0),c([p()],Ik.prototype,"_calculations",null),Ik=c([R("esri.views.3d.state.ScreenSizePerspective")],Ik);let Sjt=class{surfaceCoverageCompensation(e,i){return zje(i.tiltAngle,e.fovY)}calculateCurvatureDependentParameters(e,i){e.tiltAngle=i.curvatureDependent.min.tiltAngle,e.scaleFallOffFactor=i.curvatureDependent.min.scaleFallOffFactor}},Tjt=class{constructor(e){this._ellipsoidRadius=e}surfaceCoverageCompensation(e,i){return O$(VCe,this._ellipsoidRadius),hde(VCe,i.tiltAngle,e.distance,e.fovY)}calculateCurvatureDependentParameters(e,i,r){const s=i.curvatureDependent,n=1+r.distance/this._ellipsoidRadius,a=Math.sqrt(n*n-1),[o,l]=[s.min.curvature,s.max.curvature],u=Ce((a-o)/(l-o),0,1),[d,f]=[s.min,s.max];e.tiltAngle=yt(d.tiltAngle,f.tiltAngle,u),e.scaleFallOffFactor=yt(d.scaleFallOffFactor,f.scaleFallOffFactor,u)}},$jt=class{constructor(){this.tiltAngle=0,this.scaleFallOffFactor=0}};const WB={curvatureDependent:{min:{curvature:zt(10),tiltAngle:zt(12),scaleFallOffFactor:.5},max:{curvature:zt(70),tiltAngle:zt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},Cjt={...WB,curvatureDependent:{min:{...WB.curvatureDependent.min,scaleFallOffFactor:.7},max:{...WB.curvatureDependent.max,scaleFallOffFactor:.95}},minPixelSize:14},KX=new $jt,VCe=Is();let hs=class extends be{constructor(e){super(e),this._propertiesPool=new V0({camera:()=>new wr},this),this._lastSeenCameraProjectionValues=new wr,this.mode=0,this._cssCamera=new wr,this._camera=new wr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.constraints=new yv({state:this}),this.events=new gm,this.fading=!1,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}reset(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new V0({camera:()=>new wr},this)}destroy(){this.cameraController=Pe(this.cameraController),this._propertiesPool=Pe(this._propertiesPool)}createInitialCamera(){if(this.viewingMode===1){const e=xr(this.spatialReference).radius;this.camera=new wr({eye:Ye(4*e,0,0),center:Ye(e,0,0),up:Ye(0,0,1)})}else this.camera=new wr({eye:Ye(0,0,100),center:Ye(0,0,0),up:Ye(0,1,0)})}get animation(){return this.cameraController instanceof cL&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==ph&&ph.copyFrom(e),ph.computeUp(this.viewingMode),this.events.emit("before-camera-change",{camera:ph});const i=this._camera;if(Mjt(this._lastSeenCameraProjectionValues,ph)&&(this._lastSeenCameraProjectionValues.copyFrom(ph),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(ph)&&(this._camera=this._propertiesPool.get("camera").copyFrom(ph),this._cameraChanged=!i.almostEquals(ph),this._cameraChanged)){const r=FPe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===2}get updating(){return this.mode!==2}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){if(e==null)return void(this._contentCamera=null);const i=e.clone();this.events.emit("before-camera-change",{camera:i,sceneDepthRange:$o.Infinite}),this._contentCamera=i}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===1}get isLocal(){return this.viewingMode===2}get viewingMode(){return Wne(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get highlights(){const e=this.view.highlights.items.slice(0,_yt);for(let i=0;i<e.length;){const r=e[i],s=e.findIndex(n=>n.name===r.name);s>=0&&i>s?e.splice(i,1):++i}return e}get highlightOrderMap(){const e=new Map;return this.highlights.forEach((i,r)=>e.set(i.name,r)),e}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.removeHandles(UCe),this.cameraController?.destroy(),e&&(this.addHandles(vs(()=>e.state===4||e.state===3,()=>{this.updateCamera(i=>e.onControllerEnd(i)),this.cameraController===e&&(this._set("cameraController",null),e.destroy())},{sync:!0,once:!0}),UCe),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=1)}switchCameraController(e){this.cameraController=e}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();ph.copyFrom(this.camera),e(ph),this.camera=ph,this._processingUpdates=!1,this._processUpdateQueue()}static cleanupViewstate(){ph=new wr}};c([p({constructOnly:!0})],hs.prototype,"view",void 0),c([p()],hs.prototype,"mode",void 0),c([p({readOnly:!0,type:j0})],hs.prototype,"animation",null),c([p({type:wr})],hs.prototype,"cssCamera",null),c([p()],hs.prototype,"_cssCamera",void 0),c([p({type:wr})],hs.prototype,"camera",null),c([p()],hs.prototype,"_camera",void 0),c([p({readOnly:!0})],hs.prototype,"pixelRatio",null),c([p()],hs.prototype,"rasterPixelRatio",void 0),c([p()],hs.prototype,"contentPixelRatio",void 0),c([p({readOnly:!0})],hs.prototype,"alignPixelEnabled",null),c([p({readOnly:!0})],hs.prototype,"updating",null),c([p({})],hs.prototype,"_contentCamera",void 0),c([p({type:wr})],hs.prototype,"contentCamera",null),c([p({readOnly:!0})],hs.prototype,"fixedContentCamera",null),c([p({readOnly:!0})],hs.prototype,"events",void 0),c([p({readOnly:!0})],hs.prototype,"isGlobal",null),c([p({readOnly:!0})],hs.prototype,"isLocal",null),c([p({readOnly:!0})],hs.prototype,"viewingMode",null),c([p({readOnly:!0})],hs.prototype,"highlights",null),c([p({readOnly:!0})],hs.prototype,"highlightOrderMap",null),c([p({readOnly:!0})],hs.prototype,"navigating",null),c([p()],hs.prototype,"fading",void 0),c([p({readOnly:!0})],hs.prototype,"stationary",null),c([p()],hs.prototype,"_cameraChanged",void 0),c([p()],hs.prototype,"cameraController",null),hs=c([R("esri.views.3d.state.ViewState")],hs);const jCe=hs;function Mjt(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[0]!==e.padding[0]||t.padding[1]!==e.padding[1]||t.padding[2]!==e.padding[2]||t.padding[3]!==e.padding[3]}let ph=new wr;const UCe="ViewStateHandles";function dp(t){let e,i,r=[],s=!1;function n(...a){return s&&e===this&&Ejt(a,r)||(i=t.apply(this,a),e=this,r=a,s=!0),i}return n}function Ejt(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}function NGe(t){return t?u$:Fjt}function Ajt(t,e){return e?.mode?e.mode:NGe(t).mode}function Ojt(t,e){return e??NGe(t)}function VGe(t,e){return Ajt(t==null||(t.hasZ??!1),e)}function Axi(t,e){return Ojt(t==null||(t.hasZ??!1),e)}function Oxi(t){const e=UGe(t);return VGe(t.geometry,e)}function Hpe(t){const e=UGe(t),i=VGe(t.geometry,e),r=e!=null&&i!=="on-the-ground"?qGe(e):0,s=e?.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function Pjt(t){return jGe(Hpe(t))}function Pxi(t){return jGe(t)||Rjt(t)}function Rjt(t){return t?.featureExpressionInfo?.expression==="0"}function jGe(t){if(!t||t.mode==="on-the-ground")return!1;const e=t?.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function UGe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}const Ijt=dp((t,e,i)=>{if(!t||e==="decimal-degrees")return 0;const r=e!=="unknown"&&e?e:"meters",s=pIe(i);return s?yi(t,r,s):0});function JH(t,e){return Ijt(t?.offset,t?.unit,e)}function Rxi(t,e,i){if(!i?.mode)return;const r=t.hasZ?t.z:0,s=JH(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function Djt(t,e,i,r=null){return Wpe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function BGe(t,e,i,r,s=null){return Wpe(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function Wpe(t,e,i,r,s,n,a=null){if(n==null)return;const o=a!=null?a.mode:"absolute-height";if(o==="on-the-ground")return 0;const{absoluteZ:l}=kjt(e,i,r,s,t,n);return Ljt(l,e,i,r,s,t,a,o)}function kjt(t,e,i,r,s,n){const a=JH(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+a,elevation:0};case"on-the-ground":{const o=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:o,elevation:o}}case"relative-to-ground":{const o=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+o+a,elevation:o}}case"relative-to-scene":{const o=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+o+a,elevation:o}}}}function Ljt(t,e,i,r,s,n,a,o){const l=JH(a,s);switch(o){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function Ixi(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function Dxi(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function kxi(t,e,i){return i?.mode===e?`${t} do not support ${e} elevation mode`:null}function Lxi(t,e){return e?.featureExpressionInfo!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function Fxi(t,e){e&&t.warn(".elevationInfo=",e)}function qGe(t){return(t?.offset??0)*vhe(t?.unit)}const u$={mode:"absolute-height",offset:0},Fjt={mode:"on-the-ground",offset:null},zjt="OBJECTID";let zxi=class extends ZF{constructor(e,i){super(i,null),this.point=e}},Vxi=class extends ZF{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function Njt(t){return td(t)&&t.intersector===6&&!!t.target}let Uxi=class extends _pe{constructor(e,i,r,s,n){super(e),this.layerViewUid=e,this.sublayerId=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},qxi=class extends ZF{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},Hxi=class extends _pe{};function Zpe(t){return td(t)&&t.intersector===2&&!!t.target}function Vjt(t){return td(t)&&t.intersector===9&&!!t.target}function jjt(t){return td(t)&&t.intersector===7&&!!t.target}function Zxi(t,e){if(!td(e)||!e.target||!("layerViewUid"in e.target))return!1;const i=e.target.layerViewUid;switch(t.allLayerViews.find(s=>s.uid===i)?.layer.type){case"integrated-mesh":case"integrated-mesh-3dtiles":return!0}return!1}let Ujt=class extends ZF{constructor(e,i,r){super(e,i),this.triangleNr=r}};function Bjt(t){return td(t)&&t.intersector===5&&!!t.target}function QH(t){return td(t)&&t.intersector===4&&!!t.target}function GGe(t,e){return QH(t)||mH(t)?_L(t.target?.object,e):jjt(t)?e.map?.ground:t.target&&"layerViewUid"in t.target?_L(t.target,e):null}function qjt(t,e){const i=Ype(t,e);return i?.type==="graphic"?i.graphic:null}function Ype(t,e,i={}){if(t==null)return null;if(QH(t)||mH(t))return BCe(t.target?.object,e,i);if(Njt(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(Vjt(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return Bjt(t)||bpe(t)?BCe(t.target,e,i):Zpe(t)?Gjt(t.target,e,i):null}function BCe(t,e,i){if(t?.graphicUid==null)return null;const r=_L(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid,i);const s=e.allLayerViews.find(n=>n.layer===r);return!s||s.suspended||t.graphicUid==null?null:"getHit"in s?s.getHit(t.graphicUid,i):null}function Gjt(t,e,i){const r=_L(t,e);if(r==null)return null;const s=e.allLayerViews.find(a=>a.layer===r);if(!s||s.suspended||!("getGraphicFromIntersectorTarget"in s))return null;const n=i.defer;return qCe(s.getGraphicFromIntersectorTarget(t,{defer:n?a=>n(async()=>qCe(await a())):void 0}))}function Hjt(t,e){const i=_L(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function qCe(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function _L(t,e){return t?.layerViewUid==null?null:e.graphicsView!=null&&t.layerViewUid===e.graphicsView.uid?e.graphics:e.allLayerViews.find(i=>i.uid===t.layerViewUid)?.layer}function Jxi(t,e){if(QH(t)||mH(t))return qg(t.target.object.boundingVolumeWorldSpace.bounds);if(bpe(t)){l5e(Vj,t.transformation);const i=Math.max(Vj[0],Vj[1],Vj[2]);return t.target.baseBoundingSphere.radius*i}if(Zpe(t)){const i=Hjt(t.target,e);return i?.5*Kmt(i):null}return null}function Qxi(t){return!QH(t)&&!mH(t)&&(bpe(t)?t.target.numLodLevels>1:!!Zpe(t))}const Vj=I();async function Wjt(t,e,i,r){const s=i?Qpe(t,i):r,n=yn(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const a=new Zu(t.state.viewingMode);a.options.selectionMode=!0,a.options.store=2,t.sceneIntersectionHelper.intersectIntersectorScreen(n,a,s);const o=await Yjt(t,a.results.all,s.graphics),l=a.results.ground,u=GGe(l,t),d=u!=null&&"type"in u&&t$(u)?u:null,f={screenPoint:e,results:o,ground:{mapPoint:TE(t,l),distance:td(l)?l.distanceInRenderSpace:0,layer:d}};return bn.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(f.intersector=a),f}function Zjt(t,e,i,r){const s=i?Qpe(t,i):r,n=!(!s.graphics?.include&&!s.graphics?.exclude),a=!(!s.mediaElements?.include&&!s.mediaElements?.exclude),o=Ff(e);s.enableDraped=s.include&&!s.include.has(b1)||s.exclude?.has(b1);const l=t.sceneIntersectionHelper,u=new Zu(t.state.viewingMode);if(u.options.selectionMode=!0,u.options.store=n||a?2:0,u.options.excludeLabels=i?.excludeLabels??!1,l.intersectIntersectorScreen(o,u,s),n||a){for(const d of u.results.all){const f=Ype(d,t);if(f==null||n&&(f.type!=="graphic"||HGe(s.graphics,f.graphic))||a&&(f.type!=="media"||WGe(s.mediaElements,f.element)))return TE(t,d)}return null}return TE(t,u.results.min)}async function Yjt(t,e,i){const r=new Array;let s,n=null;const a={defer(o){s=o()}};for(let o=0;o<e.length;o++){const l=e[o],u=GGe(l,t);if(u!=null&&(u===t.map.ground||"type"in u&&t$(u)))break;const d=Ype(l,t,a)??await s;if(s=null,d==null)continue;if(d.type==="graphic"){if(n==null&&o!==e.length-1&&(n=new Set),n!=null){const v=Jpe(d.graphic);if(n.has(v))continue;n.add(v)}if(!HGe(i,d.graphic))continue}const f=TE(t,l),g=l.distanceInRenderSpace;if(d.type==="media"){const v=d.element.toSource(f);r.push({...d,mapPoint:f,distance:g,sourcePoint:v})}else r.push({...d,mapPoint:f,distance:g})}return r}function TE(t,e,i){return e.getIntersectionPoint($E)?(i=eoe(t,$E,i),e.intersector===7&&t.basemapTerrain&&(i.z=Lg(t.basemapTerrain,i)??0),i):null}function Jpe(t){const e=t.getObjectId()??t.attributes?.[zjt];return t.origin&&e!=null?`o-${t.origin.id}-${e}`:`u-${t.uid}`}function HGe(t,e){return WGe(t,Jpe(e))}function WGe(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function eoe(t,e,i){let r=t.spatialReference||Me.WGS84;return Co(e,t.renderSpatialReference,$E,r)?e=$E:(r=Me.WGS84,Co(e,t.renderSpatialReference,$E,r)&&(e=$E)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new Ue(e,r),i}function Qpe(t,e){const i=toe(t,e.include,0),r=toe(t,e.exclude,1);return{include:i.layerViewUids,exclude:r.layerViewUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function toe(t,e,i,r=new Jjt){if(!e)return r;if(e instanceof ms)Xjt(r,Jpe(e)),i===0&&(t.graphicsView!=null&&e.layer===t?ZB(r,t.graphicsView.uid):e.layer&&eK(r,t,e.layer.uid));else if("layer"in e&&"element"in e)Kjt(r,e.element),i===0&&eK(r,t,e.layer.uid);else if(oO(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?ZB(r,t.graphicsView.uid):s===t.map.ground?ZB(r,b1):toe(t,s,i,r);else"layer"in e&&Qjt(r,t,e),"uid"in e&&eK(r,t,e.uid);return r}let Jjt=class{constructor(){this.layerViewUids=null,this.graphicUids=null,this.mediaElements=null}};function eK(t,e,i){const r=e.allLayerViews.find(s=>s.layer.uid===i);r&&ZB(t,r.uid)}function ZB(t,e){t.layerViewUids??=new Map,t.layerViewUids.set(e,!0)}function Qjt(t,e,i){const r=e.allLayerViews.find(n=>n.layer.uid===i.layer.uid);if(!r)return;t.layerViewUids??=new Map;const s=t.layerViewUids.get(r.uid);s!==!0&&(s?s.add(i.id):t.layerViewUids.set(r.uid,new Set([i.id])))}function Xjt(t,e){t.graphicUids??=new Set,t.graphicUids.add(e)}function Kjt(t,e){t.mediaElements??=new Set,t.mediaElements.add(e)}const $E=I();function GCe(t){return(e,i,r)=>!ade(t,cr(e6t,e,i,r))}const e6t=I();let t6t=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new Ai,this._tolerance=BO,this._tmpRay=$n(),this._tmpRegion=fi(),this._validateHUDIntersector=new Zu(this.viewingMode),this._validateHUDIntersector.options.hud=!1}destroy(){this._externalIntersectionHandlers.prune()}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),HCe(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,HCe(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=0,this.computeIntersection(e,i,!1,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(Uj,r,s),Uj[0]+=.0466,Uj[1]-=.0123,Zde(e,Uj,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,!1,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,!1,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||td(s)&&s.intersector!==7||(i.options.selectionMode=!1,this.computeIntersection(e,i,!1,r))}setTolerance(e=BO){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===7?1:r.type===7?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===7?1:r.type===7?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return Wde(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==2||e==null||$e(i,e.origin,Re(Xe.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:a}=n,o=ed(n.spatialReference),l=i!=null?i.mode:"absolute-height",u=qGe(i)/o,d=(l!=="on-the-ground"?u+r:0)*o/a.unitInMeters,{camera:f}=n.state;if(l==="absolute-height"){const P=a?.getAltitude(f.eye),O=Le(Re(LI,e.direction),a.worldUpAtPosition(f.eye,s6t));if(P<d&&O<0||P>=d&&O>0)return null;if(a.intersectInfiniteManifold(e,d,LI)){const D=eoe(n,LI);return D.z??=0,D.z-=u,D}return null}const g=f.projectToRenderScreen(e.origin,Xe.get()),v=new WCe(null,this._forEachLayer),_=n.slice.plane,x=_!=null?GCe(_):null,S=new Zu(this.viewingMode);S.options.store=0,S.options.verticalOffset=d,S.options.normalRequired=!1;const T=e.origin,M=$e(Xe.get(),T,e.direction);S.reset(T,M,f),S.point=g;let E=null;if(s&&"type"in s&&s.type==="graphics"){const P=n.allLayerViews.find(O=>O.layer===s)?.uid;E=P?O=>O.layerViewUid===P:null}else s&&(E=P=>P.graphicUid!==s.uid);switch(l){case"relative-to-scene":{const P=O=>(!E||E(O))&&!!O.lastValidElevationBB;S.intersect(v.layers,g,this._tolerance,null,P),this._externalIntersectionHandlers.forAll(O=>{if(O.type===2||O.type===7||O.type===8){const D=O.slicePlaneEnabled?x:null;O.intersect(S,D,S.rayBegin,S.rayEnd,g,!1)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(P=>{if(P.isGround){const O=P.slicePlaneEnabled?x:null;P.intersect(S,O,S.rayBegin,S.rayEnd,g,!1)}})}if(S.results.min.getIntersectionPoint(LI)){const P=eoe(n,LI);return P.z=r,P}return null}computeIntersection(e,i,r,s){if(e==null)return;const n=this._view.state.camera,a=n.projectToRenderScreen(e.origin,Xe.get()),o=new WCe(s,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!s||!("include"in s||"exclude"in s);const l=e.origin,u=$e(Xe.get(),e.origin,e.direction);i.reset(l,u,n),i.intersect(o.layers,a,this._tolerance);const d=this._view.slice.plane,f=d!=null?GCe(d):null;i.intersect(o.sliceableLayers,a,this._tolerance,f);const g=s&&(s.requiresGroundFeedback||s.enableDraped);this._externalIntersectionHandlers.forAll(S=>{const T=S.layerViewUid,M=S.sublayerId,E=Array.isArray(T),P=E?T:[T];E&&(i.options.filteredLayerViewUids=[]);let O=!1;for(const D of P)o.filterLayerViewUid(D,M)?O=!0:E&&i.options.filteredLayerViewUids.push(D);if(i.options.isFiltered=!O,S.isGround&&g||!i.options.isFiltered){const D=S.slicePlaneEnabled?f:null;S.intersect(i,D,l,u,a,r)}});const v=Xe.get(),_=this._view,x=_.basemapTerrain;if(s&&s.enableDraped&&x.spatialReference!=null&&i.results.ground.getIntersectionPoint(v)){const S=_.overlayManager.renderer,T=_.renderCoordsHelper.spatialReference,M=Xe.get();_.renderCoordsHelper.fromRenderCoords(v,M,x.spatialReference),M[2]=_.elevationProvider?.getElevation(v[0],v[1],v[2],T,"ground")??0,S.intersect(i,M,i.results.ground,E=>o.filterRenderGeometry(E))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;O1(this._tmpRegion,mte);const r=this._view.state.camera,s=[],n=this._tmpRegion,a=T=>{const M=new r6t(T),E=M.result.target.object.geometries.every(P=>P.material instanceof gpe&&P.material.parameters.occlusionTest);s.push({item:M,occlusionTest:E}),E&&(r.projectToRenderScreen(T.target.center,M.screenPoint),M.screenPoint[0]=Math.floor(M.screenPoint[0]),M.screenPoint[1]=Math.floor(M.screenPoint[1]),zh(n,M.screenPoint))};e.sortResults(i.all),i.min.distance!=null&&a(i.min);for(const T of i.all)i.min.target.object!==T.target.object&&i.max.target.object!==T.target.object&&a(T);if(i.max.distance!=null&&i.max.target.object!==i.min.target.object&&a(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const o=r.fullWidth,l=r.fullHeight,u=Math.max(0,n[0]-Dk),d=Math.max(0,n[1]-Dk),f=Math.min(So(n)+2*Dk,o-u),g=Math.min(Zl(n)+2*Dk,l-d),v=f>0&&g>0?new Uint8Array(f*g*4):null;v&&this._view.stage.renderer.readHUDVisibility(u,d,f,g,v);let _=!0;const x=e.results.max.distance==null;let S=0;for(const{item:T,occlusionTest:M}of s){let E=!M;if(M&&v)for(const P of i6t){const O=4*(Math.min(T.screenPoint[0]+P[0],o)-n[0]+(Math.min(T.screenPoint[1]+P[1],l)-n[1])*f);if(O>=0&&O<v.length&&v[O]){E=!0;break}}E&&(_&&(e.results.min.copy(T.result),_=!1),x&&e.results.max.copy(T.result),e.options.store===2&&e.results.all.splice(S++,0,T.result))}}};const Dk=1,i6t=(()=>{const t=[],e=Dk;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let r6t=class{constructor(e){this.result=e,this.screenPoint=Dg()}},jj;function HCe(t){return jj&&jj.viewingMode===t||(jj=new Zu(t)),jj}let WCe=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,i(r=>{r.pickable&&this.filterLayerViewUid(r.apiLayerViewUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerViewUid(e,i){const{include:r,exclude:s}=this;if(e==null)return r==null&&s==null;const n=r instanceof Map?r.get(e)??!1:r?.has(e),a=s instanceof Map?s.get(e)??!1:s?.has(e);return(n==null||(typeof n=="boolean"?n:i!=null&&n.has(i)))&&(a==null||!(typeof a=="boolean"?a:i!=null&&a.has(i)))}filterRenderGeometry(e){return this.filterLayerViewUid(e.layerViewUid)}};function ZCe(t){return typeof t=="object"&&"intersect"in t}const LI=I(),s6t=I(),Uj=Dg();let i2i=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},n6t=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Tt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.readyToRun)if(e)this.runTask(Jl);else for(const i of this._queries)i.result.reject(ti())}queryElevation(e,i,r,s=0){const n=Eo(),a={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(a),Mo(r,()=>{oP(this._queries,a),n.reject(ti())}),n.promise}get readyToRun(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(d=>d.result.reject()),void e.madeProgress();const s=i.map(d=>[d.x,d.y]),n=i.reduce((d,f)=>Math.min(d,f.minDemResolution),1/0),a=new Ho({points:s,spatialReference:this.spatialReference}),o=i.length>1&&i.some(d=>!!d.signal)?new AbortController:null,l=o!=null?o.signal:i[0].signal;if(o!=null){let d=0;i.forEach(f=>Mo(f.signal,()=>{d++,f.result.reject(ti()),d===i.length&&o.abort()}))}const u={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(a,u).then(d=>{i.forEach((f,g)=>{f.signal!=null&&f.signal.aborted?f.result.reject(ti()):f.result.resolve(d.geometry.points[g][2])})}).catch(d=>{i.forEach(f=>f.result.reject(d))}),e.madeProgress()}get test(){}},ZG=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},kk=class extends Ju{get spatialReference(){return this.view.basemapTerrain?.spatialReference??this.view.spatialReference}constructor(e){super(e),this._providers=[new Array,new Array,new Array],this._lastResult=null,this._cacheEnabled=!1}reset(){this._cachedQuery?.destroy({completeTasks:!0}),this._cachedQuery=this._lastResult=null}enableCache(e){e||(this._lastResult=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){const a=this._cacheEnabled&&this._lastResult;if(a&&e===a.x&&i===a.y&&r===a.z&&zr(s,a.spatialReference)&&n===a.queryContext)return a.result;let o=this._updateElevation(null,1,e,i,r,s,n);return n!=="im"&&o==null&&(o=this._updateElevation(null,0,e,i,r,s,n)),n==="scene"&&(o=this._updateElevation(o,2,e,i,r,s,n)),this._cacheEnabled&&(this._lastResult=new a6t(e,i,r,s,n,o)),o}getSphereElevationBounds(e,i,r){let s=null;const n=a=>{for(const o of this._providers[a])if(o.getSphereElevationBounds){const l=o.getSphereElevationBounds(e,i,r);l!=null&&(s??=new ZG,s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax))}};return r!=="im"&&n(0),n(1),r==="scene"&&n(2),s}getRootElevationBounds(){return this._providers.reduce((e,i)=>i.reduce((r,s)=>{const n=s.getRootElevationBounds?.();return n!=null&&(r??=new ZG,r.expandElevationRangeValues(n.elevationRangeMin,n.elevationRangeMax)),r},e),null)}async queryElevation(e,i,r,s,n,a=null,o=0){const l=this._getElevationQuery(s);try{const u=await l.queryElevation(e,i,a,o);return n==="scene"?this._updateElevation(u,2,e,i,r,s,n):u}catch(u){return ml(u),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providers[e].push(i),this.reset()}unregister(e){this.removeHandles(e);for(const i of this._providers){const r=i.indexOf(e);r>-1&&i.splice(r,1)}this.reset()}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&zr(e,i.spatialReference))return i;i?.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:a}=e,o=new n6t(this.view.resourceController.scheduler,new Me({wkid:r,wkt:s,wkt2:n,latestWkid:a}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._cachedQuery=o,o}_updateElevation(e,i,r,s,n,a,o){return this._providers[i].reduce((l,u)=>{const d=u.getElevation(r,s,n,a,o);return d==null?l:Math.max(d,l??d)},e)}};c([p({constructOnly:!0})],kk.prototype,"view",void 0),c([p()],kk.prototype,"spatialReference",null),kk=c([R("esri.views.3d.support.CombinedElevationProvider")],kk);let a6t=class{constructor(e,i,r,s,n,a){this.x=e,this.y=i,this.z=r,this.spatialReference=s,this.queryContext=n,this.result=a}};var rO;let YB=(rO=class{static isValidProfile(e){return e in tK}static getDefaultProfile(){return ie("esri-iPhone")?"low":"medium"}static apply(e,i){const r=tK[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.gaussianSplat.minimumSplatPixelRadius=r.gaussianSplat.minimumSplatPixelRadius,i.gaussianSplat.minimumOpacity=r.gaussianSplat.minimumOpacity,i.gaussianSplat.maxAllowedVisibleGaussians=r.gaussianSplat.maxAllowedVisibleGaussians,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.flow3D.maxTotalNumberOfStreamlines=r.flow3D.maxTotalNumberOfStreamlines,i.flow3D.maxTracingResolution=r.flow3D.maxTracingResolution,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.maxTexturePixels=r.maxTexturePixels,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}},rO.test={reset(){const e=ZGe();for(const i of Object.keys(e))tK[i]=e[i]}},rO);const FI={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430},tK=ZGe();function ZGe(){const t=!!ie("esri-mobile"),e=!!ie("ios"),i=400;return{low:{flow3D:{maxTotalNumberOfStreamlines:25e3,maxTracingResolution:1024},graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5}},gaussianSplat:{minimumSplatPixelRadius:2,minimumOpacity:.1,maxAllowedVisibleGaussians:4e6},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,maxTexturePixels:t?1048576:4194304,memoryLimit:200+FI.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{flow3D:{maxTotalNumberOfStreamlines:1e5,maxTracingResolution:2048},graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1}},gaussianSplat:{minimumSplatPixelRadius:1,minimumOpacity:.05,maxAllowedVisibleGaussians:8e6},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,maxTexturePixels:t?4194304:4096**2,memoryLimit:t?600+FI.GalaxyS20:750+FI.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{flow3D:{maxTotalNumberOfStreamlines:1e5,maxTracingResolution:2048},graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1}},gaussianSplat:{minimumSplatPixelRadius:.5,minimumOpacity:.005,maxAllowedVisibleGaussians:16e6},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,maxTexturePixels:t?4096**2:1/0,memoryLimit:t?900+FI.SurfacePro7:1500+FI.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}async function o6t(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+l6t),n=i.results.findIndex(a=>(a.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const l6t=.05;function c6t(t){return t?.type==="graphic"}function u6t(t){return t.find(c6t)??null}async function h6t(t,e){const{results:i,ground:r}=await o6t(t,e),s=(!r.layer||!t$(r.layer))&&r.mapPoint,n=[],a=f6t(t),o=s?d6t(t,a):p6t;let l=0,u=0;const d=()=>{const g=o.layerViews[u++];if(!s||!g||!("fetchPopupFeaturesAtLocation"in g))return;const v=r.mapPoint,_=g.layer;if(WE(_)&&"effectiveScaleRange"in _){const{minScale:x,maxScale:S}=_.effectiveScaleRange;if(FGe(x,S)){if(j4e(_)&&!Kae(t.scale,x,S))return;const T=t.basemapTerrain.getScale(v);if(!Kae(T,x,S))return}}n.push({mapPoint:v,layerView:g})};let f=null;for(;l<i.length||u<o.layerViews.length;){const g=i[l];if(g&&g.type!=="graphic")++l;else if(g?.layer?.type!=="scene"||g?.layer?.parent!==t?.map?.basemap)if(g){const v=g.layer?.uid,_=o.layerUids.has(v)&&g.distance===r.distance,x=a.get(g.layer?.uid);if(f??=g.mapPoint,u<o.layerViews.length&&(_||(g.distance??0)>r.distance)&&o.layerViews[u]!==x){d();continue}n.push({graphic:g.graphic,layerView:x}),++l}else d();else++l}return f??=r.mapPoint,{hits:n,location:f}}function d6t(t,e){const i=new Set,r=new Set;for(let n=t.basemapTerrain.numLayers(1)-1;n>=0;n--){const a=t.basemapTerrain.layerViewByIndex(n,1);i.add(a.layer.uid),r.add(a)}const s=t.overlayManager.renderer.layers;for(const{uid:n}of s){const a=e.get(n);a&&(i.add(n),r.add(a))}return{layerUids:i,layerViews:Array.from(r).reverse()}}const p6t={layerUids:new Set,layerViews:[]};function f6t(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let Nd=class extends be{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};c([p()],Nd.prototype,"minTotalNumberOfFeatures",void 0),c([p()],Nd.prototype,"maxTotalNumberOfFeatures",void 0),c([p()],Nd.prototype,"maxNumberOfDrawCalls",void 0),c([p()],Nd.prototype,"maxTotalNumberOfVertices",void 0),c([p()],Nd.prototype,"snapshotAvailable",void 0),c([p()],Nd.prototype,"polygonLodFactor",void 0),c([p()],Nd.prototype,"polylineLodFactor",void 0),c([p()],Nd.prototype,"skipHighSymbolLods",void 0),Nd=c([R("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Nd);let J2=class{constructor(){this.minimumSplatPixelRadius=1,this.minimumOpacity=.05,this.maxAllowedVisibleGaussians=8e6}};c([p()],J2.prototype,"minimumSplatPixelRadius",void 0),c([p()],J2.prototype,"minimumOpacity",void 0),c([p()],J2.prototype,"maxAllowedVisibleGaussians",void 0),J2=c([R("esri.views.3d.support.QualitySettings.GaussianSplatSettings")],J2);let Zf=class extends be{constructor(){super(...arguments),this.lodFactor=1}};c([p()],Zf.prototype,"lodFactor",void 0),Zf=c([R("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Zf);let ew=class extends be{constructor(){super(...arguments),this.object=new Zf,this.point=new Zf,this.integratedMesh=new Zf,this.pointCloud=new Zf}};c([p({type:Zf})],ew.prototype,"object",void 0),c([p({type:Zf})],ew.prototype,"point",void 0),c([p({type:Zf})],ew.prototype,"integratedMesh",void 0),c([p({type:Zf})],ew.prototype,"pointCloud",void 0),ew=c([R("esri.views.3d.support.QualitySettings.SceneServiceSettings")],ew);let qv=class extends be{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};c([p()],qv.prototype,"lodBias",void 0),c([p()],qv.prototype,"angledSplitBias",void 0),c([p()],qv.prototype,"vtlContentZoom",void 0),c([p()],qv.prototype,"elevationLevelDelta",void 0),c([p()],qv.prototype,"reduceTileLevelDifferences",void 0),qv=c([R("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],qv);let CE=class extends be{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};c([p()],CE.prototype,"pixelRatio",void 0),c([p()],CE.prototype,"maxTotalNumberOfFeatures",void 0),CE=c([R("esri.views.3d.support.QualitySettings.HeatmapSettings")],CE);let ME=class extends be{constructor(){super(...arguments),this.maxTotalNumberOfStreamlines=1e5,this.maxTracingResolution=2048}};c([p()],ME.prototype,"maxTotalNumberOfStreamlines",void 0),c([p()],ME.prototype,"maxTracingResolution",void 0),ME=c([R("esri.views.3d.support.QualitySettings.Flow3DSettings")],ME);let Bn=class extends be{constructor(){super(...arguments),this.graphics3D=new Nd,this.sceneService=new ew,this.tiledSurface=new qv,this.gaussianSplat=new J2,this.heatmap=new CE,this.flow3D=new ME,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.glow=!1,this.maxTexturePixels=1/0,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};c([p({type:Nd})],Bn.prototype,"graphics3D",void 0),c([p({type:ew})],Bn.prototype,"sceneService",void 0),c([p({type:qv})],Bn.prototype,"tiledSurface",void 0),c([p({type:J2})],Bn.prototype,"gaussianSplat",void 0),c([p({type:CE})],Bn.prototype,"heatmap",void 0),c([p({type:ME})],Bn.prototype,"flow3D",void 0),c([p()],Bn.prototype,"fadeDuration",void 0),c([p()],Bn.prototype,"antialiasingEnabled",void 0),c([p()],Bn.prototype,"physicallyBasedRenderingEnabled",void 0),c([p()],Bn.prototype,"highQualityTransparency",void 0),c([p()],Bn.prototype,"highResolutionAtmosphere",void 0),c([p()],Bn.prototype,"reflections",void 0),c([p()],Bn.prototype,"ambientOcclusion",void 0),c([p()],Bn.prototype,"glow",void 0),c([p()],Bn.prototype,"maxTexturePixels",void 0),c([p()],Bn.prototype,"memoryLimit",void 0),c([p()],Bn.prototype,"additionalCacheMemory",void 0),c([p()],Bn.prototype,"frameRate",void 0),c([p()],Bn.prototype,"maximumPixelRatio",void 0),Bn=c([R("esri.views.3d.support.QualitySettings")],Bn);const YCe=Bn;let m6t=class ioe{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=dEt(s),this.referenceEllipsoid=xr(i),this.sphericalPCPF=v1(i)}set extent(e){e&&pEt(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return fEt(this._coordinateSystem,fi())}getAltitude(e){return xEt(this._coordinateSystem,e)}setAltitude(e,i,r=e){return a6e(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){SEt(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return vEt(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return _Et(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,0,Xe.get()),s=this.worldBasisAtPosition(e,1,Xe.get()),n=this.worldBasisAtPosition(e,2,Xe.get());return sy(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Xe.get()),s=this.worldBasisAtPosition(e,1,Xe.get()),n=Eje(i,s,r);return to(n)}intersectManifoldClosestSilhouette(e,i,r){return RQ(this._coordinateSystem,i,this._tmpCoordinateSystem),wEt(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){RQ(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=Xe.get();return bEt(this._tmpCoordinateSystem,e,s)?me(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===1)return this.intersectManifold(e,i,r);RQ(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Xe.get();return MP(s.plane,e,n)?me(r,n):null}toRenderCoords(e,i,r){return yG(e)?Jc(e,i,this.spatialReference):Co(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return yG(i)?(r!=null&&(i.spatialReference=r),P$(e,this.spatialReference,i)?i:null):Co(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case 2:return new ioe(2,i,Yr(i),yEt());case 1:return new ioe(1,i,1,gEt(i))}}static renderUnitScaleFactor(e,i){return X_e(e)/X_e(i)}};const g6t=(()=>{const t=new Array;return t[0]=10,t[1]=10,t[2]=10,t[3]=10,t[4]=5,t})(),y6t=30;function v6t(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function _6t(t){return new kl({view:t})}const JCe=.1,Bj=1,iK=1,b6t=.75,w6t=.6,QCe=1.3,qj=!!ie("esri-tests-disable-memory-pools");let kl=class extends be{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._predictedMemory=0,this._cacheStorage=new Rhe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=qj?4096:750,this._additionalCacheMemory=qj?-4096:0,this.addHandles(Hg({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||qj||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(Bj),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e==null||qj||(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i,r){return new GTt(e,this._cacheStorage,i,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._predictedMemory<=0&&!this._updating)return;let e=this._layersUpdating();if(this._predictedMemory<w6t&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(Bj);else if(e){if(this._predictedMemory>1.1*iK||this._usedMemory>iK){if(this._stableQuality>0)this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality);else if(this._quality>JCe&&this._downscaleMemoryUsed<this._usedMemory){if(this._compactAndUpdate())return;this._updateQuality(this._quality/QCe),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1}}}else if(this._downscaleMemoryUsed=0,this._usedMemory>iK){if(this._compactAndUpdate())return;this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/QCe),this._downscaleMemoryUsed=this._predictedMemory}else this._stableQuality!==this._quality&&(this._usedMemory<b6t&&this._quality<Bj?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0));this._updating=e}_compactAndUpdate(){const e=r0t(100),i=this.view.stage.compact(e);return this.view.overlayManager.renderer.compact(e)||i}_updateQuality(e){return(e=Math.min(Math.max(e,JCe),Bj))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view?.updating||this.view.destroyed||this.view.destroying)return;this.view.stage?.renderer?.tick();const e=this.view.stage?.renderer?.usedMemory;let i=(this.view.basemapTerrain?.usedMemory??0)+(e?e.fbos+e.edges+e.plugins:0)+this.view.deconflictor?.usedMemory+this.view.labeler?.usedMemory,r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(v6t(o)){const l=o.ignoresMemoryFactor?this._quality:1;i+=o.usedMemory*l,r+=o.unloadedMemory*l}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const o=u=>(u/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);re.getLogger(this).warn(`Memory Limit exceeded! Limit: ${o(n)} Current: ${o(i)} Projected: ${o(i+r)} Quality: ${l}%`)}this._usedMemory=i/n,this._predictedMemory=(i+r)/n;const a=n-i;this._cacheStorage.maxSize=Math.max(0,a+1048576*this.additionalCacheMemory)}get test(){}};c([p({constructOnly:!0})],kl.prototype,"view",void 0),c([p()],kl.prototype,"maxMemory",null),c([p()],kl.prototype,"additionalCacheMemory",null),c([p({readOnly:!0})],kl.prototype,"memoryFactor",null),c([p({readOnly:!0})],kl.prototype,"updating",null),c([p({readOnly:!0})],kl.prototype,"usedMemory",null),c([p({readOnly:!0})],kl.prototype,"usedCacheMemory",null),c([p()],kl.prototype,"_quality",void 0),c([p()],kl.prototype,"_usedMemory",void 0),c([p()],kl.prototype,"_updating",void 0),c([p()],kl.prototype,"_stableQuality",void 0),c([p()],kl.prototype,"_maxMemory",void 0),c([p()],kl.prototype,"_additionalCacheMemory",void 0),kl=c([R("esri.views.3d.support.MemoryController")],kl);let x6t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},S6t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new T6t}},T6t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},$6t=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new S6t(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,xt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},C6t=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function N3(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function YGe(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function JGe(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function XH(t){return t!=null&&"type"in t&&t.type==="image+type"}let JB=class extends be{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new $6t((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(Tt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Xi(this._frameTask),this._tasks.forEach(e=>Rs(e.abortController)),this._loadQueue=Pe(this._loadQueue),this._onLoadQueue.length=0,this._onLoadQueue=null,this._doneQueue.length=0,this._doneQueue=null,this._tasks.forEach(e=>e.destroy()),this._tasks.clear(),this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=Eo();return n.__signal=s!=null?s.signal:null,this._createOrUpdateTask(e,i,r,s,n),n.promise}_createTask(e,i,r,s,n,a){const o=new A6t(e,i,r,s,n);return this._updateTask(o,a),this._tasks.set(n,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,i){const r=this._tasks.get(e);r&&(Uc(r.resolvers,i),i.reject(ti()),r.resolvers.length===0&&(r.status===2&&this._loadQueue.cancel(r),r.status=4,this._removeTask(r)))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const a=O6t(s?.uid||e,i,r);let o=this._tasks.get(a);o?this._updateTask(o,n):(o=this._createTask(e,s,i,r,a,n),o.abortHandle=Mo(s,()=>this._cancelRequest(a,n)))}_doneLoadingCB(e,i){this._loadQueue&&(xt(e.status===2),e.status=3,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get readyToRun(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();ct(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==3&&(i.err=i.err||ti()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!Zr(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=XH(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)Zr(i)?s.reject(i):s.reject(new q("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?se(e.result):e.result;s.resolve(n)}this._removeTask(e)}_removeTask(e){this._tasks.delete(e.key),e.destroy(),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===4)return!1;let r,s;switch(e.startTime=performance.now(),e.status=2,e.docType){case 1:s="array-buffer",r=0;break;case 2:s="image";break;case 3:s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Si(e.url,{...e.options,responseType:s,timeout:r,signal:n});const a=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},o=l=>{e.status===2&&i(e,l)};return e.docType!==3?(e.request.then(l=>a(l.data),o),!0):(e.request.then(l=>{const u=l.data,d=E6t(u);if(s="image",e.size=u.byteLength,d==="unknown")return e.request=Si(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(v=>a(v.data),o);const f=new Blob([u],{type:d}),g=window.URL.createObjectURL(f);e.request=Si(g,{responseType:s,timeout:r,signal:n}),e.request.then(v=>a(new C6t(v.data,d)),o).finally(()=>window.URL.revokeObjectURL(g))},o),!0)}get test(){}};c([p({readOnly:!0})],JB.prototype,"updating",void 0),JB=c([R("esri.views.3d.support.StreamDataLoader")],JB);const M6t={numRetries:0};function E6t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let A6t=class extends x6t{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.abortHandle=null,this.result=null,this.status=1,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=M6t.numRetries}destroy(){this.result=null,this.request=null,this.abortController?.abort(),this.abortController=null,this.resolvers.length=0,this.options=null,this.abortHandle=Xi(this.abortHandle)}};function O6t(t,e,i){return`${t}:${e}:${i}`}let P6t=class{constructor(e,i){this._loader=e,this._clientType=i}request(e,i,r={}){return this._loader.request(e,i,this._clientType,r)}get busy(){return!this._loader.hasDownloadSlots(this._clientType)}},QB=class extends be{constructor(){super(...arguments),this.updating=!1}};function R6t(t){return new ng({view:t})}c([p({readOnly:!0})],QB.prototype,"updating",void 0),QB=c([R("esri.views.3d.support.ResourceController.ResourceControllerMain")],QB);let ng=class extends QB{constructor(){super(...arguments),this._immediateTask=Rw,this._normalTask=Rw,this._updatingObjects=ta([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=GFe(),this._memoryController=_6t(this.view),this._streamDataLoader=new JB,this._streamDataLoader.setup(y6t,g6t,this._scheduler),this.addHandles([X(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Hg({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Tt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Tt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Xi(this._frameTask),this._streamDataLoader=Pe(this._streamDataLoader),this._memoryController=Pe(this._memoryController),this._scheduler=Pe(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){return new P6t(this._streamDataLoader,e)}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],bi(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Ole(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this.view.state&&(this._scheduler.state=this.view.state.fading?1:this.view.state.mode,this.view.state.fading=!1),this._scheduler.frame(e))}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};c([p()],ng.prototype,"view",void 0),c([p()],ng.prototype,"_scheduler",void 0),c([p()],ng.prototype,"_memoryController",void 0),c([p()],ng.prototype,"_streamDataLoader",void 0),c([p()],ng.prototype,"_immediateTask",void 0),c([p()],ng.prototype,"_normalTask",void 0),c([p({readOnly:!0})],ng.prototype,"updating",null),ng=c([R("esri.views.3d.support.ResourceController")],ng);let M2i=class{constructor(e,i=0,r=0,s=0,n=0,a=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=a}};function I6t(t){return"performanceInfo"in t}let D6t=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},k6t=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=1048576*(i.maxMemory??0),this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e.stage?.renderer.usedMemory.edges??0,this.fboMemory=e.stage?.renderer.usedMemory.fbos??0,e.allLayerViews?.items.forEach(i=>{I6t(i)&&this.layerPerformanceInfos.push(new D6t(i))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}},L6t=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load(0,e,i)}async loadBinary(e,i){return mm(e)?(ct(i),xRe(e)):this._load(1,e,i)}async loadImage(e,i){return this._load(2,e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await Si(i,{responseType:F6t[e]})).data;const s=await Sp(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw ml(s.error),new q("glt-loader-request-error",`Request for resource failed: ${s.error}`)}};const F6t={2:"image",1:"array-buffer",0:"json",3:void 0};let Kg=class QGe{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get outerSize(){return this._outer.size}get size(){let e=0;for(const i of this._outer.values())e+=i.size;return e}get(e,i){return this._outer.get(e)?.get(i)}getInner(e){return this._outer.get(e)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}pop(e,i){const r=this.get(e,i);return this.delete(e,i),r}*outerMap(){for(const e of this._outer)yield e}*values(){for(const e of this._outer.values())yield*e.values()}*[Symbol.iterator](){for(const[e,i]of this._outer)for(const[r,s]of i)yield[e,r,s]}forEach(e){this._outer.forEach((i,r)=>e(i,r))}forAll(e){this._outer.forEach((i,r)=>i.forEach((s,n)=>e(s,r,n)))}copy(){const e=new QGe;return this.forAll((i,r,s)=>e.set(r,s,i)),e}};async function J0(t,e){const{data:i}=await Si(t,{responseType:"image",...e});return i}function z6t(t,e){return new Promise((i,r)=>{t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?i():(e(J8(t,"canplay",i)),e(J8(t,"error",r)))})}function N6t(){return XCe??=(async()=>{const t=await W(()=>import("./basis_transcoder-DuG70Smz.js"),[]),e=await t.default({locateFile:i=>Qs(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})(),XCe}let XCe,im=null,Gj=null;async function XGe(){return Gj==null&&(Gj=N6t(),im=await Gj),Gj}function V6t(t,e){if(im==null)return t.byteLength;const i=new im.BasisFile(new Uint8Array(t)),r=e9e(i)?KGe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function j6t(t,e){if(im==null)return t.byteLength;const i=new im.KTX2File(new Uint8Array(t)),r=t9e(i)?KGe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function KGe(t,e,i,r,s){const n=rhe(e?pn.COMPRESSED_RGBA8_ETC2_EAC:pn.COMPRESSED_RGB8_ETC2),a=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*a)}function e9e(t){return t.getNumImages()>=1&&!t.isUASTC()}function t9e(t){return t.getFaces()>=1&&t.isETC1S()}async function U6t(t,e,i){im==null&&(im=await XGe());const r=new im.BasisFile(new Uint8Array(i));if(!e9e(r))return null;r.startTranscoding();const s=i9e(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,a)=>r.getImageTranscodedSizeInBytes(0,n,a),(n,a,o)=>r.transcodeImage(o,0,n,a,0,0));return r.close(),r.delete(),s}async function B6t(t,e,i){im==null&&(im=await XGe());const r=new im.KTX2File(new Uint8Array(i));if(!t9e(r))return null;r.startTranscoding();const s=i9e(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,a)=>r.getImageTranscodedSizeInBytes(n,0,0,a),(n,a,o)=>r.transcodeImage(o,n,0,0,a,0,-1,-1));return r.close(),r.delete(),s}function i9e(t,e,i,r,s,n,a,o){const{compressedTextureETC:l,compressedTextureS3TC:u}=t.capabilities,[d,f]=l?r?[1,pn.COMPRESSED_RGBA8_ETC2_EAC]:[0,pn.COMPRESSED_RGB8_ETC2]:u?r?[3,pn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[2,pn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[13,6408],g=e.hasMipmap?i:Math.min(1,i),v=[];for(let _=0;_<g;_++)v.push(new Uint8Array(a(_,d))),o(_,d,v[_]);return e.internalFormat=f,e.hasMipmap=v.length>1,e.samplingMode=e.hasMipmap?9987:9729,e.width=s,e.height=n,new qi(t,e,{type:"compressed",levels:v})}const Hj=()=>re.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),q6t=542327876,G6t=131072,H6t=4;function Xpe(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function W6t(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Z6t=Xpe("DXT1"),Y6t=Xpe("DXT3"),J6t=Xpe("DXT5"),Q6t=31,X6t=0,K6t=1,eUt=2,tUt=3,iUt=4,rUt=7,sUt=20,nUt=21;function aUt(t,e,i){const r=oUt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:a,height:o}=r;return e.samplingMode=s.levels.length>1?9987:9729,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=a,e.height=o,new qi(t,e,s)}function oUt(t,e){const i=new Int32Array(t.buffer,t.byteOffset,Q6t);if(i[X6t]!==q6t)return Hj().error("Invalid magic number in DDS header"),null;if(!(i[sUt]&H6t))return Hj().error("Unsupported format, must contain a FourCC code"),null;const r=i[nUt];let s,n;switch(r){case Z6t:s=8,n=pn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Y6t:s=16,n=pn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case J6t:s=16,n=pn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return Hj().error("Unsupported FourCC code:",W6t(r)),null}let a=1,o=i[iUt],l=i[tUt];(3&o||3&l)&&(Hj().warn("Rounding up compressed texture size to nearest multiple of 4."),o=o+3&-4,l=l+3&-4);const u=o,d=l;let f,g;i[eUt]&G6t&&e!==!1&&(a=Math.max(1,i[rUt]));let v=t.byteOffset+i[K6t]+4;const _=[];for(let x=0;x<a;++x)g=(o+3>>2)*(l+3>>2)*s,f=new Uint8Array(t.buffer,v,g),_.push(f),v+=g,o=Math.max(1,o>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:_},internalFormat:n,width:u,height:d}}let Kpe=class{constructor(e,i){this._data=e,this.id=Gc(),this.events=new gm,this._parameters={...cUt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.update=void 0}_startPreload(e){e instanceof HTMLVideoElement?(this.update=i=>this._update(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e)}_startPreloadVideoElement(e){if(!(e1(e.src)||e.preload==="auto"&&e.crossOrigin)&&(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src,e.paused&&e.autoplay)){const i=[];z6t(e,r=>i.push(r)).then(()=>{e.play()}).finally(()=>i.forEach(r=>r.remove()))}}_startPreloadImageElement(e){mm(e.src)||e1(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new ar;return i.wrapMode=this._parameters.wrap??10497,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?9987:9729,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i.dataType=this._parameters.dataType??i.dataType,i.pixelFormat=this._parameters.pixelFormat??i.pixelFormat,i.internalFormat=this._parameters.internalFormat??i.internalFormat,i}get glTexture(){return this._glTexture??this._emptyTexture}get loaded(){return this._glTexture!=null}get usedMemory(){return this._glTexture?.usedMemory||lUt(this._data,this._parameters)}load(e){if(this._loadingPromise)return this._loadingPromise;if(this._glTexture)return this._glTexture;const i=this._data;return i==null?(this._glTexture=new qi(e,this._createDescriptor(e),null),this._glTexture):(this._emptyTexture=e.emptyTexture,this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):TS(i)&&this._parameters.encoding==="image/vnd-ms.dds"?this._loadFromDDSData(e,i):cD(i)&&this._parameters.encoding==="image/vnd-ms.dds"?this._loadFromDDSData(e,new Uint8Array(i)):(cD(i)||TS(i))&&this._parameters.encoding==="image/ktx2"?this._loadFromKTX2(e,i):(cD(i)||TS(i))&&this._parameters.encoding==="image/x.basis"?this._loadFromBasis(e,i):cD(i)?this._loadFromPixelData(e,new Uint8Array(i)):lP(i)?this._loadFromPixelData(e,i):null)}_update(e,i){return this._glTexture==null||e.readyState<HTMLMediaElement.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=aUt(e,this._createDescriptor(e),i),this._emptyTexture=null,this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>B6t(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>U6t(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){xt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat!==6407&&r.pixelFormat!==6408||(r.compress=this._parameters.compressionOptions),r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new qi(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await J0(i,{signal:r});return ct(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await NRe(i,i.src,!1,r);return ct(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const a=()=>{i.removeEventListener("loadeddata",o),i.removeEventListener("error",l),Xi(u)},o=()=>{i.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&(a(),s(this._loadFromImage(e,i)))},l=d=>{a(),n(d||new q("texture:load-error","Failed to load video"))};i.addEventListener("loadeddata",o),i.addEventListener("error",l);const u=Mo(r,()=>l(ti()))}))}_loadFromImage(e,i){let r=i;r instanceof HTMLVideoElement||(r=QVt(r,e.parameters));const s=r9e(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.width=s.width,n.height=s.height,n.compress=this._parameters.compressionOptions,this._glTexture=new qi(e,n,r),this._emptyTexture=null,this.events.emit("loaded"),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null),this._emptyTexture=null};return r.then(s,s),r}unload(){if(this._glTexture=jt(this._glTexture),this._emptyTexture=null,this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}};function lUt(t,e){if(t==null)return 0;if(cD(t)||TS(t))return e.encoding==="image/ktx2"?j6t(t,!!e.mipmap):e.encoding==="image/x.basis"?V6t(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?r9e(t):e,s=e.pixelFormat??6408,n=abt(s);return(e.mipmap?4/3:1)*i*r*n||0}function r9e(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}const cUt={wrap:{s:10497,t:10497},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1},wv=()=>re.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");let uUt=class{constructor(e,i,r){this.resource=e,this.textures=i,this.usedMemory=r}};async function hUt(t,e){const i=await dUt(t,e),r=await gUt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const a=r[n];s+=a?.image?a.image.width*a.image.height*4:0}return new uUt(i,r,s+fG(i))}async function dUt(t,e){const i=e?.streamDataRequester;if(i)return pUt(t,i,e);const r=await Sp(Si(t,e));if(r.ok===!0)return r.value.data;ml(r.error),s9e(r.error)}async function pUt(t,e,i){const r=await Sp(e.request(t,0,i));if(r.ok===!0)return r.value;ml(r.error),s9e(r.error.details.url)}function s9e(t){throw new q("",`Request for object resource failed: ${t}`)}function fUt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(wv().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const a in e.vertexAttributes){const o=n[a];o?.values?(o.valueType!=null&&o.valueType!=="UInt32"&&(wv().warn(`Unsupported indexed geometry indices type '${o.valueType}', only UInt32 is currently supported`),r=!1),o.valuesPerElement!=null&&o.valuesPerElement!==1&&(wv().warn(`Unsupported indexed geometry values per element '${o.valuesPerElement}', only 1 is currently supported`),r=!1)):(wv().warn(`Indexed geometry does not specify face indices for '${a}' attribute`),r=!1)}}else wv().warn("Indexed geometries must specify faces"),r=!1;break}default:wv().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(wv().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(wv().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function D2i(t,e){const i=new Array,r=new Array,s=new Array,n=new Kg,a=t.resource,o=MF.parse(a.version||"1.0","wosr");vUt.validate(o);const l=a.model.name,u=a.model.geometries,d=a.materialDefinitions??{},f=t.textures;let g=0;const v=new Map;for(let _=0;_<u.length;_++){const x=u[_];if(!fUt(x))continue;const S=yUt(x),T=x.params.vertexAttributes,M=[],E=Q=>{if(x.params.topology==="PerAttributeArray")return null;const H=x.params.faces;for(const J in H)if(J===Q)return H[J].values;return null},P=T.position,O=P.values.length/P.valuesPerElement;for(const Q in T){const H=T[Q],J=H.values,Z=E(Q)??IP(O);M.push([Q,new ki(J,Z,H.valuesPerElement,!0)])}const D=S.texture,L=f&&f[D];if(L&&!v.has(D)){const{image:Q,parameters:H}=L,J=new Kpe(Q,H);r.push(J),v.set(D,J)}const F=v.get(D),j=F?F.id:void 0,N=S.material;let B=n.get(N,D);if(B==null){const Q=d[N.slice(N.lastIndexOf("/")+1)].params;Q.transparency===1&&(Q.transparency=0);const H=L?n9e(L.alphaChannelUsage):void 0,J={ambient:F5(Q.diffuse),diffuse:F5(Q.diffuse),opacity:1-(Q.transparency||0),textureAlphaMode:H,textureAlphaCutoff:.33,textureId:j,doubleSided:!0,cullFace:0,colorMixMode:Q.externalColorMixMode||"tint",textureAlphaPremultiplied:L?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(J,e.materialParameters),B=new Kqe(J,e),n.set(N,D,B)}s.push(B);const U=new Qc(B,M);g+=M.find(Q=>Q[0]==="position")?.[1]?.indices.length??0,i.push(U)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:a.model.pivotOffset,numberOfVertices:g,lodThreshold:null}],referenceBoundingBox:mUt(i)}}function mUt(t){const e=Wu();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(kO(e,r.bbMin),kO(e,r.bbMax))}),e}async function gUt(t,e){const i=new Array;for(const n in t){const a=t[n],o=a.images[0].data;if(!o){wv().warn("Externally referenced texture data is not yet supported");continue}const l=a.encoding+";base64,"+o,u="/textureDefinitions/"+n,d=a.channels==="rgba"?a.alphaChannelUsage||"transparency":"none",f={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:n9e(d)!==1},g=e?.disableTextures?Promise.resolve(null):J0(l,e);i.push(g.then(v=>({refId:u,image:v,parameters:f,alphaChannelUsage:d})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function n9e(t){switch(t){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;default:return 0}}function yUt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const vUt=new MF(1,2,"wosr");let _Ut=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfCache=e("gltf-resources",()=>{}),this._wosrCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfCache.destroy(),this._wosrCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfCache.get(s);return n?Promise.resolve(n):KCe(this._gltfLoading,this._gltfCache,s,async a=>{const{loadGLTF:o}=await W(()=>import("./loader-Dbk35WsN.js"),__vite__mapDeps([419,302]));return o(new L6t(a.streamDataRequester),e,a,r)},i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrCache.get(r);return s?Promise.resolve(s):KCe(this._wosrLoading,this._wosrCache,r,n=>hUt(e,n),i)}};async function KCe(t,e,i,r,s){ct(s);const n=Mo(s,()=>bUt(t,i));let a=t.get(i);if(a)a.refCount++;else{const o=new AbortController;a={refCount:1,abortController:o,promise:r({...s,signal:o.signal})},t.set(i,a)}try{const o=await a.promise;return e.put(i,o),t.delete(i),ct(s),o}finally{Xi(n)}}function bUt(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i?.abortController.abort())}let EE=class extends be{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=i?.registerTask(Tt.TEXTURE_UNLOAD)??Rw}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new o9e;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.addTexture(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new a9e(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(i.texture?.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.removeTexture(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};c([p()],EE.prototype,"_frameTask",void 0),c([p()],EE.prototype,"updating",null),EE=c([R("esri.views.3d.support.TextureCollection")],EE);let a9e=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},o9e=class{constructor(){this.referenceCount=0}},wUt=class extends EE{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){ct(r);const s=r?.signal,n=this.makeUid(e,i);let a=this._textureRequests.get(n);if(!a){const o=new AbortController,l=this._streamDataRequester.request(e,2,{uid:n,signal:o.signal});a=new o9e,a.abortController=o;const u=a;this._textureRequests.set(n,a),a.textureAsync=l.then(async d=>{const f=this._createTexture(e,d,i);return u.texture=f,u.abortController=null,await f.load(this._stage.renderView.renderingContext),this._stage.addTexture(f),new a9e(n,f,()=>this._release(n))},d=>{throw u.abortController=null,d})}a.referenceCount++;try{return await A0(a.textureAsync,s)}catch(o){throw this._release(n),o}}_createTexture(e,i,r){const s={width:i.width,height:i.height,wrap:{s:33071,t:33071},preMultiplyAlpha:!0,reloadable:!0};if(MRe(e)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new Kpe(i,s)}},xUt=class{constructor(e){this.streamDataRequester=null,this.cimSymbolRasterizer=null,this.streamDataRequester=e.resourceController.createStreamDataRequester(4),this.objectResourceCache=new _Ut((i,r)=>e.resourceController.memoryController.newCache(i,r)),this.textures=new wUt(this.streamDataRequester,e.view.stage,e.resourceController.scheduler)}destroy(){this.textures.destroy(),this.streamDataRequester=null}},Lk=class extends be{constructor(e){super(e),this._propertiesPool=new V0({plane:()=>n_()},this),this.isDecoration=!0,this.addHandles(W9(this._propertiesPool))}set plane(e){if(!e)return void this._set("plane",e);const i=this._propertiesPool.get("plane");A$(e,i),this._set("plane",i)}};c([p()],Lk.prototype,"plane",null),c([p()],Lk.prototype,"isDecoration",void 0),Lk=c([R("esri.views.3d.support.ViewSlice")],Lk);let SUt=class{constructor(e){this.destination=e}hide(){this.graphic!=null&&(this.destination.remove(this.graphic),this.graphic=null)}},V3=class extends SUt{constructor(e,i,r=""){super(e),this._symbol=new Gl({symbolLayers:new ke([new bo({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new va({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(!i)return;this.hide();const r=new Ue({x:e[0],y:e[1],z:e[2],spatialReference:i});this.graphic=new ms({geometry:r,symbol:this._symbol}),this.destination.add(this.graphic)}},l9e=class{constructor(e,i){this.layer=e,this.parameters=i}},TUt=class extends l9e{constructor(e,i,r){super(e,r),this.outSpatialReference=i,this.type="geometry"}selectTilesAtLOD(e){if(e<0)this.geometry.coordinates.forEach(i=>i.tile=null);else{const{tileInfo:i,tilemapCache:r}=this.layer,s=bL(i,r)[e].level;this.geometry.coordinates.forEach(n=>n.tile=i.tileAt(s,n.x,n.y))}}allElevationTilesFetched(){return!this.geometry.coordinates.some(e=>!e.elevationTile)}clearElevationTiles(){for(const e of this.geometry.coordinates)e.elevationTile!==this.outsideExtentTile&&(e.elevationTile=null)}populateElevationTiles(e){for(const i of this.geometry.coordinates)!i.elevationTile&&i.tile?.id&&(i.elevationTile=e[i.tile.id])}remapTiles(e){for(const i of this.geometry.coordinates){const r=i.tile?.id;i.tile=r?e[r]:null}}getTilesToFetch(){return SS(this.geometry.coordinates.filter(({tile:e,elevationTile:i})=>e?.id&&!i),(e,i)=>e.tile?.id===i.tile?.id).map(({tile:e})=>e)}forEachTileToFetch(e){for(const i of this.geometry.coordinates)i.tile&&!i.elevationTile&&e(i.tile,()=>i.tile=null)}},$Ut=class extends l9e{constructor(e,i,r,s){super(e,r),this.maskExtents=s,this.type="extent",this.elevationTiles=[],this._candidateTiles=[],this._fetchedCandidates=new Set,this.extent=i.clone().intersection(e.fullExtent)}selectTilesAtLOD(e,i){const r=this._maximumLodForRequests(i),s=Math.min(r,e);s<0?this._candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(s)}_maximumLodForRequests(e){const{tileInfo:i,tilemapCache:r}=this.layer,s=bL(i,r);if(!e)return s.length-1;const n=this.extent;if(n==null)return-1;for(let a=s.length-1;a>=0;a--){const o=s[a],l=o.resolution*i.size[0],u=o.resolution*i.size[1];if(Math.ceil(n.width/l)*Math.ceil(n.height/u)<=e)return a}return-1}allElevationTilesFetched(){return this._candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this._fetchedCandidates.clear()}populateElevationTiles(e){for(const i of this._candidateTiles){const r=i.id&&e[i.id];r&&(this._fetchedCandidates.add(i),this.elevationTiles.push(r))}}remapTiles(e){this._candidateTiles=eMe(this._candidateTiles.map(i=>e[i.id]))}getTilesToFetch(){return this._candidateTiles}forEachTileToFetch(e,i){const r=this._candidateTiles;this._candidateTiles=[],r.forEach(s=>{if(this._fetchedCandidates.has(s))return void i?.(s);let n=!1;e(s,()=>n=!0),n?i?.(s):this._candidateTiles.push(s)}),this._candidateTiles=eMe(this._candidateTiles,i)}_selectCandidateTilesCoveringExtentAt(e){this._candidateTiles.length=0;const i=this.extent;if(i==null)return;const{tileInfo:r,tilemapCache:s}=this.layer,n=bL(r,s)[e],a=r.tileAt(n.level,i.xmin,i.ymin),o=a.extent,l=n.resolution*r.size[0],u=n.resolution*r.size[1],d=Math.ceil((i.xmax-o[0])/l),f=Math.ceil((i.ymax-o[1])/u);for(let g=0;g<f;g++)for(let v=0;v<d;v++){const _=new pF(a.level,a.row-g,a.col+v);r.updateTileInfo(_),this._tileIsMasked(_)||this._candidateTiles.push(_)}}_tileIsMasked(e){return this.maskExtents?.some(i=>rF(i,e.extent))??!1}};function efe(t){return t?.tileInfo!=null}function bL(t,e){const i=t.lods;if(efe(e)){const{effectiveMinLOD:r,effectiveMaxLOD:s}=e;return i.filter(n=>n.level>=r&&n.level<=s)}return i}function eMe(t,e){const i={},r=[];for(const n of t){const a=n.id;a&&!i[a]?(i[a]=n,r.push(n)):e?.(n)}const s=r.sort((n,a)=>n.level-a.level);return s.filter((n,a)=>{for(let o=0;o<a;o++){const l=s[o].extent;if(l&&rF(l,n.extent))return e?.(n),!1}return!0})}let c9e=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},u9e=class{constructor(e,i=null){if(this.key=e,i!=null){const r=e.extent;this._samplerData=new c9e(i,r)}}get zmin(){return this._samplerData!=null?this._samplerData.data.minValue:0}get zmax(){return this._samplerData!=null?this._samplerData.data.maxValue:0}get hasNoDataValues(){return!!this._samplerData?.data.hasNoDataValues}sample(e,i){if(this._samplerData==null)return;const{safeWidth:r,data:s,dx:n,dy:a,y1:o,x0:l}=this._samplerData,{width:u,values:d,noDataValue:f}=s,g=tMe(a*(o-i),0,r),v=tMe(n*(e-l),0,r),_=Math.floor(g),x=Math.floor(v),S=_*u+x,T=S+u,M=d[S],E=d[T],P=d[S+1],O=d[T+1];if(M!==f&&E!==f&&P!==f&&O!==f){const D=v-x,L=M+(P-M)*D;return L+(E+(O-E)*D-L)*(g-_)}}};function tMe(t,e,i){return t<e?e:t>i?i:t}let XO=class XB{constructor(e){this.geometry=e,this.spatialReference=e.spatialReference}export(){return this._exporter(this.coordinates,this.spatialReference)}clone(e){const i=new XB(this.geometry);return i.spatialReference=this.spatialReference,i.coordinates=e??this.coordinates.map(r=>r.clone()),i._exporter=this._exporter,i}async project(e,i){if(this.spatialReference.equals(e))return this.clone();await om([{source:this.spatialReference,dest:e}],{signal:i});const r=new Ho({spatialReference:this.spatialReference,points:this.coordinates.map(o=>[o.x,o.y])}),s=Pa(r,e);if(!s)return null;const n=this.coordinates.map((o,l)=>{const u=o.clone(),d=s.points[l];return u.x=d[0],u.y=d[1],u}),a=this.clone(n);return a.spatialReference=e,a}static fromGeometry(e){const i=new XB(e);if(e instanceof XB)return i.coordinates=e.coordinates.map(r=>r.clone()),i._exporter=(r,s)=>{const n=e.clone(r);return n.spatialReference=s,n},i;switch(e.type){case"point":{const r=e,{hasZ:s,hasM:n}=r;return i.coordinates=s&&n?[new Sd(r.x,r.y,r.z,r.m)]:s?[new Sd(r.x,r.y,r.z)]:n?[new Sd(r.x,r.y,null,r.m)]:[new Sd(r.x,r.y)],i._exporter=(a,o)=>e.hasM?new Ue(a[0].x,a[0].y,a[0].z,a[0].m,o):new Ue(a[0].x,a[0].y,a[0].z,o),i}case"multipoint":{const r=e,{hasZ:s,hasM:n}=r;return i.coordinates=s&&n?r.points.map(a=>new Sd(a[0],a[1],a[2],a[3])):s?r.points.map(a=>new Sd(a[0],a[1],a[2])):n?r.points.map(a=>new Sd(a[0],a[1],null,a[2])):r.points.map(a=>new Sd(a[0],a[1])),i._exporter=(a,o)=>e.hasM?new Ho({points:a.map(l=>[l.x,l.y,l.z??0,l.m??0]),hasZ:!0,hasM:!0,spatialReference:o}):new Ho({points:a.map(l=>[l.x,l.y,l.z??0]),spatialReference:o}),i}case"polyline":{const r=e,s=[],n=[],{hasZ:a,hasM:o}=e;let l=0;for(const u of r.paths)if(n.push([l,l+u.length]),l+=u.length,a&&o)for(const d of u)s.push(new Sd(d[0],d[1],d[2],d[3]));else if(a)for(const d of u)s.push(new Sd(d[0],d[1],d[2]));else if(o)for(const d of u)s.push(new Sd(d[0],d[1],null,d[2]));else for(const d of u)s.push(new Sd(d[0],d[1]));return i.coordinates=s,i._exporter=(u,d)=>{const f=e.hasM?u.map(v=>[v.x,v.y,v.z??0,v.m??0]):u.map(v=>[v.x,v.y,v.z??0]),g=n.map(v=>f.slice(v[0],v[1]));return new gs({paths:g,hasM:e.hasM,hasZ:!0,spatialReference:d})},i}}}},Sd=class h9e{constructor(e,i,r=null,s=null,n=null,a=null){this.x=e,this.y=i,this.z=r,this.m=s,this.tile=n,this.elevationTile=a}clone(){return new h9e(this.x,this.y,this.z,this.m)}},AE=class extends nL{get spatialReference(){return this.extent.spatialReference}constructor(e){const i=e.noDataValue,r="tiles"in e?e.tiles.map(n=>new j3({tile:n,tileInfo:e.tileInfo,noDataValue:i})):e.samplers;super({noDataValue:i,samplers:r});const s=r[0];if(s){this.extent=s.extent.clone();const{min:n,max:a}=s.demResolution;this.demResolution={min:n,max:a};for(let o=1;o<r.length;o++){const l=r[o];this.extent.union(l.extent),this.demResolution.min=Math.min(this.demResolution.min,l.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,l.demResolution.max)}}else{const n="tileInfo"in e?e.tileInfo:null;this.extent=iF(fi(),n?.spatialReference??Me.WGS84),this.demResolution={min:0,max:0}}}elevationAt(e,i){let r;for(const s of this.samplers)if(s.containsAt(e,i)&&(r=s.elevationAt(e,i),r!==s.noDataValue))return r;return r??(re.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};c([p({constructOnly:!0})],AE.prototype,"noDataValue",void 0),c([p({constructOnly:!0})],AE.prototype,"samplers",void 0),AE=c([R("esri.layers.support.TileElevationSampler")],AE);let j3=class extends nL{get spatialReference(){return this.extent.spatialReference}constructor(e){super(e);const i=e.tile.key.extent;this.extent=iF(i,e.tileInfo.spatialReference),this.extent.zmin=e.tile.zmin,this.extent.zmax=e.tile.zmax;const r=Yr(e.tileInfo.spatialReference),s=e.tileInfo.lodAt(e.tile.key.level).resolution*r;this.demResolution={min:s,max:s}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return gO(this.tile.key.extent,e,i)}elevationAt(e,i){return this.containsAt(e,i)?this.tile.sample(e,i)??this.noDataValue:this.noDataValue}};c([p({constructOnly:!0})],j3.prototype,"tile",void 0),c([p({constructOnly:!0})],j3.prototype,"noDataValue",void 0),c([p({constructOnly:!0})],j3.prototype,"tileInfo",void 0),j3=c([R("esri.layers.support.TileElevationSampler.SingleTileElevationSampler")],j3);async function CUt(t,e,i){if(t=i?.ignoreInvisibleLayers?t.filter(l=>l.visible):t.slice(),!t.length)throw new q(ez,"Elevation queries require at least one elevation layer to fetch tiles from");const r=XO.fromGeometry(e),s={...KH,...i,returnSampleInfo:!0},n=t.pop(),a=await tfe(n,r,s),o=await f9e(t,a,s);return o.geometry=o.geometry.export(),i?.returnSampleInfo||delete o.sampleInfo,o}async function tfe(t,e,i){if(!t)throw new q(ez,"Elevation queries require an elevation layer to fetch tiles from");if(!e||!(e instanceof XO)&&e.type!=="point"&&e.type!=="multipoint"&&e.type!=="polyline")throw new q("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");const r={...KH,...i},s=new TUt(t,e.spatialReference,r),n=r.signal;return await t.load({signal:n}),await OUt(s,e,n),await m9e(s,n),await eW(s,n),LUt(s),FUt(s,n)}async function MUt(t,e,i){if(t=Array.isArray(t)?t:[t],(t=i?.ignoreInvisibleLayers?t.filter(n=>n.visible):t.slice()).length===0)throw new q(ez,"Elevation queries require at least one elevation layer to fetch tiles from");if(!e||e.type!=="extent")throw new q("elevation-query:invalid-extent","Invalid or undefined extent");const r={...KH,...i,returnSampleInfo:!0},s=d9e(t[t.length-1],e,r);return t.length===1?s:p9e(t,e,await s,r)}async function d9e(t,e,i,r){const s=i.signal;await t.load({signal:s});const n=e.spatialReference,a=t.tileInfo.spatialReference;n.equals(a)||(await om([{source:n,dest:a}],{signal:s}),e=Pa(e,a));const o=new $Ut(t,e,i,r);await m9e(o,s),await eW(o,s);const l=o.elevationTiles,u=o.layer.tileInfo,d=o.parameters.noDataValue;return new AE({noDataValue:d,tiles:l,tileInfo:u})}async function p9e(t,e,i,r){if(t.pop(),!t.length)return i;const s=i.samplers.filter(l=>!l.tile.hasNoDataValues).map(l=>yce(l.extent)),n=await d9e(t[t.length-1],e,r,s);if(n.samplers.length===0)return i;const a=i.samplers.concat(n.samplers),o=r.noDataValue;return p9e(t,e,new AE({samplers:a,noDataValue:o}),r)}async function f9e(t,e,i){const r=e.geometry.coordinates,s=e.sampleInfo;cP(s);const n=new Array,a=new Array;for(let f=0;f<r.length;f++)s[f].demResolution<0&&t.length&&(n.push(r[f]),a.push(f));const o=t.pop();if(o==null||n.length===0)return e;const l=e.geometry.clone(n),u=await tfe(o,l,i),d=u.sampleInfo;if(!d)throw new Error("no sampleInfo");return a.forEach((f,g)=>{r[f].z=u.geometry.coordinates[g].z,s[f].demResolution=d[g].demResolution,s[f].source=d[g].source}),f9e(t,e,i)}async function m9e(t,e){t.type==="geometry"&&PUt(t);const i=t.parameters.demResolution;if(typeof i=="number")IUt(t,i);else if(i==="finest-contiguous")await EUt(t,e);else{if(i!=="auto")throw new q("elevation-query:invalid-dem-resolution",`Invalid dem resolution value '${i}', expected a number, "finest-contiguous" or "auto"`);await AUt(t,e)}}async function EUt(t,e){const{tileInfo:i,tilemapCache:r}=t.layer,s=ife(i,r,t.parameters.minDemResolution);await g9e(t,s,e)}async function g9e(t,e,i){const r=t.layer;if(t.selectTilesAtLOD(e),e<0)return;const s=r.tilemapCache,n=t.getTilesToFetch();try{if(s&&!efe(s))await A0(Promise.all(n.map(a=>s.fetchAvailability(a.level,a.row,a.col,{signal:i}))),i);else if(await eW(t,i),!t.allElevationTilesFetched())throw t.clearElevationTiles(),new q("elevation-query:has-unavailable-tiles","Some elevation tiles are unavailable")}catch(a){ml(a),await g9e(t,e-1,i)}}async function AUt(t,e){DUt(t),kUt(t);const i=t.layer.tilemapCache;if(!i||efe(i))return y9e(t,e);const r=t.getTilesToFetch(),s={},n=r.map(async a=>{const o=new pF(0,0,0),l=await Sp(i.fetchAvailabilityUpsample(a.level,a.row,a.col,o,{signal:e}));l.ok!==!1?a.id!=null&&(s[a.id]=o):ml(l.error)});await A0(Promise.all(n),e),t.remapTiles(s)}async function y9e(t,e){const i=t.layer.tileInfo;await eW(t,e);let r=!1;t.forEachTileToFetch((s,n)=>{i.upsampleTile(s)?r=!0:n()}),r&&await y9e(t,e)}function ife(t,e,i=0){const r=bL(t,e);let s=r.length-1;if(i>0){const n=i/Yr(t.spatialReference),a=r.findIndex(o=>o.resolution<n);a===0?s=0:a>0&&(s=a-1)}return s}const KH={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0,signal:null};async function OUt(t,e,i){let r;const s=t.layer.tileInfo.spatialReference;if(e instanceof XO?r=await e.project(s,i):(await om([{source:e.spatialReference,dest:s}],{signal:i}),r=Pa(e,s)),!r)throw new q("elevation-query:spatial-reference-mismatch",`Cannot query elevation in '${e.spatialReference.wkid}' on an elevation service in '${s.wkid}'`);t.geometry=XO.fromGeometry(r)}function PUt(t){if(t.layer.fullExtent==null)return;const e=new u9e(new pF(-1,-1,-1));e.sample=()=>t.parameters.noDataValue,t.outsideExtentTile=e;const i=t.layer.fullExtent;t.geometry.coordinates.forEach(r=>{const s=r.x,n=r.y;(s<i.xmin||s>i.xmax||n<i.ymin||n>i.ymax)&&(r.elevationTile=e)})}function RUt(t,e){const{tileInfo:i,tilemapCache:r}=t.layer,s=e/Yr(i.spatialReference),n=bL(i,r);let a=n[0],o=0;for(let l=1;l<n.length;l++){const u=n[l];Math.abs(u.resolution-s)<Math.abs(a.resolution-s)&&(a=u,o=l)}return o}function IUt(t,e){const i=RUt(t,e);t.selectTilesAtLOD(i)}function DUt(t){const{tileInfo:e,tilemapCache:i}=t.layer,r=ife(e,i,t.parameters.minDemResolution);t.selectTilesAtLOD(r,t.parameters.maximumAutoTileRequests)}async function eW(t,e){const i=t.getTilesToFetch(),r={},s=t.parameters.cache,n=t.parameters.noDataValue,a={noDataValue:n,signal:e},o=i.map(async l=>{if(l.id==null)return;const u=`${t.layer.uid}:${l.id}:${n}`,d=s?.get(u),f=d??await t.layer.fetchTile(l.level,l.row,l.col,a);s?.put(u,f),r[l.id]=new u9e(l,f)});await A0(Promise.allSettled(o),e),t.populateElevationTiles(r)}function kUt(t){const e=t.layer.tileInfo;let i=0;const r={},s=o=>{o.id!=null&&(o.id in r?r[o.id]++:(r[o.id]=1,i++))},n=o=>{if(o.id==null)return;const l=r[o.id];l===1?(delete r[o.id],i--):r[o.id]=l-1};t.forEachTileToFetch(s,n);let a=!0;for(;a&&(a=!1,t.forEachTileToFetch(o=>{i<=t.parameters.maximumAutoTileRequests||(n(o),e.upsampleTile(o)&&(a=!0),s(o))},n),a););}function LUt(t){t.geometry.coordinates.forEach(e=>{const i=e.elevationTile;let r=t.parameters.noDataValue;if(i){const s=i.sample(e.x,e.y);s==null?e.elevationTile=null:r=s}e.z=r})}async function FUt(t,e){const i=await t.geometry.project(t.outSpatialReference,e);cP(i);const r={geometry:i.export(),noDataValue:t.parameters.noDataValue};return t.parameters.returnSampleInfo&&(r.sampleInfo=zUt(t)),t.geometry.coordinates.forEach(s=>{s.tile=null,s.elevationTile=null}),r}function zUt(t){const e=t.layer.tileInfo,i=Yr(e.spatialReference);return t.geometry.coordinates.map(r=>{let s=-1;return r.elevationTile&&r.elevationTile!==t.outsideExtentTile&&(s=e.lodAt(r.elevationTile.key.level).resolution*i),{demResolution:s,source:s===-1?void 0:t.layer}})}const ez="elevation-query:invalid-layer",iMe=Object.freeze(Object.defineProperty({__proto__:null,InvalidLayerError:ez,createSampler:MUt,defaultOptions:KH,getFinestLodIndex:ife,query:tfe,queryAll:CUt},Symbol.toStringTag,{value:"Module"}));let lw=class extends be{constructor(e){super(e)}};c([p({constructOnly:!0})],lw.prototype,"renderCoordsHelper",void 0),c([p({constructOnly:!0})],lw.prototype,"surface",void 0),c([p({constructOnly:!0})],lw.prototype,"state",void 0),lw=c([R("esri.views.3d.support.pointsOfInterest.PointOfInterest")],lw);let Id=class extends lw{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new V0({location:()=>new Ue,renderLocation:()=>I()},this),this._estimatedSurfaceAltitude=0,this._elevationQueryController=null,this.renderLocation=I(),this._tmpPoint=new Ue}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(tn(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=Bi(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return a$(r,i)}get updating(){return this._dirty||this._elevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._elevationQueryController;e&&(this._elevationQueryController=null,e.abort(),this.notifyChange("updating"))}get readyToRun(){return!this._elevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),Oa;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>NUt&&this.renderCoordsHelper.viewingMode===1&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?VUt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{if(s.name===ez)if(this.integratedMeshElevationSampler){this._tmpPoint.spatialReference=this.integratedMeshElevationSampler.spatialReference,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const n=this.integratedMeshElevationSampler.elevationAt(this._tmpPoint.x,this._tmpPoint.y)??0;this._updateSurfaceAltitude(n===this.integratedMeshElevationSampler.noDataValue?0:n)}else this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._elevationQueryController===r&&(this._elevationQueryController=null,this.notifyChange("updating")),r=null}),this._elevationQueryController=r,Oa}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(rK,this._estimatedSurfaceAltitude,this._camera.eye),di(this._get("renderLocation"),rK)||(this._set("renderLocation",me(this._propertiesPool.get("renderLocation"),rK)),this.notifyChange("renderLocation"))}};c([p({constructOnly:!0})],Id.prototype,"scheduler",void 0),c([p({constructOnly:!0})],Id.prototype,"cache",void 0),c([p({constructOnly:!0})],Id.prototype,"map",void 0),c([p({constructOnly:!0})],Id.prototype,"task",void 0),c([p({constructOnly:!0})],Id.prototype,"integratedMeshElevationSampler",void 0),c([p()],Id.prototype,"location",null),c([p()],Id.prototype,"renderLocation",void 0),c([p()],Id.prototype,"scale",null),c([p()],Id.prototype,"updating",null),Id=c([R("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],Id);const rK=I(),NUt=1e5,VUt=1e6;let Bd=class extends lw{constructor(e){super(e),this._propertiesPool=new V0({location:()=>new Ue,renderLocation:()=>I()},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=I(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Xi(this._frameWorker),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool?.get("location");return e?(e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e):new Ue}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get readyToRun(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Oa}_updateRenderLocation(){const e=UUt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=BUt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(me(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Bi(this._camera.eye,e):(he(e,this._camera.viewForward,this._get("distance")),$e(e,e,this._camera.eye)),di(this._get("renderLocation"),e)||this._set("renderLocation",me(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const s=xr(this.renderCoordsHelper.spatialReference).radius,n=s+e,a=ea(r.eye),o=a<n*n,l=Bi(r.eye,i);if(o&&l>s/4){const u=n-Math.sqrt(a);return he(i,r.viewForward,u),$e(i,i,r.eye),!0}}else{const s=this.surface?.ready?this.surface.extentAABR:null;s!=null&&Hhe(s,this.surface?.spatialReference,zI,this.renderCoordsHelper.spatialReference)&&(i[0]=Ce(i[0],zI[0],zI[2]),i[1]=Ce(i[1],zI[1],zI[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(bn.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=Bi(r,e),n=Bi(r,i);if(Math.abs(n-s)/s>jUt)return!0}return!1}};c([p({constructOnly:!0})],Bd.prototype,"scheduler",void 0),c([p({constructOnly:!0})],Bd.prototype,"task",void 0),c([p()],Bd.prototype,"distance",void 0),c([p({constructOnly:!0})],Bd.prototype,"estimateSurfaceAltitudeAtCenter",void 0),c([p({readOnly:!0})],Bd.prototype,"location",null),c([p({readOnly:!0})],Bd.prototype,"renderLocation",void 0),c([p()],Bd.prototype,"updating",void 0),Bd=c([R("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Bd);const jUt=.05,UUt=I(),BUt=I(),zI=fi();function v9e(t,e,i){const r=i?.createCollection?.()??new ke,s=i?.recycleItems?new qUt:null,n=(l,u=0)=>{if(!l?.length)return;const d=r.splice(u,l.length);s?s.processRemoved(l):d.forEach(YG)},a=(l,u=0)=>{if(!l?.length)return;const d=[];for(const f of l){const g=s?.use(f);if(g)d.push(g);else{const v=e(f);s?.register(f,v),d.push(v)}}r.addMany(d,u)},o=tn(t,"after-splice",({added:l,start:u,removed:d})=>{n(d,u),a(l,u)},{sync:!0,onListenerRemove:l=>n(l.items),onListenerAdd:l=>a(l.items)});return r.addHandles(o),r}let qUt=class{constructor(){this._originalToMapped=new Map,this._removedItemCandidates=new Set,this._garbageCollectionQueued=!1}processRemoved(e){if(!e?.length)return;const{_removedItemCandidates:i}=this;for(const r of e)this._getItem(r)?.markRemoved()&&(i.add(r),this._queueGarbageCollection())}use(e){const i=this._getItem(e);return i&&(i.removed=!1),i?.item}register(e,i){this._originalToMapped.set(e,new GUt(i))}_getItem(e){return this._originalToMapped.get(e)}_queueGarbageCollection(){this._garbageCollectionQueued||(this._garbageCollectionQueued=!0,queueMicrotask(()=>this._garbageCollectCandidates()))}_garbageCollectCandidates(){this._garbageCollectionQueued=!1;const{_removedItemCandidates:e}=this,i=Array.from(e);e.clear(),i.forEach(r=>this._garbageCollectIfRemoved(r))}_garbageCollectIfRemoved(e){const{_originalToMapped:i}=this,r=this._getItem(e);r?.removed&&(YG(r.item),i.delete(e))}},GUt=class{constructor(e){this.item=e,this.removed=!1}markRemoved(){return this.removed=!0,!0}};function YG(t){typeof t=="object"&&t&&("destroy"in t&&typeof t.destroy=="function"?t.destroy():Qet(t))}function iSi(t,e,i){const r=new ke,s=v9e(t,l=>sc(async u=>{const d=await e(l,u);if(sa(u))throw YG(d),ti();return d}),i),n=()=>null,a=async l=>{const u=await l.promise,d=s.indexOf(l);d<0||r.splice(d,1,u)};r.addMany(s.items.map(n));for(const l of s)bp(a(l));const o=s.on("after-splice",({added:l,start:u,deleteCount:d})=>{const f=r.splice(u,d);for(const g of f)YG(g);if(l?.length){r.addMany(l.map(n),u);for(const g of l)bp(a(g))}});return r.addHandles([W9(s),o]),r}let HUt=class{constructor(e,i){this._handles=new X0,this.events=new gm,this._handles.add([W9(v9e(()=>e,r=>r.on("visible-geometry-changed",s=>this.events.emit("request-update",s)))),tn(i,"visible-geometry-changed",()=>this.events.emit("request-update"))])}destroy(){this._handles.destroy()}},gf=class extends lw{constructor(e){super(e),this._propertiesPool=new V0({location:()=>new Ue,renderLocation:()=>I()},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([X(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation(),{equals:di}),X(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(Tt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Pe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get readyToRun(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,rMe);const n=Math.max(0,(Math.acos(Le(rMe,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!m1(e,i)){const u=this._propertiesPool.get("renderLocation");me(u,i),this._set("renderLocation",u)}return Oa}const a=1-Ce(n/(.5*Math.PI),0,1),o=a*a*a;this._calculateScreenHorizontalEdgeOnSurface(sMe);const l=this._propertiesPool.get("renderLocation");return cr(l,i,sMe,o),e&&m1(e,l)||this._set("renderLocation",l),Oa}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(Dg());if(r[1]=i.aboveGround?i.padding[2]:i.fullHeight-i.padding[0],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,NI)){Ae(NI,NI,i.eye);const n=Re(NI,NI);if(this.renderCoordsHelper.intersectInfiniteManifold(um(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};c([p()],gf.prototype,"_dirty",void 0),c([p({constructOnly:!0})],gf.prototype,"scheduler",void 0),c([p({constructOnly:!0})],gf.prototype,"centerOnSurface",void 0),c([p({constructOnly:!0})],gf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),c([p()],gf.prototype,"updating",null),c([p()],gf.prototype,"location",null),c([p()],gf.prototype,"renderLocation",void 0),c([p()],gf.prototype,"worldUnitsPerContentPixel",null),gf=c([R("esri.views.3d.support.pointsOfInterest.Focus")],gf);const rMe=I(),NI=I(),sMe=I();let xv=class extends be{constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([X(()=>[this._terrain?.spatialReference,this._terrain?.extent],()=>this._update()),tn(()=>this._ground?.layers,"change",()=>this._update())]),this._update())}destroy(){this._updateController=Rs(this._updateController)}get renderLocation(){if(!this.location)return null;const e=I();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}get _ground(){return this.view.map?.ground}get _terrain(){return this.view.basemapTerrain}_update(){if(this._updateController=Rs(this._updateController),this._terrain?.extent==null||this._terrain?.spatialReference==null)return void this._set("location",null);const e=wIe(this._terrain.extent),i=new Ue({x:e[0],y:e[1],z:0,spatialReference:this._terrain.spatialReference});this._ground&&this._ground.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this._ground.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{})):this._set("location",i)}};c([p({constructOnly:!0})],xv.prototype,"view",void 0),c([p({constructOnly:!0})],xv.prototype,"cache",void 0),c([p({readOnly:!0})],xv.prototype,"location",void 0),c([p({readOnly:!0})],xv.prototype,"renderLocation",null),c([p()],xv.prototype,"_ground",null),c([p()],xv.prototype,"_terrain",null),xv=c([R("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],xv);let Sv=class extends be{constructor(e){super(e),this._tileGeometryUpdateExtent=R0(),this._tileGeometryUpdateSpatialReference=null,this.events=new gm,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Tt.SURFACE_GEOMETRY_UPDATES,this)])}get readyToRun(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",WUt),R0(this._tileGeometryUpdateExtent),this._set("updating",!1)),Oa}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,VE(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=ZUt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,Dx,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,kx,i),Dx[0]<kx[0]?(s[0]=Dx[0],s[2]=kx[0]):(s[0]=kx[0],s[2]=Dx[0]),Dx[1]<kx[1]?(s[1]=Dx[1],s[3]=kx[1]):(s[1]=kx[1],s[3]=Dx[1]),vce(s,e)}};c([p({constructOnly:!0})],Sv.prototype,"state",void 0),c([p({constructOnly:!0})],Sv.prototype,"centerOnSurfaces",void 0),c([p({constructOnly:!0})],Sv.prototype,"renderCoordsHelper",void 0),c([p({constructOnly:!0})],Sv.prototype,"scheduler",void 0),c([p({constructOnly:!0})],Sv.prototype,"surface",void 0),c([p({readOnly:!0})],Sv.prototype,"updating",void 0),Sv=c([R("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],Sv);const WUt={},Dx=I(),kx=I(),ZUt=R0();let $c=class extends be{constructor(e){super(e),this.renderPointOfView=I(),this._pois=new Array,this._updatingHandles=new tm,this._debugCenters=null,this._tmpRay=$n(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new V0({renderPointOfView:()=>I()},this),this._contentIntersector=new Zu(e.view.state.viewingMode),this._surfaceIntersector=new Zu(e.view.state.viewingMode),this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=0}initialize(){const{state:e,groundView:i,renderCoordsHelper:r,map:s}=this.view,n=()=>this._estimateSurfaceAltitudeAtCenter(),a=this.view.resourceController.scheduler,o=i?.elevationQueryCache,l={state:e,scheduler:a,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Bd({...l,task:Tt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Bd({...l,task:Tt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Bd({...l,task:Tt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));const u=i.integratedMeshElevationSampler;this._set("cameraOnSurface",new Id({...l,cache:o,integratedMeshElevationSampler:u,task:Tt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new Sv({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new HUt(this.view.allLayerViews,()=>this.view.graphicsView)),this._set("surfaceOrigin",new xv({cache:o,view:this.view})),this._set("focus",new gf({state:e,scheduler:a,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(d,f)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus),this.addHandles([X(()=>e.contentCamera,d=>this._cameraChanged(d),Ht),this._updatingHandles.add(()=>i.extentAABR,()=>this._updateCenterPointsOfInterest()),this._updatingHandles.add(()=>this.view.map?.ground?.navigationConstraint?.type,d=>{this._surfaceIntersector.options.backfacesTerrain=d==="none"},Yt),vs(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Ht),tn(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),tn(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),this._updatingHandles.add(()=>bn.SHOW_POI,d=>this._setDebug(d),Yt)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this._pois.length=0,this.surfaceOrigin.destroy(),this._updatingHandles.destroy(),this._set("centerOnSurfaceInfrequent",null),this._set("centerOnSurfaceFrequent",null),this._set("centerOnContent",null),this._set("cameraOnSurface",null),this._set("surfaceGeometryUpdates",null),this._set("contentGeometryUpdates",null),this._set("surfaceOrigin",null),this._set("focus",null)}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))||this._updatingHandles.updating}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,nM,JUt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(nM):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){const{view:e}=this,{groundView:i}=e;if(!i)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const r=this._centerRay;if(r==null)return this._surfaceAltitudeAtCenter;const s=r.origin,n=$e(nM,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,e.state.contentCamera),i.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(nM)&&(this._surfaceAltitudeAtCenter=e.renderCoordsHelper.getAltitude(nM)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=Zde(i,e,YUt);if(s==null)return null;const n=s.origin,a=$e(nM,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.groundView.intersect(this._surfaceIntersector,null,n,a),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;di(this.renderPointOfView,i)||this._set("renderPointOfView",me(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters?.forEach(i=>i.hide()),void this.removeHandles("debug");if(!this._debugCenters){this._debugCenters=new Map;const i=this.view.graphics;this._debugCenters.set(this.centerOnContent,new V3(i,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new V3(i,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new V3(i,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new V3(i,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new V3(i,"green","Focus"))}for(const i of this._pois)this.addHandles(this._updatingHandles.add(()=>i.renderLocation,r=>this._debugCenters?.get(i)?.show(r,i.renderCoordsHelper.spatialReference),Yt),"debug")}get test(){}};c([p()],$c.prototype,"centerOnContent",void 0),c([p()],$c.prototype,"centerOnSurfaceFrequent",void 0),c([p()],$c.prototype,"centerOnSurfaceInfrequent",void 0),c([p()],$c.prototype,"cameraOnSurface",void 0),c([p()],$c.prototype,"focus",void 0),c([p()],$c.prototype,"renderPointOfView",void 0),c([p()],$c.prototype,"surfaceOrigin",void 0),c([p()],$c.prototype,"contentGeometryUpdates",void 0),c([p()],$c.prototype,"surfaceGeometryUpdates",void 0),c([p({constructOnly:!0})],$c.prototype,"view",void 0),c([p()],$c.prototype,"updating",null),$c=c([R("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],$c);const nM=I(),YUt=$n(),JUt={exclude:new Set([b1])},QUt=()=>re.getLogger("esri/core/MemCachePool");let tz=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case 0:return r.forEach(a=>a.dispose()),0;case 1:{const a=r.shift();return a?(n-=Math.round(a.usedMemory),a.dispose()):n>0&&(QUt().warn("Encountered empty MemCachePool with non-zero memory."),n=0),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();return i.length>0?r&&(i.usedMemory=this._cache.getSize(e)-Math.round(r.usedMemory),this._cache.updateSize(e)):this._cache.pop(e),r}put(e,i,r=RVe){const s=this._cache.peek(e);if(!s){const n=new XUt(i);return void this._cache.put(e,n,r)}s.push(i),s.usedMemory=this._cache.getSize(e)+Math.round(i.usedMemory),this._cache.updateSize(e)}},XUt=class extends Array{constructor(e){super(),this.item=e,this.usedMemory=e.usedMemory,this.push(e)}},_9e=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i)}};function hSi(t,e,i){if(t==null||i==null)return!1;let r=!0;return Yn[0]=t.xmin!=null?t.xmin:0,Yn[1]=t.ymin!=null?t.ymin:0,Yn[2]=t.zmin!=null?t.zmin:0,r=r&&io(Yn,t.spatialReference,0,e,i,0),Yn[0]=t.xmax!=null?t.xmax:0,Yn[1]=t.ymax!=null?t.ymax:0,Yn[2]=t.zmax!=null?t.zmax:0,r=r&&io(Yn,t.spatialReference,0,e,i,3),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function KUt(t,e,i){if(t==null||i==null)return!1;let r=!0;return Yn[0]=t.xmin!=null?t.xmin:0,Yn[1]=t.ymin!=null?t.ymin:0,Yn[2]=t.zmin!=null?t.zmin:0,r=r&&io(Yn,t.spatialReference,0,Yn,i,0),e[0]=Yn[0],e[1]=Yn[1],Yn[0]=t.xmax!=null?t.xmax:0,Yn[1]=t.ymax!=null?t.ymax:0,Yn[2]=t.zmax!=null?t.zmax:0,r=r&&io(Yn,t.spatialReference,0,Yn,i,0),e[2]=Yn[0],e[3]=Yn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Yn=I(),dSi={value:.5,readOnly:!0},eBt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let OE=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},tBt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new c9e(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const a=2**n;if(!(Math.floor(i/a)===this.i&&Math.floor(r/a)===this.j))return s;let o=1/0,l=-1/0;const u=this.samplerData.data.width,d=this.samplerData.data.values,f=.5*$de;let g=(u-1)/a,v=(r-this.j*a)*g,_=(i-this.i*a)*g;if(g<1){const x=Math.floor(v),S=Math.floor(_),T=x+S*u,M=d[T],E=d[T+1],P=d[T+u],O=d[T+u+1];if(M+E+P+O<f){const D=v-x,L=_-S,F=FV(M,E,P,O,D,L),j=FV(M,E,P,O,D+g,L),N=FV(M,E,P,O,D,L+g),B=FV(M,E,P,O,D+g,L+g);return s.min=Math.min(F,j,N,B),s.max=Math.max(F,j,N,B),s}v=x,_=S,g=1}else v=Math.floor(v),_=Math.floor(_),g=Math.ceil(g);for(let x=v;x<=v+g;x++)for(let S=_;S<=_+g;S++){const T=d[x+S*u];T<f?(o=Math.min(o,T),l=Math.max(l,T)):s.hasNoDataValues=!0}return s.min=o,s.max=l,s}};const iBt=.5*$de;function Ms(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Ce(r.dy*(r.y1-e),0,s),a=Ce(r.dx*(t-r.x0),0,s);const o=Math.floor(n),l=Math.floor(a),u=r.data.width,d=o*u+l,f=r.data.values,g=f[d],v=f[d+1],_=d+u,x=f[_],S=f[_+1];if(g+x+v+S<iBt){n-=o,a-=l;const T=g+(v-g)*a;return T+(x+(S-x)*a-T)*n}}return null}function b9e(t){return rfe(t)||XL(t)||KL(t)}function rfe(t){return P0(t)||M5(t)}function rBt(t,e,i,r){if(t==null)return Tde();const s=t.spatialReference;if(s.isGeographic&&!rfe(s))return new q("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=Df.checkUnsupported(t);return n??(i==null?new q("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):sBt(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function sBt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],a=yce(e),o=fi();Df.computeRowColExtent(a,s,n,o);const l=(o[2]-o[0])*(o[3]-o[1]);if(l>mE){const u=i[0].scale*2**i[0].level;let d=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*u/r;const f=Math.floor(Math.log(d)/Math.log(10));return d=Math.ceil(d/10**f)*10**f,new q("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(u).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+d.toLocaleString()+".",{level0Scale:u,suggestedLevel0Scale:d,requiredNumRootTiles:l,allowedNumRootTiles:mE})}return null}const nBt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:rBt},Symbol.toStringTag,{value:"Module"}));function aBt(t,e,i,r){if(t==null)return Tde();const s=t?.lods.length-1,n=t.spatialReference;if(n.isWebMercator){if(!Df.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new q("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!b9e(n))return new q("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Df.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new q("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new q("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const oBt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:aBt},Symbol.toStringTag,{value:"Module"})),lBt={1:oBt,2:nBt};function Ba(t,e){t||console.warn("Terrain: "+e)}let Ta=!1,JG=!1;function cBt(t){JG=t,Ta=Ta||t}function uBt(t){Ta=t}function He(t,e){if(Ta&&!t){const i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function QG(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function tW(t){return t?.type==="imagery-tile-3d"}function w9e(t){return t?.type==="tile-3d"}function KO(t){return t?.type==="vector-tile-3d"}function x9e(t){return t?.type==="wmts-3d"}function roe(t){return t?.type==="elevation-3d"}function VI(t){return t?.type==="group"}function wL(t){return t&&(w9e(t)||x9e(t)||tW(t)||KO(t))}function soe(t){return t&&(w9e(t)||tW(t)||KO(t)||x9e(t))}function noe(t){return soe(t)||roe(t)}function hBt(t){return YGe(t?.sourceLayerInfo?.data)}function dBt(t){return S9e(t?.sourceLayerInfo)||!!t?.isVTLBackground}function pBt(t){return JGe(t?.sourceLayerInfo?.data)}function fBt(t){const e=t?.sourceLayerInfo?.data;return XH(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function S9e(t){return N3(t?.data)}function mA(t){return t!=null&&"release"in t&&t.release(),null}function mSi(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function sfe(t,e,i,r,s){return lBt[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function iW(t,e,i){let r=null,s=null;if(t?.type==="wmts"){const a=mBt(t,e,i);r=a.tileInfo,s=a.fullExtent}else{s=QG(t)?t.getCompatibleFullExtent(e):t.fullExtent;const a=i===2;QG(t)?r=t.getCompatibleTileInfo(e,s,a):t?.type==="vector-tile"?r=a&&!gBt(e)||yBt.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?t.tilemapCache?.effectiveMaxLOD:void 0;return r!=null&&s!=null&&sfe(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function mBt(t,e,i){const r=Ddt(t);if(r!=null){if(!ke.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>sfe(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function gBt(t){return t.isWGS84||t.isWebMercator||M5(t)||!QL(t)}const yBt={force512VTL:!1};function nMe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Uy(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function ap(t,e,i=bBt){return Math.abs(t-e)<i}function XG(t){return t===1?5:t===7?3:t===5?1:7}function nfe(t){return t===0?4:t===2?6:t===4?0:2}function vBt(t){return t===7||t===5}function _Bt(t){return t===7||t===1}function aMe(t){return t===7||t===6||t===5}function oMe(t){return t===1||t===2||t===3}function lMe(t){return t===3||t===4||t===5}function cMe(t){return t===1||t===0||t===7}const Yf=[0,2,4,6],KG=[1,3,5,7],bBt=1e-5;let Vd=class extends be{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(t$(r)&&this.viewSpatialReference!=null){const s=T9e(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(yce(s))}}),e}};function wBt(t,e){return t===1?new aoe(e):new ooe(e)}c([p({readOnly:!0})],Vd.prototype,"layerViewsExtent",null),c([p({readOnly:!0})],Vd.prototype,"tiledLayersExtent",null),c([p({readOnly:!0})],Vd.prototype,"stencilEnabledExtents",null),c([p()],Vd.prototype,"viewSpatialReference",void 0),c([p()],Vd.prototype,"tilingScheme",void 0),c([p()],Vd.prototype,"defaultTiledLayersExtent",void 0),c([p({constructOnly:!0})],Vd.prototype,"layers",void 0),c([p({constructOnly:!0})],Vd.prototype,"layerViews",void 0),Vd=c([R("esri.views.3d.terrain.ExtentHelper")],Vd);let aoe=class extends Vd{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?pUe:pPt}};aoe=c([R("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],aoe);let ooe=class extends Vd{_computeLayerViewsExtent(){const e=R0(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const a=n.layer;if(n.isResolved()&&(a.type!=="graphics"||!a.internal)){const o=T9e("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);VE(e,o,e)}});const r=dte(e)?e:null,s=this._get("layerViewsExtent");return MS(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=R0();this.layers.forEach(a=>{if(a.loaded&&WE(a)){const o=iW(a,i,2);if(o==null)return;const{tileInfo:l,fullExtent:u}=o,d="tilemapCache"in a?a.tilemapCache?.effectiveMaxLOD:void 0;l!=null&&u!=null&&(QG(a)||e.compatibleWith(l,d)&&u.spatialReference.equals(e.spatialReference))&&VE(r,u,r)}}),VE(r,this.defaultTiledLayersExtent,r);const s=dte(r)?r:null,n=this._get("tiledLayersExtent");return MS(s,n)?n:s}};function T9e(t,e){return t==null||t.spatialReference.equals(e)?t:b4(t,t.spatialReference,e)}ooe=c([R("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],ooe);const U3=[0,1];let xBt=class{constructor(e,i){this.vec3=e,this.id=i}};function e9(t,e,i,r){return new xBt(Ye(t,e,i),r)}let uMe=class{constructor(){this._extent=fi(),this.resolution=0,this.renderLocalOrigin=e9(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new SBt}get extent(){return this._extent}setExtent(e){qc(this._extent,e)}setupGeometryViews(e){if(this._setupGeometryView(),!e)return;const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];_q(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];_q(this._extent,-e.range,0,r)}}_setupGeometryView(){this.canvasGeometries.numViews=1,O1(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},SBt=class{constructor(){this.extents=[fi(),fi(),fi()],this.numViews=0}},TBt=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){return this._handle?.getTexture()!=null}dispose(){this._handle=Lr(this._handle)}get texture(){return this._handle?.getTexture()}ensureFramebuffer(e,i){this._handle&&this._handle.fbo?.width===e&&this._handle.fbo?.height===i||(this._handle?.release(),this._handle=this._fbos.acquire(e,i,this._name,this._format))}bind(e){e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}},aM=class{constructor(e,i,r,s,n=1,a=6){this.output=r,this.content=s,this.redrawOnRequest=n,this.fbo=new TBt(e,a,i)}handleRenderRequest(e){return e===1||e===this.redrawOnRequest}get valid(){return this.fbo.valid}},$Bt=class{constructor(e){this.targets=[new aM(e,"overlay color",0,0),new aM(e,"overlay IM color",0,1),new aM(e,"overlay highlight",9,2,1,3),new aM(e,"overlay water",3,3,0),new aM(e,"overlay occluded",0,4)],Ep()&&this.targets.push(new aM(e,"overlay olid",10,5,1,5))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(e){if(e!==0)for(const i of this.targets)i.fbo.dispose();else this.targets[3].fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},afe=class extends $r{constructor(){super(...arguments),this.color=Ye(1,1,1)}};function $9e(){const t=new Gi;return t.include(no),t.fragment.uniforms.add(new Gt("tex",e=>e.texture),new Pr("uColor",e=>e.color)),t.fragment.main.add(A`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),t}const CBt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:afe,build:$9e},Symbol.toStringTag,{value:"Module"}));let hMe=class extends Ki{constructor(e,i){super(e,"ivec2",1,(r,s,n)=>r.setUniform2iv(e,i(s,n)))}},VP=class extends Ki{constructor(e,i){super(e,"usampler2D",1,(r,s,n)=>r.bindTexture(e,i(s,n)))}},ofe=class extends $r{};function C9e(){const t=new Gi,{outputs:e,fragment:i}=t;return t.include(no),i.uniforms.add(new VP("highlightTexture",r=>r.highlightTexture)),i.constants.add("outlineWidth","int",Math.ceil(xL)),i.constants.add("cellSize","int",Mw),e.add("fragGrid","uvec2"),i.main.add(A`ivec2 inputTextureSize = textureSize(highlightTexture, 0);
ivec2 cellBottomLeftCornerInput = ivec2(ivec2(floor(gl_FragCoord.xy) * vec2(cellSize)));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = texelFetch(highlightTexture, coordMid, 0).rg & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
texelFetch(highlightTexture,coord+ivec2(0,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(0,1),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,1),0).rg & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = outputValue;`),t}const Mw=32,xL=9,lfe=.4,MBt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:ofe,blurSize:lfe,build:C9e,gridCellPixelSize:Mw,outlineSize:xL},Symbol.toStringTag,{value:"Module"}));function cfe(t){const{vertex:e}=t;e.uniforms.add(new VP("coverageTexture",i=>i.coverageTexture),new hMe("highlightRenderCellCount",i=>oi(dMe,i.horizontalCellCount,i.verticalCellCount)),new hMe("highlightTextureResolution",({highlightTexture:i})=>oi(dMe,i.descriptor.width,i.descriptor.height)),new q1("highlightLevel",i=>i.highlightLevel)).constants.add("cellSize","int",Mw),t.varyings.add("sUV","vec2"),t.varyings.add("vOutlinePossible","float"),e.code.add(A`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),e.main.add(A`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = texelFetch(coverageTexture, cellPos, 0).rg;
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const dMe=Ke();function M9e(){const t=new Gi;t.include(cfe);const{fragment:e}=t;return e.uniforms.add(new Gt("blurInput",i=>i.highlightBlurTexture),new Mpe("blurSize",i=>i.blurSize),new VP("highlightTexture",i=>i.highlightTexture),new Gt("highlightOptionsTexture",i=>i.highlightOptionsTexture),new q1("highlightLevel",i=>i.highlightLevel),new _t("occludedIntensityFactor",i=>i.occludedFactor)),e.constants.add("inner","float",1-(xL-lfe)/xL),t.include(hpe),e.main.add(A`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
uvec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),t}const EBt=Object.freeze(Object.defineProperty({__proto__:null,build:M9e},Symbol.toStringTag,{value:"Module"}));let pMe=class extends er{constructor(e,i){super(e,i,new Hi(EBt,()=>W(()=>Promise.resolve().then(()=>yri),void 0)),Rp(wH))}initializePipeline(){return _i({blending:Xg,colorWrite:Fi})}},ufe=class extends $r{constructor(){super(...arguments),this.blurSize=Ke()}};function E9e(){const t=new Gi;return t.include(cfe),t.outputs.add("fragHighlight","vec2",0),t.fragment.uniforms.add(new Mpe("blurSize",e=>e.blurSize),new S1("blurInput",e=>e.blurInput)).main.add(A`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragHighlight = sum;
}`),t}const ABt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:ufe,build:E9e},Symbol.toStringTag,{value:"Module"}));let fMe=class extends er{constructor(e,i){super(e,i,new Hi(ABt,()=>W(()=>Promise.resolve().then(()=>vri),void 0)),Rp(wH))}initializePipeline(){return _i({colorWrite:Fi})}},sK=class extends er{constructor(e,i){super(e,i,new Hi(MBt,()=>W(()=>Promise.resolve().then(()=>_ri),void 0)),wn)}initializePipeline(){return _i({colorWrite:Fi})}},OBt=class extends $r{constructor(){super(...arguments),this.occludedFactor=gyt,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function A9e(){const t=new Gi;t.include(cfe),t.include(hpe);const{fragment:e}=t;return t.outputs.add("fragSingleHighlight","vec2",0),e.uniforms.add(new VP("highlightTexture",i=>i.highlightTexture),new q1("highlightLevel",i=>i.highlightLevel)),e.main.add(A`ivec2 iuv = ivec2(gl_FragCoord.xy);
uvec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),t}const PBt=Object.freeze(Object.defineProperty({__proto__:null,build:A9e},Symbol.toStringTag,{value:"Module"}));let mMe=class extends er{constructor(e,i){super(e,i,new Hi(PBt,()=>W(()=>Promise.resolve().then(()=>bri),void 0)),Rp(wH))}initializePipeline(){return _i({colorWrite:Fi})}},Fk=class extends Nc{constructor(){super(...arguments),this.produces=wt.HIGHLIGHTS,this.consumes={required:[wt.HIGHLIGHTS,"highlights"]},this._downsampleDrawParameters=new ofe,this._passParameters=new OBt,this._highlightBlurDrawParameters=new ufe,this._grid=new RBt}initialize(){this.addHandles([X(()=>this._updateOptionsTexture(),()=>{},Yt)])}destroy(){this._grid.coverage=Lr(this._grid.coverage),this._grid.vao=jt(this._grid.vao),this._passParameters.highlightOptionsTexture=Lr(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(this._passParameters.highlightOptionsTexture==null){const e=new ar(16,2);e.internalFormat=6408,e.samplingMode=9728,this._passParameters.highlightOptionsTexture=new qi(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(IBt(this.view.state.highlights)),this.requestRender(1)}precompile(){this.techniques.precompile(sK),this.techniques.precompile(mMe),this.techniques.precompile(fMe),this.techniques.precompile(pMe)}render(e){const i=e.find(({name:a})=>a===wt.HIGHLIGHTS),{techniques:r,bindParameters:s}=this;if(!s.decorations)return i;if(!r.get(sK).compiled)return this.requestRender(1),i;const n=e.find(({name:a})=>a==="highlights").getTexture();return this._renderHighlightPostprocess(n,i),i}_prepareAndDownSample(e){this._gridUpdateResources(e);const i=this.techniques.get(sK),r=this._gridComputeCoverage(i,e),{horizontalCellCount:s,verticalCellCount:n}=r,a=this._passParameters;return a.horizontalCellCount=s,a.verticalCellCount=n,a.coverageTexture=r.coverage?.getTexture(),r}_renderGrid(e){const i=e.verticalCellCount*e.horizontalCellCount;this.renderingContext.bindVAO(e.vao),this.renderingContext.drawElementsInstanced(Sr.TRIANGLES,6,Di.UNSIGNED_BYTE,0,i)}_renderHighlightPostprocess(e,i){const{fboCache:r,techniques:s,bindParameters:n,_passParameters:a,renderingContext:o}=this,l=s.get(mMe),u=s.get(fMe),d=s.get(pMe);if(!d.compiled||!u.compiled||!l.compiled)return void this.requestRender(1);a.highlightTexture=e;const f=this._prepareAndDownSample(e),{width:g,height:v}=e.descriptor;a.highlightTexture=e;const{camera:_}=n,{fullWidth:x,fullHeight:S,pixelRatio:T,fullViewport:M}=_,E=Math.ceil(x/T),P=Math.ceil(S/T),{_highlightBlurDrawParameters:O}=this,D=this.view.stage.renderView.renderer,{highlights:L}=n;for(let F=0;F<L.length;++F){const{name:j}=L[F];if(!D.hasHighlight(j))continue;a.highlightLevel=F,o.setClearColor(0,0,0,0);const N=r.acquire(g,v,"single highlight",2);o.bindFramebuffer(N.fbo),o.setViewport(0,0,g,v),o.clear(16384),o.bindTechnique(l,n,a),this._renderGrid(f),O.blurInput=N.getTexture(),oi(O.blurSize,1/E,0);const B=r.acquire(E,P,"single highlight blur",2);o.unbindTexture(B.fbo?.colorTexture),o.bindFramebuffer(B.fbo),o.setViewport(0,0,E,P),o.clear(16384),o.bindTechnique(u,n,a,O),this._renderGrid(f),N.release(),oi(O.blurSize,0,1/P),a.highlightBlurTexture=B.getTexture(),o.bindFramebuffer(i.fbo),o.setViewport4fv(M),o.bindTechnique(d,n,a,O),this._renderGrid(f),B.release()}a.coverageTexture=a.highlightTexture=null}_gridUpdateResources(e){const i=this._grid,{width:r,height:s}=e.descriptor;if(i.horizontalCellCount=Math.ceil(r/Mw),i.verticalCellCount=Math.ceil(s/Mw),i.vao)return;const n=this.renderingContext,a=id.createIndex(n,35044,LBt);i.vao=new bm(n,new vn(n,wH),a)}_gridComputeCoverage(e,i){const r=this.renderingContext,s=this._grid,n=i.descriptor,a=Math.ceil(n.width/Mw),o=Math.ceil(n.height/Mw);this._downsampleDrawParameters.input=i;const{highlights:l}=this.bindParameters;s.coverage?.release();const u=this.fboCache.acquire(a,o,"highlight coverage",l.length>hfe?3:1);return s.coverage=u,r.bindFramebuffer(u.fbo),r.bindTechnique(e,this.bindParameters,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,a,o),r.screen.draw(),s}get test(){}};c([p()],Fk.prototype,"produces",void 0),c([p()],Fk.prototype,"consumes",void 0),Fk=c([R("esri.views.3d.webgl-engine.effects.highlight.Highlight")],Fk);let RBt=class{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}};function IBt(t){const e=new Uint8Array(128);let i=0;for(const r of t){const s=4*i,n=4*i+64;++i;const{color:a}=r,o=r.haloColor??a;e[s+0]=a.r,e[s+1]=a.g,e[s+2]=a.b,e[s+3]=r.fillOpacity*a.a*255,e[n+0]=o.r,e[n+1]=o.g,e[n+2]=o.b,e[n+3]=r.haloOpacity*o.a*255}return e}let DBt=0;function kBt(t){let e=0;for(const r of t){const{name:s}=r;e+=s.length;const{color:n,fillOpacity:a,haloColor:o,haloOpacity:l}=r;e+=n.r+n.g+n.b+n.a+a,e+=o?o.r+o.g+o.b+o.a+l:0}const i=t.at(0);if(i){const{shadowOpacity:r,shadowDifference:s,shadowColor:n}=i;e+=r+s+n.r+n.g+n.b+n.a}return DBt+++(e>=0?0:1)}const LBt=new Uint8Array([0,1,2,2,1,3]);function O9e(t,e,i,r,s,n=0){const{highlights:a}=r,o=a.length>1?e.acquire(i.width,i.height,"highlight mix",a.length>hfe?3:1):null,{gl:l}=t;if(o){const d=t.getBoundFramebufferObject();t.bindFramebuffer(o.fbo),l.clearBufferuiv(l.COLOR,0,[0,0,0,0]),t.bindFramebuffer(d)}const u=o?.getTexture();r.highlightMixTexture=u,oi(r.highlightMixOrigin,n,0),a.forEach((d,f)=>{if(f>0){const g=qi.TEXTURE_UNIT_FOR_UPDATES;t.bindTexture(u,g),t.setActiveTexture(g),l.copyTexSubImage2D(3553,0,0,0,n,0,i.width,i.height),t.bindTexture(null,g)}t.clear(256),r.highlightLevel=f,s()}),r.highlightLevel=null,r.highlightMixTexture=null,o?.release()}const hfe=4;let FBt=class{constructor(e,i,r,s){this.material=e,this.output=i,this.techniques=r,this.textures=s}},P9e=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new Kg}dispose(){this._textures.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.produces.get(i)?.(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const a=e.createGLMaterial(new FBt(e,r,this._techniques,this._textures));n=new zBt(a),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(jt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&re.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},zBt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,xt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const gMe=8;function NBt(t,e){const{vertex:i,attributes:r}=t;i.uniforms.add(new _t("intrinsicWidth",a=>a.width));const{hasScreenSizePerspective:s,spherical:n}=e;s?(t.include(PH,e),b8e(i),W0(i,e),i.uniforms.add(new rpe("inverseViewMatrix",(a,o)=>Kl(yMe,$p(yMe,o.camera.viewMatrix,a.origin)))),i.code.add(A`
      float applyLineSizeScreenSizePerspective(float size, vec3 pos) {
        vec3 worldPos = (inverseViewMatrix * vec4(pos, 1)).xyz;
        vec3 groundUp = ${n?A`normalize(worldPos + localOrigin)`:A`vec3(0.0, 0.0, 1.0)`};
        float absCosAngle = abs(dot(groundUp, normalize(worldPos - cameraPosition)));

        return screenSizePerspectiveScaleFloat(size, absCosAngle, length(pos), screenSizePerspective);
      }
    `)):i.code.add(A`float applyLineSizeScreenSizePerspective(float size, vec3 pos) {
return size;
}`),e.hasVVSize?(r.add("sizeFeatureAttribute","float"),i.uniforms.add(new Pr("vvSizeMinSize",a=>a.vvSize.minSize),new Pr("vvSizeMaxSize",a=>a.vvSize.maxSize),new Pr("vvSizeOffset",a=>a.vvSize.offset),new Pr("vvSizeFactor",a=>a.vvSize.factor),new Pr("vvSizeFallback",a=>a.vvSize.fallback)),i.code.add(A`
    float getSize(${we(s,"vec3 pos")}) {
      float size = isnan(sizeFeatureAttribute)
        ? vvSizeFallback.x
        : intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;

      return ${we(s,"applyLineSizeScreenSizePerspective(size, pos)","size")};
    }
    `)):(r.add("size","float"),i.code.add(A`
    float getSize(${we(s,"vec3 pos")}) {
      float fullSize = intrinsicWidth * size;
      return ${we(s,"applyLineSizeScreenSizePerspective(fullSize, pos)","fullSize")};
    }
    `)),e.hasVVOpacity?(r.add("opacityFeatureAttribute","float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new Lu("vvOpacityValues",a=>a.vvOpacity.values,gMe),new Lu("vvOpacityOpacities",a=>a.vvOpacity.opacityValues,gMe),new _t("vvOpacityFallback",a=>a.vvOpacity.fallback,{supportsNaN:!0})),i.code.add(A`
    float interpolateOpacity(float value) {
      if (value <= vvOpacityValues[0]) {
        return vvOpacityOpacities[0];
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
        }
      }

      return vvOpacityOpacities[vvOpacityNumber - 1];
    }

    vec4 applyOpacity(vec4 color) {
      if (isnan(opacityFeatureAttribute)) {
        // If there is a color vv then it will already have taken care of applying the fallback
        return ${we(e.hasVVColor,"color","vec4(color.rgb, vvOpacityFallback)")};
      }

      return vec4(color.rgb, interpolateOpacity(opacityFeatureAttribute));
    }
    `)):i.code.add(A`vec4 applyOpacity(vec4 color) {
return color;
}`),e.hasVVColor?(t.include(jS,e),r.add("colorFeatureAttribute","float"),i.code.add(A`vec4 getColor() {
vec4 color = interpolateVVColor(colorFeatureAttribute);
if (isnan(color.r)) {
return vec4(0);
}
return applyOpacity(color);
}`)):(r.add("color","vec4"),i.code.add(A`vec4 getColor() {
return applyOpacity(color);
}`))}const yMe=ut();function VBt(t){t.vertex.code.add("#define noPerspectiveWrite(x, w) (x * w)")}function loe(t){t.fragment.code.add("#define noPerspectiveRead(x) (x * gl_FragCoord.w)")}let R9e=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${Gc()}`,s=>s.dispose())}destroy(){for(const{texture:e}of this._repository.values())e.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r;this._orphanCache.put(i,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new jBt(s);return this._repository.set(i,n),s}},jBt=class{constructor(e){this.texture=e,this.refCount=1}};function UBt(t,e){return new R9e(i=>{const{data:r,textureSize:s}=BBt(i),n=new ar(s,1);return n.dataType=Ns.FLOAT,n.pixelFormat=6403,n.internalFormat=ot.R16F,n.wrapMode=10497,new qi(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function BBt(t){const e=I9e(t),i=1/t.pixelRatio,r=D9e(t),s=[];let n=1;for(const o of e){for(let l=0;l<o;l++){const u=n*(Math.min(l,o-1-l)+.5)*i;s.push(u)}n=-n}const a=Math.round(e[0]/2);return{data:new Float32Array([...s.slice(a),...s.slice(0,a)]),textureSize:r}}function I9e(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function D9e(t){if(t==null)return 1;const e=I9e(t);return Math.floor(e.reduce((i,r)=>i+r))}function qBt(t){return t==null?Tn:t.length===4?t:Or(GBt,t[0],t[1],t[2],1)}const GBt=li();function HBt(t,e){if(!e.stippleEnabled)return void t.fragment.code.add(A`float getStippleAlpha(float lineWidth) { return 1.0; }
void discardByStippleAlpha(float stippleAlpha, float threshold) {}
vec4 blendStipple(vec4 color, float stippleAlpha) { return color; }`);const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;e.draped||(W0(r,e),r.uniforms.add(new Vs("worldToScreenPerDistanceRatio",({camera:n})=>1/n.perScreenPixelRatio)).code.add(A`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(A`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${A.float(WBt)};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),HF(r),r.code.add(A`
    vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {

      // First check if the segment is long enough to support fully screen space patterns.
      // Force sparse mode for segments that are very large in screen space even if it is not allowed,
      // to avoid imprecision from calculating with large floats.
      if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        float stretch = repetitions / flooredRepetitions;

        // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
        // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
        vStipplePatternStretch = max(0.75, stretch);

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new Gt("stipplePatternTexture",n=>n.stippleTexture),new _t("stipplePatternPixelSizeInv",n=>1/k9e(n))),e.stippleOffColorEnabled&&s.uniforms.add(new Ca("stippleOffColor",n=>qBt(n.stippleOffColor))),t.include(loe),s.code.add(A`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = noPerspectiveRead(clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y));
float lineSizeInv = noPerspectiveRead(vLineSizeInv);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * stipplePatternPixelSizeInv * lineSizeInv;
u = fract(u);
float sdf = texture(stipplePatternTexture, vec2(u, 0.5)).r;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha(float lineWidth) {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * lineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),s.code.add(A`
    void discardByStippleAlpha(float stippleAlpha, float threshold) {
     ${we(!e.stippleOffColorEnabled,"if (stippleAlpha < threshold) { discard; }")}
    }

    vec4 blendStipple(vec4 color, float stippleAlpha) {
      return ${e.stippleOffColorEnabled?"mix(color, stippleOffColor, stippleAlpha)":"vec4(color.rgb, color.a * stippleAlpha)"};
    }
  `)}function k9e(t){const e=t.stipplePattern;return e?D9e(t.stipplePattern)/e.pixelRatio:1}const WBt=.4,dfe=128,_S=.5,USi=Q5(_S/2,_S/2,1-_S/2,1-_S/2);function BSi(t){return t==="cross"||t==="x"}function qSi(t,e=dfe,i=e*_S,r=0){const{data:s,parameters:n}=ZBt(t,e,i,r);return new Kpe(s,n)}function ZBt(t,e=dfe,i=e*_S,r=0){return{data:L9e(t,e,i,r),parameters:{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,noUnpackFlip:!0,dataType:Ns.FLOAT,pixelFormat:6403,internalFormat:ot.R16F,reloadable:!0}}}function L9e(t,e=dfe,i=e*_S,r=0){switch(t){case"circle":default:return YBt(e,i);case"square":return JBt(e,i);case"cross":return XBt(e,i,r);case"x":return KBt(e,i,r);case"kite":return QBt(e,i);case"triangle":return e8t(e,i);case"arrow":return t8t(e,i)}}function YBt(t,e){const i=t/2-.5;return iz(t,N9e(i,i,e/2))}function JBt(t,e){return F9e(t,e,!1)}function QBt(t,e){return F9e(t,e,!0)}function XBt(t,e,i=0){return z9e(t,e,!1,i)}function KBt(t,e,i=0){return z9e(t,e,!0,i)}function e8t(t,e){return iz(t,V9e(t/2,e,e/2))}function t8t(t,e){const i=e,r=e/2,s=t/2,n=.8*i,a=N9e(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),o=V9e(s,i,r);return iz(t,(l,u)=>Math.max(o(l,u),-a(l,u)))}function F9e(t,e,i){return i&&(e/=Math.SQRT2),iz(t,(r,s)=>{let n=r-.5*t+.25,a=.5*t-s-.75;if(i){const o=(n+a)/Math.SQRT2;a=(a-n)/Math.SQRT2,n=o}return Math.max(Math.abs(n),Math.abs(a))-.5*e})}function z9e(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return iz(t,(n,a)=>{let o,l=n-.5*t,u=.5*t-a-1;if(i){const d=(l+u)/Math.SQRT2;u=(u-l)/Math.SQRT2,l=d}return l=Math.abs(l),u=Math.abs(u),o=l>u?l>s?Math.sqrt((l-s)*(l-s)+u*u):u:u>s?Math.sqrt(l*l+(u-s)*(u-s)):l,o-=r/2,o})}function N9e(t,e,i){return(r,s)=>{const n=r-t,a=s-e;return Math.sqrt(n*n+a*a)-i}}function V9e(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const a=Math.abs(s-t)-i,o=n-t+e/2+.75,l=(e*a+i*o)/r,u=-o;return Math.max(l,u)}}function iz(t,e){const i=new Float32Array(t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++)i[s+t*r]=e(s,r)/t;return i}const t9=64,j9e=t9/2,U9e=j9e/5,i8t=t9/U9e,GSi=.25;function r8t(t,e){const i=L9e(t,t9,j9e,U9e),r=new ar(t9);return r.internalFormat=ot.R16F,r.dataType=Ns.FLOAT,r.pixelFormat=6403,r.wrapMode=33071,new qi(e,r,i)}function s8t(t,e){const i=t.vertex,r=e.hasScreenSizePerspective;HF(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.constants.add("markerSizePerLineWidth","float",i8t).code.add(A`
  float getLineWidth(${we(r,"vec3 pos")}) {
     return max(getSize(${we(r,"pos")}), 1.0) * pixelRatio;
  }

  float getScreenMarkerSize(float lineWidth) {
    return markerScale * markerSizePerLineWidth * lineWidth;
  }
  `),e.space===2&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Vs("perRenderPixelRatio",s=>s.camera.perRenderPixelRatio)),i.code.add(A`
  bool areWorldMarkersHidden(vec3 pos, vec3 other) {
    vec3 midPoint = mix(pos, other, 0.5);
    float distanceToCamera = length(midPoint);
    float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
    float worldMarkerSize = getScreenMarkerSize(getLineWidth(${we(r,"pos")})) * screenToWorldRatio;
    float segmentLen = length(pos - other);
    return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
  }

  float getWorldMarkerSize(vec3 pos) {
    float distanceToCamera = length(pos);
    float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
    return getScreenMarkerSize(getLineWidth(${we(r,"pos")})) * screenToWorldRatio;
  }
  `))}function n8t(t,e){if(!e.hasAnimation)return;const{attributes:i,varyings:r,vertex:s,fragment:n}=t;i.add("timeStamps","vec4"),r.add("vTimeStamp","float"),r.add("vFirstTime","float"),r.add("vLastTime","float"),r.add("vTransitionType","float"),s.main.add(A`vTimeStamp = timeStamps.x;
vFirstTime = timeStamps.y;
vLastTime = timeStamps.z;
vTransitionType = timeStamps.w;`);const{animation:a}=e;a===3&&n.constants.add("decayRate","float",2.3),n.code.add(A`
    float getTrailOpacity(float x) {
      ${a8t(a)}
    }`),n.uniforms.add(new _t("timeElapsed",o=>o.timeElapsed),new _t("trailLength",o=>o.trailLength),new _t("speed",o=>o.animationSpeed),new Ca("timingOptions",o=>Or(o8t,o.startTime,o.endTime,o.fadeInTime,o.fadeOutTime))),n.code.add(A`float fadeIn(float x) {
return smoothstep(0.0, timingOptions[2], x);
}
float fadeOut(float x) {
return isinf(timingOptions[3]) ? 1.0 : smoothstep(timingOptions[3], 0.0, x);
}`),n.code.add(A`vec4 animate(vec4 color) {
float startTime = timingOptions[0];
float endTime = timingOptions[1];
float totalTime = vLastTime - vFirstTime;
float actualEndTime = int(vTransitionType) == 2 ? min(endTime, startTime + vLastTime / speed) : endTime;
vec4 animatedColor = color;
if (speed == 0.0) {
animatedColor.a *= getTrailOpacity((totalTime - (vTimeStamp - vFirstTime)) / trailLength);
animatedColor.a *= isinf(actualEndTime) ? 1.0 : fadeOut(timeElapsed - actualEndTime);
animatedColor.a *= fadeIn(timeElapsed - startTime);
return animatedColor;
}
float relativeStartTime = mod(startTime, totalTime);
float vHeadRelativeToFirst = mod((timeElapsed - relativeStartTime) * speed - vFirstTime, totalTime);
float vRelativeToHead = vHeadRelativeToFirst + vFirstTime - vTimeStamp;
bool inPreviousCycle = vRelativeToHead < 0.0;
vRelativeToHead += inPreviousCycle ? totalTime : 0.0;
float vAbsoluteTime = timeElapsed - vRelativeToHead / speed;
if (vAbsoluteTime > actualEndTime) {
vRelativeToHead = (timeElapsed - relativeStartTime) * speed - vTimeStamp;
vAbsoluteTime = timeElapsed - vRelativeToHead / speed;
}
animatedColor *= step(startTime, vAbsoluteTime);
animatedColor *= step(vAbsoluteTime, actualEndTime);
animatedColor.a *= isinf(actualEndTime) ? 1.0 : fadeOut(timeElapsed - actualEndTime);
animatedColor.a *= inPreviousCycle ? fadeOut(vHeadRelativeToFirst / speed) : 1.0;
animatedColor.a *= getTrailOpacity(vRelativeToHead / trailLength);
animatedColor.a *= int(vTransitionType) == 0 ? fadeIn(vAbsoluteTime - startTime) : 1.0;
animatedColor.a *= fadeIn(vTimeStamp - vFirstTime);
return animatedColor;
}`)}function a8t(t){switch(t){case 2:return"return x >= 0.0 && x <= 1.0 ? 1.0 : 0.0;";case 3:return`float cutOff = exp(-decayRate);
        return (exp(-decayRate * x) - cutOff) / (1.0 - cutOff);`;default:return"return 1.0;"}}const o8t=li(),SL=1;function B9e(t){const e=new Gi,{attributes:i,varyings:r,vertex:s,fragment:n}=e,{applyMarkerOffset:a,draped:o,output:l,capType:u,stippleEnabled:d,falloffEnabled:f,roundJoins:g,wireframe:v,innerColorEnabled:_,hasAnimation:x,hasScreenSizePerspective:S}=t;n.include(JF),e.include(NBt,t),e.include(HBt,t),e.include(upe,t),e.include(WF,t),e.include(n8t,t);const T=a&&!o;T&&(s.uniforms.add(new _t("markerScale",L=>L.markerScale)),e.include(s8t,{space:2,hasScreenSizePerspective:S})),u0(s,t),s.uniforms.add(new _l("inverseProjectionMatrix",L=>L.camera.inverseProjectionMatrix),new Z0("nearFar",L=>L.camera.nearFar),new _t("miterLimit",L=>L.join!=="miter"?0:L.miterLimit),new Go("viewport",L=>L.camera.fullViewport)),s.constants.add("LARGE_HALF_FLOAT","float",65500),i.add("position","vec3"),i.add("previousDelta","vec4"),i.add("nextDelta","vec4"),i.add("lineParameters","vec2"),i.add("u0","float"),r.add("vColor","vec4"),r.add("vpos","vec3",{invariant:!0}),r.add("vLineDistance","float"),r.add("vLineWidth","float");const M=d;M&&r.add("vLineSizeInv","float");const E=u===2,P=d&&E,O=f||P;O&&r.add("vLineDistanceNorm","float"),E&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),s.code.add(A`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),s.code.add(A`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(A`void clip(
inout vec4 pos,
inout vec4 prev,
inout vec4 next,
bool isStartVertex
) {
float vnp = nearFar[0] * 0.99;
if (pos.z > -nearFar[0]) {
if (!isStartVertex) {
if (prev.z < -nearFar[0]) {
pos = mix(prev, pos, interp(vnp, prev, pos));
next = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
} else {
if (next.z < -nearFar[0]) {
pos = mix(pos, next, interp(vnp, pos, next));
prev = pos;
} else {
pos = vec4(0.0, 0.0, 0.0, 1.0);
}
}
} else {
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
if (next.z > -nearFar[0]) {
next = mix(next, pos, interp(vnp, next, pos));
}
}
}`),HF(s),s.constants.add("aaWidth","float",d?0:1).main.add(A`bool isStartVertex = abs(abs(lineParameters.y) - 3.0) == 1.0;
vec3 prevPosition = position + previousDelta.xyz * previousDelta.w;
vec3 nextPosition = position + nextDelta.xyz * nextDelta.w;
float coverage = 1.0;
if (lineParameters.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
vec4 next = view * vec4(nextPosition, 1.0);
bool isJoin = abs(lineParameters.y) < 3.0;`),T&&s.main.add(A`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos.xyz, other.xyz);
if (!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos.xyz) * 0.5;
}`),e.include(VBt),s.main.add(A`
      clip(pos, prev, next, isStartVertex);

      vec3 clippedPos = pos.xyz;
      vec3 clippedCenter = mix(pos.xyz, isStartVertex ? next.xyz : prev.xyz, 0.5);

      forwardViewPosDepth(pos.xyz);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);

      float lineSize = getSize(${we(S,"clippedPos")});
      ${we(d&&S,"float patternLineSize = getSize(clippedCenter);")}
      ${we(d&&!S,"float patternLineSize = lineSize;")}

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = noPerspectiveWrite(lineWidth, pos.w);
      ${M?A`vLineSizeInv = noPerspectiveWrite(1.0 / lineSize, pos.w);`:""}
  `),(d||E)&&s.main.add(A`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${E?A`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),s.main.add(A`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * lineParameters.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = perpendicular(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
float subdivisionFactor = lineParameters.x;
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),g?s.main.add(A`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = perpendicular(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = perpendicular(endDir);

        float factor = ${d?A`min(1.0, subdivisionFactor * ${A.float((SL+2)/(SL+1))})`:A`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(lineParameters.y) * factor * rotationAngle);
      `):s.main.add(A`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = perpendicular(joinDisplacementDir);`);const D=u!==0;return s.main.add(A`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = perpendicular(joinDisplacementDir);

      ${D?A`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),s.main.add(A`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(lineParameters.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = noPerspectiveWrite(sign(lineParameters.y), pos.w);

    vLineDistance = lineWidth * lineDistNorm;
    ${O?A`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),E&&s.main.add(A`vec2 segmentDir = normalize(segment);
vSegmentSDF = noPerspectiveWrite((isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir)), pos.w);
vReverseSegmentSDF = noPerspectiveWrite((isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir)), pos.w);`),d&&(o?s.uniforms.add(new Vs("worldToScreenRatio",L=>1/L.screenToPCSRatio)):s.main.add(A`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),s.main.add(A`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),o?s.main.add(A`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = u0 * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):s.main.add(A`float startPseudoScreen = mix(u0, u0 - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),s.uniforms.add(new _t("stipplePatternPixelSize",L=>k9e(L))),s.main.add(A`float patternLength = patternLineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits = noPerspectiveWrite(vStippleDistanceLimits, pos.w);
vStippleDistance = noPerspectiveWrite(vStippleDistance, pos.w);
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),s.main.add(A`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a = noPerspectiveWrite(vColor.a * coverage, pos.w);

      ${v&&!o?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }`),e.fragment.include(xw,t),e.include(WH,t),n.include(zP),n.main.add(A`discardBySlice(vpos);
discardByTerrainDepth();`),e.include(loe),n.main.add(A`
    float lineWidth = noPerspectiveRead(vLineWidth);
    float lineDistance = noPerspectiveRead(vLineDistance);
    ${we(O,A`float lineDistanceNorm = noPerspectiveRead(vLineDistanceNorm);`)}
  `),v?n.main.add(A`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(E&&n.main.add(A`
        float sdf = noPerspectiveRead(min(vSegmentSDF, vReverseSegmentSDF));
        vec2 fragmentPosition = vec2(min(sdf, 0.0), lineDistance);

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - lineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${A.float(ls)}) {
          discard;
        }
      `),P?n.main.add(A`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        lineDistanceNorm
      );
      float stippleRadius = length(stipplePosition * lineWidth);
      float stippleCapSDF = (stippleRadius - lineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${A.float(ls)}, stippleCoverage);
      `):n.main.add(A`float stippleAlpha = getStippleAlpha(lineWidth);`),l!==10&&n.main.add(A`discardByStippleAlpha(stippleAlpha, ${A.float(ls)});`),e.include(loe),n.uniforms.add(new Ca("intrinsicColor",L=>L.color)).main.add(A`vec4 color = intrinsicColor * vColor;
color.a = noPerspectiveRead(color.a);`),_&&n.uniforms.add(new Ca("innerColor",L=>L.innerColor??L.color),new _t("innerWidth",(L,F)=>L.innerWidth*F.camera.pixelRatio)).main.add(A`float distToInner = abs(lineDistance) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),n.main.add(A`vec4 finalColor = blendStipple(color, stippleAlpha);`),f&&(n.uniforms.add(new _t("falloff",L=>L.falloff)),n.main.add(A`finalColor.a *= pow(max(0.0, 1.0 - abs(lineDistanceNorm)), falloff);`)),d||n.main.add(A`float featherStartDistance = max(lineWidth - 2.0, 0.0);
float value = abs(lineDistance);
float feather = (value - featherStartDistance) / (lineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`),x&&n.main.add(A`
        finalColor = animate(finalColor);

        ${we(l!==10,A`
            if (finalColor.a <= ${A.float(ls)}) {
              discard;
            }`)}
      `)),n.main.add(A`outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),e}const l8t=Object.freeze(Object.defineProperty({__proto__:null,build:B9e,ribbonlineNumRoundJoinSubdivisions:SL},Symbol.toStringTag,{value:"Module"}));let c8t=class extends er{constructor(e,i){super(e,i,new Hi(l8t,()=>W(()=>Promise.resolve().then(()=>wri),void 0)),q9e(i).locations),this.primitiveType=i.wireframe?Sr.LINES:Sr.TRIANGLE_STRIP}_makePipelineState(e,i){const{oitPass:r,output:s,hasOccludees:n,hasPolygonOffset:a}=e,o=r===0,l=r===2;return _i({blending:Ps(s)?kH(r):null,depthTest:{func:mpe(r)},depthWrite:U8e(e),drawBuffers:pS(s,US(r,s)),colorWrite:Fi,stencilWrite:n?jG:null,stencilTest:n?i?Hae:Tpe:null,polygonOffset:o||l?a?vMe:null:fpe})}initializePipeline(e){if(e.occluder){const i=e.hasPolygonOffset?vMe:null,{output:r,hasOccludees:s}=e;this._occluderPipelineTransparent=_i({blending:Xg,polygonOffset:i,depthTest:J$e,depthWrite:null,colorWrite:Fi,stencilWrite:null,stencilTest:s?OFt:null,drawBuffers:pS(r)}),this._occluderPipelineOpaque=_i({blending:Xg,polygonOffset:i,depthTest:s?J$e:Y$e,depthWrite:null,colorWrite:Fi,stencilWrite:s?CFt:null,stencilTest:s?AFt:null,drawBuffers:pS(r)}),this._occluderPipelineMaskWrite=_i({blending:null,polygonOffset:i,depthTest:Y$e,depthWrite:null,colorWrite:null,stencilWrite:s?jG:null,stencilTest:s?Hae:null,drawBuffers:pS(r)})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,i){if(e)return this._occludeePipeline;switch(i){case 11:return this._occluderPipelineTransparent??super.getPipeline();case 10:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}};const vMe={factor:0,units:-4};function q9e(t){const e=Qu().vec3f("position").vec4f16("previousDelta").vec4f16("nextDelta").f32("u0").vec2f16("lineParameters");return t.hasVVColor?e.f32("colorFeatureAttribute"):e.vec4u8("color",{glNormalized:!0}),t.hasVVSize?e.f32("sizeFeatureAttribute"):e.f32("size"),t.hasVVOpacity&&e.f32("opacityFeatureAttribute"),Ep()&&e.vec4u8("olidColor"),t.hasAnimation&&e.vec4f16("timeStamps"),e}let Sn=class extends Wf{constructor(e){super(),this.spherical=e,this.capType=0,this.emissionSource=0,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.hasVVOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.occluder=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.wireframe=!1,this.discardInvisibleFragments=!1,this.animation=2,this.hasScreenSizePerspective=!1,this.textureCoordinateType=0,this.occlusionPass=!1,this.hasVVInstancing=!1,this.hasSliceTranslatedView=!0,this.overlayEnabled=!1,this.snowCover=!1}get hasAnimation(){return this.animation!==0}};c([ue({count:3})],Sn.prototype,"capType",void 0),c([ue({count:8})],Sn.prototype,"emissionSource",void 0),c([ue()],Sn.prototype,"hasPolygonOffset",void 0),c([ue()],Sn.prototype,"writeDepth",void 0),c([ue()],Sn.prototype,"draped",void 0),c([ue()],Sn.prototype,"stippleEnabled",void 0),c([ue()],Sn.prototype,"stippleOffColorEnabled",void 0),c([ue()],Sn.prototype,"stipplePreferContinuous",void 0),c([ue()],Sn.prototype,"roundJoins",void 0),c([ue()],Sn.prototype,"applyMarkerOffset",void 0),c([ue()],Sn.prototype,"hasVVSize",void 0),c([ue()],Sn.prototype,"hasVVColor",void 0),c([ue()],Sn.prototype,"hasVVOpacity",void 0),c([ue()],Sn.prototype,"falloffEnabled",void 0),c([ue()],Sn.prototype,"innerColorEnabled",void 0),c([ue()],Sn.prototype,"hasOccludees",void 0),c([ue()],Sn.prototype,"occluder",void 0),c([ue()],Sn.prototype,"terrainDepthTest",void 0),c([ue()],Sn.prototype,"cullAboveTerrain",void 0),c([ue()],Sn.prototype,"wireframe",void 0),c([ue()],Sn.prototype,"discardInvisibleFragments",void 0),c([ue({count:4})],Sn.prototype,"animation",void 0),c([ue()],Sn.prototype,"hasScreenSizePerspective",void 0);let u8t=class extends IH{constructor(e,i){super(e,d8t),this.produces=new Map([[2,r=>Ede(r)||Ps(r)&&this.parameters.renderOccluded===8],[3,r=>Ade(r)],[10,r=>oae(r)&&this.parameters.renderOccluded===8],[11,r=>oae(r)&&this.parameters.renderOccluded===8],[4,r=>Ps(r)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==8],[8,r=>Ps(r)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==8],[18,r=>UPt(r)]]),this._configuration=new Sn(i)}getConfiguration(e,i){super.getConfiguration(e,i,this._configuration),this._configuration.oitPass=i.oitPass,this._configuration.draped=i.slot===18;const r=this.parameters.stipplePattern!=null&&e!==9;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&f8t(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasVVSize=this.parameters.hasVVSize,this._configuration.hasVVColor=this.parameters.hasVVColor,this._configuration.hasVVOpacity=this.parameters.hasVVOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=i.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===8,this._configuration.terrainDepthTest=i.terrainDepthTest&&Ps(e),this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration.animation=this.parameters.animation,this._configuration.emissionSource=this.hasEmissions?1:0,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration}get visible(){return this.parameters.color[3]>=ls||this.parameters.stipplePattern!=null&&(this.parameters.stippleOffColor?.[3]??0)>ls}setParameters(e,i){e.animation=this.parameters.animation,super.setParameters(e,i)}intersectDraped({attributes:e,screenToWorldRatio:i},r,s,n,a){if(!r.options.selectionMode)return;const o=e.get("size");let l=this.parameters.width;if(this.parameters.vvSize){const S=e.get("sizeFeatureAttribute").data[0];Number.isNaN(S)?l*=this.parameters.vvSize.fallback[0]:l*=Ce(this.parameters.vvSize.offset[0]+S*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else o&&(l*=o.data[0]);const u=s[0],d=s[1],f=(l/2+4)*i;let g=Number.MAX_VALUE,v=0;const _=e.get("position").data,x=coe(this.parameters,e)?_.length-2:_.length-5;for(let S=0;S<x;S+=3){const T=_[S],M=_[S+1],E=(S+3)%_.length,P=u-T,O=d-M,D=_[E]-T,L=_[E+1]-M,F=Ce((D*P+L*O)/(D*D+L*L),0,1),j=D*F-P,N=L*F-O,B=j*j+N*N;B<g&&(g=B,v=S/3)}g<f*f&&n(a.distance,a.normal,v)}intersect(e,i,r,s,n,a){const{options:o,camera:l,rayBegin:u,rayEnd:d}=r;if(!o.selectionMode||!e.visible||!l)return;if(!GRt(i))return void re.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const f=e.attributes,g=f.get("position").data;let v=this.parameters.width;if(this.parameters.vvSize){const E=f.get("sizeFeatureAttribute").data[0];Number.isNaN(E)||(v*=Ce(this.parameters.vvSize.offset[0]+E*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0]))}else f.has("size")&&(v*=f.get("size").data[0]);const _=m8t;na(_,r.point);const x=v*l.pixelRatio/2+4*l.pixelRatio;xe(jI[0],_[0]-x,_[1]+x,0),xe(jI[1],_[0]+x,_[1]+x,0),xe(jI[2],_[0]+x,_[1]-x,0),xe(jI[3],_[0]-x,_[1]-x,0);for(let E=0;E<4;E++)if(!l.unprojectFromRenderScreen(jI[E],By[E]))return;Fh(l.eye,By[0],By[1],aK),Fh(l.eye,By[1],By[2],oK),Fh(l.eye,By[2],By[3],lK),Fh(l.eye,By[3],By[0],cK);let S=Number.MAX_VALUE,T=0;const M=coe(this.parameters,f)?g.length-2:g.length-5;for(let E=0;E<M;E+=3){hc[0]=g[E]+i[12],hc[1]=g[E+1]+i[13],hc[2]=g[E+2]+i[14];const P=(E+3)%g.length;if(dc[0]=g[P]+i[12],dc[1]=g[P+1]+i[13],dc[2]=g[P+2]+i[14],Ya(aK,hc)<0&&Ya(aK,dc)<0||Ya(oK,hc)<0&&Ya(oK,dc)<0||Ya(lK,hc)<0&&Ya(lK,dc)<0||Ya(cK,hc)<0&&Ya(cK,dc)<0)continue;const O=l.projectToRenderScreen(hc,g8t),D=l.projectToRenderScreen(dc,y8t);if(O==null||D==null)continue;if(O[2]<0&&D[2]>0){Ae(zm,hc,dc);const F=l.frustum,j=-Ya(F[4],hc)/Le(zm,F[4]);if(he(zm,zm,j),$e(hc,hc,zm),!l.projectToRenderScreen(hc,O))continue}else if(O[2]>0&&D[2]<0){Ae(zm,dc,hc);const F=l.frustum,j=-Ya(F[4],dc)/Le(zm,F[4]);if(he(zm,zm,j),$e(dc,dc,zm),!l.projectToRenderScreen(dc,D))continue}else if(O[2]<0&&D[2]<0)continue;O[2]=0,D[2]=0;const L=Cje(pB(O,D,wMe),_);L<S&&(S=L,me(_Me,hc),me(bMe,dc),T=E/3)}if(S<x*x){let E=Number.MAX_VALUE;if(w3t(pB(_Me,bMe,wMe),pB(u,d,v8t),Lx)){Ae(Lx,Lx,u);const P=Ve(Lx);he(Lx,Lx,1/P),E=P/Bi(u,d)}a(E,Lx,T)}}get hasEmissions(){return this.parameters.emissiveStrength>0}createBufferWriter(){return new p8t(q9e(this.parameters),this.parameters)}createGLMaterial(e){return new h8t(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}update(e){const{hasAnimation:i}=this.parameters;return!!i&&(this.setParameters({timeElapsed:Ole(e.time)},!1),e.dt!==0)}},h8t=class extends npe{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures?.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.getTechnique(c8t,e)}},d8t=class extends K4t{constructor(){super(...arguments),this.width=0,this.color=nH,this.join="miter",this.cap=0,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1,this.timeElapsed=0,this.animation=0,this.animationSpeed=1,this.trailLength=1,this.startTime=0,this.endTime=1/0,this.fadeInTime=0,this.fadeOutTime=1/0,this.emissiveStrength=0}get transparent(){return this.color[3]<1||this.hasAnimation||this.stipplePattern!=null&&(this.stippleOffColor?.[3]??0)<1}get hasAnimation(){return this.animation!==0}},p8t=class{constructor(e,i){this.layout=e,this._parameters=i;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=SL+r}}_isClosed(e){return coe(this._parameters,e)}allocate(e){return this.layout.createBuffer(e)}elementCount(e){const r=e.get("position").indices.length/2+1,s=this._isClosed(e);let n=s?2:4;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n,a){const o=this.layout,l=r.get("position"),u=l.indices,d=l.data.length/3,f=r.get("distanceToStart")?.data;u&&u.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const g=o.fields.has("sizeFeatureAttribute");let v=1,_=null;if(g){const de=r.get("sizeFeatureAttribute");de.data.length===1?v=de.data[0]:_=de.data}else v=r.get("size")?.data[0]??1;let x=[1,1,1,1],S=0,T=null;const M=o.fields.has("colorFeatureAttribute");if(M){const de=r.get("colorFeatureAttribute");de.data.length===1?S=de.data[0]:T=de.data}else x=r.get("color")?.data??x;const E=r.get("timeStamps")?.data,P=E&&o.fields.has("timeStamps"),O=o.fields.has("opacityFeatureAttribute");let D=0,L=null;if(O){const de=r.get("opacityFeatureAttribute");de.data.length===1?D=de.data[0]:L=de.data}const F=new Float32Array(n.buffer),j=zUe(n.buffer),N=new Uint8Array(n.buffer),B=o.stride/4;let U=a*B;const Q=U;let H=0;const J=f?(de,Se,je)=>H=f[je]:(de,Se,je)=>H+=Bi(de,Se),Z=F.BYTES_PER_ELEMENT/j.BYTES_PER_ELEMENT,K=4/Z,ee=Ep(),_e=(de,Se,je,Be,pt,Dt,at,Bt)=>{F[U++]=Se[0],F[U++]=Se[1],F[U++]=Se[2],R$e(de,Se,j,U*Z),U+=K,R$e(je,Se,j,U*Z),U+=K,F[U++]=Bt;let kt=U*Z;if(j[kt++]=pt,j[kt++]=Dt,U=Math.ceil(kt/Z),M)F[U]=T?.[at]??S;else{const Lt=Math.min(4*at,x.length-4),Xt=4*U;N[Xt]=255*x[Lt],N[Xt+1]=255*x[Lt+1],N[Xt+2]=255*x[Lt+2],N[Xt+3]=255*x[Lt+3]}if(U++,F[U++]=_?.[at]??v,O&&(F[U++]=L?.[at]??D),ee){let Lt=4*U;s?(N[Lt++]=s[0],N[Lt++]=s[1],N[Lt++]=s[2],N[Lt++]=s[3]):(N[Lt++]=0,N[Lt++]=0,N[Lt++]=0,N[Lt++]=0),U=Math.ceil(.25*Lt)}P&&(kt=U*Z,j[kt++]=Be[0],j[kt++]=Be[1],j[kt++]=Be[2],j[kt++]=Be[3],U=Math.ceil(kt/Z))};U+=B,xe(Bs,l.data[0],l.data[1],l.data[2]),P&&Or(pc,E[0],E[1],E[2],E[3]),e&&Ft(Bs,Bs,e);const Ne=this._isClosed(r);if(Ne){const de=l.data.length-3;xe(ko,l.data[de],l.data[de+1],l.data[de+2]),e&&Ft(ko,ko,e)}else xe(ua,l.data[3],l.data[4],l.data[5]),e&&Ft(ua,ua,e),_e(Bs,Bs,ua,pc,1,-4,0,0),_e(Bs,Bs,ua,pc,1,4,0,0),me(ko,Bs),me(Bs,ua),P&&Or(pc,E[4],E[5],E[6],E[7]);const G=Ne?0:1,le=Ne?d:d-1;for(let de=G;de<le;de++){const Se=(de+1)%d*3;xe(ua,l.data[Se],l.data[Se+1],l.data[Se+2]),e&&Ft(ua,ua,e),J(ko,Bs,de),_e(ko,Bs,ua,pc,0,-1,de,H),_e(ko,Bs,ua,pc,0,1,de,H);const je=this.numJoinSubdivisions;for(let Be=0;Be<je;++Be){const pt=(Be+1)/(je+1);_e(ko,Bs,ua,pc,pt,-1,de,H),_e(ko,Bs,ua,pc,pt,1,de,H)}if(_e(ko,Bs,ua,pc,1,-2,de,H),_e(ko,Bs,ua,pc,1,2,de,H),me(ko,Bs),me(Bs,ua),P){const Be=(de+1)%d*4;Or(pc,E[Be],E[Be+1],E[Be+2],E[Be+3])}}return Ne?(xe(ua,l.data[3],l.data[4],l.data[5]),e&&Ft(ua,ua,e),H=J(ko,Bs,le),_e(ko,Bs,ua,pc,0,-1,G,H),_e(ko,Bs,ua,pc,0,1,G,H)):(H=J(ko,Bs,le),_e(ko,Bs,Bs,pc,0,-5,le,H),_e(ko,Bs,Bs,pc,0,5,le,H)),nK(F,Q+B,F,Q,B),U=nK(F,U-B,F,U,B),this._parameters.wireframe&&this._addWireframeVertices(n,Q,U,B),null}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let o=0;const l=u=>o=nK(a,u,n,o,s);for(let u=0;u<a.length-1;u+=2*s)l(u),l(u+2*s),l(u+1*s),l(u+2*s),l(u+1*s),l(u+3*s)}};function nK(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function coe(t,e){return t.isClosed?e.get("position").indices.length>2:!1}function f8t(t){return t.anchor===1&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const hc=I(),dc=I(),zm=I(),Lx=I(),m8t=I(),g8t=Dg(),y8t=Dg(),_Me=I(),bMe=I(),wMe=s_(),v8t=s_(),ko=I(),Bs=I(),ua=I(),pc=li(),jI=[Dg(),Dg(),Dg(),Dg()],By=[I(),I(),I(),I()],aK=Ui(),oK=Ui(),lK=Ui(),cK=Ui();let G9e=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+Gc(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const d=e9(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,d),d}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),a=Math.round(e[2]/r),o=`${s}/${n}/${a}`;let l=this._origins.get(o);const u=.5*r;if(Ae(co,e,i.vec3),co[0]=Math.abs(co[0]),co[1]=Math.abs(co[1]),co[2]=Math.abs(co[2]),co[0]<u&&co[1]<u&&co[2]<u){if(l){const d=Math.max(...co);if(Ae(co,e,l.vec3),co[0]=Math.abs(co[0]),co[1]=Math.abs(co[1]),co[2]=Math.abs(co[2]),Math.max(...co)<d)return l}return i}return l||(l=e9(s*r,n*r,a*r,o),this._origins.set(o,l)),l}_drawOriginBox(e,i=$i(1,1,0,1)){const r=window.view,s=r.stage,n=i.toString();if(!this._objects.has(n)){this._material=new u8t({width:2,color:i},!1);const v=new LGe(s,{pickable:!1}),_=new aGe({castShadow:!1});v.add(_),this._objects.set(n,_)}const a=this._objects.get(n),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=o.length,u=new Array(3*l),d=new Array,f=.5*this._gridSize;for(let v=0;v<l;v++)u[3*v]=e[0]+(1&o[v]?f:-f),u[3*v+1]=e[1]+(2&o[v]?f:-f),u[3*v+2]=e[2]+(4&o[v]?f:-f),v>0&&d.push(v-1,v);io(u,this._originSR,0,u,r.renderSpatialReference,0,l);const g=new Qc(this._material,[["position",new ki(u,d,3,!0)]],null,2);a.addGeometry(g)}get test(){}};const co=I();function d_(t=_8t){return[t[0],t[1],t[2],t[3]]}function uK(t,e,i=d_()){return me(i,t),i[3]=e,i}function xMe(t,e,i){return At(i,t,e),Re(i,i),i[3]=-eze(t,e),i}function KSi(t,e=d_()){const i=c5e(zk,t);return H9e(e,to(gde(e,i))),e}function SMe(t,e,i=d_()){return mG(zk,t,TMe(t)),mG($Me,e,TMe(e)),gH(zk,$Me,zk),H9e(i,to(gde(i,zk)))}function eTi(t,e,i,r=d_()){return uK(Zce,t,Wj),uK(Yce,e,CMe),uK(L0,i,MMe),SMe(Wj,CMe,Wj),SMe(Wj,MMe,r),r}function tTi(t){return t}function iTi(t){return t[3]}function TMe(t){return zt(t[3])}function H9e(t,e){return t[3]=e,t}const _8t=[0,0,1,0],zk=Pp(),$Me=Pp();d_();const Wj=d_(),CMe=d_(),MMe=d_();function b8t(t){return t!=null&&!t.readyToRun}let w8t=class{constructor(){this.startTime=0,this._data=ta(null),this.coverage=0,this.absorption=0,this._readChannels=0,this.parallax=new EMe,this.parallaxNew=new EMe,this._anchorPoint=I(),this._fadeState=ta(0),this._fadeFactor=ta(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case 0:return 0;case 4:return 1-this.fadeFactor;case 1:return this.fadeFactor;case 2:case 3:return 1}}fade(e,i,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?Ce((i-this.startTime)/(S8t*r),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(e,i),this._updateParallax(e)}_evaluateState(e,i){const r=e.relativeElevation,s=this._updateAnchorPoint(e);(r>1.7*mS||r<-mS||s>OMe)&&this.opacity>0?this._startFade(0,i):this.isFading||(r>mS||r<-.35*mS||s>T8t*OMe?this.opacity>0&&this._startFade(4,i):b8t(this.data)&&(this.opacity===0?this._startFade(1,i):this.data.state===2&&(this.fadeState===2?this._startFade(3,i):this._startFade(2,i))))}_updateParallax(e){const i=ea(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(i-Ci.radius*Ci.radius,0))/Math.sqrt(i),xMe(AMe,this.parallax.anchorPoint,oM),Uh(this.parallax.transform,gl,oM[3],oM),xMe(AMe,this.parallaxNew.anchorPoint,oM),Uh(this.parallaxNew.transform,gl,oM[3],oM)}_updateAnchorPoint(e){return Re(this._anchorPoint,e.eye),he(this._anchorPoint,this._anchorPoint,Ci.radius),this.fadeState===0&&this.data?.state===2?(me(this.parallax.anchorPoint,this._anchorPoint),0):Ve(Ae(x8t,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,i){switch(this._fadeState.value=e,this.startTime=i,e){case 3:this.requestFade(),this._switchReadChannels(),me(this.parallaxNew.anchorPoint,this._anchorPoint);break;case 1:this.requestFade(),this._switchReadChannels(),me(this.parallax.anchorPoint,this._anchorPoint),me(this.parallaxNew.anchorPoint,this._anchorPoint);break;case 4:this.requestFade();break;case 2:this._switchReadChannels(),me(this.parallax.anchorPoint,this._anchorPoint),me(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case 0:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==2&&(this.data.state=0),this.fadeState){case 3:me(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=2;break;case 1:this._fadeState.value=2;break;case 4:this._fadeState.value=0;break;case 2:case 0:break;default:this.fadeState}}_switchReadChannels(){this.data?.state===2&&(this._readChannels=1-this._readChannels,this.data.state=3)}get isFading(){return this.fadeState===4||this.fadeState===1||this.fadeState===3}},EMe=class{constructor(){this.anchorPoint=I(),this.radiusCurvatureCorrection=0,this.transform=ut()}};const AMe=Ye(0,0,1),oM=d_(),x8t=I(),S8t=1.25,T8t=.5,OMe=2e5;let $8t=class{constructor(e,i){this.width=e,this.height=i}},pfe=class{constructor(e){this.shadowMap=e,this.slot=2,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=0,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this.cutFillEnabled=!1,this._camera=new wr,this._inverseViewport=Ke(),this._oldLighting=new IX,this._newLighting=new IX,this._fadedLighting=new IX,this._lighting=this._newLighting,this.ssr=new C8t,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=Ke(),this.highlightMixTexture=null,this.hudRenderStyle=0,this.hudOccludedFragmentOpacity=1,this.snowCover=0,this.clouds=new w8t,this.shadowHighlightsVisible=!1}destroy(){this._camera=null,this.contentCamera=null,this.depth=null,this.geometryDepth=null,this.mainDepth=null,this.overlay=null,this.ssao=null,this.terrainDepth=null}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,i,r,s){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=i,this._newLighting.globalFactor=r,this._newLighting.set(e),this._oldLighting.updateLegacy(),s===1&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return this.highlightLevel==null?null:this.highlights[this.highlightLevel]}},C8t=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=ut()}},W9e=class{constructor(e,i,r){this.rctx=e,this.techniques=r,this.lastFrameCamera=new wr,this.output=0,this.renderOccludedMask=TL,this.time=0,this.bind=new pfe(i),this.bind.alignPixelEnabled=!0}};const TL=13;let Nk=class extends wr{constructor(){super(...arguments),this._projectionMatrix=ut()}get projectionMatrix(){return this._projectionMatrix}};c([p()],Nk.prototype,"_projectionMatrix",void 0),c([p({readOnly:!0})],Nk.prototype,"projectionMatrix",null),Nk=c([R("esri.views.3d.webgl-engine.lib.CascadeCamera")],Nk);let Zj=class{constructor(){this.camera=new Nk,this.lightMat=ut()}},M8t=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},ffe=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new M8t,this._projectionView=ut(),this._projectionViewInverse=ut(),this._modelViewLight=ut(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=li(),this._cascades=[new Zj,new Zj,new Zj,new Zj],this._lastOrigin=null,this._enabled=!1,this._maxTextureWidth=Math.min(ie("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture(To)}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Or(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeMainBuffer(){this._handle=Lr(this._handle)}disposeOffscreenBuffers(){this.disposeMainBuffer(),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Ce(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)KB[e]=this._cascades[e];return KB.length=this._numCascades,KB}start(e,i,r,s,n){xt(this.enabled);const{near:a,far:o}=D8t(r);this._computeCascadeDistances(a,o,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:u}=e;for(let d=0;d<this._numCascades;++d)this._constructCascade(d,u,l,i);this._lastOrigin=null,this.clear()}finish(){xt(this.enabled)}getShadowMapMatrices(e){if(!this._lastOrigin||!di(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||I(),me(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){$p(LMe,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)FMe[16*i+r]=LMe[r]}}return FMe}moveSnapshot(e){xt(this.enabled),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle?.setName(e===0?"shadow map highlight":"shadow map excluding highlight"),this._handle=null}copySnapshot(e){if(!this.enabled||!this._handle?.getTexture(To)?.descriptor)return;this._snapshots[e]?.release();const r=e===0?"shadow map highlight":"shadow map excluding highlight",s=this._acquireFBO(r);this._snapshots[e]=s;const n=this._handle?.fbo;if(!n||!s?.fbo)return void console.error("No FBO");const{rctx:a}=this._fbos;a.blitFramebuffer(n,s.fbo,256)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture(To):null}clear(){this._ensureFbo(),this.bindFbo(),this._fbos.rctx.clear(256)}_computeTextureHeight({pixelRatio:e,fullWidth:i,fullHeight:r},s,n){const a=Math.min(window.devicePixelRatio,s)/e,o=n?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return T1(Math.max(i,r)*a*o,this._maxTextureWidth/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._acquireFBO("shadow map"))}_acquireFBO(e){const i=this._fbos.acquire(this._textureWidth,this._textureHeight,e,12);return i.getTexture(To)?.setShadowFiltering(!0),i}_discardSnapshot(e){this._snapshots[e]=Lr(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],a=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],l=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]),u=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]);xt(l<u);for(let v=0;v<8;++v){Or(PMe,v%4==0||v%4==3?-1:1,v%4==0||v%4==1?-1:1,v<4?l:u,1);const _=Zd[v];zu(_,PMe,this._projectionViewInverse),_[0]/=_[3],_[1]/=_[3],_[2]/=_[3]}fp(hK,Zd[0]),n.camera.viewMatrix=$p(E8t,this._modelViewLight,hK);for(let v=0;v<8;++v)Ft(Zd[v],Zd[v],n.camera.viewMatrix);let d=Zd[0][2],f=Zd[0][2];for(let v=1;v<8;++v)d=Math.min(d,Zd[v][2]),f=Math.max(f,Zd[v][2]);d-=200,f+=200,n.camera.near=-f,n.camera.far=-d,I8t(r,s,d,f,n.camera),Cn(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const g=this._textureHeight;n.camera.viewport=[e*g,0,g,g]}_setupMatrices(e,i){Cn(this._projectionView,e.projectionMatrix,e.viewMatrix),Kl(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===1?e.eye:xe(hK,0,0,1);O7(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(qRt(i/e,4)),s);const n=(i-e)/this._numCascades,a=(i/e)**(1/this._numCascades);let o=e,l=e;for(let u=0;u<this._numCascades+1;++u)this._cascadeDistances[u]=yt(o,l,this.settings.splitSchemeLambda),o*=a,l+=n}get test(){}};const E8t=ut(),PMe=li(),Zd=[];for(let t=0;t<8;++t)Zd.push(li());const RMe=Ke(),IMe=Ke(),A8t=Ke(),DMe=Ke(),kMe=Ke(),hK=I(),KB=[];function O8t(){KB.length=0}const LMe=ut(),FMe=gl.concat(gl,gl,gl),fh=Ke(),lM=Ke(),Fx=[Ke(),Ke(),Ke(),Ke()],ha=Ke(),dK=Ke(),lb=Ke(),UI=Ke(),cM=Ke(),uM=Ke(),Yj=Ke();function P8t(t,e,i,r,s,n,a,o){oi(fh,0,0);for(let O=0;O<4;++O)bg(fh,fh,t[O]);Nh(fh,fh,.25),oi(lM,0,0);for(let O=4;O<8;++O)bg(lM,lM,t[O]);Nh(lM,lM,.25),Ou(Fx[0],t[4],t[5],.5),Ou(Fx[1],t[5],t[6],.5),Ou(Fx[2],t[6],t[7],.5),Ou(Fx[3],t[7],t[4],.5);let l=0,u=I0(Fx[0],fh);for(let O=1;O<4;++O){const D=I0(Fx[O],fh);D<u&&(u=D,l=O)}Os(ha,Fx[l],t[l+4]);const d=ha[0];let f,g;ha[0]=-ha[1],ha[1]=d,Os(dK,lM,fh),dn(dK,ha)<0&&bce(ha,ha),Ou(ha,ha,dK,i),vO(ha,ha),f=g=dn(Os(lb,t[0],fh),ha);for(let O=1;O<8;++O){const D=dn(Os(lb,t[O],fh),ha);D<f?f=D:D>g&&(g=D)}na(r,fh),Nh(lb,ha,f-e),bg(r,r,lb);let v=-1,_=1,x=0,S=0;for(let O=0;O<8;++O){Os(UI,t[O],r),vO(UI,UI);const D=ha[0]*UI[1]-ha[1]*UI[0];D>0?D>v&&(v=D,x=O):D<_&&(_=D,S=O)}ZC(v>0,"leftArea"),ZC(_<0,"rightArea"),Nh(cM,ha,f),bg(cM,cM,fh),Nh(uM,ha,g),bg(uM,uM,fh),Yj[0]=-ha[1],Yj[1]=ha[0];const T=tj(r,t[S],uM,bg(lb,uM,Yj),1,s),M=tj(r,t[x],uM,lb,1,n),E=tj(r,t[x],cM,bg(lb,cM,Yj),1,a),P=tj(r,t[S],cM,lb,1,o);ZC(T,"rayRay"),ZC(M,"rayRay"),ZC(E,"rayRay"),ZC(P,"rayRay")}function Ii(t,e){return 3*e+t}const zMe=Ke();function lu(t,e){return oi(zMe,t[e],t[e+3]),zMe}const fc=Ke(),ft=Jr();function R8t(t,e,i,r,s){Os(fc,i,r),Nh(fc,fc,.5),ft[0]=fc[0],ft[1]=fc[1],ft[2]=0,ft[3]=fc[1],ft[4]=-fc[0],ft[5]=0,ft[6]=fc[0]*fc[0]+fc[1]*fc[1],ft[7]=fc[0]*fc[1]-fc[1]*fc[0],ft[8]=1,ft[Ii(0,2)]=-dn(lu(ft,0),t),ft[Ii(1,2)]=-dn(lu(ft,1),t);let n=dn(lu(ft,0),i)+ft[Ii(0,2)],a=dn(lu(ft,1),i)+ft[Ii(1,2)],o=dn(lu(ft,0),r)+ft[Ii(0,2)],l=dn(lu(ft,1),r)+ft[Ii(1,2)];n=-(n+o)/(a+l),ft[Ii(0,0)]+=ft[Ii(1,0)]*n,ft[Ii(0,1)]+=ft[Ii(1,1)]*n,ft[Ii(0,2)]+=ft[Ii(1,2)]*n,n=1/(dn(lu(ft,0),i)+ft[Ii(0,2)]),a=1/(dn(lu(ft,1),i)+ft[Ii(1,2)]),ft[Ii(0,0)]*=n,ft[Ii(0,1)]*=n,ft[Ii(0,2)]*=n,ft[Ii(1,0)]*=a,ft[Ii(1,1)]*=a,ft[Ii(1,2)]*=a,ft[Ii(2,0)]=ft[Ii(1,0)],ft[Ii(2,1)]=ft[Ii(1,1)],ft[Ii(2,2)]=ft[Ii(1,2)],ft[Ii(1,2)]+=1,n=dn(lu(ft,1),e)+ft[Ii(1,2)],a=dn(lu(ft,2),e)+ft[Ii(2,2)],o=dn(lu(ft,1),i)+ft[Ii(1,2)],l=dn(lu(ft,2),i)+ft[Ii(2,2)],n=-.5*(n/a+o/l),ft[Ii(1,0)]+=ft[Ii(2,0)]*n,ft[Ii(1,1)]+=ft[Ii(2,1)]*n,ft[Ii(1,2)]+=ft[Ii(2,2)]*n,n=dn(lu(ft,1),e)+ft[Ii(1,2)],a=dn(lu(ft,2),e)+ft[Ii(2,2)],o=-a/n,ft[Ii(1,0)]*=o,ft[Ii(1,1)]*=o,ft[Ii(1,2)]*=o,s[0]=ft[0],s[1]=ft[1],s[2]=0,s[3]=ft[2],s[4]=ft[3],s[5]=ft[4],s[6]=0,s[7]=ft[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=ft[6],s[13]=ft[7],s[14]=0,s[15]=ft[8]}function I8t(t,e,i,r,s){const n=1/Zd[0][3],a=1/Zd[4][3];xt(n<a);let o=n+Math.sqrt(n*a);const l=Math.sin(Ao(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));o/=l,P8t(Zd,o,l,RMe,IMe,A8t,DMe,kMe),R8t(RMe,IMe,DMe,kMe,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function D8t(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}let NMe=class extends er{constructor(e,i){super(e,i,new Hi(CBt,()=>W(()=>Promise.resolve().then(()=>xri),void 0)),wn)}initializePipeline(e){return e.hasAlpha?_i({blending:Xg,colorWrite:Fi}):_i({colorWrite:Fi})}},Z9e=class extends Tl{constructor(){super(...arguments),this.hasAlpha=!1}};c([ue()],Z9e.prototype,"hasAlpha",void 0);let mfe=class extends $r{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}};function Y9e(){const t=new Gi;return t.include(no),t.fragment.uniforms.add(new Gt("tex",e=>e.texture)),t.fragment.uniforms.add(new q1("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new _t("opacity",e=>e.opacity)),t.fragment.main.add(A`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),t}const k8t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:mfe,build:Y9e},Symbol.toStringTag,{value:"Module"}));let VMe=class extends er{constructor(e,i){super(e,i,new Hi(k8t,()=>W(()=>Promise.resolve().then(()=>Sri),void 0)),wn)}},ag=class extends VF{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new mfe,this.hasHighlights=!1,this.renderOccludedFlags=1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Ai,this._passParameters=new afe,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new wr,this.events=new gm,this.longitudeCyclical=null,this.produces=new Map([[18,i=>i!==9||this.hasHighlights],[19,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1,this._hasDrapedFlowSource=!1}initialize(){const e=this._view,i=e.stage,r=i.renderer.fboCache,{waterTextures:s,techniques:n}=i.renderView;this._renderContext=new W9e(this._rctx,new ffe(r,e.state.viewingMode),n),this.addHandles([X(()=>s.updating,()=>this.events.emit("content-changed"),bt),X(()=>this._spatialReference,l=>this._localOriginFactory=new G9e(l),bt),tn(()=>e.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),X(()=>kBt(e.state.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,Yt),X(()=>e.state.highlights,l=>{this._bindParameters.highlights=l,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap},Yt),e.resourceController.scheduler.registerTask(Tt.OVERLAY_RENDERER,this)]);const{_bindParameters:a,_camera:o}=this;o.near=1,o.far=1e4,o.relativeElevation=null,a.slot=18,a.mainDepth=null,a.camera=o,a.oitPass=0,a.updateLighting([new jde(nS())],0,0,0)}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=jt(this._passParameters.texture),this.disposeOverlays(),this._renderContext=null,this._sortedRenderers.prune()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view.stage}get _spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._pluginContext.materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){const i=new P9e(this._view.stage.renderView.textures,this._techniques,()=>{this._onMaterialOrContentChanged(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._pluginContext={...e,materials:i},this._techniques.precompile(VMe)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Lf(this._renderers,e=>e.updating||e.canCompact)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),SS(this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e))}registerDrapeSource(e,i){const r=this._renderers.get(e);r?.destroy(),this._renderers.set(e,i),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(X(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e)}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(e){this._renderTargets?.dispose(e)}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&rE(e,i=>i.drapeTargetType===1)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=rE(e,i=>i.drapeSourceType===1),this._hasDrapedRasterSource=rE(e,i=>i.drapeSourceType===0),this._hasDrapedFlowSource=rE(e,i=>i.drapeSourceType===2)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=this._hasDrapedFlowSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new $Bt(this._stage.renderer.fboCache),this._overlays=[new uMe,new uMe]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets?.dispose(1),this._renderTargets=null,this.events.emit("textures-disposed")}_useOverlayColorInsteadOfColorNoRasterImage(e){return e===1&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource}getTexture(e){const i=this._useOverlayColorInsteadOfColorNoRasterImage(e);return this._renderTargets?.getTexture(i?0:e)}get readyToRun(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_onMaterialOrContentChanged(){this.renderOccludedFlags=Lf(this._renderers,e=>e.hasOccluders)?n5:1}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers(),e.madeProgress()),this.compact(e),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this._onMaterialOrContentChanged(),this.hasHighlights=Lf(this._renderers,s=>s.hasHighlights),this.events.emit("content-changed"))}compact(e){let i=!1;for(const r of this._renderers.values()){if(e.done)break;i=r.compact(e)||i}return i&&this.notifyChange("updating"),i}hasHighlight(e){return Lf(this._renderers,i=>i.hasHighlight(e))}processSyncDrapeSources(){this._processDrapeSources(Jl,e=>e.updatePolicy===1)}get isEmpty(){return!bn.OVERLAY_DRAW_DEBUG_TEXTURE&&Vee(this._renderers,e=>e.isEmpty)}get hasWater(){const e=Lf(this._renderers,({hasWater:i})=>i);return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}renders(e){if(bn.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==4&&e!==2)return!0;if(!this._overlays)return!1;const i=this._overlays[0];for(const n of this._overlays)n.setupGeometryViews(this.longitudeCyclical);if(!i.hasSomeSizedView())return!1;const r=this._renderContext.output;this._renderContext.output=this._renderTargets?.targets.find(n=>n.content===e)?.output??0,++this._techniques.precompiling;const s=this._sortedRenderers.some(({renderer:n})=>n.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.output=r,s}get mode(){return this.isEmpty?0:this.hasWater&&this.renders(3)?2:this._renderTargets?.getTexture(0)?1:0}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i&&this.parent.requestRender(0),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(!this._overlays||!this._renderTargets)return!1;const i=this._bindParameters;i.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const r of this._renderTargets.targets){if(r.content===1&&!this._needsColorWithoutRasterImage)continue;const{output:s}=r;this._renderContext.output=s,i.slot=s===3?19:18,s===9&&(i.highlightMixTexture=i.highlights.length>1?this._rctx.emptyTexture:null);const n=this._renderContext.renderOccludedMask;r.content===4&&(this._renderContext.renderOccludedMask=n5),this._sortedRenderers.forAll(({drapeSource:a,renderer:o})=>{r.content===1&&a.drapeSourceType===0||r.content===4&&o.hasOnlyOccluders||o.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=n,i.highlightMixTexture=null}return--this._techniques.precompiling,!0}drawOverlays(e,i){if(!this._overlays||!this._renderTargets)return;for(const s of this._overlays)s.setupGeometryViews(this.longitudeCyclical);this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;const r=this.allSourcesOccluders;for(const s of this._renderTargets.targets){if(!(s.content===0&&this._hasDrapedFlowSource)&&!s.handleRenderRequest(i)||s.content===1&&!this._needsColorWithoutRasterImage||s.content===4&&r)continue;const n=this._drawTarget(0,s),a=this._drawTarget(1,s);(n||a)&&s.fbo.generateMipMap()}}_drawTarget(e,i){const r=this._overlays[e],s=r.canvasGeometries;if(s.numViews===0)return!1;const n=this._view.state.contentPixelRatio;this._screenToWorldRatio=n*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const{output:a}=i;if(this.isEmpty||a===3&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:o,_camera:l,_renderContext:u,_bindParameters:d}=this;if(l.pixelRatio=r.pixelRatio*n,u.output=a,d.screenToWorldRatio=this._screenToWorldRatio,d.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,d.slot=a===3?19:18,i.content===4&&(u.renderOccludedMask=n5),!this.renders(i.content))return u.renderOccludedMask=TL,!1;const{resolution:f}=r,g=e===0,v=g?0:f;if(o.setViewport(v,0,f,f),this._bindTargetFBO(i),g)if(i.output!==9)o.setClearColor(0,0,0,0),o.clear(16384);else{const{gl:_}=o;_.clearBufferuiv(_.COLOR,0,[0,0,0,0])}if(bn.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==4&&i.content!==2){this._techniques.precompile(NMe,uoe);const _=this._techniques.get(NMe,uoe);for(let x=0;x<s.numViews;x++)this._setViewParameters(s.extents[x],r),this._ensureDebugPatternResources(r.resolution,F8t[e]),o.bindTechnique(_,d,this._passParameters),o.screen.draw()}if(i.output===9){const{fboCache:_}=this._stage.renderer,x=this._resolution;this._bindTargetFBO(i),O9e(o,_,{width:x,height:x},d,()=>this._renderAllGeometry(e,i),v)}else this._renderAllGeometry(e,i);return o.bindFramebuffer(null),u.renderOccludedMask=TL,!0}get allSourcesOccluders(){return Vee(this._renderers,e=>e.hasOnlyOccluders)}_renderAllGeometry(e,i){const r=this._overlays[e],s=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:n,renderer:a})=>{if(i.content===1&&n.drapeSourceType===0)return;const{fullOpacity:o}=n,l=o!=null&&o<1&&i.output===0&&this._bindTemporaryFBO();for(let u=0;u<s.numViews;u++)this._setViewParameters(s.extents[u],r),a.render(this._renderContext);if(l){this._bindTargetFBO(i),this._overlayParameters.texture=l.getTexture(),this._overlayParameters.opacity=o,this._overlayParameters.overlayIndex=e;const u=this._techniques.get(VMe);this._rctx.bindTechnique(u,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),l.release()}})}_bindTargetFBO(e){const i=this._resolution,r=2*i;e.fbo.ensureFramebuffer(r,i),e.fbo.bind(this._rctx)}_bindTemporaryFBO(){const e=this._resolution,i=2*e,r=this._stage.renderer.fboCache,s=r.acquire(i,e,"overlay tmp");return r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(16384),s}get _resolution(){return this._overlays?.[0].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers)n=a.intersect?.(e,i,r,s,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this._view.map.allLayers.map(r=>r.uid),i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer?.uid),a=n>=0,o=s.renderGroup??(a?0:1),l=s.drapeSourcePriorityOffset??0,u=i*o+(a?n:0)+l;this._sortedRenderers.push(new L8t(s,r,u))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],h5e(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),A7(r.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,i){if(xe(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let o=0;o<e;o++){const l=Math.floor(o/10),u=Math.floor(a/10);l<2||u<2||10*l>e-20||10*u>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&l&&1&u?1&o^1&a?0:255:1&l^1&u?0:128)}const n=new ar(e);n.samplingMode=9728,this._passParameters.texture=new qi(this._rctx,n,r)}get test(){}};c([p()],ag.prototype,"hasHighlights",void 0),c([p()],ag.prototype,"renderOccludedFlags",void 0),c([p()],ag.prototype,"_sortedDrapeSourceRenderersDirty",void 0),c([p({constructOnly:!0})],ag.prototype,"parent",void 0),c([p({readOnly:!0})],ag.prototype,"_techniques",null),c([p({type:Boolean,readOnly:!0})],ag.prototype,"updating",null),c([p()],ag.prototype,"isEmpty",null),ag=c([R("esri.views.3d.terrain.OverlayRenderer")],ag);let L8t=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const F8t=[[1,.5,.5],[.5,.5,1]],_Ti=-2,n5=4,uoe=new Z9e;uoe.hasAlpha=!0;let hoe=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}clear(){this.adds.length=0,this.removes.length=0,this.updates.length=0}prune(){this.clear()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},z8t=class{},N8t=class{constructor(e){this.pending=e,this.adds=new Array,this.removes=new Array,this.updates=new Array}clearAddsAndRemoves(){this.adds.forEach(e=>Uc(this.pending.adds,e)),this.removes.forEach(e=>Uc(this.pending.removes,e)),this.adds.length=0,this.removes.length=0}clearUpdates(){this.updates.forEach(e=>Uc(this.pending.updates,e)),this.updates.length=0}clear(){this.clearUpdates(),this.clearAddsAndRemoves()}};function V8t(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new N8t(t),e.set(r,s)),s};return t.removes.forEach(r=>{pK(r)&&i(r.material).removes.push(r)}),t.adds.forEach(r=>{pK(r)&&i(r.material).adds.push(r)}),t.updates.forEach(r=>{pK(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function pK(t){return t.geometry.indexCount>=1}let gfe=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function jMe(t){if(t.length<2)return;const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);n&&(s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)}}}let UMe=class extends gfe{constructor(e,i,r,s){super(i,r),this.geometry=e,this._highlightName=null,this.updateHighlightOptions(s)}updateHighlightOptions(e){const{geometry:i}=this;if(!i.hasHighlights)return void(this._highlightName=null);let r=-1,s=null;i.foreachHighlightOptions(n=>{const a=e.get(n)??-1;a>r&&(r=a,s=n)}),this._highlightName=s}get highlightName(){return this._highlightName}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}get hasOccludees(){return this.geometry.occludees!=null}},j8t=class{constructor(e){this.baseInstanceData=e,this.dataByOrigin=new Map}get id(){return this.baseInstanceData?.baseInstance.id??f4}dispose(){for(const e of this.dataByOrigin.values())e.dispose();this.dataByOrigin.clear(),this.baseInstanceData?.dispose()}},U8t=class{constructor(e,i,r){this.baseInstance=e,this.baseInstanceBuffer=i,this.baseCommand=r}dispose(){this.baseInstanceBuffer.dispose()}},J9e=class{constructor(){this.first=0,this.count=0}},B8t=class{constructor(e,i){this.vao=e,this.instanceCount=i}dispose(){this.vao.disposeVAOOnly()}},q8t=class{constructor(){this.commandVAOs=new Kg,this.drawCommandsDefault=new Array,this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=new Array,this.drawCommandsShadowHighlightRest=new Array}clear(){this.commandVAOs.clear(),this.drawCommandsDefault.length=0,this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.length=0,this.drawCommandsShadowHighlightRest.length=0}dispose(){for(const e of this.commandVAOs.values())e.dispose();this.clear()}},BMe=class{constructor(e){this.targetBuffer=e,this.vaoEndElement=0,this._numElements=0,this._instances=new Map,this.holes=new Ai({allocator:i=>i||new gfe,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightNames=new Set,this.drawCommandsDefault=Jj(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=Jj(),this.drawCommandsShadowHighlightRest=Jj(),this._instancedCommandVAOs=null}get numElements(){return this._numElements}get instances(){return this._instances}get writeableInstances(){return this._instances}get hasHighlights(){return this.highlightNames.size>0}get instancedCommandVAOs(){return this._instancedCommandVAOs}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightNames.clear()}updateIfDrawCommandsDirty(e){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const i of this.instances.values())this.updateDrawState(i);this.updateDrawCommands(e)}}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstances(){let e=0;for(const i of this._instances.values())e+=i.numElements,this.updateDrawState(i);this._numElements=e}updateDrawState(e){if(e.isVisible){const{highlightName:i}=e;i&&this.highlightNames.add(i),e.hasOccludees&&(this.hasOccludees=!0)}else this.hasHiddenInstances=!0}updateDrawCommands(e){this._updateDrawCommands(e),this._updateInstancedCommandVAOs()}_updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;const{sortedInstances:i}=this;if(this._updateHighlightDrawCommands(e,i),!this.needsMultipleCommands){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao&&this.holes.length===1&&s.to===this.vaoEndElement?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}for(const r of i)r.isVisible&&fK(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r)}get sortedInstances(){return Array.from(this._instances.values()).sort((e,i)=>e.from===i.from?e.to-i.to:e.from-i.from)}updateHighlights(e){this.highlightNames.clear();const i=this.sortedInstances;for(const r of i)r.updateHighlightOptions(e),r.isVisible&&r.highlightName&&this.highlightNames.add(r.highlightName);this._updateHighlightDrawCommands(e),this._updateInstancedCommandVAOs()}_updateHighlightDrawCommands(e,i=this.sortedInstances){const{drawCommandsHighlights:r,drawCommandsShadowHighlightRest:s}=this;r.clear(),s.clear();for(const n of i){if(n.updateHighlightOptions(e),!n.isVisible)continue;const{highlightName:a}=n;a&&(this.highlightNames.add(a),fK(Fu(r,a,Jj),n)),a&&a===cm||fK(s,n)}}_updateInstancedCommandVAOs(){const e=this.vao;if(this.targetBuffer==="geometry"||e==null)return;this._instancedCommandVAOs??=new q8t;const i=this._instancedCommandVAOs,r=i.commandVAOs.copy();i.clear();const s=i.commandVAOs,n=(a,o)=>{for(const l of a){const{first:u,count:d}=l,f=s.get(u,d)??r.pop(u,d)??new B8t(e.shallowCloneWithBaseInstances(new Map([["instances",l.first]])),l.count);s.set(u,d,f),o.push(f)}};n(this.drawCommandsDefault,i.drawCommandsDefault);for(const[a,o]of this.drawCommandsHighlights){const l=new Array;n(o,l),i.drawCommandsHighlights.set(a,l)}n(this.drawCommandsOccludees,i.drawCommandsOccludees),n(this.drawCommandsShadowHighlightRest,i.drawCommandsShadowHighlightRest);for(const a of r.values())a.dispose();r.clear()}get needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function G8t(t){return t.vao!=null}function qMe(t){return t?"instances":"geometry"}function Jj(){return new Ai({allocator:t=>t||new J9e,deallocator:t=>t})}function fK(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(H8t(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function H8t(t,e){return t.first+t.count>=e.from}let W8t=class{constructor(e,i){this.origin=e,this.isInstanced=i,this.buffers=new Array}dispose(){if(this.isInstanced)for(const e of this.buffers)e.vao.buffer("instances")?.dispose(),e.vao.disposeVAOOnly(),e.instancedCommandVAOs?.dispose();else for(const e of this.buffers)e.vao.dispose();this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}},GMe=class{constructor(e,i){this._rctx=i,this._bufferWriter=e.createBufferWriter(),this._vaoCache=i.getVaoCache(bl(this._bufferWriter.layout))}maxElements(e){return Math.floor(gK/this._targetStrideFloats(e))}_targetStrideFloats(e){return this._targetStrideBytes(e)/4}_targetStrideBytes(e){return this._targetLayout(e)?.stride??0}_targetLayout(e){return e==="geometry"?this._bufferWriter.layout:this._bufferWriter.instanceLayout}endElement(e){return Math.floor((e.vao?.getByteLength(e.targetBuffer)??0)/this._targetStrideBytes(e.targetBuffer))}evaluateBufferAllocation(e,i,r,s){const n=this._targetStrideFloats(s.targetBuffer),a=i.reduce((f,{geometry:g})=>f+this.elementCount(g),0),o=r.reduce((f,{geometry:g})=>f+this.elementCount(g),0),l=Math.min((e+a-o)*n,gK),u=s.vao?.buffer(s.targetBuffer),d=(u?.sizeBytes??0)/4;return l>a5&&l<d/2?0:l>d?1:2}deleteBuffer(e){if(e.targetBuffer==="instances")return e.instancedCommandVAOs?.dispose(),e.vao?.buffer("instances")?.dispose(),e.vao?.disposeVAOOnly(),void(e.vao=null);this._vaoCache.deleteVao(e.vao)}createBaseInstanceData(e){const{_bufferWriter:i}=this;if(e==null||i.writeBaseInstance==null||i.elementCountBaseInstance==null)return null;const r=i.layout,s=i.elementCountBaseInstance(e.attributes),n=s*this._targetStrideFloats("geometry"),a=new vn(this._rctx,bl(r));a.setSize(Math.ceil(4*n));const o=zx(n),l=r.createView(o.buffer);i.writeBaseInstance(e.attributes,l),a.setSubData(o,0,0,n);const u=new J9e;return u.first=0,u.count=s,new U8t(e,a,u)}_allocateInstanceBuffer(e){const i=this._bufferWriter.instanceLayout;xt(i!=null,"Trying to allocate an instance buffer, but the BufferWriter does not support instancing");const r=e*this._targetStrideFloats("instances"),s=new vn(this._rctx,bl(i,1));return s.setSize(yK(r)),s}_createInstancedVao(e,i){return new bm(this._rctx,new Map([["geometry",e],["instances",i]]))}reallocateBuffer(e,i,r){if(this.deleteBuffer(i),e!=null){const n=e.baseInstanceBuffer,a=this._allocateInstanceBuffer(r);return this._createInstancedVao(n,a)}const s=r*this._targetStrideFloats("geometry");return this._vaoCache.newVao(yK(s))}elementCount(e){return this._bufferWriter.elementCount(e.attributes)}canGrow(e,i){const{targetBuffer:r,vao:s}=e;if(s==null)return!0;const n=4*(i*this._targetStrideFloats(r));return s.getByteLength(r)<yK(gK-a5)&&n>s.getByteLength(r)}clearHoles(e,{vao:i,targetBuffer:r}){const s=this._targetStrideFloats(r),n=e.reduce((l,u)=>Math.max(l,u.numElements),0)*s,a=zx(n);a.fill(0,0,n);const o=i.buffer(r);for(const l of e)o?.setSubData(a,l.from*s,0,l.numElements*s)}clearHolesMetal(e,i,r,{vao:s,targetBuffer:n}){const a=this._targetStrideFloats(n),o=(r-i)*a,l=zx(o),u=this._targetLayout(n).createView(l.buffer);l.fill(0,0,o);for(const d of e){if(!(d.from>=i&&d.to<=r))continue;const f=d.from-i;this._writeGeometry(d.geometry,u,f)}s.buffer(n)?.setSubData(l,i*a,0,o)}writeRandomInstances(e,i,{vao:r,targetBuffer:s}){const n=this._targetStrideFloats(s),a=zx(e*n),o=this._targetLayout(s).createView(a.buffer);let l=0,u=0,d=0;const f=r.buffer(s);for(const v of i){if(d!==v.from){const _=d-u;_>0&&f?.setSubData(a,u*n,0,_*n),u=v.from,l=0}this._writeGeometry(v.geometry,o,l),l+=v.numElements,d=v.to}const g=d-u;g>0&&f?.setSubData(a,u*n,0,g*n)}writeInstanceRangeMetal(e,i,r,{vao:s,targetBuffer:n}){const a=this._targetStrideFloats(n),o=e-i,l=o*a,u=zx(l),d=this._targetLayout(n).createView(u.buffer);u.fill(0,0,l);for(const f of r){if(!(f.from>=i&&f.to<=e))continue;const g=f.from-i;this._writeGeometry(f.geometry,d,g)}o>0&&s.buffer(n)?.setSubData(u,i*a,0,l)}rebuildInstances(e,i,{vao:r,targetBuffer:s}){const n=this._targetStrideFloats(s),a=zx(e*n),o=this._targetLayout(s).createView(a.buffer);let l=0;for(const u of i){this._writeGeometry(u.geometry,o,l);const d=l;l+=this.elementCount(u.geometry.geometry),u.from=d,u.to=l}return r?.buffer(s)?.setSubData(a,0,0,l*n),l}updateInstance(e,{vao:i,targetBuffer:r}){const{_bufferWriter:s}=this,n=this._targetStrideFloats(r),a=zx(s.elementCount(e.geometry.geometry.attributes)*n),o=this._targetLayout(r).createView(a.buffer);this._writeGeometry(e.geometry,o,0),i.buffer(r)?.setSubData(a,e.from*n,0,e.numElements*n)}updateInstancesMetal(e){for(const[i,r]of e){let s=1/0,n=-1/0;for(const a of r)s=Math.min(s,a.from),n=Math.max(n,a.to);this.writeInstanceRangeMetal(n,s,i.instances.values(),i)}}_writeGeometry(e,i,r){const{_bufferWriter:s}=this;s!=null&&(Ln(hM,e.transformation),hM[12]-=e.localOrigin.vec3[0],hM[13]-=e.localOrigin.vec3[1],hM[14]-=e.localOrigin.vec3[2],Kl(Qj,hM),Yc(Qj,Qj),s.write(hM,Qj,e.geometry.attributes,e.geometry.olidColor,i,r))}static prune(){e8=new Float32Array(a5)}};const hM=ut(),Qj=ut(),a5=65536,mK=4*a5,HMe=1024,Q9e=16777216,gK=Q9e/4;let e8=new Float32Array(a5);function zx(t){return e8.length<t&&(e8=new Float32Array(t)),e8}function yK(t){const e=4*t;return e<=HMe?HMe:e<mK?Xit(e):Math.max(Math.min(Math.ceil(1.5*e/mK)*mK,Q9e),e)}let Q2=class extends be{constructor(e){super(e),this._vaoWriter=null,this._useMetalWorkaround=!1,this._hasOccludees=!1}destroy(){this.uninitializeRenderContext()}initializeRenderContext(e){this._useMetalWorkaround=e.renderContext.rctx.isAssumedMetalDriver,this._vaoWriter=new GMe(this.material,e.renderContext.rctx)}uninitializeRenderContext(){this._useMetalWorkaround=!1,this._vaoWriter=null}get hasOccludees(){return this._hasOccludees}modify(e,i){this._applyUpdates(e,i),this._applyAddsAndRemoves(e),this._updateDrawCommands()}get canCompact(){for(const e of this.dataByBaseInstance.values())for(const i of e.dataByOrigin.values())if(i.buffers.some(r=>r.holes.length>1))return!0;return!1}compact(e){if(!this.canCompact)return!1;let i=!1;for(const r of this.dataByBaseInstance.values())for(const s of r.dataByOrigin.values()){const n=new Array;for(let a=0;a<s.buffers.length&&!e.done;){const o=s.buffers[a];o.holes.length<=1?++a:(o.instances.forEach(({geometry:l})=>n.push(l)),this._vaoWriter?.deleteBuffer(o),Uc(s.buffers,o,void 0,{last:a}),e.madeProgress())}if(n.length>0){const{baseInstanceData:a}=r;s.buffers.forEach(l=>this._applyAdds(a,l,n));const o=qMe(a!=null);for(;n.length>0;)s.buffers.push(this._applyAndRebuild(a,new BMe(o),n,null));i=!0}}return i}updateHighlights(e){this.highlightOrderMap=e;for(const i of this.dataByBaseInstance.values())for(const r of i.dataByOrigin.values())for(const s of r.buffers)s.updateHighlights(e)}_applyUpdates(e,i){const r=this._vaoWriter;if(r==null)return void e.clearUpdates();let s;const n=this._useMetalWorkaround?(a,o)=>{s??=new Map;let l=s.get(o);l||(l=[],s.set(o,l)),l.push(a)}:(a,o)=>r.updateInstance(a,o);for(const a of e.updates){if(i.done)return;const{renderGeometry:o,updateType:l}=a;Uc(e.pending.updates,a),i.madeProgress();const u=this.dataByBaseInstance.get(o.geometry.baseGeometry?.id??f4),d=u?.dataByOrigin.get(o.localOrigin.id)?.findBuffer(o.id);if(d==null)return;const f=d.instances.get(o.id);6&l&&n(f,d),25&l&&(d.drawCommandsDirty=!0)}s&&r.updateInstancesMetal(s)}_computeDeltas(e,i){const r=new Map;for(const s of e){const n=s.localOrigin;if(n==null)continue;const a=s.geometry.baseGeometry,o=Fu(r,a??null,ZMe);let l=o.get(n,null);l==null&&(l=new WMe(n.vec3,a),o.set(n,null,l)),l.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const a=s.geometry.baseGeometry,o=this.dataByBaseInstance.get(a?.id??f4),l=o?.dataByOrigin.get(n.id)?.findBuffer(s.id);if(l==null)continue;const u=Fu(r,a??null,ZMe);let d=u.get(n,l);d==null&&(d=new WMe(n.vec3,a),u.set(n,l,d)),d.changes.push(s)}return r}_applyAddsAndRemoves(e){const{_vaoWriter:i,dataByBaseInstance:r}=this;if(i==null)return void e.clearAddsAndRemoves();const s=this._computeDeltas(e.adds,e.removes);for(const[n,a]of s){const o=Fu(r,n?.id??f4,()=>new j8t(i.createBaseInstanceData(n))),l=n!=null;for(const[u,d]of a.outerMap()){const f=d.get(null),g=f?.changes??[];a.delete(u,null);const v=Fu(o.dataByOrigin,u.id,()=>new W8t(u.vec3,l));for(const[_,x]of d){if(a.delete(u,_),_==null&&xt(!1,"No VAO for removed geometries"),_.instances.size===x.changes.length){i.deleteBuffer(_),Uc(v.buffers,_),v.buffers.length===0&&g.length===0&&o.dataByOrigin.delete(u.id);continue}const S=_.numElements;switch(i.evaluateBufferAllocation(S,g,x.changes,_)){case 0:x.changes.forEach(({id:T})=>_.deleteInstance(T)),_.instances.forEach(({geometry:T})=>g.push(T)),i.deleteBuffer(_),Uc(v.buffers,_);break;case 1:this._applyAndRebuild(o.baseInstanceData,_,g,x);break;case 2:this._applyRemoves(_,x)}}if(g.length>0){const{baseInstanceData:_}=o,x=qMe(l);for(const S of v.buffers)this._applyAdds(_,S,g);for(;g.length>0;)v.buffers.push(this._applyAndRebuild(_,new BMe(x),g,null))}}o.dataByOrigin.size===0&&(o.dispose(),r.delete(o.id))}e.clearAddsAndRemoves()}_updateDrawCommands(){this._hasOccludees=!1;for(const e of this.dataByBaseInstance.values())for(const i of e.dataByOrigin.values())for(const r of i.buffers)r.updateIfDrawCommandsDirty(this.highlightOrderMap),this._hasOccludees||=r.hasOccludees}_applyAndRebuild(e,i,r,s){if(s)for(const d of s.changes)i.deleteInstance(d.id);const n=this._vaoWriter,a=n.maxElements(i.targetBuffer);let o=i.numElements;for(;r.length>0;){const d=r.pop(),f=n.elementCount(d.geometry);if(o+f>a&&o>0){r.push(d);break}o+=f;const g=new UMe(d,0,0,this.highlightOrderMap);xt(i.instances.get(d.id)==null),i.addInstance(d.id,g)}i.resetInstanceSummary(),i.vao=n.reallocateBuffer(e,i,o),i.vaoEndElement=n.endElement(i);const l=n.rebuildInstances(o,i.writeableInstances.values(),i);i.updateInstances(),i.holes.clear();const u=i.holes.pushNew();return u.from=l,u.to=i.vaoEndElement,i.updateDrawCommands(this.highlightOrderMap),i}_applyRemoves(e,i){const{_vaoWriter:r}=this;if(i.changes.length===0||r==null)return;let s=1/0,n=-1/0;for(const a of i.changes){const o=a.id,l=e.instances.get(o);if(!l)continue;e.deleteInstance(o),this._useMetalWorkaround&&(s=Math.min(s,l.from),n=Math.max(n,l.to));const u=qy.back();if(u){if(u.to===l.from){u.to=l.to;continue}if(u.from===l.to){u.from=l.from;continue}}const d=qy.pushNew();d.from=l.from,d.to=l.to}jMe(qy),this._useMetalWorkaround?r.clearHolesMetal(e.instances.values(),s,n,e):r.clearHoles(qy,e),e.holes.pushArray(qy.data,qy.length),qy.forAll((a,o)=>qy.data[o]=null),qy.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i,r){if(r.length===0||this._vaoWriter==null)return;if(!G8t(i))return void this._applyAndRebuild(e,i,r,null);const s=this._vaoWriter,n=i.numElements,a=r.reduce((g,{geometry:v})=>g+s.elementCount(v),0),o=Math.min(n+a,s.maxElements(i.targetBuffer));if(s.canGrow(i,o))return void this._applyAndRebuild(e,i,r,null);jMe(i.holes);const l=new Array;let u=1/0,d=-1/0;for(const{geometry:g}of r){const v=s.elementCount(g),_=Z8t(i.holes,v);l.push(_),this._useMetalWorkaround&&_!=null&&(u=Math.min(_,u),d=Math.max(_+v,d))}const f=this._addInstances(r,i,l);if(this._useMetalWorkaround){for(const g of f);s.writeInstanceRangeMetal(d,u,i.instances.values(),i)}else s.writeRandomInstances(o,f,i);q9(r,(g,v)=>l[v]==null)}*_addInstances(e,i,r){const s=e.length,n=this._vaoWriter;for(let a=0;a<s;++a){const o=r[a];if(o==null)continue;const l=e[a],u=n.elementCount(l.geometry),d=new UMe(l,o,o+u,this.highlightOrderMap);xt(i.instances.get(l.id)==null),i.addInstance(l.id,d),i.drawCommandsDirty=!0,yield d}}static prune(){GMe.prune()}};c([p({constructOnly:!0})],Q2.prototype,"dataByBaseInstance",void 0),c([p({constructOnly:!0})],Q2.prototype,"material",void 0),c([p()],Q2.prototype,"highlightOrderMap",void 0),Q2=c([R("esri.views.3d.webgl-engine.materials.renderers.MergedBuffer")],Q2);let WMe=class{constructor(e,i){this.origin=e,this.baseInstance=i,this.changes=new Array}};function Z8t(t,e){const i=t.find(s=>s.numElements>=e);if(i==null)return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const qy=new Ai({allocator:t=>t||new gfe,deallocator:null});function ZMe(){return new Kg}let Y8t=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.produces.get(i)?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n){if(n.ensureResources(e)===2)return n;this._repository.requestRender()}return null}},X9e=class extends Cqe{constructor(e=I()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}},Vk=class extends be{constructor(e){super(e),this._glMaterials=null,this._drawParameters=new X9e,this._highlightNames=new Set,this._produces=new Map}initialize(){this._updateProduces()}destroy(){this.uninitializeRenderContext()}get _hasHighlights(){return this._highlightNames.size>0}hasHighlight(e){return this._highlightNames.has(e)}get produces(){return this._produces}_updateProduces(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this.dataByBaseInstance.size===0||!(r!==9&&r!==5||this._hasHighlights))&&e(r))})}initializeRenderContext(e){this._glMaterials=new Y8t(this.material,e.materials)}uninitializeRenderContext(){this._glMaterials=jt(this._glMaterials)}acquireTechniques(e){if(!this.material.shouldRender(e))return null;const{output:i,bind:r}=e;if(!this.material.produces.get(r.slot)?.(i))return null;const{highlight:n,slot:a}=r,o=i===5,l=i===9,u=l||o,d=n?.name;if(u&&(this._highlightNames.size===0||l&&d&&!this._highlightNames.has(d)))return null;const f=_=>l&&!!d&&!_.has(d),g=i===6,v=!(u||g);for(const _ of this.dataByBaseInstance.values())for(const x of _.dataByOrigin.values())for(const S of x.buffers){if(f(S.highlightNames))continue;const T=o?S.drawCommandsHighlights.get(cm):u?d?S.drawCommandsHighlights.get(d):S.drawCommandsHighlights.size>0:((g&&S.needsMultipleCommands?S.drawCommandsShadowHighlightRest:S.drawCommandsDefault)||null)?.length??!1,M=v&&S.drawCommandsOccludees||null;if(T||M?.length){const E=this._glMaterials.load(e.rctx,a,i),P=E?.beginSlot(r);if(P)return P}}return null}render(e,i){const{output:r,bind:s}=e,{slot:n,highlight:a}=s,o=r===9,l=a?.name??"";if(o&&!a)return;const u=r===5,d=o||u,f=r===6,g=!(d||f),v=n===10||n===11?n:null,{rctx:_}=e;_.runAppleAmdDriverHelper();const x=_.bindTechnique(i,s,this.material.parameters);for(const S of this.dataByBaseInstance.values()){const{baseInstanceData:T}=S,M=T!=null,E=M?K8t:X8t,P=M?Q8t:J8t;for(const O of S.dataByOrigin.values()){this._drawParameters.origin=O.origin;for(const D of O.buffers){if(o&&(!D.hasHighlights||!D.drawCommandsHighlights.has(l))||u&&(!D.hasHighlights||!D.drawCommandsHighlights.has(cm)))continue;const L=P(D),F=eqt(L,D.needsMultipleCommands,l,u,d,f),j=tqt(L,g);(F?.length||j?.length)&&(x.bindDraw(s,this.material.parameters,this._drawParameters),E(_,D,T,i,F,j,v))}}}}updateHighlights(){const{_highlightNames:e}=this;e.clear();for(const i of this.dataByBaseInstance.values())for(const r of i.dataByOrigin.values())for(const s of r.buffers)for(const n of s.highlightNames)e.add(n);this._updateProduces()}get test(){}};c([p({constructOnly:!0})],Vk.prototype,"material",void 0),c([p({constructOnly:!0})],Vk.prototype,"dataByBaseInstance",void 0),Vk=c([R("esri.views.3d.webgl-engine.materials.renderers.VaoRenderer")],Vk);const J8t=t=>t,Q8t=t=>t.instancedCommandVAOs,X8t=(t,{vao:e},i,r,s,n,a)=>{r.ensureAttributeLocations(e),t.bindVAO(e),YMe(t,r,s,a,!1),YMe(t,r,n,a,!0)},K8t=(t,e,{baseCommand:i},r,s,n,a)=>{JMe(t,r,i,s,a,!1),JMe(t,r,i,n,a,!0)};function YMe(t,e,i,r,s){if(i?.length){t.setPipelineState(e.getPipeline(s,r));for(const n of i)t.drawArrays(e.primitiveType,n.first,n.count)}}function JMe(t,e,{first:i,count:r},s,n,a){if(s?.length){t.setPipelineState(e.getPipeline(a,n));for(const{vao:o,instanceCount:l}of s)e.ensureAttributeLocations(o),t.bindVAO(o),t.drawArraysInstanced(e.primitiveType,i,r,l)}}function eqt(t,e,i,r,s,n){const a=s&&!r?t.drawCommandsHighlights.get(i)??null:null;return r?t.drawCommandsHighlights.get(cm):s?a:n&&e?t.drawCommandsShadowHighlightRest:t.drawCommandsDefault}function tqt(t,e){return e&&t.drawCommandsOccludees||null}let PE=class extends VF{constructor(e){super(e),this._dataByBaseInstance=new Map,this._buffer=null,this._renderer=null,this.drapedPriority=0}initialize(){this._buffer=new Q2({material:this.material,dataByBaseInstance:this._dataByBaseInstance,highlightOrderMap:this.highlightOrderMap}),this._renderer=new Vk({material:this.material,dataByBaseInstance:this._dataByBaseInstance})}destroy(){for(const e of this._dataByBaseInstance.values())e.dispose();this._dataByBaseInstance.clear(),this._buffer.destroy(),this._renderer.destroy()}hasHighlight(e){return this._renderer.hasHighlight(e)}initializeRenderContext(e){this._buffer.initializeRenderContext(e),this._renderer.initializeRenderContext(e)}uninitializeRenderContext(){this._buffer.uninitializeRenderContext(),this._renderer.uninitializeRenderContext()}get produces(){return this._renderer.produces}get hasOccludees(){return this._buffer.hasOccludees}get hasOnlyOccluders(){return!!(-2&this.renderOccludedFlags)}get hasEmitters(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}get renderOccludedFlags(){return this.material.renderOccludedFlags}get numGeometries(){let e=0;for(const i of this._dataByBaseInstance.values())for(const r of i.dataByOrigin.values())e+=r.buffers.reduce((s,n)=>s+n.instances.size,0);return e}get usedMemory(){let e=0;for(const i of this._dataByBaseInstance.values())for(const r of i.dataByOrigin.values())e+=r.buffers.reduce((s,n)=>s+n.vao.usedMemory,0);return e}forEachGeometry(e){for(const i of this._dataByBaseInstance.values())for(const r of i.dataByOrigin.values())for(const s of r.buffers)for(const{geometry:n}of s.instances.values())e(n)}modify(e,i){this._buffer.modify(e,i),this._renderer.updateHighlights()}get canCompact(){return this._buffer.canCompact}compact(e){return this._buffer.compact(e)}updateHighlights(e){this.highlightOrderMap=e,this._buffer.updateHighlights(e),this._renderer.updateHighlights()}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){return this._renderer.acquireTechniques(e)}render(e,i){return this._renderer.render(e,i)}static prune(){Q2.prune()}get test(){}};c([p({constructOnly:!0})],PE.prototype,"material",void 0),c([p()],PE.prototype,"highlightOrderMap",void 0),PE=c([R("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],PE);let o5=class extends be{constructor(e){super(e),this._renderers=new Map}destroy(){this._renderers.forEach(e=>!e.destroyed&&e.destroy()),this._renderers.clear()}initialize(){this.addHandles(X(()=>this.stage.view.state.highlights,()=>this.updateHighlights()))}getMaterialRenderer(e){return this._renderers.get(e)}updateHighlights(){this._renderers.forEach(e=>e.updateHighlights(this.stage.view.state.highlightOrderMap))}commit(e,i,r){const{adds:s,removes:n,updates:a}=e;if(s.length===0&&n.length===0&&a.length===0)return!1;V8t(e).forEach((l,u)=>{if(i.done)return;let d=this._renderers.get(u);d==null&&l.adds.length>0&&(d=new PE({material:u,highlightOrderMap:this.stage.view.state.highlightOrderMap}),d.initializeRenderContext(r),this.rendererAdded(d),this._renderers.set(u,d)),d?(d.modify(l,i),d.updateHighlights(this.stage.view.state.highlightOrderMap),d.numGeometries===0&&(this._renderers.delete(d.material),this.rendererRemoved(d),d.destroy())):(l.clear(),i.madeProgress())});let o=0;for(const l of this._renderers.values())l.drapedPriority=o++;return!0}get canCompact(){for(const e of this._renderers.values())if(e.canCompact)return!0;return!1}compact(e){let i=!1;for(const r of this._renderers.values()){if(e.done)return i;i=r.compact(e)||i}return i}get renderers(){return this._renderers}};c([p({constructOnly:!0})],o5.prototype,"stage",void 0),o5=c([R("esri.views.3d.webgl-engine.lib.RendererBase")],o5);let og=class extends o5{constructor(e){super(e),this._pending=new iqt,this._changes=new hoe,this._sortedRenderers=new Ai,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this.destroyed||(this._changes.prune(),this._sortedRenderers.prune(),this._geometries.clear(),this._pending.clear())}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}hasHighlight(e){return Lf(this.renderers,i=>i.hasHighlight(e))}get hasWater(){return this._hasWater}get hasOccluders(){return this.renderers&&Lf(this.renderers,e=>e.hasOnlyOccluders)}get hasOnlyOccluders(){return Vee(this.renderers,e=>e.hasOnlyOccluders)}get isEmpty(){return!this.updating&&this.renderers.size===0&&this._geometries.size===0}get sortedRenderers(){return this._sortedRenderers}commitChanges(){return!!this.updating&&(this._processAddsRemoves(),this.commit(this._changes,Jl,this.rendererContext.pluginContext)&&(this._updateSortedMaterialRenderers(),this._hasHighlights=Lf(this.renderers,e=>{const i=e.produces.get(18);return!!i&&i(9)}),this._hasWater=Lf(this.renderers,e=>{const i=e.produces.get(19);return!!i&&i(3)})),this.notifyChange("updating"),!0)}rendererAdded(){this._sortedRenderers.clear()}rendererRemoved(){this._sortedRenderers.clear()}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);switch(s&&this.notifyChange("updating"),i){case 0:this._notifyGraphicVisibilityChanged(e);break;case 1:this._notifyGraphicGeometryChanged(e)}}removeGeometries(e,i){if(this.destroyed)return;const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===1&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=new z8t;this._changes.updates.push(n),n.renderGeometry=this._ensureValidRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case 4:case 2:return this._notifyGraphicGeometryChanged(e);case 1:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}precompile(e){return this._sortedRenderers.reduce((i,r)=>r.precompile(e)||i,!1)}render(e){this._sortedRenderers.forAll(i=>{const r=i.acquireTechniques(e);r&&i.render(e,r)})}intersect(e,i,r,s,n){for(const a of this._geometries.values()){if(!s(a))continue;this._intersectRenderGeometry(a,r,i,0,e,n);const o=this.rendererContext.longitudeCyclical;o&&(a.boundingSphere[0]-a.boundingSphere[3]<o.min&&this._intersectRenderGeometry(a,r,i,o.range,e,n),a.boundingSphere[0]+a.boundingSphere[3]>o.max&&this._intersectRenderGeometry(a,r,i,-o.range,e,n)),n++}return n}_updateSortedMaterialRenderers(){if(!(this._sortedRenderers.length>0)){for(const e of this.renderers.values())this._sortedRenderers.push(e);this._sortedRenderers.sort((e,i)=>i.material?.renderPriority===e.material?.renderPriority?e.drapedPriority-i.drapedPriority:(i.material?.renderPriority||0)-(e.material?.renderPriority||0))}}_processAddsRemoves(){this._changes.adds.length=0,this._changes.removes.length=0,r_e(this._changes.adds,Array.from(this._pending.adds)),r_e(this._changes.removes,Array.from(this._pending.removes)),q9(this._changes.updates,({renderGeometry:e})=>!this._pending.has(e)),this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,a){if(!e.visible||!e.material.visible||!e.material.intersectDraped)return;let o=0;s+=e.transformation[12],o=e.transformation[13],vK[0]=r[0]-s,vK[1]=r[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,n,vK,(l,u,d)=>{rqt(i,d,a,e.material.renderPriority,n,e.layerViewUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicGeometryChanged(r),i=r)}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const{graphicUid:r}of e)r!=null&&r!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(r),i=r)}_validateRenderGeometries(e){for(const i of e)this._ensureValidRenderGeometry(i);return e}_ensureValidRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(Li(e.boundingSphere))),e}get test(){}};c([p({constructOnly:!0})],og.prototype,"drapeSource",void 0),c([p({constructOnly:!0})],og.prototype,"rendererContext",void 0),c([p()],og.prototype,"updating",null),c([p()],og.prototype,"rctx",null),c([p()],og.prototype,"_localOriginFactory",null),c([p({readOnly:!0})],og.prototype,"isEmpty",null),c([p()],og.prototype,"_geometries",void 0),og=c([R("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],og);let iqt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function rqt(t,e,i,r,s,n,a){const o=new Ujt(n,a,e),l=u=>{u.set(5,o,t.distance,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.distance==null||s.results.ground.distance<=s.results.min.distance)&&l(s.results.min),s.options.store!==0&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.distance==null||s.results.ground.distance>s.results.max.distance)&&l(s.results.max),s.options.store===2){const u=new kw(s.ray);l(u),s.results.all.push(u)}}const vK=Ke();function K9e(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const i of e)i.includes(".glsl")&&delete t[i]}}let QMe=class{constructor(e,i){this.screen=e,this.olid=i}};const e7e=1.3,sqt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let cb,bc=class extends be{constructor(e){super(e),this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._latestOriginId=0,this.groundView=e.view.groundView}initialize(){const{view:e}=this;this.renderer=new ag({parent:this}),e.stage.renderer.plugins.add(this.renderer);const i=()=>this.requestRender();this._groundIntersector=new Zu(e.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([X(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",()=>e.stage?.renderer.updateHasFlags()),this.renderer.events.on("content-changed",i),X(()=>e.state.camera.pixelRatio,i),X(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.groundView.requestRender(1)),X(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),X(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Ht),vs(()=>this.groundView,r=>r.on("elevation-change",()=>this.setPlacementDirty())),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Tt.OVERLAY,this)]),e.stage.renderer.overlay=this}destroy(){this.view?.stage&&(this.view.stage.renderer.plugins.remove(this.renderer),this.view.stage.renderer.overlay=null,Pe(this.renderer)),cb&&(cb.hide(),cb=null),this.renderer=null}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.renderer.longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this.renderer.longitudeCyclical=TF(e))):this.renderer.disposeOverlays()}get readyToRun(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||bn.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&(this.terrainSurface.ready||!this.terrainSurface.enabled)}get _isSpherical(){return this.view.state.isGlobal}get worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?xr(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return e7e/this.view.resolutionScale}get longitudeCyclical(){return this.renderer.longitudeCyclical}get suspended(){return this.terrainSurface.enabled&&this.terrainSurface.suspended}get updating(){return this.readyToRun||!!this.renderer?.updating||this._contentUpdated}render(){return this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.precompileShaders(this.view.state)?this._drawOverlays():null}get hasOverlays(){return this.renderer.hasOverlays}registerDrapeSource(e,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources),this.renderer.registerDrapeSource(e,i),this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("readyToRun")}registerGeometryDrapeSource(e){const i=new og({stage:this.view.stage,drapeSource:e,rendererContext:this.renderer});return this.registerDrapeSource(e,i),i}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("readyToRun"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.requestRender()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this.updateOverlays(e,this.view.state.contentCamera,1)}updateOverlays(e,i,r){if(!this._spatialReference)return Oa;const s=this._computeOverlayHeight(i);this._computeOverlayExtents(i,s,Nm),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Nm.stretch);const n=this._updateOverlay(0,Nm.inner,s,1*Nm.pixelRatioAdjustment,Nm.mapUnitsPerPixel),a=So(Nm.inner)/So(Nm.outer),o=this._updateOverlay(1,Nm.outer,s,a*Nm.pixelRatioAdjustment,Nm.mapUnitsPerPixel);n!==1&&o!==1||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.groundView.updateOverlayParameters(),this.groundView.requestRender(r)),n===0&&o===0||this.requestRender(),this._placementDirty=!1,e.madeProgress()}_computeOverlayHeight(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s)),{maxPreferredTexturePixels:a,maxTextureSize:o}=this.view.stage.renderView.renderingContext.parameters,l=.5*o;return T1(OGe({width:n,height:n},{maxPreferredTexturePixels:2*a,maxTextureSize:l})[1],l)}get overlays(){return this.renderer.overlays}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return 0;const a=this.renderer.overlays[e],o=a.mapUnitsPerPixel;if(a.mapUnitsPerPixel=n,a.pixelRatio=s,nqt(i,a.extent)&&r===a.resolution)return o===n?0:2;a.setExtent(i),a.resolution=r;const l=wIe(a.extent);return a.renderLocalOrigin=e9(l[0],l[1],0,"OV_"+this._latestOriginId++),1}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[0],s=this.renderer.overlays[1],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}reloadShaders(){K9e(),this.requestRender(),this.runTask(Jl)}requestRender(e=1){this.renderer.hasOverlays?(e===1?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this._drawTexturesAnimateDirty=!0,this.view.stage.renderView.requestRender(e)):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s,n){const a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,cqt,i,r);if(a==null)return!1;const o=a.origin,l=$e(Xj,a.origin,a.direction);this._groundIntersector.reset(o,l,e),this._groundIntersector.intersect([]),this.view.groundView.intersect(this._groundIntersector,null,o,l);const u=this._groundIntersector.results.min;return u.getIntersectionPoint(n)&&u.withinDistance(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),a=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,l=Ce(a.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+o,e.aboveGround?n-o:1/0),u=e.aboveGround;if(this.view.viewingMode==="global"){const d=Xj;PP(O$(pH,xr(this.view.spatialReference).radius+l),um(e.eye,e.viewForward),d),Ae(d,d,e.eye);const f=Kw.normalize(Eje(e.viewForward,d,e.viewRight))/e.fovY+.5,g=f<=0||f>=1?.5:s;r=u?g*f:f+g*(1-f)}else{const d=.5*Math.PI-Math.acos(-e.viewForward[2]),f=Math.tan(d),g=$i(0,f,1,0),v=zu(g,g,e.projectionMatrix)[1],_=Ce(.5+.5*v,0,1);r=_===1||_===0?.5:u?_*s:1-(1-_)*s}return this._intersectGroundFromView(e,.5,r,a.distance,i)}_computeOverlayExtents(e,i,r){const{view:s}=this,n=s.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,a=I();this._findHorizonBasedPointOfInterest(e,a)||me(a,n);const o=this._renderSR;bn.OVERLAY_SHOW_CENTER?(cb==null&&(cb=new V3(s.graphics,"red")),cb.show(a,o)):cb?.hide();const l=Math.max(.1,Bi(e.eye,a)),u=G0(s.renderCoordsHelper,n,e.eye),d=this._spatialReference;this._overlaySREqualsRenderSR||Co(a,o,a,d);const f=this._isSpherical,g=this.groundView.extentAABR,v=!f&&d?.isGeographic,_=v&&d?1/xr(d).metersPerDegree:1,x=s.state.contentPixelRatio,S=e.perScreenPixelRatio/x*l*_;r.mapUnitsPerPixel=S/this.worldToPCSRatio,r.stretch=this._overlayStretch;let T=i*S/2*r.stretch,M=!1,E=v?90:1/0;f&&g&&d&&(d.isWebMercator?(T/=Math.cos(cte(a[1])),E=g[3]):(M=!0,T/=xr(d).metersPerDegree,E=90),T>=E&&(T=E,a[1]=0,d.isWebMercator&&(a[0]=0)));let P=1;M&&(P=1/Math.max(.2,Math.cos(Math.abs(zt(a[1])))),T*P>180&&(P=180/T),r.mapUnitsPerPixel*=P);const O=Math.log(2)/12;T=Math.exp(Math.round(Math.log(T)/O)*O);const D=T*P,L=32,F=.5*i/(L*D),j=.5*i/(L*T);a[0]=Math.round(a[0]*F)/F,a[1]=Math.round(a[1]*j)/j;const N=r.inner;N[0]=a[0]-D,N[1]=a[1]-T,N[2]=a[0]+D,N[3]=a[1]+T,f&&this._shiftExtentToFitBounds(N,1/0,E);const B=r.outer;if(6*D>So(g))O1(B,g);else if(Math.PI/2-Math.abs(u-Math.PI/2)<=.25*Math.PI)B[0]=N[0]-D,B[1]=N[1]-T,B[2]=N[2]+D,B[3]=N[3]+T;else{Co(e.eye,o,Xj,d),Os(Nx,a,Xj);let Q=-Math.atan2(Nx[1],Nx[0])+.125*Math.PI;Q<0&&(Q+=2*Math.PI);const H=Math.floor(Q/(.25*Math.PI));y1(Nx,sqt[H],2*T),Nx[0]*=P,Nx[2]*=P,Lhe(B,N,Nx)}if(f)B[0]=this.longitudeCyclical.clamp(B[0]),B[2]=this.longitudeCyclical.clamp(B[2]),B[1]=Math.max(B[1],-E),B[3]=Math.min(B[3],E);else{const Q=pte(N,g,oqt),H=pte(B,g,lqt);rF(Q,H)&&(B[2]=B[0],B[3]=B[1])}const U=Math.abs(N[2]-N[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,U),r.pixelRatioAdjustment=r.mapUnitsPerPixel/U}_drawOverlays(e=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const i=!this._drawTexturesDirty&&this._drawTexturesAnimateDirty?0:1;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const r=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(i),this.renderer.drawOverlays(e,i),r!==this.renderer.computeValidity()&&(this.groundView.updateOverlayParameters(),this.groundView.requestRender(1)),this.groundView.requestRender(i),i===1&&this.terrainSurface.requestUpdate(),this.renderer}_pointIsInExtent(e,i){if(this.longitudeCyclical)return this.longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),_q(e,s,n)}get test(){}};function nqt(t,e){const r=bn.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}c([p()],bc.prototype,"_spatialReference",void 0),c([p({readOnly:!0})],bc.prototype,"readyToRun",null),c([p()],bc.prototype,"_placementDirty",void 0),c([p()],bc.prototype,"_contentUpdated",void 0),c([p()],bc.prototype,"_isSpherical",null),c([p()],bc.prototype,"worldToPCSRatio",null),c([p()],bc.prototype,"renderer",void 0),c([p({constructOnly:!0})],bc.prototype,"view",void 0),c([p({constructOnly:!0})],bc.prototype,"groundView",void 0),c([p({constructOnly:!0})],bc.prototype,"terrainSurface",void 0),c([p()],bc.prototype,"suspended",null),c([p()],bc.prototype,"updating",null),bc=c([R("esri.views.3d.terrain.OverlayManager")],bc);let aqt=class{constructor(){this.inner=fi(),this.outer=fi(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=e7e}};const Nx=li(),Xj=I(),Nm=new aqt,oqt=fi(),lqt=fi(),cqt=$n();let uqt=class{constructor(){this.sinLonLUT=new Array(fk+1),this.cosLonLUT=new Array(fk+1),this.sinLatLUT=new Array(fk+1),this.cosLatLUT=new Array(fk+1)}update(e,i,r){const s=i[0],n=i[2];for(let a=0;a<=e;a++){const o=a/e,l=s*(1-o)+n*o;this.sinLonLUT[a]=Math.sin(l),this.cosLonLUT[a]=Math.cos(l);const u=r(o);this.sinLatLUT[a]=Math.sin(u),this.cosLatLUT[a]=Math.cos(u)}}},hqt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}};function dqt(t){return t<=Hc?new Array(t):new Int16Array(t)}function h$(t,e,i,r,s,n=2){const a=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),o=i*a,l=r*a,u=s<=0?(o>=0?1:-1)*(1-Math.abs(l)):o,d=s<=0?(l>=0?1:-1)*(1-Math.abs(o)):l,f=e*n;t[f]=XMe(u),t[f+1]=XMe(d)}function WTi(t){const e=t.length/3,i=dqt(2*e);let r=0;for(let s=0;s<e;++s)h$(i,s,t[r++],t[r++],t[r++]);return i}function ZTi(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=I();for(let a=0;a<i;++a)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],Ql(n,n,e),h$(r,a,n[0],n[1],n[2]);return r}function pqt(t,e,i,r=2){const s=i*r,n=KMe(e[s]),a=KMe(e[s+1]),o=1-Math.abs(n)-Math.abs(a);return t[2]=o,o<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(a)),t[1]=(a>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=a),Re(t,t)}function XMe(t){return Ce(Math.round(32767*t),-32767,32767)}function KMe(t){return Ce(t/32767,-1,1)}let fqt=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=Wu(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=Lr(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,Wu(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),$e(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;pqt(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,a,o){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,a,o)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,a,o,l,u,d){const f=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(f,r,s,n),this._setUV(f,a,o),this._setNormal(f,l,u,d)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:a}=this.vertexAttributes.normalCompressed;h$(n,e,i,r,s,a)}_setUV(e,i,r){this.vertexAttributes.uv0.setValues(e,Math.round(i*Xn),Math.round(r*Xn))}getEdgeAttributeIndex(e,i){return He(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};var y0;let mqt=(y0=class{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Pe(this._current),this._next=Pe(this._next),this._waiting=Pe(this._waiting),this._delayed=Pe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){let i=null;this._delayed?(i=this._delayed,this._delayed=null):this._waiting?(i=this._waiting,this._waiting=null):this._next&&(i=this._next,this._next=null),i&&(this.clear(),this._current=i)}let e=y0.test.fadeMoment;if(this._delayed&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null)),this._next){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==0,n=e-this._fadeStart>=i;(r||s||n)&&(Pe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=y0.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=0){this._delayed=Pe(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=y0.test.fadeMoment||performance.now();return i!==0?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Pe(this._waiting),this._waiting=e))}get _fadeDuration(){const e=this._getFadeDuration();return this._waiting?.5*e:e}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}},y0.test={fadeMoment:0},y0),t8=class{constructor(e,i,r,s,n,a){this.texture=e,this.type=i,this.offsetAndScale=r,e.retain(),this.opacities=Ye(s,n,a)}destroy(){this.texture.release()}},gqt=class{constructor(){this._scales=$i(-1,-1,-1,-1),this._offsets=$i(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}},t7e=class{constructor(){this._queue=new Ai,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.leaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},yqt=class{constructor(){this._q=new Ai}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.leaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function BS(t,e){if(e==null||e.destroyed)return!1;const i=vqt(e);if(i?.fullExtent==null)return!1;const r=i.fullExtent,s=t.extent;if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,a=i.minScale;if(a>0&&n>1.00000001*a)return!1;const o=i.maxScale;return!(o>0&&n<.99999999*o)}function vqt(t){return tW(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale}:t.layer}function _qt(t){return!tW(t)&&t.layer&&"tilemapCache"in t.layer?t.layer.tilemapCache:null}function zg(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function i7e(t,e=null){return e==null||e.length===0?t.sort(bqt):t.sort((i,r)=>wqt(i,r,e))}function bqt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function r7e(t,e){const i=t.screenDepth,r=e.screenDepth;return i<r?-1:i>r?1:zg(t,e)}function wqt(t,e,i){return e3e(t,i)===e3e(e,i)?r7e(t,e):t?1:-1}function e3e(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function xqt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function Sqt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(xqt)}function Tqt(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function $qt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function e$i(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let Cqt=class{constructor(){this.geometry=new fqt,this.geometryState=null,this._texture=null,this._textureOpacity=1,this._textureRef=new mqt(()=>this._tile.surface.fadeDuration),this.overlay=new gqt,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new hqt,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Ta&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)He(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const l=r.surface.extent;if(l!=null&&(e===0&&r.extent[3]>l[3]||e===1&&r.extent[2]>l[2]||e===2&&r.extent[1]<l[1]||e===3&&r.extent[0]<l[0]))return s}const n=r.level,a=Yf[e];if(!i)return He(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(a)),s;if(i.loaded){const l=i,u=l.renderData.geometryState,d=n-l.level;if(He(d>=0),d===0){const v=u.numVerticesPerSide-1;return Math.max(v,s)}const f=2**d,g=u.edgeResolutions[(e+2)%4]/f;return Math.max(1,g)}He(!i.leaf);let o=s;return i.forAllSubtreeOnSide(nfe(a),l=>l===r||(l.loaded?(o=Math.max(o,2**(l.level-n)),!0):(He(!l.leaf),!1))),o}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=a=>(a.loaded||a.level===e.level)&&a?.intersectsClippingArea,s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const o=e.findNeighborTile(Yf[a],r),l=X2(e,o),u=l?.renderData?.geometryState.samplerDataVersion??-1,d=s[a],f=l!==X2(e,d),g=n[a]!==u;Ta&&o&&(He(e.level>=o.level),He(e.level-o.level<=Zn)),s[a]=o,(f||g)&&(n[a]=u,this._markEdgeDirty(a));const v=i.edgeResolutions[a],_=this._calculateEdgeResolution(a,o);He(qT(_)),He(_>=1),i.edgeResolutions[a]=_,v!==_&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const o=e.findNeighborTile(KG[a],r);i.cornerPeerNeighbors[a]=o;const l=X2(e,s[a]),u=X2(e,s[(a+1)%4]),d=X2(e,o);rf[a]=d,rf[(a+1)%4]=u,rf[(a+2)%4]=e,rf[(a+3)%4]=l,He(rf.some(_=>_?.loaded||_===e));const f=rf.reduce((_,x)=>Math.min(_,x?.level??1/0),1/0);rf.forEach((_,x)=>{_&&_?.level>f&&(rf[x]=null)}),He(rf.some(_=>_?.loaded||_===e));const g=i.cornerNeighborCornerTiles,v=i.cornerNeighborCornerTileSamplerVersions;for(let _=0;_<4;++_){const x=rf[_],S=x?.renderData.geometryState.samplerDataVersion??-1,T=4*a+_,M=g[T]!==x,E=!M&&v[T]!==S;(M||E)&&(g[T]=x,v[T]=S,this._markCornerDirty(a))}Ta&&He(yfe.some(_=>g[4*a+_]?.loaded||g[4*a+_]===e))}Ta&&He(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)rf[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Ta&&He(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(v=>v>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,a=!r||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,o=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((v,_)=>v+_+1,0),u=a||o&&l>(s?.maxEdgeVertexCount??0),d=!u&&o,f=!d&&(this.dirtyEdges!==0||o),g=!f&&this.dirtyCorners!==0;u?(this.releaseGeometry(),this._createGeometry(e)):d?i.updateEdgeElevationsAndResolutions():f||g?i.updateEdgeElevations():g?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=jt(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r,s){const n=i?6408:6407;return this._texture!=null&&(r===0&&this._tile.surface.fadeDuration>0&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==e||this._texture.descriptor.pixelFormat!==n)&&this.releaseTexture(),this._texture==null&&(this._texture=s(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture&&(this._texture=Lr(this._texture),this.tile.setMemoryDirty())}reuseTexture(e,i){return!(!e||!this._texture)&&(e.setTextureReference(new t8(this._texture,0,i,this._textureOpacity,0,1)),!0)}get numVerticesPerSideChanged(){return(this._modifiedFlags&Eqt)!==0}get samplerDataChanged(){return(this._modifiedFlags&Aqt)!==0}get clippingAreaChanged(){return(this._modifiedFlags&Oqt)!==0}get wireframeChanged(){return(this._modifiedFlags&Pqt)!==0}get dirtyEdges(){return this._modifiedFlags>>_K&15}get dirtyCorners(){return this._modifiedFlags>>bK&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>wK&15}_markCornerDirty(e){const i=1<<e<<bK;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<_K;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<wK;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<bK|15<<_K|15<<wK}updateGeometryState(){const e=this._elevationInfo,i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.minimumVerticesPerSide,s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.withinClippingArea||(n=null);const a=this.geometryState;let o=!1;a.numVerticesPerSide!==s&&(this._modifiedFlags|=1,a.numVerticesPerSide=s,a.samplerDataVersion++,o=!0),e.changed&&(this._modifiedFlags|=2,a.samplerData=e.samplerData,a.samplerDataVersion++,o=!0),E0(a.clippingArea,n)||(this._modifiedFlags=4,a.clippingArea=n,o=!0);const l=i.surface.wireframe;return a.wireframe!==l&&(this._modifiedFlags=8,a.wireframe=l,o=!0),this._geometryStateChangedSinceLastUpdate||=o,o&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const{vertexAttributes:i,indices:r}=this.geometry,s=e.gl;this._vao=new bm(e,new vn(e,bl(i.layout),i.buffer),id.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=0){e?.texture===this._texture?this._textureOpacity=e.opacities[0]:this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(e){return this._textureRef.current?.texture===e||this._textureRef.next?.texture===e&&this._textureRef.fadeFactor<1}get _elevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[0],r=i.length,s=new Array(r);let n=0,a=0,o=!1;for(let d=0;d<r;d++){const f=i[d],g=f.upsampleInfo?.tile;if(g){const v=g.layerInfo[0][d].data,_=v&&v.samplerData;e&&e[n]===_||(o=!0),s[n++]=_,a=Math.max(a,g.lij[0])}else if(f.data){const v=this.tile.surface.layerViewByIndex(d,0);if(BS(this.tile,v)){const _=f.data;e&&e[n]===_.samplerData||(o=!0),s[n++]=_.samplerData,a=this.tile.level}}}e!=null&&e.length!==n&&(o=!0);const l=n>0,u=l?s:null;return l&&(s.length=n),{changed:o,samplerData:u,maxTileLevel:a}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Ta)return;const e=this.tile;if(!e.loaded||!e.intersectsClippingArea||e.level===0)return void He(e?.loaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=Yf.map((o,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;He(this.dirtyCorners===0),He(this.dirtyEdges===0),He(this.dirtyEdgeResolutions===0),He(!this.numVerticesPerSideChanged),He(!this.samplerDataChanged),He(!this.clippingAreaChanged),He(!this.wireframeChanged);const n=KG.map(o=>e.findNeighborCornerTileExact(o,l=>!l.intersectsClippingArea||l.loaded||l.level===e.level)??null).map(o=>o?.intersectsClippingArea?o:null),a=this.geometryState;for(let o=0;o<4;++o){const l=a.cornerPeerNeighbors[o],u=n[o];He(u===l,`Tile[${e.lij}].corner[${o}] out of date: cur=[${l?.lij}] exp=[${u?.lij}]`)}Yf.forEach((o,l)=>{if(r[l])return;const u=e.findNeighborTile(o,G=>(G.level===s||G?.loaded)&&G?.intersectsClippingArea);if(!u){const G=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(o);return void He(!G)}He(u.loaded||u.level===e.level),He(u===this.geometryState.edgePeerNeighbors[l]);const d=s-u.level;if(!u.loaded)return He(!u.leaf),void He(d===0);const f=u.renderData;He(e.isEdgeNeighbor(u,o)),He(d>=0);const g=2**d;if(d<0)return void He(!1);const v=e.renderData,_=v.geometry,x=v.localOrigin,S=_.getEdgeCount(l),T=_.numVerticesPerSide-1,M=f.geometry;if(!M)return void He(!1);const E=f.localOrigin,P=this.geometryState.edgePeerNeighbors[l];if(P?.loaded){const G=P.renderData;He(v.geometryState.edgePeerNeighborSamplerVersions[l]===G.geometryState.samplerDataVersion),He(this.geometryState.edgePeerNeighborSamplerVersions[l]===G.geometryState.samplerDataVersion)}const O=(l+2)%4,D=M.getEdgeCount(O),L=S-1,F=D-1;He(L*g===F,`Tile[${e.lij}]:e${l},res=${L} edgeRes mismatch with Neighbor[${u.lij}]:e${O},res=${F} (expected:${L*g})`);const j=e.extent,N=o===0||o===4,B=D-1,U=B>>d,Q=S-1;if(U<1)return void He(Q===1);He(U===Q),He(qT(U));const H=M.numVerticesPerSide-1;He(d>0||U===Math.max(H,T));const J=e.getNeighborEdgeStartVertexIndex(l,u);He(0<=J&&J<g);const Z=J*U;He(0<=Z&&Z<=B-U);let K=0,ee=Z;_.getEdgeVertexPosition(l,Vm,x,0),_.getEdgeVertexPosition(l,jm,x,S-1);const _e=Bi(Vm,jm),Ne=Math.max(Mqt,1e-4*_e);for(let G=0;G<=U;++G){_.getEdgeVertexPosition(l,Vm,x,K),M.getEdgeVertexPosition(O,jm,E,ee);const le=G/U,de=N?j[0]+le*(j[2]-j[0]):o===6?j[0]:j[2],Se=N?o===4?j[1]:j[3]:j[1]+le*(j[3]-j[1]),je=e.surface.extent;if(je==null||gO(je,de,Se)){const Be=CF(Vm,jm),pt=Ph(Vm)-Ci.radius,Dt=Ph(jm)-Ci.radius,at=Be<Ne;if(!at){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${K}/${S}] and [${u.lij}].edge${O}[${ee}/${D}]`),je!=null&&console.warn("  surface extent= ",je," x,y=",de,",",Se);const Lt=I();Ae(Lt,v.localOrigin,f.localOrigin),Ph(Lt)>0&&console.warn(`   localOrigins: ${v.localOrigin} vs ${f.localOrigin} d=${Ph(Lt)} [${Lt}]`),(()=>{const Wt=Tr(Vm),Ze=Tr(jm);e.updateEdgeElevations(),u.updateEdgeElevations(),_.getEdgeVertexPosition(l,Vm,x,K),M.getEdgeVertexPosition(O,jm,E,ee);const We=I();xi(We,Vm,Wt),Ph(We)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Wt} vs ${Vm} d=${Ph(We)} [${We}]`),xi(We,jm,Ze),Ph(We)>0&&console.warn(`  XXX Neighbor[${u.lij}] edge out of date: ${Ze} vs ${jm} d=${Ph(We)} [${We}]`)})();const Xt=_.getEdgeCount(l),Ge=M.getEdgeCount(D);He(at,`Mismatch in tile [${e.lij}].edge[${l}][${K}/${Xt}] vs neighbor [${u.lij}].edge[${O}][${ee}/${Ge}] ${Uy(Vm)} vs ${Uy(jm)}  dist=${Be} h(t|n|d)=${pt}|${Dt}|${Dt-pt}`)}_.getEdgeNormal(l,dM,K),M.getEdgeNormal(O,pM,ee),Re(t3e,dM),Re(i3e,pM);const Bt=Le(t3e,i3e),kt=1-Bt<.01||!1||e===u;if(!kt){const Lt=I();xi(Lt,dM,pM);const Xt=()=>`Mismatch in tile edge normal ${nMe(e.lij)} (${K}/${S-1}) edge ${l} vs neighbor ${nMe(u.lij)}  (${ee}/${D-1}) nedge ${O} :${Uy(dM)} vs ${Uy(pM)}  dot = ${Bt} : ${Uy(Lt)}`;console.warn("Mismatch in tile edge normal: ",Xt());{e.updateEdgeElevations(),u.updateEdgeElevations();const Ge=I(),Wt=I();_.getEdgeNormal(l,Ge,K),M.getEdgeNormal(O,Wt,ee),m1(dM,Ge)||console.warn("Missing update in tile normal: ",Uy(dM)," => ",Uy(Ge)),m1(pM,Wt)||console.warn("Missing update in neighbor normal: ",Uy(pM)," => ",Uy(Wt))}He(kt,Xt())}}K+=1,ee+=1}})}};const Vm=I(),jm=I(),dM=I(),pM=I(),t3e=I(),i3e=I(),Mqt=1,rf=[null,null,null,null];function X2(t,e){return e?.loaded||e===t?e:null}const Eqt=1,Aqt=2,Oqt=4,Pqt=8,_K=4,bK=8,wK=12,yfe=[0,1,2,3];let vfe=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,0,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),{minLevel:s,maxLevel:n}=r.dataLevelRange,a=this._desiredMinLevelDelta,o=this._progressiveLevelModulo+a,l=this._scaleRangeEnabled?BS:()=>!0;let u=this.tile;const d=u.level;let f;const g=this._tileLayerInfo.upsampleInfo,v=g?.tile?.level??-1,_=g!=null&&v-d>=a,x=_qt(r),S=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;u&&l(u,r)&&u.level>=s;){const T=u.level,M=d-T,E=u.layerInfo[i][e];if(E.data&&M>=a){(!_||T>v)&&this._setUpsampleTile(u),E.dataInvalidated&&(f=u);break}const P=S?.getLevelRowColumn(u.lij)??u.lij;if(x?.getAvailability(P[0],P[1],P[2])!=="unavailable"&&T<=n&&!E.data&&!E.dataMissing&&((!f||u.level===s||T%dUe===0||d-f.level<a)&&(f=u),M>=o))break;u=u.parent}if(f!=null&&d-f.level<a)if(g)f=null;else{const T=this._findAncestorWithData();T!=null&&(this._setUpsampleTile(T),f=T.layerInfo[i][e].dataInvalidated?T:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,0,i)}get test(){}},Rqt=class extends vfe{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw r3e}get _progressiveLevelModulo(){throw r3e}dispose(){}};const r3e=new Error("Abstract method called on TileAgent"),cu=new Rqt;let Iqt=class extends vfe{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function Dqt(t){return t.type==="elevation"}let kqt=class{constructor(e){this.tile=e}get usedMemory(){return this.tile.mapDataMemory}},Lqt=class extends vfe{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return dUe}};function Fqt(t){return t.type==="map"}let i8=class{constructor(){this.waitingAgents=new Ai,this.pendingUpdates=0}static acquire(e){const i=r8.acquire();return i._init(e),i}release(){this.dispose(),l5.delete(this),r8.release(this)}dispose(){this.loadingAgent=jt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=mA(this._data)}static prune(){r8.prune(0)}_init(e){this.waitingAgents.clear(),this._data=mA(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Rs(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){this.upsampleInfo&&(this.upsampleInfo.tile?.unrefMapData(),this._pool.release(this.upsampleInfo),this.upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this.upsampleInfo==null)this.upsampleInfo=this._pool.acquire();else{if(this.upsampleInfo.tile===i)return;this.upsampleInfo.tile?.unrefMapData()}i.refMapData(),Tqt(e,i,this.upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){mA(this._data),this._data=e}};const r8=new Wc(()=>new i8,null,()=>{}),l5=new Map;function zqt(){l5.size>0&&(console.log(`${l5.size} live TilePerLayerInfo allocations:`),l5.forEach(t=>console.log(t,`
`)))}function Nqt(){r8.prune(),l5.clear()}const Vqt=.1;let _fe=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=fi(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=fi(),this.centerAtSeaLevel=I(),this._center=[I(),Is(),I()],this.up=Hce(),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=0,this._rasterTileMemory=0,this._vectorTileMemory=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.onCompressionFinished=()=>{this.setPendingUpdate(16),this.setMemoryDirty()},this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=I(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get spatialReference(){return this._surface.spatialReference??this._surface.tilingScheme.spatialReference}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){bfe.prune(0),wfe.prune(0),i8.prune()}get _cached(){return!this.leaf&&this._mapDataRefCount<=0}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[1][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=e?.frustumVisibility??1;this._frustumVisibility=i===0?0:i===2?2:this._calculateFrustumVisibility(this.surface.frustum);const r=this._frustumVisibility!==2&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get _loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=xr(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[1][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.clearChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const a of U3){const o=n.numLayers(a),l=this.layerInfo[a];for(const u of l)u.release();l.length=o;for(let u=0;u<o;u++)l[u]=i8.acquire(this._surface.upsampleInfoPool),a===0&&this.findElevationBoundsForLayer(u,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,fk)}dispose(){Ba(!this.renderData,"tile.renderData was not unloaded"),this._surface?.upsampleMapCache.pop(this.key),this.layerInfo.forEach(e=>{e.forEach(i=>i.release()),e.length=0}),this._surface=this._parent=null,this.clearChildren(),this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount,this._cached&&this.cachedMemory>0&&this._surface.upsampleMapCache.put(this.key,new kqt(this))}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this.mapDataMemory)}get cachedMemory(){return this._ensureUsedMemory(),this._surface==null?this.usedMemory:this._cached?this.mapDataMemory:0}get mapDataMemory(){return this._rasterTileMemory+this._vectorTileMemory}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory>0)return this._vectorTileMemory=this.layerInfo[1].reduce((e,{data:i})=>e+(N3(i)?i.usedMemoryPerReference:0),0),this._usedMemory;this._usedMemory=this._baseUsedMemory,this._rasterTileMemory=0,this._vectorTileMemory=0;for(const{data:e}of this.layerInfo[1])N3(e)?this._vectorTileMemory+=e.usedMemoryPerReference:this._rasterTileMemory+=this.getTerrainDataMemory(e);for(const e of this.layerInfo[0])this._usedMemory+=e.data?this._cpuImageMemorySize:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=this.renderData.texture?.usedMemory??0),this._cached&&this._surface.upsampleMapCache.updateSize(this.key),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r?.data?e===1?this._cached?0:this.getTerrainDataMemory(r.data):e===0?this._cpuImageMemorySize:0:0}getTerrainDataMemory(e){return JGe(e)?e.texture.usedMemory:YGe(e)?e.memoryUsage:N3(e)?e.usedMemoryPerReference:XH(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[1],r=e,s=i[0],n=i[1],a=i[2],o=r[2]*s+r[6]*n+r[10]*a+r[14];this.screenDepth=o<0?0:o/(r[3]*s+r[7]*n+r[11]*a+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibility(e.frustum)===2))return 0;const s=this.level;Ae(e6,Li(this._center[1]),i);let n=ea(e6),a=e6,o=q0(this._center[1],I());Ae(xK,this._center[0],i);const l=ea(xK);l<n&&(n=l,a=xK,o=this._center[0]),Ae(SK,this._center[2],i);const u=ea(SK);if(u<n&&(n=u,a=SK,o=this._center[2]),this._edgeLen2>n&&s<e.maxLod)return 1;const d=Math.sqrt(n),f=e.fovX*d*2,g=this._edgeLen/f,v=()=>{if(s<e.maxLod)return this.elevationLevel=s,0;const L=s+Math.ceil(-Math.log2(e.relativeWidthLimit/g));return L!==this.elevationLevel?(this.elevationLevel=L,2):0},_=r!=null?r-s:1/0;if(_<=.5)return v();const x=Le(this.up,e6),S=this._elevationBoundsMax-this._elevationBoundsMin,T=S/this.edgeLen;if(e.aboveGround&&x>0&&T<.001&&x/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-T>0)return 0;const M=r!=null?3-Math.min(_,2):1;if(g*M<e.relativeWidthLimit||s>=e.maxLod)return v();if(s<7)return 1;he(uo,this.up,x),Ae(uo,uo,a);const E=ea(uo);if(E<=this.radius*this.radius)return 1;he(uo,uo,this.radius/Math.sqrt(E)),$e(uo,uo,o),Ae(uo,i,uo);const P=Math.min(1,(Math.abs(Le(uo,this.up))+.5*S+this._curvatureHeight)/Ve(uo)),O=Vqt/e.angledSplitBias,D=e.fovY*d*2;return P*(this._edgeLen/D*M)<O*e.relativeHeightLimit?0:1}createChildren(){const e=this._children,i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e[0]=this.surface.createTile(i,r,s,this),e[1]=this.surface.createTile(i,r,s+1,this),e[2]=this.surface.createTile(i,r+1,s,this),e[3]=this.surface.createTile(i,r+1,s+1,this),e}clearChildren(){this._children[0]=this._children[1]=this._children[2]=this._children[3]=null}get loaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of U3)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(){this.renderData&&this.unrefMapData(),this.surface.renderer.unloadTile(this);for(const e of U3){const i=this.layerInfo[e];for(const r of i)r.loadingAgent&&r.loadingAgent!==cu&&(Kj(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0}this.resetPendingUpdate(8),this.resetPendingUpdate(16),this.resetPendingUpdate(32)}unloadMapData(){const e=this.layerInfo[1];for(const i of e)i.loadingAgent&&i.loadingAgent!==cu&&(Kj(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0,i.invalidateSourceData();this.renderData?.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(MS(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._withinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._withinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._withinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._withinClippingArea,n=!(r||i||this._withinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(8),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of U3){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==cu&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(1)||e!==0&&!this._loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===1||e===4?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const o=N3(s.data);return r.dataArrived(this,o),!0}if(s.requestPromise)return!0;Rs(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const a=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(a,a),!0}get leaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return ea(Ae(uo,Li(this._center[1]),e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,a=n.removeUnordered(r)!=null;Ba(a,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=N3(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(a=>a.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case 1:return this._updateTexture(i);case 0:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===0?16:32),this.setPendingUpdate(e===0?32:16))}_updateGeometry(){this.setPendingUpdate(8);for(const e of this.layerInfo[0])e.pendingUpdates|=8}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[0];let a=!0;for(const o of n)o.elevationBounds!=null&&(r=Math.min(r,o.elevationBounds.min),s=Math.max(s,o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(a=!1));a&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;he(uo,this.up,r),OP(s[1],$e(qqt,this.centerAtSeaLevel,uo)),he(uo,this.up,e),$e(s[0],this.centerAtSeaLevel,uo),he(uo,this.up,i),$e(s[2],this.centerAtSeaLevel,uo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[0][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),a=r.elevationBounds;if(a!=null&&a.level>=i&&a.level<=n)return;const o=this._surface.layerViewByIndex(e,0);if(!BS(this,o))return;const l=Uqt;let u=!1;const d=r.data;if(d&&d.level<=n){const f=r.data;l.min=f.samplerData.data.minValue,l.max=f.samplerData.data.maxValue,l.hasNoDataValues=f.samplerData.data.hasNoDataValues,l.level=this.level,u=!0}else{let f,g,v=0;for(let _=this._parent;_&&(!g||v<s)&&(v=this.elevationLevel-_.level,f=g||f,g=_.layerInfo[0][e].data,!(!g&&f&&_.level<=n));_=_.parent);g=g||f,g&&(g.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],l),l.min!==1/0&&(l.level=g.level,u=!0))}u&&(r.elevationBounds==null&&(r.elevationBounds=new OE),r.elevationBounds.copyFrom(l))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const o of s)o.loadingAgent&&o.loadingAgent!==cu&&(Kj(o.loadingAgent),o.loadingAgent=null),o.waitingAgents.clear();for(let o=0;o<s.length;++o)e[o]===void 0&&s[o].release();const n=new Array(...s),a=i.length;s.length=a;for(let o=0;o<a;o++){const l=i[o];s[o]=l>-1?n[l]:i8.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,0))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===cu&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of U3){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==cu&&(r.loadingAgent.setSuspension(i),r.loadingAgent===cu&&this.updateRenderData(e,0))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==cu&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=cu,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||MO(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){for(let s=e;s<i;++s){const n=this._surface.layerViewByIndex(s,r);if(wL(n)&&n?.layer?.blendMode!=="normal"||MO(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const a=r[n],o=this._surface.layerViewByIndex(n,i);let l=!1;if(a.loadingAgent?BS(this,o)?(a.loadingAgent!==cu&&a.loadingAgent.setSuspension(s),a.loadingAgent!==cu&&(l=a.loadingAgent.update())):a.dispose():BS(this,o)&&(a.loadingAgent=jqt(this,n,i,s),l=a.loadingAgent.startLoading(),l?a.loadingAgent===cu&&this.setPendingUpdate(8):(Kj(a.loadingAgent),a.loadingAgent=cu)),a.loadingAgent===cu&&this.updateRenderData(i,0),!o.destroyed&&!this._hasBlendModes(e,r.length,i)&&l&&o.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=Ce(1+(this._maxTesselation>>r),2,this._maxTesselation+1),n=this.minimumVerticesPerSide;return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(Bqt(s,e)){let n=s,a=e[0]-n.level-1;for(;a>=0&&!n.leaf&&!i(n);){const o=e[1]>>a&1,l=e[2]>>a&1;n=n.children[2*o+l],a--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this._getNeighborLIJ(r,e);return s?s8(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===1?1:e===7?0:e===5?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){return this.findNeighborTile(e,r=>i(r)||r.level===this.level)?.findCorner(XG(e),i)||null}forAllSubtreeOnSide(e,i){const r=e===0?[0,1]:e===1?[1]:e===2?[1,3]:e===3?[3]:e===4?[2,3]:e===5?[2]:e===6?[0,2]:[0],s=n=>{const a=n.children;!i(n)&&a[0]&&r.forEach(o=>s(a[o]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(He(!Ta||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),a=n?0:1,o=i.lij[a+1]*s,l=this._lij[a+1],u=l-o,d=n?s-1-u:u;return Ta&&(He(o<=l&&l<o+s),He(0<=d&&d<s)),d}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.loaded;Yf.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(nfe(s),a=>!!a.loaded&&(e(a,s),!0))}),KG.forEach(s=>{const n=this.findNeighborTile(s,r)?.findCorner(XG(s),a=>a.loaded);He(!n||doe(this,n,s)),n?.loaded&&e(n,s)})}_getNeighborLIJ(e,i){const r=cMe(i)?-1:lMe(i)?1:0,s=aMe(i)?-1:oMe(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this._wrapLIJ(n):n[2]<0?null:n}_wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}isEdgeNeighbor(e,i){if(e==null)return!1;if(this.level===0&&e.level===0&&(this._eastEnd&&e._westEnd&&i===2||this._westEnd&&e._eastEnd&&i===6))return!0;const r=Math.max(1e-6*(this.extent[2]-this.extent[0]),1);switch(i){case 0:return ap(this.extent[3],e.extent[1],r);case 4:return ap(this.extent[1],e.extent[3],r);case 2:return ap(this.extent[2],e.extent[0],r)||ap(this.extent[2],-e.extent[0],r);case 6:return ap(this.extent[0],e.extent[2],r)||ap(this.extent[0],-e.extent[2],r)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return this._lij[2]===0}checkGeometryWaterproofness(){JG&&(He(this.loaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(cMe(e)&&i[3]+s>=r[3]||lMe(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&aMe(e)&&i[0]-s<=r[0])&&!(!n&&oMe(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;me(this._lastPOI,e);const r=this._center[1],s=e[0]-r[0],n=e[1]-r[1],a=e[2]-r[2];this.distanceToPOI=s*s+n*n+a*a}updateOverlayParameters(e){const{renderData:i}=this;if(!i)return;const{overlays:r,longitudeCyclical:s}=e,n=i.overlay;if(r.length===0)this._clearTileOverlayData(0,n),this._clearTileOverlayData(1,n);else{const[a,o]=r,l=this.extent;knt(a.extent,l,s)||abe(l,a.extent,s)||abe(l,o.extent,s)?(this._setOverlayData(r,s,l,0,n),this._setOverlayData(r,s,l,1,n)):(this._clearTileOverlayData(0,n),this._clearTileOverlayData(1,n))}}_setOverlayData(e,i,r,s,n){const a=e[s].extent,o=So(a),l=Zl(a);let u=r[0];if(i){u=i.minimalMonotonic(a[0],u);const d=i.minimalMonotonic(a[0],r[2]);u>d&&(u=d-(r[2]-r[0]))}n.setScale(s,So(r)/o,Zl(r)/l),n.setOffset(s,(u-a[0])/o,(r[1]-a[1])/l)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}};function jqt(t,e,i,r){const s=i===0?wfe.acquire():bfe.acquire();return s.init(t,e,i,r),s}function Kj(t){t.dispose(),Dqt(t)?wfe.release(t):Fqt(t)&&bfe.release(t)}const bfe=new Wc(()=>new Lqt),wfe=new Wc(()=>new Iqt),Uqt=new OE;function Bqt(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function s8(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function doe(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?s3e(t,e,i):s3e(e,t,XG(i)))}function s3e(t,e,i){He(t.level>=e.level);const r=vBt(i),s=_Bt(i),n=t.extent,a=e.extent,o=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?a[2]:a[0],s?a[1]:a[3]],u=1e-5*(n[2]-n[0]),d=ap(o[0],l[0],u)||t.surface.isGlobal&&ap(o[0],-l[0],u),f=ap(o[1],l[1],u);if(d&&f)return!0;if(t.level===e.level||!d&&!f)return He(!1),!1;const g=d?n3e(a[1],a[3],n[1],n[3],u):n3e(a[0],a[2],n[0],n[2],u);return He(g),g}function n3e(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}const e6=I(),xK=I(),SK=I(),uo=I(),qqt=I(),Gqt=65536;function Hqt(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:a}=i,{isWebMercator:o,renderer:l}=a,{numVerticesPerSide:u,wireframe:d}=s,f=u-1,g=(u-2)**2,v=o&&(e===2||e===3),_=o&&(e===1||e===3),x=((v?1:0)+(_?1:0))*n8*u,S=v7e(s),T=g+x+4*S,M=l.tileGeometryCache.acquire(T);r.numVerticesPerSide=u,r.vertexAttributes=M,r.maxEdgeVertexCount=S;const{boundingBox:E}=r;Wu(E);const P=Sfe(t);yo.update(f,n,P),Zqt(t),r.poleVerticesStartIndex=g;const O=Wqt(t,v,_);r.edgeVerticesStartIndex=g+x,$fe(t),xfe(t),u7e(r,O,d),t.intersectionData=null}function Wqt(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:a,ellipsoid:o}=r,{boundingBox:l,numVerticesPerSide:u,vertexAttributes:d,poleVerticesStartIndex:f}=n,g=u-1,v=s[0],_=s[1],x=s[2],S=o.radius,T=a[1],M=a[3],E=[];let P=f;const O=(D,L)=>{const F=L*u;vp(-v,-_,D*S-x,l),E.push(new dGt(D===1,F,D===1?0:2,P,n8));const j=a7e(D===-1?T:M,S),N=D*Math.PI/2-j,B=.99*(D===1?1:-1),U=S+0,{position:Q,uv0:H}=d,{typedBuffer:J,typedBufferStride:Z}=d.normalCompressed;for(let K=1;K<=n8;++K){const ee=j+N*(K/n8),_e=Math.cos(ee),Ne=Math.sin(ee);for(let G=0;G<=g;G++){const le=G/g,de=yo.sinLonLUT[G],Se=yo.cosLonLUT[G]*_e,je=de*_e,Be=Ne,pt=Se*U-v,Dt=je*U-_,at=Be*U-x;vp(pt,Dt,at,l),Q.setValues(P,pt,Dt,at),H.setValues(P,Math.round(le*Xn),Math.round(B*Xn)),h$(J,P,Se,je,Be,Z),++P}}};return e&&O(-1,0),i&&O(1,g),E}function Zqt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:a}=r,o=n-2,l=n-1,{vertexAttributes:u,boundingBox:d}=i,{position:f,uv0:g}=u,{typedBuffer:v,typedBufferStride:_}=u.normalCompressed,{extent:x}=e,S=x[0],T=x[2],M=x[1],E=x[3],P=e.ellipsoid.radius,O=s[0],D=s[1],L=s[2],F=f.typedBuffer,j=f.typedBufferStride,N=1/l;let B=0;if(1<=o){const U=N,Q=M*(1-U)+E*U,H=yo.sinLatLUT[1],J=yo.cosLatLUT[1];for(let Z=1;Z<=o;Z++){const K=Z*N,ee=S*(1-K)+T*K,_e=yo.sinLonLUT[Z],Ne=yo.cosLonLUT[Z],G=P+Ms(ee,Q,a),le=G*Ne*J-O,de=G*_e*J-D,Se=G*H-L;vp(le,de,Se,d);const je=(Z-1)*j;F[je]=le,F[je+1]=de,F[je+2]=Se,g.setValues(Z-1,Math.round(K*Xn),Math.round(U*Xn))}}for(let U=1;U<=o;U++){const Q=U*N,H=M*(1-Q)+E*Q,J=yo.sinLatLUT[U],Z=yo.cosLatLUT[U],K=U+1,ee=K*N,_e=M*(1-ee)+E*ee,Ne=yo.sinLatLUT[K],G=yo.cosLatLUT[K],le=yo.sinLonLUT[0],de=yo.cosLonLUT[0],Se=P+Ms(S,H,a);let je=de*Z*Se-O,Be=le*Z*Se-D,pt=J*Se-L;const Dt=B*j;let at=F[Dt],Bt=F[Dt+1],kt=F[Dt+2];for(let Lt=1;Lt<=o;Lt++){const Xt=Lt*N,Ge=S*(1-Xt)+T*Xt,Wt=yo.sinLonLUT[Lt],Ze=yo.cosLonLUT[Lt];let We=0,St=0,vt=0;if(Lt<o){const Vi=(B+1)*j;We=F[Vi],St=F[Vi+1],vt=F[Vi+2]}else{const Vi=yo.sinLonLUT[l],Vr=yo.cosLonLUT[l],is=P+Ms(T,H,a);We=Vr*Z*is-O,St=Vi*Z*is-D,vt=J*is-L}const Nt=je,tt=Be,Qe=pt;je=at,Be=Bt,pt=kt,at=We,Bt=St,kt=vt;const et=We-Nt,ht=St-tt,ri=vt-Qe;let Wi=0,zi=0,ci=0;if(U>1){const Vi=(B-o)*j;Wi=F[Vi],zi=F[Vi+1],ci=F[Vi+2]}else{const Vi=yo.sinLatLUT[0],Vr=yo.cosLatLUT[0],is=P+Ms(Ge,M,a);Wi=Ze*Vr*is-O,zi=Wt*Vr*is-D,ci=Vi*is-L}const or=P+Ms(Ge,_e,a),tr=Ze*G*or-O,Mi=Wt*G*or-D,Ei=Ne*or-L;if(U<o){const Vi=B+o,Vr=Vi*j;F[Vr]=tr,F[Vr+1]=Mi,F[Vr+2]=Ei,vp(tr,Mi,Ei,d),g.setValues(Vi,Math.round(Xt*Xn),Math.round(ee*Xn))}const ui=Wi-tr,Ot=zi-Mi,Zt=ci-Ei;let Jt=Ze*Z,Ni=Wt*Z,Nr=J;Nr*Nr<.999&&(Jt=ri*Ot-ht*Zt,Ni=et*Zt-ri*ui,Nr=ht*ui-et*Ot);const ir=1/Math.sqrt(Jt*Jt+Ni*Ni+Nr*Nr);h$(v,B,Jt*ir,Ni*ir,Nr*ir,_),++B}}}function Yqt(t){t.tile.intersectsClippingArea&&(xfe(t),jP(t),t.intersectionData=null)}function Jqt(t){t.tile.intersectsClippingArea&&(p7e(t),xfe(t),jP(t),g7e(t),t.intersectionData=null)}function Qqt(t){t.tile.intersectsClippingArea&&(n7e(t),s7e(t,!0),jP(t),t.intersectionData=null)}function xfe(t){t.tile.intersectsClippingArea&&(n7e(t),s7e(t))}function s7e(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:a,extent:o,extentInRadians:l,ellipsoid:u}=s,d=u.radius,f=l[0],g=l[2],v=l[1],_=l[3],{samplerData:x}=r,S=o[0],T=o[2],M=o[1],E=o[3],P=Sfe(t),{boundingBox:O,vertexAttributes:D}=i,L=n[0],F=n[1],j=n[2],{position:N,uv0:B}=D,U=N.typedBuffer,Q=N.typedBufferStride;for(let H=0;H<4;++H){const J=H===1||H===3,Z=r.edgeResolutions[H];He(qT(Z));const K=Z+1,ee=X2(s,r.edgePeerNeighbors[H]);if(y7e(s,ee,H)){f7e(t,H,ee);continue}const _e=ee!=null;He(!_e||ee.level===s.level),He(!_e||zg(s,ee)<=0);const Ne=ee?.renderData,G=Ne?.geometryState;if(Ta){const et=s.surface;if(!ee&&et&&!et.updatingRootTiles){const ht=Yf[H],ri=s.findNeighborTile(ht,Wi=>Wi.loaded||Wi.leaf||Wi.level===s.level);ri?ri.intersectsClippingArea&&(He(!ri.loaded),He(!ri.leaf),He(ri.level===a)):He(et?.rootTiles==null||!s.shouldHaveNeighbor(ht))}}const le=H===1?o[2]:o[0],de=ee?.extent,Se=de&&J?H===1?de[0]:de[2]:le,je=H===0?o[3]:o[1],Be=H===1?1:0,pt=H===0?1:0,Dt=H===1?g:f,at=H===0?_:v,Bt=Math.sin(Dt),kt=Math.cos(Dt),Lt=Math.sin(at),Xt=Math.cos(at),Ge=G?.samplerData,Wt=_e?(et,ht,ri)=>.5*(Ms(et,ht,x)+Ms(ri,ht,Ge)):(et,ht,ri)=>Ms(et,ht,x),Ze=i.outerEdgesOffsetAndLength[2*H+0],We=e&&K>3?K-3:1,St=x!=null&&x.some(et=>et!=null),vt=Ge!=null&&Ge.some(et=>et!=null),Nt=St||vt,tt=1/Z,Qe=Ze;He(!de||ap(de[2]-de[0],o[2]-o[0])),(()=>{const et=H===1?-1:H===3?1:0,ht=H===0?-1:H===2?1:0,ri=(o[2]-o[0])*tt,Wi=et*ri,zi=ht*ri,ci=J?et*((g-f)*tt):0,or=J?0:ht*tt,tr=pt,Mi=J?Dt+ci:Dt,Ei=J?Math.sin(Mi):Bt,ui=J?Math.cos(Mi):kt,Ot=J?Dt-ci:Dt,Zt=J?Math.sin(Ot):Bt,Jt=J?Math.cos(Ot):kt,Ni=J?at:P(tr+or),Nr=J?Lt:Math.sin(Ni),ir=J?Xt:Math.cos(Ni),Vi=J?at:P(tr-or),Vr=J?Lt:Math.sin(Vi),is=J?Xt:Math.cos(Vi);let Ds=0,Ra=0,En=0;{const ai=0*tt,rs=J?le:S*(1-ai)+T*ai,lr=J?Se:rs,Us=J?M*(1-ai)+E*ai:je,it=J?Dt:f*(1-ai)+g*ai,Oo=J?Bt:Math.sin(it),Ko=J?kt:Math.cos(it),gr=J?P(ai):at,Ia=J?Math.sin(gr):Lt,rn=J?Math.cos(gr):Xt,Oi=d+Wt(rs,Us,lr);Ds=Ko*rn*Oi,Ra=Oo*rn*Oi,En=Ia*Oi}let Xo=0,pe=0,hi=0;{const ai=1*tt,rs=J?le:S*(1-ai)+T*ai,lr=J?Se:rs,Us=J?M*(1-ai)+E*ai:je,it=J?Dt:f*(1-ai)+g*ai,Oo=J?Bt:Math.sin(it),Ko=J?kt:Math.cos(it),gr=J?P(ai):at,Ia=J?Math.sin(gr):Lt,rn=J?Math.cos(gr):Xt,Oi=d+Wt(rs,Us,lr);Xo=Ko*rn*Oi,pe=Oo*rn*Oi,hi=Ia*Oi}for(let ai=1;ai<K-1;ai+=We){let rs=0,lr=0,Us=0;{const rr=(ai+1)*tt,oo=J?le:S*(1-rr)+T*rr,ss=J?Se:oo,aa=J?M*(1-rr)+E*rr:je,Xu=J?Dt:f*(1-rr)+g*rr,$l=J?Bt:Math.sin(Xu),oc=J?kt:Math.cos(Xu),Fp=J?P(rr):at,Da=J?Math.sin(Fp):Lt,xm=J?Math.cos(Fp):Xt,Sm=d+Wt(oo,aa,ss);rs=oc*xm*Sm,lr=$l*xm*Sm,Us=Da*Sm}const it=rs,Oo=lr,Ko=Us,gr=Xo,Ia=pe,rn=hi;Xo=it,pe=Oo,hi=Ko;{const rr=Qe+ai,oo=rr*Q,ss=gr-L,aa=Ia-F,Xu=rn-j;U[oo]=ss,U[oo+1]=aa,U[oo+2]=Xu,vp(ss,aa,Xu,O);const $l=ai*tt,oc=J?Be:$l,Fp=J?$l:pt;B.setValues(rr,Math.round(oc*Xn),Math.round(Fp*Xn))}const Oi=Ds,ao=Ra,kp=En;Ds=gr,Ra=Ia,En=rn;const Kt=gr,oy=Ia,Lp=rn,ly=1/Math.sqrt(Kt*Kt+oy*oy+Lp*Lp),wm=Lp*ly;let Xc=0,ac=0,el=0;if(Nt&&wm*wm<.999){let rr=0,oo=0,ss=0;{const aa=H===0?-1:1;rr=aa*(it-Oi),oo=aa*(Oo-ao),ss=aa*(Ko-kp)}{const aa=ai*tt,Xu=J?le:S*(1-aa)+T*aa,$l=J?Se:Xu,oc=J?M*(1-aa)+E*aa:je,Fp=J?Dt:f*(1-aa)+g*aa,Da=J?Bt:Math.sin(Fp),xm=J?kt:Math.cos(Fp),Sm=J?P(aa):at,zp=J?Math.sin(Sm):Lt,Tm=J?Math.cos(Sm):Xt;let Y=Kt,fe=oy,qe=Lp;if(_e){const Vt=d+Ms($l-Wi,oc-zi,Ge),Zi=J?Tm:is;Y=(J?Jt:xm)*Zi*Vt,fe=(J?Zt:Da)*Zi*Vt,qe=(J?zp:Vr)*Vt}{const Vt=d+Ms(Xu+Wi,oc+zi,x),Zi=J?Tm:ir,bs=(J?ui:xm)*Zi*Vt,ks=(J?Ei:Da)*Zi*Vt,oa=(J?zp:Nr)*Vt;_e||(Y=2*Kt-bs,fe=2*oy-ks,qe=2*Lp-oa);const Cl=H===3?-1:1,z$=Cl*(Y-bs),WP=Cl*(fe-ks),N$=Cl*(qe-oa);Xc=ss*WP-oo*N$,ac=rr*N$-ss*z$,el=oo*z$-rr*WP;const $m=1/Math.sqrt(Xc*Xc+ac*ac+el*el);Xc*=$m,ac*=$m,el*=$m}}}else Xc=Kt*ly,ac=oy*ly,el=Lp*ly;i.setEdgeNormalFromValues(H,ai,Xc,ac,el)}})()}}function n7e(t){m7e(t)}function a7e(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function Xqt(t,e,i,r){return a7e(t*(1-r)+e*r,i)}function Kqt(t,e,i){return t*(1-i)+e*i}function Sfe(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>Xqt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>Kqt(i[1],i[3],r)}function eGt(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:a}=i,{wireframe:o}=r,l=n[0],u=n[1],d=n[2]-l,f=n[3]-u,{numVerticesPerSide:g,clippingArea:v}=r,_=v!=null?Math.max(0,(v[0]-l)/d):0,x=v!=null?Math.max(0,(v[1]-u)/f):0,S=v!=null?Math.min(1,(v[2]-l)/d):1,T=v!=null?Math.min(1,(v[3]-u)/f):1,M=(g-2)**2,E=v7e(r),P=M+4*E,O=a.renderer.tileGeometryCache.acquire(P),{boundingBox:D}=s;Wu(D),s.numVerticesPerSide=g,s.vertexAttributes=O,s.maxEdgeVertexCount=E,s.minu=_,s.minv=x,s.maxu=S,s.maxv=T,tGt(t),s.edgeVerticesStartIndex=M,$fe(t),Tfe(t),u7e(s,[],o),t.intersectionData=null}function tGt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:a,numVerticesPerSide:o}=r,{surface:l,extent:u,ellipsoid:d}=e,{isWebMercatorOnPlateCarree:f}=l,g=a??Cfe,v=u[0],_=u[1],x=u[2],S=u[3],T=Math.max(v,g[0]),M=Math.min(x,g[2]),E=Math.max(_,g[1]),P=Math.min(S,g[3]),O=d.radius,D=e.horizontalScale,L=o-1,F=o-2,{minu:j,minv:N,maxu:B,maxv:U,boundingBox:Q,vertexAttributes:H}=i,{position:J,uv0:Z}=H,{typedBuffer:K,typedBufferStride:ee}=H.normalCompressed,_e=s[0],Ne=s[1],G=s[2],le=J.typedBuffer,de=J.typedBufferStride;let Se=0;const je=Ce(_,E,P),Be=f?(Math.PI/2-2*Math.atan(Math.exp(-je/O)))*O:je*D,pt=1/L,Dt=Ce(_*(1-pt)+S*pt,E,P);let at=Be,Bt=f?(Math.PI/2-2*Math.atan(Math.exp(-Dt/O)))*O:Dt*D;for(let kt=1;kt<=F;kt++){const Lt=kt/L,Xt=Ce(_*(1-Lt)+S*Lt,E,P),Ge=Ce(Lt,N,U),Wt=Bt,Ze=(kt-1)/L,We=Ce(_*(1-Ze)+S*Ze,E,P),St=at,vt=(kt+1)/L,Nt=Ce(_*(1-vt)+S*vt,E,P),tt=f?(Math.PI/2-2*Math.atan(Math.exp(-Nt/O)))*O:Nt*D,Qe=Ce(vt,N,U);at=Bt,Bt=tt;const et=Ce(v,T,M);let ht=et*D,ri=Ms(et,Xt,n);const Wi=1/L,zi=Ce(Wi,j,B),ci=Ce(v*(1-zi)+x*zi,T,M);let or=zi,tr=ci,Mi=ci*D,Ei=Ms(ci,Xt,n);if(kt===1){const ui=Mi-_e,Ot=at-Ne,Zt=Ei-G,Jt=0*de;le[Jt]=ui,le[Jt+1]=Ot,le[Jt+2]=Zt,vp(ui,Ot,Zt,Q);const Ni=Ce(Wi,j,B);Z.setValues(Se,Math.round(Ni*Xn),Math.round(Ge*Xn))}for(let ui=1;ui<=F;ui++){const Ot=Mi,Zt=Ei,Jt=(ui+1)/L,Ni=Ce(Jt,j,B),Nr=Ce(v*(1-Jt)+x*Jt,T,M),ir=tr;tr=Nr;{const pe=Se+1,hi=pe*de;if(kt===1||ui===F){const ai=Nr*D,rs=Ms(Nr,Xt,n);if(kt===1&&ui<F){const lr=ai-_e,Us=Wt-Ne,it=rs-G;le[hi]=lr,le[hi+1]=Us,le[hi+2]=it,vp(lr,Us,it,Q),Z.setValues(pe,Math.round(Ni*Xn),Math.round(Ge*Xn))}Mi=ai,Ei=rs}else Mi=le[hi]+_e,Ei=le[hi+2]+G}const Vi=Mi,Vr=Ei,is=ht,Ds=ri;ht=Ot,ri=Zt;const Ra=(Se-F)*de,En=kt===1?Ms(ir,We,n):le[Ra+2]+G,Xo=Ms(ir,Nt,n);if(kt<F){const pe=Se+F,hi=pe*de,ai=Ot-_e,rs=tt-Ne,lr=Xo-G;le[hi]=ai,le[hi+1]=rs,le[hi+2]=lr,vp(ai,rs,lr,Q);const Us=or;or=Ni,Z.setValues(pe,Math.round(Us*Xn),Math.round(Qe*Xn))}{const pe=Vi-is,hi=St-tt,ai=hi*(Vr-Ds),rs=pe*(En-Xo),lr=-hi*pe,Us=ai*ai+rs*rs+lr*lr;if(Us===0)h$(K,Se,0,0,1,ee);else{const it=1/Math.sqrt(Us);h$(K,Se,ai*it,rs*it,lr*it,ee)}}++Se}}}function iGt(t,e){t.tile.intersectsClippingArea&&(l7e(t),o7e(t,!0),jP(t),t.intersectionData=null)}function rGt(t,e){t.tile.intersectsClippingArea&&(p7e(t),Tfe(t),jP(t),g7e(t),t.intersectionData=null)}function sGt(t,e){t.tile.intersectsClippingArea&&(Tfe(t),jP(t),t.intersectionData=null)}function Tfe(t,e){t.tile.intersectsClippingArea&&(l7e(t),o7e(t,!1))}function o7e(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:a,extent:o}=n,{clippingArea:l,samplerData:u}=r,d=l??Cfe,f=o[0],g=o[2],v=o[1],_=o[3],x=[_>d[3],g>d[2],v<d[1],f<d[0]],S=n.horizontalScale,T=c7e(a.isWebMercatorOnPlateCarree,n.ellipsoid.radius,S),{minu:M,minv:E,maxu:P,maxv:O,boundingBox:D}=i,L=Math.max(f,d[0]),F=Math.min(g,d[2]),j=Math.max(v,d[1]),N=Math.min(_,d[3]),B=s[0],U=s[1],Q=s[2];for(let H=0;H<4;++H){const J=H===1||H===3,Z=r.edgeResolutions[H];He(qT(Z));const K=Z+1,ee=x[H],_e=X2(n,r.edgePeerNeighbors[H]);if(!ee&&y7e(n,_e,H)){f7e(t,H,_e);continue}const Ne=_e!=null&&!ee,G=_e?.renderData,le=G?.geometryState;if(Ta&&(He(!Ne||_e.level===n.level),He(!Ne||zg(n,_e)<=0),n&&!_e&&!a.updatingRootTiles)){const tt=Yf[H],Qe=n.findNeighborTile(tt,et=>et.loaded||et.leaf||et.level===n.level);a.updatingRootTiles||(Qe?Qe.intersectsClippingArea&&(He(!Qe.loaded),He(!Qe.leaf),He(Qe.level===n.level)):He(a?.rootTiles==null||!n.shouldHaveNeighbor(tt)))}const de=Ce(H===1?g:f,L,F),Se=Ce(H===0?_:v,j,N),je=le?.samplerData,Be=e&&K>3?K-3:1,pt=Ce(H===1?1:0,M,P),Dt=Ce(H===0?1:0,E,O),at=Ne?(tt,Qe)=>.5*(Ms(tt,Qe,je)+Ms(tt,Qe,u)):(tt,Qe)=>Ms(tt,Qe,u),Bt=(g-f)/Z,kt=J?H===1?Bt:-Bt:0,Lt=J?0:H===0?Bt:-Bt,Xt=-kt,Ge=-Lt;let Wt=0,Ze=0,We=0;{const tt=0/Z,Qe=J?de:Ce(f*(1-tt)+g*tt,L,F),et=J?Ce(v*(1-tt)+_*tt,j,N):Se,ht=at(Qe,et);Wt=Qe*S,Ze=T(et),We=ht}let St=0,vt=0,Nt=0;{const tt=1/Z,Qe=J?de:Ce(f*(1-tt)+g*tt,L,F),et=J?Ce(v*(1-tt)+_*tt,j,N):Se,ht=at(Qe,et);St=Qe*S,vt=T(et),Nt=ht}for(let tt=1;tt<K-1;tt+=Be){const Qe=tt/Z,et=St,ht=vt,ri=Nt;{const Zt=J?pt:Ce(Qe,M,P),Jt=J?Ce(Qe,E,O):Dt,Ni=et-B,Nr=ht-U,ir=ri-Q;vp(et,Nr,ir,D),i.setEdgeVertexFromValuesRawPositionUV(H,tt,Ni,Nr,ir,Zt,Jt)}{const Zt=(tt+1)/Z,Jt=J?de:Ce(f*(1-Zt)+g*Zt,L,F),Ni=J?Ce(v*(1-Zt)+_*Zt,j,N):Se,Nr=at(Jt,Ni);St=Jt*S,vt=T(Ni),Nt=Nr}const Wi=St,zi=Nt,ci=Wt,or=Ze,tr=We;Wt=et,Ze=ht,We=ri;let Mi=0,Ei=0,ui=0;if(J){const Zt=vt-ht,Jt=zi-ri,Ni=or-ht,Nr=tr-ri,ir=Ce(v*(1-Qe)+_*Qe,j,N),Vi=de+Xt,Vr=Vi*S-et,is=Ms(Vi,ir,u)-ri,Ds=H===3?-1:1;if(Mi=Ds*(-Ni+Zt)*is,Ei=Ds*Vr*(-Nr+Jt),ui=-Ds*Vr*(-Ni+Zt),Ne){const Ra=de+kt,En=Ra*S-et;Mi=(-Ni+Zt)*(is-(Ms(Ra,ir,je)-ri)),Ei=(Vr-En)*(-Nr+Jt),ui=-(Vr-En)*(-Ni+Zt)}}else{const Zt=Wi-et,Jt=zi-ri,Ni=ci-et,Nr=tr-ri,ir=Ce(f*(1-Qe)+g*Qe,L,F),Vi=Se+Ge,Vr=Ms(ir,Vi,u)-ri,is=T(Vi)-ht,Ds=H===2?-1:1;if(Mi=Ds*is*(-Nr+Jt),Ei=Ds*(-Ni+Zt)*Vr,ui=-Ds*is*(-Ni+Zt),Ne){const Ra=ir,En=Se+Lt,Xo=T(En)-ht;Mi=(-is+Xo)*(-Nr+Jt),Ei=(-Ni+Zt)*(-Vr+(Ms(Ra,En,je)-ri)),ui=-(-is+Xo)*(-Ni+Zt)}}const Ot=1/Math.sqrt(Mi*Mi+Ei*Ei+ui*ui);i.setEdgeNormalFromValues(H,tt,Mi*Ot,Ei*Ot,ui*Ot)}}}function l7e(t,e){m7e(t)}function nGt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function aGt(t,e){return t*e}function c7e(t,e,i){return t?r=>nGt(r,e):r=>aGt(r,i)}function u7e(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,a=r-1,o=s.count,l=2*(r-3)*(r-3),u=4*(a+n-3),d=yfe.reduce((x,S)=>x+(a+t.getEdgeCount(S)-3),0),f=e.reduce((x,S)=>x+a*(2*(S.latitudeResolution-1)+1),0),g=3*(i?2:1),v=(l+u+f)*g,_=o>=Gqt?new Uint32Array(v):new Uint16Array(v);for(let x=0;x<v;++x)_[x]=0;t.indices=_,t.indexCount=(l+d+f)*g,t.poleIndicesStartIndex=l*g,t.edgeIndicesStartIndex=(l+f)*g,i?(cGt(t),uGt(t,e),d7e(t)):(oGt(t),lGt(t,e),h7e(t))}function oGt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:a}=s,o=e-2,l=e-3,u=0,d=e-3;let f=0;for(let g=0;g<l;++g){const v=g*o;for(let _=u;_<d;++_){const x=v+_,S=x+1,T=S+o,M=T-1;_7e(x,S,T,M,a,n)?(i[f]=x,i[f+1]=S,i[f+2]=T,i[f+3]=T,i[f+4]=M,i[f+5]=x):(i[f]=x,i[f+1]=S,i[f+2]=M,i[f+3]=M,i[f+4]=S,i[f+5]=T),f+=6}}}function lGt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let a=s;for(const o of e){const l=o.isNorth?1:2,u=o.isNorth?2:1,d=o.isNorth?3:4,f=o.isNorth?4:3;let g=t.getEdgeVertexIndex(o.connectedOuterEdgeOffset,0),v=1;for(let _=0;_<o.latitudeResolution;++_){const x=_===0?o.rowOffset:g+i;for(let S=0;S<n;S++){const T=x+S;r[a]=g,r[a+l]=g+1,r[a+u]=T,_<o.latitudeResolution-1?(r[a+d]=g+1,r[a+f]=T+1,r[a+5]=T,a+=6):a+=3,g+=v}g=x,v=1}}}function h7e(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let a=r;for(let o=0;o<4;++o){const l=Mfe[o];let u=0,d=0;const f=t.getEdgeCount(o),g=l.count;He(g===s-1);const v=o===1||o===2,_=v?1:2,x=v?2:1,S=t.getEdgeFirstVertexIndex(o),T=1,M=l.vertex0Index,E=l.stride;for(;u<f-1||d<g-1;){const P=M+d*E,O=S+u*T,D=u<f-1,L=d<g-1,F=D&&(!L||(D?0+s*(u+.5)/(f-1):0)<=(L?1+n*(d+.5)/(g-1):0));F?++u:++d;const j=F?O+T:P+E;e[a]=P,e[a+_]=O,e[a+x]=j,a+=3}}t.indexCount=a}function cGt(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:a}=s,o=i-2;let l=0;for(let u=0;u<i-3;++u){const d=u*o;for(let f=0;f<i-3;++f){const g=u*o+f,v=g+1,_=v+o,x=_-1,S=d+f,T=S+1,M=T+o;_7e(S,T,M,M-1,a,n)?(RE(e,l,g,v,_),l+=6,RE(e,l,_,x,g)):(RE(e,l,g,v,x),l+=6,RE(e,l,x,_,v)),l+=6}}}function uGt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let a=s;for(const o of e){const l=o.connectedOuterEdgeOffset;let u=t.getEdgeVertexIndex(l,0),d=1;for(let f=0;f<o.latitudeResolution;++f){const g=f===0?o.rowOffset:u+r;for(let v=0;v<n;v++)RE(i,a,u,u+1,g+v),a+=6,f<o.latitudeResolution-1&&(RE(i,a,u+1,g+v+1,g+v),a+=6),u+=d;u=g,d=1}}}function d7e(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let a=r;for(let o=0;o<4;++o){const l=Mfe[o];let u=0,d=0;const f=t.getEdgeCount(o),g=l.count;He(g===s-1);const v=o===1||o===2,_=v?1:3,x=v?3:1,S=t.getEdgeFirstVertexIndex(o),T=1,M=l.vertex0Index,E=l.stride;for(;u<f-1||d<g-1;){const P=M+d*E,O=S+u*T,D=u<f-1,L=d<g-1,F=D&&(!L||(D?0+s*(u+.5)/(f-1):0)<=(L?1+n*(d+.5)/(g-1):0));F?++u:++d;const j=F?O+T:P+E;e[a]=P,e[a+_]=O,e[a+_+1]=O,e[a+x]=j,e[a+x+1]=j,e[a+5]=P,a+=6}}t.indexCount=a}function $fe(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,a=s-2;let o=n;for(let l=0;l<4;++l){{const u=l===0||l===2,d=(l===0?a-1:0)*a+(l===1?a-1:0),f=(u?0:1)*a+(u?1:0),g=Mfe[l];g.vertex0Index=d,g.stride=f,g.count=a}{const u=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=o,e.outerEdgesOffsetAndLength[2*l+1]=u,o+=u}}}function p7e(t){$fe(t),t.geometryState.wireframe?d7e(t.geometry):h7e(t.geometry)}function f7e(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:a}=t,o=e===1||e===3,l=r.edgeResolutions[e];He(qT(l));const u=l+1,{boundingBox:d,minu:f,minv:g,maxu:v,maxv:_,vertexAttributes:x}=s,S=Ce(e===1?1:0,f,v),T=Ce(e===0?1:0,g,_),M=i.renderData,E=M.geometryState,P=M.geometry,O=(e+2)%4,D=P.getEdgeCount(O),L=n.getNeighborEdgeStartVertexIndex(e,i)*l,F=l*2**(n.level-i.level);He(E.edgeResolutions[O]===F),He(D-1===F);const j=M.localOrigin[0]-a[0],N=M.localOrigin[1]-a[1],B=M.localOrigin[2]-a[2],U=s.getEdgeFirstVertexIndex(e),{position:Q,uv0:H}=x,J=Q.typedBuffer,Z=Q.typedBufferStride,K=x.normalCompressed,ee=K.typedBuffer,_e=K.typedBufferStride,Ne=P.vertexAttributes,G=P.getEdgeFirstVertexIndex(O),le=Ne.position.typedBuffer,de=Ne.position.typedBufferStride,Se=Ne.normalCompressed.typedBuffer,je=Ne.normalCompressed.typedBufferStride;for(let Be=1;Be<u-1;++Be){const pt=U+Be,Dt=G+(L+Be),at=pt*Z,Bt=Dt*de,kt=le[Bt]+j,Lt=le[Bt+1]+N,Xt=le[Bt+2]+B;J[at]=kt,J[at+1]=Lt,J[at+2]=Xt,vp(kt,Lt,Xt,d);const Ge=pt*_e,Wt=Dt*je;ee[Ge]=Se[Wt],ee[Ge+1]=Se[Wt+1];const Ze=Be/l,We=o?S:Ce(Ze,f,v),St=o?Ce(Ze,g,_):T;H.setValues(pt,Math.round(We*Xn),Math.round(St*Xn))}}function m7e(t){const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:a,minv:o,maxu:l,maxv:u,boundingBox:d,vertexAttributes:f}=e,g=t.tile,{surface:v,ellipsoid:_,extent:x,extentInRadians:S,horizontalScale:T}=g,M=v.view?.viewingMode==="local",E=_.radius;let P=0,O=0,D=0;const L=(Ge,Wt,Ze)=>{const We=S[Wt===0?1:3],St=S[Ge===0?0:2],vt=Math.cos(We),Nt=Math.sin(We),tt=Math.sin(St),Qe=Math.cos(St),et=E+Ze;P=Qe*vt*et,O=tt*vt*et,D=Nt*et},F=M?(()=>{const Ge=s,Wt=Ge!=null&&(x[3]>Ge[3]||x[2]>Ge[2]||x[1]<Ge[1]||x[0]<Ge[0]),Ze=c7e(v.isWebMercatorOnPlateCarree,E,T);return(We,St,vt)=>{const Nt=We===0?x[0]:x[2],tt=St===0?x[1]:x[3],Qe=Wt?Ce(Nt,Ge[0],Ge[2]):Nt,et=Wt?Ce(tt,Ge[1],Ge[3]):tt,ht=vt;P=Qe*T,O=Ze(et),D=ht}})():L;let j=0,N=0,B=0,U=0,Q=0,H=0,J=0,Z=0,K=0;const ee=M&&v.isWebMercatorOnPlateCarree,_e=(Ge,Wt,Ze,We,St)=>{let vt=0,Nt=0,tt=0;if(M){const Qe=Wt*T,et=ee?(Math.PI/2-2*Math.atan(Math.exp(-Ze/E)))*E:Ze*T;vt=Qe-P,Nt=et-O,tt=We-D}else{const Qe=Sfe(Ge),et=Ge.tile,ht=et.extent,ri=et.extentInRadians,Wi=(Wt-ht[0])/(ht[2]-ht[0]),zi=(Ze-ht[1])/(ht[3]-ht[1]),ci=ri[0]*(1-Wi)+ri[2]*Wi,or=Qe(zi),tr=Math.cos(or),Mi=Math.sin(or),Ei=Math.sin(ci),ui=Math.cos(ci),Ot=E+We;vt=ui*tr*Ot-P,Nt=Ei*tr*Ot-O,tt=Mi*Ot-D}switch(St){case 0:J+=vt,Z+=Nt,K+=tt;break;case 1:U-=vt,Q-=Nt,H-=tt;break;case 2:J-=vt,Z-=Nt,K-=tt;break;case 3:U+=vt,Q+=Nt,H+=tt}},Ne=s??Cfe,G=x[0],le=x[2],de=x[1],Se=x[3],je=[Se>Ne[3],le>Ne[2],de<Ne[1],G<Ne[0]],Be=Math.max(G,Ne[0]),pt=Math.min(le,Ne[2]),Dt=Math.max(de,Ne[1]),at=Math.min(Se,Ne[3]),Bt=Ge=>Math.max(Ne[0],Math.min(Ne[2],Ge)),kt=Ge=>Math.max(Ne[1],Math.min(Ne[3],Ge)),Lt=Ge=>{const Wt=i.cornerNeighborCornerTiles;j=0,N=0,B=1,U=0,Q=0,H=0,J=0,Z=0,K=0;let Ze=1/0;for(let Qe=0;Qe<4;++Qe){const et=Wt[4*Ge+Qe];Ze=Math.min(Ze,et?.level??1/0)}for(let Qe=0;Qe<4;++Qe){const et=Wt[4*Ge+Qe];BI[Qe]=et?.level===Ze?et:null}let We=1,St=0;for(let Qe=0;Qe<4;++Qe){const et=BI[Qe];et&&(We=Math.max(We,et?.renderData.geometryState.numVerticesPerSide),St=et.extent[2]-et.extent[0])}const vt=St,Nt=We;He(Nt>1);const tt=vt/Nt;for(let Qe=0;Qe<4;++Qe){const et=BI[(Qe+3)%4],ht=BI[Qe%4];if(!et&&!ht)continue;const ri=Qe===0?1:Qe===1?2:Qe===2?3:0,Wi=Qe===0?2:Qe===1?3:Qe===2?0:1;if(et&&ht){const zi=TK[Qe][0]*tt,ci=TK[Qe][1]*tt,or=et.extent,tr=Bt(or[ri===0||ri===1?2:0]+zi),Mi=kt(or[ri===0||ri===3?3:1]+ci),Ei=ht.extent,ui=Bt(Ei[Wi===0||Wi===1?2:0]+zi),Ot=kt(Ei[Wi===0||Wi===3?3:1]+ci),Zt=et.renderData,Jt=ht.renderData,Ni=Ms(tr,Mi,Zt.geometryState.samplerData),Nr=Ms(ui,Ot,Jt.geometryState.samplerData);_e(Zt,tr,Mi,.5*(Ni+Nr),Qe)}else{const zi=et??ht,ci=et?ri:Wi,or=zi.extent,tr=TK[Qe],Mi=Bt(or[ci===0||ci===1?2:0]+tr[0]*tt),Ei=kt(or[ci===0||ci===3?3:1]+tr[1]*tt),ui=zi.renderData,Ot=Ms(Mi,Ei,ui.geometryState.samplerData);_e(ui,Mi,Ei,Ot,Qe)}}if(!M){const Qe=Math.sqrt(P*P+O*O+D*D);j=P/Qe,N=O/Qe,B=D/Qe}if(M||B*B<.999){const Qe=Math.sqrt(U*U+Q*Q+H*H);U/=Qe,Q/=Qe,H/=Qe;const et=Math.sqrt(J*J+Z*Z+K*K);J/=et,Z/=et,K/=et,j=H*Z-Q*K,N=U*K-H*J,B=Q*J-U*Z;const ht=1/Math.sqrt(j*j+N*N+B*B);j*=ht,N*=ht,B*=ht}},Xt=i.cornerNeighborCornerTiles;for(let Ge=0;Ge<4;++Ge){const Wt=Ge,Ze=(Ge+1)%4,We=Ge===0||Ge===1?1:0,St=Ge===0||Ge===3?1:0,vt=Ce(We,a,l),Nt=Ce(St,o,u),tt=e.getEdgeFirstVertexIndex(Wt),Qe=e.getEdgeCount(Wt),et=Ge===0||Ge===3?Qe-1:0,ht=e.getEdgeFirstVertexIndex(Ze),ri=e.getEdgeCount(Ze),Wi=Ge===0||Ge===1?ri-1:0;let zi=-1;for(let tr=0;tr<4;++tr){const Mi=Xt[4*Ge+tr],Ei=Xt[4*Ge+zi];Mi&&(zi===-1||zg(Ei,Mi)>0)&&(zi=tr)}const ci=zi,or=Xt[4*Ge+ci];if(or!==g){const tr=g.level-or.level,Mi=2**tr,Ei=[or.lij[0]+tr,or.lij[1]*Mi,or.lij[2]*Mi],ui=[Ei[1]+Mi===g.lij[1],Ge===0&&(ci===1||ci===0&&or!==Xt[4*Ge+3])||Ge===1&&(ci===0||ci===1&&or!==Xt[4*Ge+2]),Ei[1]===g.lij[1]+1,Ge===2&&(ci===3||ci===2&&or!==Xt[4*Ge+1])||Ge===3&&(ci===2||ci===3&&or!==Xt[4*Ge+0])],Ot=ui.reduce((ir,Vi)=>ir+(Vi?1:0),0);He(Ot===1||Ot===2);let Zt=-1,Jt=-1;const Ni=or.renderData;if(Ot===1){const ir=ui.findIndex(Vr=>Vr);He(0<=ir&&ir<=3),Zt=(ir+2)%4;const Vi=i.edgeResolutions[ir];Jt=g.getNeighborEdgeStartVertexIndex(ir,or)*Vi+Vi*(ir===0&&Ge===0||ir===1&&Ge===0||ir===2&&Ge===1||ir===3&&Ge===3?1:0)}else{He(ui[1]||ui[3]),Zt=ui[1]?3:1;const ir=Ni.geometryState.edgeResolutions[Zt];Jt=Ge===0||Ge===3?0:ir}const Nr=Ni.geometry;{const ir=tt+et,Vi=ht+Wi,Vr=Nr.getEdgeFirstVertexIndex(Zt)+Jt,is=Nr.vertexAttributes,Ds=Ni.localOrigin,Ra=is.position,En=Ra.typedBuffer,Xo=Vr*Ra.typedBufferStride,pe=En[Xo]+Ds[0]-r[0],hi=En[Xo+1]+Ds[1]-r[1],ai=En[Xo+2]+Ds[2]-r[2];vp(pe,hi,ai,d);const rs=f.position,lr=rs.typedBuffer,Us=ir*rs.typedBufferStride;lr[Us]=pe,lr[Us+1]=hi,lr[Us+2]=ai;const it=Vi*rs.typedBufferStride;lr[it]=pe,lr[it+1]=hi,lr[it+2]=ai;const Oo=f.uv0;Oo.setValues(ir,Math.round(vt*Xn),Math.round(Nt*Xn)),Oo.setValues(Vi,Math.round(vt*Xn),Math.round(Nt*Xn));{const Ko=is.normalCompressed.typedBuffer,gr=Vr*is.normalCompressed.typedBufferStride,Ia=f.normalCompressed,rn=Ia.typedBuffer;{const Oi=ir*Ia.typedBufferStride;rn[Oi]=Ko[gr],rn[Oi+1]=Ko[gr+1]}{const Oi=Vi*Ia.typedBufferStride;rn[Oi]=Ko[gr],rn[Oi+1]=Ko[gr+1]}}}}else{const tr=je[Wt],Mi=je[Ze];let Ei;if(tr||Mi){const Jt=Ce(G*(1-We)+le*We,Be,pt),Ni=Ce(de*(1-St)+Se*St,Dt,at);Ei=Ms(Jt,Ni,n)}else Ei=hGt(Xt,Ge);F(We,St,Ei),Lt(Ge);const ui=P-r[0],Ot=O-r[1],Zt=D-r[2];vp(ui,Ot,Zt,d),e.setEdgeVertexFromValuesRawPositionUVNormal(Wt,et,ui,Ot,Zt,vt,Nt,j,N,B),e.setEdgeVertexFromValuesRawPositionUVNormal(Ze,Wi,ui,Ot,Zt,vt,Nt,j,N,B)}}for(let Ge=0;Ge<4;++Ge)BI[Ge]=null}function hGt(t,e){const i=4*e,r=yfe.reduce((o,l)=>Math.min(o,t[i+l]?.level??1/0),1/0);Ta&&(He(!t[i+0]||!t[i+2]||doe(t[i+0],t[i+2],5)),He(!t[i+1]||!t[i+3]||doe(t[i+1],t[i+3],7)));let s=0,n=0;for(let o=0;o<4;++o){const l=t[i+o];if(l&&l.level===r){const u=o===0||o===1,d=o===0||o===3,f=l.extent,g=f[u?0:2],v=f[d?1:3],_=l.renderData?.geometryState?.samplerData;n+=Ms(g,v,_),s++}}const a=s?n/s:0;return He(a!=null),a}function jP(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.buffer()?.setSubData(n,s,s,n.length)}function g7e(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let dGt=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const TK=[[0,1],[1,0],[0,-1],[-1,0]],yo=new uqt,Cfe=o7(-1/0,-1/0,1/0,1/0),BI=[null,null,null,null];function y7e(t,e,i){if(!e)return!1;const r=zg(t,e);return r>0||r===0&&i>=2}let t6=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return He(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const Mfe=[new t6,new t6,new t6,new t6];function vp(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function v7e(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function _7e(t,e,i,r,s,n){const a=t*s,o=n[a],l=n[a+1],u=n[a+2],d=e*s,f=n[d],g=n[d+1],v=n[d+2],_=i*s,x=n[_],S=n[_+1],T=n[_+2],M=r*s,E=n[M],P=n[M+1],O=n[M+2];return(f-E)*(f-E)+(g-P)*(g-P)+(v-O)*(v-O)>(o-x)*(o-x)+(l-S)*(l-S)+(u-T)*(u-T)}function RE(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const n8=6;let pGt=class extends _fe{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=fi(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const a=n.view.renderSpatialReference,o=n.spatialReference,l=a!=null&&E5(a)&&o!=null&&o.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:u}=n,d=this._extentInRenderSR,f=this.extent;if(u){const g=Ye(f[0],f[1],0);Co(g,Me.WebMercator,g,Me.PlateCarree);const v=Ye(f[2],f[3],0);Co(v,Me.WebMercator,v,Me.PlateCarree),d[0]=g[0],d[1]=g[1],d[2]=v[0],d[3]=v[1]}else for(let g=0;g<4;++g)d[g]=f[g]*l;this.centerAtSeaLevel[0]=.5*(d[0]+d[2]),this.centerAtSeaLevel[1]=.5*(d[1]+d[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(d[2]-d[0],d[3]-d[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),a=Math.max(s,n);this._center[1][3]=a}_calculateFrustumVisibility(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],a=i[3],o=i[4],l=i[5];let u=!0;for(let d=0;d<6;d++){const f=e[d],g=f[0],v=f[1],_=f[2],x=f[3];if(g*(g>0?r:a)+v*(v>0?s:o)+_*(_>0?n:l)+x>=0)return 2;u=u&&g*(g<0?r:a)+v*(v<0?s:o)+_*(_<0?n:l)+x<=0}return u?0:1}_aabb(){const e=this._extentInRenderSR;return sgt(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return i6[0]=1/i[0],i6[1]=1/i[1],i6[2]=1/i[2],xpe(this._aabb(),e,i6,r,s)}createGeometry(){eGt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const a=r.geometry.boundingBox;s=a[2],n=a[5]}else if(!this.leaf){s=1/0,n=-1/0;for(const a of this.children){const o=a;s=Math.min(s,o._subtreeGeometryElevationBoundMin),n=Math.max(n,o._subtreeGeometryElevationBoundMax)}}(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax)&&(this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n,this.parent?._updateSubtreeGeometryElevationsBounds())}get minimumVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){iGt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){sGt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){rGt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const i6=I();let fGt=class{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}},mGt=class{constructor(){this.extent=li(),this.minLevel=0,this.maxLevel=0,this.callback=null}},a8=class extends be{constructor(){super(...arguments),this._queries=new Ai({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Ai({initialSize:30}),this._queryPool=new Wc(()=>new mGt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();qc(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};c([p()],a8.prototype,"updating",null),a8=c([R("esri.views.3d.terrain.ScaleRangeQueries")],a8);function gGt(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let yGt=class extends _fe{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=Is(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const a=this.ellipsoid.radius,o=this.extentInRadians[0],l=this.extentInRadians[1],u=this.extentInRadians[2],d=this.extentInRadians[3],f=yt(l,d,.5),g=yt(o,u,.5),v=e===0?0:Math.min(Math.abs(l),Math.abs(d));this._edgeLen=(u-o)*Math.cos(v)*a,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=a-Math.sqrt(a*a-this._edgeLen2/4),gGt(this.centerAtSeaLevel,g,f,this.ellipsoid.radius),Re(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)Qje(e[1],0,0,0),xe(e[0],0,0,0),xe(e[2],0,0,0),e[1][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[1],r=this.convexHull;let s=0;const n=Li(i);for(let a=0;a<8;++a)s=Math.max(s,vGt(n,r,3*a));e[1][3]=Math.sqrt(s)}}_calculateFrustumVisibility(e){if(!ww(e,this._boundingSphere))return 2;if(this.lij[0]<10)return 1;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<RP;n++){const a=n===4,o=e[n],l=o[0],u=o[1],d=o[2],f=o[3]-(a?r:0);let g=!1;for(let v=0;v<8;++v){const _=3*v;if(l*i[_]+u*i[_+1]+d*i[_+2]+f<0){if(g=!0,!s)break}else s=!1}if(!g)return 2}return s?0:1}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){Hqt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ta&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=this.elevationBoundsMin,r=this.elevationBoundsMax,s=this.ellipsoid.radius,n=r;if(this.level===0)Xje(e,0,0,0,s+n);else{const a=this.extentInRadians,o=.5*(a[0]+a[2]),l=a[1],u=a[3];Vx(l3e,o,l,s),Vx(c3e,o,u,s),$e(fM,l3e,c3e),he(fM,fM,(s+.5*(i+r))/Ph(fM));const d=this.convexHull;let f=0;const g=(v,_)=>{const x=v[0]-d[3*_],S=v[1]-d[3*_+1],T=v[2]-d[3*_+2];return Math.sqrt(x*x+S*S+T*T)};for(let v=0;v<8;++v){const _=g(fM,v);f=Math.max(f,_)}AP(e,fM,f+2)}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),a=this.surface.isWebMercator,o=a&&n===1,l=a&&n===2,u=l||o,d=Math.PI/2,f=e[0],g=e[2],v=l?-d:e[1],_=o?d:e[3],x=.5*(f+g),S=r,T=i+(u?Math.min(0,S-1):S),M=(K,ee,_e)=>Vx(K,ee,_e,T),E=I(),P=I(),O=I(),D=I();M(E,f,v),M(P,f,_),M(O,g,_),M(D,g,v);const L=(K,ee)=>{for(let _e=0;_e<3;++_e)this._convexHull[3*ee+_e]=K[_e]};L(E,0),L(P,1),L(O,2),L(D,3);const F=s,j=i+(u?Math.max(0,F+1):F),N=I(),B=I(),U=I();Vx(B,x,_,T),Vx(U,x,v,T),$e(N,B,U),Re(N,N);const Q=I(),H=I(),J=(K,ee)=>{xi(H,K,ee),Re(H,H);const _e=-Le(K,Q)/Le(H,Q);He(_e>=0),he(H,H,_e),$e(K,K,H)};if(2**this.lij[0]>2*this.lij[1]){const K=U,ee=I();At(ee,o3e,K),Re(ee,ee),At(Q,K,ee),Re(Q,Q),He(ap(Le(Q,K)/Ph(K),0)),J(E,P),J(D,O),L(E,0),L(D,3)}else if(2**this.lij[0]!==2*this.lij[1]){const K=B,ee=I();At(ee,o3e,K),Re(ee,ee),At(Q,ee,K),Re(Q,Q),J(P,E),J(O,D),L(P,1),L(O,2)}const Z=(K,ee)=>{const _e=j/Le(ee,N);for(let Ne=0;Ne<3;++Ne)this._convexHull[3*K+Ne]=ee[Ne]*_e};Z(4,E),Z(5,P),Z(6,O),Z(7,D)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?3:1:r?2:0}intersectsRay(e,i,r,s){const n=this._boundingSphere,a=n[3]+r,o=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],u=n[1]-e[1],d=n[2]-e[2],f=(l*i[0]+u*i[1]+d*i[2])/o,g=i[0]*f-l,v=i[1]*f-u,_=i[2]*f-d;return g*g+v*v+_*_<a*a}get minimumVerticesPerSide(){return this.level<a3e.length?a3e[this.level]+1:2}updateCornerElevations(){Qqt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){Yqt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){Jqt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Ta||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=q0(e,I()),s=I(),n=this.ellipsoid.radius,a=this.elevationBoundsMin,o=this.elevationBoundsMax,l=n+a,u=1,d=0,f=this._center[1];q0(f,I());const g=f[3],v=this.convexHull,_=(Ze,We)=>{for(let St=0;St<3;++St)Ze[St]=v[3*We+St]};{const Ze=I(),We=I(),St=I(),vt=I(),Nt=I(),tt=(Qe,et,ht,ri)=>{_(We,Qe),_(St,et),_(vt,ht),xi(We,We,St),xi(vt,vt,St),At(Ze,We,vt),Re(Ze,Ze);const Wi=Le(Ze,St);_(Nt,ri);const zi=Le(Ze,Nt),ci=Math.abs(zi-Wi);He(ap(ci,0),`Non coplanar ${Qe},${et},${ht},${ri} diff = ${ci}`)};tt(0,1,2,3),tt(4,5,6,7),tt(0,1,4,5),tt(1,2,5,6),tt(2,3,6,7),tt(3,0,7,4)}const x=q5(24),S=(Ze,We,St)=>{const vt=4*Ze;for(let Nt=0;Nt<3;++Nt)x[vt+Nt]=We[Nt];x[vt+3]=St},T=I(),M=I(),E=I(),P=I(),O=(Ze,We,St,vt)=>{_(T,We),_(M,St),_(E,vt),xi(T,T,M),Re(T,T),xi(E,E,M),Re(E,E),At(P,T,E),Re(P,P);const Nt=Le(P,M);S(Ze,P,Nt)};O(0,0,1,2),O(1,1,0,4),O(2,1,5,2),O(3,3,2,6),O(4,4,0,3),O(5,4,6,5);const D=(Ze,We,St,vt)=>{const Nt=4*Ze;return x[Nt]*We+x[Nt+1]*St+x[Nt+2]*vt-x[Nt+3]},L=(Ze,We,St,vt)=>D(Ze,We,St,vt)>=-1,F=(Ze,We)=>L(Ze,We[0],We[1],We[2]),j=2**this.lij[0]>2*this.lij[1],N=(Ze,We,St)=>Math.sqrt(b7e(Ze,We,St,r[0],r[1],r[2]))<i,B=Ze=>N(Ze[0],Ze[1],Ze[2]),U=(Ze,We)=>N(Ze[We],Ze[We+1],Ze[We+2]),Q=this.extentInRadians,H=.5*(Q[0]+Q[2]),J=Q[1],Z=Q[3],K=I(),ee=I();Vx(K,H,Z,l),Vx(ee,H,J,l);const _e=j?"Upper":"Lower";let Ne=!0;for(let Ze=0;Ze<6;++Ze){for(let We=0;We<8;++We){const St=3*We,vt=L(Ze,v[St],v[St+1],v[St+2]);Ne&&=vt,He(vt,`Tile[${this.lij}] Convex hull point ${We} outside of plane ${Ze}`)}He(F(Ze,ee),`Tile[${this.lij}] (${_e}) bottom mid outside of plane ${Ze}`),He(F(Ze,K),`Tile[${this.lij}] (${_e}) top mid outside of plane ${Ze}`)}He(Ne,"Not all convex hull points are inside  convex hull polyhedron"),He(B(ee),`Tile[${this.lij}] (${_e}) bottom mid outside of bounding sphere`),He(B(K),`Tile[${this.lij}] (${_e}) top mid outside of bounding sphere`);for(let Ze=0;Ze<8;++Ze){const We=U(v,3*Ze);He(We,`Tile[${this.lij}] Convex hull point ${Ze} outside of bounding sphere`)}for(let Ze=0;Ze<6;++Ze)for(let We=0;We<8;++We){const St=3*We;L(Ze,v[St],v[St+1],v[St+2])||console.error(`Tile[${this.lij}] Convex hull point ${We} outside of plane ${Ze}`)}const{extentInRadians:G}=this,le=Math.max(G[2]-G[0],G[3]-G[1]),de=Math.round(le*n),{renderData:Se}=this;if(!Se)return;const{geometry:je,geometryState:Be,localOrigin:pt}=Se,Dt=je.vertexAttributes?.position;if(!Dt)return;const at=I(),Bt=je.numVerticesPerSide-2,{indices:kt,indexCount:Lt,edgeVerticesStartIndex:Xt,poleVerticesStartIndex:Ge}=je;if(!kt)return;const Wt=new Set;for(let Ze=0;Ze<Lt;++Ze){const We=kt[Ze];if(Wt.has(We))continue;Wt.add(We);const St=We<Ge,vt=We>=Xt;let Nt=!1,tt=-1;if(vt){let Ot=Xt;for(let Zt=0;Zt<4;++Zt){const Jt=Be.edgeResolutions[Zt];if(We===Ot||We===Ot+Jt-1){Nt=!0;break}if(Ot+=Jt,We<Ot){tt=Zt;break}}}const Qe=vt?Be.edgePeerNeighbors[tt]:null,et=vt&&Qe&&zg(this,Qe)>0;Dt.getVec(We,s),$e(at,s,pt);const ht=Ph(at)-n;let ri=0,Wi=!1;const zi=a-ht,ci=ht-o,or=zi>u,tr=ci>u,Mi=or||tr,Ei=()=>{const Ot=St?"internal":vt&&!Nt?"edge":Nt?"corner":"pole";return`Tile[${this.lij}].vertex[${We}]:${Ot}`+(or?"(below)":tr?"(above)":"")+(et?"(Neighbor)":"")},ui=CF(at,r);if(ui>=i+d){const Ot=ui-i;Mi||(console.error(`${Ei()} is out of the bounding sphere by ${Ot.toFixed(0)} / ${i.toFixed(0)}[tol=${d}] h=${ht.toFixed(0)} / [${a.toFixed(0)}..${o.toFixed(0)}] (${(Ot/i).toFixed(0)})`),Wi=!0)}for(let Ot=0;Ot<6;++Ot)if(!L(Ot,at[0],at[1],at[2])){const Zt=D(Ot,at[0],at[1],at[2]),Jt=We%Bt,Ni=(We-Jt)/Bt;Ot===0&&zi||Ot===5&&ci||(console.error(`${Ei()} (${Jt},${Ni})|${Bt}] is out of the bounding trapezoid plane ${Ot} h=${Math.round(ht)} / [${Math.round(a)}..${Math.round(o)}] dist=${Math.round(Zt)} radii = ${Math.round(i)}/${Math.round(g)}} : maxL = ${de}`),++ri)}if(Wi||ri>0)break}}get convexHull(){return this._convexHull}};const a3e=[128,64,64,32,16,8,8,4];function vGt(t,e,i){return b7e(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function b7e(t,e,i,r,s,n){const a=r-t,o=s-e,l=n-i;return a*a+o*o+l*l}const Vx=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),a=Math.cos(i),o=Math.sin(i);t[0]=r*a*s,t[1]=r*a*n,t[2]=r*o},o3e=[0,0,1],l3e=I(),c3e=I(),fM=I();let yf=class extends be{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};c([p()],yf.prototype,"fovX",void 0),c([p()],yf.prototype,"fovY",void 0),c([p()],yf.prototype,"relativeWidthLimit",void 0),c([p()],yf.prototype,"relativeHeightLimit",void 0),c([p()],yf.prototype,"maxLod",void 0),c([p()],yf.prototype,"angledSplitBias",void 0),c([p()],yf.prototype,"aboveGround",void 0),c([p()],yf.prototype,"frustum",void 0),yf=c([R("esri.views.3d.terrain.SplitLimits")],yf);const w7e=Qu().vec3f("position").vec2u16("uv0",{glNormalized:!0}).vec2i16("normalCompressed",{glNormalized:!0});let _Gt=class{constructor(e){this._storage=new tz((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=bGt(r),a=s.pop(n);if(a)return a;const o=w7e.createBuffer(r);return o.release=()=>s.put(n,o),o}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function bGt(t){return t.toString()}function u3e(t){return j4e(t.layer)}let x7e=class extends $r{constructor(){super(...arguments),this.scale=1,this.offset=f1}};function S7e(t){t.attributes.add("position","vec2"),t.attributes.add("uv0","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new _t("scale",e=>e.scale),new rc("offset",e=>e.offset)).main.add(A`gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;`)}function Efe(t){t.code.add(A`
    float lineFactorAtPosition(float value) {
      float pos = value * ${A.float(257)};
      if(pos < 0.5 || pos > ${A.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function wGt(t,e){const i=e.blendMode;i!==0&&(i===30&&t.code.add(A`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==6&&i!==13||t.code.add(A`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==9&&i!==13||t.code.add(A`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===10&&t.code.add(A`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===12&&t.code.add(A`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===11&&t.code.add(A`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===13&&t.code.add(A`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==14&&i!==15&&i!==17&&i!==16||(t.code.add(A`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==14&&i!==15||t.code.add(A`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(A`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===8?A`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===1?A`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===2?A`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===7?A`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===3?A`return vec4(cl * ol + cb * ob, ol + ob);`:i===4?A`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===28?A`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===5?A`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===26?A`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===29?A`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===18?A`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===19?A`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===21?A`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===22?A`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===24?A`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===25?A`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===20?A`return vec4(cb * ob * ol, ol * ob);`:i===23?A`return vec4(cl * ol * ob, ol * ob);`:i===14?A`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===15?A`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===17?A`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===16?A`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===27?A`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===30?A`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===6?A`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===9?A`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===10?A`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===11?A`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===12?A`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===13?A`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:A``}
    }
  `))}function T7e(t,e){const{output:i,blendMode:r,baseOpacityMode:s,premultipliedSource:n}=e,a=t.fragment,o=s===1;o&&a.uniforms.add(new _t("baseOpacity",f=>f.baseOpacity));const l=r!==0,u=!l&&n!==1&&(i===1&&!o||i===4);a.include(wGt,e);let d="";switch(i){case 4:case 0:d=A`vec4(0.0)`;break;case 2:a.uniforms.add(new Pr("backgroundColor",f=>f.backgroundColor)),d=A`vec4(backgroundColor, 1.0)`;break;case 3:a.include(Efe),d=A`vec4(gridColor(uv), 1.0)`;break;case 1:a.uniforms.add(new Gt("fboColor",f=>f.fboTexture)),d=A`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`}a.code.add(A`
    vec4 getBackground(vec2 uv) {
      return ${we(o,A`baseOpacity *`)} ${d};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?A`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:A`
          float composeAlpha = colorLayer.a * opacity;
          ${u?A`return colorLayer * opacity;`:A`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}function $7e(t){const e=new Gi,i=e.fragment;if(e.include(S7e),t.background===1){const r=t.output===2;return r?i.uniforms.add(new Pr("backgroundColor",s=>s.backgroundColor)):i.include(Efe),i.main.add(A`fragColor = vec4(${r?A`backgroundColor`:A`gridColor(uv)`}, 1.0);`),e}return e.include(T7e,t),i.uniforms.add(new Gt("tex",r=>r.texture),new _t("opacity",r=>r.opacity)),i.main.add(A`fragColor = blendLayers(uv, texture(tex, uv), opacity);`),e}const xGt=Object.freeze(Object.defineProperty({__proto__:null,build:$7e},Symbol.toStringTag,{value:"Module"}));let SGt=class extends x7e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Aa}},h3e=class extends er{constructor(e,i){super(e,i,new Hi(xGt,()=>W(()=>Promise.resolve().then(()=>Tri),void 0)),Rp(zF))}};const d3e=512,$L=4096,w$i=8,TGt=.125,x$i=!0,$Gt=32,S$i=1.5,poe=200,CGt=512;let pl=class jk{constructor(e,i){this.x=e,this.y=i}static fromArray(e){return new jk(e[0],e[1])}clone(){return new jk(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}rotateReverse(e,i){const r=this.x,s=this.y;return this.x=r*e+s*i,this.y=-r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new jk(e.x+i.x,e.y+i.y)}static sub(e,i){return new jk(e.x-i.x,e.y-i.y)}},r6=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},$$i=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=CGt*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new pl(e,i),this._firstPt=new pl(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new pl(e,i),n=pl.distance(this._prevPt,s);let a,o,l,u,d,f,g,v;if(r)this._prevIsIn?this._lineTo(e,i,!0):(a=this._prevPt,o=s,l=this._intersect(o,a),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!0));else if(this._prevIsIn)o=this._prevPt,a=s,l=this._intersect(o,a),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!1);else{const _=this._prevPt,x=s;if(_.x<=this._xmin&&x.x<=this._xmin||_.x>=this._xmax&&x.x>=this._xmax||_.y<=this._ymin&&x.y<=this._ymin||_.y>=this._ymax&&x.y>=this._ymax)this._lineTo(x.x,x.y,!1);else{const S=[];if((_.x<this._xmin&&x.x>this._xmin||_.x>this._xmin&&x.x<this._xmin)&&(u=(this._xmin-_.x)/(x.x-_.x),v=_.y+u*(x.y-_.y),v<=this._ymin?f=!1:v>=this._ymax?f=!0:S.push(new r6(u,this._xmin,v))),(_.x<this._xmax&&x.x>this._xmax||_.x>this._xmax&&x.x<this._xmax)&&(u=(this._xmax-_.x)/(x.x-_.x),v=_.y+u*(x.y-_.y),v<=this._ymin?f=!1:v>=this._ymax?f=!0:S.push(new r6(u,this._xmax,v))),(_.y<this._ymin&&x.y>this._ymin||_.y>this._ymin&&x.y<this._ymin)&&(u=(this._ymin-_.y)/(x.y-_.y),g=_.x+u*(x.x-_.x),g<=this._xmin?d=!1:g>=this._xmax?d=!0:S.push(new r6(u,g,this._ymin))),(_.y<this._ymax&&x.y>this._ymax||_.y>this._ymax&&x.y<this._ymax)&&(u=(this._ymax-_.y)/(x.y-_.y),g=_.x+u*(x.x-_.x),g<=this._xmin?d=!1:g>=this._xmax?d=!0:S.push(new r6(u,g,this._ymax))),S.length===0)d?f?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):f?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(S.length>1&&S[0].ratio>S[1].ratio)this._start=this._dist+n*S[1].ratio,this._lineTo(S[1].x,S[1].y,!0),this._lineTo(S[0].x,S[0].y,!0);else{this._start=this._dist+n*S[0].ratio;for(let T=0;T<S.length;T++)this._lineTo(S[T].x,S[T].y,!0)}this._lineTo(x.x,x.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===3&&e&&MGt.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==2)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const a=(r-e.x)/(i.x-e.x),o=(s-e.y)/(i.y-e.y);a<o?(n=a,s=e.y+a*(i.y-e.y)):(n=o,r=e.x+o*(i.x-e.x))}return this._r=n,new pl(r,s)}_pushLine(){this._line&&(this._type===1?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===2?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===3&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==3?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new pl(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new pl(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==3)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new pl(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const a=s.x===e,o=s.y===i;if(a&&o)return;this._isH&&a||this._isV&&o?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new pl(e,i)),this._isH=a,this._isV=o)}else this._line.push(new pl(e,i))}},M$i=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new pl(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new pl(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}},MGt=class Db{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,a=-i,o=e+i,l=[],u=[],d=r.length;for(let g=0;g<d;++g){const v=r[g];if(!v||v.length<2)continue;let _,x=v[0];const S=v.length;for(let T=1;T<S;++T)_=v[T],x.x===_.x&&(x.x<=s&&(x.y>_.y?(l.push(g),l.push(T),l.push(0),l.push(-1)):(u.push(g),u.push(T),u.push(0),u.push(-1))),x.x>=n&&(x.y<_.y?(l.push(g),l.push(T),l.push(1),l.push(-1)):(u.push(g),u.push(T),u.push(1),u.push(-1)))),x.y===_.y&&(x.y<=a&&(x.x<_.x?(l.push(g),l.push(T),l.push(2),l.push(-1)):(u.push(g),u.push(T),u.push(2),u.push(-1))),x.y>=o&&(x.x>_.x?(l.push(g),l.push(T),l.push(3),l.push(-1)):(u.push(g),u.push(T),u.push(3),u.push(-1)))),x=_}if(l.length===0||u.length===0)return;Db.fillParent(r,u,l),Db.fillParent(r,l,u);const f=[];Db.calcDeltas(f,u,l),Db.calcDeltas(f,l,u),Db.addDeltas(f,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let a=0;a<n;a+=4){const o=i[a],l=i[a+1],u=i[a+2],d=e[o][l-1],f=e[o][l];let g=8092,v=-1;for(let _=0;_<s;_+=4){if(r[_+2]!==u)continue;const x=r[_],S=r[_+1],T=e[x][S-1],M=e[x][S];switch(u){case 0:case 1:if(s6(d.y,T.y,M.y)&&s6(f.y,T.y,M.y)){const E=Math.abs(M.y-T.y);E<g&&(g=E,v=_)}break;case 2:case 3:if(s6(d.x,T.x,M.x)&&s6(f.x,T.x,M.x)){const E=Math.abs(M.x-T.x);E<g&&(g=E,v=_)}}}i[a+3]=v}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const a=[],o=Db.calcDelta(n,i,r,a);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(o)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const a=s.length;return a>1&&s[a-2]===n?0:(s.push(n),Db.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const a=e[n+3];a>s&&(s=a)}for(let n=0;n<r;n+=4){const a=i[e[n]],o=e[n+1],l=s-e[n+3];switch(e[n+2]){case 0:a[o-1].x-=l,a[o].x-=l,o===1&&(a[a.length-1].x-=l),o===a.length-1&&(a[0].x-=l);break;case 1:a[o-1].x+=l,a[o].x+=l,o===1&&(a[a.length-1].x+=l),o===a.length-1&&(a[0].x+=l);break;case 2:a[o-1].y-=l,a[o].y-=l,o===1&&(a[a.length-1].y-=l),o===a.length-1&&(a[0].y-=l);break;case 3:a[o-1].y+=l,a[o].y+=l,o===1&&(a[a.length-1].y+=l),o===a.length-1&&(a[0].y+=l)}}}};const s6=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,A$i=Number.POSITIVE_INFINITY,Afe=Math.PI,O$i=2*Afe,EGt=128/Afe,AGt=256/360,P$i=Afe/180,OGt=1/Math.LN2;function C7e(t,e){return(t%=e)>=0?t:t+e}function R$i(t){return C7e(t*EGt,256)}function I$i(t){return C7e(t*AGt,256)}function D$i(t){return Math.log(t)*OGt}function k$i(t,e,i){return t*(1-i)+e*i}const PGt=8,RGt=14,IGt=16;function L$i(t){return PGt+Math.max((t-RGt)*IGt,0)}function F$i(t,e,i){let r,s,n,a=0;for(const o of i){r=o.length;for(let l=1;l<r;++l)s=o[l-1],n=o[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?a++:a--)}return a!==0}function z$i(t,e,i,r){let s,n,a,o;const l=r*r;for(const u of i){const d=u.length;if(!(d<2)){s=u[0].x,n=u[0].y;for(let f=1;f<d;++f){if(a=u[f].x,o=u[f].y,Wat(t,e,s,n,a,o)<l)return!0;s=a,n=o}}}return!1}function DGt(t,e,i,r,s,n,a){const o=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,a))-i;return o*o+l*l<=t*t}function N$i(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new pl(0,0),s=new pl(0,0),n=new pl(0,0);for(let a=0;a<t.length;a++){const o=t[a],l=[];for(let u=0;u<o.length;u++){const d=o[u-1],f=o[u],g=o[u+1];u===0?r.setCoords(0,0):r.assignSub(f,d).normalize().rightPerpendicular(),u===o.length-1?s.setCoords(0,0):s.assignSub(g,f).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const v=n.x*s.x+n.y*s.y;v!==0&&n.scale(1/v),l.push(pl.add(f,n.scale(e)))}i.push(l)}return i}function V$i(t,e,i,r){const s=new pl(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),a=Math.cos(n),o=Math.sin(n);s.rotate(a,o)}return s}let kGt=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.uniqueSymbol=null,this._colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}colliders(){return this._colliders}},LGt=class{constructor(e){this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1,this.lastShow=!1,this.tileSymbols=[e],this.id=e.id}};function FGt(t,e,i,r){return M7e(t,e,i.level,i.col,r.key.level,r.key.col)}function zGt(t,e,i,r){return M7e(t,e,i.level,i.row,r.level,r.row)}function M7e(t,e,i,r,s,n){const a=i-s;if(a>=0)return(e>>a)+(r-(n<<a))*(t>>a);const o=-a;return e-(n-(r<<o))*(t>>o)<<o}let E7e=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function NGt(t,e,i,r,s,n,a){const o=e[r++];for(let l=0;l<o;l++){const u=new kGt(n,a);u.xTile=e[r++],u.yTile=e[r++],u.hash=e[r++],u.priority=e[r++],u.featureIndex=e[r++];const d=e[r++],f=u.colliders();for(let _=0;_<d;_++){const x=e[r++],S=e[r++],T=e[r++],M=e[r++],E=!!e[r++],P=e[r++],O=i[r++],D=i[r++],L=e[r++],F=e[r++];f.push({xTile:x,yTile:S,dxPixels:T,dyPixels:M,hard:E,partIndex:P,width:L,height:F,minLod:O,maxLod:D})}const g=t[r++];for(let _=0;_<g;_++)u.textVertexRanges.push([t[r++],t[r++]]);const v=t[r++];for(let _=0;_<v;_++)u.iconVertexRanges.push([t[r++],t[r++]]);s.push(u)}return r}function VGt(t,e,i){for(const[r,s]of t.symbols)jGt(t,e,i,s,r)}function jGt(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===3){for(const a of r){const o=a.uniqueSymbol;let l;if(a.selectedForRendering){const u=o.parts[0],d=u.startOpacity,f=u.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&f===0;const g=i?Math.floor(127*d)|f<<7:f?255:0;l=g<<24|g<<16|g<<8|g}else l=0;for(const[u,d]of a.iconVertexRanges)for(let f=u;f<u+d;f+=4)n.iconOpacity[f/4]=l;if(a.selectedForRendering){const u=o.parts[1],d=u.startOpacity,f=u.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&f===0;const g=i?Math.floor(127*d)|f<<7:f?255:0;l=g<<24|g<<16|g<<8|g}else l=0;for(const[u,d]of a.textVertexRanges)for(let f=u;f<u+d;f+=4)n.textOpacity[f/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function UGt(t,e,i,r){const s=t.colliders();let n,a,o,l;for(const u of s)if(t.uniqueSymbol?.show&&t.uniqueSymbol.parts[u.partIndex].show&&(n=u.xScreen-r[0]+u.dxScreen,a=u.yScreen-r[1]+u.dyScreen,o=n+u.width,l=a+u.height,DGt(i,e.x,e.y,n,a,o,l)))return!0;return!1}let BGt=class{constructor(e,i,r,s,n,a){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new E7e(i,r,$Gt),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180),s.cachedStyles&&(this._styleProps=s.cachedStyles);for(const o of e)for(const l of o.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,NFe(l.tile.transforms.tileUnitsToPixels))}work(e){const i=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const r=this._symbols[this._currentLayerCursor],s=this._getProperties(r.styleLayerUID),n=this._styleRepository.layerContexts?.get(r.styleLayerUID);for(;this._currentSymbolCursor<r.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>e)return!1;const a=r.symbols[this._currentSymbolCursor];if(!a.uniqueSymbol?.show)continue;const o=this._computeCoordinates(a,s,n),l=a.uniqueSymbol;if(!l.show)continue;const{iconAllowOverlap:u,textAllowOverlap:d}=s;for(const f of o){if(!f.enabled)continue;const g=l.parts[f.partIndex];g.show&&!(f.partIndex?d:u)&&this._doesCollide(f)&&(f.hard?l.show=!1:g.show=!1)}l.show&&this._insertColliders(l.parts,o,s)}}return!0}_insertColliders(e,i,r){const{iconIgnorePlacement:s,textIgnorePlacement:n}=r;for(const a of i){if(!a.enabled||(a.partIndex?n:s)||!e[a.partIndex].show)continue;const o=a.xScreen+a.dxScreen,l=a.yScreen+a.dyScreen,u=o+a.width,d=l+a.height,[f,g,v,_]=this._gridIndex.getCellSpan(o,l,u,d);for(let x=g;x<=_;x++)for(let S=f;S<=v;S++)this._gridIndex.cells[x][S].push(a)}}_computeCoordinates(e,i,r){const{iconRotationAlignment:s,textRotationAlignment:n,iconTranslate:a,iconTranslateAnchor:o,textTranslate:l,textTranslateAnchor:u}=i,d=this._si,f=this._co,g=this._zoom,v=this._allNeededMatrices.get(e.tile),_=e.uniqueSymbol,x=e.colliders(r);let S=0;for(const T of x){const[M,E]=T.partIndex===0?a:l,P=T.partIndex===0?o:u,O=T.minLod<=g&&g<=T.maxLod;S+=O?0:1,T.enabled=O,T.xScreen=T.xTile*v[0]+T.yTile*v[3]+v[6],T.yScreen=T.xTile*v[1]+T.yTile*v[4]+v[7],P===0?(T.xScreen+=f*M-d*E,T.yScreen+=d*M+f*E):(T.xScreen+=M,T.yScreen+=E),(T.partIndex===0?s:n)===1?(T.dxScreen=T.dxPixels,T.dyScreen=T.dyPixels):(T.dxScreen=f*(T.dxPixels+T.width/2)-d*(T.dyPixels+T.height/2)-T.width/2,T.dyScreen=d*(T.dxPixels+T.width/2)+f*(T.dyPixels+T.height/2)-T.height/2)}return x.length>0&&S===x.length&&_&&(_.show=!1),x}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._styleRepository.getLayerStyleProperties?.(e,this._zoom);return this._styleProps.set(e,r),r}_doesCollide(e){const i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,s=i+e.width,n=r+e.height,[a,o,l,u]=this._gridIndex.getCellSpan(i,r,s,n);for(let d=o;d<=u;d++)for(let f=a;f<=l;f++){const g=this._gridIndex.cells[d][f];for(const v of g){if(v.labelId!=null&&e.labelId!=null&&v.labelId===e.labelId)continue;const _=v.xScreen+v.dxScreen,x=v.yScreen+v.dyScreen,S=_+v.width,T=x+v.height;if(!(s<_||i>S||n<x||r>T))return!0}}return!1}},rW=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let a=0;a<n;a++)this.layerUIDs[a]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},qGt=class extends rW{constructor(e,i){super(e,i),this.type=2,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let a=0;a<n;a++){const o=r[s++],l=r[s++],u=r[s++];this.patternMap.set(o,[l,u])}}this.bufferDataOffset=s}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=jt(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++],o=this.layer.lineMaterial,l=new vn(e,o.geometryLayout,new Int32Array(n.buffer,4*r,a));r+=a;const u=s[r++],d=id.createIndex(e,35044,new Uint32Array(s.buffer,4*r,u));r+=u,this.vao=new H0(e,l,d)}},GGt=class extends rW{constructor(e,i){super(e,i),this.type=1,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let a=0;a<n;a++){const o=r[s++],l=r[s++],u=r[s++];this.patternMap.set(o,[l,u])}}this.bufferDataOffset=s}get usedMemory(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=jt(this.fillVAO),this.outlineVAO=jt(this.outlineVAO)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++],o=this.layer,l=o.fillMaterial,u=new vn(e,l.geometryLayout,new Int32Array(n.buffer,4*r,a));r+=a;const d=s[r++],f=id.createIndex(e,35044,new Uint32Array(s.buffer,4*r,d));r+=d;const g=s[r++],v=o.outlineMaterial,_=new vn(e,v.geometryLayout,new Int32Array(n.buffer,4*r,g));r+=g;const x=s[r++],S=id.createIndex(e,35044,new Uint32Array(s.buffer,4*r,x));r+=x,this.fillVAO=new H0(e,u,f),this.outlineVAO=new H0(e,_,S)}},HGt=class extends rW{constructor(e,i,r){super(e,i),this.type=3,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),a=new Float32Array(e);let o=this.bufferDataOffset;this.isIconSDF=!!s[o++];const l=s[o++],u=s[o++],d=s[o++],f=new t_(l,u,d,0),g=s[o++];for(let S=0;S<g;S++){const T=s[o++],M=s[o++],E=s[o++];this.iconPerPageElementsMap.set(T,[M,E])}const v=s[o++];for(let S=0;S<v;S++){const T=s[o++],M=s[o++],E=s[o++];this.glyphPerPageElementsMap.set(T,[M,E])}const _=s[o++],x=s[o++];this.iconOpacity=new Int32Array(_),this.textOpacity=new Int32Array(x),o=NGt(s,n,a,o,this.symbols,r,f),this.bufferDataOffset=o}get usedMemory(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+n$(this.iconOpacity)+n$(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const i of this.iconPerPageElementsMap.values())e+=i[1];for(const i of this.glyphPerPageElementsMap.values())e+=i[1];return e/3}doDestroy(){this.iconVAO=jt(this.iconVAO),this.textVAO=jt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.buffer("opacity");e.length>0&&e.byteLength===i.usedMemory&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textVAO.buffer("opacity");r.length>0&&r.byteLength===s.usedMemory&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++],o=this.layer,l=o.iconMaterial,u=new vn(e,l.geometryLayout,new Int32Array(n.buffer,4*r,a));r+=a;const d=s[r++],f=id.createIndex(e,35044,new Uint32Array(s.buffer,4*r,d));r+=d;const g=s[r++],v=o.textMaterial,_=new vn(e,v.geometryLayout,new Int32Array(n.buffer,4*r,g));r+=g;const x=s[r++],S=id.createIndex(e,35044,new Uint32Array(s.buffer,4*r,x));r+=x;const T=new vn(e,l.opacityLayout,this.iconOpacity.buffer),M=new vn(e,v.opacityLayout,this.textOpacity.buffer);this.iconVAO=new H0(e,new Map([["geometry",u],["opacity",T]]),f),this.textVAO=new H0(e,new Map([["geometry",_],["opacity",M]]),S)}},WGt=class extends rW{constructor(e,i){super(e,i),this.type=4,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=jt(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),a=s[r++],o=this.layer.circleMaterial,l=new vn(e,o.geometryLayout,new Int32Array(n.buffer,4*r,a));r+=a;const u=s[r++],d=id.createIndex(e,35044,new Uint32Array(s.buffer,4*r,u));r+=u,this.vao=new H0(e,l,d)}},lg=class extends be{constructor(e){super(e),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=Eo()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=Eo()),this._fadeOutResolver.promise}transitionStep(e,i){const r=ie("mapview-transitions-duration"),s=r?1/r:0;if(s===0)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const n=this._fadeOutResolver||!this.visible?0:this.opacity,a=this.computedOpacity;if(a===n)this.computedVisible=this.visible;else{const o=e*s;this.computedOpacity=a>n?Math.max(n,a-o):Math.min(n,a+o),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};c([p()],lg.prototype,"computedOpacity",void 0),c([p()],lg.prototype,"computedVisible",void 0),c([p()],lg.prototype,"opacity",void 0),c([p()],lg.prototype,"visible",void 0),c([p()],lg.prototype,"transitioning",null),c([p()],lg.prototype,"_fadeOutResolver",void 0),c([p()],lg.prototype,"_fadeInResolver",void 0),lg=c([R("esri.views.2d.engine.transitions.FadeTransition")],lg);let ZGt=class extends Oce{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get fadeTransitionEnabled(){return this._fadeTransition!==null}set fadeTransitionEnabled(e){!this._fadeTransition&&e?(this._fadeTransition=new lg({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!e&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const i=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i?.trashDisplayObject(this)}get transforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get usedMemory(){return 0}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(e){this._transitionables??=[],this._transitionables.push(e),this.requestRender()}removeTransitionable(e){e.endTransition(),this._transitionables&&oP(this._transitionables,e),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),e}fadeOut(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),e}endTransitions(){if(this._transitionables){for(const e of this._transitionables)e.endTransition();this.requestRender()}}beforeRender(e){this.transitionStep(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some(e=>e.transitioning)??!1}transitionStep(e,i){if(this._transitionables)for(const r of this._transitionables)r.transitionStep(e,i)}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},A7e=class extends ZGt{constructor(e,i,r,s,n,a,o=n,l=a){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new t_(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=a,this.rangeX=o,this.rangeY=l}destroy(){super.destroy(),this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*i,o=this.height/this.rangeY*i;b0(r,a,0,0,0,o,0,s,n,1),KT(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},YGt=class O7e extends A7e{constructor(e,i,r,s,n,a,o,l=null){super(e,i,r,s,n,a,$L,$L),this.styleRepository=o,this._owner=l,this.type="vector-tile",this._referenced=1,this._hasSymbolBuckets=!1,this._usedMemory=256,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this.id=e.id}get styleLayerUIDs(){return Array.from(this.layerData.keys())}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<poe}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<poe)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e){const s=this.layerData.get(r);s&&(this._usedMemory-=s.usedMemory,s.type===3&&this.symbols.delete(r)&&(i=!0),s.destroy(),this.layerData.delete(r))}this._owner?.updateTileSize(this),i&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}hasFeatures(){const e=this.layerData.values();for(const i of e)if(i.hasData())return!0;return!1}dispose(){this.status!=="unloaded"&&(O7e._destroyRenderBuckets(this.layerData),this.layerData.clear(),this.featureIndex=null,this._usedMemory=0,this.destroy(),this.status="unloaded")}release(){--this._referenced===0&&(this._owner?.onDisposeTile(this),this.dispose(),this.stage=null)}retain(){++this._referenced}get usedMemory(){return this._usedMemory}get usedMemoryPerReference(){return this._usedMemory/(this._referenced||1)}changeDataImpl(e){this.featureIndex?.clear();let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:s}=e,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const a=new Uint32Array(s);for(const o of a)this._deleteLayerData(o)}for(const[a,o]of n)this._deleteLayerData(a),o.type===3&&(this.symbols.set(a,o.symbols),i=!0),this._usedMemory+=o.usedMemory,this.layerData.set(a,o);this._owner?.updateTileSize(this)}this._hasSymbolBuckets=!1;for(const r of this.layerData.values())r.type===3&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;oF(a),s1(a,a,n),lF(a,a,Math.PI*e.rotation/180),cF(a,a,[r,s,1])}_createTransforms(){return{displayViewScreenMat3:Bg(),tileMat3:Bg(),tileUnitsToPixels:Bg()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const a of n.layerUIDs)i.set(a,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case 1:r=new GGt(e,this.styleRepository);break;case 2:r=new qGt(e,this.styleRepository);break;case 3:r=new HGt(e,this.styleRepository,this);break;case 4:r=new WGt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._usedMemory-=i.usedMemory,i.destroy(),this.layerData.delete(e)}};function n6(t){return(t.uniqueSymbol?.show&&t.uniqueSymbol?.lastShow)??!1}function JGt(t,e){if(t.priority-e.priority)return t.priority-e.priority;if(n6(t)&&!n6(e))return-1;if(n6(e)&&!n6(t))return 1;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let QGt=class{get running(){return this._running}constructor(e,i,r,s,n,a,o,l){this.selectionMode=e,this._visibleTiles=i,this._symbolRepository=r,this._styleRepository=s,this._createCollisionJob=n,this._assignTileSymbolsOpacity=a,this._symbolLayerSorter=o,this._isLayerVisible=l,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_isFeatureFiltered(e,i,r){const s=i.getFilterFlags(e),n=s&_ze,a=r.featureEffect==null||r.featureEffect.excludedLabelsVisible||s&K_t;return!(n&&a)}_getFilteredByLayer(){let e;if(this._styleRepository?.layerContexts)for(const i of this._symbolRepository.uniqueSymbols){const r=this._styleRepository.layerContexts?.get(i.styleLayerUID);if(r?.attributeView)for(const s of i.uniqueSymbols){e??=new Map,e.get(i.styleLayerUID)||e.set(i.styleLayerUID,new Set);const n=e.get(i.styleLayerUID),a=r.attributeView,o=r.layerView;this._isFeatureFiltered(s.id,a,o)&&n.add(s.id)}}return e}_resetSelection(){for(let e=0;e<this._symbolRepository.uniqueSymbols.length;e++){const i=this._symbolRepository.uniqueSymbols[e];for(let r=0;r<i.uniqueSymbols.length;r++){const s=i.uniqueSymbols[r];for(const n of s.tileSymbols)n.selectedForRendering=!1}}}_createSelectionJob(){const e=this.selectionMode==="feature-tile"?KGt:e9t,i=this._symbolRepository.uniqueSymbols;this._resetSelection();const r=[];let s=0,n=0;const a=this._isLayerVisible,o=this._getFilteredByLayer(),l=this._styleRepository?.layerContexts;function u(f){let g;const v=performance.now();for(;n<i.length;n++,s=0){const _=i[n],x=_.styleLayerUID,S=o?.get(x);let T=0;if(l){const E=l.get(x).layerView;T=E.view.allLayerViews.items.indexOf(E)}if(!a(x)){r[n]||(r[n]={styleLayerUID:x,layerOrder:T,symbols:[]});continue}r[n]||={styleLayerUID:x,symbols:[],layerOrder:T};const M=r[n];for(;s<_.uniqueSymbols.length;s++){if(g=_.uniqueSymbols[s],s%100==99&&performance.now()-v>f)return!1;if(g.lastShow=g.show,g.id&&S?.has(g.id)){g.show=!1,g.parts[0].show=!1,g.parts[1].show=!1;continue}const E=e(g);if(E){E.selectedForRendering=!0,M.symbols.push(E),g.show=!0;for(const P of g.parts)P.show=!0}else g.show=!1}}for(const _ of r)_.symbols.sort(JGt);return r.sort((_,x)=>x.layerOrder-_.layerOrder),!0}const d=this._symbolLayerSorter;return{work:u,get sortedSymbols(){return r.sort(d)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,a){for(const o of n.symbols.values())XGt(o,a);e(n,a);for(const o of n.childrenTiles)s(o,a)}return{work(n){const a=performance.now();for(;r<i.length;r++){if(performance.now()-a>n)return!1;const o=i[r];if(o.parentTile!=null)continue;const l=performance.now();o instanceof YGt?s(o,l):e(o,l)}return!0}}}};function XGt(t,e){for(const i of t){const r=i.uniqueSymbol;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/poe),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}function KGt(t){let e=null,i=null,r=null;for(const s of t.tileSymbols){const n=s.tile;n.isReady&&n.isCoverage?e=s:n.isReady?i=s:n.rendering&&(r=s)}return e??i??r}function e9t(t){let e=null,i=!1,r=!1;for(const s of t.tileSymbols)if(!r||!i){const n=s.tile;(!e||n.isCoverage||n.neededForCoverage&&!i)&&(e=s,(n.neededForCoverage||n.isCoverage)&&(r=!0),n.isCoverage&&(i=!0))}return r?e:null}let t9t=class foe{static fromSymbols(e,i){let r=e.length;if(r>=i9t){let s=i;do s/=2,r/=4;while(r>r9t&&s>s9t);const n=new E7e(i,i,s);for(const a of e)n.getCell(a.xTile,a.yTile).push(a);return new foe(i,e,n)}return new foe(i,e,null)}constructor(e,i,r){this.tileCoordRange=e,this._symbols=i,this._index=r}addSymbols(e){for(const i of e)this._symbols.push(i);if(this._index)for(const i of e)this._index.getCell(i.xTile,i.yTile).push(i)}removeSymbols(e){const i=new Set(e);if(this._symbols=this._symbols.filter(r=>!i.has(r)),this._index)for(const r of this._index.cells)for(let s=0;s<r.length;s++)r[s]=r[s].filter(n=>!i.has(n))}getSymbols(){return this._symbols}getCandidate(e,i,r,s){if(!this._index){for(const d of this._symbols)if(r===d.hash&&Math.abs(e-d.xTile)<=s&&Math.abs(i-d.yTile)<=s)return d;return null}const n=this._index.getCellSpan(e-s,i-s,e+s,i+s),[a,o,l,u]=n;for(let d=o;d<=u;d++)for(let f=a;f<=l;f++){const g=this._index.cells[d][f];for(const v of g)if(r===v.hash&&Math.abs(e-v.xTile)<=s&&Math.abs(i-v.yTile)<=s)return v}return null}};const i9t=32,r9t=8,s9t=64,p3e=20;let n9t=class{constructor(e,i){this.tileCoordRange=e,this._visibleTiles=i,this._indexMapByTile=new Map,this._uniqueSymbolsByStyleLayerId=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}registerVectorTile(e,i){const r=this._ensureIndexMap(e),s=i?.values()??r.keys();for(const n of s){const a=r.get(n);a&&(this._removeSymbols(n,a.getSymbols()),r.delete(n))}this._addSymbols(e.key,r,e.symbols),this._invalidate()}unregisterVectorTile(e){this._removeTile(e),this._invalidate()}registerFeatureTile(e){this._ensureIndexMap(e),this._invalidate()}unregisterFeatureTile(e){this._removeTile(e),this._invalidate()}insertFeatureTileMetrics(e,i){const r=this._indexMapByTile.get(e);if(!r)throw new Error(`tile ${e.id} not registered!`);this._addSymbols(e.key,r,f3e(i)),this._invalidate()}removeFeatureTileMetrics(e,i){const r=this._indexMapByTile.get(e);if(!r)return;const s=f3e(i);for(const[n,a]of r.entries()){const o=s.get(n);o&&(a.removeSymbols(o),this._removeSymbols(n,o))}this._invalidate()}deleteStyleLayers(e){for(const i of this._indexMapByTile.values())for(const r of e){const s=i.get(r);s&&(this._removeSymbols(r,s.getSymbols()),i.delete(r))}this._invalidate()}querySymbols(e,i,r,s){const n=[];for(const[a,o]of this._uniqueSymbolsByStyleLayerId.entries())for(const l of o){const u=l.tileSymbols.find(d=>d.selectedForRendering);u&&UGt(u,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:u,styleLayerUID:a,tileKey:u.tile.key})}return n}_ensureIndexMap(e){let i=this._indexMapByTile.get(e);return i||(i=new Map,this._indexMapByTile.set(e,i)),i}_invalidate(){this._uniqueSymbolLayerArray=null}_addSymbols(e,i,r){for(const[s,n]of r){let a=i.get(s);a?a.addSymbols(n):(a=t9t.fromSymbols(n,this.tileCoordRange),i.set(s,a))}this._updateUniqueSymbols(e,r)}_removeTile(e){const i=this._indexMapByTile.get(e);if(i){for(const[r,s]of i.entries())this._removeSymbols(r,s.getSymbols());this._indexMapByTile.delete(e),this._invalidate()}}_removeSymbols(e,i){for(const r of i){const s=r.uniqueSymbol;if(s){if(s.tileSymbols=s.tileSymbols.filter(n=>n!==r),s.tileSymbols.length===0){const n=this._uniqueSymbolsByStyleLayerId.get(e);n.delete(s),n.size===0&&this._uniqueSymbolsByStyleLayerId.delete(e)}r.uniqueSymbol=null}}}_updateUniqueSymbols(e,i){if(i.size!==0){for(const r of this._visibleTiles)r.parentTile||r.key.world!==e.world||r.key.level===e.level&&!r.key.equals(e)||this._matchSymbols(r,e,i);for(const[r,s]of i)for(const n of s)if(!n.uniqueSymbol){n.uniqueSymbol=new LGt(n);let a=this._uniqueSymbolsByStyleLayerId.get(r);a||(a=new Set,this._uniqueSymbolsByStyleLayerId.set(r,a)),a.add(n.uniqueSymbol)}}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}const s=new Map;for(const[n,a]of r){const o=[],l=e.key.level<i.level?1:1<<Math.abs(e.key.level-i.level),u=this._indexMapByTile.get(e),d=u?.get(n);if(d)for(const f of a){if(f.uniqueSymbol)continue;const g=FGt(this.tileCoordRange,f.xTile,i,e.key),v=zGt(this.tileCoordRange,f.yTile,i,e.key),_=-p3e,x=this.tileCoordRange+p3e;if(!(g>=_&&g<x&&v>=_&&v<x)){o.push(f);continue}const S=d.getCandidate(g,v,f.hash,l),T=S?.uniqueSymbol;T?(f.uniqueSymbol=T,T.tileSymbols.push(f)):o.push(f)}o.length>0&&s.set(n,o)}for(const n of e.childrenTiles||[])this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsByStyleLayerId,i=new Array(e.size);let r,s=0;for(const[n,a]of e){const o=new Array(a.size);r=0;for(const l of a)o[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:o},s++}return i}};function f3e(t){const e=new Map;for(const i of t){const r=i.labelClassId;let s=e.get(r);s||(s=[],e.set(r,s)),s.push(i)}return e}function a9t(t,e){const i=t.transforms.tileUnitsToPixels,r=nF(e),s=Math.cos(r),n=Math.sin(r),a=Math.ceil(512*(Math.abs(n)+Math.abs(s)));oF(Um),s1(Um,Um,[a/2,a/2]),lF(Um,Um,r),s1(Um,Um,[-256,-256]),cF(Um,Um,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=Um;const o=[],l=new n9t($L,o),u=new QGt("vector-tile",o,l,null,(d,f,g)=>new BGt(d,f,g,t.styleRepository,t.key.level,e),(d,f)=>{VGt(d,f,!1)},()=>0,d=>{const f=t.styleRepository.getStyleLayerByUID(d).getLayoutProperty("visibility");return!f||f.getValue()!==1});o.push(t),l.registerVectorTile(t),u.setScreenSize(a,a),u.continue(1/0),l.unregisterVectorTile(t),t.transforms.tileUnitsToPixels=i}const Um=Bg();let o9t=class extends A7e{_createTransforms(){return{displayViewScreenMat3:Bg(),tileMat3:Bg()}}},l9t=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}},c9t=class{constructor(){this._renderParams={reshuffleManager:new l9t,context:null,drawPhase:1,state:new u9t,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null,animationsEnabled:!0},this._backgroundTile=new o9t(new t_(0,0,0,0),0,0,0,d3e,d3e,$L,$L),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,a,o,l,u,d){const f=this._backgroundTile;this._updateRenderParameters(e,i,f,r,n,a,o,l,u,d),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,f,s)}renderContent(e,i,r,s,n,a,o,l,u,d,f,g){this._declutter(r),s.forAll(({sourceLayerInfo:{data:x}})=>this._declutter(x));const v=s.length>0;v&&this._stencilSymbols(e,i,r,s,n,a,o,l,u,d,f,g);let _=1;r.stencilRef=v?_:0,e.setStencilFunction(514,r.stencilRef,255),this._render(e,i,r,n,a,o,l,u,d,f,g),s.forAll(({sourceLod:x,offset:S,sourceLayerInfo:{data:T}})=>{T.stencilRef=++_,this._renderSymbols(e,x,T,n,a,o,l,S,d,f,g)})}_stencilSymbols(e,i,r,s,n,a,o,l,u,d,f,g){let v=1;r.stencilRef=v,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,a,o,l,u,d,f,g),s.forAll(({sourceLod:_,offset:x,sourceLayerInfo:{data:S}})=>{S.stencilRef=++v,e.setStencilFunction(519,S.stencilRef,255),this._stencilTileSymbols(e,_,S,n,a,o,l,x,d,f,g)}),e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,a,o,l,u,d,f){e.setStencilFunction(514,r.stencilRef,255),this._render(e,i,r,s,n,a,o,l,u,d,f,3)}_render(e,i,r,s,n,a,o,l,u,d,f,g){this._updateRenderParameters(e,i,r,s,a,o,l,u,d,f),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,g)}_stencilTileSymbols(e,i,r,s,n,a,o,l,u,d,f){this._updateRenderParameters(e,i,r,s,a,o,l,u,d,f),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,a,o,l,u,d){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const f=i[0]-n.getLevelShift(i[0]),g=this._renderParams;g.context=e,g.painter=s,g.glyphMosaic=s.glyphMosaic,g.spriteMosaic=s.spriteMosaic,g.pixelRatio=u*d,g.displayLevel=f,g.requiredLevel=f;const v=n.getScale(i[0]),[_,x]=n.getOffset(i,a*v),S=TGt*a*v/l,T=r.transforms.displayViewScreenMat3;T[0]=S,T[4]=-S,T[6]=-1-_-o[0]*a*2,T[7]=1+x+(1-o[1])*a*2-2;const M=g.state,E=l/d;M.size[0]=E,M.size[1]=E,M.pixelRatio=d,M.rotation=(360-this._heading)%360;const P=2/E;b0(M.displayViewMat3,P,0,0,0,-P,0,-1,1,1);const O=oF(M.displayMat3),D=nF(this._heading);s1(O,O,[E/2,E/2]),lF(O,O,D),s1(O,O,[-E/2,-E/2]),KT(O,M.displayViewMat3,O)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(a9t(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},u9t=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=Jr(),this.displayViewMat3=Jr(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}},P7e=class extends Tl{constructor(){super(...arguments),this.blendMode=0}};c([ue({count:31})],P7e.prototype,"blendMode",void 0);let c5=class extends P7e{constructor(){super(...arguments),this.output=1,this.baseOpacityMode=0,this.premultipliedSource=0}};c([ue({count:5})],c5.prototype,"output",void 0),c([ue({count:2})],c5.prototype,"baseOpacityMode",void 0),c([ue({count:2})],c5.prototype,"premultipliedSource",void 0);let R7e=class extends c5{constructor(){super(...arguments),this.background=0}};c([ue({count:2})],R7e.prototype,"background",void 0);function h9t(t){t.fragment.uniforms.add(new Gt("u_colormap",e=>e.u_colormap),new _t("u_colormapOffset",e=>e.colormap.u_colormapOffset),new _t("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new _t("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(A`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function d9t(t){t.fragment.uniforms.add(new Gt("u_transformGrid",e=>e.u_transformGrid),new rc("u_transformSpacing",e=>e.common.u_transformSpacing),new rc("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(A`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let p9t=class extends x7e{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function f9t(t,e){t.include(d9t),t.fragment.uniforms.add(new Gt("u_image",r=>r.u_image),new GO("u_flipY",r=>r.common.u_flipY),new GO("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new rc("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(A`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(A`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(A`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let sW=class extends p9t{constructor(e,i,r,s,n,a){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=a,this.backgroundColor=Aa,this.fboTexture=null,this.baseOpacity=1}},I7e=class extends sW{},D7e=class extends sW{};function k7e(t){const e=new Gi;return e.include(S7e),e.include(f9t,t),e.include(h9t,t),e.include(T7e,t),e.fragment.code.add(A`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===0?g9t(e,t):t.colorizerType===1?m9t(e):t.colorizerType===2&&y9t(e,t),e}function m9t(t){t.fragment.main.add(A`vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));`)}function g9t(t,e){t.fragment.uniforms.add(new q1("u_bandCount",r=>r.symbolizer.u_bandCount),new Lu("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Lu("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Lu("u_factor",r=>r.symbolizer.u_factor,3),new _t("u_minOutput",r=>r.symbolizer.u_minOutput),new _t("u_maxOutput",r=>r.symbolizer.u_maxOutput),new GO("u_useGamma",r=>r.symbolizer.u_useGamma),new Lu("u_gamma",r=>r.symbolizer.u_gamma,3),new Lu("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new _t("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(A`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?A`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:A`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.main.add(A`
    vec2 pixelLocation = getPixelLocation(uv);
    if (isOutside(pixelLocation)) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }

    vec4 currentPixel = getPixel(pixelLocation);
    ${e.stretchType===0?A`fragColor = applyBackgroundBlend(currentPixel);`:A`
    if (currentPixel.a == 0.0) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }
    if (u_bandCount == 1) {
      float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      ${i}
    } else {
      float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
      float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
      fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
    }`}`)}function y9t(t,e){const i=t.fragment;i.uniforms.add(new Gt("u_image",s=>s.u_image),new q1("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Lu("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Lu("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Lu("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Lu("u_weights",s=>s.symbolizer.u_weights,6),new rc("u_factor",s=>s.symbolizer.u_factor),new _t("u_minValue",s=>s.symbolizer.u_minValue),new _t("u_maxValue",s=>s.symbolizer.u_maxValue),new rc("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(zP),i.code.add(A`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(A`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?A`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:A`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.main.add(A`
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}`)}const v9t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:D7e,ColorizerStretchUniforms:I7e,ColorizerUniforms:sW,build:k7e},Symbol.toStringTag,{value:"Module"}));let m3e=class extends er{constructor(e,i){super(e,i,new Hi(v9t,()=>W(()=>Promise.resolve().then(()=>$ri),void 0)),Rp(zF))}},Uk=class extends c5{constructor(){super(...arguments),this.colorizerType=0,this.stretchType=0,this.applyColormap=!0,this.requireBilinearWithNN=!1}};c([ue({count:3})],Uk.prototype,"colorizerType",void 0),c([ue({count:2})],Uk.prototype,"stretchType",void 0),c([ue()],Uk.prototype,"applyColormap",void 0),c([ue()],Uk.prototype,"requireBilinearWithNN",void 0);let g3e=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new U1(this._rctx,new ar(e),new SRt(Jg.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};function H1(t,e=0,i=-1,r=1){const s=e===1,n=s?Gf?new Float32Array([i,i,0,r,i,0,i,r,0,r,r,0]):new Float32Array([i,i,0,0,r,i,1,0,i,r,0,1,r,r,1,1]):new Float32Array([i,i,r,i,i,r,r,r]);if(s&&Gf){const a=zUe(n.buffer);a[10]=a[17]=a[22]=a[23]=1}return new bm(t,new vn(t,s?Gf?zF:vRt:Rde,n))}const _9t=4;function L7e(t){const e=new ar(_9t);return e.samplingMode=9728,new qi(t,e)}const b9t=()=>re.getLogger("esri.views.3d.terrain");let w9t=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new c9t,this._bindParameters=new pfe(null),this._blendConfiguration=new R7e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vao=H1(this._rctx,1)}dispose(){this._fbos.forEach(jt),this._fbos=null,this._vtFBO=jt(this._vtFBO),this._vao=jt(this._vao),this._vectorTileHelper=jt(this._vectorTileHelper)}updateHeading(e){this._vectorTileHelper?.updateHeading(e)}_acquireBlendTechnique(e,i,r,s=0,n=0){return this._blendConfiguration.output=i,this._blendConfiguration.blendMode=e,this._blendConfiguration.baseOpacityMode=r,this._blendConfiguration.premultipliedSource=s,this._blendConfiguration.background=n,this._techniques.precompile(h3e,this._blendConfiguration),this._techniques.get(h3e,this._blendConfiguration)}drawBackground(e,i){const r=this._acquireBlendTechnique(0,i?2:3,0,0,1),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),this._rctx.drawArrays(Sr.TRIANGLE_STRIP,0,this._vao.vertexCount("geometry"))}drawGroup(e,i,r,s,n=1){i===1&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture,e.fboTexture==null&&(e.fboTexture=this._rctx.emptyTexture)),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=e.baseOpacity<1?1:0,o=this._acquireBlendTechnique(s,i,a,n),l=this._rctx.bindTechnique(o,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=0){if(e.texture==null)return;const a=e.baseOpacity<1?1:0;e.fboTexture=i===4||s===0&&a===0&&n===0?null:this.switch(r).colorTexture,e.fboTexture==null&&(e.fboTexture=this._rctx.emptyTexture);const o=this._acquireBlendTechnique(s,i,a,n),l=this._rctx.bindTechnique(o,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const a=n.sourceLayerInfo.data;if(!a.source||(n.tile.surface.layerViewByIndex(n.layerIndex,1).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;const o=e.baseOpacity<1?1:0;e.fboTexture=s===0&&o===0?null:this.switch(r).colorTexture;const l=this._acquireRasterTechnique(a,i,s,o);if(!l)return;a.opacity=e.opacity;const u=a.getUniforms(this._rctx);u.scale=n.scale,u.offset=n.offset,u.backgroundColor=e.backgroundColor,u.fboTexture=e.fboTexture,u.baseOpacity=e.baseOpacity;const d=this._rctx.bindTechnique(l,this._bindParameters,u);this._render(d)}_acquireRasterTechnique(e,i,r,s){if(!this._rctx.capabilities.colorBufferFloat)return null;const n=e.symbolizerParameters,a=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterConfiguration??=new Uk,this._rasterConfiguration.output=i,this._rasterConfiguration.blendMode=r,this._rasterConfiguration.baseOpacityMode=s,this._rasterConfiguration.colorizerType=a,this._rasterConfiguration.applyColormap=!!n.colormap,this._rasterConfiguration.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterConfiguration.stretchType=e.hasStretchTypeNone()?0:1,this._techniques.precompile(m3e,this._rasterConfiguration),this._techniques.get(m3e,this._rasterConfiguration)}drawVectorData(e,i,r,s,n,a,o,l){const u=this._rctx,d=n.sourceLayerInfo.data,f=n.tile.surface.layerViewByIndex(n.layerIndex,1),g=e.baseOpacity<1?1:0,v=g===1||e.opacity<1||s!==0||i!==1,_=v?1:0,x=this._acquireBlendTechnique(s,i,g,_);u.setPipelineState(x.getPipeline());let S=null,T=null;v?(T=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new g3e(this._rctx)),S=this._vtFBO.get(r),u.bindFramebuffer(S),this._clearCurrentFBO()):l&&u.clear(256);try{this._vectorTileHelper.renderBackground(u,n.sourceLod,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/n.scale),n.offset,o,a,f.contentZoom),d&&this._vectorTileHelper.renderContent(u,n.sourceLod,d,n.vtlNeighborInfos,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/n.scale),n.offset,o,a,f.contentZoom)}catch(M){b9t().warnOnce("A render call containing vector tiles did not resolve correctly.",M)}return!S||(u.bindFramebuffer(T),e.texture=S.colorTexture,e.offset=f1,e.scale=1,this.drawImageData(e,i,r,s,_),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,qi.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(3553,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,qi.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(17664)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new g3e(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},x9t=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Ai({allocator:e=>e||new S9t})}},S9t=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},y3e=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1,this._texture.descriptor.context.instanceCounter.increment(mn.TileTexture,this)}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&(this._cache?(this._texture.abortCompression(),this._cache.put(moe(this.descriptor),this)):this.dispose())}dispose(){this._texture.descriptor.context.instanceCounter.decrement(mn.TileTexture,this),this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}};function moe(t,e=Tze(t.internalFormat)){return`${t.width} ${t.pixelFormat} ${e}`}const goe={normal:0,average:1,lighten:2,lighter:3,screen:5,plus:4,"color-dodge":6,darken:7,multiply:8,"color-burn":9,overlay:10,"soft-light":11,"hard-light":12,"vivid-light":13,hue:14,saturation:15,luminosity:16,color:17,difference:26,exclusion:27,minus:28,invert:29,reflect:30,"destination-over":18,"destination-atop":19,"destination-in":20,"destination-out":21,"source-atop":22,"source-in":23,"source-out":24,xor:25};function T9t(t){return t===18||t===19||t===20||t===21||t===22||t===23||t===24||t===25}let $9t=class{constructor(e,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=Rke(e,{...n,schedule:s}).then(a=>{if(this._thread===void 0){this._thread=a,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const o of this._listeners)this._connectListener(o)}else a.close()}),this._promise.catch(a=>re.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${a}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),bi(()=>{r.removed=!0,oP(this._listeners,r),this._thread&&r.threadHandle!=null&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,i,r){return this.invokeMethod(this._mainMethod,e,i,r)}invokeMethod(e,i,r,s){if(this._thread){const n=this._transferLists[e],a=n?n(i):[];return this._thread.invoke(e,i,{transferList:a,signal:r,priority:s})}return this._promise?this._promise.then(()=>(ct(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(C9t):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}};function C9t(){}function F7e(t,e){let i=e.width,r=e.height;return(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(i=t.width,r=t.height),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof Uint8Array)&&(e.pixelFormat===6408||e.pixelFormat===6407)&&qT(i)&&qT(r)&&i>=16&&r>=16}let M9t=class extends $9t{constructor(e){super("TextureCompressionWorker","compress",{compress:i=>[i.data]},e)}async destroyWorkerAndSelf(){await this.broadcast({},"destroy"),this.destroy()}isCompressible(e,i){return F7e(e,i)}},E9t=class{constructor(e,i,r,s,n,a){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=a}},A9t=class{constructor(e,i,r,s,n){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=s,this._compressionTracker=n,this._passParameters=new SGt,this._backgroundColor=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new w9t(this._rctx,this._techniques)}dispose(){this._compositor=jt(this._compositor),this._backgroundTexture=Lr(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){this._compositor?.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,a=0,o=this.tileSize,l=!1,u=!1;const d=r.view.state.contentPixelRatio;let f=!1;i9.clear(),mM.length=0;const g=e.layerInfo[1];let v=0,_=null;for(;v<g.length;v++){const S=r.layerViewByIndex(v,1),T=S.layer,M=!BS(e,S),E=T.opacity,P=S.fullOpacity;if(u=u||oU(T),u3e(S))continue;if(wL(S)){let L=S.layer.blendMode!=="normal";if(MO(T.parent)){const F=T.parent.uid;F!=null&&F!==""&&(L=z7e(T.parent)||L)}L&&(f=L,l=!1)}if((M||E===0)&&!f){g[v].pendingUpdates&=-1;continue}++a;const O=KO(S),D=$K(e,v,O);if(D){if(g[v].pendingUpdates&=-1,MO(T.parent)){const L=T.parent.uid;L!=null&&L!==""&&N7e(T.parent,v)}O?o=Math.max(o,this.tileSize*d):s===1&&P===1&&(S.isOpaque||this._dataToTexture(D,xJ(T))&&D.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,_===null&&(_=v)}}const x=o/this.tileSize;n!==0&&_!==null?n===1&&!f&&this._useLayerTexture(e,_)||this._composeLayers(e,i,v-1,u,o,x,!l||f,i9,f):this._useBackgroundTexture(e,a,i!==0)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundTexture&&this._drawBackgroundTexture(this._backgroundTexture))}_ensureBackgroundTexture(){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(this.tileSize,!1),this._drawBackgroundTexture(this._backgroundTexture)),this._backgroundTexture}_drawBackgroundTexture(e){this._compositor.bind(this.tileSize),this._passParameters.offset=f1,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(e),this._compositor.unbind()}_useBackgroundTexture(e,i,r){const s=e.renderData,n=!r&&s.textureReference!=null&&(e.surface.view.layerViewManager.updating||i>0)?5e3:0,a=this._ensureBackgroundTexture();s.setTextureReference(new t8(a,0,v3e,e.surface.baseOpacity,0,1),n)}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,1),s=oU(r.layer),n=s?e.surface.baseOpacity:1,a=s?1:e.surface.baseOpacity,o=r.fullOpacity,l=$K(e,i,!1);return!!this._dataToTexture(l,xJ(r.layer))&&(e.renderData.setTextureReference(new t8(l.sourceLayerInfo.data,0,$i(l.offset[0],l.offset[1],l.scale,l.scale),n,a,o)),!0)}_composeLayers(e,i,r,s,n,a,o,l,u){this._compositor.ensureBuffer(n);const d=e.surface.baseOpacity;let f=!1,g=9987,v=!1,_=0;for(let M=r;M>=0;M--){const E=e.surface.layerViewByIndex(M,1),P=E.layer,O=KO(E),D=$K(e,M,O),L=P.opacity,F=!BS(e,E);if(!D||(L===0||F)&&!u||u3e(E))continue;const j=!oU(P)&&!f;j&&(f=!0);let N=!1;l.forEach(Q=>{Q.start===M&&(Q.output=s?1:o&&j?this.backgroundIsGrid?3:2:1,Q.baseOpacity=j?d:1,mM.push(Q),this._compositor.openGroup(n),N=!0)});const B=N?4:o&&_===0?this.backgroundIsGrid?3:2:1,U=goe[wL(E)?E.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=j&&!N&&d<1?d:1,this._passParameters.opacity=L,dBt(D)?v=this._compositor.drawVectorData(this._passParameters,B,n,U,D,a,this.tileSize,v):hBt(D)?(this._compositor.drawRasterData(this._passParameters,B,n,U,D),O9t(D)&&(g=9728)):this._dataToTexture(D,xJ(P))&&(this._passParameters.texture=D.sourceLayerInfo.data.texture,this._passParameters.offset=D.offset,this._passParameters.scale=D.scale,this._compositor.drawImageData(this._passParameters,B,n,U));mM.length>0&&mM[mM.length-1].end===M;){const Q=mM.pop();this._passParameters.baseOpacity=Q.baseOpacity,this._passParameters.opacity=Q.opacity,this._passParameters.offset=f1,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,Q.output,n,goe[Q.blendMode])}_++}const x=e.renderData,S=u||f&&d<1,T=x.ensureTexture(n,S,i,()=>this._buildTexture(n,S,g));this._compositor.copyFBOToTexture(T),this._compositor.unbind(),x.setTextureReference(new t8(T,i,v3e,f?1:d,0,1))}_dataToTexture(e,i){if(fBt(e)){const r=e.sourceLayerInfo,s=e.scale===1&&!i;r.data=this._buildTexture(r.data,!0,s,e.tile.onCompressionFinished),e.tile.setMemoryDirty()}return pBt(e)}_buildTexture(e,i,r=9987,s=()=>{}){if(e==null)return null;const n=new ar;n.wrapMode=33071,n.samplingMode=typeof r=="boolean"?9987:r,n.maxAnisotropy=this._maxAnisotropy,n.preMultiplyAlpha=!0,n.flipped=!0,n.hasMipmap=!0,i||(n.pixelFormat=6407);const a=this._rctx,o=typeof r=="boolean"&&r;let l;if(typeof e=="number")n.width=n.height=e,l=this._buildTileTexture(n);else if(XH(e))n.isOpaque=e.isOpaque,n.isOpaque&&(n.pixelFormat=6407),n.width=e.element.width,n.height=e.element.height,l=this._buildTileTexture(n,o,s,e.element);else try{n.width=e.width,n.height=e.height,l=this._buildTileTexture(n,o,s,e)}catch{l=new y3e(L7e(a)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const u=a.bindTexture(l.texture,qi.TEXTURE_UNIT_FOR_UPDATES);return l.generateMipmap(),a.bindTexture(u,qi.TEXTURE_UNIT_FOR_UPDATES),l}_buildTileTexture(e,i=!1,r=()=>{},s){const n=this._cache.pop(moe(e,!1))??this._cache.pop(moe(e,!0));if(i&&=F7e(s,e),n)return n.retain(),i?n.texture.enableCompression({compressionTracker:this._compressionTracker,compressionCallback:r}):n.texture.disableCompression(),n.texture.setData(s),n;e.compress=i?{compressionTracker:this._compressionTracker,compressionCallback:r}:void 0;const a=new qi(this._rctx,e,s);return new y3e(a,this._cache)}get test(){}};function $K(t,e,i){qa.layerIndex=e,qa.vtlNeighborInfos.clear();const r=t.layerInfo[1][e];if(oi(qa.offset,0,0),qa.tile=t,qa.scale=1,qa.sourceLod=t.lij,qa.sourceLayerInfo=r,qa.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((a,o)=>{if(a.level!==t.level)return;const l=a.layerInfo[1][e];if(!S9e(l)||r.data===l.data)return;const u=qa.vtlNeighborInfos.pushNew();u.offset=Tv[o],u.sourceLod=a.lij,u.sourceLayerInfo=l}),qa;const s=r.upsampleInfo,n=s?.tile?.layerInfo[1][e];return n&&s.tile?(qa.tile=s.tile,na(qa.offset,s.offset),qa.scale=s.scale,qa.sourceLod=s.tile.lij,qa.sourceLayerInfo=n,qa):i?qa:null}function O9t(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function z7e(t){let e=t.blendMode!=="normal";return MO(t.parent)&&(e=z7e(t.parent)||e),e}function N7e(t,e){MO(t.parent)&&N7e(t.parent,e);const i=t.uid;if(i!=null&&i!==""){const r=i9.get(i);r?r.start=e:i9.set(i,new E9t(e,e,t.blendMode,t.opacity,1,1))}}const i9=new Map,mM=new Array,qa=new x9t,v3e=$i(0,0,1,1),Tv=new Array;function P9t(){qa.sourceLayerInfo=null,qa.tile=null,qa.vtlNeighborInfos.prune()}Tv[0]=[0,-1],Tv[1]=[-1,-1],Tv[2]=[-1,0],Tv[3]=[-1,1],Tv[4]=[0,1],Tv[5]=[1,1],Tv[6]=[1,0],Tv[7]=[1,-1];const R9t=200,CK=40,I9t=.8,D9t=10,Bk=1e-6;function k9t(t,e,i){const r=e,s=i;let n=0,a=1/0;for(let o=0;o<3;++o){{const l=t[o];if(r[o]<l){if(s[o]<=Bk)return!1;const u=(l-r[o])/s[o];n=Math.max(n,u)}else if(s[o]<=-Bk){const u=(l-r[o])/s[o];a=Math.min(a,u)}if(n>a)return!1}{const l=t[o+3];if(r[o]>l){if(s[o]>=-Bk)return!1;const u=(l-r[o])/s[o];n=Math.max(n,u)}else if(s[o]>=Bk){const u=(l-r[o])/s[o];a=Math.min(a,u)}if(n>a)return!1}}return!0}let _3e=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}};var Zw;let V7e=(Zw=class{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=I(),this._callback=w3e,this._intersectionOptions=b3e,this.bspNodeTree=new Array;const n=r-i,a=new(n<V9t?Uint8Array:n<j9t?Uint16Array:Uint32Array)(n);this.triangleIndexMap=a;for(let o=0;o<n;++o)a[o]=o;{const o=N9t(e,i,r,s.data,s.stride),l=Ce(Math.log2(n/CK),2,D9t),u=(d,f,g)=>{const v=F9t(a,o,d,f),_=f-d;if(_<=CK){const P=new _3e(v,void 0,0,d,f);return this.bspNodeTree.push(P),P}const{axis:x,midValue:S}=z9t(v),T=L9t(a,o,d,f,x,S),M=(P,O)=>{if(g>l)return;const D=O-P;return D<CK||D>=I9t*_?void 0:u(P,O,g+1)},E=new _3e(v,x,S,T.next,T.mid);return this.bspNodeTree.push(E),E.leftNode=M(d,T.next),E.rightNode=M(T.mid,f),E};u(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;_qe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),Zw.numFacesTested+=i-e}intersectRay(e,i,r,s){Zw.numFacesTested=0;const n=e,a=i,o=a[0]-n[0],l=a[1]-n[1],u=a[2]-n[2];if(o*o+l*l+u*u<Bk)return;this._rayFrom=n;const d=this._rayDirection;d[0]=o,d[1]=l,d[2]=u;const f=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,f),this._callback=w3e,this._intersectionOptions=b3e}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!k9t(e.aabb,s,n))return;const a=e.axis,o=e.d;if(s[a]<o||n[a]<0){const l=i,u=e.midStartIndex;if(l<u){const d=e.leftNode;d!==void 0?this.intersectRayBSP(d,l,u):this.intersectRayTriangleRange(l,u)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[a]>o||n[a]>0){const l=e.rightStartIndex,u=r;if(l<u){const d=e.rightNode;d!==void 0?this.intersectRayBSP(d,l,u):this.intersectRayTriangleRange(l,u)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}},Zw.numFacesTested=0,Zw);const gM=[1/0,1/0,1/0],yM=[-1/0,-1/0,-1/0];function L9t(t,e,i,r,s,n){let a=i,o=r;for(;a<o;){const u=t[a];e[6*u+s+3]<=n?++a:(--o,t[a]=t[o],t[o]=u)}let l=a;for(o=r;l<o;){const u=t[o-1];e[6*u+s]>=n?--o:(t[o-1]=t[l],t[l]=u,++l)}return{next:a,mid:l}}function F9t(t,e,i,r){if(r<=i)return DO(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)gM[n]=e[s+0+n],yM[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let a=0;a<3;++a)gM[a]=Math.min(gM[a],e[n+0+a]),yM[a]=Math.max(yM[a],e[n+3+a])}return DO(gM[0],gM[1],gM[2],yM[0],yM[1],yM[2])}function z9t(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function N9t(t,e,i,r,s){const n=i-e,a=new Float32Array(6*n);for(let o=0;o<n;++o){const l=3*(o+e),u=t[l]*s,d=t[l+1]*s,f=t[l+2]*s;for(let g=0;g<3;++g){const v=r[u+g],_=r[d+g],x=r[f+g];a[6*o+g]=Math.min(v,_,x),a[6*o+3+g]=Math.max(v,_,x)}}return a}const V9t=255,j9t=65535,b3e=new LH,w3e=()=>{};function TCi(t){t.code.add(A`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function U9t(t){t.code.add(A`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function B9t(t,e){if(!e.screenSpaceReflections)return;const i=t.fragment;i.include(Ip),i.uniforms.add(new Z0("nearFar",r=>r.camera.nearFar),new Jo("depthMap",r=>r.depth?.attachment),new _l("proj",r=>r.camera.projectionMatrix),new Vs("invResolutionHeight",r=>1/r.camera.height),new _l("reprojectionMatrix",r=>r.ssr.reprojectionMatrix)).code.add(A`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);
    float dDepthBefore = 0.0;

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        float weight = dDepth / (dDepth - dDepthBefore);
        vec2 Pf = mix(P - dP, P, 1.0 - weight);
        if (abs(Pf.y - projectedCoordStart.y) > invResolutionHeight) {
          return vec3(Pf, depth);
        }
        else {
          return vec3(P, depth);
        }
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
      dDepthBefore = dDepth;
    }
    return vec3(P, 0.0);
  }
  `)}function q9t(t){t.fragment.uniforms.add(new Vs("cloudAbsorption",e=>e.clouds.absorption),new Vs("cloudCoverage",e=>e.clouds.coverage)).code.add(A`vec4 lookupCloudsFromTextureArray(sampler2DArray cubeMap, vec3 rayDir) {
int faceIndex;
vec2 uv;
if(rayDir.z <= 0.0) {
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudCoverage), abs(dot(rayDir, vec3(0, 0, 1))));
float shading = clamp(1.0 - cloudAbsorption, 0.6, 1.0) * (1.0 - hazeFactor);
float totalTransmittance = hazeFactor;
return vec4(shading, totalTransmittance, shading, totalTransmittance);
}
if (abs(rayDir.x) >= abs(rayDir.y) && abs(rayDir.x) >= abs(rayDir.z)) {
if(rayDir.x > 0.0) {
faceIndex = 0;
uv = rayDir.yz / rayDir.x;
uv = vec2(-uv.x, uv.y);
} else {
faceIndex = 1;
uv = rayDir.yz / rayDir.x;
uv = vec2(-uv.x, -uv.y);
}
} else if (abs(rayDir.y) >= abs(rayDir.x) && abs(rayDir.y) >= abs(rayDir.z)) {
if(rayDir.y > 0.0) {
faceIndex = 2;
uv = rayDir.xz / rayDir.y;
} else {
faceIndex = 3;
uv = rayDir.xz / rayDir.y;
uv = vec2(uv.x, -uv.y);
}
} else {
if(rayDir.y < 0.0) {
faceIndex = 4;
uv = rayDir.xy / rayDir.z;
uv = vec2(uv.x, -uv.y);
} else {
faceIndex = 5;
uv = rayDir.xy / rayDir.z;
uv = vec2(uv.x, -uv.y);
}
}
uv = 0.5 * (uv + 1.0);
if(faceIndex != 5) {
uv.y = uv.y - 0.5;
}
uv.y = uv.y * 2.0;
vec4 s = texture(cubeMap, vec3(uv, float(faceIndex)));
return s;
}`)}let G9t=class extends Ki{constructor(e,i){super(e,"sampler2DArray",0,(r,s)=>r.bindTexture(e,i(s)))}};function j7e(t){const e=t.fragment;e.constants.add("radiusCloudsSquared","float",H9t).code.add(A`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),e.uniforms.add(new Vs("radiusCurvatureCorrection",({clouds:l})=>l.parallax.radiusCurvatureCorrection)).code.add(A`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),e.code.add(A`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),dm(e),Y0(e);const i=Ye(.28,.175,.035);e.constants.add("RIM_COLOR","vec3",i),e.code.add(A`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${A.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${A.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${A.float(.2)} * pow(dirDotLight, ${A.float(10)}) * (1. - pow(sunsetTransition, ${A.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.include(q9t),e.uniforms.add(new FG("readChannelsRG",l=>l.clouds.readChannels===0),new G9t("cubeMap",l=>l.clouds.data?.cubeMap?.colorTexture)).code.add(A`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = lookupCloudsFromTextureArray(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),e.uniforms.add(new Zo("anchorPoint",l=>l.clouds.parallax.anchorPoint),new Zo("anchorPointNew",l=>l.clouds.parallaxNew.anchorPoint),new _l("rotationClouds",l=>l.clouds.parallax.transform),new _l("rotationCloudsNew",l=>l.clouds.parallaxNew.transform),new Vs("cloudsOpacity",l=>l.clouds.opacity),new Vs("fadeFactor",l=>l.clouds.fadeFactor),new FG("crossFade",l=>l.clouds.fadeState===3)).code.add(A`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const H9t=(Ci.radius+yIt)**2;function W9t(t,e){const i=t.fragment;i.include(izt,e),i.include(G1),i.include(U9t),e.cloudReflections&&t.include(j7e),t.include(B9t,e),i.include(NP,e),i.constants.add("fresnelSky","vec3",[.02,1,15]),i.constants.add("fresnelMaterial","vec2",[.02,.1]),i.constants.add("roughness","float",.015),i.constants.add("foamIntensityExternal","float",1.7),i.constants.add("ssrIntensity","float",.65),i.constants.add("ssrHeightFadeStart","float",Nqe),i.constants.add("ssrHeightFadeEnd","float",BG),i.constants.add("waterDiffusion","float",.92),i.constants.add("waterSeaColorMod","float",.8),i.constants.add("correctionViewingPowerFactor","float",.4),i.constants.add("skyZenitColor","vec3",[.52,.68,.9]),i.constants.add("skyColor","vec3",[.67,.79,.9]),i.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(A`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new Vs("lightingSpecularStrength",r=>r.lighting.mainLight.specularStrength),new Vs("lightingEnvironmentStrength",r=>r.lighting.mainLight.environmentStrength)),i.code.add(A`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.cloudReflections&&i.uniforms.add(new Vs("cloudsOpacity",r=>r.clouds.opacity)).code.add(A`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),e.screenSpaceReflections?i.uniforms.add(new _l("view",r=>r.camera.viewMatrix),new Jo("lastFrameColorTexture",r=>r.ssr.lastFrameColor?.getTexture()),new Vs("fadeFactorSSR",r=>r.ssr.fadeFactor)).code.add(A`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):i.code.add(A`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.cloudReflections?e.screenSpaceReflections?i.code.add(A`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(A`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(A`return waterRenderedColor;
}`)}function Z9t(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new mL("overlayTexOffset",(s,n)=>Q9t(s,n)),new mL("overlayTexScale",(s,n)=>X9t(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Gt("ovColorTex",(s,n)=>Y9t(s,n))),U7e(t,e)}function Y9t(t,e){return t.identifier===0&&Ps(t.output)?t.occludedGround?e.overlay?.allSourcesOccluders?e.overlay?.getTexture(1):e.overlay?.getTexture(4):e.overlay?.getTexture(1):t.identifier===0&&t.output===10?e.overlay?.getTexture(5):t.identifier===2?e.overlay?.getTexture(2):null}function qI(t,e){const{vertex:i,fragment:r}=t,{output:s}=e;i.uniforms.add(new x3e("overlayTexOffset"),new x3e("overlayTexScale")),r.uniforms.add(new _t("overlayOpacity",n=>n.overlayOpacity)),s!==9&&r.uniforms.add(new Gt("ovColorTex",(n,a)=>a.overlay?.getTexture(n.overlayContent))),U7e(t,e)}function J9t(t,e){switch(t){case 0:case 1:return e.slot!==9||e.overlay?.allSourcesOccluders?0:4;case 2:case 3:return 0;case 9:return 2;case 4:case 6:case 7:case 8:return null;case 10:return 5}return null}function U7e(t,e){const i=e.pbrMode===3||e.pbrMode===4||e.pbrMode===6;i&&t.include(W9t,e);const{vertex:r,fragment:s,varyings:n}=t;n.add("vtcOverlay","vec4");const{output:a}=e,o=a===9;r.code.add(A`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),s.code.add(A`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),o?s.uniforms.add(new VP("overlayHighlightTexture",(l,u)=>u.overlay?.getTexture(2))).code.add(A`uvec2 getAllOverlayHighlightValuesEncoded() {
vec4 texCoords = vtcOverlay;
vec2 uvInner = texCoords.xy;
vec2 uvOuter = texCoords.zw;
bool isValidInner = isValid(uvInner, fwidth(uvInner));
bool isValidOuter = isValid(uvOuter, vec2(0.0, 0.0));
vec2 texelCoordInner = uvInner * vec2(0.5, 1.0);
vec2 texelCoordOuter = uvOuter * vec2(0.5, 1.0) + vec2(0.5,0.0);
vec2 texDim =  vec2(textureSize(overlayHighlightTexture, 0));
uvec2 texelValueInner = texelFetch(overlayHighlightTexture, ivec2(texelCoordInner * texDim), 0).rg;
uvec2 texelValueOuter = texelFetch(overlayHighlightTexture, ivec2(texelCoordOuter * texDim), 0).rg;
return
isValidInner ? texelValueInner :
isValidOuter ? texelValueOuter :
uvec2(0);
}`):(s.code.add(A`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),s.code.add(A`vec4 getOverlayColorTexel() {
vec4 texCoords = vtcOverlay;
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`)),i&&(dm(s),Y0(s),s.code.add(A`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Q9t(t,e){const i=e.overlay?.overlays[0]?.extent;vq(i)&&(Og[0]=t.toMapSpace[0]/So(i)-i[0]/So(i),Og[1]=t.toMapSpace[1]/Zl(i)-i[1]/Zl(i));const r=e.overlay?.overlays[1]?.extent;return vq(r)&&(Og[2]=t.toMapSpace[0]/So(r)-r[0]/So(r),Og[3]=t.toMapSpace[1]/Zl(r)-r[1]/Zl(r)),Og}function X9t(t,e){const i=e.overlay?.overlays[0]?.extent;vq(i)&&(Og[0]=t.toMapSpace[2]/So(i),Og[1]=t.toMapSpace[3]/Zl(i));const r=e.overlay?.overlays[1]?.extent;return vq(r)&&(Og[2]=t.toMapSpace[2]/So(r),Og[3]=t.toMapSpace[3]/Zl(r)),Og}const Og=li();let x3e=class extends Ki{constructor(e){super(e,"vec4")}};function K9t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(A`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(A`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(A`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function B7e(t,e){e.output===9&&(t.include(FP,e),t.fragment.code.add(A`
    void calculateOcclusionAndOutputHighlight(uvec2 highlightToAdd) {
      uint levelBits = readLevelBits(highlightToAdd, highlightLevel);
      if ((levelBits & 1u) == 0u) discard;
      outputHighlight(isHighlightOccluded());
    }
  `))}function e7t(t,e){e.spherical?t.vertex.code.add(A`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(A`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(A`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(A`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let t7t=class extends Ppe{constructor(){super(...arguments),this.overlayOpacity=1}};function i7t(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new S3e("texOffsetAndScale")),r.uniforms.add(new T3e("tex")),r.uniforms.add(new MK("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new S3e("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new T3e("texNext")),r.uniforms.add(new MK("nextTexOpacities")),r.uniforms.add(new r7t("fadeFactor")));const a=e.tileBlendInput===1,o=e.tileBlendInput===2;o&&r.include(Efe),a&&r.uniforms.add(new MK("backgroundColor")),i.code.add(A`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = texOffsetAndScale.xy + uv * texOffsetAndScale.zw;
    ${we(n,"nvtc = nextTexOffsetAndScale.xy + uv * nextTexOffsetAndScale.zw;")}
  }`),r.code.add(A`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${we(o||a,A`if (opacities.y <= 0.0) {
           return color * opacities.z * opacities.x;
         }
         vec4 bg = vec4(${a?A`backgroundColor`:A`gridColor(uv)`} * opacities.y, opacities.y);
         vec4 layer = color * opacities.z;
         return (bg * (1.0 - layer.a) + layer) * opacities.x;`,"return color;")}
    }`),n?r.code.add(A`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(A`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let r7t=class extends Ki{constructor(e){super(e,"float")}},MK=class extends Ki{constructor(e){super(e,"vec3")}},S3e=class extends Ki{constructor(e){super(e,"vec4")}},T3e=class extends Ki{constructor(e){super(e,"sampler2D")}},Ofe=class extends t7t{};function q7e(t){const e=new Gi,{attributes:i,vertex:r,fragment:s,varyings:n}=e;i.add("position","vec3"),e.include(YF,t),e.include(h0,t);const a=()=>{e.include(e7t,t),r.code.add(A`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};u0(r,t),e.include(Tw);const{output:o,pbrMode:l,overlayMode:u,tileBorders:d,spherical:f,transparencyMode:g,overlayEnabled:v}=t,_=g===2||g===3,x=v&&_;switch(o){case 1:case 0:{e.include(i7t,t),e.include(JO,t),v&&(t.pbrMode=l===5?6:3,e.include(qI,t),t.pbrMode=l);const S=u===2;S&&e.include(K9t,t),n.add("vnormal","vec3"),n.add("vpos","vec3",{invariant:!0}),n.add("vup","vec3"),a(),r.main.add(A`
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);
          vnormal = getNormal();
          vup = getLocalUp(position, localOrigin);
          ${we(S,A`forwardVertexTangent(vnormal);`)}

          forwardTextureCoordinatesWithTransform(uv0);
          ${we(v,"setOverlayVTC(uv0);")}
          ${we(d,"forwardTextureCoordinates();")}
          forwardLinearDepthToReadShadowMap();`),e.include(Ipe,t),s.include(xw,t),e.include(JO,t),s.include(GH,t),W0(s,t),HH(s),YO(s),s.uniforms.add(r.uniforms.get("localOrigin"),new Zo("viewDirection",({camera:M})=>Re($3e,xe($3e,M.viewMatrix[12],M.viewMatrix[13],M.viewMatrix[14])))),S&&s.uniforms.add(new Jo("ovWaterTex",M=>M.overlay?.getTexture(3)),new rpe("view",({origin:M},{camera:E})=>$p(s7t,E.viewMatrix,M)));const T=.2;s.code.add(A`float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),dm(s),Y0(s),s.main.add(A`
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = readShadow(additionalAmbientScale, vpos);
          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${we(v,A`vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
                   vec4 overlayColor = overlayOpacity * overlayColorOpaque;
                   ${we(_,`if (overlayColor.a < ${A.float(ls)}) { discard; }`)}
                   vec4 groundColor = tileColor;
                   tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`)}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a < ${A.float(ls)}) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= ${A.float(T)};
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${l===5||l===6?A`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:A`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${we(S,A`vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
                   float waterNormalLength = length(overlayWaterMask);
                   if (waterNormalLength > 0.95) {
                     mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                     vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                     vec4 viewPosition = view*vec4(vpos, 1.0);
                     vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                     vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                     float opacity = sliced ? ${A.float(T)} : 1.0;
                     // un-gamma the ground color to mix in linear space
                     fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
                   }`)}
          ${we(t.visualizeNormals,f?A`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`:A`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`)}
          ${we(d,A`vec2 dVuv = fwidth(vuv0);
                 vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
                 float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
                 fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`)}
          fragColor = applySlice(fragColor, vpos);`)}break;case 2:x&&e.include(qI,t),r.main.add(A`
        ${we(x,"setOverlayVTC(uv0);")}
        gl_Position = transformPosition(proj, view, position);`),s.main.add(`${we(x,`if (getCombinedOverlayColor().a < ${A.float(ls)}) discard;`)}`);break;case 4:case 5:case 6:case 7:case 8:e.include(Cpe,t),Oqe(e),$pe(e),r.main.add(A`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);`),s.main.add(A`outputDepth(linearDepth);`);break;case 3:x&&e.include(qI,t),n.add("vnormal","vec3"),spe(r),a(),r.main.add(A`
        ${we(x,"setOverlayVTC(uv0);")}
        gl_Position = transformPosition(proj, view, position);
        vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);`),s.main.add(A`
        ${we(x,`if (getCombinedOverlayColor().a < ${A.float(ls)}) discard;`)}
        vec3 normal = normalize(vnormal);
        if (gl_FrontFacing == false) {
          normal = -normal;
        }
        fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case 9:v&&(e.include(qI,t),e.include(B7e,t)),r.main.add(A`
        ${we(v,"setOverlayVTC(uv0);")}
        gl_Position = transformPosition(proj, view, position);`),e.include(FP,t),s.main.add(A`
        ${we(v,A`
           calculateOcclusionAndOutputHighlight(getAllOverlayHighlightValuesEncoded());`,"calculateOcclusionAndOutputHighlight();")}
      `)}if(o===10)if(v)t.pbrMode=0,e.include(qI,t),t.pbrMode=l,r.main.add(A`gl_Position = transformPosition(proj, view, position);
setOverlayVTC(uv0);`),s.main.add(A`fragColor = getOverlayColorTexel();`);else{const S=g===0;r.main.add(A`${we(S,"gl_Position = transformPosition(proj, view, position);")}`),s.main.add(A`fragColor = vec4(0.0);`)}return e}const s7t=ut(),$3e=I(),n7t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Ofe,build:q7e},Symbol.toStringTag,{value:"Module"}));let a7t=class extends er{constructor(e,i){super(e,i,new Hi(n7t,()=>W(()=>Promise.resolve().then(()=>Cri),void 0)),w7e.locations),this.type="TerrainTechnique",this.useStencil=!1}initializePipeline(e){return this._stencilPipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}_createPipeline(e,i){const{renderOccluded:r,output:s}=e,n=e.backfaceCullingEnabled&&!r;return _i({blending:r?j1:null,culling:n?Pde:null,depthTest:r?null:{func:513},depthWrite:r?null:FF,colorWrite:Fi,stencilTest:i?MFt(1):null,drawBuffers:pS(s)})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}},_u=class extends Wf{constructor(e){super(),this.spherical=e,this.overlayMode=0,this.tileBlendInput=0,this.transparencyMode=0,this.pbrMode=5,this.receiveShadows=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.receiveAmbientOcclusion=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.normalType=1,this.textureCoordinateType=1,this.highStepCount=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!0,this.draped=!1}get overlayEnabled(){return this.overlayMode!==0}};c([ue({count:3})],_u.prototype,"overlayMode",void 0),c([ue({count:3})],_u.prototype,"tileBlendInput",void 0),c([ue({count:4})],_u.prototype,"transparencyMode",void 0),c([ue({count:7})],_u.prototype,"pbrMode",void 0),c([ue()],_u.prototype,"receiveShadows",void 0),c([ue()],_u.prototype,"backfaceCullingEnabled",void 0),c([ue()],_u.prototype,"textureFadingEnabled",void 0),c([ue()],_u.prototype,"renderOccluded",void 0),c([ue()],_u.prototype,"screenSpaceReflections",void 0),c([ue()],_u.prototype,"cloudReflections",void 0),c([ue()],_u.prototype,"receiveAmbientOcclusion",void 0),c([ue()],_u.prototype,"tileBorders",void 0),c([ue()],_u.prototype,"visualizeNormals",void 0);const EK=7,o7t=10,AK=nc();let Dd=class extends VF{get visibleTiles(){return Array.from(this._visiblePatchesByOrigin.values()).flat()}get _isGlobal(){return this._stage.viewingMode===1}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,s,n){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._compressionTracker=s,this.type=7,this.isGround=!0,this._passParameters=new Ofe,this._drawParameters=new X9e,this._renderDataPool=new Wc(()=>new Cqt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new t7e,this._castShadows=!1,this._inViewshed=!1,this._cutFillEnabled=!1,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=1,this.produces=new Map([[1,()=>this._produces()&&this.transparency===0],[6,()=>this._produces()&&(this.transparency===1||this.transparency===2)],[9,()=>this._produces()&&this.renderOccludedFlags===n5]]),this._tileSize=256,this._configuration=new _u(i.viewingMode===1),this._tileTextureCache=new tz((a,o)=>n.newCache(a,o),"TileTexture"),this.tileGeometryCache=new _Gt(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(X(()=>this._overlayRenderer.renderOccludedFlags,e=>{this.renderOccludedFlags=e,this.setNeedsRender()},Ht))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy(),this._allTiles.prune(),this._tileRenderer=null}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?vIt:dBe}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){this._tileRenderer?.updateHeading(e)}set transparency(e){this._configuration.transparencyMode!==e&&(this._configuration.transparencyMode=e,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(e){this._configuration.tileBorders!==e&&(this._configuration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(e){this._configuration.visualizeNormals!==e&&(this._configuration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(e){this._configuration.backfaceCullingEnabled!==e&&(this._configuration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}get layerViewUid(){return b1}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(e){this._configuration.hasSlicePlane!==e&&(this._configuration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._configuration.textureFadingEnabled!==e&&(this._configuration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._configuration.pbrMode!==e&&(this._configuration.pbrMode=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}set tileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}get tileSize(){return this._tileSize}_ensureRenderData(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._ensureRenderData(e),this.updateTileGeometryState(e),this.reuseTextureFromParent(e)||this.updateTileTexture(e,32)}reuseTextureFromParent(e){const i=e.parent;if(!i)return!1;const r=$i(1&e.lij[2]?.5:0,1&e.lij[1]?0:.5,.5,.5);return i.renderData?.reuseTexture(e.renderData,r)??!1}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===32?0:2),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[0])r.pendingUpdates&=-9;e.resetPendingUpdate(8);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.loaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=o7t-EK,r=Math.max(0,Math.floor((e.level-i)/EK)*EK);if(this._isGlobal&&r===0)return Aa;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=1){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=1){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=1){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new A9t(this._rctx,this._tileSize,this._techniques,this._tileTextureCache,this._compressionTracker),this.updateTileBackground()}uninitializeRenderContext(){this._tileRenderer=jt(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==0)return;const n=l7t,a=c7t;Ae(n,s,r),xe(a,1/n[0],1/n[1],1/n[2]);const o=e.results.min,l=e.results.max,u=e.results.ground,d=e.options.store===0,f=!!e.results.ground.target,g=qAt(e.verticalOffset),v=e.tolerance;let _,x=d&&o.distance!=null?o.distance:1/0;const S=e.options,T=S.normalRequired||!S.backfacesTerrain,M=new LH(v,!1,T),E=O=>{const D=O.renderData;if(!D?.vao)return;const L=D.geometry;F7(AK,L.boundingBox);const F=D.localOrigin;g!=null&&(g.localOrigin=F,g.applyToAabb(AK));const j=AK;if(vM[0]=r[0]-F[0],vM[1]=r[1]-F[1],vM[2]=r[2]-F[2],!xpe(j,vM,a,v,x))return;const N=(_e,Ne,G)=>{_e.set(this.type,O,Ne,G),x=d&&o.distance!=null?o.distance:1/0},B=(_e,Ne,G)=>{if((!T||G!=null)&&_e>=0&&(S.backfacesTerrain||Le(G,n)<0)&&(S.invisibleTerrain||!S.selectionMode||i==null||i(r,s,_e))){if((u.distance==null||_e<u.distance)&&N(u,_e,G),S.isFiltered)return;S.store===2&&(_==null?(_=new kw(e.ray),N(_,_e,G),e.results.all.push(_)):_e<_.distance&&N(_,_e,G)),(o.distance==null||_e<o.distance)&&N(o,_e,G),S.store!==0&&(l.distance==null||_e>l.distance)&&N(l,_e,G)}},U=u7t;Ae(U,s,F);const{indices:Q,indexCount:H}=L,J=L.vertexAttributes,Z=J.getField("position",Fw),K=new DF(Z.typedBuffer,3,J.stride/4),ee=H/3;if(!g&&ee>R9t){const _e=O.renderData;_e.intersectionData==null&&(_e.intersectionData=new V7e(Q,0,ee,K)),_e.intersectionData.intersectRay(vM,U,M,B)}else cFt(vM,U,0,ee,Q,K,g,M,B)},P=this._rootTiles;P!=null&&(()=>{const O=this._tileIterator;O.reset(P);const D=e.options.invisibleTerrain;for(let L=O.next();L;L=O.next())!(L.visible||D&&L.intersectsClippingArea)||g==null&&!L.intersectsRay(r,n,v,x)||f&&this._useStencilForTile(L)?O.skipSubtree():E(L)})()}processScaleRangeQueries(e,i){if(!i.done&&e)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const r of this._visiblePatchesByOrigin.values())for(const s of r)s.renderData?.textureReference!=null&&e.queriesForTile(s);e.process(),i.madeProgress()}}acquireTechniques(e){const i=!!ie("enable-feature:terrain-shadows")&&e.bind.shadowMap.enabled;i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0);const r=e.bind.viewshedEnabled;this._inViewshed!==r&&(this._inViewshed=r,this._patchesByOriginDirty=!0);const s=e.bind.cutFillEnabled;if(this._cutFillEnabled!==s&&(this._cutFillEnabled=s,this._patchesByOriginDirty=!0),e.bind.slot===9){if((e.renderOccludedMask&n5)===0)return null}else{const a=this.transparency===0?1:6;if(e.bind.slot!==a)return null}if(this.transparency===3)return null;const n=this._configuration;switch(n.screenSpaceReflections=n.cloudReflections=n.receiveShadows=n.receiveAmbientOcclusion=n.renderOccluded=n.hasHighlightMixTexture=!1,n.overlayMode=this._overlayRenderer.mode,e.output){case 0:case 1:{n.screenSpaceReflections=e.bind.ssr.lastFrameColor!=null,n.cloudReflections=e.bind.clouds.data!=null;const a=e.bind.slot===9;return n.receiveShadows=e.bind.shadowMap.ready&&!a,n.renderOccluded=a,n.receiveAmbientOcclusion=!a&&e.bind.ssao!=null,this._acquireTechnique(e.output)}case 4:case 6:return this._castShadows?this._acquireTechnique(4):null;case 7:return this._inViewshed?this._acquireTechnique(7):null;case 8:return this._cutFillEnabled?this._acquireTechnique(8):null;case 2:case 3:return this._acquireTechnique(e.output);case 10:return this._acquireTechnique(10);case 9:return n.hasHighlightMixTexture=e.bind.highlightMixTexture!=null,this._overlayRenderer.hasHighlights?this._acquireTechnique(9):null}return null}render(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,this._passParameters.overlayContent=J9t(e.output,e.bind),e.output){case 0:case 1:this._renderMaterialPass(e,i);break;case 2:case 3:case 10:this._renderAuxiliaryPass(e,i,this._visiblePatchesByOrigin);break;case 9:{const r=e.bind.highlight?.name;r&&this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(2)&&this._overlayRenderer.hasHighlight(r)&&this._renderAuxiliaryPass(e,i,this._visiblePatchesByOrigin);break}case 4:case 6:case 7:case 8:this._renderAuxiliaryPass(e,i,this._allPatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const s=Je.toUnitRGBA(e);r=Ye(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,0)),this._configuration.tileBlendInput=i.backgroundIsGrid?2:i.backgroundColor!=null?1:0,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)i7e(r,i);e.sort((r,s)=>r7e(r[0],s[0])),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this.notifyChange("visibleTiles"),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows||this._inViewshed||this._cutFillEnabled){let o=this._allPatchesByOrigin.get(n);o||(o=[],this._allPatchesByOrigin.set(n,o)),o.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let a=this._visiblePatchesByOrigin.get(n);a||(a=[],this._visiblePatchesByOrigin.set(n,a)),a.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r){const{rctx:s,bind:n}=e;s.bindTechnique(i,n,this._passParameters);const a=this._stencilEnabledLayerExtents.length>0;r.forEach(o=>{this._drawParameters.origin=o[0].renderData.localOrigin,i.program.bindDraw(n,this._passParameters,this._drawParameters);for(let l=0;l<o.length;l++)this._renderPatch(s,i,o[l],Sr.TRIANGLES,a,this._passParameters.overlayContent===null)}),s.bindVAO(null)}_renderMaterialPass(e,i){const{rctx:r,bind:s}=e;r.bindTechnique(i,s,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=i.program,a=this._stencilEnabledLayerExtents.length>0,o=s.slot===9;o&&(n.bindTexture("tex",r.emptyTexture),n.setUniform3fv("textureOpacities",Aa),n.setUniform4fv("texOffsetAndScale",Tn));const l=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:Aa;this._configuration.tileBlendInput===1&&n.setUniform3fv("backgroundColor",l);const u=this.wireframe?Sr.LINES:Sr.TRIANGLES;this._configuration.textureFadingEnabled&&n.bindTexture("texNext",r.emptyTexture);const d=this._visiblePatchesByOrigin;for(const f of d.values()){const g=f[0].renderData.localOrigin;this._drawParameters.origin=g,i.program.bindDraw(s,this._passParameters,this._drawParameters),this._numOriginsRendered++;for(const v of f){const _=v.renderData,x=_.textureReference;if(x!=null){if(!o){n.setUniform4fv("texOffsetAndScale",x.offsetAndScale),n.bindTexture("tex",x.texture.texture);const S=_.textureFadeFactor,T=S<1?_.nextTextureReference:null;this._configuration.textureFadingEnabled&&T&&S<1?(n.setUniform1f("fadeFactor",S),n.setUniform4fv("nextTexOffsetAndScale",T.offsetAndScale),n.setUniform3fv("nextTexOpacities",T.opacities),n.bindTexture("texNext",T.texture.texture)):n.setUniform1f("fadeFactor",1),_.textureIsFading&&this.setNeedsRender(2),n.setUniform3fv("textureOpacities",x.opacities)}this._renderPatch(r,i,v,u,a),v.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}r.bindVAO(null)}_renderPatch(e,i,r,s,n,a=!1){const o=r.renderData,l=o.vao,u=l?.indexBuffer;if(!l||u==null)return void(Ta&&console.error("Rendered tile with no indices: ",r.lij," : ",o));const d=i.program;a||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(d,o.overlay),n&&(i.useStencil=this._useStencilForTile(r),e.setPipelineState(i.getPipeline()));const f=o.geometry.indexCount;e.bindVAO(l),d.assertCompatibleVertexAttributeLocations(l),e.drawElements(s,f,u.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_acquireTechnique(e){return this._configuration.output=e,this._techniques.get(a7t,this._configuration)}get test(){}hasHighlight(e){return this._overlayRenderer.hasHighlight(e)}};c([p({readOnly:!0})],Dd.prototype,"visibleTiles",null),c([p({readOnly:!0})],Dd.prototype,"_isGlobal",null),c([p()],Dd.prototype,"renderOccludedFlags",void 0),c([p({value:!1})],Dd.prototype,"renderingDisabled",null),c([p({value:!0})],Dd.prototype,"visible",null),c([p()],Dd.prototype,"renderPatchBorders",null),c([p()],Dd.prototype,"visualizeNormals",null),c([p()],Dd.prototype,"cullBackFaces",null),c([p()],Dd.prototype,"wireframe",null),Dd=c([R("esri.views.3d.terrain.TerrainRenderer")],Dd);const l7t=I(),c7t=I(),vM=I(),u7t=I();let h7t=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},cg=class extends be{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),X(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!WE(i)||i.isRejected())&&!(i.isFulfilled()&&!d7t(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!(i?.type==="vector-tile"||QG(i)))),e)if(e.isResolved()){const i=iW(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new Df(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===1){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=Df.makeWebMercatorAuxiliarySphere(i):rfe(r)&&(e=Df.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(X(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===1){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=Df.WebMercatorAuxiliarySphere:b9e(e)&&(this.tilingScheme=Df.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||MS(e,this.extent)||(this.tilingScheme=Df.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function d7t(t,e,i){return iW(t,e,i)!=null}c([p()],cg.prototype,"tilingScheme",void 0),c([p({readOnly:!0})],cg.prototype,"extent",void 0),c([p({value:!1})],cg.prototype,"tilingSchemeLocked",void 0),c([p({constructOnly:!0})],cg.prototype,"viewSpatialReference",void 0),c([p({constructOnly:!0})],cg.prototype,"layers",void 0),c([p({constructOnly:!0})],cg.prototype,"extentHelper",void 0),c([p({constructOnly:!0})],cg.prototype,"viewingMode",void 0),cg=c([R("esri.views.3d.terrain.TilingSchemeLogic")],cg);let p7t=class{constructor(){this._offset=Ke(),this.scale=0}get offset(){return this._offset}init(e,i,r,s){this.tile=e,this._offset[0]=i,this._offset[1]=r,this.scale=s}dispose(){this.tile=null,this._offset[0]=0,this._offset[1]=0,this.scale=0}},f7t=class{constructor(){this._pendingCompressionTasks=ta(0)}get compressing(){return!!this._pendingCompressionTasks.value}increment(){this._pendingCompressionTasks.value++}decrement(){this._pendingCompressionTasks.value--}};var o8,zT;let ei=(zT=class extends Ju{get allTiles(){return this._allTiles}get renderedTiles(){return i7e(q9(this._allTiles.toArray(),e=>e.visible&&e.rendered))}get demResolution(){const{_allTiles:e,tilingScheme:i}=this;if(e.length===0)return{min:1,max:1};const r=Yr(i.spatialReference);let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(const a of e){const o=i.resolutionAtLevel(a.level)*r;s=Math.min(s,o),n=Math.max(n,o)}return{min:s,max:n}}constructor(e){super(e),this.terrainTextureCompressionTracker=new f7t,this._iteratorPool=new Wc(()=>new t7e,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new yqt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new h7t,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=I(),this._eyePosSurfaceSR=I(),this._splitLimits=new yf,this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new tm,this._frameTask=Rw,this._allTiles=new Ai,this._upsampleInfoPool=new Wc(()=>new p7t),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=fi(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Me.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new OE(1/0,-1/0),this.rootTileElevationBounds=new OE(1/0,-1/0),this._projectorCache=new Map,this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.enabled=!0;const{view:i}=e;this.overlayManager=new bc({...e,terrainSurface:this}),this._isGlobal=!i.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?yGt:pGt,this._ellipsoid=xr(i.spatialReference),this._renderer=new Dd(this.overlayManager.renderer,i.stage,this._allTiles,this.terrainTextureCompressionTracker,i.resourceController.memoryController),HB()||(this._scaleRangeQueries=new a8)}initialize(){const{view:e}=this,{resourceController:i}=e,{memoryController:r}=i;this._tileCache=new tz((u,d)=>r.newCache(u,d),"terrain-tile"),this._upsampleMapCache=r.newCache("terrain-upsample",({tile:u})=>u.unloadMapData()),this._elevationQueryCache=new _9e(r.newCache("elevation-query"));const s=this.overlayManager;this.addHandles([X(()=>s.renderer.isEmpty,()=>this._evaluateTransparency()),X(()=>this.renderer.visible,u=>this.suspended=!u),X(()=>this.heading,u=>{this._renderer.updateHeading(u),this._updateTileTextures(0)}),X(()=>({heading:e.camera?.heading,state:e.state?.mode}),({heading:u,state:d})=>{if(u==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(u/90)%360);const f=Math.round(u)%360,g=Math.abs(f-this.heading);(d===2||Math.min(g,360-g)>=30)&&(this.heading=f)})],"overlayManager"),this.addHandles([X(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?1:2)},bt),X(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?1:2),bt),X(()=>this.backgroundColor,(u,d)=>{u?.equals(d)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(u))},Ht),X(()=>this.snapLevel,()=>this._viewChanged=!0,Ht),X(()=>this.view.pointsOfInterest,u=>{this._renderer.pointsOfInterest=u,this._watchUpdatingTracking.removeAll(),u&&this._watchUpdatingTracking.add(()=>u.focus?.renderLocation,()=>this._allTilesSorted=!1,{equals:di})}),X(()=>bn.TERRAIN_TILE_TREE_SHOW_TILES,u=>{u&&!this._treeDebugger?W(async()=>{const{TerrainTileTree3DDebugger:d}=await import("./TerrainTileTree3DDebugger-CAWlX8Gl.js");return{TerrainTileTree3DDebugger:d}},__vite__mapDeps([420,421])).then(({TerrainTileTree3DDebugger:d})=>{!this._treeDebugger&&bn.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new d({view:e}))}):u||(this._treeDebugger=Pe(this._treeDebugger))},Yt)]);const{spatialReference:n}=e;this._extentHelper=wBt(this.viewingMode,{layers:e.map.allLayers,layerViews:e.allLayerViews,viewSpatialReference:n});const a=new op({getCollections:()=>e.defaultsFromMap?.mapCollections?.map(({layers:u})=>u),getChildrenFunction:u=>u&&"layers"in u?u.layers:null}),o=new cg({layers:a,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=i.createStreamDataRequester(0),this._mapDataRequester=i.createStreamDataRequester(1);const l=i.scheduler;this._frameTask=l.registerTask(Tt.TERRAIN_SURFACE,this),this.addHandles([X(()=>this._extentHelper.stencilEnabledExtents,u=>this._renderer.setStencilEnabledLayerExtents(u),Yt),X(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Ht),X(()=>this.extent,()=>this._updateRootTiles(),Yt),e.on("resize",()=>this._viewChangeUpdate()),X(()=>{const u=e.state;return[this._lodBias,this.lodSnappingEnabled,e.quality,u.camera,u.contentCamera,u.fixedContentCamera]},()=>this._viewChangeUpdate(),bt),X(()=>e.qualitySettings?.fadeDuration,u=>this._renderer.textureFadingEnabled=u>0,Yt),X(()=>e.qualitySettings?.physicallyBasedRenderingEnabled,u=>this._renderer.pbrMode=u?5:0,Yt),X(()=>e.qualitySettings?.tiledSurface.elevationLevelDelta,()=>this._updateAllTileGeometries()),X(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Ht)]),this.addHandles(e.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}clearHandles(){this._watchUpdatingTracking?.removeAll(),this.removeAllHandles(),this._basemapLayerViewHandles.forEach((e,i)=>this._unregisterTiledLayerView(i)),this._basemapLayerViewHandles.clear()}destroy(){this._frameTask.remove(),this._frameTask=Rw,this._watchUpdatingTracking?.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",Pe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,i)=>this._unregisterTiledLayerView(i)),this._basemapLayerViewHandles.clear(),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Pe(this.overlayManager)),this._tileCache=Pe(this._tileCache),this._allTiles.prune(),_fe.prune(),this._treeDebugger=Pe(this._treeDebugger),this._renderer.destroyed||this._renderer.destroy(),this._renderer=null,this._iteratorPool=Pe(this._iteratorPool),this._upsampleMapCache=Pe(this._upsampleMapCache),this._elevationQueryCache=Pe(this._elevationQueryCache),this._set("view",null),this._extentHelper=Pe(this._extentHelper),this._upsampleInfoPool=Pe(this._upsampleInfoPool),zqt(),this._layerViews.forEach(e=>e.length=0),this._performanceInfo=null}get renderer(){return this._renderer}get frustum(){return this.view.state.camera.frustum}get snapLevel(){return this.lodSnappingEnabled?this.view.terrainLevel:null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return this._extentHelper.stencilEnabledExtents.length>0}get _userClippingExtent(){const{spatialReference:e}=this,i=this.view?.clippingArea;if(i==null||e==null)return null;const r=fi(),s=KUt(i,r,e)?r:null,n=this._get("extent");return MS(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=pte(this.groundExtent,this._userClippingExtent,fi()),i=this._get("extent");return MS(e,i)?i:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),this.enabled&&!!((this.readyToRun||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating||this.terrainTextureCompressionTracker.compressing)}get readyToRun(){return this.enabled&&(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries?.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return!this.enabled||this._rootTiles!=null}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===0}get invisible(){return this._renderer.transparency===3}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(e,i,r,s){this._renderer.intersect(e,i,r,s)}getElevationLevelDelta(e){return e<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}get _xNormalizer(){return TF(this._spatialReference)}getElevation(e,i,r,s){const n=this._rootTiles;if(!n?.length||!this.enabled||n[0].layerInfo[0].length===0)return null;let a=this._elevationProjectorCache.get(s);if(a===void 0&&(a=e$(s,this._spatialReference)??null,this._elevationProjectorCache.set(s,a)),a==null)return re.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=xe(GI,e,i,r);return a(o,0,o,0),M3e(n,this._xNormalizer?.normalize(o[0])??o[0],o[1])}getElevations(e,i,r){const s=this._rootTiles,n=s?s[0].layerInfo[0].length:0;if(s?.length&&n!==0&&this.enabled)for(let a=0;a<i;++a){const o=3*a;r(a,M3e(s,e[o],e[o+1]))}else for(let a=0;a<i;++a)r(a,null)}getLayerIndexByUID(e,i){return this._layerIndexByUid[e].get(i)}getScale(e){if(!this.tilingScheme)return null;if(!Jc(e,GI,this.spatialReference))return re.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const i=this._rootTiles;if(i!=null){for(const r of i)if(r?.containsPoint(GI)){let s=r;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let a=0;GI[0]>n[2]&&(a+=1),GI[1]<n[1]&&(a+=2),s=s.children[a]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}_ensureProjector(e){const i=this._projectorCache.get(e);if(i)return i;const r=e$(e,this._tilingSchemeSpatialReference)??null;return this._projectorCache.set(e,r),r}getSphereElevationBounds(e,i){if(!this.enabled||this._rootTiles==null)return null;const r=this._ensureProjector(i);if(r==null)return re.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;_1(e,_M);const s=q0(_M,I());r(s,0,s,0),OP(_M,s);const n=new ZG,a=this._rootTiles;if(a!=null){const o=[];for(const u of a)o.push(u);let l=0;for(;l<o.length;){const u=o[l];if(++l,!nbe(u.extent,_M))continue;const d=u.children;if(d[0]==null||u.rendered)n.expandElevationRangeValues(u.elevationBoundsMin,u.elevationBoundsMax);else for(const f of d)o.push(f)}}return n}getRootElevationBounds(){return this.enabled&&this._rootTiles!=null?new ZG(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max):null}getLowerBoundRadius(){const e=(this._ellipsoid.radius+this.visibleElevationBounds.min)*rIe;return Math.min(e,this._ellipsoid.radius)}getSphereScale(e,i){if(!this.tilingScheme)return null;if(!Jc(e,A3e,this.spatialReference))return re.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;AP(_M,A3e,i);let r=null;const s=a=>{if(a&&nbe(a.extent,_M)){const o=a.children;if(o[0]&&!a.rendered)for(const l of o)s(l);else{const l=this._getLodBiasCorrectedScale(a.level);r=r==null?l:Math.min(r,l)}}},n=this._rootTiles;if(n!=null)for(const a of n)s(a);return r}queryVisibleScaleRange(e,i,r,s){if(!this._scaleRangeQueries)return;const n=i?this.tilingScheme.levelAtScale(i):0,a=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+o,a+o,s)}_evaluateTransparency(){const e=this.baseOpacity,i=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,s=this._isFullyTransparent?i?3:2:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?0:1;return this._renderer.transparency=s,r!==s}_updateTilingScheme(){const{tilingScheme:e}=this.tilingSchemeLogic;if(e===this.tilingScheme)return;Ba(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const i=e?.spatialReference??Me.WebMercator;this._spatialReference=i,this._isWebMercator=!!i?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&E5(this.view?.renderSpatialReference),this._isGeographic=i?.isGeographic??!1,this._set("tilingScheme",e),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._projectorCache.clear(),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.tileSize=e.pixelSize,this.overlayManager.spatialReference=e.spatialReference,this._updateRootTiles())}_acquireTile(e,i,r,s){const n=this._tileCache.pop(o8._tileMemcacheKey);return n?(n.init(e,i,r,s,this),n):new this._tileConstructor(e,i,r,s,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:i}=this;if(!i)return;const r=m7t;let s=i.rootTilesInExtent(e,r,5*mE);if(this._rootTiles!=null){if(s.length>mE)return void re.getLogger(this).warn(fPt);const n=this._rootTiles.map(o=>o.lij),a=W8(n,s,s8);if(this._updatingRootTiles=!0,a.removed.length>0||a.added.length>0){const o=this._rootTiles.filter(l=>!(a.removed.findIndex(u=>s8(u,l.lij))>-1)||(this._purgeTile(l),!1));a.added.forEach(l=>o.push(this._newRootTile(l))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,s.length>mE&&(re.getLogger(this).warn(mPt),s=i.rootTilesInExtent(e,r,mE)),this._setRootTiles(s.map(n=>this._newRootTile(n)));MS(r,this._rootTilesExtent)||(this._rootTilesExtent=fi(r)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(i=>i.loaded&&i.intersectsClippingArea);e.sort(zg),e.forEach(i=>this._renderer.updateTileGeometryState(i)),e.forEach(i=>i.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(zg);const i=this.renderer;e.forEach(r=>i.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===1}_newRootTile(e){const i=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(i)&&i.setPendingUpdate(1),this._loadTile(i),this._markTileToUpdate(i),this._updateRootTileElevationBounds(),i}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const i=this._iteratorPool.acquire();for(i.reset(e);!i.done;)this._allTiles.push(i.next());i.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e),this.notifyChange("demResolution"),this.emit("tiles-changed",{allTiles:this.allTiles})}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(8)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const i=$qt(e),r=this.visibleElevationBounds;let s=i?r.min:1/0,n=i?r.max:-1/0;const a=this.extent,o=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const u=l.next();u.updateClippingStatus(a)&&u.resetPendingUpdate(8)&&this._updateTileGeometryState(u),u.computeVisibility(),u.updateScreenDepth(o),u.renderData&&(s=Math.min(u.elevationBoundsMin,s),n=Math.max(u.elevationBoundsMax,n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(r.min!==s||r.max!==n)&&(this.visibleElevationBounds=new OE(s,n))}_updateRootTileElevationBounds(){let e=1/0,i=-1/0;const r=this._rootTiles;r?.forEach(({elevationBoundsMin:n,elevationBoundsMax:a})=>{e=Math.min(e,n),i=Math.max(i,a)});const s=this.rootTileElevationBounds;s.min===e&&s.max===i||(this.rootTileElevationBounds=new OE(e,i))}_updateViewDependentParameters(){const{camera:e,contentCamera:i}=this.view.state,r=Math.tan(.5*i.fovX),s=Math.tan(.5*i.fovY),n=this.tilingScheme.pixelSize,a=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*a,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*a,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=g6e(this._splitLimits.frustum??mde(),i.frustum):this._splitLimits.frustum=null,me(this._eyePosRenderSR,i.eye),Co(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this.setMemoryDirty()}_markAllTileNeighborsForUpdate(e){e.forEachLoadedNeighbor(i=>{this._layerViews[1].some(KO)&&i.setPendingUpdate(32),this._pendingTilesToUpdate.add(i)})}_updateTileTexture(e,i){const r=e.resetPendingUpdate(32)?32:!!e.resetPendingUpdate(16)&&16;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,i.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const e=OK.extent;R0(e),this._pendingTilesForElevationUpdateEvent.forEach(i=>VE(e,i.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),OK.spatialReference=this.spatialReference,this.emit("elevation-change",OK),this._shouldEmitChangeEvent=!1}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const i=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(e,i),this._updateElevation(e),this._updateTextures(e),i||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Ta&&this._checkTileInvariant(),!e.hasProgressed)return Oa}_checkTileInvariant(){const e=new Map;this._allTiles.forAll(i=>e.set(i,new Set)),this._allTiles.forAll(i=>{if(Ba(i.rendered===i.leaf,` rendered ${i.rendered} != ${i.leaf} leaf`),!i.leaf){const r=n=>n.unmergableChildCount===0&&n.maxLevelDeltaNeighborCount===0,s=i.children.reduce((n,a)=>n+(r(a)?0:1),0);if(Ba(i.unmergableChildCount===s,` Tile[${i.lij.toString()}] unmergeable child count mismatch: actual ${i.unmergableChildCount} vs ${s}`),i.hasPendingUpdate(4)){Ba(!i.hasPendingUpdate(1),"Tile can be both split and merge at the same time");for(const n of i.children)Ba(n.leaf||n.hasPendingUpdate(4),"Child of tile to merge must also merge")}}for(let r=0;r<4;++r){if(i.rendered){const o=i.renderData?.geometryState.edgePeerNeighbors[r];if(o!=null){{const l=i.level-o.level<=Zn;l||(console.log(`tile level delta [${i.lij.toString()}] vs [${o.lij.toString()}] > ${Zn}  (edge[${r}])`),Ba(l,`tile level delta [${i.level}] vs [${o.level}] > ${Zn}`))}Ba(i.level-o.level<=Zn,`Max tile lod delta exceeded: [${i.lij.toString()}] vs [${o.lij.toString()}]`)}}const s=i.level-Zn,n=o=>o.leaf||o.level===i.level,a=i.findNeighborTile(Yf[r],n);if(a!=null){if(i.leaf&&i.level>=Zn){let o=a;for(;i.level-o.level<Zn;)o=o.parent;const l=[s,i.lij[1]>>Zn,i.lij[2]>>Zn];if(!s8(l,o.lij)){const u=e.get(o);Ba(!u.has(i),"Cannot already have neighbor"),u.add(i)}}Ba(a.rendered||a.level===i.level,"Non-same-level-neighbor of rendered must be rendered"),Ba(i.level-a.level<=Zn,`Tile level delta [${i.level}] vs [${a.level}] > ${Zn}`)}}}),this._allTiles.forAll(i=>{const r=i.maxLevelDeltaNeighborCount,s=e.get(i);Ba(r===s.size,`Tile[${i.lij.toString()}] merge-blocker mismatch: actual ${r} vs ${s.size}`)})}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const i=new fGt(this._allTiles.length);i.pushAll(this._rootTiles);const r=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const a=this.view.state.contentCamera.viewProjectionMatrix;for(;!i.empty;){const o=i.pop(),l=o.parent,u=l?.hasPendingUpdate(4),d=u?4:o.shouldSplit(s,n,r),f=d===1;o.leaf?PK(o,f):i.pushAll(o.children),u?(o.resetPendingUpdate(1),o.leaf||o.setPendingUpdate(4),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(a)):f?(o.resetPendingUpdate(4),o.leaf&&o.setPendingUpdate(1)):(o.resetPendingUpdate(1)&&o.updateAgentSuspension(),d===2&&o.updateAgents(0),o.leaf||(o.setPendingUpdate(4),o.resetPendingUpdate(1)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||!this.view.pointsOfInterest?.focus||(Sqt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger?.update(),e.madeProgress())}_markTileToUpdate(e){He(e.loaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForUpdate(e))}_updatePendingTileGeometries(){const e=this._pendingTilesToUpdate,i=Array.from(e.keys()).filter(n=>n.loaded&&n.intersectsClippingArea);if(i.length===0)return void e.clear();const r=(n,a)=>{!a?.loaded||!a.intersectsClippingArea||a.level<n.level||e.has(a)||(e.add(a),i.push(a),a.renderData.updateNeighborData())};i.sort(zg);const s=i.length;for(let n=0;n<s;++n){const a=i[n];He(a.loaded),He(a.intersectsClippingArea);const o=a.renderData;o.updateNeighborData();const l=o.dirtyEdgeResolutions,u=o.geometryState,d=f=>{const g=KG[f];r(a,u.cornerPeerNeighbors[f]?.findCorner(XG(g),v=>v.loaded))};for(let f=0;f<4;++f)if(l&1<<f){const g=o.geometryState.edgePeerNeighbors[f];g&&g?.level>=a.level&&g.forAllSubtreeOnSide(nfe(Yf[f]),v=>!(!v.loaded||!v.intersectsClippingArea)&&(He(e.has(v)||zg(a,v)<0),r(a,v),!0)),d((f+1)%4),d(f)}}e.clear(),this._updateTilesGeometries(i),this._shouldEmitChangeEvent=!0,Ta&&JG&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,i){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let a=!1;const o=!this._allTiles.some(l=>{if(!r&&!s&&!l.visible)return e.done;let u=l;if(l.hasPendingUpdate(4)){if(!i||l.unmergableChildCount>0)return e.done;for(l.resetPendingUpdate(4);u.parent!=null&&u.parent.unmergableChildCount===0&&u.parent.resetPendingUpdate(4);)u=u.parent;this._mergeTile(u),a=!0,e.madeProgress()}else if(l.resetPendingUpdate(1)){let d=!0;const f=l.level;if(f>=Zn){const g=v=>v.leaf||f-v.level<Zn;for(let v=0;v<4;++v){const _=l.findNeighborTile(Yf[v],g);_!=null&&f-_.level===Zn&&(d=!1,Ta&&(He(_.leaf),He(_.hasPendingUpdate(1))))}}d?(this._splitTile(l),e.madeProgress(),a=!0):l.setPendingUpdate(1)}return e.done});if(a&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!r){r=!0;continue}if(!a)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(i=>(i.resetPendingUpdate(8)&&(this._updateTileGeometryState(i),this._shortBatches&&this._updatePendingTileGeometries(),e.madeProgress()),e.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(i=>(this._updateTileTexture(i,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateOverlayParameters(),this.requestRender(1),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*dPt}_getLodBiasCorrectedScale(e){const i=this.tilingScheme.levels,r=Ce(e-this._lodBias,0,i.length-1),s=r-Math.floor(r);return i[Math.floor(r)].scale*(1-s)+i[Math.ceil(r)].scale*s}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.notifyChange("demResolution"),this.emit("tiles-changed",{allTiles:this.allTiles}),this.renderer.visible=!1}_purgeSubtree(e){const i=e.children;i[0]&&(this._purgeTile(i[0]),this._purgeTile(i[1]),this._purgeTile(i[2]),this._purgeTile(i[3]),e.clearChildren())}_purgeTile(e){e.leaf?E3e(e):this._purgeSubtree(e),this._allTiles.removeUnordered(e),this._unloadTile(e),e.dispose(),this._tileCache.put(o8._tileMemcacheKey,e),this.notifyChange("demResolution"),this.emit("tiles-changed",{allTiles:this.allTiles})}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload()}_splitTile(e){Ba(e.leaf,"Tile that is already split should not be split again!"),Ba(e.rendered,"Tile marked to split is not rendered"),E3e(e);const i=e.createChildren();this._allTiles.pushArray(i),this.notifyChange("demResolution"),this.emit("tiles-changed",{allTiles:this.allTiles}),e.updateAgentSuspension(),Ba(e.rendered,"parent should be rendered"),i.forEach(r=>this._loadTile(r)),i.forEach(r=>this._pendingTilesToUpdate.add(r)),this._unloadTile(e),this._markAllTileNeighborsForUpdate(e),this._emitTileScaleChange(e,e.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),i.forEach(r=>PK(r,r.hasPendingUpdate(1))),++this._performanceInfo.numSplit}_emitTileScaleChange(e,i=e.level){a6.spatialReference=this.spatialReference,a6.extent=e.extent,a6.scale=this._getLodBiasCorrectedScale(i),this.emit("scale-change",a6)}createTile(e,i,r,s){Ba(!!s,"createTile sanity check");const n=this._acquireTile(e,i,r,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(1),n}get _shortBatches(){return this.view.state.mode!==2}_mergeTile(e){Ba(!e.hasPendingUpdate(1),"_mergeTile sanity check"),Ba(!e.leaf,"Cannot merge a leaf"),e.leaf||(this._purgeSubtree(e),Ba(!e.renderData,"Merging tile with existing render data?"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this._shortBatches&&this._updatePendingTileGeometries(),PK(e,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(e){e.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager?.hasOverlays&&e.updateOverlayParameters(this.overlayManager)}_handleLayerViewChanges(e=Jl){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let i=!1;const r=new Set;let s=-1;for(let n=this.view.allLayerViews.length-1;n>=0;n--){const a=this.view.allLayerViews.items[n];if(r.add(a.uid),noe(a)||VI(a))if(this._basemapLayerViewHandles.has(a.uid)&&!VI(a)){const o=this._layerClassFromLayerView(a),l=this.getLayerIndexByUID(o,a.uid);l!=null&&((l<s||s==null)&&(i=!0),s=l)}else this._registerTiledLayerView(a),a.layer.loaded&&(i=!0)}this._basemapLayerViewHandles.forEach((n,a)=>{r.has(a)||(this._unregisterTiledLayerView(a),i=!0)}),i&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}get _isFullyTransparent(){if(this.view.map?.ground?.opacity>0)return!1;for(const e of this.view.allLayerViews.items)if(soe(e)&&!oU(e.layer)&&e.fullOpacity!==0)return!1;return!0}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((wL(e)||VI(e))&&T9t(goe[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return roe(e)?0:1}_registerTiledLayerView(e){const i=[];if((wL(e)||VI(e))&&i.push(X(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(2)})),!VI(e)){const r=this._layerClassFromLayerView(e);i.push(X(()=>!e.destroyed&&e.suspended,()=>this._updateTiledLayers())),i.push(X(()=>!e.destroyed&&e.fullOpacity,()=>this._updateTileTextures(2)));const{layer:s}=e;"effectiveScaleRange"in s&&i.push(X(()=>!e.destroyed&&s.effectiveScaleRange,()=>this._restartAllAgents(r))),i.push(e.on("data-changed",()=>{const n=this.getLayerIndexByUID(r,e.uid);n!=null&&this._invalidateLayerData(n,r)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,i)}_unregisterTiledLayerView(e){const i=this._basemapLayerViewHandles.get(e);if(i){for(const r of i)r.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,i=[[],[]];let r=null;e.forEach(s=>{if(!s.layer||s.suspended||!noe(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===1){const a=s.displayLevelRange.maxLevel;a!==1/0&&(r===null||a>r)&&(r=a)}i[n].push(s)});for(const s of U3){const n=this._layerViews[s],a=i[s];a.reverse();const o=a.length;let l=n.length!==o;const u=new Array(o),d=new Array(n.length);this._layerIndexByUid[s].clear();for(let f=0;f<o;f++){const g=a[f].uid;this._layerIndexByUid[s].set(g,f);const v=n.indexOf(a[f]);u[f]=v,f!==v&&(l=!0),v>-1&&(d[v]=f)}if(l){const f=this._postorderIterator;for(f.reset(this._rootTiles);!f.done;)f.next().modifyLayers(d,u,s);this._layerViews[s]=a,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(e){const i=this._postorderIterator;for(i.reset(this._rootTiles);!i.done;){const r=i.next();r.restartAgents(e),e===0&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,i){return this._layerViews[i][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(i=>{i.updateAgents(1),e===1?this.renderer.updateTileTexture(i,16):i.updateRenderData(1,e)}),this._evaluateTransparency()}_invalidateLayerData(e,i){this._allTiles.forAll(r=>r.removeLayerAgent(e,i)),this._allTiles.forAll(r=>r.invalidateLayerData(e,i))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=1){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates===1&&(this._hasPendingUpdates=!0)}requestTileData(e,i,r,s){const n=this.layerViewByIndex(i,r),a=n.layer;return!a.tilemapCache||KO(n)?this._requestTileData(e,r,n,s):(++this._asyncWorkItems,a.tilemapCache.fetchAvailability(e.level,e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,ct(s),Zr(o)||this._dataMissing(e,r,n),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,n,s),s.signal)))}_requestTileData(e,i,r,s){if(this.destroying)return Promise.resolve();const n=i===0;return s.requester??=n?this._elevationDataRequester:this._mapDataRequester,n?roe(r)?this._requestElevationTileData(e,r,s):Promise.reject():soe(r)?this._requestMapTileData(e,r,s):Promise.reject()}_requestElevationTileData(e,i,r){++this._asyncWorkItems;const s=a=>{!sa(r)&&a&&(this.setMemoryDirty(),this.requestUpdate(),this._elevationDataArrived(e,i,a))},n=a=>{Zr(a)||(re.getLogger(this).error(`Tile ${e.lij.toString()} layer 0/${i.uid} error ${a}`),this._dataMissing(e,0,i),this.requestUpdate())};return i.fetchElevationTile(e,r).then(a=>this._frameTask.schedule(()=>s(a)),n).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(e,i,r){const s=this._layerIndexByUid[0].get(i.uid);if(s==null)return void re.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",0,e.lij.toString());const n=new tBt(e.lij,e.extent,r);e.dataArrived(s,0,n),this.emit("tile-data-changed",{tile:e,layerIndex:s,layerClass:0});const a=[e],o=e.level,l=this._iteratorPool.acquire();for(l.reset(a);!l.done;){const u=l.next();u.findElevationBoundsForLayer(s,o),u.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),l.remove(),this._updateTilesVisibility(a)}_requestMapTileData(e,i,r){++this._asyncWorkItems;const s=(l,u)=>{mA(u),sa(r)||(console.error(`Tile ${e.lij.toString()} layer 1/${i.uid} error ${l}`),this._dataMissing(e,1,i),this.requestUpdate())},n=l=>u=>s(u,l),a=l=>this._frameTask.schedule(()=>{this.requestUpdate(),sa(r)?mA(l):this._mapTileDataArrived(e,i,l)},r.signal,n(l)).catch(n(l)),o=(l,u=null)=>this._frameTask.schedule(()=>s(l,u));return i.fetchTile(e.lij,r).then(a,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(e,i,r){const s=this.getLayerIndexByUID(1,i.uid);if(s==null)return mA(r),void re.getLogger(this).warn("TerrainSurface: received data from unknown layer");e.dataArrived(s,1,r),this.emit("tile-data-changed",{tile:e,layerIndex:s,layerClass:1})}_dataMissing(e,i,r){const s=this.getLayerIndexByUID(i,r.uid);s!=null?(e.dataMissing(s,i),this.emit("tile-data-changed",{tile:e,layerIndex:s,layerClass:i})):re.getLogger(this).warn("TerrainSurface: received data from unknown layer")}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(i=>{i.leaf&&e.numLeaves++;const r=i.level;i.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),i.visible&&(e.numVisible++,i.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((e,i)=>e+i.usedMemory,0)):null}getUsedMemoryForLayerView(e){let i=0;const r=this._layerClassFromLayerView(e),s=this.getLayerIndexByUID(r,e.uid);return s!=null&&this._allTiles.forAll(n=>i+=n.getUsedMemoryForLayer(r,s)),i}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){}checkAllTilesWaterproofness(){if(!JG)return;const e=this._rootTiles;if(e==null)return;const i=a=>a?.renderData?.geometry?.indices?.length>0,r=(a,o)=>{i(a)&&console.error("Tile[",a.lij,"] has geometry although parent[",o.lij,"] has geom")},s=a=>{if(a.intersectsClippingArea)if(a.renderData&&!a.renderData.geometryState&&console.error("Tile[",a.lij,"] has renderData but not geometryState"),a.renderData&&!a.renderData.geometry&&console.error("Tile[",a.lij,"] has renderData but not geometryInfo"),!a.renderData?.geometry||(a.renderData.geometry.indices?.length??0)>0||console.error("Tile[",a.lij,"] has renderData but no indices - geometryInfo: ",a.renderData.geometry),i(a)){a.checkGeometryWaterproofness();for(const o of a.children)r(o,a)}else if(a.leaf)console.error("Tile[",a.lij,"] has no geometry and no children, from root to leaf");else for(const o of a.children)s(o)},n=a=>{const o=a.parent?.visible??!0,l=a.visible;a.computeVisibility();const u=a.visible;if(l!==u&&o&&console.error(" Tile[",a.lij,"] has out of date visibility: ",l," instead of ",u),!a.leaf)for(const d of a.children)n(d)};for(const a of e)s(a),n(a)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(e){return this._isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this._isGlobal&&e[2]===0}lijEastEnd(e){return 1<<e+(this._isGeographic?1:0)}wrapEastWest(e){const i=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<i)return e;if(!this._isGlobal)return null;const s=(r+(r<0?i:0))%i;return[e[0],e[1],s]}enableInternalChecks(e){uBt(e)}enableWaterproofnessChecks(e){cBt(e)}static cleanupTerrainSurface(){g7t.prune()}enable(e){e!==this.enabled&&(e?(this._updateRootTiles(),this.suspended=!1):(this.suspended=!0,this._removeAllTiles(),this._setRootTiles(null)),this._set("enabled",e),this.notifyChange("ready"))}updateOverlayParameters(){const{overlayManager:e}=this;this.allTiles.forAll(i=>i.updateOverlayParameters(e))}},o8=zT,zT._tileMemcacheKey="TerrainTileMemcache",zT);c([p()],ei.prototype,"_renderer",void 0),c([p({constructOnly:!0})],ei.prototype,"_scaleRangeQueries",void 0),c([p({constructOnly:!0})],ei.prototype,"view",void 0),c([p({constructOnly:!0})],ei.prototype,"overlayManager",void 0),c([p({constructOnly:!0})],ei.prototype,"terrainTextureCompressionTracker",void 0),c([p()],ei.prototype,"_hasPendingUpdates",void 0),c([p()],ei.prototype,"_asyncWorkItems",void 0),c([p()],ei.prototype,"_allTilesDirty",void 0),c([p()],ei.prototype,"_allTilesSorted",void 0),c([p()],ei.prototype,"_viewChanged",void 0),c([p({type:Number})],ei.prototype,"heading",void 0),c([p()],ei.prototype,"_splitLimits",void 0),c([p({readOnly:!0})],ei.prototype,"_watchUpdatingTracking",void 0),c([p()],ei.prototype,"_frameTask",void 0),c([p()],ei.prototype,"demResolution",null),c([p({readOnly:!0})],ei.prototype,"snapLevel",null),c([p({readOnly:!0})],ei.prototype,"lodSnappingEnabled",null),c([p()],ei.prototype,"_userClippingExtent",null),c([p()],ei.prototype,"_rootTilesExtent",void 0),c([p({readOnly:!0})],ei.prototype,"extent",null),c([p({readOnly:!0})],ei.prototype,"groundExtent",null),c([p({readOnly:!0})],ei.prototype,"_tilingSchemeExtent",null),c([p({readOnly:!0})],ei.prototype,"updating",null),c([p({readOnly:!0})],ei.prototype,"readyToRun",null),c([p(eBt)],ei.prototype,"updatingProgress",void 0),c([p({readOnly:!0})],ei.prototype,"updatingProgressValue",null),c([p()],ei.prototype,"_maxNumUpdating",void 0),c([p()],ei.prototype,"baseOpacity",null),c([p()],ei.prototype,"hasCompositeBlendMode",void 0),c([p({readOnly:!0})],ei.prototype,"viewingMode",null),c([p()],ei.prototype,"maxTextureScale",void 0),c([p({readOnly:!0})],ei.prototype,"ready",null),c([p({readOnly:!0})],ei.prototype,"rootTiles",null),c([p()],ei.prototype,"_rootTiles",void 0),c([p({readOnly:!0})],ei.prototype,"spatialReference",null),c([p({type:Je})],ei.prototype,"backgroundColor",null),c([p({value:!1})],ei.prototype,"slicePlaneEnabled",null),c([p({readOnly:!0})],ei.prototype,"tilingScheme",void 0),c([p({readOnly:!0})],ei.prototype,"tilingSchemeLocked",null),c([p({readOnly:!0})],ei.prototype,"tilingSchemeLogic",void 0),c([p()],ei.prototype,"wireframe",null),c([p({value:!1})],ei.prototype,"suspended",null),c([p()],ei.prototype,"fadeDuration",null),c([p()],ei.prototype,"_xNormalizer",null),c([p()],ei.prototype,"visibleElevationBounds",void 0),c([p()],ei.prototype,"rootTileElevationBounds",void 0),c([p()],ei.prototype,"_layerViewsDirty",void 0),c([p()],ei.prototype,"renderPatchBorders",null),c([p()],ei.prototype,"visualizeNormals",null),c([p()],ei.prototype,"renderingDisabled",null),c([p({readOnly:!0})],ei.prototype,"enabled",void 0),ei=o8=c([R("esri.views.3d.terrain.TerrainSurface")],ei);const C3e=ei,GI=I(),_M=Is(),m7t=fi(),g7t=new Ai,OK=new zGe("ground"),a6={spatialReference:null,extent:null,scale:0};function M3e(t,e,i){for(const r of t){if(!r.containsPointXY(e,i))continue;let s=r;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[a]}const n=s?.renderData?.geometryState.samplerData??null;return Ms(e,i,n)}return null}function PK(t,e){!t.leaf||t.level<Zn||Pfe(t,i=>{e&&G7e(i);const r=yoe(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=yoe(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function G7e(t){if(t.hasPendingUpdate(1))return;let e=t.parent;for(;e?.resetPendingUpdate(4);)e=e.parent;t.resetPendingUpdate(4),t.leaf&&t.setPendingUpdate(1),t.level<Zn||Pfe(t,i=>{G7e(i)})}function E3e(t){t.level<Zn||Pfe(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,yoe(i));)i=i.parent}})}function yoe(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function Pfe(t,e){if(t.level<Zn)return;const i=t.level-Zn,r=t.lij[1]>>Zn,s=t.lij[2]>>Zn,n=a=>a.leaf||a.level===i;for(let a=0;a<4;++a){const o=t.findNeighborTile(Yf[a],n);if(!o||o.level!==i)continue;const l=o.lij;l[1]===r&&l[2]===s||e(o)}}const A3e=I();let y7t=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},qk=class extends be{constructor(e){super(e),this._residentGeomRecords=new Kg,this._dirtyGeomRecords=new Kg,this._dirtyRecordCount=0}get dirty(){return this._dirtyRecordCount>0}commitLayer(e,i){const r=this._dirtyGeomRecords.getInner(e),s=this.model.getLayer(e);if(!r||!s)return;let n=0;r.forEach((a,o)=>{const l=this._ensureGeomRecord(e,o);this._dirtyGeomRecords.delete(e,o),n+=a.size,a.forEach(({geometry:u,operation:d,states:f},g)=>{let v=!1;if(d===1){const _=l.get(g);if(_){if(4&f){const x=s.getObject(o);this.model.updateRenderGeometryTransformation(x,u,_)&&(v=!0)}v||i.updates.push({renderGeometry:_,updateType:f})}else xt(!1,"ModelDirtySet.commitLayer: invalid update")}if(d===2||v){const _=l.get(g);_?(i.removes.push(_),l.delete(g)):d===2&&xt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(d===0||v){const _=s.getObject(o);if(_!=null){const x=this.model.getRenderGeometry(_,u);i.adds.push(x),l.set(g,x)}}}),l.size===0&&this._residentGeomRecords.delete(e,o)}),this._dirtyRecordCount-=n}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.getInner(e),s=this.model.getLayer(e);r&&s&&r.forEach((n,a)=>{const o=this._ensureGeomRecord(e,a);n.forEach(({geometry:l,operation:u,states:d,sync:f},g)=>{let v=!1;if(u===1&&f){const _=o.get(g);if(_){if(4&d){const x=s.getObject(a);this.model.updateRenderGeometryTransformation(x,l,_)&&(v=!0)}v||i.updates.push({renderGeometry:_,updateType:d})}else xt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,1,e)}visibilityChanged(e){this._objectStateChanged(1,e)}highlightChanged(e){this._objectStateChanged(8,e)}occlusionChanged(e){this._objectStateChanged(16,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,1,2,r)}layerAdded(e){e.objects.forEach(i=>this.layerObjectAdded(i))}layerRemoved(e){e.objects.forEach(i=>this.layerObjectRemoved(i))}layerObjectAdded(e){for(const i of e.geometries)this._geometryAdded(e,i)}layerObjectRemoved(e){for(const i of e.geometries)this._geometryRemoved(e,i)}layerObjectsAdded(e){for(const i of e)this.layerObjectAdded(i)}layerObjectsRemoved(e){for(const i of e)this.layerObjectRemoved(i)}transformationChanged(e){const i=this._getLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(({geometry:s})=>this._updateOrCreateDirtyRecord(e,s,1,4))}shaderTransformationChanged(e){const i=this._getLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>s.objectShaderTransformationChanged(e.shaderTransformation))}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i){this._updateOrCreateDirtyRecord(e,i,0)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i){this._updateOrCreateDirtyRecord(e,i,2)}_updateOrCreateDirtyRecord(e,i,r,s=0,n=!1){const a=this._getLayerId(e),o=e.id,l=i.id,u=this._ensureDirtyRecord(a,o),d=u.get(l);if(d){const f=d.operation;f===2&&r===0&&d.states!==0?d.operation=1:f===2&&r===0||f===0&&r===2?(u.delete(l),this._dirtyRecordCount--):f!==1||r!==2&&r!==1?(xt((f===2||f===0)&&r===1,"ModelDirtySet.objectGeometryAdded: inconsistent state"),d.states|=s):(d.operation=r,d.states|=s),d.sync=d.sync||n}else u.set(l,new y7t(r,i,s,n)),this._dirtyRecordCount++}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e,i);return r||(r=new Map,this._residentGeomRecords.set(e,i,r)),r}assertLayerClean(e){xt(this._dirtyGeomRecords.getInner(e)==null,"Dirty geometry records for removed layer")}_ensureDirtyRecord(e,i){const r=this.model.getLayer(e);xt(r!=null,"Updating geometry record for an unregistered layer");let s=this._dirtyGeomRecords.get(e,i);return s||(s=new Map,this._dirtyGeomRecords.set(e,i,s)),s}_getLayerId(e){return e.layer?.id??f4}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forAll((r,s,n)=>{i.length>0&&(i+=`
`),i+=s+"."+n;const a=[];r.forEach(o=>{const l=o.operation;a[l]||(a[l]=[]),a[l].push(o.geometry.id)});for(let o=0;o<a.length;o++)if(a[o]){i+=" "+e[o-1]+": ";for(let l=0;l<a[o].length;l++)i+=a[o][l]+", "}}),i}get test(){}};c([p({constructOnly:!0})],qk.prototype,"model",void 0),c([p()],qk.prototype,"_dirtyRecordCount",void 0),qk=c([R("esri.views.3d.webgl-engine.lib.ModelDirtySet")],qk);const v7t=qk;let _7t=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=ut(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Gc(),this.layerViewUid=i.layerViewUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){Ln(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??=ut(),Cn(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??=Is(),jO(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*eL(this.shaderTransformation)),this._boundingSphere):Wje}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get positionAttribute(){return this.geometry.positionAttribute}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}},l8=class extends be{constructor(){super(...arguments),this.dirtySet=new v7t({model:this}),this._originFactory=new G9e(null),this._textures=new Map,this._layers=new Map}hasTexture(e){return this._textures.has(e.id)}getTexture(e){return e==null?null:this._textures.get(e)}addTexture(e){const i=e.id;xt(!this._textures.has(i),"Model/Stage already contains texture to be added"),this._textures.set(i,e)}removeTexture(e){return this._textures.delete(e.id)}addTextures(e){for(const i of e)i&&(xt(!this._textures.has(i.id),"Model/Stage already contains object to be added"),this._textures.set(i.id,i))}removeTextures(e){for(const i of e)i&&(xt(this._textures.has(i.id),"Model/Stage doesn't contain object to be removed"),this._textures.delete(i.id))}forEachTexture(e){this._textures.forEach(i=>e(i))}hasLayer(e){return this._layers.has(e.id)}getLayer(e){return e==null?null:this._layers.get(e)}addLayer(e){const i=e.id;xt(!this._layers.has(i),"Model/Stage already contains layer to be added"),this._layers.set(i,e)}removeLayer(e){return this._layers.delete(e.id)}getRenderGeometry(e,i){const r=new _7t(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation}),s=i.localOrigin;return r.transformation=e.getCombinedStaticTransformation(i,O3e),r.localOrigin=s??this._originFactory.getOrigin(Li(r.boundingSphere)),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,O3e);const s=this._originFactory.getOrigin(Li(r.boundingSphere));return r.localOrigin!==s}get test(){}};c([p({constructOnly:!0})],l8.prototype,"dirtySet",void 0),l8=c([R("esri.views.3d.webgl-engine.parts.Model")],l8);const O3e=ut();function b7t(t,e,i=0){const r=Ce(t,0,S7t);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*W7e(r*H7e[s]))}function w7t(t,e,i=0){const r=Ce(t,0,T7t);for(let s=0;s<3;s++)e[i+s]=Math.floor(256*W7e(r*H7e[s]))}function Rfe(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*x7t[r];return i}const H7e=[1,256,65536,16777216],x7t=[1/256,1/65536,1/16777216,1/4294967296],S7t=Rfe(new Uint8ClampedArray([255,255,255,255])),T7t=Rfe(new Uint8ClampedArray([255,255,255,0]));function W7e(t){return t-Math.floor(t)}function $7t(t){return"r"in t&&"g"in t&&"b"in t}function Z7e(t){return"h"in t&&"s"in t&&"v"in t}function Y7e(t){return"l"in t&&"a"in t&&"b"in t}function J7e(t){return"l"in t&&"c"in t&&"h"in t}function C7t(t){return"x"in t&&"y"in t&&"z"in t}const M7t=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],E7t=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function Q7e(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,a=t[0].length;let o=0;for(r=0;r<n;r++){for(o=0,s=0;s<a;s++)o+=t[r][s]*e[s];i.push(o)}return i}function X7e(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=Q7e(M7t,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function Ife(t){const e=Q7e(E7t,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function K7e(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function eHe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function A7t(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function O7t(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function P7t(t){return K7e(X7e(t))}function R7t(t){return Ife(eHe(t))}function I7t(t){return A7t(K7e(X7e(t)))}function D7t(t){return Ife(eHe(O7t(t)))}function k7t(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let a=s,o=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/a;return o<0&&(o+=6),o*=60,l*=100,a*=100/255,{h:o,s:l,v:a}}function L7t(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let a;switch(Math.floor(e)){case 0:a={r:s,g:n,b:0};break;case 1:a={r:n,g:s,b:0};break;case 2:a={r:0,g:s,b:n};break;case 3:a={r:0,g:n,b:s};break;case 4:a={r:n,g:0,b:s};break;case 5:case 6:a={r:s,g:0,b:n};break;default:a={r:0,g:0,b:0}}return a.r=Math.round(a.r+r-s),a.g=Math.round(a.g+r-s),a.b=Math.round(a.b+r-s),a}function rz(t){return $7t(t)?t:J7e(t)?D7t(t):Y7e(t)?R7t(t):C7t(t)?Ife(t):Z7e(t)?L7t(t):t}function F7t(t){return Z7e(t)?t:k7t(rz(t))}function z7t(t){return Y7e(t)?t:P7t(rz(t))}function qCi(t){return J7e(t)?t:I7t(rz(t))}function N7t(t){let{r:e,g:i,b:r,a:s}=t;return s<1&&(e=Math.round(s*e+255*(1-s)),i=Math.round(s*i+255*(1-s)),r=Math.round(s*r+255*(1-s))),new Je({r:e,g:i,b:r})}function V7t(t,e){const{r:i,g:r,b:s}=e?.ignoreAlpha?t:N7t(t);return .2126*i+.7152*r+.0722*s}function GCi(t,e=225){return V7t(t,{ignoreAlpha:!0})>e?new Je([0,0,0,t.a]):new Je([255,255,255,t.a])}function HCi(t,e){const i=z7t(t);i.l*=1-e;const r=rz(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function WCi(t,e){const i=t.clone();return i.a*=e,i}function ZCi(t,e){const i=F7t(t);i.s*=e;const r=rz(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function Dfe(t){return Je.toUnitRGBA(t)}function YCi(t,e){return t===e||t!=null&&t.equals(e)}function JCi(t,e){return t===e||t!=null&&e!=null&&J5(t,e)}function QCi(t){return $i(t[0],t[1],t[2],t.length>3?t[3]:1)}function j7t(t){return t[0]??=0,t[1]??=0,t[2]??=0,t}function XCi(t){return t.length=4,j7t(t),t[3]??=1,Ce(t[3],0,1),t}function KCi(t,e){const i=Je.toUnitRGBA(t);return i[3]*=e,i}function eMi(t,e,i={}){if(t.length===0||e<=0)return[];if((t=t.map(r=>typeof r=="string"?new Je(r):r)).length===1||e===1){const r=[],s=t[0];for(let n=0;n<e;n++)r.push(s.clone());return r}if(i.shuffle&&(t=XOe(se(t),i.seed)),t.length>=e){const r=[],s=(t.length-1)/(e-1);for(let n=0;n<e;n++){const a=Math.round(n*s);r.push(t[a].clone())}return r}return U7t(t,e,i)}function U7t(t,e,i={}){const r=[],s=t.length-1,n=Math.ceil((e-t.length)/s);e:for(let a=0;a<s;a++){const o=t[a],l=t[a+1];for(let u=1;u<=n;u++){const d=u/(n+1);if(r.push(B7t(o,l,d,i)),r.length+t.length===e)break e}}return[...t.map(a=>a.clone()),...XOe(r,i.seed??1)]}const RK=(t,e)=>{const i=Math.floor(10*e())-5;return Math.min(255,Math.max(0,t+i))};function B7t(t,e,i,r={}){const s=t.r,n=t.g,a=t.b,o=e.r,l=e.g,u=e.b,d=Math.round(s+(o-s)*i),f=Math.round(n+(l-n)*i),g=Math.round(a+(u-a)*i);if(!r.offset)return new Je([d,f,g]);const v=xle(r.seed);return new Je([RK(d,v),RK(f,v),RK(g,v)])}let tHe=class extends $r{constructor(){super(...arguments),this.radii=Ke(),this.heightParameters=li()}};function q7t(t){t.uniforms.add(new rc("radii",e=>e.radii),new Ca("heightParameters",e=>e.heightParameters)),t.constants.add("scaleHeight","float",Ci.scaleHeight*Ci.atmosphereHeight),t.code.add(A`float chapmanApproximation(float thickness, float height, float cosZenith) {
float c = sqrt(thickness + height);
float cExpH = c * exp(-height);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (thickness + height);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(thickness - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),t.code.add(A`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),t.code.add(A`vec4 planetIntersect(vec3 cameraPos, vec3 rayDir) {
float reducedPlanetRadius = radii[0] - 20000.0;
float rayPlanetDistance = heightParameters[1] - reducedPlanetRadius * reducedPlanetRadius;
vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, rayPlanetDistance);
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, heightParameters[2]);
bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
bool insideAtmosphere = heightParameters[0] < radii[1];
if (!(hitsAtmosphere || insideAtmosphere)) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;
if (heightParameters[0] < reducedPlanetRadius) {
if (dot(rayDir, normalize(cameraPos)) < -0.025) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
start = rayPlanetIntersect.y;
}
float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
return vec4(0.0, hitsPlanet ? 1.0 : 0.0, start, end);
}`)}function iHe(t,e){t.include(q7t);const i=6;t.uniforms.add(new Zo("cameraPosition",r=>r.camera.eye)),t.constants.add("betaRayleigh","vec3",vB),t.constants.add("betaCombined","vec3",dOt),t.constants.add("betaMie","float",hOt),t.code.add(A`
    vec3 raymarchAtmosphere(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      vec4 ray = planetIntersect(cameraPos, rayDir);
      if(ray.x == 1.0) {
        return vec3(0);
      }
      ${we(e,"if (terrainDepth != -1.0) { ray.w = terrainDepth; }")}

      vec3 samplePoint = cameraPos + rayDir * ray.w;
      float multiplier = ray.y == 1.0 ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (ray.w - ray.z) / ${A.float(i)};

      for (int i = 0; i < ${A.int(i)}; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
          ${we(!e,"scattering *= mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0))")};
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {
          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);
          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${we(!e,"scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);")}
        }
        lastOpticalDepth = opticalDepth;
      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;
      ${e?"return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;":A`const float g = 0.8;
             const float gg = g * g;
             float phaseMie = 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg));
             phaseMie = clamp(phaseMie, 0.0, 128.0);
             return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }`)}function sz(t,e={needUVs:!0,needEyeDirection:!0}){t.attributes.add("position","vec2"),t.varyings.add("worldRay","vec3");const{needUVs:i,needEyeDirection:r}=e;i&&t.varyings.add("uv","vec2"),r&&t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add(new _l("inverseProjectionMatrix",s=>s.camera.inverseProjectionMatrix),new _l("inverseViewMatrix",s=>s5e(G7t,s.camera.viewMatrix))),t.vertex.main.add(A`
    vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
    ${we(r,"eyeDir = posViewNear;")}
    worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
    ${we(i,"uv = position * 0.5 + vec2(0.5);")}
    gl_Position = vec4(position, 1, 1);
  `)}const G7t=ut();function rHe(t){const e=new Gi;e.include(sz);const{reduced:i}=t,{fragment:r}=e;return dm(r),r.include(G1),r.include(LF),r.include(NP),r.include(iHe,!1),r.uniforms.add(new Pr("backgroundColor",s=>s.backgroundColor),new _t("innerFadeDistance",s=>s.innerFadeDistance),new _t("altitudeFade",s=>s.altitudeFade),new Jo("depthTexture",s=>s.mainDepth)).code.add(A`vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
float rayPlanetDistance = heightParameters[1] - radii[0] * radii[0];
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, rayPlanetDistance);
if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
return fragColor;
}
float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
if (relDist > 1.0) {
return surfaceColor;
}
return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
}
float getGlow(float dist, float radius, float intensity) {
return pow(radius / max(dist, 1e-6), intensity);
}
vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){
float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));
vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));
float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));
return normalize(sunTransmittance) * sunDisc;
}`).main.add(A`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${we(!i,A`float depthSample = texture(depthTexture, uv).r;
             if (depthSample != 1.0) {
                fragColor = vec4(0);
                return;
             }`)}

      vec3 col = linearizeGamma(backgroundColor);
      col += raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      col += getSun(cameraPosition, rayDir, mainLightDirection);
      float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);
  `),e}const H7t=Object.freeze(Object.defineProperty({__proto__:null,build:rHe},Symbol.toStringTag,{value:"Module"}));let W7t=class extends tHe{constructor(){super(...arguments),this.innerFadeDistance=0,this.altitudeFade=0,this.backgroundColor=I()}},IK=class extends er{constructor(e,i){super(e,i,new Hi(H7t,()=>W(()=>Promise.resolve().then(()=>Mri),void 0)),Rp(zF))}initializePipeline(e){return _i({blending:e.reduced?Ode:D$(770,771),depthTest:{func:e.reduced?519:515},colorWrite:Fi})}},sHe=class extends Tl{constructor(){super(...arguments),this.reduced=!1}};c([ue()],sHe.prototype,"reduced",void 0);let kfe=class extends $r{};function nHe(){const t=new Gi;return t.include(no),t.fragment.uniforms.add(new Gt("colorTexture",e=>e.color),new Jo("depthTexture",e=>e.mainDepth)),t.fragment.main.add(A`float depthSample = texture(depthTexture, uv).r;
if (depthSample != 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const Z7t=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:kfe,build:nHe},Symbol.toStringTag,{value:"Module"}));let P3e=class extends er{constructor(e,i){super(e,i,new Hi(Z7t,()=>W(()=>Promise.resolve().then(()=>Eri),void 0)),wn)}initializePipeline(){return _i({blending:D$(770,771),depthTest:{func:519},colorWrite:Fi})}},voe=class extends Fg{constructor(){super(...arguments),this.requireGeometryDepth=!0,this._compositingPassParameters=new kfe,this._vao=null,this._passParameters=new W7t,this._configuration=new sHe}initialize(){this.techniques.precompile(IK,this._configuration),this.techniques.precompile(P3e),this._configuration.reduced=!0,this.techniques.precompile(IK,this._configuration),this._configuration.reduced=!1,this.addHandles([X(()=>this.view.environment.background,e=>{const i=e instanceof DBe?Dfe(e.color):Tn;xe(this._passParameters.backgroundColor,i[0]*i[3],i[1]*i[3],i[2]*i[3])},bt),X(()=>this.view.stage?.renderer?.fullResolutionAtmosphere,e=>this._configuration.reduced=!e,bt),X(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),bt)])}destroy(){this._vao=jt(this._vao)}render(e){const i=e.find(({name:S})=>S===wt.OPAQUE_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext;this._vao??=H1(r,1);const s=i.getAttachment(To);this._update();const n=this.techniques.get(IK,this._configuration);if(!n.compiled)return this.requestRender(1),i;if(!this._configuration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Sr.TRIANGLE_STRIP,0,4),i.attachDepth(s),i;const a=this.techniques.get(P3e);if(!a.compiled)return this.requestRender(1),i;const o=r.getViewport(),l=this.bindParameters.camera,u=Ve(l.eye)-Ci.radius;let d;const f=Ci.atmosphereHeight;if(u<f){const S=Math.min(1,Math.max(0,u/f));d=yt(.2,.3,S)}else{const S=Math.min(1,Math.max(0,(u-f)/(15*f)));d=yt(.3,.6,S)}const g=this.renderingContext.parameters.maxTextureSize,v=T1(Math.round(d*l.fullViewport[2]),g),_=T1(Math.round(d*l.fullViewport[3]),g);r.setViewport(0,0,v,_);const x=this.fboCache.acquire(v,_,"chapman",5);return r.bindFramebuffer(x.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(n,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Sr.TRIANGLE_STRIP,0,4),r.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=x.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(a,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(s),x.release(),i}_update(){const e=this.bindParameters.camera,i=ea(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]**2,n=Ce((r-this._passParameters.radii[0])/Ci.atmosphereHeight,0,1);Or(this._passParameters.heightParameters,r,i,s,n);const a=this.view.basemapTerrain?.getLowerBoundRadius()??0;oi(this._passParameters.radii,a,a+Ci.atmosphereHeight),this._passParameters.innerFadeDistance=2*Math.sqrt((2*a-rae)*rae),this._passParameters.altitudeFade=bde(r-a)}};voe=c([R("esri.views.3d.environment.ChapmanAtmosphere")],voe);function aHe(){const t=new Gi,{fragment:e}=t;return t.include(sz,{needUVs:!1,needEyeDirection:!1}),e.include(zP),t.include(Uqe,{pbrMode:0,lightingSphericalHarmonicsOrder:2}),e.include(JF),e.include(G1),t.include(j7e),e.uniforms.add(new Zo("cameraPosition",i=>i.camera.eye),new Vs("cloudsOpacity",i=>i.clouds.opacity)).main.add(A`vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4(cloudsOpacity * cloudsColor.rgb, cloudsColor.a);`),t}const Y7t=Object.freeze(Object.defineProperty({__proto__:null,build:aHe},Symbol.toStringTag,{value:"Module"}));let R3e=class extends er{constructor(e,i){super(e,i,new Hi(Y7t,()=>W(()=>Promise.resolve().then(()=>Ari),void 0)),wn)}initializePipeline(){return _i({blending:o_(1,0,770,1),depthTest:{func:515},colorWrite:Fi})}},_oe=class extends Fg{constructor(e){super(e),this._planetRadius=xr(e.view.spatialReference).radius}initialize(){this.techniques.precompile(R3e),this.addHandles([X(()=>this.view.environment.weather!=null&&this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Yt)])}destroy(){this._vao=jt(this._vao)}render(e){const i=e.find(({name:o})=>o===wt.OPAQUE_ENVIRONMENT),r=this.bindParameters.clouds;if(!r.data)return i;const s=this.techniques.get(R3e);if(!s.compiled)return this.requestRender(1),i;const n=this.renderingContext;this._vao??=H1(n);const a=n.bindTechnique(s,this.bindParameters);return n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),n.drawArrays(Sr.TRIANGLE_STRIP,0,4),r.isFading&&this.requestRender(2),i}};_oe=c([R("esri.views.3d.environment.CloudsComposition")],_oe);let oHe=class extends $r{constructor(){super(...arguments),this.atmosphereC=1}};function lHe(t){t.include(LF),t.uniforms.add(new _t("atmosphereC",e=>e.atmosphereC),new Zo("cameraPosition",e=>e.camera.eye)),t.code.add(A`float getDistanceFalloff(float dist, vec3 rayDir, float weight) {
if(dist == -1.0){
dist = 0.055 * sphereIntersect(cameraPosition, rayDir, atmosphereC).y;
}
return (1.0 - exp(-dist * weight));
}`)}let Lfe=class extends oHe{constructor(){super(...arguments),this.color=I(),this.strength=4e-6,this.amount=0,this.fogColorDistanceWeight=1}};function cHe(t){const e=new Gi;e.include(sz,{needUVs:!0,needEyeDirection:!0});const i=e.fragment,{hasEmissive:r}=t;return i.uniforms.add(new Jo("depthTexture",s=>s.mainDepth),new _t("fogStrength",s=>s.strength),new _t("fogAmount",s=>s.amount),new Pr("fogColor",s=>s.color),new _t("fogColorDistanceWeight",s=>s.fogColorDistanceWeight)),r&&i.uniforms.add(new Gt("emissionTexture",s=>s.emission)),i.include(lHe),i.include(G1),i.include(NP),i.include(Ip),i.main.add(A`
    vec3 rayDir = normalize(worldRay);
    float terrainDepth = -1.0;

    float depthSample = depthFromTexture(depthTexture, uv);
    if(depthSample < 1.0 && depthSample > 0.0){
      vec3 cameraSpaceRay = normalize(eyeDir);
      cameraSpaceRay /= cameraSpaceRay.z;
      cameraSpaceRay *= linearizeDepth(depthSample);
      terrainDepth = max(0.0, length(cameraSpaceRay));
    }

    float fogAmount = fogAmount * getDistanceFalloff(terrainDepth, rayDir, fogStrength);

    ${we(r,A`vec3 emission = texture(emissionTexture, uv).rgb;
           vec3 emissionDistanceCorrected = mix(emission, vec3(0.0), fogAmount * fogColorDistanceWeight);
           vec3 finalFogColor = fogColor * fogAmount + emissionDistanceCorrected;
           vec4 fog = vec4(finalFogColor, fogAmount);`,A`vec4 fog = vec4(fogColor, 1.0) * fogAmount;`)}
    fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));`),e}const J7t=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Lfe,build:cHe},Symbol.toStringTag,{value:"Module"}));let DK=class extends er{constructor(e,i){super(e,i,new Hi(J7t,()=>W(()=>Promise.resolve().then(()=>Ori),void 0)),wn)}initializePipeline(){return _i({blending:o_(770,0,771,1),colorWrite:Fi})}},uHe=class extends Tl{constructor(){super(...arguments),this.hasEmissive=!1}};c([ue()],uHe.prototype,"hasEmissive",void 0);function hHe(t){t.code.add(A`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),t.code.add(A`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),t.code.add(A`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`),t.code.add(A`const vec3 uninterpolatedRGBToFloatFactors = vec3(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBToFloat(vec3 rgb) {
return (dot(round(rgb * 255.0), uninterpolatedRGBToFloatFactors) - 0.5) * 2.0;
}`)}let nW=class extends $r{constructor(){super(...arguments),this.opacity=1}};function dHe(t){const e=new Gi,{blitEmissiveMode:i,blitMode:r,hasOpacityFactor:s}=t;e.include(no),e.fragment.uniforms.add(new Gt("tex",o=>o.texture)),s&&e.fragment.uniforms.add(new _t("opacity",o=>o.opacity));const n=r===3;n&&(e.fragment.uniforms.add(new Z0("nearFar",o=>o.camera.nearFar)),e.fragment.include(Ip),e.fragment.include(hHe));const a=i===1;return a&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragEmission","vec4",1)),e.fragment.main.add(A`
    ${n?A`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:A`
          fragColor = texture(tex, uv) ${s?"* opacity":""};`}
    ${we(a,"fragEmission = vec4(0.0, 0.0, 0.0, fragColor.a);")}`),e}const Q7t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:nW,build:dHe},Symbol.toStringTag,{value:"Module"}));let Mg=class extends er{constructor(e,i){super(e,i,new Hi(Q7t,()=>W(()=>Promise.resolve().then(()=>Pri),void 0)),wn)}initializePipeline(e){const{blitMode:i,blitEmissiveMode:r}=e,s=r?1:0;switch(i){case 0:case 3:return _i({colorWrite:Fi,drawBuffers:US(0,s)});case 1:return _i({blending:Xg,colorWrite:Fi,drawBuffers:US(0,s)});default:return _i({blending:j1,colorWrite:Fi,drawBuffers:US(0,s)})}}},u5=class extends Tl{constructor(){super(...arguments),this.blitMode=0,this.blitEmissiveMode=0,this.hasOpacityFactor=!1}};c([ue({count:4})],u5.prototype,"blitMode",void 0),c([ue({count:4})],u5.prototype,"blitEmissiveMode",void 0),c([ue()],u5.prototype,"hasOpacityFactor",void 0);let Ffe=class{constructor(e,i=0){this._techniques=e,this._parameters=new nW,this._configuration=new u5,this._configuration.blitMode=i,e.precompile(Mg,this._configuration),this._configuration.hasOpacityFactor=!0,e.precompile(Mg,this._configuration),this._configuration.hasOpacityFactor=!1}blit(e,i,r,s){this.blitTexture(e,i.getTexture(),r,s)}blitTexture(e,i,r,s){e.bindFramebuffer(r.fbo),e.setClearColor(0,0,0,1),e.clear(16384),this._parameters.texture=i;const n=this._techniques.get(Mg,this._configuration);e.bindTechnique(n,s,this._parameters),e.screen.draw()}blend(e,i,r,s,n=1){this._configuration.hasOpacityFactor=n<1;const a=this._techniques.get(Mg,this._configuration);return!!a.compiled&&(e.bindFramebuffer(r.fbo),this._parameters.texture=i.getTexture(),this._parameters.opacity=n,e.bindTechnique(a,s,this._parameters),e.screen.draw(),!0)}};const X7t=.95,K7t=1;let c8=class extends NS{constructor(e){super(e),this.consumes={required:[wt.TRANSPARENT_ENVIRONMENT]},this._configuration=new uHe,this.requireGeometryDepth=!0,this._newParameters=new kK,this._oldParameters=new kK,this._fadedParameters=new kK,this._parameters=this._newParameters,this._passParameters=new Lfe,this._blit=null;const i=xr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+i.atmosphereHeight;const r=e.view.stage.renderView.techniques;r.precompile(DK,this._configuration),this._configuration.hasEmissive=!this._configuration.hasEmissive,r.precompile(DK,this._configuration),this._configuration.hasEmissive=!this._configuration.hasEmissive}toogle(){this.view.environment.atmosphereEnabled&&this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([X(()=>this.view.environment.atmosphereEnabled,()=>this.toogle(),bt),X(()=>this.view.environment.weather,()=>this.toogle(),bt),X(()=>this._updateFogParameters(),()=>{},bt)]),this.addHandles(X(()=>this._fadeFactor,e=>this._fade(e),bt))}get _fadeFactor(){return this.view.stage?.renderer.renderContext.bind.clouds.fadeFactor??1}_fade(e){const{_newParameters:i,_oldParameters:r}=this;e>=1?(this._parameters=i,this._oldParameters.copyFrom(this._newParameters)):e<=0?this._parameters=r:(this._fadedParameters.lerp(r,i,e),this._parameters=this._fadedParameters)}_updateFogParameters(){const e=this.view.environment.weather,i=e.type==="foggy"||e.type==="snowy"||e.type==="rainy";this._newParameters.strength=e.type==="foggy"?yt(3e-5,.005,e.fogStrength**3):e.type==="snowy"||e.type==="rainy"?yt(4e-6,2e-4,(e.precipitation??0)**3):0,this._newParameters.amount=i?1:0,e.type!=="foggy"&&e.type!=="snowy"||me(this._newParameters.color,tHt),e.type==="rainy"&&me(this._newParameters.color,eHt),this._fadeFactor>=1&&this._oldParameters.copyFrom(this._newParameters),this.requestRender(1)}render(e){const i=e.find(({name:g})=>g===wt.TRANSPARENT_ENVIRONMENT);if(this._parameters.amount===0||(this._update(),this._passParameters.amount<=0))return i;const r=i.getAttachment(vl);this._configuration.hasEmissive=r!=null;const s=this.techniques.get(DK,this._configuration);if(!s.compiled)return this.requestRender(1),i;const n=i.getAttachment(To),a=this.renderingContext,{fullWidth:o,fullHeight:l}=this.bindParameters.camera,u=o,d=l;let f=null;return r&&(f=this.fboCache.acquire(u,d,"glow horizontal",8),this._blit??=new Ffe(this.techniques),this._blit.blitTexture(a,r?.attachment,f,this.bindParameters)),i.attachDepth(null),a.bindFramebuffer(i.fbo),r&&(this._passParameters.emission=f?.getTexture()),a.bindTechnique(s,this.bindParameters,this._passParameters),a.screen.draw(),i.attachDepth(n),f?.release(),i}_update(){const e=this.bindParameters.camera;Re(I3e,e.eye);const i=Math.max(0,Le(I3e,this.bindParameters.lighting.mainLight.direction)),r=this._parameters.color;he(D3e,r,.1),cr(this._passParameters.color,D3e,r,i);const s=Ve(e.eye);this._passParameters.atmosphereC=s**2-this._atmosphereRadius**2,this._passParameters.amount=(1-lO(X7t*mS,K7t*mS,Math.abs(s-this._planetRadius)))*this._parameters.amount,this._passParameters.strength=this._parameters.strength}get test(){return{parameters:this._passParameters}}};c([p()],c8.prototype,"consumes",void 0),c8=c([R("esri.views.3d.environment.Fog")],c8);let kK=class{constructor(){this.color=I(),this.strength=0,this.amount=0}copyFrom(e){this.amount=e.amount,this.strength=e.strength,me(this.color,e.color)}lerp(e,i,r){this.amount=yt(e.amount,i.amount,r),this.strength=yt(e.strength,i.strength,r),cr(this.color,e.color,i.color,r)}};const I3e=I(),D3e=I(),eHt=Ye(.5,.5,.5),tHt=Ye(1.5,1.5,1.5);let aW=class extends $r{constructor(){super(...arguments),this.texV=Ke(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new zfe}},zfe=class{constructor(){this.center=I(),this.v1=I(),this.v2=I()}};function pHe(t){const e=new Gi,{vertex:i,fragment:r}=e;if(dm(i),t.geometry===2)e.attributes.add("position","vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new Zo("cameraPosition",s=>s.camera.eye),new _t("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.main.add(A`float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);`),r.main.add(A`fragColor = color;`);else{e.include(Tw),e.attributes.add("position","vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===1;i.uniforms.add(new _l("proj",o=>o.camera.projectionMatrix),new _l("view",o=>o.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new Pr("silCircleCenter",o=>o.silhouette.center)),i.uniforms.add(new Pr("silCircleV1",o=>o.silhouette.v1)),i.uniforms.add(new Pr("silCircleV2",o=>o.silhouette.v2)),i.uniforms.add(new rc("texV",o=>o.texV)),i.uniforms.add(new _t("innerScale",o=>o.innerScale)));const n=6.2831853,a=1/128;i.main.add(A`
      ${s?A`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:A`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${A.float(n*a)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${A.float(a)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
	  `),r.uniforms.add(new Gt("tex",o=>o.texture)),s||r.uniforms.add(new _t("altitudeFade",o=>o.altitudeFade)),r.main.add(A`
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?A`fragColor = atmosphereColor;`:A`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));`}`)}return e}const iHt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:zfe,SimpleAtmospherePassParameters:aW,build:pHe},Symbol.toStringTag,{value:"Module"}));let IE=class extends er{constructor(e,i){super(e,i,new Hi(iHt,()=>W(()=>Promise.resolve().then(()=>Rri),void 0)),CL.locations)}initializePipeline(e){const i=e.geometry===1;return _i({blending:Xg,culling:i?Pde:void 0,depthTest:{func:515},colorWrite:Fi})}};const CL=Qu().vec3f("position").freeze();let Nfe=class extends Wf{constructor(){super(...arguments),this.geometry=0}};c([ue({count:3})],Nfe.prototype,"geometry",void 0);const rHt=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);let boe=class extends Fg{constructor(){super(...arguments),this._configuration=new Nfe,this._passParameters=new aW,this._vao=null,this._vaoCount=0}initialize(){this._configuration.geometry=1,this.addHandles([X(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Yt)])}destroy(){this._passParameters.texture=jt(this._passParameters.texture),this._vao=jt(this._vao)}precompile(){this.techniques.precompile(IE,this._configuration)}render(e){const i=e.find(({name:a})=>a===wt.OPAQUE_ENVIRONMENT),r=this.techniques.get(IE,this._configuration);if(!r.compiled)return this.requestRender(1),i;const s=this.renderingContext;if(this._vao||(this._vao=sHt(s),this._vaoCount=this._vao.vertexCount("geometry")),!this._passParameters.texture){const a=new ar(1,512);a.wrapMode=33071,a.flipped=!0,this._passParameters.texture=new qi(s,a,rHt)}const n=s.bindTechnique(r,this.bindParameters,this._passParameters);return nHt(k3e,this.bindParameters.camera.viewMatrix),n.setUniformMatrix4fv("view",k3e),s.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(Sr.TRIANGLES,0,this._vaoCount),i}};function sHt(t){const e=mqe(1,2,!1),{data:i,indices:r}=e[0][1],s=CL.createBuffer(r.length),n=s.position;for(let a=0;a<r.length;++a){const o=3*r[a%3==0?a+2:a%3==2?a-2:a];n.set(a,0,i[o]),n.set(a,1,i[o+1]),n.set(a,2,i[o+2])}return new bm(t,new vn(t,bl(CL),s.buffer))}function nHt(t,e){Ln(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}boe=c([R("esri.views.3d.environment.LocalAtmosphere")],boe);const k3e=ut(),aHt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),o6=128,L3e=-rae,F3e=0,LK=50,oHt=()=>1-511/512,lHt=fB([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let woe=class extends Fg{constructor(e){super(e),this._passParameters=new aW,this._configuration=new Nfe,this._vao=null,this._fadeVao=null,this._texV1=1;const i=e.view,r=xr(i.spatialReference),{outerAtmosphereRimWidth:s,radius:n}=r;this._planetRadius=n,this._innerRimFactor=1+L3e/n,this._middleRimFactor=1+F3e/n,this._outerRimFactor=1+s/n,this._texV0=F3e/s,this._texVScale=this._texV1-this._texV0;const a=i.stage.renderView.techniques;a.precompile(IE,this._configuration),this._configuration.geometry=2,a.precompile(IE,this._configuration)}initialize(){this.addHandles(X(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Yt))}destroy(){this._passParameters.texture=jt(this._passParameters.texture),this._fadeVao=jt(this._fadeVao),this._vao=jt(this._vao)}render(e){const i=e.find(({name:s})=>s===wt.OPAQUE_ENVIRONMENT);this._update();const r=this.renderingContext;if(!this._passParameters.texture){const s=new ar(1,512);s.wrapMode=33071,s.flipped=!0,this._passParameters.texture=new qi(r,s,aHt)}if(this._passParameters.undergroundFadeAlpha<1){this._vao??=this._createRibbon(r),this._configuration.geometry=0;const s=this.techniques.get(IE,this._configuration);if(!s.compiled)return this.requestRender(1),i;r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Sr.TRIANGLES,0,this._vao.vertexCount("geometry"))}if(this._passParameters.undergroundFadeAlpha>0){this._fadeVao??=H1(r),this._configuration.geometry=2;const s=this.techniques.get(IE,this._configuration);if(!s.compiled)return this.requestRender(1),i;r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(Sr.TRIANGLE_STRIP,0,this._fadeVao.vertexCount("geometry"))}return i}_update(){const e=this.bindParameters.camera,i=I(),r=this._planetRadius,s=Ve(e.eye),n=s-r;if(n<0){const v=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=v}else this._passParameters.undergroundFadeAlpha=0;const a=Math.max(LK,n),o=r+L3e;this._passParameters.innerScale=cHt(r+a,r,o)-1,this._passParameters.altitudeFade=bde(n),he(i,e.eye,(r+LK)/s),z3e(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),u=oHt(),d=lHt(n);let f=this._texV0+u*this._texVScale,g=this._texV0+l*d*this._texVScale;if(n>LK){z3e(e.eye,e.center,e.up,r,this._passParameters.silhouette);const v=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),_=Ce((v-1.5)/(l-1.5),0,1);f=this._texV0+_*u*this._texVScale,g=this._texV0+yt(this._texV1,l*d,_)*this._texVScale}oi(this._passParameters.texV,f,g)}_createRibbon(e){const i=Jh(3+3*o6*3),r=new Uint32Array(3*o6*5);i[0]=0,i[1]=0,i[2]=-1;for(let a=0;a<o6;a++){const o=9*a+3;i[o]=a,i[o+1]=this._innerRimFactor,i[o+2]=-1,i[o+3]=a,i[o+4]=this._middleRimFactor,i[o+5]=0,i[o+6]=a,i[o+7]=this._outerRimFactor,i[o+8]=1;const l=3*a+1,u=a===o6-1?1:l+3,d=15*a;r[d]=l,r[d+1]=l+1,r[d+2]=u+1,r[d+3]=u+1,r[d+4]=u,r[d+5]=l,r[d+6]=l+1,r[d+7]=l+2,r[d+8]=u+2,r[d+9]=u+2,r[d+10]=u+1,r[d+11]=l+1,r[d+12]=l,r[d+13]=u,r[d+14]=0}const s=CL.createBuffer(r.length),n=s.position;for(let a=0;a<r.length;++a){const o=3*r[a];n.set(a,0,i[o]),n.set(a,1,i[o+1]),n.set(a,2,i[o+2])}return new bm(e,new vn(e,bl(CL),s.buffer))}_computeScreenRimWidth(e,i,r,s){return $e(bM,s.center,s.v2),he(l6,bM,this._outerRimFactor),O7(FK,i,bM,r),xTe(bM,FK,e.projectionMatrix,e.viewport,bM),xTe(l6,FK,e.projectionMatrix,e.viewport,l6),Bi(bM,l6)/e.height}};function z3e(t,e,i,r,s){const n=Ve(t),a=r*Math.sqrt(n*n-r*r)/n,o=Math.sqrt(r*r-a*a),l=s.v1,u=s.v2;return he(s.center,t,o/n),At(l,t,e),ea(l)<1&&At(l,t,i),he(l,l,a/Ve(l)),At(u,l,t),he(u,u,a/Ve(u)),a}woe=c([R("esri.views.3d.environment.MarsAtmosphere")],woe);const FK=ut(),bM=I(),l6=I();function cHt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}function uHt(t,e,i){fHe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function fHe(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,a=i[0],o=i[1],l=i[2],u=i[4],d=i[5],f=i[6],g=i[8],v=i[9],_=i[10],x=i[12],S=i[13],T=i[14];let M=0,E=0;for(let P=0;P<n;P++){const O=e[M],D=e[M+1],L=e[M+2];t[E]=a*O+u*D+g*L+x,t[E+1]=o*O+d*D+v*L+S,t[E+2]=l*O+f*D+_*L+T,M+=s,E+=r}return t}function mHe(t,e,i){gHe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function gHe(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,a=i[0],o=i[1],l=i[2],u=i[3],d=i[4],f=i[5],g=i[6],v=i[7],_=i[8];let x=0,S=0;for(let T=0;T<n;T++){const M=e[x],E=e[x+1],P=e[x+2];t[S]=a*M+u*E+g*P,t[S+1]=o*M+d*E+v*P,t[S+2]=l*M+f*E+_*P,x+=s,S+=r}}function hHt(t,e,i){yHe(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function yHe(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let a=0,o=0;for(let l=0;l<n;l++)t[o]=i*e[a],t[o+1]=i*e[a+1],t[o+2]=i*e[a+2],a+=s,o+=r;return t}function dHt(t,e,i,r){vHe(t.typedBuffer,e.typedBuffer,i,r,t.typedBufferStride,e.typedBufferStride)}function vHe(t,e,i,r,s=3,n=s){const a=Math.min(t.length/s,e.length/n);let o=0,l=0;const u=1/EO;for(let d=0;d<a;d++)t[l]=r*(i*e[o])**u,t[l+1]=r*(i*e[o+1])**u,t[l+2]=r*(i*e[o+2])**u,o+=n,l+=s}function pHt(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let a=0,o=0;for(let l=0;l<n;l++)t[o]=e[a]+i[0],t[o+1]=e[a+1]+i[1],t[o+2]=e[a+2]+i[2],a+=s,o+=r;return t}function fHt(t,e){_He(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function _He(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,a=0;for(let o=0;o<s;o++){const l=e[n],u=e[n+1],d=e[n+2],f=l*l+u*u+d*d;if(f>0){const g=1/Math.sqrt(f);t[a]=g*l,t[a+1]=g*u,t[a+2]=g*d}n+=r,a+=i}}function mHt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,a=e.typedBuffer,o=e.typedBufferStride;let l=0,u=0;for(let d=0;d<r;d++)s[u]=a[l]>>i,s[u+1]=a[l+1]>>i,s[u+2]=a[l+2]>>i,l+=o,u+=n}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:vHe,linearToSRGBView:dHt,normalize:_He,normalizeView:fHt,scale:yHe,scaleView:hHt,shiftRight:mHt,transformMat3:gHe,transformMat3View:mHe,transformMat4:fHe,transformMat4View:uHt,translate:pHt},Symbol.toStringTag,{value:"Module"}));function gHt(t,e){Vfe(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Vfe(t,e,i=3,r=i){const s=e.length/r;let n=0,a=0;for(let o=0;o<s;++o)t[n]=e[a],t[n+1]=e[a+1],t[n+2]=e[a+2],n+=i,a+=r}function yHt(t,e,i,r,s){const n=t.typedBuffer,a=t.typedBufferStride,o=s?.count??t.count;let l=(s?.dstIndex??0)*a;for(let u=0;u<o;++u)n[l]=e,n[l+1]=i,n[l+2]=r,l+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:Vfe,copyView:gHt,fill:yHt},Symbol.toStringTag,{value:"Module"}));let vHt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),a=i[2*n];if(e<a){if(s-r===1)return!1;s=n;continue}if(e<a+i[2*n+1])return!0;if(s-r===1)return!1;r=n+1}return!1}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=_Ht(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let a=s;a<n;a++)if(!e(a))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],a=n+r[s+1],o=e[n],l=e[a];i[s]=o,i[s+1]=l-o}return i}};function _Ht(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let bHt=class{constructor(e,i){this.offsets=i,this._highlightsInOrder=[],this.pickability=null,this.componentHighlights=new Map,this.verticalOffsets=null,this._cachedGeometryRanges=null,this._cachedHighlightRangesMap=null,this._cachedShadowmapRanges=null;const r=this.count;this.visibility=new vHt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this._cachedGeometryRanges==null&&(this._cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this._cachedGeometryRanges}get highlightRangesMap(){return this.componentHighlights.size===0?null:(this._updateCachedHighlightRanges(),this._cachedHighlightRangesMap)}get shadowmapRanges(){return this.componentHighlights.size===0?this.geometryRanges:(this._updateCachedHighlightRanges(),this._cachedShadowmapRanges)}markHighlightsDirty(){this._cachedHighlightRangesMap=null,this._cachedShadowmapRanges=null}markVisibilityDirty(){this._cachedGeometryRanges=null,this.markHighlightsDirty()}updateHighlights(e){this._updateHighlightOrder(e)&&(this.markHighlightsDirty(),this._updateCachedHighlightRanges())}_updateHighlightOrder(e){const{_highlightsInOrder:i}=this;let r=i.length!==e.length;i.length=Math.min(e.length,8);for(let s=0;s<e.length;++s){const n=e.at(s).name;i.length<s?(r=!0,i.push(n)):i[s]!==n&&(i[s]=n,r=!0)}return r}_updateCachedHighlightRanges(){if(this._cachedHighlightRangesMap==null||this._cachedShadowmapRanges==null){const{highlightRangesMap:e,shadowmapRangesMap:i}=wHt(this.componentHighlights,this.visibility,this.offsets,this._highlightsInOrder);this._cachedHighlightRangesMap=e,this._cachedShadowmapRanges=i}}};function wHt(t,e,i,r){const s=new Map,n=[];if(t.size>0){let a=i.length;e.forEachComponent(o=>{let l=!1;for(let u=r.length-1;u>=0;--u){const d=r[u];if((t.get(d)?.[o]??0)>0){const g=Fu(s,d,()=>[]),v=i[o],_=i[o+1];g.push(v),g.push(_-v),l||=d===cm;break}}return l||(a!==o-1&&(n.length>0&&n.push(i[a+1]-n[n.length-1]),n.push(i[o])),a=o),!0}),n.length>0&&n.push(i[a+1]-n[n.length-1])}return{highlightRangesMap:s,shadowmapRangesMap:n}}let xHt=class{constructor(e,i,r,s,n,a){this.transform=e,this.toMapSpace=i,this.obb=r,this.componentData=s,this.renderable=n,this.intersectionGeometry=a,this.visible=!1,this.offsetObb=null,this._aabbInWorldCoordinates=null}destroy(){this.intersectionGeometry=Pe(this.intersectionGeometry),this.renderable=Pe(this.renderable),this.componentData=Pe(this.componentData)}get aabbInWorldCoordinates(){let e=this._aabbInWorldCoordinates;return e||(e=this._computeAabbInWorldCoordinates(),this._aabbInWorldCoordinates=e),e}_computeAabbInWorldCoordinates(){const e=nc(),{positions:i}=this.intersectionGeometry;if(Math.floor(i.length/3)>0){const{rotationScale:r,position:s}=this.transform;let n=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,d=-1/0;const f=I();for(let g=0;g<i.length;g+=3)xe(f,i[g+0],i[g+1],i[g+2]),Ql(f,f,r),$e(f,f,s),n=Math.min(n,f[0]),a=Math.min(a,f[1]),o=Math.min(o,f[2]),l=Math.max(l,f[0]),u=Math.max(u,f[1]),d=Math.max(d,f[2]);e[0]=n,e[1]=a,e[2]=o,e[3]=l,e[4]=u,e[5]=d}return e}};function SHt(t,e,i,r,s,n,a){const o=n-a,l=e-t,u=new Float64Array(4*l);for(let d=0;d<l;++d){const f=3*(d+t),g=s*i[f+0],v=r[g+0],_=r[g+1],x=o/(r[g+2]-a),S=v*x,T=_*x,M=s*i[f+1],E=r[M+0],P=r[M+1],O=o/(r[M+2]-a),D=E*O,L=P*O,F=s*i[f+2],j=r[F+0],N=r[F+1],B=o/(r[F+2]-a),U=j*B,Q=N*B,H=4*d;u[H+0]=Math.min(S,D,U),u[H+1]=Math.min(T,L,Q),u[H+2]=Math.max(S,D,U),u[H+3]=Math.max(T,L,Q)}return u}function THt(t,e,i,r,s){const n=e-t,a=new Float64Array(4*n);for(let o=0;o<n;++o){const l=3*(o+t),u=s*i[l+0],d=r[u+0],f=r[u+1],g=s*i[l+1],v=r[g+0],_=r[g+1],x=s*i[l+2],S=r[x+0],T=r[x+1],M=4*o;a[M+0]=Math.min(d,v,S),a[M+1]=Math.min(f,_,T),a[M+2]=Math.max(d,v,S),a[M+3]=Math.max(f,_,T)}return a}function $Ht(t,e){return new(CHt(t))(e)}function CHt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}function N3e(t,e,i,r){const[s,n,a]=r??t,o=a-i,l=e/Math.sqrt(s*s+n*n+o*o);t[0]+=s*l,t[1]+=n*l,t[2]+=o*l}let bHe=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=Ye(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:a,planetCenterZ:o}=this,l=(a-o)/(e[2]-o);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const a=s[n],{d:o,dim:l,minIndexIndex:u,minMidIndexIndex:d,maxMidIndexIndex:f,maxIndexIndex:g,aabb2D:v}=a;if(i<v[0]||i>v[2]||r<v[1]||r>v[3])break;if(l===-1||a.child0===-1&&a.child1===-1){this._intersectRange(u,g);break}{this._intersectRange(d,f);const _=(l===0?i:r)-o;if(_<0){if(a.child0===-1){this._intersectRange(u,d);break}n=a.child0}else{if(!(_>0))break;if(a.child1===-1){this._intersectRange(f,g);break}n=a.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],a=i[1];const{geometryMinZ:o}=this;if(!this.localMode){let _=0,x=1;const S=Math.min(.5*this.planetCenterZ,o),T=e[2],M=i[2];if(T<S&&M<S||(T<S&&(_=(S-T)/(M-T)),M<S&&(x=(S-T)/(M-T)),_>x))return;const E=(1-_)*e[0]+_*i[0],P=(1-_)*e[1]+_*i[1],O=(1-_)*e[2]+_*i[2],D=(1-x)*e[0]+x*i[0],L=(1-x)*e[1]+x*i[1],F=(1-x)*e[2]+x*i[2],{planetCenterZ:j}=this,N=o-j,B=N/(O-j);r=E*B,s=P*B;const U=N/(F-j);n=D*U,a=L*U}const l=n-r,u=a-s,d=this._bspNodes;let f=1;{const{aabb2D:_}=d[0],x=(M,E,P,O)=>{if(Math.abs(E)<1e-5*Math.max(O-P,1))return!1;const D=E>0,L=D?O:P,F=M+f*E;return(D?F<L:F>L)&&(f=Math.max((L-M)/E,f),!0)},S=()=>x(r,l,_[0],_[2]),T=()=>x(s,u,_[1],_[3]);Math.abs(l)>=Math.abs(u)?S()||T():T()||S()}const g=[0,0,f];let v=0;for(;v<g.length;){const _=g[v];let x=g[v+1],S=g[v+2];if(v+=3,x>S)continue;const T=d[_],{minIndexIndex:M,maxIndexIndex:E}=T,{child0:P,child1:O,minMidIndexIndex:D,maxMidIndexIndex:L,aabb2D:F,d:j,dim:N}=T;{const B=r+x*l,U=r+S*l,Q=Math.min(B,U),H=Math.max(B,U),J=F[0],Z=F[2];if(H<J||Z<Q)continue;if(Q<J){const K=(J-r)/l;l>0?x=Math.max(x,K):S=Math.min(S,K)}if(Z<H){const K=(Z-r)/l;l>0?S=Math.min(S,K):x=Math.max(x,K)}}{const B=s+x*u,U=s+S*u,Q=Math.min(B,U),H=Math.max(B,U),J=F[1],Z=F[3];if(H<J||Z<Q)continue;if(Q<J){const K=(J-s)/u;u>0?x=Math.max(x,K):S=Math.min(S,K)}if(Z<H){const K=(Z-s)/u;u>0?S=Math.min(S,K):x=Math.max(x,K)}}if(P===-1&&O===-1)this._intersectRange(M,E);else{const B=N===0?r:s,U=N===0?l:u,Q=B+x*U,H=B+S*U,J=Math.min(Q,H),Z=Math.max(Q,H),K=Ce((j-B)/U,0,f);M<D&&J<=j&&(P!==-1?(g.push(P),g.push(U>=0?x:Math.max(x,K)),g.push(U>=0?Math.min(S,K):S)):this._intersectRange(M,D)),this._intersectRange(D,L),L<E&&j<=Z&&(O!==-1?(g.push(O),g.push(U>=0?Math.max(x,K):x),g.push(U>=0?S:Math.min(S,K))):this._intersectRange(L,E))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=$Ht(e,e);this._elementIndexMap=i;for(let v=0;v<e;++v)i[v]=v;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:a}=this;let o=!1;if(!a){const{planetCenterZ:v,geometryMinZ:_}=this;o=v>=0||_<.5*v}const l=[],u=(v,_,x,S,T)=>{l.push(v),l.push(_),l.push(x),l.push(S<0?-1:(T?0:1)+2*S)},{maxBspNodeDepth:d,minBspNodeElementCount:f}=this,g=(v,_,x,S,T)=>{const M=n.length;if(M>0&&(o||x>=d||_-v<f))return;const E=fi();OHt(E,v,_,i,r);const{d:P,dim:O}=a?MHt(E):EHt(E),{rangeMidStart:D,rangeMidEnd:L}=AHt(v,_,O,P,i,r),F=x===d-1,j=!F&&D>=v+f,N=!F&&_>=L+f;if(j||N||M===0){const B=new PHt(v,D,L,_,O,P,E);if(j&&u(v,D,x+1,M,!0),N&&u(L,_,x+1,M,!1),n.push(B),S!==-1){const U=n[S];T?U.child0=M:U.child1=M}}};for(u(0,e,0,-1,!1);s<l.length;){const v=l[s],_=l[s+1],x=l[s+2],S=l[s+3];s+=4;const T=S>>1;g(v,_,x,T,S-(T<<1)==0)}this._generatedBVH=!0}};function MHt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,a;return r-e>=s-i?(a=.5*(e+r),n=0):(a=.5*(i+s),n=1),{d:a,dim:n}}function EHt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,a;return r-e>=s-i?(n=0,a=.5*(e+r)):(n=1,a=.5*(i+s)),{dim:n,d:a}}function AHt(t,e,i,r,s,n){let a=t;{let d=e;for(;a<d;){const f=s[a];V3e(f,i,r,n)<0?++a:(--d,s[a]=s[d],s[d]=f)}}const o=a;let l=a,u=e;for(;l<u;){const d=s[u-1];V3e(d,i,r,n)>0?--u:(s[u-1]=s[l],s[l]=d,++l)}return{rangeMidStart:o,rangeMidEnd:u}}function V3e(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function OHt(t,e,i,r,s){let n=1/0,a=1/0,o=-1/0,l=-1/0;for(let u=e;u<i;++u){const d=4*r[u];n=Math.min(n,s[d+0]),a=Math.min(a,s[d+1]),o=Math.max(o,s[d+2]),l=Math.max(l,s[d+3])}t[0]=n,t[1]=a,t[2]=o,t[3]=l}let PHt=class{constructor(e,i,r,s,n,a,o){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=a,this.aabb2D=o,this.child0=-1,this.child1=-1}},RHt=class{constructor(e,i,r,s,n,a,o,l,u){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=a,this.geometryMinZ=o,this.planetCenterZ=l,this.localMode=u,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=I(),this.ray0=I(),this.isVerticalRay=!1,this._triangleHitCallback=j3e,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new bHe(a-n,this)}getAabbs2D(){return this.localMode?THt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):SHt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,a){me(this.ray0,e),xi(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=a,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=j3e}intersectRange(e,i){const r=this._bvh.elementIndexMap;wHe(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function wHe(t,e,i,r,s,n,a,o,l,u,d,f=null,g=0){o!==0?dFt(t,e,i,r,s,n,a,o,l,u,d,f,g):_qe(t,e,i,r,s,n,a,u,d,f,g)}function j3e(){}function IHt(t,e,i){const r=t.count;if(e>=r)return;t.pickability??=new Uint32Array(0);let s=t.pickability;const n=SHe(s),a=e/n|0,o=e-n*a,l=(r-1)/n|0,u=s;if(!(e<u.length*n)&&!i){const d=a+1,f=Math.ceil(u.length*B9),g=l+1;let v=Math.max(d,f);v=Math.min(v,g),t.pickability=s=new Uint32Array(v),s.set(u)}a<s.length&&(s[a]=kHt(s[a],o,!i))}function xHe(t,e){if(t==null)return!0;const i=SHe(t);return!(e<t.length*i)||DHt(t,e,i)}function DHt(t,e,i){const r=e/i|0,s=e-r*i;return!LHt(t[r],s)}function SHe(t){return t.BYTES_PER_ELEMENT*8}function kHt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function LHt(t,e){return!!(t&1<<e)}let FHt=class{constructor(e,i,r,s,n,a,o,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=a,this.planetCenterZ=o,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=jHt,this._ray1=UHt,this._invDir=I(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=BHt,this._callback=U3e,this.rayDirectionC=I(),this._componentIndexMap=null,this._bvh=new bHe(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=q5(4*e),n=this._componentAabbs3D;for(let a=0;a<e;++a){const o=6*a,l=n[o+0],u=n[o+1],d=n[o+2],f=n[o+3],g=n[o+4],v=r/(d-i),_=r/(n[o+5]-i),x=Math.min(l*v,l*_),S=Math.min(u*v,u*_),T=Math.max(f*v,f*_),M=Math.max(g*v,g*_),E=4*a;s[E+0]=x,s[E+1]=S,s[E+2]=T,s[E+3]=M}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=q5(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,a=r[n+0],o=r[n+1],l=r[n+3],u=r[n+4],d=4*s;i[d+0]=a,i[d+1]=o,i[d+2]=l,i[d+3]=u}return i}intersectRay(e,i,r,s,n,a){const{isVerticalRay:o}=r;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=n??null,this._verticalOffset=a??null,this._tolerance=r.tolerance,this._intersectionOptions=r,this._componentIndexMap=this._bvh.elementIndexMap,vFt(e,i,this._invDir),this._callback=s,this._bvh.intersectRay(e,i,o),this._callback=U3e}intersectRange(e,i){const r=this._componentIndexMap,{pickability:s,visibility:n}=this._components;for(let a=e;a<i;++a){const o=r?r[a]:a;xHe(s,o)&&n.isVisible(o)&&this._intersectComponent(o)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){const i=this.getComponentAabb3D(e,zHt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:a,_ray0:o,_ray1:l,_invDir:u,planetCenterZ:d,_tolerance:f,rayDirectionC:g,componentIntersectionData:v}=this,{isVerticalRay:_}=this._intersectionOptions,x=this._components.offsets,S=me(NHt,o),T=me(VHt,l),M=n?.[e]??0,E=M+(a?.offset??0);if(E!==0&&(s?(S[2]=o[2]-E,T[2]=l[2]-E,r=!0):(a!=null&&(a.componentOffset=M),_&&(N3e(S,-E,d,o),N3e(T,-E,d,l),r=!0))),a==null||r||E===0||a.applyToAabb(i),!wqe(i,S,u,f))return;xi(g,T,S);const P=x[e]/3,O=x[e+1]/3,D=O-P,L=(Q,H,J)=>{this._callback(Q,H,e,J)},{vertexData:F,vertexStride:j,indexData:N,_intersectionOptions:B}=this,{normalRequired:U}=B;if(D>qHt){let Q=v[e];Q==null&&(Q=new RHt(e,F,j,N,P,O,this.geometryMinZ,d,s),v[e]=Q),Q.intersectRay(S,T,_,r?0:E,L,U)}else wHe(S,g,P,O,N,F,j,r?0:E,d,U,L)}};const zHt=nc(),NHt=I(),VHt=I(),jHt=I(),UHt=I(),U3e=()=>{},BHt=new LH,qHt=40;let GHt=class{constructor(e,i,r,s,n,a){this._componentOffsets=a,this._accelerationData=new V7e(r,s,n,new DF(e,3,i))}intersectRay(e,i,r,s){const n=(a,o,l)=>{const u=HHt(this._componentOffsets,o);s(a,o,u,l)};this._accelerationData.intersectRay(e,i,r,n)}};function HHt(t,e){const{length:i}=t;if(i===0||e<t[0])return-1;if(e>t[i-1])return i;let r=0,s=i-1;for(;s-r>1;){const n=Math.round(.5*(r+s));e<=t[n]?s=n:r=n}return r}let WHt=class{constructor(e,i,r,s){this.viewingMode=e,this.positionData=i,this._components=r,this._needsElevationAlignment=s,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=I(),this._componentBvh=null,this._aabb=nc(),this._indices=i.indices?SH(i.indices):IP(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,a,o){this.verticalOffset=r,this.componentVerticalOffsets=s;const{position:l}=n,u=xi(ZHt,e,l),d=xi(YHt,i,l),f=_$(JHt,n.rotationScale);Ql(u,u,f),Ql(d,d,f);const g=R1(XHt,f);if(this.viewingMode===1){const _=this._planetCenter;fp(_,l),Ql(_,_,f)}const v=(_,x,S,T)=>{o(S,_,T?Ql(QHt,T,g):null,x)};this._intersectComponents(u,d,s,r,v,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,a=Jh(6*n),o=this._indices,l=this._positions,u=this._components.offsets;let d=0,f=1/0,g=1/0,v=1/0,_=-1/0,x=-1/0,S=-1/0;for(let T=0;T<n;T++){const M=u[T],E=u[T+1];let P=1/0,O=1/0,D=1/0,L=-1/0,F=-1/0,j=-1/0;if(M<E)for(let N=M;N<E;N++){const B=3*o[N],U=l[B],Q=l[B+1],H=l[B+2];P=Math.min(P,U),O=Math.min(O,Q),D=Math.min(D,H),L=Math.max(L,U),F=Math.max(F,Q),j=Math.max(j,H)}else P=i,O=r,D=s,L=i,F=r,j=s;a[d++]=P,a[d++]=O,a[d++]=D,a[d++]=L,a[d++]=F,a[d++]=j,f=Math.min(f,P),g=Math.min(g,O),v=Math.min(v,D),_=Math.max(_,L),x=Math.max(x,F),S=Math.max(S,j)}return this._aabb[0]=f,this._aabb[1]=g,this._aabb[2]=v,this._aabb[3]=_,this._aabb[4]=x,this._aabb[5]=S,a}_intersectComponents(e,i,r,s,n,a){let o=this._componentBvh;o==null&&(o=this._needsElevationAlignment?new FHt(this._positions,B3e,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode):new GHt(this._positions,B3e,this._indices,0,this.numTriangles,this._components.offsets),this._componentBvh=o),o.intersectRay(e,i,a,n,r??void 0,s??void 0)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===2}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const ZHt=I(),YHt=I(),JHt=Jr(),QHt=I(),XHt=Jr(),B3e=3;let KHt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},eWt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}};function tWt(t,e){const i=new $o,{eye:r,frustum:s,viewForward:n}=t;e.forAll(a=>{const o=a.offsetObb!=null?a.offsetObb:a.obb,l=Le(xi(Eh,o.center,r),n),u=o.projectedRadius(n);if(i.within(l-u)&&i.within(l+u))return;const d=aWt(o,s);if(d===-1)return;if(d===0)return Gy.far=l+u,Gy.near=l-u,void i.union(Gy);const f=c6.pushNew();f.near=l-u,f.far=l+u,f.mask=d,f.object=a});for(let a=0;a<c6.length;a++){const o=c6.data[a];if(i.within(o.near)&&i.within(o.far))continue;Gy.far=o.far,Gy.near=1/0,nWt(o.object.offsetObb!=null?o.object.offsetObb:o.object.obb,r,iWt,u=>{let d=rWt;for(let f=0;f<THe&&u.length>0;f++){if(!(o.mask&1<<f))continue;sWt(s[f],u,d);const g=u;u=d,d=g}for(let f=0;f<u.length;f+=3){xe(Cc,u.data[f],u.data[f+1],u.data[f+2]);const g=Le(xi(Cc,Cc,r),n);Gy.near=Math.min(Gy.near,g)}})===0&&(Gy.near=0),i.union(Gy)}return c6.length=0,i}const c6=new Ai({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),Gy=new $o,Cc=I(),jx=I(),iWt=new Ai({deallocator:null}),rWt=new Ai({deallocator:null});function sWt(t,e,i){i.length=0;const r=e.length-3;zK(Cc,e,r);const s=Ya(t,Cc);s<=0&&(i.push(Cc[0]),i.push(Cc[1]),i.push(Cc[2]));let n=0,a=s;for(;n<r;n+=3){zK(jx,e,n);const o=Ya(t,jx);a*o<0&&(cr(Cc,jx,Cc,o/(o-a)),Mc(i,Cc)),o<=0&&Mc(i,jx),a=o,me(Cc,jx)}a*s<0&&(zK(jx,e,r),cr(Cc,jx,Cc,s/(s-a)),Mc(i,Cc))}function zK(t,e,i){return xe(t,e.data[i],e.data[i+1],e.data[i+2])}function Mc(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function nWt(t,e,i,r){Lw(G3e,t.quaternion),xi(Eh,e,t.center),Eu(Eh,Eh,G3e);const s=t.halfSize,n=8*((Eh[0]<-s[0]?-1:Eh[0]>s[0]?1:0)+3*(Eh[1]<-s[1]?-1:Eh[1]>s[1]?1:0)+9*(Eh[2]<-s[2]?-1:Eh[2]>s[2]?1:0)+13),a=q3e[n];if(a===0)return a;R5(u6,t.quaternion),cF(u6,u6,t.halfSize);const o=(l,u)=>{const d=q3e[n+u+1];return xe(l,((1&d)<<1)-1,(2&d)-1,((4&d)>>1)-1),Ql(l,l,u6),$e(l,t.center,l)};return i.length=0,Mc(i,o(NK,0)),Mc(i,o(H3e,1)),Mc(i,o(Eh,2)),Mc(i,o(W3e,3)),r(i),a===1||(i.length=0,Mc(i,NK),Mc(i,W3e),Mc(i,o(Eh,4)),Mc(i,o(Z3e,5)),r(i),a===2||(i.length=0,Mc(i,NK),Mc(i,Z3e),Mc(i,o(Eh,6)),Mc(i,H3e),r(i))),a}const q3e=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),THe=4;function aWt(t,e){let i=0;for(let r=0;r<THe;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const u6=Jr(),G3e=Pp(),Eh=I(),NK=I(),H3e=I(),W3e=I(),Z3e=I();let oWt=class{constructor(e){this._objects=e}destroy(){this._objects=null}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryDepthRange(e){return this._objects.visibleObjects.length?tWt(e,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some(e=>e.renderable.material.hasEmissions)}hasHighlight(e){return this._objects.hasHighlight(e)}},zMi=class{constructor(e,i,r,s){this.vertices=e,this.positionData=i,this.indices=r,this.componentOffsets=s}},VMi=class extends $r{constructor(e,i,r,s,n){super(),this.hasVertexColors=e,this.textureCoordinateType=i,this.hasNormals=r,this.shadeNormals=s,this.applySSAO=n}};function $He(t){const e=Qu().vec3f("position");return t.hasNormals&&e.vec2i16("normalCompressed",{glNormalized:!0}),t.textureCoordinateType===1?e.vec2f("uv0"):t.textureCoordinateType===2&&(e.vec2f("uv0"),e.vec4u16("uvRegion",{glNormalized:!0})),t.hasVertexColors&&e.vec4u8("color",{glNormalized:!0}),e.freeze()}let lWt=class{constructor(){this.externalColor=li(),this.externalColorMixMode=1,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0,this.emissiveStrength=$zt,this.emissiveSource=0}};function cWt(t){t.vertex.code.add(A`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${A.int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${A.int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${A.int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${A.int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let uWt=class extends Ki{constructor(e,i){super(e,"int",2,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};const CHe=429496.7296;function hWt(t,e){b7t(t/CHe*.5+.5,e)}const MHe=1e6;function dWt(t,e){w7t(t/MHe*.5+.5,e)}function EHe(){return 3+(Ep()?1:0)}function pWt(t,e){switch(e.componentData){case 1:return fWt(t,e);case 0:return mWt(t,e);case 2:return;default:e.componentData}}function fWt(t,e){const{vertex:i,fragment:r}=t;i.include(hHe),i.uniforms.add(new S1("componentColorTex",o=>o.componentParameters.texture.texture)),t.attributes.add("componentIndex","float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const{output:s}=e,n=s===10;n&&t.varyings.add("vObjectAndLayerIdColor","vec4");const a=s===1;a&&(t.varyings.add("emissiveStrength","float"),t.varyings.add("emissiveSource","int")),t.include(cWt),i.constants.add("stride","float",EHe()),i.code.add(A`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(A`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${A.float(CHe)};
  }

  void forwardEmissiveStrength() {
    ${we(a,A`vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
           vec4 encodedEmissive = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
           emissiveStrength = uninterpolatedRGBToFloat(encodedEmissive.rgb) * ${A.float(MHe)};
           emissiveSource = encodedEmissive.a == 0.0 ? 0 : 1;`)}
  }

  void forwardObjectAndLayerIdColor() {
    ${we(n,A`vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 3.0);
           vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);`)}
  }

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(A`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?A`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function mWt(t,e){const{vertex:i,fragment:r}=t;t.varyings.add("vExternalColor","vec4"),r.uniforms.add(new jH("emissiveStrength",n=>n.componentParameters.emissiveStrength)),i.uniforms.add(new mL("externalColor",n=>n.componentParameters.externalColor)).code.add(A`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
void forwardEmissiveStrength() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===10;r.uniforms.add(new uWt("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)).code.add(A`
    void readExternalColor(out vec4 color, out int colorMixMode) {
      color = vExternalColor;
      colorMixMode = externalColorMixMode;
    }

    void outputObjectAndLayerIdColor() {
      ${we(s,"fragColor = vec4(0, 0, 0, 0);")}
    }
  `)}function Y3e(t,e){const i=t.fragment;switch(e.doubleSidedMode){case 0:i.code.add(A`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case 1:t.include(t5,e),i.code.add(A`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case 2:i.code.add(A`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case 3:}switch(e.normalType){case 0:case 1:t.include(NH,e),i.main.add(A`vec3 fragmentFaceNormal = _adjustDoublesided(normalize(vNormalWorld));
vec3 fragmentFaceNormalView = gl_FrontFacing ? normalize(vNormalView) : -normalize(vNormalView);`);break;case 2:t.include(t5,e),i.main.add(A`vec3 fragmentFaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
vec3 fragmentFaceNormalView = normalize(cross(dFdx(vPosition_view), dFdy(vPosition_view)));`)}e.shadeNormals?i.main.add(A`vec3 fragmentShadingNormal = fragmentFaceNormal;`):e.spherical?(t.include(t5,e),i.main.add(A`vec3 fragmentShadingNormal = normalize(positionWorld());`)):i.main.add(A`vec3 fragmentShadingNormal = vec3(0.0, 0.0, 1.0);`)}function gWt(t,e){t.include(VH,e),t.fragment.include(Dpe);const i=t.fragment;i.uniforms.add(new mL("baseColor",r=>r.baseColor)),i.uniforms.add(new jH("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(A`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(A`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(A`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function yWt(t,e){const i=e.hasColorTexture&&(Ps(e.output)||e.alphaDiscardMode!==1);i&&(t.include(UH,e),t.fragment.uniforms.add(new S1("baseColorTexture",r=>r.texture))),t.fragment.code.add(A`
    vec4 readBaseColorTexture() {
      return ${i?"textureLookup(baseColorTexture, vuv0)":"vec4(1.0)"};
    }
  `)}function vWt(t,e){t.fragment.uniforms.add(new Go("heightParameters",i=>{const r=i.camera,s=ea(r.eye),n=Math.sqrt(s),a=e.radius,o=s-a*a;let l=lO(4e6,5e6,n-a);return l=Math.min(l,.98),$i(l,o,0,0)}),new Zo("cameraPosition",i=>i.camera.eye)),t.fragment.include(LF),t.fragment.code.add(A`float sphereFade() {return heightParameters[0];}
float sphereDepthInterpolate(vec3 worldRay, vec3 viewRay, float currentLinearDepth) {
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, worldRay, heightParameters[1]);
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
if (hitsPlanet) {
float sphereDepth = rayPlanetIntersect.x;
viewRay *= viewRay.z*sphereDepth;
float linearDepth = length(viewRay);
float sphereFade = heightParameters[0];
return (-linearDepth)*sphereFade + currentLinearDepth*(1.0-sphereFade);
}
return currentLinearDepth;
}`)}function AHe(t){const e=new Gi,{vertex:i,fragment:r}=e;e.include(t5,t),e.include(NH,t),e.include(VH,t),e.include(h0,t),e.include(pWt,t),e.include(UFt,t),r.include(B4t,t),e.include(yWt,t),e.include(WF,t);const{output:s,pbrMode:n,hasNormalTexture:a,snowCover:o,receiveShadows:l,shadeNormals:u,spherical:d,ellipsoidMode:f,overlayEnabled:g,componentData:v,vertexDiscardMode:_,renderOccluded:x}=t,S=n===1||n===2;S&&(e.include(Ape,t),a&&e.include(zqe,t));const T=s===4||s===5||s===6,M=T&&v===1,E=f===1,P=f===1?Ci.radius:E?Xf.radius:O0.radius;g&&(e.include(JO,t),e.include(Z9t,t),i.code.add(`
      ${we(d,`const float invRadius = ${A.float(1/P)};`)}
      vec2 projectOverlay(vec3 pos) { return pos.xy ${we(d,"/ (1.0 + invRadius * pos.z);")}; }`));const O=g&&Ps(s)&&n===4;O&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3"));const D=_===0,L=_===2,F=1-1/255;if(e.include(Rpe,t),e.include(zFt,t),i.main.add(A`
    bool castShadows;
    vec4 externalColor = forwardExternalColor(castShadows);
    ${we(M,"if(!castShadows) { gl_Position = vec4(vec3(1e38), 1.0); return; }")}

    ${we(!D,`{ if (externalColor.a ${L?">":"<="} ${A.float(F)}) { gl_Position = vec4(vec3(1e38), 1.0); return; } }`)}

    ${we(s===10,"externalColor.a = 1.0;")}

    forwardPosition(readElevationOffset());
    forwardViewPosDepth(vPosition_view);
    forwardNormal();
    forwardTextureCoordinates();
    forwardVertexColor();
    forwardLinearDepthToReadShadowMap();
    forwardLinearDepthToWriteShadowMap();
    forwardEmissiveStrength();
    forwardObjectAndLayerIdColor();
    ${we(O,d?A`
            groundNormal = normalize(positionWorld());
            tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
            tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:A`
            groundNormal = vec3(0.0, 0.0, 1.0);
            tbnTangent = vec3(1.0, 0.0, 0.0);
            tbnBiTangent = vec3(0.0, 1.0, 0.0);`)}
    ${we(g,"setOverlayVTC(projectOverlay(position));")}

    if (externalColor.a < ${A.float(ls)}) {
      // Discard this vertex
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
  `),Ps(s))return e.include(gWt,t),e.include(Y3e,t),e.include(JO,t),e.include(WH,t),r.include(kpe,t),r.code.add(A`
      float evaluateShadow() {
        return ${l?"readShadowMap(vPositionWorldCameraRelative, linearDepth)":"0.0"};
      }`),r.main.add(A`
      discardBySlice(vPositionWorldCameraRelative);
      discardByTerrainDepth();

      vec4 textureColor = readBaseColorTexture();
      discardOrAdjustAlpha(textureColor);

      /* When rendering the occluded overlay, we still need to read the base color texture
       * because we need to use the same discard logic. However after that to render only the
       * draped overlay, we simply set the base texture color to zero. */
      ${we(x,A`textureColor = vec4(0);`)}

      ${we(g,A`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`)}

      /* Early discard to only emit when we have overlay */
      ${we(g&&x,A`if (overlayColor.a < ${A.float(ls)}) { discard; }`)}

      vec4 externalColor;
      int externalColorMixMode;
      readExternalColor(externalColor, externalColorMixMode);

      vec4 materialColor = computeMaterialColor(textureColor, externalColor, externalColorMixMode);
    `),S?(Y0(r),d&&YO(r),r.main.add(A`
        applyPBRFactors();
        ${we(n===1,A`if (externalColorMixMode == 3) {
              mrr = vec3(0.0, 0.6, 0.2);
            }`)}
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
        ${we(a,"mat3 tangentSpace = computeTangentSpace(fragmentFaceNormal, vPositionWorldCameraRelative, vuv0);")}
        vec3 shadingNormal = ${a?"computeTextureNormal(tangentSpace, vuv0)":"fragmentShadingNormal"};
        vec3 groundNormal = ${d?A`normalize(positionWorld())`:A`vec3(0.0, 0.0, 1.0)`};

        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${we(o,A`float snow = getSnow(fragmentFaceNormal, normalize(positionWorld()));
                 materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                 ssao = mix(ssao, 0.5 * ssao, snow);
                 shadingNormal = mix(shadingNormal, fragmentFaceNormal, snow);`)}
        ${we(g,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        ${we(d,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        ${d?A`float shadow = max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow());`:"float shadow = evaluateShadow();"}
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, shadow, ssao, additionalLight, viewDir, groundNormal, mrr, additionalIrradiance), materialColor.a);
        `)):(dm(r),d&&YO(r),O&&r.uniforms.add(new Jo("ovNormalTex",Q=>Q.overlay?.getTexture(3))),r.main.add(A`
        ${we(d,"float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());")}
        float shadow = ${l?d?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow())":"evaluateShadow()":d?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        ${we(l&&!u,A`
            float dotFL = dot(fragmentFaceNormal, mainLightDirection);
            if( dotFL <= 0.0) shadow = 1.0;
        `)}
        ${we(o,A`float snow = getSnow(fragmentFaceNormal, normalize(positionWorld()));
               materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)}

        // At global scale we create some additional ambient light based on the main light to simulate global illumination
        float ssao = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());

        ${we(g,"materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec4 shadedColor = vec4(evaluateSceneLighting(fragmentShadingNormal, materialColor.rgb, shadow, ssao, additionalLight), materialColor.a);
        ${we(O,A`vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
                 float waterNormalLength = length(overlayWaterMask);
                 if (waterNormalLength > 0.95) {
                   mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                   vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                   vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                   // un-gamma the ground color to mix in linear space
                   shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
                 }`)}
      `)),r.main.add(`outputColorHighlightOID(shadedColor, vPositionWorldCameraRelative, materialColor.rgb ${we(o,", snow")});`),t.sphereDepthInterpolate&&(e.include(vWt,{radius:P*rIe}),e.fragment.include(Ip),r.main.add(A`if (sphereFade()>0.0) {
vec3 worldRay = normalize(vPositionWorldCameraRelative);
vec3 viewRay = normalize(vPosition_view);
gl_FragDepth = delinearizeDepth(sphereDepthInterpolate(worldRay, viewRay, linearizeDepth(gl_FragCoord.z)));
} else {
gl_FragDepth = gl_FragCoord.z;
}`)),e;const j=s===3,N=s===10,B=s===9,U=T||s===7||s===8;return U&&e.include(Cpe,t),j&&e.include(Y3e,t),g&&e.include(B7e,t),e.include(FP,t),r.main.add(A`
    discardBySlice(vPositionWorldCameraRelative);

    vec4 textureColor = readBaseColorTexture();
    discardOrAdjustAlpha(textureColor);

    ${we(U,"outputDepth(linearDepth);")}
    ${we(j,A`fragColor = vec4(vec3(0.5) + 0.5 * fragmentFaceNormalView, 1.0);`)}
    ${we(N,g?"fragColor = getOverlayColorTexel();":"outputObjectAndLayerIdColor();")}
    ${we(B,we(g,A`calculateOcclusionAndOutputHighlight(getAllOverlayHighlightValuesEncoded());`,A`calculateOcclusionAndOutputHighlight();`))}`),e}const _Wt=Object.freeze(Object.defineProperty({__proto__:null,build:AHe},Symbol.toStringTag,{value:"Module"}));let bWt=class extends er{constructor(e,i){super(e,i,new Hi(_Wt,()=>W(()=>Promise.resolve().then(()=>Iri),void 0)),bH([bl($He(i)),OHe]))}initializePipeline(e){const{integratedMeshMode:i,output:r,blendingEnabled:s,cullFace:n,hasOccludees:a,hasPolygonOffset:o,oitPass:l,renderOccluded:u}=e,d=i!==0,f=l===0,g=l===2;return _i({blending:u?j1:Ps(r)&&s?kH(l):null,culling:xUe(n),depthTest:u?null:{func:mpe(l)},depthWrite:u||!f&&!g?null:FF,drawBuffers:pS(r,US(l,r)),colorWrite:Fi,stencilWrite:!u&&d||a?jG:null,stencilTest:d?EFt(1):a?Tpe:null,polygonOffset:f||g?o?{factor:2,units:2}:null:fpe})}};const OHe=bl(Qu().u16("componentIndex"));let dr=class extends Tl{constructor(e){super(),this.spherical=e,this.output=0,this.textureCoordinateType=0,this.componentData=0,this.cullFace=2,this.vertexDiscardMode=0,this.doubleSidedMode=2,this.alphaDiscardMode=1,this.integratedMeshMode=0,this.oitPass=0,this.ellipsoidMode=1,this.pbrMode=0,this.normalType=0,this.emissionSource=0,this.hasVertexColors=!1,this.hasNormals=!1,this.shadeNormals=!0,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.hasHighlightMixTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.screenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasNormalTextureTransform=!1,this.cloudReflections=!0,this.snowCover=!1,this.olidColor=!1,this.renderOccluded=!1,this.sphereDepthInterpolate=!1,this.discardInvisibleFragments=!1,this.occlusionPass=!1,this.bindType=2,this.useCustomDTRExponentForWater=!1,this.hasVertexTangents=!1,this.highStepCount=!1,this.instanced=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.useFillLights=!0,this.draped=!1}get overlayEnabled(){return(this.integratedMeshMode===2||this.integratedMeshMode===3)&&H4(this.output)}};c([ue({count:11})],dr.prototype,"output",void 0),c([ue({count:3})],dr.prototype,"textureCoordinateType",void 0),c([ue({count:2})],dr.prototype,"componentData",void 0),c([ue({count:3})],dr.prototype,"cullFace",void 0),c([ue({count:3})],dr.prototype,"vertexDiscardMode",void 0),c([ue({count:3})],dr.prototype,"doubleSidedMode",void 0),c([ue({count:4})],dr.prototype,"alphaDiscardMode",void 0),c([ue({count:4})],dr.prototype,"integratedMeshMode",void 0),c([ue({count:3})],dr.prototype,"oitPass",void 0),c([ue({count:4})],dr.prototype,"ellipsoidMode",void 0),c([ue({count:7})],dr.prototype,"pbrMode",void 0),c([ue({count:3})],dr.prototype,"normalType",void 0),c([ue({count:8})],dr.prototype,"emissionSource",void 0),c([ue()],dr.prototype,"hasVertexColors",void 0),c([ue()],dr.prototype,"hasNormals",void 0),c([ue()],dr.prototype,"shadeNormals",void 0),c([ue()],dr.prototype,"hasSlicePlane",void 0),c([ue()],dr.prototype,"hasColorTexture",void 0),c([ue()],dr.prototype,"hasHighlightMixTexture",void 0),c([ue()],dr.prototype,"receiveAmbientOcclusion",void 0),c([ue()],dr.prototype,"receiveShadows",void 0),c([ue()],dr.prototype,"blendingEnabled",void 0),c([ue()],dr.prototype,"screenSpaceReflections",void 0),c([ue()],dr.prototype,"hasPolygonOffset",void 0),c([ue()],dr.prototype,"hasMetallicRoughnessTexture",void 0),c([ue()],dr.prototype,"hasOcclusionTexture",void 0),c([ue()],dr.prototype,"hasNormalTexture",void 0),c([ue()],dr.prototype,"hasOccludees",void 0),c([ue()],dr.prototype,"terrainDepthTest",void 0),c([ue()],dr.prototype,"cullAboveTerrain",void 0),c([ue()],dr.prototype,"hasNormalTextureTransform",void 0),c([ue()],dr.prototype,"cloudReflections",void 0),c([ue()],dr.prototype,"snowCover",void 0),c([ue()],dr.prototype,"olidColor",void 0),c([ue()],dr.prototype,"renderOccluded",void 0),c([ue()],dr.prototype,"sphereDepthInterpolate",void 0);let wWt=class extends $r{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},jfe=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Ir(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const a=this[r];if(a==null)this[r]=Array.from(n);else{if(s.equals(a,n))return;s.copy(a,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function J3e(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let PHe=class{constructor(e){this._low=I(),this._high=I(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){me(this._low,me(Q3e,e));const i=xi(Q3e,e,this._low);me(this._high,i)}get(e){return $e(e,this._low,this._high)}getLowScaled(e){return he(e,this._low,1)}};const Q3e=Iu();let qn=class extends wWt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=Q5(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.sphereDepthInterpolate=!1,this.mrrFactors=Eqe,this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.normalTexture=null,this.occlusionTexture=null,this.emissionTexture=null,this.emissiveBaseColor=l1(0,0,0),this.emissiveStrength=0,this.commonMaterialParameters=new u8,this.componentParameters=new K2,this.objectOpacity=1,this.textureAlphaCutoff=ls,this.alphaDiscardMode=1,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=1,this.hasOccludees=!1;const r=new PHe(e.position),s=DIe(e.rotationScale);_$(s,s),R1(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get _hasEmissiveBase(){return this.emissionTexture!=null||!di(this.emissiveBaseColor,Aa)}get _hasEmissiveStrength(){return this.componentParameters.emissiveOverride!==2}get hasEmissions(){return this._hasEmissiveStrength&&(this._hasEmissiveBase||this.componentParameters.emissiveSourceOverride!==2)}get texture(){return this.baseColorTexture?.glTexture}get textureMetallicRoughness(){return this.metallicRoughnessTexture?.glTexture}get textureEmissive(){return this.emissionTexture?.glTexture}get textureOcclusion(){return this.occlusionTexture?.glTexture}get textureNormal(){return this.normalTexture?.glTexture}acquireTechnique(e,i,r,s){const n=new dr(e.context.spherical);n.renderOccluded=r.slot===9,n.hasVertexColors=s.hasVertexColors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinateType,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.sphereDepthInterpolate=this.sphereDepthInterpolate&&e.viewingMode===1,n.oitPass=i.identifier===0&&r.oitPass!=null?r.oitPass:0,n.terrainDepthTest=i.identifier===0&&r.terrainDepthTest,n.cullAboveTerrain=i.identifier===0&&r.cullAboveTerrain,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,n.hasColorTexture=this.baseColorTexture!=null;const a=this._computeWhichMaterialPass();n.blendingEnabled=a===1||a===2,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?TWt(r)?SWt(r)?3:2:1:0,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===3?4:this.usePBR?this.hasParametersFromSource?s.shadeNormals&&this.isIntegratedMesh?0:2:1:0;const o=this.componentParameters.emissiveSourceOverride===1,l=this.componentParameters.emissiveSourceOverride===2,u=this.emissionTexture!=null;if(n.emissionSource=this.hasEmissions?this._hasEmissiveBase&&n.pbrMode===1?l?u?4:2:o?u?5:7:6:o?7:6:0,n.shadeNormals=s.shadeNormals,n.normalType=n.hasNormals?1:2,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,n.receiveAmbientOcclusion=n.hasOccludees=n.receiveShadows=n.screenSpaceReflections=n.cloudReflections=n.hasHighlightMixTexture=!1,i.identifier===1)n.output=4,n.vertexDiscardMode=0;else if(i.identifier===3)n.output=7,n.vertexDiscardMode=0;else if(i.identifier===2)n.output=9,n.vertexDiscardMode=0,n.hasHighlightMixTexture=r.highlightMixTexture!=null;else{switch(n.vertexDiscardMode=a===2?i.transparent?2:1:0,n.output=i.output,i.output){case 0:case 1:n.receiveAmbientOcclusion=s.applySSAO&&r.ssao?.getTexture()!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.screenSpaceReflections=r.ssr.lastFrameColor!=null,n.cloudReflections=r.clouds.data?.cubeMap?.colorTexture!=null;break;case 10:n.olidColor=!0}n.snowCover=r.snowCover>0}const d=e.get(bWt,n);return this._setClean(),d}submit(e,i,r){if(this.objectOpacity<=0)return;const{componentData:s,renderable:n}=r,{geometry:a}=n,o=n.meta.cameraDepthSquared;s.updateHighlights(i.highlights);const{geometryRanges:l,highlightRangesMap:u,shadowmapRanges:d}=s;switch(this._computeWhichMaterialPass()){case 0:e.opaque.submitDraw(this,a,l,o);break;case 1:e.transparent.submitDraw(this,a,l,o);break;case 2:e.opaque.submitDraw(this,a,l,o),e.transparent.submitDraw(this,a,l,o);break;case 3:e.integratedMesh.submitDraw(this,a,l,o),$Wt(i)&&e.occludedGround.submitDraw(this,a,l,o),xWt(i)&&e.highlightIntegratedMesh.submitDraw(this,a,l,o);break;case 4:e.transparentIntegratedMesh.submitDraw(this,a,l,o)}if(this.componentParameters.castShadows!==2){if(u!=null)for(const f of u)f[0]===cm&&e.highlightShadowMap.submitDraw(this,a,f[1],o,f[0]);d!=null&&e.defaultShadowMap.submitDraw(this,a,d,o),e.shadowMap.submitDraw(this,a,l,o)}if(u!=null)for(const f of u)e.highlight.submitDraw(this,a,f[1],o,f[0]);i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,a,l,o)}_computeWhichMaterialPass(){if(this.isIntegratedMesh&&this.objectOpacity>=1)return 3;if(this.isIntegratedMesh&&this.objectOpacity<1)return 4;if(this.objectOpacity<1)return 1;if(this.componentParameters.opaqueOverride===0)return 0;if(this.baseColor[3]<1||this.alphaDiscardMode===0||this.alphaDiscardMode===3)return 1;switch(this.componentParameters.transparent){case 2:return 0;case 0:return 1;case 1:return 2}}};c([Ir({vectorOps:eje})],qn.prototype,"baseColor",void 0),c([Ir()],qn.prototype,"usePBR",void 0),c([Ir()],qn.prototype,"hasParametersFromSource",void 0),c([Ir()],qn.prototype,"sphereDepthInterpolate",void 0),c([Ir({vectorOps:j1e})],qn.prototype,"mrrFactors",void 0),c([Ir({dispose:!0})],qn.prototype,"baseColorTexture",void 0),c([Ir({dispose:!0})],qn.prototype,"metallicRoughnessTexture",void 0),c([Ir({dispose:!0})],qn.prototype,"normalTexture",void 0),c([Ir({dispose:!0})],qn.prototype,"occlusionTexture",void 0),c([Ir({dispose:!0})],qn.prototype,"emissionTexture",void 0),c([Ir({vectorOps:j1e})],qn.prototype,"emissiveBaseColor",void 0),c([Ir()],qn.prototype,"emissiveStrength",void 0),c([J3e()],qn.prototype,"commonMaterialParameters",void 0),c([J3e()],qn.prototype,"componentParameters",void 0),c([Ir()],qn.prototype,"objectOpacity",void 0),c([Ir()],qn.prototype,"textureAlphaCutoff",void 0),c([Ir()],qn.prototype,"alphaDiscardMode",void 0),c([Ir()],qn.prototype,"isIntegratedMesh",void 0),c([Ir()],qn.prototype,"polygonOffsetEnabled",void 0),c([Ir()],qn.prototype,"ellipsoidMode",void 0),c([Ir()],qn.prototype,"hasOccludees",void 0);let u8=class extends jfe{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=2,this.hasSlicePlane=!0}};c([Ir()],u8.prototype,"doubleSided",void 0),c([Ir()],u8.prototype,"cullFace",void 0),c([Ir()],u8.prototype,"hasSlicePlane",void 0);let K2=class extends jfe{constructor(){super(...arguments),this.externalColor=$i(1,1,1,1),this.externalColorMixMode=1,this.emissiveStrength=0,this.emissiveSource=0,this.castShadows=0}get transparent(){return this.externalColor[3]<1?0:2}get opaqueOverride(){return this.externalColorMixMode===3&&this.externalColor[3]===1?0:2}get emissiveOverride(){return this.emissiveStrength>0?0:2}get emissiveSourceOverride(){return this.emissiveSource===1?0:2}get visible(){return this.externalColor[3]>0?0:2}get type(){return 0}};c([Ir({vectorOps:eje})],K2.prototype,"externalColor",void 0),c([Ir()],K2.prototype,"externalColorMixMode",void 0),c([Ir()],K2.prototype,"emissiveStrength",void 0),c([Ir()],K2.prototype,"emissiveSource",void 0),c([Ir()],K2.prototype,"castShadows",void 0);let D2=class extends jfe{constructor(){super(...arguments),this.texture=null,this.transparent=2,this.opaqueOverride=2,this.emissiveOverride=2,this.emissiveSourceOverride=2,this.castShadows=2}get type(){return 1}};function xWt(t){return t.overlay?.getTexture(2)!=null}function SWt(t){return t.overlay?.getTexture(3)!=null}function TWt(t){return t.overlay?.getTexture(1)!=null}function $Wt(t){return t.overlay?.getTexture(t.overlay?.allSourcesOccluders?1:4)!=null}c([Ir()],D2.prototype,"texture",void 0),c([Ir()],D2.prototype,"transparent",void 0),c([Ir()],D2.prototype,"opaqueOverride",void 0),c([Ir()],D2.prototype,"emissiveOverride",void 0),c([Ir()],D2.prototype,"emissiveSourceOverride",void 0),c([Ir()],D2.prototype,"castShadows",void 0);let CWt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},MWt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new ar(this.textureWidth,1);r.samplingMode=9728,r.wrapMode=33071,this._texture=new qi(this._rctx,r),this._data=new rd(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,a){const o=e*this._fieldCount+i;this._dirty=!0,this._data.set(o,0,r),this._data.set(o,1,s),this._data.set(o,2,n),this._data.set(o,3,a)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new rd(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const RHe=65536;let EWt=class{constructor(e,i=1){this.textureBuffer=new MWt(e,i),this._indexManager=new CWt(RHe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},AWt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>RHe)return null;const i=new EWt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const h6=()=>re.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let OWt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._activeHighlightOptions=new Map,this._visible=new Ai,this._hidden=new Ai,this._renderSubmit=new oWt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new AWt(e.rctx,EHe())}destroy(){xt(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._componentBufferManager=null,this._visible.forAll(e=>e.destroy()),this._visible.prune(),this._hidden.forAll(e=>e.destroy()),this._hidden.prune(),this._renderSubmit.destroy()}createObject(e){const{geometry:i}=e,r=new bHt(this._componentBufferManager,SH(i.componentOffsets)),s=this._createRenderable(e,r),n=new WHt(this._viewingMode,i.positionData,r,e.elevationAlignable),a=new xHt(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(a.visible?this._visible:this._hidden).push(a),a}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Mn(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.componentData.visibility.reset(i),r.componentData.markVisibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.componentData.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.componentData.visibility.componentCount;return{visible:r,invisible:i.componentData.count-r}}setComponentData(e,i){const r=e,{renderable:s,componentData:n}=r,a=s.material,o=n.materialDataBuffer,l=n.materialDataIndices,u=new lWt,d=o.textureBuffer,f=new Uint8Array(4),g=new Uint32Array(f.buffer);let v=0,_=0,x=0,S=0,T=0,M=n.verticalOffsets,E=1/0,P=-1/0,O=!1,D=!1,L=!1,F=0;for(let j=0;j<n.count;j++){i(j,u),v+=+(u.externalColor[3]<1),_+=+(u.externalColorMixMode===3&&u.externalColor[3]===1),S+=+(u.emissiveStrength>0),T+=+(u.emissiveSource===1),D||=u.emissiveStrength!==1,x+=+u.castShadows,Jzt(u.externalColor,u.externalColorMixMode,f),f[2]=254&f[2]|+u.castShadows,d.setData(l[j],0,f[0],f[1],f[2],f[3]),O||=j>0&&F!==g[0],F=g[0],L||=u.elevationOffset!==0,L&&M==null&&(M=new Array(j).fill(0)),M!=null&&(M[j]=u.elevationOffset),E=Math.min(E,u.elevationOffset),P=Math.max(P,u.elevationOffset),hWt(u.elevationOffset,f),d.setData(l[j],1,f[0],f[1],f[2],f[3]),dWt(u.emissiveStrength,f),d.setData(l[j],2,f[0],f[1],f[2],u.emissiveSource===0?0:255);const N=u.olidColor;N!=null&&d.setData(l[j],3,N[0],N[1],N[2],N[3]),u.pickable!==xHe(n.pickability,j)&&IHt(n,j,u.pickable)}n.verticalOffsets=L?M:null,r.offsetObb=L?O6e(r.obb,E,P,this._viewingMode,r.offsetObb??r.obb.clone()):null,O||L||Ep()||(D||T>0)&&S>0?(a.componentParameters=new D2,a.componentParameters.castShadows=HI(x,n.count),a.componentParameters.transparent=HI(v,n.count),a.componentParameters.opaqueOverride=HI(_,n.count),a.componentParameters.emissiveOverride=HI(S,n.count),a.componentParameters.emissiveSourceOverride=HI(T,n.count),a.componentParameters.texture=d,d.updateTexture()):(a.componentParameters=new K2,a.componentParameters.castShadows=u.castShadows?0:2,a.componentParameters.externalColor=u.externalColor,a.componentParameters.externalColorMixMode=u.externalColorMixMode,a.componentParameters.emissiveStrength=u.emissiveStrength,a.componentParameters.emissiveSource=u.emissiveSource),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,a=n.componentData.verticalOffsets;if(s||a==null)return r;const o=a[i];if(this._viewingMode===2||o===0)return r[2]+=o,r[5]+=o,r;const l=QSe(o);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,a=n.componentData,o=a.count,l=a.verticalOffsets,u=n.intersectionGeometry,d=this._viewingMode===2,f=u.getComponentAabbs(),g=PWt;let v=1/0,_=-1/0;for(let x=0;x<o;x++){const S=6*x,T=l?.[x]??0;let M=1/0,E=-1/0;if(d)M=f[S+2]+T+i,E=f[S+5]+T+i;else{if(g[0]=f[S],g[1]=f[S+1],g[2]=f[S+2],g[3]=f[S+3],g[4]=f[S+4],g[5]=f[S+5],T!==0){const L=QSe(T);L.localOrigin=n.transform.position,L.applyToAabb(g)}const P=Math.max(Math.abs(g[3]),Math.abs(g[0])),O=Math.max(Math.abs(g[4]),Math.abs(g[1])),D=i+g[5]+r;s.expandElevationRangeValues(i+g[2],Math.sqrt(P*P+O*O+D*D)-r)}s.expandElevationRangeValues(M,E),v=Math.min(v,M),_=Math.max(_,E)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=v,this._elevationRangeCacheMax=_}intersect(e,i,r,s,n,a){const o=e,{transform:l,componentData:u,intersectionGeometry:d}=o;return s!=null&&(s.localOrigin=l.position),d.intersect(i,r,s,u.verticalOffsets,l,n,a)}addEdges(e,i,r,s,n){const a=e,{indices:o,positions:l}=a.intersectionGeometry,u=a.componentData.offsets;return i.addComponentObject(a,l,o,u,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.componentData.visibility;if(n.allInvisible()){const{extractComponentsEdgeLocationsLayout:v}=await W(()=>import("./edgeProcessing-CO_rnkxe.js"),__vite__mapDeps([28,29,27]));return{buffer:v.createBuffer(0),origin:[0,0,0]}}const{indices:a,positions:o}=s.intersectionGeometry,l=s.componentData.offsets,{EdgeInputBufferLayout:u}=await W(async()=>{const{EdgeInputBufferLayout:v}=await import("./bufferLayouts-CbMfYAca.js");return{EdgeInputBufferLayout:v}},[]),d=u.createBuffer(o.length/3);Vfe(d.position.typedBuffer,o,d.position.typedBufferStride,3),mHe(d.position,d.position,s.transform.rotationScale),this._setComponentIndices(d.componentIndex,a,l);const f=d.count,g=this._computeVisibilityIndices(a,n,l,f);return{origin:Tr(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:g,indicesLength:g.length,skipDeduplicate:!0,data:d,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const a=r[n],o=r[n+1];for(let l=a;l<o;l++){const u=i?i[l]:l;e.set(u,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,u)=>(n+=r[u]-r[l],!0));const a=lP(e)?e?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n):new Array(n);let o=0;return i.forEachComponentRange((l,u)=>{const d=r[l],f=r[u];for(let g=d;g<f;g++)a[o++]=e?e[g]:g;return!0}),a}addComponentHighlight(e,i,r){const s=e.componentData,n=Fu(s.componentHighlights,r,()=>new Uint32Array(s.count+1));{const a=this._activeHighlightOptions.get(r)??0;this._activeHighlightOptions.set(r,a+1)}n[i]++===0&&(s.markHighlightsDirty(),this._notifyDirty()),n[s.count]++}removeComponentHighlight(e,i,r){const{componentData:s}=e,n=s.componentHighlights.get(r);if(n===void 0)return void h6().warn("Removing non-existing highlight.");const a=n[i];if(a===0)return void h6().warn("Removing non-existing highlight.");this._removeActiveHighlight(r);const o=n[s.count];if(a>1)return n[i]=a-1,void(n[s.count]=o-1);n[i]=0,o===1?s.componentHighlights.delete(r):n[s.count]=o-1,s.markHighlightsDirty(),this._notifyDirty()}_removeActiveHighlight(e,i=1){const r=this._activeHighlightOptions.get(e);if(r===void 0)h6().warn("Removing non-existing highlight.");else{const s=r-i;s<0&&h6().warn("Removing non-existing highlight."),s<=0?this._activeHighlightOptions.delete(e):this._activeHighlightOptions.set(e,s)}}clearHighlights(e){const{componentData:i}=e,{componentHighlights:r}=i;if(r.size>0){for(const s of r)this._removeActiveHighlight(s[0],s[1][i.count]);r.clear(),i.markHighlightsDirty(),this._notifyDirty()}}hasHighlight(e){return this._activeHighlightOptions.has(e)}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,a=bl($He(n)),o=new vn(r,a,s.vertices.data),l=s.indices?id.createIndex(r,35044,s.indices):null,u=new Uint16Array(s.vertices.count);for(let x=0;x<i.count;x++){const S=i.offsets[x],T=i.offsets[x+1],M=i.materialDataIndices[x];if(s.indices!=null)for(let E=S;E<T;E++)u[s.indices[E]]=M;else for(let E=S;E<T;E++)u[E]=M}const d=new vn(r,OHe,u.buffer),f=new qn(e.transform,e.toMapSpace),g=new bm(r,new Map([["geometry",o],["componentIndices",d]]),l),v=new eWt(g,Sr.TRIANGLES,n,l!=null),_={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+d.usedMemory+(l!=null?l.usedMemory:0)};return new KHt(f,v,_)}_notifyDirty(){this._renderManager.notifyDirty()}};function HI(t,e){return t===e?0:t===0?2:1}const PWt=nc();let RWt=class{constructor(e,i,r,s,n){this.rctx=e,this.viewingMode=i,this.stippleTextures=r,this.waterTextures=s,this.markerTextures=n}get spherical(){return this.viewingMode===1}},IWt=class{constructor(e){this._context=e,this._debug=!1,this._precompiling=this._debug?0:1,this._cache=new Kg}get context(){return this._context}get precompiling(){return this._precompiling}set precompiling(e){this._precompiling=e,e===0&&this.context.rctx.gl.flush()}get viewingMode(){return this.context.viewingMode}destroy(){this._cache.forAll(e=>e.destroy()),this._cache.clear(),this._context=null}precompile(e,i=X3e){++this.precompiling,this.get(e,i),--this.precompiling}get(e,i=X3e){const r=i.key.code;let s=this._cache.get(e,r);if(s==null){if(this._precompiling===0){let n=`Uncached shader compile in ${new Error().stack}
  for configuration
${i.decode()}`;const a=this._cache.getInner(e);throw a?.size&&(n+=`

  cached configurations:
`,n+=Array.from(a.values()).map(o=>i.decode(o.key)).sort().join(`

`)),console.log(n),new q("shader:uncached-compile",n)}s=new e(this.context,i),this._cache.set(e,r,s)}return s}async reloadAll(){const e=new Array;this._cache.forEach(i=>e.push(DWt(i))),await Promise.all(e)}};async function DWt(t){let e=!0;t.forEach(async i=>{await i.reload(e),e=!1})}const X3e=new Tl;let Gk=class extends Nc{constructor(e){super(e),this.consumes={required:["olid"]},this.produces="olid"}destroy(){}render(e){const i=e.find(({name:s})=>s==="olid"),r=this.renderingContext;return r.bindFramebuffer(i.fbo),r.clearFramebuffer(Tn,!0,!0),this.view.stage.renderer.renderAllGeometry(10),r.clear(1280),this.view.stage.renderer.renderHUD(1),i}};c([p()],Gk.prototype,"consumes",void 0),c([p()],Gk.prototype,"produces",void 0),Gk=c([R("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],Gk);let Hk=class extends Nc{constructor(e){super(e),this.consumes={required:[wt.OCCLUDED]},this.produces=wt.OCCLUDED,this._blit=new Ffe(e.view.stage.renderView.techniques,2)}precompile(){const e=this.view.stage.renderer;e.plugins.plugins.forEach(i=>{e.precompileSlots(i,9,11),i.material&&e.precompileOccludedSlots(i,Soe)})}render(e){const i=e.find(({name:r})=>r===this.produces);return this._renderOccludedAndTransparentStencil(i),this._renderOccludedComposite(i),i}_renderOccludedAndTransparentStencil(e){const i=this.view.stage.renderer,r=xoe;r.clear();for(const s of i.plugins.plugins)8&s.renderOccludedFlags&&r.push(s);r.length!==0&&(i.renderSlots(r,10),this._renderAndComposite(e,e.getAttachment(To),.5,()=>i.renderSlots(r,11),!1,!1),r.clear())}_renderOccludedComposite(e){const i=this.view.stage.renderer,r=xoe;r.clear();let s=0;for(const o of i.plugins.plugins){const l=o.renderOccludedFlags&LWt;s|=l,l&&r.push(o)}if(!s)return void r.clear();const n=this._getDepthStencilAttachment(e);let a=n.clearStencil;for(const o of Soe)s&o&&(this._renderAndComposite(e,n.depth,o===16?1:.5,()=>i.renderOccludedSlots(r,o),!0,a),a=!1);n.release(),r.clear()}_renderAndComposite(e,i,r,s,n,a){const o=this.renderingContext,{width:l,height:u}=e.fbo,d=this.fboCache.acquire(l,u,"tmp color");d.attachDepth(i),o.bindFramebuffer(d.fbo),o.clearFramebuffer(Tn,n,a),s(),d.detachDepth(),this._blit.blend(o,d,e,this.bindParameters,r),d.release()}_getDepthStencilAttachment(e){const{width:i,height:r}=e.fbo;if(!this.view.stage.renderer.occludedRequiresIntegratedMeshStencil){const n=this.fboCache.acquireDepth(13,i,r,"retained stencil");return{depth:n,release:()=>n.release(),clearStencil:!0}}const s=this.fboCache.acquire(i,r,"retained stencil",13);return this.renderingContext.blitFramebuffer(e.fbo,s.fbo,1024),{depth:s.getAttachment(To),release:()=>s.release(),clearStencil:!1}}};c([p()],Hk.prototype,"consumes",void 0),c([p()],Hk.prototype,"produces",void 0),Hk=c([R("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],Hk);const xoe=new Ai;function kWt(){xoe.prune()}const Soe=[4,2,16],LWt=Soe.reduce((t,e)=>t|e,0);function IHe(){return new Float32Array(4)}function FWt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function UP(t,e,i,r){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function DHe(){return IHe()}function kHe(){return UP(1,1,1,1)}function LHe(){return UP(1,0,0,0)}function FHe(){return UP(0,1,0,0)}function zHe(){return UP(0,0,1,0)}function NHe(){return UP(0,0,0,1)}const oW=DHe(),zWt=kHe(),NWt=LHe(),VWt=FHe(),jWt=zHe(),UWt=NHe();Object.freeze(Object.defineProperty({__proto__:null,ONES:zWt,UNIT_W:UWt,UNIT_X:NWt,UNIT_Y:VWt,UNIT_Z:jWt,ZEROS:oW,clone:FWt,create:IHe,fromValues:UP,ones:kHe,unitW:NHe,unitX:LHe,unitY:FHe,unitZ:zHe,zeros:DHe},Symbol.toStringTag,{value:"Module"}));const h8={sunny:.0022,rainy:.0022,cloudy:.0022,snowy:.0022,foggy:.0022};let K3e=class{constructor(e){this.presets=e,this.presets=VHe(e)}};const r9={minDisperse:new K3e([.8,.12,.06,.02,0,0]),maxDisperse:new K3e([0,0,.06,.12,.25,.57])};function VHe(t,e=1){const i=t[0]+t[1]+t[2]+t[3]+t[4]+t[5];return i<=e?t:[t[0]/i,t[1]/i,t[2]/i,t[3]/i,t[4]/i,t[5]/i]}let Ufe=class extends $r{constructor(){super(...arguments),this.blurRadius=h8.sunny}};function jHe(t){const e=new Gi,i=e.fragment;e.include(no),i.include(G1),i.uniforms.add(new Gt("colorTexture",l=>l.emissionsToDownsample),new _t("blurRadius",l=>l.blurRadius));let r="";const s=15;for(let l=0;l<s;l++)r+=`locations1D[${l}] = ${(l/(s-1)*2-1).toFixed(3).toString()};`;const n=2;let a="";for(let l=0;l<s;l++)a+=`locations1DWeights[${l}] = ${Kit(l-Math.floor(s/2),n).toFixed(7).toString()};`;const o=t.glowStage===0;return i.code.add(A`
    float locations1D[${A.int(s)}];
    float locations1DWeights[${A.int(s)}];

    vec3 blurUniformSamples(sampler2D toBlur) {
      vec3 res = vec3(0.0);
      vec2 size = vec2(textureSize(toBlur, 0));
      vec2 aspectCorrection = vec2(1.0, size.x / size.y);
      vec2 uvInPixel = uv * size;

      ${r}
      ${a}
      vec2 pixelCenterShift = 0.5 / size;

      for(int i=0;i < ${A.int(s)}; i++) {
        float uv1D = locations1D[i] + ${o?"pixelCenterShift.x":"pixelCenterShift.y"};
        vec2 uvOffset = ${o?"vec2(uv1D, 0.0)":"vec2(0.0, uv1D)"};

        vec2 uvDistorted = uv + uvOffset * blurRadius * aspectCorrection;
        vec3 sampleColor = texture(toBlur, uvDistorted).rgb;
        res += sampleColor * locations1DWeights[i];
      }
      return res;
    }
  `).main.add(A`fragColor = vec4(blurUniformSamples(colorTexture), 0.0);`),e}const BWt=Object.freeze(Object.defineProperty({__proto__:null,GlowBlurPassParameters:Ufe,build:jHe},Symbol.toStringTag,{value:"Module"}));let d6=class extends er{constructor(e,i){super(e,i,new Hi(BWt,()=>W(()=>Promise.resolve().then(()=>Dri),void 0)),wn)}initializePipeline(){return _i({colorWrite:Fi})}},Toe=class extends Tl{constructor(){super(...arguments),this.glowStage=0}};c([ue({count:2})],Toe.prototype,"glowStage",void 0);let Bfe=class extends oHe{constructor(){super(...arguments),this.lodFactors=[0,0,0,0,0,0],this.glowLod=-1,this.dispersionWeight=1,this.distanceModifier=1e-4}};function UHe(t){const e=new Gi,i=e.fragment,{blurEnabled:r,tonemappingEnabled:s}=t;return e.include(sz,{needUVs:!0,needEyeDirection:!0}),i.include(G1),i.include(lHe),i.include(Ip),e.outputs.add("fragColor","vec4",0),e.outputs.add("fragEmission","vec3",1),i.include(NP),i.uniforms.add(new Gt("colorTexture",n=>n.color),new Gt("emissionTexture",n=>n.emission)),r?(i.uniforms.add(new Jo("depthTexture",n=>n.mainDepth),new _t("distanceModifier",n=>n.distanceModifier),new Gt("lodTexture0",n=>n.lodTexture0),new Gt("lodTexture1",n=>n.lodTexture1),new Gt("lodTexture2",n=>n.lodTexture2),new Gt("lodTexture3",n=>n.lodTexture3),new Gt("lodTexture4",n=>n.lodTexture4),new q1("glowLod",n=>n.glowLod),new Lu("minDisperse",()=>r9.minDisperse.presets,6),new Lu("maxDisperse",()=>r9.maxDisperse.presets,6),new _t("dispersionWeight",n=>n.dispersionWeight)).main.add(A`
    vec4 color = texture(colorTexture, uv);
    color = vec4(linearizeGamma(color.rgb), color.a);

    vec3 lod0 = texture(emissionTexture, uv).rgb;
    vec3 lod1 = texture(lodTexture0, uv).rgb;
    vec3 lod2 = texture(lodTexture1, uv).rgb;
    vec3 lod3 = texture(lodTexture2, uv).rgb;
    vec3 lod4 = texture(lodTexture3, uv).rgb;
    vec3 lod5 = texture(lodTexture4, uv).rgb;

    float terrainDepth = -1.0;
    float depthSample = depthFromTexture(depthTexture, uv);
    if(depthSample < 1.0 && depthSample > 0.0){
      vec3 cameraSpaceRay = normalize(eyeDir);
      cameraSpaceRay /= cameraSpaceRay.z;
      cameraSpaceRay *= linearizeDepth(depthSample);
      terrainDepth = max(0.0, length(cameraSpaceRay));
    }
    vec3 rayDir = normalize(worldRay);
    float dispersionByDistance = getDistanceFalloff(terrainDepth, rayDir, distanceModifier);
    float dispersionPerPixel = dispersionWeight * dispersionByDistance;

    float lodFactor0 = mix(minDisperse[0], maxDisperse[0], dispersionPerPixel);
    float lodFactor1 = mix(minDisperse[1], maxDisperse[1], dispersionPerPixel);
    float lodFactor2 = mix(minDisperse[2], maxDisperse[2], dispersionPerPixel);
    float lodFactor3 = mix(minDisperse[3], maxDisperse[3], dispersionPerPixel);
    float lodFactor4 = mix(minDisperse[4], maxDisperse[4], dispersionPerPixel);
    float lodFactor5 = mix(minDisperse[5], maxDisperse[5], dispersionPerPixel);

    vec3 emission = lodFactor0 * lod0;
    emission += lodFactor1 * lod1;
    emission += lodFactor2 * lod2;
    emission += lodFactor3 * lod3;
    emission += lodFactor4 * lod4;
    emission += lodFactor5 * lod5;

    // only for glow editor lod debugging
    emission = glowLod == 0 ? lodFactor0 * lod0 : glowLod == 1 ? lodFactor1 * lod1 : glowLod == 2 ? lodFactor2 * lod2 : glowLod == 3 ? lodFactor3 * lod3 : glowLod == 4 ? lodFactor4 * lod4 : glowLod == 5 ? lodFactor5 * lod5 : emission;

    fragEmission = emission;
    // tonemapping is only applied to the emissive part since main color values are not in HDR.
    ${we(s,"emission = tonemapACES(emission);")}

    fragColor = delinearizeGamma(vec4(color.rgb + emission.rgb, color.w));
  `),e):(i.main.add(A`
      vec4 color = texture(colorTexture, uv);
      color = vec4(linearizeGamma(color.rgb), color.a);

      // emission is already in linear color space here.
      vec3 emission = texture(emissionTexture, uv).rgb;

      ${we(s,"emission = tonemapACES(emission);")}
      fragColor = delinearizeGamma(vec4(color.rgb + emission, color.w));
    `),e)}const qWt=Object.freeze(Object.defineProperty({__proto__:null,GlowCompositionPassParameters:Bfe,build:UHe},Symbol.toStringTag,{value:"Module"}));let p6=class extends er{constructor(e,i){super(e,i,new Hi(qWt,()=>W(()=>Promise.resolve().then(()=>kri),void 0)),wn)}initializePipeline(e){return _i({colorWrite:Fi,drawBuffers:{buffers:e.blurEnabled?[Hr,vl]:[Hr]}})}},$oe=class extends Tl{constructor(){super(...arguments),this.blurEnabled=!1,this.tonemappingEnabled=!0}};c([ue()],$oe.prototype,"blurEnabled",void 0),c([ue()],$oe.prototype,"tonemappingEnabled",void 0);let bS=class extends NS{constructor(e){super(e),this.consumes={required:[wt.TRANSPARENT_ENVIRONMENT,"emissive"]},this.produces=wt.TRANSPARENT_ENVIRONMENT,this._blurHorizontalConfiguration=new Toe,this._blurVerticalConfiguration=new Toe,this._compositionConfiguration=new $oe,this._compositionParameters=new Bfe,this._blurParameters=new Ufe,this._blurScale=3.06,this._glowEnabled=!1,this._glowResults=new Array;const i=xr(e.view.spatialReference);this._atmosphereRadius=i.radius+i.atmosphereHeight,e.view.stage.renderView.techniques.precompile(p6,this._compositionConfiguration)}initialize(){this.addHandles([X(()=>this._updateFogParameters(),()=>{},bt),X(()=>this.view.qualitySettings.glow,e=>{this._glowEnabled=e,this.precompile(),this.requestRender(1)},bt)])}_updateFogParameters(){const e=this.view.environment.weather;if(e.type==="sunny"||e.type==="cloudy")this._blurParameters.blurRadius=h8[e.type],this._compositionParameters.distanceModifier=0;else{const i=e.type==="foggy"?e.fogStrength:e.precipitation;this._blurParameters.blurRadius=yt(h8.cloudy,h8[e.type],i),this._compositionParameters.distanceModifier=e.type==="foggy"?yt(3e-5,.005,e.fogStrength**3):yt(4e-6,2e-4,(e.precipitation??0)**3)}this._computeLodFactors(),this.requestRender(1)}_computeLodFactors(e=r9.minDisperse.presets,i=r9.maxDisperse.presets){e.forEach((r,s)=>{this._compositionParameters.lodFactors[s]=yt(r,i[s],this._compositionParameters.dispersionWeight)})}precompile(){this._glowEnabled&&(this.techniques.precompile(d6,this._blurHorizontalConfiguration),this._blurVerticalConfiguration.glowStage=1,this.techniques.precompile(d6,this._blurVerticalConfiguration)),this._compositionConfiguration.blurEnabled=this._glowEnabled,this.techniques.precompile(p6,this._compositionConfiguration)}render(e){const i=e.find(({name:O})=>O===wt.TRANSPARENT_ENVIRONMENT),r=i.getAttachment(vl);if(!r?.attachment)return i;const s=i.getAttachment(To);if(!this._glowEnabled){const O=this.techniques.get(p6,this._compositionConfiguration);if(!O.compiled)return this.requestRender(1),i;const D=i.getTexture(),L=this.fboCache,{fullWidth:F,fullHeight:j}=this.bindParameters.camera,N=this.renderingContext,B=L.acquire(D.descriptor.width,D.descriptor.height,this.produces);return this._prepareFBO(B,F,j),this._compositionParameters.color=D,this._compositionParameters.emission=r.attachment,N.bindTechnique(O,this.bindParameters,this._compositionParameters),N.screen.draw(),B.attachDepth(s),B.attachColor(r,vl),B}const n=this.techniques.get(d6,this._blurHorizontalConfiguration),a=this.techniques.get(d6,this._blurVerticalConfiguration),o=this.techniques.get(p6,this._compositionConfiguration);if(!n.compiled||!a.compiled||!o.compiled)return this.requestRender(1),i;const l=i.getTexture(),u=this.fboCache,{fullWidth:d,fullHeight:f}=this.bindParameters.camera,g=this.renderingContext;let v=r.attachment,_=Math.ceil(d/2),x=Math.ceil(f/2);const S=5,T=this._blurParameters.blurRadius;for(let O=0;O<S;O++){const D=u.acquire(_,x,"glow horizontal",8);this._blurParameters.emissionsToDownsample=v,this._prepareFBO(D,_,x),g.bindTechnique(n,this.bindParameters,this._blurParameters),g.screen.draw();const L=u.acquire(_,x,"glow vertical",8);this._blurParameters.emissionsToDownsample=D.getTexture(),this._prepareFBO(L,_,x),g.bindTechnique(a,this.bindParameters,this._blurParameters),g.screen.draw(),D.release(),this._glowResults[O]=L,_=Math.ceil(_/2),x=Math.ceil(x/2),v=this._glowResults[O].getTexture(),this._blurParameters.blurRadius*=this._blurScale}this._blurParameters.blurRadius=T;const M=this.bindParameters.camera,E=Ve(M.eye);this._compositionParameters.atmosphereC=E**2-this._atmosphereRadius**2,this._compositionParameters.color=l,this._compositionParameters.emission=r.attachment,this._compositionParameters.lodTexture0=this._glowResults[0].getTexture(),this._compositionParameters.lodTexture1=this._glowResults[1].getTexture(),this._compositionParameters.lodTexture2=this._glowResults[2].getTexture(),this._compositionParameters.lodTexture3=this._glowResults[3].getTexture(),this._compositionParameters.lodTexture4=this._glowResults[4].getTexture();const P=u.acquire(l.descriptor.width,l.descriptor.height,this.produces);return P.acquireColor(vl,8,"emissive glow"),this._prepareFBO(P,d,f,!0),g.bindTechnique(o,this.bindParameters,this._compositionParameters),g.screen.draw(),this._glowResults.forEach(O=>O.release()),P.attachDepth(s),P}_prepareFBO(e,i,r,s=!1){const n=this.renderingContext;n.bindFramebuffer(e.fbo),n.setViewport(0,0,i,r),n.setClearColor(0,0,0,0),n.clear(16384),s&&n.clearBuffer(1,oW)}get test(){return{compositionParameters:this._compositionParameters,blurParameters:this._blurParameters,setBlurLodCombination:e=>{this._compositionParameters.dispersionWeight=e,this._computeLodFactors()},setLodFactors:e=>{this._computeLodFactors(VHe(e))},toggleTonemapping:e=>{this._compositionConfiguration.tonemappingEnabled=e,this.requestRender(1)}}}};c([p()],bS.prototype,"consumes",void 0),c([p()],bS.prototype,"produces",void 0),bS=c([R("esri.views.3d.webgl-engine.effects.glow.GlowRenderNode")],bS);let qfe=class extends $r{};function BHe(){const t=new Gi;return t.include(no),t.fragment.uniforms.add(new Gt("colorTexture",e=>e.color),new Jo("depthTexture",e=>e.mainDepth)),t.fragment.main.add(A`float depthSample = texture(depthTexture, uv).r;
if (depthSample == 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`),t}const GWt=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:qfe,build:BHe},Symbol.toStringTag,{value:"Module"}));let eEe=class extends er{constructor(e,i){super(e,i,new Hi(GWt,()=>W(()=>Promise.resolve().then(()=>Lri),void 0)),wn)}initializePipeline(){return _i({blending:o_(1,0,769,1),depthTest:{func:519},colorWrite:Fi})}};function qHe(t){const e=new Gi,{fragment:i}=e;e.include(sz),dm(i),i.include(G1),i.include(Ip),i.include(LF),i.include(NP),i.include(iHe,!0),i.uniforms.add(new Jo("depthTexture",s=>s.mainDepth),new _t("hazeStrength",s=>s.hazeStrength));const{reduced:r}=t;return r&&i.code.add(A`float getDepth(vec2 uv){
return linearDepthFromTexture(depthTexture, uv);
}
float textureBilinear(vec2 uv) {
vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
vec2 texelSize = 1.0 / depthTextureSize;
vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);
vec2 f = fract(depthUV);
vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;
float d0 = getDepth(snapUV);
float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
float d3 = getDepth(snapUV + texelSize);
return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
}`),i.main.add(A`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture(depthTexture, uv).r;
      if (depthSample != 1.0) {
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;

        cameraSpaceRay *= ${we(r,"-textureBilinear(uv)","-linearDepthFromTexture(depthTexture, uv)")};
        terrainDepth = max(0.0, length(cameraSpaceRay));
      } else {
        discard;
      }

      // Alpha is ignored for haze blending
      vec3 col = vec3(0);
      float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
      if(depthSample != 1.0){
        col = (1.0 - fadeOut) * hazeStrength * raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      }
      float alpha = 1.0;

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
  `),e}const HWt=Object.freeze(Object.defineProperty({__proto__:null,build:qHe},Symbol.toStringTag,{value:"Module"}));let WWt=class extends tHe{constructor(){super(...arguments),this.hazeStrength=1}},VK=class extends er{constructor(e,i){super(e,i,new Hi(HWt,()=>W(()=>Promise.resolve().then(()=>Fri),void 0)),Rp(zF))}initializePipeline(e){return e.reduced?_i({blending:Ode,depthTest:{func:519},colorWrite:Fi}):_i({blending:o_(1,0,769,1),colorWrite:Fi})}},d8=class extends Tl{constructor(){super(...arguments),this.reduced=!1}};c([ue()],d8.prototype,"reduced",void 0);let Coe=class extends NS{constructor(e){super(e),this._compositingPassParameters=new qfe,this._passParameters=new WWt,this._hazeConfiguration=new d8,this.requireGeometryDepth=!0,this._oldAmount=1,this._newAmount=1,this._amount=this._newAmount;const i=e.view.stage.renderView.techniques;i.precompile(VK,new d8);const r=new d8;r.reduced=!0,i.precompile(VK,r),i.precompile(eEe)}initialize(){this.addHandles([X(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),bt),X(()=>this.view.stage?.renderer.renderContext.bind.clouds.fadeFactor??1,e=>this._fade(e),bt),X(()=>this.view.environment.weather.type,e=>this._newAmount=e==="rainy"?0:1,bt),X(()=>this.view.stage.renderer?.fullResolutionAtmosphere,e=>this._hazeConfiguration.reduced=!e,bt)])}_fade(e){e>=1?(this._amount=this._newAmount,this._oldAmount=this._newAmount):this._amount=e<=0?this._oldAmount:yt(this._oldAmount,this._newAmount,e)}destroy(){this._vao=jt(this._vao)}render(e){const i=e.find(({name:S})=>S===wt.TRANSPARENT_ENVIRONMENT);if(!this.bindParameters.mainDepth)return i;const r=this.renderingContext,s=this.techniques.get(VK,this._hazeConfiguration);if(!s.compiled)return i;const n=i.getAttachment(To);if(this._update(),!this._hazeConfiguration.reduced)return i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(s,this.bindParameters,this._passParameters),this._renderCommon(r),i.attachDepth(n),i;const a=this.techniques.get(eEe);if(!a.compiled)return i;const o=r.getViewport(),l=this.camera,u=Ve(l.eye)-Ci.radius;let d;const f=Ci.atmosphereHeight;if(u<f){const S=Math.min(1,Math.max(0,u/f));d=yt(.4,.5,S)}else{const S=Math.min(1,Math.max(0,(u-f)/(15*f)));d=yt(.5,1,S)}const g=this.renderingContext.parameters.maxTextureSize,v=T1(Math.round(d*l.fullViewport[2]),g),_=T1(Math.round(d*l.fullViewport[3]),g);r.setViewport(0,0,v,_);const x=this.fboCache.acquire(v,_,"haze",5);return r.bindFramebuffer(x.fbo),r.clearFramebuffer([0,0,0,1],!0,!0),r.bindTechnique(s,this.bindParameters,this._passParameters),this._renderCommon(r),r.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=x.getTexture(),i.detachDepth(),r.bindFramebuffer(i.fbo),r.bindTechnique(a,this.bindParameters,this._compositingPassParameters),r.screen.draw(),i.attachDepth(n),x.release(),i}_renderCommon(e){this._vao??=H1(e,1),e.bindVAO(this._vao),e.drawArrays(Sr.TRIANGLE_STRIP,0,4)}_update(){const e=this.bindParameters.camera,i=ea(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=Ce((r-this._passParameters.radii[0])/Ci.atmosphereHeight,0,1);Or(this._passParameters.heightParameters,r,i,s,n);const a=this.view.basemapTerrain?.getLowerBoundRadius()??0;oi(this._passParameters.radii,a,a+Ci.atmosphereHeight),this._passParameters.hazeStrength=yt(yt(.6,1,lO(9500,10500,r-Ci.radius)),1,this._amount)}};Coe=c([R("esri.views.3d.webgl-engine.effects.haze.Haze")],Coe);function ZWt(t){const e=t.fragment;t.include(BH),e.include(Ip),e.code.add(A`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}function GHe(t){t.include(Hqe),YWt(t)}function YWt(t){t.fragment.include(Ip),t.include(BH),t.fragment.uniforms.add(new _l("inverseViewMatrix",({camera:e})=>Kl(tEe,$p(tEe,e.viewMatrix,e.center)))).code.add(A`vec3 calculateUVZShadowAndPixelPosFromDepth(
in vec2 _uv,
ivec2 shadowMapSize,
in sampler2D _depthMap,
out vec4 currentPixelPos
) {
float depth = depthFromTexture(_depthMap, _uv);
if (depth >= 1.0 || depth <= 0.0) {
return invalidShadowmapUVZ;
}
float currentPixelDepth = linearizeDepth(depth);
currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
float linearDepth = -currentPixelDepth;
return calculateUVZShadow(worldSpacePos.xyz, linearDepth, shadowMapSize);
}
vec3 calculateUVZShadowFromDepth(
in vec2 _uv,
ivec2 shadowMapSize,
in sampler2D _depthMap
) {
vec4 currentPixelPos;
return calculateUVZShadowAndPixelPosFromDepth(_uv, shadowMapSize, _depthMap, currentPixelPos);
}`)}const tEe=ut(),JWt=.025;function HHe(){const t=new Gi;t.include(GHe),t.include(Ope),t.include(no),t.include(ZWt);const e=t.fragment;return e.uniforms.add(new qG("shadowMapExcludingHighlight",i=>i.shadowMap.getSnapshot(1)),new qG("shadowMapHighlight",i=>i.shadowMap.getSnapshot(0)),new Jo("depthMap",i=>i.depth?.attachment),new VP("highlightTexture",i=>i.highlightTexture),new Ca("uColor",i=>i.shadowColor),new _t("opacity",i=>i.shadowOpacity),new _t("occludedOpacity",i=>i.occludedShadowOpacity),new _t("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Zo("lightingMainDirectionView",({lighting:i,camera:r})=>Re(iEe,Ft(iEe,i.mainLight.direction,r.viewInverseTransposeMatrix)))),e.main.add(A`
    ivec2 highlightTextureSize = textureSize(highlightTexture, 0);
    ivec2 highlightIUV = ivec2(uv * vec2(highlightTextureSize));
    uvec2 highlightInfo = texelFetch(highlightTexture, highlightIUV, 0).rg;

    fragColor = vec4(0.0);

    // Calculate bit mask to check if pixel is highlit unoccluded at any level
    uint ored = (highlightInfo.r << 0) | (highlightInfo.g << 8);

    bool visiblyHighlighted = ((ored & ~(ored >> 1)) & (1u+4u+16u+64u)) != 0u;
    if (visiblyHighlighted) {
      return;
    }

    vec4 currentPixelPos;
    vec3 uvzShadow = calculateUVZShadowAndPixelPosFromDepth(uv, textureSize(shadowMapHighlight,0), depthMap, currentPixelPos);
    if (uvzShadow.z < 0.0) {
      return;
    }

    float shadowHighlightFactor = readShadowMapUVZ(uvzShadow, shadowMapHighlight);
    if (shadowHighlightFactor == 0.0) {
      return;
    }

    float shadowExcludingHighlightFactor = readShadowMapUVZ(uvzShadow, shadowMapExcludingHighlight);

    vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
    bool shaded = dot(normal, lightingMainDirectionView) < ${A.float(JWt)};

    float occludedFactor = max(shadowExcludingHighlightFactor, shaded ? 1.0 : 0.0);
    float fragOpacity = mix(opacity, occludedOpacity, occludedFactor);
    fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
  `),t}const iEe=I(),QWt=Object.freeze(Object.defineProperty({__proto__:null,build:HHe},Symbol.toStringTag,{value:"Module"}));let XWt=class extends Ppe{constructor(){super(...arguments),this.shadowColor=$i(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},rEe=class extends er{constructor(e,i){super(e,i,new Hi(QWt,()=>W(()=>Promise.resolve().then(()=>zri),void 0)),wn),this.primitiveType=Sr.TRIANGLE_STRIP}initializePipeline(){return _i({blending:Xg,colorWrite:Fi,depthTest:null,depthWrite:null})}};const KWt=1/512,eZt=4e4,tZt=5e4;let B3=class extends Nc{constructor(e){super(e),this.produces=ps.COMPOSITE,this.consumes={required:[ps.COMPOSITE,"highlights"]},this._passParameters=new XWt,this._maxOpacity=1,this._shadowDifference=.2}initialize(){this.addHandles([X(()=>LU(this.view)?.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??sFe,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},bt),X(()=>LU(this.view)?.shadowDifference,e=>{this._shadowDifference=e??nFe,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},bt),X(()=>LU(this.view)?.shadowColor,e=>{this._passParameters.shadowColor=Dfe(e??rFe),this._ensureMaxOpacity()},bt)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3],this.requestRender(1)}precompile(){this.techniques.precompile(rEe)}render(e){const i=e.find(({name:a})=>a===ps.COMPOSITE),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;const s=this.techniques.get(rEe);if(!s.compiled)return this.requestRender(1),i;this._passParameters.highlightTexture=e.find(({name:a})=>a==="highlights")?.getTexture(),this._passParameters.origin=r.camera.center;const n=this.renderingContext;return n.bindFramebuffer(i.fbo),n.bindTechnique(s,r,this._passParameters),n.screen.draw(),i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-lO(eZt,tZt,e.relativeElevation);const r=this.viewingMode===1?Re(sEe,e.center):xe(sEe,0,0,1),s=Le(r,i);return this._passParameters.dayNightTerminator=lO(0,1,Ce(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=KWt}};c([p()],B3.prototype,"produces",void 0),c([p()],B3.prototype,"consumes",void 0),c([p({constructOnly:!0})],B3.prototype,"viewingMode",void 0),B3=c([R("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],B3);const sEe=I();let Gfe=class extends $r{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function WHe(){const t=new Gi;return t.attributes.add("position","vec2"),t.vertex.uniforms.add(new Ca("drawPosition",(e,i)=>iZt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.main.add(A`vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);`),t.fragment.uniforms.add(new Gt("textureInput",e=>e.input)),t.fragment.uniforms.add(new Gt("textureMask",e=>e.mask)),t.fragment.uniforms.add(new Gt("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new GO("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new GO("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(A`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}`),t.fragment.main.add(A`float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;`),t}function iZt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;Ff(t.magnifier.position,nEe);const n=e.camera.screenToRender(nEe,rZt),a=Math.ceil(i*t.magnifier.size),{fullWidth:o,fullHeight:l}=e.camera;return Or(sZt,(n[0]+r)/o*2-1,(n[1]-s)/l*2-1,a/o*2,a/l*2)}const nEe=yn(),rZt=T7(),sZt=li(),nZt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:Gfe,build:WHe},Symbol.toStringTag,{value:"Module"}));let aEe=class extends er{constructor(e,i){super(e,i,new Hi(nZt,()=>W(()=>Promise.resolve().then(()=>Nri),void 0)),wn)}initializePipeline(){return _i({blending:j1,depthTest:null,depthWrite:null,colorWrite:Fi})}};async function aZt(t){const e=W(()=>import("./mask-svg-BZIDpTf0.js"),[]),i=W(()=>import("./overlay-svg-DKwEt0oU.js"),[]),r=J0((await e).default,{signal:t}),s=J0((await i).default,{signal:t}),n={mask:await r,overlay:await s};return ct(t),n}let k2=class extends Nc{constructor(){super(...arguments),this.produces=wt.MAGNIFIER,this.consumes={required:[wt.MAGNIFIER]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new Gfe,this._magnifier=null,this._tmpScreenPoint=yn(),this._tmpRenderPoint=T7()}initialize(){this.addHandles([X(()=>this.view.magnifier,e=>this._update(e),bt)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces=wt.MAGNIFIER):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(X(()=>this._magnifier?.version,i)),i()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=jt(this._vao)}_disposeTextures(){this._passParameters.mask=jt(this._passParameters.mask),this._passParameters.overlay=jt(this._passParameters.overlay),this._passParameters.input=jt(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(aEe)}render(e){const i=this._validMagnifier,r=e.find(({name:T})=>T===wt.MAGNIFIER);if(i==null)return r;if(this._imageSources==null)return this.requestRender(1),r;const s=this.renderingContext,n=this.camera.pixelRatio,a=Math.ceil(n*i.size);this._vao??=H1(s,0,0,1);const o=this.techniques.get(aEe);if(this._ensureTextureResources(s,a),!o.compiled||!this._passParameters.input)return this.requestRender(1),r;const l=Math.ceil(1/this._factor*a),u=this._passParameters.input;u.resize(l,l),Ff(i.position,this._tmpScreenPoint);const d=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),f=this.camera.fullWidth,g=this.camera.fullHeight,v=.5*l,_=.5*l;d[0]=Ce(d[0],v,f-v-1),d[1]=Ce(d[1],_,g-_-1);const x=Math.floor(d[0]-v),S=Math.floor(d[1]-_);return s.bindFramebuffer(r.fbo),o.program.bindTexture("textureInput",u),s.gl.copyTexImage2D(u.descriptor.target,0,u.descriptor.pixelFormat,x,S,l,l,0),this._passParameters.magnifier=i,s.bindTechnique(o,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(Sr.TRIANGLE_STRIP,0,4),r}_loadResources(e){const{maskUrl:i,overlayUrl:r}=e;this._imageLoadTask?.maskUrl===i&&this._imageLoadTask?.overlayUrl===r||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:sc(async s=>{const n=i==null||r==null?aZt(s):null,a=i!=null?J0(i,{signal:s}):n.then(l=>l.mask),o=r!=null?J0(r,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await a,overlay:await o}})})}_ensureTextureResources(e,i){this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay||(this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i,this._passParameters.overlay=new qi(e,this._createTextureDescriptor(i,6408,this._imageSources.overlay),this._imageSources.overlay),this._passParameters.mask=new qi(e,this._createTextureDescriptor(i,6406,this._imageSources.mask),this._imageSources.mask),this._passParameters.input=new qi(e,this._createTextureDescriptor(i,6408,null)))}_createTextureDescriptor(e,i,r){const s=this.renderingContext,n=new ar(e);return n.pixelFormat=n.internalFormat=i,n.wrapMode=33071,n.flipped=!!r,n.preMultiplyAlpha=!(i!==6408||!r||MRe(r.src)&&s.driverTest.svgPremultipliesAlpha.result),n}};c([p()],k2.prototype,"produces",void 0),c([p()],k2.prototype,"consumes",void 0),c([p()],k2.prototype,"_imageSources",void 0),c([p()],k2.prototype,"_imageLoadTask",void 0),k2=c([R("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],k2);const WI=8,oZt=16;function ZHe(){const t=new Gi;t.include(no),t.fragment.uniforms.add(new Gt("edgesTexture",i=>i.inputTexture),new Gt("areaTexture",i=>i.areaTexture),new Gt("searchTexture",i=>i.searchTexture)),t.fragment.constants.add("smaaAreaTexPixelSize","vec2",[1/160,1/560]);const e=1/7;return t.fragment.code.add(A`
    vec4 sampleLevelZeroOffset(vec2 coord, vec2 offset, vec2 resolution) {
      return texture(edgesTexture, coord + offset.x * resolution);
    }

    float searchLength(vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture(searchTexture, e).r;
    }

    float searchLeft(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${A.int(WI)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${A.int(WI)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength(e, 0.5, 0.5);
      return texcoord.x;
    }

    float searchUp(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${A.int(WI)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength(e.gr, 0.0, 0.5);
      return texcoord.y;
    }

    float searchDown(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${A.int(WI)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength(e.gr, 0.5, 0.5);
      return texcoord.y;
    }

    vec2 getArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
      vec2 texcoord = float(${A.int(oZt)}) * round(4.0 * vec2(e1, e2)) + dist;
      texcoord = smaaAreaTexPixelSize * texcoord + (0.5 * smaaAreaTexPixelSize);
      texcoord.y += ${A.float(e)} * offset;
      return texture(areaTex, texcoord).rg;
    }`),t.fragment.main.add(A`
    vec2 size = vec2(textureSize(edgesTexture, 0));
    vec2 resolution = 1.0 / size;
    vec2 pixelCoord = uv * size;
    vec4 offsets[2];
    offsets[0] = uv.xyxy + resolution.xyxy * vec4(-0.25, 0.125, 1.25, 0.125);
    offsets[1] = uv.xyxy + resolution.xyxy * vec4(-0.125, 0.25, -0.125, -1.25);
    vec4 maxOffset = vec4(offsets[0].xz, offsets[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * resolution.xxyy * float(${A.int(WI)});
    ivec4 subsampleIndices = ivec4(0.0);
    vec4 weights = vec4(0.0);
    vec2 e = texture(edgesTexture, uv).rg;
    if (e.r > 0.0) {
      vec2 d;
      vec2 coords;
      coords.y = searchUp(offsets[1].xy, maxOffset.z, resolution);
      coords.x = offsets[0].x;
      d.x = coords.y;
      float e1 = texture(edgesTexture, coords).g;
      coords.y = searchDown(offsets[1].zw, maxOffset.w, resolution);
      d.y = coords.y;
      d = d * size.y - pixelCoord.y;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(0.0, 1.0), resolution).g;
      weights.ba = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.x));
      // for some reason the following lines are necessary to prevent
      // texture lookup precision issues on some Intel integrated graphics chips
      vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
      weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
    }
    if (e.g > 0.0) {
      vec2 d;
      vec2 coords;
      coords.x = searchLeft(offsets[0].xy, maxOffset.x, resolution);
      coords.y = offsets[1].y;
      d.x = coords.x;
      float e1 = texture(edgesTexture, coords).r;
      coords.x = searchRight(offsets[0].zw, maxOffset.y, resolution);
      d.y = coords.x;
      d = d * size.x - pixelCoord.x;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(1.0, 0.0), resolution).r;
      weights.rg = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.y));
    }
    fragColor = weights;
  `),t}const lZt=Object.freeze(Object.defineProperty({__proto__:null,build:ZHe},Symbol.toStringTag,{value:"Module"}));let oEe=class extends er{constructor(e,i){super(e,i,new Hi(lZt,()=>W(()=>Promise.resolve().then(()=>Vri),void 0)),wn)}initializePipeline(){return _i({colorWrite:Fi})}};function YHe(){const t=new Gi;return t.include(no),t.fragment.uniforms.add(new Gt("blendWeightsTexture",e=>e.inputTexture),new Gt("colorTexture",e=>e.color)),t.fragment.main.add(A`vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}`),t}const cZt=Object.freeze(Object.defineProperty({__proto__:null,build:YHe},Symbol.toStringTag,{value:"Module"}));let lEe=class extends er{constructor(e,i){super(e,i,new Hi(cZt,()=>W(()=>Promise.resolve().then(()=>jri),void 0)),wn)}initializePipeline(){return _i({colorWrite:Fi})}};const uZt=.05,hZt=2;function JHe(){const t=new Gi;return t.include(no),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(A`float absMax3(vec3 v) {
vec3 t = abs(v);
return max(max(t.r, t.g), t.b);
}`),t.fragment.uniforms.add(new Gt("colorTexture",e=>e.color)).main.add(A`
    vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
    vec4 offsets[3];
    offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
    offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
    offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

    // Calculate color deltas:
    vec3 C = texture(colorTexture, uv).rgb;
    vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
    vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
    vec2 delta = vec2(absMax3(C - Cleft), absMax3(C - Ctop));
    vec2 edges = step(vec2(${A.float(uZt)}), delta);

    // discard if there is no edge:
    if (dot(edges, vec2(1.0)) == 0.0) {
      fragEdges = vec2(0.0);
    }
    else {
      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      float horizontal = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      float vertical = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), horizontal), vertical);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      horizontal = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      vertical = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, horizontal), vertical);

      // Local contrast adaptation in action:
      fragEdges = edges * step(maxDelta, float(${A.float(hZt)}) * delta);
    }
  `),t}const dZt=Object.freeze(Object.defineProperty({__proto__:null,build:JHe},Symbol.toStringTag,{value:"Module"}));let cEe=class extends er{constructor(e,i){super(e,i,new Hi(dZt,()=>W(()=>Promise.resolve().then(()=>Uri),void 0)),wn)}initializePipeline(){return _i({colorWrite:Fi})}},pZt=class extends $r{},L2=class extends Nc{constructor(e){super(e),this.produces="disabled",this.consumes={required:[wt.ANTIALIASING],optional:[ps.COMPOSITE]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new pZt}initialize(){this.addHandles([X(()=>this.isEnabled(),e=>e?this.enable():this.disable(),bt)])}async enable(){if(this.destroyed||(this.produces=wt.ANTIALIASING,this.requestRender(1),this._abortController||this._areaTexture&&this._searchTexture))return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await W(()=>import("./SMAAData-DCEZ61Cs.js"),[]);ct(e),await this._loadTextures(i,e),ct(e),this.requestRender(1)}catch(i){Zr(i)||re.getLogger(this).errorOnce(i)}this._abortController=null}async _loadTextures(e,i){ct(i);const[r,s]=await Promise.allSettled([J0(e.areaTexture,{signal:i}),J0(e.searchTexure,{signal:i})]);if(ct(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=uEe(n,9729,6407,r.value),this._searchTexture=uEe(n,9728,6409,s.value)}disable(){this.produces="disabled",this.requestRender(1)}destroy(){this._abortController=Rs(this._abortController),this._searchTexture=jt(this._searchTexture),this._areaTexture=jt(this._areaTexture)}precompile(){this.techniques.precompile(cEe),this.techniques.precompile(oEe),this.techniques.precompile(lEe)}render(e){const i=e.find(({name:v})=>v===wt.ANTIALIASING),r=e.find(({name:v})=>v===ps.COMPOSITE);if(!r)return i;if(!this._areaTexture||!this._searchTexture)return this.view.stage.renderer.blitFBO(r,i,!1),this.requestRender(1),i;const s=this.techniques.get(cEe),n=this.techniques.get(oEe),a=this.techniques.get(lEe);if(!s.compiled||!n.compiled||!a.compiled)return this.view.stage.renderer.blitFBO(r,i,!1),this.requestRender(1),i;const o=r.fbo.width,l=r.fbo.height,u=this.renderingContext;u.setViewport(0,0,o,l);const d=this.fboCache.acquire(o,l,"smaa edges",2);u.bindFramebuffer(d.fbo),u.setClearColor(0,0,0,1),u.clear(16384),this._smaaParameters.color=r.getTexture();const f=this.bindParameters;u.bindTechnique(s,f,this._smaaParameters),u.screen.draw();const g=this.fboCache.acquire(o,l,"smaa blend");return u.bindFramebuffer(g.fbo),u.setClearColor(0,0,1,1),u.clear(16384),this._smaaParameters.inputTexture=d.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,u.bindTechnique(n,f,this._smaaParameters),u.screen.draw(),d.release(),u.bindFramebuffer(i.fbo),u.setClearColor(0,1,0,1),u.clear(16384),this._smaaParameters.inputTexture=g.getTexture(),u.bindTechnique(a,f,this._smaaParameters),u.screen.draw(),g.release(),i}};function uEe(t,e,i,r){const s=new ar(r.width,r.height);return s.pixelFormat=i,s.wrapMode=33071,s.samplingMode=e,new qi(t,s,r)}c([p()],L2.prototype,"produces",void 0),c([p()],L2.prototype,"consumes",void 0),c([p({constructOnly:!0})],L2.prototype,"isEnabled",void 0),c([p()],L2.prototype,"_abortController",void 0),L2=c([R("esri.views.3d.webgl-engine.effects.smaa.SMAA")],L2);function QHe(){const t=new Gi;return t.attributes.add("position","vec3"),t.attributes.add("color","vec4"),t.attributes.add("size","float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Spe("transform",(e,i)=>fZt(e,i)),new Go("viewport",e=>e.camera.fullViewport),new Vs("pixelRatio",e=>e.camera.pixelRatio)),t.vertex.main.add(A`gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;`),t.fragment.main.add(A`float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);`),t}function fZt(t,e){return Ln(ub,e.camera.projectionMatrix),ub[10]=24e-8-1,ub[11]=-1,ub[14]=(24e-8-2)*e.camera.near,Cn(ub,ub,e.camera.viewMatrix),Cn(ub,ub,t.modelMatrix)}const ub=ut(),mZt=Object.freeze(Object.defineProperty({__proto__:null,build:QHe},Symbol.toStringTag,{value:"Module"}));let gZt=class extends $r{constructor(){super(...arguments),this.modelMatrix=ut()}},hEe=class extends er{constructor(e,i){super(e,i,new Hi(mZt,()=>W(()=>Promise.resolve().then(()=>Bri),void 0)),Moe.locations)}initializePipeline(){return _i({blending:Xg,depthTest:{func:515},colorWrite:Fi})}};const Moe=Qu().vec3f("position").vec4u8("color").f32("size").freeze();let Eoe=class extends Fg{constructor(){super(...arguments),this._numPoints=0,this._passParameters=new gZt}initialize(){this.addHandles([X(()=>this.view.environment.starsEnabled,e=>e?this._enable():this._disable(),Yt),X(()=>this.view.environment.lighting.type==="virtual"?null:this.view.environment.lighting.date,e=>this._update(e),bt)])}_enable(){super._enable(),this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=Rs(this._loadDataTask),this._numPoints=0,this._vao=jt(this._vao),this._starData=null}precompile(){this.techniques.precompile(hEe)}render(e){const i=e.find(({name:n})=>n===wt.OPAQUE_ENVIRONMENT),r=this.renderingContext;if(this.loading)return this.requestRender(1),i;if(!this._starData)return i;this._vao??=this._ensureResources(this._starData,r);const s=this.techniques.get(hEe);return s.compiled?(r.bindTechnique(s,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Sr.POINTS,0,this._numPoints),i):(this.requestRender(1),i)}_ensureResources(e,i){return this._numPoints=e.byteLength/XHe,yZt(i,new Float32Array(e,0,2*this._numPoints),new Uint8Array(e,2*this._numPoints*4,this._numPoints),this._numPoints)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*vZt(e),s=Ln(this._passParameters.modelMatrix,TZt);PO(s,s,-r*Math.PI),Cn(s,SZt,s),PO(s,s,-i*Math.PI),this.requestRender(1)}_createLoadDataTask(){if(this._starData)return null;const e=sc(async i=>{const{data:r}=await Tst("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});_Zt(r),this._starData=r});return e.promise.catch(i=>{Zr(i)||re.getLogger(this).error(i)}).then(()=>{this.destroyed||this.requestRender(1)}),e}};function yZt(t,e,i,r){const s=Moe.createBuffer(r),n=s.position,a=s.color,o=s.size;for(let l=0;l<r;l++){const u=e[2*l],d=e[2*l+1];n.set(l,0,-Math.cos(u)*Math.sin(d)),n.set(l,1,-Math.sin(u)*Math.sin(d)),n.set(l,2,-Math.cos(d));const f=wZt(i[l]),g=bZt(xZt[f[1]]);a.set(l,0,255*g[0]),a.set(l,1,255*g[1]),a.set(l,2,255*g[2]),a.set(l,3,255),o.set(l,f[0])}return new bm(t,new vn(t,bl(Moe),s.buffer))}function vZt(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function _Zt(t){if(!t)throw new q("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/XHe;if(e%1!=0||e>5e4||e<5e3)throw new q("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function bZt(t){return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function wZt(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}Eoe=c([R("esri.views.3d.webgl-engine.effects.stars.Stars")],Eoe);const xZt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],SZt=Oue(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),TZt=Oue(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),XHe=9;let Hfe=class extends $r{};function KHe(){const t=new Gi;return t.include(no),t.fragment.uniforms.add(new Gt("tex",e=>e.texture)),t.fragment.main.add(A`fragColor = vec4(1.0 - texture(tex, uv).a);`),t}const $Zt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Hfe,build:KHe},Symbol.toStringTag,{value:"Module"}));let dEe=class extends er{constructor(e,i){super(e,i,new Hi($Zt,()=>W(()=>Promise.resolve().then(()=>qri),void 0)),wn)}initializePipeline(){return _i({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}},CZt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new u5,this._passParameters=new nW,this._hudParameters=new Hfe,this._configuration.blitMode=2,this._techniques.precompile(Mg,this._configuration),this._configuration.blitEmissiveMode=1,this._techniques.precompile(Mg,this._configuration),this._configuration.blitMode=1,this._techniques.precompile(Mg,this._configuration),this._configuration.blitEmissiveMode=0,this._techniques.precompile(Mg,this._configuration),this._configuration.blitMode=3,this._techniques.precompile(Mg,this._configuration),this._techniques.precompile(dEe)}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.get(dEe);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw()}compositePreMultipliedAlpha(e,i,r){this._composite(e,i,2,r)}composite(e,i,r){this._composite(e,i,1,r)}blitDepthToLinearDepth(e,i){this._composite(e,i,3)}_composite(e,i,r,s=0){this._configuration.blitMode=r,this._configuration.blitEmissiveMode=s,this._passParameters.texture=i;const n=this._techniques.get(Mg,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw()}},MZt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new rd(new ArrayBuffer(4)),this._layerToOidToColor=new Kg,this._colorToUID=new Map,this._layerViewUidToGraphicsUidToObjectId=new Kg,this._layerViewUidToLayerId=new Map,this._layerViewUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,a=null,o=null,l=null){e&&i&&r&&s&&(this._layerViewUidToLayerId.set(s,r),this._layerViewUidToPopupEnabled.set(s,n),n&&this._layerViewUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:a,attributeIndex:o,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return $i(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerViewUid||!e.graphicUid)return this.colorZero;const i=this._layerViewUidToPopupEnabled.get(e.layerViewUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=this._layerViewUidToGraphicsUidToObjectId.get(e.layerViewUid,e.graphicUid)?.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerViewUid,r);if(!s){if(ie("enable-feature:objectAndLayerId-screenshot-testing"))s=r;else for(;!s;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(s=a)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerViewUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new rd(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerViewUidToGraphicsUidToObjectId.get(r.layerViewUid,r.graphicUid),n=this._layerViewUidToLayerId.get(r.layerViewUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",olid:s.objectId,lid:n})}return e}},eWe=class{constructor(e,i){this.key=e,this._free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment "${this.name}" in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this._free(),!0))}get test(){}},tWe=class extends eWe{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},EZt=class extends tWe{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=2}},AZt=class extends tWe{constructor(){super(...arguments),this.type=1}},OZt=class extends AZt{constructor(e,i,r){super(e,i,r),this.attachment=i}};function PZt(t){return t?.attachment.type===1}let iWe=class extends eWe{constructor(e,i,r,s,n,a){super(e,a),this.fbo=r,this.type=0,this._colors=new Map,this._name=ps.COMPOSITE,this.acquireColor=null,this.acquireDepth=null,this._name=i,this.acquireColor=s,this.acquireDepth=n}dispose(){this.fbo?.dispose()}get usedMemory(){return this.fbo?.usedMemory||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(e){this._name=e}getTexture(e=Hr){return e===To?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(e)}get depthTexture(){return this.getTexture(To)}getAttachment(e=Hr){return e===To?this._depth:this._colors.get(e)}hasAttachment(e){return Lf(this._colors,i=>i.name===e)}attachDepth(e){return e?.retain(),this.detachDepth(),e&&this.fbo?.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=Lr(this._depth)}obtainDepthTexture(){const e=this._depth;return PZt(e)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){return e.retain(),this.detachColor(i),this.fbo?.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){this.fbo?.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i?.release()}detachAllColors(){this._colors.forEach((e,i)=>this.detachColor(i))}detachAll(){this.detachAllColors(),this.detachDepth()}detachAllColorsBut0(){this._colors.forEach((e,i)=>{i!==Hr&&this.detachColor(i)})}detachAllButColor0(){this.detachAllColorsBut0(),this.detachDepth()}};function RZt(t){switch(t){case 0:return"R8UNORM";case 1:return"R8UINT";case 2:return"RG8UNORM";case 3:return"RG8UINT";case 4:return"RGBA4UNORM";case 5:return"RGBA8UNORM";case 6:return"RGBA8UNORM_MIPMAP";case 7:return"R16FLOAT";case 8:return"RGBA16FLOAT";case 9:return"R32FLOAT";case 10:return"RG32FLOAT";case 11:return"RGBA32UINT";case 12:return"COUNT"}}function IZt(t){switch(t){case 12:return"DEPTH16";case 13:return"DEPTH24_STENCIL8"}}function jK(t){return Aoe(t)?IZt(t):RZt(t)}function Aoe(t){return t>=12}const p8=new ar;p8.pixelFormat=6403,p8.internalFormat=ot.R8,p8.wrapMode=33071;const Wk=new ar;Wk.pixelFormat=36244,Wk.internalFormat=ot.R8UI,Wk.wrapMode=33071,Wk.samplingMode=9728;const f8=new ar;f8.pixelFormat=33319,f8.internalFormat=ot.RG8,f8.wrapMode=33071;const Zk=new ar;Zk.pixelFormat=33320,Zk.internalFormat=ot.RG8UI,Zk.wrapMode=33071,Zk.samplingMode=9728;const m8=new ar;m8.internalFormat=ot.RGBA4,m8.dataType=Ns.UNSIGNED_SHORT_4_4_4_4,m8.wrapMode=33071;const rWe=new ar;rWe.wrapMode=33071;const Yk=new ar;Yk.wrapMode=33071,Yk.samplingMode=9987,Yk.hasMipmap=!0,Yk.maxAnisotropy=8;const Jk=new ar;Jk.pixelFormat=6403,Jk.dataType=Ns.HALF_FLOAT,Jk.internalFormat=ot.R16F,Jk.samplingMode=9728;const g8=new ar;g8.dataType=Ns.HALF_FLOAT,g8.internalFormat=ot.RGBA16F,g8.wrapMode=33071;const Qk=new ar;Qk.pixelFormat=6403,Qk.dataType=Ns.FLOAT,Qk.internalFormat=ot.R32F,Qk.samplingMode=9728;const Xk=new ar;Xk.pixelFormat=33319,Xk.dataType=Ns.FLOAT,Xk.internalFormat=ot.RG32F,Xk.samplingMode=9728;const q3=new ar;q3.pixelFormat=36249,q3.dataType=Ns.UNSIGNED_INT,q3.internalFormat=ot.RGBA32UI,q3.samplingMode=9728,q3.wrapMode=33071;const DZt={0:p8,1:Wk,2:f8,3:Zk,4:m8,5:rWe,6:Yk,7:Jk,8:g8,9:Qk,10:Xk,11:q3,12:null},kZt={[mp.DEPTH_COMPONENT16]:Ns.UNSIGNED_SHORT,[mp.DEPTH_COMPONENT24]:Ns.UNSIGNED_INT,[mp.DEPTH_COMPONENT32F]:Ns.FLOAT,[Jg.DEPTH24_STENCIL8]:Ns.UNSIGNED_INT_24_8,[Jg.DEPTH32F_STENCIL8]:Ns.FLOAT_32_UNSIGNED_INT_24_8_REV},LZt={13:pEe(Jg.DEPTH24_STENCIL8),12:pEe(mp.DEPTH_COMPONENT16)};function pEe(t){const e=new ar;return e.pixelFormat=she(t)?6402:34041,e.dataType=kZt[t],e.samplingMode=9728,e.wrapMode=33071,e.internalFormat=t,e.hasMipmap=!1,e.isImmutable=!0,e}let UK=class{constructor(e,i){this._last=new Ai,this._incarnation=0,this._cache=new tz(e,i)}destroy(){this._last?.forAll(e=>e.dispose()),this._last?.prune(),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new Ai:e||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce((e,i)=>e+i.usedMemory,0)??0}},FZt=class{constructor(e){this.rctx=e,this._interactive=!1,this._usage=new Map,this._acquired=new Set,this._cache=new UK(e.newCache,"FBOCache"),this._depthCache=new UK(e.newCache,"DepthAttachmentCache"),this._colorCache=new UK(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback?.(),this._usage.clear()}frameEnd(){const{debugCallback:e}=this;e&&this._acquired.forEach(i=>e(i.name,i.fbo,this._usage))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>e+i.usedMemory,this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e,this._interactive=e}get interactive(){return this._interactive}acquire(e,i,r,s=5){const n=BK(s,e,i);let a=this._cache.pop(n);const{rctx:o}=this;if(a){a.retain(),a.setName(r);const l=a.getAttachment(To);l&&(l.name=mEe(r));const u=a.getAttachment(Hr);u&&(u.name=fEe(r,0));const d=a.fbo;d?o.temporaryBindFramebufferObject(d,()=>{o.setDrawBuffers([Hr]),o.unbindTexture(d.colorTexture)}):re.getLogger("esri.views.3d.webgl-engine.core.FBOCache").errorOnce("Encountered an invalid cached framebuffer")}else{const l=new U1(o),u=(g,v,_)=>{v??=5;const x=this._acquireColor(v,e,i,_??fEe(a.name,g-Hr));return this.rctx.unbindTexture(x.attachment),a.attachColor(x,g),x.release(),a},d=g=>{g??=13;const v=this.acquireDepth(g,e,i,mEe(a.name));return a.attachDepth(v),v.release(),a},f=()=>{if(!a)return;this.debugCallback?.(a.name,a.fbo),this._acquired.delete(a);const g=Aoe(s);g&&a.getAttachment(To)!=null||!g&&a.getAttachment(Hr)!=null?(g?(a.fbo?.invalidateAttachments([To]),a.detachAllColors()):(a.fbo?.invalidateAttachments([Hr]),a.detachAllButColor0()),this._cache.put(a)):a.dispose()};a=new iWe(n,r,l,u,d,f),Aoe(s)?a.acquireDepth(s):a.acquireColor(Hr,s,r)}return this._trackUsage(a,"fbo "+jK(s),e,i),this._trackHandle(a)}acquireDepth(e,i,r,s){const n=BK(e,i,r);let a=this._depthCache.pop(n);if(a)a.retain(),a.attachment.setShadowFiltering(!1);else{const o=new qi(this.rctx,{...LZt[e],width:i,height:r});a=new OZt(n,o,()=>this._depthCache.put(a))}return a.name=s,this._trackUsage(a,"depth "+jK(e),i,r),a}_acquireColor(e,i,r,s){const n=BK(e,i,r);let a=this._colorCache.pop(n);if(a)a.retain();else{const o=new qi(this.rctx,{...DZt[e],width:i,height:r});a=new EZt(n,o,()=>this._colorCache.put(a))}return a.name=s,this._trackUsage(a,"color "+jK(e),i,r),a}_trackHandle(e){return this._acquired.add(e),e}_trackUsage(e,i,r,s){this.debugCallback&&(this._usage.has(e)?this._usage.get(e)[2].push(e.name):this._usage.set(e,[i,`${r}x${s}`,[e.name]]))}};function fEe(t,e=0){return`${t}.color${e}`}function mEe(t){return`${t}.depth`}const eP=new iWe("default","default",null,()=>eP,()=>eP,()=>{});function BK(t,e,i){return`${e}x${i}:${t}`}eP.release=()=>!1;let sf=class{constructor(e,i,r=0){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new Ai({allocator:s=>s??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s,n){const a=this._draws.pushNew();a.geometry=i,a.geometryRanges=r,a.material=e,a.depthSquaredHint=s,a.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0,a.highlightName=n}acquire(e,i){return this._draws.map(r=>r.material.acquireTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const a=this._draws.length,o=i.highlight?.name;for(let l=0;l<a;l++){const u=this._draws.data[l];if(e.identifier===2){const T=u.highlightName;if(T){if(T!==o)continue}else if(!o||!i.overlay?.hasHighlight(o))continue}const d=r[l];d===n&&i.oitPass===0||(s.bindTechnique(d,i,e),n=d);const{geometryRanges:f,indexType:g,geometry:v,material:_}=u;s.bindVAO(v.vao),this._previouslyBoundDraw.get(d)!==_&&(d.program.bindDraw(i,e,_),this._previouslyBoundDraw.set(d,_));const x=f.length,{primitiveType:S}=v;for(let T=0;T<x;T+=2){const M=f[T],E=f[T+1];if(g!==0){const P=y8.get(g);s.drawElements(S,E,g,M*P)}else s.drawArrays(S,M,E)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===0?1:-1;this._draws.sort((i,r)=>e*(i.depthSquaredHint-r.depthSquaredHint)||i.geometry.vao.usedMemory-r.geometry.vao.usedMemory)}get count(){return this._draws.length}};const y8=new Map;y8.set(Di.UNSIGNED_BYTE,1),y8.set(Di.UNSIGNED_SHORT,2),y8.set(Di.UNSIGNED_INT,4);let zZt=class{constructor(e){const i=e.renderContext.rctx,r=e.techniques;this.opaque=new sf(i,r),this.transparent=new sf(i,r,1),this.integratedMesh=new sf(i,r),this.transparentIntegratedMesh=new sf(i,r),this.occludedGround=new sf(i,r),this.shadowMap=new sf(i,r),this.highlight=new sf(i,r),this.highlightIntegratedMesh=new sf(i,r),this.highlightShadowMap=new sf(i,r),this.viewshedShadowMap=new sf(i,r),this.defaultShadowMap=new sf(i,r)}},lW=class extends $qe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=I(),this.origin=this.slicePlaneLocalOrigin}},NZt=class extends lW{constructor(){super(...arguments),this.identifier=0,this.output=0,this.transparent=!1,this.occludedGround=!1}},VZt=class extends lW{constructor(){super(...arguments),this.identifier=1}},jZt=class extends lW{constructor(){super(...arguments),this.identifier=2}},UZt=class extends lW{constructor(){super(...arguments),this.identifier=3}},Ooe=class extends VF{constructor(){super(...arguments),this.produces=new Map([[2,e=>this._produces(e,2)],[4,e=>this._produces(e,4)],[0,e=>this._produces(e,0)],[7,e=>this._produces(e,7)],[9,e=>this._produces(e,9)]]),this._materialPassParameters=new NZt,this._shadowPassParameters=new VZt,this._highlightPassParameters=new jZt,this._viewshedPassParameters=new UZt,this._systems=new Set}initializeRenderContext(e){this._context=e,this._passes=new zZt(e)}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear(),this._passes=null}register(e){this._systems.add(e)}_produces(e,i){return!!this._invoke(e,i,r=>r.count>0)}prepareRender(e){const{_systems:i,_passes:r}=this;if(i.size!==0&&r!=null){for(const s of Object.values(r))s.prepareSubmit();i.forEach(s=>s.submit(r,e.bind));for(const s of Object.values(r))s.finishSubmit()}}acquireTechniques(e){if(this._systems.size===0)return null;const i=e.output===4||e.output===5||e.output===6?this._shadowPassParameters:e.output===7?this._viewshedPassParameters:e.output===9?this._highlightPassParameters:this._materialPassParameters,r=e.bind;return this._updateParameters(r.camera,i,r.slot),this._materialPassParameters.output=e.output,this._invoke(e.output,e.bind.slot,(s,n)=>s.acquire(n,e.bind))}render(e,i){this._invoke(e.output,e.bind.slot,(r,s)=>r.dispatch(s,e.bind,i))}_invoke(e,i,r){if(this._passes==null)return null;switch(i){case 2:switch(e){case 0:case 1:case 2:case 3:case 10:return r(this._passes.opaque,this._materialPassParameters);case 9:return r(this._passes.highlight,this._highlightPassParameters);case 4:return r(this._passes.shadowMap,this._shadowPassParameters);case 5:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case 6:return r(this._passes.defaultShadowMap,this._shadowPassParameters);case 7:return r(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case 4:switch(e){case 0:case 1:case 2:case 3:case 10:return r(this._passes.transparent,this._materialPassParameters)}break;case 0:switch(e){case 0:case 1:case 2:case 3:case 10:case 8:return r(this._passes.integratedMesh,this._materialPassParameters);case 9:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}break;case 7:switch(e){case 0:case 1:return r(this._passes.transparentIntegratedMesh,this._materialPassParameters)}break;case 9:switch(e){case 0:case 1:case 2:case 3:case 10:return r(this._passes.occludedGround,this._materialPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new $o;return this._systems.forEach(r=>i.union(r.queryDepthRange(e))),i}get hasEmitters(){let e=!1;return this._systems.forEach(i=>e=i.hasEmissions||e),e}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix,n=r===4,a=r===9;xe(qK,s[3],s[7],s[11]),GK.set(qK),me(i.transformWorldFromViewTH,GK.high),me(i.transformWorldFromViewTL,GK.low),me(i.slicePlaneLocalOrigin,qK),P1(i.transformViewFromCameraRelativeRS,e.viewMatrix),Ln(i.transformProjFromView,e.projectionMatrix),i.identifier===0&&(this._materialPassParameters.transparent=n,this._materialPassParameters.occludedGround=a,R1(gEe,i.transformViewFromCameraRelativeRS),_$(i.transformNormalViewFromGlobal,gEe))}hasHighlight(e){for(const i of this._systems)if(i.hasHighlight(e))return!0;return!1}};Ooe=c([R("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],Ooe);const qK=I(),gEe=Jr(),GK=new PHe;function BZt(t){return t.name}let qZt=class{constructor(e){this._context=e,this._nodes=new Ai}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.prune()}add(e){this._nodes.push(e)}remove(e){this._nodes.remove(e)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes,s=n=>r.reduce((a,{consumes:o,produces:l})=>a+(!o.required.includes(e)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,a)=>n+s(a),0)}optional(e,...i){const r=this._nodes,s=n=>r.reduce((a,{consumes:o,produces:l})=>a+(!o.optional?.includes(e)||n!=null&&l!==n?0:1),0);return i.length===0?s():i.reduce((n,a)=>n+s(a),0)}updateAnimation(e){return this._nodes.reduce((i,r)=>r.updateAnimation(e)||i,!1)}precompile(...e){++this._context.techniques.precompiling;for(const i of e)this._nodes.forEach(r=>{r.produces===i&&r.precompile()});--this._context.techniques.precompiling}render(e,i,r=()=>{}){return this._render(e,i,r)??(BZt(e)?e:eP)}produce(e,i,r=()=>{}){return this._render(e,i,r)}_render(e,i,r=()=>{}){const s=typeof e=="string"?e:e.name,n=this._nodes.filter(({produces:o})=>o===s);if(n.length===0)return;let a=typeof e=="string"?null:e;return n.some(o=>{const l=a?[a]:[],u=a==null;for(const d of o.consumes.required){if(d===s){if(u)return!1;continue}const f=i.get(d);if(f)l.push(f);else if(d!=="emissive"||!i.get(s)?.hasAttachment(d))return r?.(l),!1}if(o.consumes.optional)for(const d of o.consumes.optional){if(d===s)continue;const f=i.get(d);f&&l.push(f)}try{const d=o.doRender(l);d&&d!==a&&(s!==d.name&&(re.getLogger(o).errorOnce(`RenderNode produced ${d.name}, expected ${s}`),d.setName(s)),a?.release(),a=d,i.set(s,a))}catch(d){re.getLogger(o).errorOnce(d)}return r?.(l),u&&a!=null}),this._context.rctx.enforceState(),a}requireGeometryDepth(){return this._nodes.some(e=>e.produces!=="disabled"&&e.requireGeometryDepth)}get test(){return{nodes:this._nodes}}},GZt=class{constructor(e){this.context=e,this._renderPlugins=new Array,this._slots=new Array,this._version=ta(0);for(let i=0;i<21;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.length=0}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i?.aborted)throw e.uninitializeRenderContext(),ti();this._renderPlugins.push(e),e.produces.forEach((n,a)=>this._slots[a].push(e)),this.context.requestRender(),this._version.value++},s=e.initializeRenderContext(this.context,i);if(Ea(s))return s.then(r);r()}remove(e){Uc(this._renderPlugins,e),e.uninitializeRenderContext();for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forEach(e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forEach(r=>i=r.updateAnimation?.(e)||i),i}precompile(...e){++this.context.techniques.precompiling;const i=this.context.renderContext.bind.slot;for(const r of e)this.context.renderContext.bind.slot=r,this._forEachRender(()=>{});this.context.renderContext.bind.slot=i,--this.context.techniques.precompiling}render(...e){for(const i of e)this.context.renderContext.bind.slot=i,this._forEachRender((r,s)=>r.render(this.context.renderContext,s))}_forEachRender(e){const i=this.context.renderContext.bind.slot,r=this.context.renderContext.output;this._slots[i].forEach(s=>{if(!s.produces.get(i)?.(r)||s.isDecoration&&!this.context.renderContext.bind.decorations)return;const a=s.acquireTechniques(this.context.renderContext);a&&e(s,a)})}queryDepthRange(e){const i=new $o;return this._renderPlugins.forEach(r=>{const s=r.queryDepthRange?.(e);i.union(s)}),i}get updating(){return this._version.value>=0&&this._renderPlugins.some(e=>e.readyToRun)}produces(e,...i){return i.some(r=>this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}hasHighlight(e){return HZt.some(i=>this._slots[i].some(r=>r.hasHighlight(e)))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get hasEmitters(){return this._renderPlugins.some(e=>e.hasEmitters)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|(i.renderOccludedFlags??0),0)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.material?e:e+(i.usedMemory??0),0)}get test(){}};const HZt=[2,4,18,13,14];let Wfe=class extends $r{};function sWe(t){const e=new Gi;e.include(no);const{hasEmitters:i,dimEmissive:r}=t,s=e.fragment;return s.uniforms.add(new Gt("colorTexture",n=>n.colorTexture),new Gt("alphaTexture",n=>n.alphaTexture)),e.outputs.add("fragColor","vec4",0),i&&e.outputs.add("fragEmission","vec4",1),r?(s.main.add(A`float srcAlpha = texture(alphaTexture, uv).r;
vec4 srcColor = texture(colorTexture, uv);
srcColor.rgb = clamp(srcColor.rgb, vec3(0.0), srcColor.rgb);
vec3 dimming = srcAlpha > 1.0 ? mix(vec3(1.0), srcColor.rgb, 1.0 / srcAlpha) : mix(vec3(1.0), srcColor.rgb, srcAlpha);
fragEmission = vec4(dimming, 0.0);`),e):(s.uniforms.add(new Gt("frontFaceTexture",n=>n.frontFaceTexture)),i&&(s.uniforms.add(new Gt("emissionTexture",n=>n.emissionTexture)),s.uniforms.add(new Gt("emissionFrontFaceTexture",n=>n.emissionFrontFaceTexture))),s.main.add(A`
      float srcAlpha = texture(alphaTexture, uv).r;
      if(srcAlpha == 0.0){
        fragColor = vec4(0.0);
        ${we(i,"fragEmission = vec4(0.0);")}
        return;
      }

      vec4 srcColor = texture(colorTexture, uv);
      vec4 frontFace = texture(frontFaceTexture, uv);
      fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);

      ${we(i,`vec4 emission = texture(emissionTexture, uv);
         vec4 emissionFrontFace = texture(emissionFrontFaceTexture, uv);

         // Modulate transparent emitter by front faces. This case is important for surfaces which contain emitter and 
         // non-emitter at the same time. Non-emitter surface parts need to modulate emissions as well.
         emission.rgb = emission.rgb * (1.0 - frontFace.a);

         fragEmission = vec4(mix(emission.rgb / srcAlpha, emissionFrontFace.rgb, emissionFrontFace.a), 1.0 - srcColor.a);`)}
    `),e)}const WZt=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:Wfe,build:sWe},Symbol.toStringTag,{value:"Module"}));let ZI=class extends er{constructor(e,i){super(e,i,new Hi(WZt,()=>W(()=>Promise.resolve().then(()=>Gri),void 0)),wn)}initializePipeline(e){return _i({blending:e.dimEmissive?HPt:Xg,colorWrite:Fi,drawBuffers:e.dimEmissive?{buffers:[Zq,vl]}:e.hasEmitters?{buffers:[Hr,vl]}:{buffers:[Hr]}})}},Poe=class extends Tl{constructor(){super(...arguments),this.hasEmitters=!1,this.dimEmissive=!1}};c([ue()],Poe.prototype,"hasEmitters",void 0),c([ue()],Poe.prototype,"dimEmissive",void 0);let ZZt=class{constructor(e){this._techniques=e,this._parameters=new Wfe,this._configuration=new Poe,e.precompile(ZI,this._configuration),this._configuration.hasEmitters=!0,e.precompile(ZI,this._configuration),this._configuration.dimEmissive=!0,e.precompile(ZI,this._configuration),this._configuration.dimEmissive=!1,this._configuration.hasEmitters=!1}blend(e,i,r,s,n,a){if(this._parameters.colorTexture=i.getTexture(),this._parameters.alphaTexture=i.getTexture(n?ihe:vl),this._parameters.frontFaceTexture=r.getTexture(),this._configuration.hasEmitters=n,n&&a){this._configuration.dimEmissive=!0;const l=this._techniques.get(ZI,this._configuration);e.bindTechnique(l,s,this._parameters),e.screen.draw(),this._configuration.dimEmissive=!1}n&&(this._parameters.emissionTexture=i.getTexture(vl),this._parameters.emissionFrontFaceTexture=r.getTexture(vl));const o=this._techniques.get(ZI,this._configuration);e.bindTechnique(o,s,this._parameters),e.screen.draw()}},YZt=class{constructor(e,i){this._camera=e,this._dt=0,this._time=0,this._lastUpdate=0,this._lastUpdate=i,this._time=i}advance(e,i,r){const s=i-this._lastUpdate;this._dt=s/r,this._time=this._time+s,this._lastUpdate=i,this._camera=e}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}},JZt=class{constructor(){this._step=_Ee,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ie("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=yEe+XZt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=yEe?KZt:1}const r=Ce(e/QZt,_Ee,tYt);this._step===1/0?this._step=r:this._step=this._step*vEe+r*(1-vEe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const QZt=.5,yEe=12e4,XZt=1e4,KZt=10,vEe=.9,eYt=30,_Ee=1e3/1,tYt=1e3/eYt,iYt=1e4,Roe=100,rYt=500,sYt=500,nYt=.1;function bEe(t,e,i,r){let s=0;if(!e.some(a=>!!a.material&&(s+=a.numGeometries,s>=iYt)))return fYt.compute(t,e,r);const n=new $o;return i.forEach(a=>n.union(aYt(t,a))),n}function aYt(t,e){if(!e.visible)return;const i=new $o,r=e.getSpatialQueryAccelerator();return r?oYt(i,t,r):lYt(i,t,e.objects),i}function oYt(t,e,i){const{eye:r,viewForward:s,frustum:n}=e,a=l=>l.visible,o=i.objectCount;if(o<rYt)Yd.set(e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,1,Yd,(l,u)=>{Ioe(t,e,l),Yd.far=t.near,u.setRange(Yd)},n,a),Yd.set(Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,-1,Yd,(l,u)=>{Ioe(t,e,l),Yd.near=t.far,u.setRange(Yd)},n,a);else{const l=Math.max(Math.min(o,sYt),Math.ceil(o*nYt)),u=i.findClosest(s,1,n,a,l),d=i.findClosest(s,-1,n,a,l);u&&d&&(wEe(t,e,u.boundingVolumeWorldSpace.bounds),wEe(t,e,d.boundingVolumeWorldSpace.bounds))}}function lYt(t,e,i){wM.clear(),i.forEach(r=>{r.visible&&r.geometries.length!==0&&wM.add(r)}),wM.empty||(wM.sort(e),Yd.set(e.near,Math.min(t.near,e.far)),wM.forEachInDepthRange(Yd,1,(r,s)=>{s<t.near&&Ioe(t,e,r)}),Yd.set(Math.max(t.far,e.near),e.far),wM.forEachInDepthRange(Yd,-1,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function Ioe(t,e,i){if(!i.visible||!ww(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=pYt;i.geometries.forEach(n=>{Cn(s,r,n.transformation);const a=eL(s);nWe(t,e,n.boundingInfo,s,a)})}function nWe(t,e,i,r,s){if(i==null)return;jO(wo,i.center,r);const{eye:n,viewForward:a}=e,o=a[0]*(wo[0]-n[0])+a[1]*(wo[1]-n[1])+a[2]*(wo[2]-n[2]);if(wo[3]=i.radius*s,!(o-wo[3]>t.near&&o+wo[3]<t.far)&&ww(e.frustum,wo))if(i.radius>Roe&&i.getChildren())for(const l of i.getChildren())nWe(t,e,l,r,s);else Doe.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function wEe(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let cYt=class{constructor(){this._items=new Ai({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,a=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=a,s.near=a-n[3],s.far=a+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===1)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},uYt=class{constructor(){this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange=new $o(0,0)}compute(e,i,r){this._reset();const{viewMatrix:s}=e;i.forEach(u=>{u.forEachGeometry(d=>{if(!d.visible||r===0&&!d.castShadow)return;const f=d.boundingSphere,g=s[2]*f[0]+s[6]*f[1]+s[10]*f[2]+s[14],v=g-f[3],_=g+f[3];this._geometries.push(d),this._near.push(-_),this._far.push(-v)})});const n=new $o;if(this._geometries.length===0)return n;for(let u=0;u<this._geometries.length;++u)this._near[u]>n.far&&(n.far=this._near[u]),this._near[u]>2&&this._far[u]<n.near&&(n.near=this._far[u]);const a=this._looseRange;a.near=Math.max(.5*n.near,2),a.far=2*n.far;let o=0,l=0;for(let u=0;u<this._geometries.length;++u)this._near[u]<n.near&&(this._near[u]>=a.near?n.near=this._near[u]:this._nearCandidates[o++]=u),this._far[u]>n.far&&(this._far[u]<=a.far?n.far=this._far[u]:this._farCandidates[l++]=u);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return n;this._nearCandidates.sort((u,d)=>this._near[u]<this._near[d]?-1:this._near[u]>this._near[d]?1:0),this._farCandidates.sort((u,d)=>this._far[u]<this._far[d]?1:this._far[u]>this._far[d]?-1:0);for(let u=0;u<this._nearCandidates.length;++u){const d=this._nearCandidates[u];if(this._near[d]<n.near){const f=this._geometries[d],{boundingInfo:g,shaderTransformation:v}=f;this._includeNearBoundingInfoRec(e,g,v,n)}}for(let u=0;u<this._farCandidates.length;++u){const d=this._farCandidates[u];if(this._far[d]>n.far){const f=this._geometries[d],{boundingInfo:g,shaderTransformation:v}=f;this._includeFarBoundingInfoRec(e,g,v,n)}}return this._reset(),n}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_isOutsideSidePlanes(e,i){const r=Li(e),s=qg(e);return i[0][0]*r[0]+i[0][1]*r[1]+i[0][2]*r[2]+i[0][3]>s||i[1][0]*r[0]+i[1][1]*r[1]+i[1][2]*r[2]+i[1][3]>s||i[2][0]*r[0]+i[2][1]*r[1]+i[2][2]*r[2]+i[2][3]>s||i[3][0]*r[0]+i[3][1]*r[1]+i[3][2]*r[2]+i[3][3]>s}_includeNearBoundingInfoRec(e,i,r,s){if(i==null)return;const n=i.center;jO(wo,n,r),wo[3]=i.radius*eL(r);const{frustum:a}=e;if(this._isOutsideSidePlanes(wo,a))return;const o=wo[0],l=wo[1],u=wo[2],d=wo[3],{viewMatrix:f}=e,g=f[2]*o+f[6]*l+f[10]*u+f[14],v=g+d;if(!(-(g-d)<2||-v>=s.near))if(-v>this._looseRange.near)s.near=-v;else{if(d>Roe){const _=i.getChildren();if(_!==void 0){for(const x of _)this._includeNearBoundingInfoRec(e,x,r,s);return}}Doe.unionDepthRangeWithAABB(s,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}_includeFarBoundingInfoRec(e,i,r,s){if(i==null)return;const n=i.center;jO(wo,n,r),wo[3]=i.radius*eL(r);const{frustum:a}=e;if(this._isOutsideSidePlanes(wo,a))return;const[o,l,u,d]=wo,{viewMatrix:f}=e,g=f[2]*o+f[6]*l+f[10]*u+f[14]-d;if(!(-g<=s.far))if(-g<this._looseRange.far)s.far=-g;else{if(d>Roe){const v=i.getChildren();if(v!==void 0){for(const _ of v)this._includeFarBoundingInfoRec(e,_,r,s);return}}Doe.unionDepthRangeWithAABB(s,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}},hYt=class{constructor(){this._modelViewProj=ut(),this._clipPosition=[li(),li(),li(),li(),li(),li(),li(),li()]}unionDepthRangeWithAABB(e,i,r,s,n){const a=this._modelViewProj;Cn(a,i,r);let o=!1;for(let l=0;l<8;++l){const u=this._clipPosition[l],d=l===0||l===3||l===4||l===7?s[0]:n[0],f=l===0||l===1||l===4||l===5?s[1]:n[1],g=l<4?s[2]:n[2];u[0]=a[0]*d+a[4]*f+a[8]*g+a[12],u[1]=a[1]*d+a[5]*f+a[9]*g+a[13],u[2]=a[2]*d+a[6]*f+a[10]*g+a[14],u[3]=a[3]*d+a[7]*f+a[11]*g+a[15]}for(let l=0;l<12;++l){const u=dYt(this._clipPosition[WK[l][0]],this._clipPosition[WK[l][1]],this._clipPosition[WK[l][2]]);let d=!0;for(let f=0;f<u.length;++f)if(u[f][3]>=2){d=!1;break}if(!d){o=!0;for(let f=0;f<u.length;++f){const g=u[f][3];Number.isFinite(g)&&(e.near=Math.min(g,e.near),e.far=Math.max(g,e.far))}}}return o}};function dYt(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let a=0;a<n.length;++a){const o=n[a],l=n[(a+1)%n.length];HK(l,s)?(HK(o,s)||r.push(xEe(o,l,s)),r.push(l)):HK(o,s)&&r.push(xEe(o,l,s))}}return r}function HK(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void xt(!1)}function xEe(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),sH(li(),t,e,r)}const WK=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],wo=Is(),pYt=ut(),Yd=new $o,wM=new cYt,fYt=new uYt,Doe=new hYt,mYt={idleOpacity:.8,navigatingOpacity:.4,maxDelta:.1,tiltFadeStart:20,tiltFadeEnd:30,altitudeStart:1e4,altitudeEnd:2e4};let gYt=class{constructor(e){this._fbos=e,this._requiresEmission=!1,this._size=new $8t(0,0),this._clearColor=li()}dispose(){this._color=Lr(this._color),this.releaseDepth()}initialize(e,i,r,s){this._size.width=e,this._size.height=i,fS(this._size,this._fbos.rctx.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=s,qc(this._clearColor,r),n}releaseDepth(){this._color?.detachDepth(),this._depth=Lr(this._depth)}update(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}bind(){const{rctx:e}=this._fbos,i=this._color==null;this.color.attachDepth(this.depth),e.bindFramebuffer(this.color.fbo),i&&(e.setClearStencil(0),e.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),e.clear(17664),this._requiresEmission&&e.clearBuffer(1,oW))}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"main color").acquireColor(vl,8,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"main color")}_acquireDepth(){return this._fbos.acquireDepth(13,this._size.width,this._size.height,"main depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??=this._acquireDepth(),this._depth}_ensureColor(){return this._color??=this._acquireColor(),this._color}};function SEe(t=!ie("disable-feature:high-quality-idle"),e=null){const i=new Kg;return t?(i.set(2,0,e!=="low"),i.set(2,3,e!=="low"),i.set(2,1,!0),i.set(2,4,!0),i.set(2,5,!0),i.set(2,8,!0)):(i.set(0,6,!0),i.set(0,7,!0),i.set(1,6,!0),i.set(1,7,!0)),i.set(2,6,!0),i.set(2,7,!0),i.set(2,2,!0),i}let yYt=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){this._inputs.get(e)?.release()&&this._inputs.delete(e)}};function vYt(t){t.code.add(`
  vec4 blendColorsPremultiplied(vec4 source, vec4 dest) {
    float oneMinusSourceAlpha = 1.0 - source.a;
    return source + dest * oneMinusSourceAlpha;
  }
  `)}function YI(t,e){return t[0]=e[0]*e[3],t[1]=e[1]*e[3],t[2]=e[2]*e[3],t[3]=e[3],t}const nz=255,_Yt=1/nz;function aWe(t){const e=new Gi,{fragment:i}=e;e.include(no),e.include(GHe),e.include(Ope),i.uniforms.add(new qG("shadowMap",s=>s.shadowMap.depthTexture),new Jo("depthMap",s=>s.depth?.attachment)),i.constants.add("sampleValue","float",_Yt);const r=t.index===1?"vec2":"float";return e.outputs.add("sampleCount",r),i.main.add(A`
    sampleCount = ${r}(0.0);

    vec3 uvzShadow = calculateUVZShadowFromDepth(uv, textureSize(shadowMap,0), depthMap);
    if (uvzShadow.z < 0.0) {
      return;
    }

    // The shadow map sampler returns a value between 0 and 1, we take the midpoint as we count discrete samples
    bool shadow = readShadowMapUVZ(uvzShadow, shadowMap) > 0.5;

    if (shadow) {
      sampleCount = ${r}(sampleValue); // Add 1 to the sample count
    }
  `),e}const bYt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:nz,build:aWe},Symbol.toStringTag,{value:"Module"}));let Zfe=class extends $r{constructor(e){super(),this._data=e,this.sampleScale=Ke(),this.opacityFromElevation=1,this.gradientColor=eA(wYt),this.thresholdColor=eA(xYt),this.bandedGradientColor=eA(SYt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const Yfe=.7,ZK=50/255,wYt=$i(0,0,1,Yfe),xYt=$i(1,0,0,Yfe),SYt=$i(ZK,ZK,ZK,Yfe);function oWe(t){const e=new Gi,i=e.fragment;e.include(BH),e.include(no);const{visualization:r}=t;i.constants.add("inverseSampleValue","float",nz),i.uniforms.add(new Gt("shadowCastMap",d=>d.shadowCastMap),new rc("sampleScale",d=>d.sampleScale),new _t("opacityFromElevation",d=>d.opacityFromElevation));const s=r===2,n=r===3,a=r===1;switch(n&&i.include(vYt),r){case 0:i.uniforms.add(new Ca("uColor",d=>YI(JI,d.gradientColor)));break;case 1:i.uniforms.add(new Ca("uColor",d=>YI(JI,d.bandedGradientColor)),new _t("bandSize",d=>d.bandSize));break;case 3:i.uniforms.add(new Ca("uColor",d=>YI(JI,d.thresholdColor)),new Ca("gradientColor",d=>YI(JI,d.gradientColor)),new _t("threshold",d=>d.threshold));break;case 2:i.uniforms.add(new Ca("uColor",d=>YI(JI,d.thresholdColor)),new _t("threshold",d=>d.threshold))}const{type:o,selector:l,thresholdStrengthSelector:u}=n?{type:"vec2",selector:"rg",thresholdStrengthSelector:"strength.x"}:{type:"float",selector:"r",thresholdStrengthSelector:"strength"};return i.main.add(A`
    ${o} numSamples = texture(shadowCastMap, uv).${l} * inverseSampleValue;

    fragColor = vec4(0.0);

    // early out if we do not have any samples in one or more channels
    if (dot(numSamples, ${o}(1)) < 1.0) {
      return;
    }

    // sampleScale is the number of total samples taken, so this brings strength to a 0-1 range.
    // note that sampleScale is always a vec2 even if we have only the primary channel.
    ${o} strength = numSamples * sampleScale.${l};

    // in threshold mode, step the strength to 0 if we are at or below the threshold, 1 otherwise.
    ${we(s||n,A`
      ${u} = 1.0 - step(${u}, threshold);
    `)}

    // bail out if we are below the threshold
    ${we(s,A`if (${u} == 0.0) { return; }`)}

    ${we(a,A`strength = ceil(strength / bandSize) * bandSize;`)}

    ${o} attenuation = opacityFromElevation * strength;

    // in ThresholdAndGradient mode we blend the threshold color on top of the gradient color
    fragColor = ${we(n,A`blendColorsPremultiplied(uColor * attenuation.r, gradientColor * attenuation.g)`,A`uColor * attenuation`)};
  `),e}const JI=li(),TYt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Zfe,build:oWe},Symbol.toStringTag,{value:"Module"}));let TEe=class extends er{constructor(e,i){super(e,i,new Hi(TYt,()=>W(()=>Promise.resolve().then(()=>Hri),void 0)),wn),this.primitiveType=Sr.TRIANGLE_STRIP}initializePipeline(){return _i({blending:j1,colorWrite:Fi,depthTest:null,depthWrite:null})}},lWe=class extends Tl{constructor(){super(...arguments),this.visualization=0}};c([ue({count:4})],lWe.prototype,"visualization",void 0);const $Yt=4e4,CYt=5e4,cWe=1/512;let v8=class extends be{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new Zfe(this._data),this._configuration=new lWe,this._enabled=!1,this._vao=H1(i)}dispose(){this._stop(),this._vao=jt(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(TEe,this._configuration)}render(e){if(!this._showVisualization)return;const[i,r]=this._data.computedSamples;this._passParameters.sampleScale=[i?1/i:0,r?1/r:0];const s=this._techniques.get(TEe,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(s,e,this._passParameters),this._rctx.drawArrays(s.primitiveType,0,this._vao.vertexCount("geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.thresholdColor!==void 0&&this._setThresholdColor(e.thresholdColor),e.gradientColor!==void 0&&this._setGradientColor(e.gradientColor),e.bandedGradientColor!==void 0&&this._setBandedGradientColor(e.bandedGradientColor),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&(this._data.computedSamples[0]>0||this._data.computedSamples[1]>0)&&this.opacityFromElevation>cWe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}_setThresholdColor(e){const i=this._passParameters.thresholdColor;S0(e,i)||(qc(this._passParameters.thresholdColor,e),this._requestRenderIfEnabled())}_setGradientColor(e){const i=this._passParameters.gradientColor;S0(e,i)||(qc(this._passParameters.gradientColor,e),this._requestRenderIfEnabled())}_setBandedGradientColor(e){const i=this._passParameters.bandedGradientColor;S0(e,i)||(qc(this._passParameters.bandedGradientColor,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};c([p()],v8.prototype,"opacityFromElevation",null),v8=c([R("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],v8);let uWe=class extends er{constructor(e,i){super(e,i,new Hi(bYt,()=>W(()=>Promise.resolve().then(()=>Wri),void 0)),wn),this.primitiveType=Sr.TRIANGLE_STRIP}initializePipeline(e){const i={r:e.index===0,g:e.index===1,b:!1,a:!1};return _i({blending:GPt,colorWrite:i,depthTest:null,depthWrite:null})}},koe=class extends Tl{constructor(e){super(),this.index=0,this.index=e}};c([ue({count:2})],koe.prototype,"index",void 0);function hWe(t){const e=new Gi,{fragment:i}=e;e.include(no);const r=t.index===1?"vec2":"float",s="value";return e.outputs.add(s,r),i.main.add(A`${s} = ${r}(0.0);`),e}const MYt=Object.freeze(Object.defineProperty({__proto__:null,build:hWe},Symbol.toStringTag,{value:"Module"}));let dWe=class extends er{constructor(e,i){super(e,i,new Hi(MYt,()=>W(()=>Promise.resolve().then(()=>Zri),void 0)),wn),this.primitiveType=Sr.TRIANGLE_STRIP}initializePipeline(e){const i={r:e.index===0,g:e.index===1,b:!1,a:!1};return _i({blending:null,colorWrite:i,depthTest:null,depthWrite:null})}},wc=class extends be{updateDepthRange(e){this._depthRange.equals(e)||(this._depthRange=e)}constructor(e,i,r,s,n,a){super({}),this.fbos=e,this._techniques=i,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=a,this._primarySet=new CEe(new koe(0),()=>this._requestRenderIfEnabled()),this._contextSet=new CEe(new koe(1),()=>this._requestRenderIfEnabled()),this._passParameters=new Ppe,this._depthRange=$o.Zero,this._previewing=!1,this._shadowAccumulatorKey=Symbol("shadowAccumulator"),this._rctx=e.rctx,this._bindParameters=new pfe(new ffe(e,r.viewingMode)),this._bindParameters.shadowMap.enabled=!0,this._vao=H1(this._rctx),this._accumulationRenderer=new v8(i,this._rctx,this,a);const o=this._stage.view.resourceController.scheduler;this.addHandles([o.registerTask(Tt.SHADOW_ACCUMULATOR,this),X(()=>this._previewing,()=>this._requestRenderIfEnabled(),Ht),X(()=>this._numActive===2,()=>this._numActiveChanged(),Ht),X(()=>this._depthRange,()=>this._invalidateAccumulationSets(),Ht)],this._shadowAccumulatorKey);for(const l of this._accumulationSets())l.precompile(i)}*_accumulationSets(){yield this._primarySet,yield this._contextSet}normalizeCtorArgs(){return{}}destroy(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=jt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=jt(this._fbo),this._vao=jt(this._vao);for(const e of this._accumulationSets())e.destroy();this._contextSet=null,this._primarySet=null,this._bindParameters.destroy()}get computedSamples(){return[this._primarySet.progress,this._contextSet.progress]}get shadowCastTexture(){return this._fbo?.colorTexture}get accumulating(){return this.active&&this._previewing||this._refining}get _refining(){return this.active&&!this._doneAccumulating&&!this._previewing}get active(){return this._fbo!=null&&[...this._accumulationSets()].some(e=>e.active)}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==$o.Zero&&this._opacityFromElevation>cWe}get _doneAccumulating(){return[...this._accumulationSets()].every(e=>e.doneAccumulating)}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get _numActive(){return[...this._accumulationSets()].reduce((e,i)=>e+(i.active?1:0),0)}get _pixelFormat(){return this._numActive===2?{pixelFormat:33319,internalFormat:ot.RG8}:{pixelFormat:6403,internalFormat:ot.R8}}get readyToRun(){return this._refining&&this.canAccumulate&&[...this._accumulationSets()].some(e=>e.running)}runTask(e){this._clearBuffersOnAccumulationStart(),this._prepareForShadowMapPass(this._bindParameters);let i=!1;for(const r of this._accumulationSets())this._runTaskForSet(r,e)&&(i=!0);i&&this._requestRender()}_runTaskForSet(e,i){let r=!1;for(;!i.done&&!e.doneAccumulating;)this._accumulateShadow(e),i.madeProgress(),r=!0;return r}renderAccumulation(e,i,r,s){return this._updateCamera(i),this._bindParameters.contentCamera=r,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!(!this.accumulating||!this.canAccumulate)&&(this._previewing||s?(this._clearFramebuffer(),this._reset()):this._clearBuffersOnAccumulationStart(),this._accumulateSetsForRenderFrame(s))}_clearBuffersOnAccumulationStart(){if([...this._accumulationSets()].every(e=>e.progress===0))this._clearFramebuffer();else for(const e of this._accumulationSets())e.progress===0&&this._clearFramebufferForSet(this._fbo,e)}_accumulateSetsForRenderFrame(e){let i=!1;for(const r of this._accumulationSets())this._accumulateSetForRenderFrame(r,e)&&(i=!0);return i&&this._requestRender(),i}_accumulateSetForRenderFrame(e,i){let r=i?e.sampleCount:Math.min(EYt,e.sampleCount);r-=e.progress;for(let s=0;s<r;++s)this._accumulateShadow(e);return r>0}precompile(){this._accumulationRenderer.precompile()}render(e){this._accumulationRenderer.render(e)}setOptions(e){e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._primarySet.lightDirections=e.lightDirections),e.lightDirectionsContext!==void 0&&(this._contextSet.lightDirections=e.lightDirectionsContext),e.enabled===!0?this._enable():e.enabled===!1&&this._disable(),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){const r=this._primarySet.progress;return!this.active||!this._fbo||r<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,6408,Ns.UNSIGNED_BYTE,$Ee),$Ee[0]/r)}_numActiveChanged(){if(!this._fbo)return;const e=this._numActive===2,i=this._createFBO();i.resize(this._fbo.width,this._fbo.height),e&&(this._clearFramebuffer(i),this._contextSet.reset()),this._fbo.width&&this._fbo.height&&this._rctx.blitFramebuffer(this._fbo,i),this._fbo.dispose(),this._fbo=i,this._requestRender()}_enable(){this._fbo||(this._fbo=this._createFBO(),this._invalidateAccumulationSets())}_createFBO(){const{pixelFormat:e,internalFormat:i}=this._pixelFormat,r=new ar;return r.pixelFormat=e,r.internalFormat=i,r.wrapMode=33071,new U1(this._rctx,r)}_invalidateAccumulationSets(){for(const e of this._accumulationSets())e.reset();this._requestRenderIfEnabled()}_disable(){this._fbo&&(this._fbo=jt(this._fbo),this._requestRender())}_reset(){for(const e of this._accumulationSets())e.reset()}_clearFramebuffer(e=this._fbo){e&&e.width&&e.height&&(this._rctx.bindFramebuffer(e),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(16384))}_clearFramebufferForSet(e,i){if(!e)return;const r=this._techniques.get(dWe,i.configuration);this._rctx.bindFramebuffer(e),this._rctx.bindTechnique(r,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,this._vao.vertexCount("geometry"))}_accumulateShadow(e){this._renderToShadowMap(this._bindParameters,e.lightDirections[e.progress++],this._depthRange);const i=this._techniques.get(uWe,e.configuration);this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(i,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,this._vao.vertexCount("geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-lO($Yt,CYt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};c([p()],wc.prototype,"_fbo",void 0),c([p()],wc.prototype,"_depthRange",void 0),c([p()],wc.prototype,"_previewing",void 0),c([p()],wc.prototype,"_accumulationRenderer",void 0),c([p()],wc.prototype,"_refining",null),c([p()],wc.prototype,"active",null),c([p()],wc.prototype,"canAccumulate",null),c([p()],wc.prototype,"_doneAccumulating",null),c([p()],wc.prototype,"_opacityFromElevation",null),c([p()],wc.prototype,"_numActive",null),c([p()],wc.prototype,"_pixelFormat",null),c([p()],wc.prototype,"readyToRun",null),wc=c([R("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],wc);const EYt=6,$Ee=new Uint8Array(4);let CEe=class{constructor(e,i){this.configuration=e,this._notifyChange=i,this._cachedLightDirections=[],this._progress=ta(0),this._sampleCount=ta(0)}get progress(){return this._progress.value}set progress(e){this._progress.value=e}get sampleCount(){return this._sampleCount.value}get doneAccumulating(){return this.progress>=this.sampleCount}get running(){return this.progress>0}get active(){return this.sampleCount>0}get lightDirections(){return this._cachedLightDirections}set lightDirections(e){const i=this._cachedLightDirections,r=Math.min(nz,e.length);if(!JOe(i,0,i.length,e,0,r,m1)){i.length=r,this._sampleCount.value=r;for(let s=0;s<r;++s)i[s]=me(i[s]??I(),e[s]);this.reset(),this._notifyChange()}}destroy(){this._cachedLightDirections.length=0,this._sampleCount.value=0}reset(){this.progress=0}precompile(e){e.precompile(uWe,this.configuration),e.precompile(dWe,this.configuration)}};const AYt=n_();let OYt=class{constructor(){this._plane=n_(),this._isDecoration=!0}get plane(){return this._plane}get isDecoration(){return this._isDecoration}update({plane:e,isDecoration:i}){let r=!1;return this._isDecoration!==i&&(this._isDecoration=i,r=!0),e??=AYt,Uje(e,this._plane)?r:(A$(e,this._plane),!0)}},MEe=class{constructor(e,i,r,s,n,a,o,l,u){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=a,this.endTimeElapsed=o,this.createTimestamp=l,this.timestampBits=u}},$v=!1;function PYt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new MEe(()=>t.createQuery(),r=>{t.deleteQuery(r),$v=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{$v||($v=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),$v=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new MEe(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),$v=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{$v||($v=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),$v=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function RYt(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new IYt(i,e)}let IYt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){$v||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};const hn={OVERLAY:"overlay",PREPARE:"prepare",SHADOW_MAP:"shadow map",DEPTH:"depth",ACCUMULATED_SHADOWS:"accumulated shadows",APPLY_ACCUMULATED_SHADOWS:"apply accumulated shadows",OBJECT_AND_LAYER_ID_COLOR:"object/layer id color",NORMALS:"normals",SSAO:"SSAO",HIGHLIGHTS:"highlights",OPAQUE_EDGES:"opaque edges",VOXEL:"voxel",TRANSPARENT:"transparent",TRANSPARENT_EDGES:"transparent edges",HUD_VISIBILITY:"HUD visibility",TRANSPARENT_TERRAIN:"transparent terrain",TRANSPARENT_MATERIAL_WITHOUT_DEPTH:"transparent material without depth",OPAQUE_ENVIRONMENT:"opaque environment",TRANSPARENT_ENVIRONMENT:"transparent environment",OCCLUDED:"occluded",HUD:"HUD",HUD_OCCLUDED:"HUD occluded",FINISH:"finish",FOCUS_AREA_MASK:"focus area mask"},YK=Object.values(ps).concat(Object.values(wt)).concat(Object.values(hn)),EEe="Total";let DYt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new o0(EEe),this._cpuTimeSamplers=new Map(YK.map(i=>[i,new o0(i)])),this._enableGPUTimer=0,this._totalGPUTime=new o0("GPU"),this._gpuTimeSamplers=new Map(YK.map(i=>[i,new o0(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...YK,EEe];this._gpuTimerPool=RYt(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=jt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&(this._gpuTimeSamplers.forEach(e=>e.push(0)),this._gpuTimerPool.start())}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).push(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).set(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(hn.FINISH);this._gpuTimeSamplers.get(hn.FINISH).set(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.push(e),this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},G3=class extends o5{constructor(e,i,r,s,n,a){super({stage:e}),this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=a,this._pluginsHas={hudElements:!1,water:!1},this.renderPassManager=new Ooe,this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=$i(0,0,0,1),this._sliceHelper=new OYt,this._blit=null,this._oitblend=null,this.sceneDepthRange=ta($o.Infinite),this._state=ta(2),this._highQualityTransparencyEnabled=!0,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new JZt,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=ta(0),this._lastFrameTime=0,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new yYt,this._releaseNormals=o=>{o.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this._fboCache=new FZt(s),this._renderStateFeatures=ta(SEe(!ie("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._framebuffer=new gYt(this.fboCache),this._performanceInfo=new DYt(this._rctx),this._shadowMap=new ffe(this.fboCache,e.viewingMode),this._shadowAccumulator=new wc(this.fboCache,r,e,o=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(o.camera,o.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(o,l,u)=>{const d=e.view.qualitySettings.maximumPixelRatio;o.shadowMap.start(o.camera,l,u,!0,d),this._renderShadowCascades(4,o.shadowMap),o.shadowMap.finish(),o.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(o.camera,o.contentCamera)},a),this._renderContext=new W9e(this._rctx,this._shadowMap,r),this._nodes=new qZt(this._renderContext),this._plugins=new GZt({renderContext:this._renderContext,techniques:r,materials:i,requestRender:a,controller:e,fbos:this.fboCache,isFeatureEnabled:o=>this.isFeatureEnabled(o)}),this._plugins.add(this.renderPassManager),this.addHandles([X(()=>e.view.state.camera,()=>a(),bt),X(()=>bn.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,o=>{this._renderHiddenTransparentEdges=o?()=>this._renderEdges(0):()=>{},a()},Yt),X(()=>e.view.environment.background?.color,o=>{const l=o?Dfe(o):Tn;Or(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),a()},bt),X(()=>e.view.state.camera.relativeElevation,o=>this._inGlobeView=(o??1/0)>=BG,bt),X(()=>this._bindParameters.clouds.fadeFactor,()=>{this._bindParameters.fadeLighting(),this._requestRender(2)},Ht),X(()=>this._bindParameters.clouds.data?.state,()=>a(),Ht),X(()=>e.view.state.highlights,o=>{this._bindParameters.highlights=o,a()},Yt)])}destroy(){this._gpuTimerHandle=Xi(this._gpuTimerHandle),this._nodes.destroy(),this._framebuffer.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.destroy(),this._shadowAccumulator=null,this._loadEdgeViewTask=Rs(this._loadEdgeViewTask),this._edgeView=Pe(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this._fboCache.destroy(),this._fboCache=null,this._plugins.destroy(),this._plugins=null,this._pluginInput=null,this._blit=null,this._oitblend=null,this._compositingHelper=null,this._nodes=null,this._framebuffer=null,this._shadowMap=null,this._renderContext=null,this._performanceInfo=null,iqe.prune(),PE.prune(),DRt()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}get performanceInfo(){return this._performanceInfo}updateRenderFeatures(e=null,i=!ie("disable-feature:high-quality-idle")){this._renderStateFeatures.value=SEe(i,e),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(1)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(5))}get _hasHighlights(){return this._plugins.produces(9,2,4,18,13,14)}hasHighlight(e){return this._plugins.hasHighlight(e)}get _hasHUDHighlights(){return this._plugins.produces(9,13,14)}get hasSSAO(){return(this.stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(4))&&!this._inGlobeView}get hasSMAA(){return this.stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(0)}get hasEmitters(){return this._plugins.hasEmitters&&this.stage.view.qualitySettings.physicallyBasedRenderingEnabled}get fullResolutionAtmosphere(){return this.stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(3)}get fboCache(){return this._fboCache}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Lr(this._bindParameters.ssr.lastFrameColor),this._bindParameters.terrainDepth=Lr(this._bindParameters.terrainDepth),this._bindParameters.geometryDepth=Lr(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=Lr(this._bindParameters.depth),this._bindParameters.hudVisibility=Lr(this._bindParameters.hudVisibility)}get updating(){return this._loadEdgeViewTask&&!this._loadEdgeViewTask.finished||this._edgeView?.updating||this._shadowAccumulator.readyToRun||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=sc(async e=>{const{EdgeView:i}=await W(()=>import("./EdgeView-pj6gTB9Y.js"),__vite__mapDeps([422,27,423,26,28,29]));ct(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this.stage.view.renderSpatialReference,viewingMode:this.stage.view.stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:zYt(this.stage.view.resourceController)});return this.addHandles(X(()=>r.updating,()=>this._requestRender(),Ht)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&pue(this._bindParameters.ssr.reprojectionMatrix,gl)}set _reprojectionMatrix(e){Det(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:i,_bindParameters:r}=this;if(e.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment){e.environment.weather!==void 0&&(this._bindParameters.weather=e.environment.weather);const s=e.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}set slice(e){this._sliceHelper.update(e)&&this._requestRender()}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}commit(e,i){return this._isRendering&&console.warn("Renderer.modify called while rendering"),!!super.commit(e,i,this._plugins.context)&&(this.updateHasFlags(),!0)}rendererAdded(e){this._plugins.add(e)}rendererRemoved(e){this._plugins.remove(e)}get occludedRequiresStencil(){return this.occludedRequiresOccludeeStencil||this.occludedRequiresIntegratedMeshStencil}get occludedRequiresOccludeeStencil(){return this._bindParameters.hasOccludees&&!!(8&this.plugins.renderOccludedFlags)}get occludedRequiresIntegratedMeshStencil(){return this._plugins.produces(0,0)&&this._plugins.produces(0,9)}updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(0,...XI),e.water=this._plugins.produces(3,19),this._bindParameters.hasOccludees=this._plugins.hasOccludees,this._requestRender()}updateAnimation(e,i){this._animationTimer??=new YZt(e.camera,i),this._animationTimer.advance(e.camera,i,this._animationTimeDilation);const r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(this._animationTimer),this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Xi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r,s=!1){try{return this._isRendering=!0,this._render(e,i,r,s)}catch(n){console.error(`Exception during rendering: ${n}`)}finally{this._isRendering=!1}return new QMe(this._pluginInput.get(ps.FINAL),null)}_updateHUDOccludedFragmentOpacity(e,i){const{idleOpacity:r,navigatingOpacity:s,maxDelta:n,tiltFadeStart:a,tiltFadeEnd:o,altitudeStart:l,altitudeEnd:u}=mYt,d=this.stage.view,f=d.stateManager.camera,g=d.qualitySettings.fadeDuration,v=e===2?r:s,_=Ce((f.tilt-a)/(o-a),0,1),x=Ce(((f.position.z??0)-l)/(u-l),0,1),S=yt(yt(1,v,_),1,x),T=this._bindParameters.hudOccludedFragmentOpacity;if(g<=0||T===S||this._lastFrameTime===0||this._lastFrameTime>i)return this._bindParameters.hudOccludedFragmentOpacity=S,void(this._lastFrameTime=i);const M=i-this._lastFrameTime;this._lastFrameTime=i;const E=Math.max(1-r,Math.abs(r-s)),P=Math.min(E*M/g,n);P>=Math.abs(S-T)?this._bindParameters.hudOccludedFragmentOpacity=S:(this._bindParameters.hudOccludedFragmentOpacity=T+Math.sign(S-T)*P,this._requestRender())}_render(e,i,r,s){const n=r===0;this.performanceInfo.startFrame(),this.fboCache.frameStart(),this.fboCache.interactive=n,this._disposeBindBuffers();const{camera:a,contentCamera:o,mode:l,alignPixelEnabled:u}=e;this._state.value=l;const d=this._nodes.produces("magnifier-color"),f=this._nodes.produces(ps.FINAL),g=this.hasEmitters,v=g?1:0;this._renderContext.time=i,this._renderContext.output=v,this._bindParameters.oitPass=0,this._bindParameters.alignPixelEnabled=u,this._bindParameters.decorations=!s,this._bindParameters.mainDepth=null;const _=!s||!this._sliceHelper.isDecoration;this._bindParameters.slicePlane=_?this._sliceHelper.plane:null,this._bindParameters.viewshedEnabled=this._nodes.produces(wt.VIEWSHED),this._bindParameters.cutFillEnabled=this._nodes.produces(wt.CUTFILL_DEPTH),this._renderOverlay(),a.setGLViewport(this._rctx);const x=this._framebuffer,S=x.initialize(a.fullWidth,a.fullHeight,this._backgroundColor,g);this.hasReflections?(S?.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=S):S?.release(),this._ensureBindParametersCamera(a,o),this._updateHUDOccludedFragmentOpacity(l,i),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!s;const T=this._highQualityTransparency&&this._hasTransparentTerrain,M=this._plugins.produces(0,...QI);this._precompilePrepasses(),this.performanceInfo.advance(hn.PREPARE);const E=this._computeShadowDepthRange(a);this._renderShadowMap(a,this._bindParameters.lighting.mainLight.direction,E),this._pluginInput.set("normals",this._renderNormals()),this._renderRemainingGeometryDepth(),this._renderShadowAccumulation(E,a,o,!n),this._ensureBindParametersSSR(i),this._precompileShaders(T,M,v),this._renderContext.output=v,x.bind(),this._bindParameters.mainDepth=x.depth.attachment,this._renderOpaque(T),this._renderTransparent(M,T,v),this._shadowMap.disposeMainBuffer(),this._pluginInput.set(wt.FOCUSAREA,this._renderFocusAreaGeometry()),this._pluginInput.set(wt.CUTFILL_DEPTH,this._renderCutFillDepth()),x.update(B=>this._renderNodes(wt.TRANSPARENT_ENVIRONMENT,B)),x.update(B=>this._renderNodes(wt.VIEWSHED,B)),x.update(B=>this._renderNodes(wt.LASERLINES,B)),x.update(B=>this._renderNodes(wt.FOCUSAREA_COLOR,B)),this._pluginInput.release(wt.FOCUSAREA),this._pluginInput.release(wt.CUTFILL_DEPTH),x.update(B=>this._renderNodes(wt.OCCLUDED,B)),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._renderHighlightShadowMap(a,this._bindParameters.lighting.mainLight.direction,E);const P=r===2?this._renderObjectAndLayerIdColor():null;x.update(B=>this._renderNodes(ps.COMPOSITE,B)),this._shadowMap.disposeOffscreenBuffers();const O=n&&!f&&!(d&&!s),D=this._pluginInput.get(ps.COMPOSITE),L=O?eP:this.fboCache.acquire(D.fbo.width,D.fbo.height,wt.ANTIALIASING),F=this._nodes.produces(wt.ANTIALIASING)?this._renderNodes(wt.ANTIALIASING,L):this.blitFBO(D,L,!1);let j;this._pluginInput.set(wt.ANTIALIASING,F),this._hasHUDHighlights?(this._renderHUD(1,F,v),j=this._renderNodes(wt.HIGHLIGHTS,F)):(j=this._renderNodes(wt.HIGHLIGHTS,F),this._renderHUD(1,j,v));const N=this._renderNodes(wt.MAGNIFIER,j);return n&&d&&!s&&!f&&this.blitFBO(N),f?(N.attachDepth(x.depth),this.blitFBO(this._renderNodes(ps.FINAL,N)),N.detachDepth()):this._pluginInput.set(ps.FINAL,N),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),x.releaseDepth(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),n||(this._releaseFBOs(),this._disposeOffscreenBuffers()),new QMe(this._pluginInput.get(ps.FINAL),P)}_precompileShaders(e,i,r){++this._plugins.context.techniques.precompiling,this._renderContext.output=r,this._precompileOpaqueGeometry(),this._nodes.precompile(wt.OPAQUE_ENVIRONMENT),this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,this._renderContext.output=2,this._plugins.precompile(6),this._plugins.precompile(7),e&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry()),this._renderContext.output=r,this._plugins.precompile(6),this._plugins.precompile(7),i&&(this._precompileTransparentGeometry(),this._hasTransparentTerrain&&(this._bindParameters.cullAboveTerrain=!1,this._precompileTransparentGeometry(),this._bindParameters.cullAboveTerrain=e)),this._nodes.precompile(wt.FOCUSAREA),this._needsHUDVisibility&&this._plugins.precompile(12),this._plugins.precompile(15),this._precompileHUD(0),this._bindParameters.terrainDepthTest=!1,this._bindParameters.cullAboveTerrain=!1,this._nodes.precompile(wt.VIEWSHED,wt.CUTFILL_DEPTH,wt.CUTFILL_COLOR,wt.LASERLINES,wt.FOCUSAREA_COLOR,wt.OCCLUDED,wt.ANTIALIASING,wt.HIGHLIGHTS);const s=this._bindParameters;s.highlightMixTexture=s.highlights.length>1?this._rctx.emptyTexture:null,this._precompileHUD(1),this._hasHighlights&&(s.highlights.forEach((n,a)=>{s.highlightLevel=a,this._precompileAllGeometry(9)}),s.highlightLevel=null),s.highlightMixTexture=null,this._nodes.precompile(ps.COMPOSITE,wt.MAGNIFIER),this._shadowAccumulator.precompile(),this._plugins.precompile(8),--this._plugins.context.techniques.precompiling}_renderFocusAreaGeometry(){const e=this._nodes.produce(wt.FOCUSAREA,this._pluginInput);return e&&this.performanceInfo.advance(hn.FOCUS_AREA_MASK),e}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;const e=this._renderContext.output;++this._techniques.precompiling;const i=this._framebufferSize;let r=this.fboCache.acquire(i.width,i.height,"olid");return r.acquireDepth(13),r=this._nodes.render(r,this._pluginInput),--this._techniques.precompiling,this.performanceInfo.advance(hn.OBJECT_AND_LAYER_ID_COLOR),this._renderContext.output=e,r}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===0;if(r||i){const s=r?this.performanceInfo.elapsedTime:0;let n=0;i?n=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();const a=Math.max(s,n);this._animationTimestep.frame(a,r)}}readMainDepth(e,i){const{mainDepth:r,camera:s}=this._bindParameters;if(!r)return;const n=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear depth");this._rctx.bindFramebuffer(n.fbo),s.setGLViewport(this._rctx),this._rctx.setScissorRect(e[0],e[1],e[2],e[3]),this._rctx.setScissorTestEnabled(!0),this._rctx.clearFramebuffer(Tn),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,r),this._rctx.setScissorTestEnabled(!1),this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width),n.fbo?.readPixels(e[0],e[1],e[2],e[3],6408,Ns.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){this._bindParameters.hudVisibility?.fbo?.readPixels(e,i,r,s,6408,Ns.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_renderEdges(e){const i=this._edgeView;if(!i?.shouldRender())return;const r=this._renderContext.output,s=this._framebufferSize,n=this.fboCache.acquire(s.width,s.height,"edges"),a=()=>i.render(this._bindParameters,e),o=this._bindParameters.geometryDepth;this.renderToTargets(a,n,o??this._framebuffer.depth,Tn),this._framebuffer.bind(),this._compositingHelper.composite(this._bindParameters,n.getTexture(),aA(r)?1:0),n.release(),this.performanceInfo.advance(e===1?hn.OPAQUE_EDGES:hn.TRANSPARENT_EDGES)}_renderOverlay(){this._bindParameters.overlay=this.overlay?.render(),this._bindParameters.overlay&&this.performanceInfo.advance(hn.OVERLAY)}_renderShadowMap(e,i,r){if(!this.shadowsEnabled)return;const{contentCamera:s}=this._bindParameters,n=this._shadowMap;n.start(e,i,r,this.isFeatureEnabled(6),this.stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(6,this._shadowMap),n.copySnapshot(1),this._renderShadowCascades(5,this._shadowMap)):this._renderShadowCascades(4),n.finish(),e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,s),this.performanceInfo.advance(hn.SHADOW_MAP)}_renderHighlightShadowMap(e,i,r){if(!this.shadowsEnabled||!this._needsShadowHighlight)return;const{contentCamera:s}=this._bindParameters,n=this._shadowMap;n.start(e,i,r,this.isFeatureEnabled(6),this.stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(5,this._shadowMap),n.moveSnapshot(0),n.finish(),e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,s),this.performanceInfo.advance(hn.SHADOW_MAP)}_renderCutFillDepth(){return this._nodes.produce(wt.CUTFILL_DEPTH,this._pluginInput)}_precompileShadowCascades(e){for(const i of this._shadowMap.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._precompileAllGeometry(e)}_renderShadowCascades(e,i=this._shadowMap){i.bindFbo();for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this.renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(2)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._shadowAccumulator.active||this._debugNeedsDepth}_renderRemainingGeometryDepth(){const e=this._pluginInput.get("normals");e?(this._pluginInput.set(wt.SSAO,this._renderSSAO()),this._needsDepth?(this._rctx.bindFramebuffer(e.fbo),this._rctx.clear(1024),this._renderGeometryWithoutNormals(2),Lr(this._bindParameters.depth),this._bindParameters.depth=e.obtainDepthTexture(),this.performanceInfo.advance(hn.DEPTH)):(e.detachDepth(),this._bindParameters.depth=Lr(this._bindParameters.depth)),this.hasSSAO&&this._pluginInput.release("normals")):this._renderAllGeometryDepth()}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=Lr(this._bindParameters.depth));const e=this._framebufferSize,i=this.fboCache.acquire(e.width,e.height,"geometry depth",13);this._rctx.bindFramebuffer(i.fbo),this._rctx.clear(1280),this.renderAllGeometry(2),Lr(this._bindParameters.depth),this._bindParameters.depth=i.obtainDepthTexture(),i.release(),this.performanceInfo.advance(hn.DEPTH)}_renderTerrainDepth(e){if(this._bindParameters.terrainDepthTest=e,this._bindParameters.cullAboveTerrain=e,!e)return void(this._bindParameters.terrainDepth=Lr(this._bindParameters.terrainDepth));const i=this._renderContext.output;this._renderContext.output=2;const r=this._framebufferSize,s=this.fboCache.acquire(r.width,r.height,"terrain depth",13);this._rctx.bindFramebuffer(s.fbo),this._rctx.clear(1280),this._renderTransparentTerrain(),Lr(this._bindParameters.terrainDepth),this._bindParameters.terrainDepth=s.obtainDepthTexture(),this._renderContext.output=i,s.release()}_renderGeometryDepth(e){if(!e)return void(this._bindParameters.geometryDepth=Lr(this._bindParameters.geometryDepth));const i=this._renderContext.output,{width:r,height:s}=this._framebufferSize,n=this.fboCache.acquire(r,s,"geometry depth",13);this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(1280),this._renderOpaqueAndTransparentGeometry(2),this._renderContext.output=i,Lr(this._bindParameters.geometryDepth),this._bindParameters.geometryDepth=n.obtainDepthTexture(),n.release()}get _needsShadowDepthRange(){return this._shadowMap.enabled||this._shadowAccumulator.active}_computeShadowDepthRange(e){if(!this._needsShadowDepthRange)return $o.Zero;const i=bEe(e,this._plugins.plugins,this.stage.layers,0);return i.union(this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}updateSceneDepthRange(e){if(!this.stage.view.state.isGlobal)return void(this.sceneDepthRange.value=$o.Infinite);if((this.stage.view.renderCoordsHelper?.getAltitude(e.eye)??0)<iae)return void(this.sceneDepthRange.value=$o.Infinite);const i=e.clone();i.near=vH,i.far=1e10;const r=bEe(i,this._plugins.plugins,this.stage.layers,1);r.union(this._plugins.queryDepthRange(i)),this.sceneDepthRange.value.equals(r)||(this.sceneDepthRange.value=r)}get _normalsRequired(){const e=this._nodes.require("normals",ps.FINAL,ps.COMPOSITE,ps.OPAQUE,ps.TRANSPARENT,wt.VIEWSHED,wt.LASERLINES);return(this.hasSSAO?1:0)+e}_precompilePrepasses(){this._normalsRequired&&this._precompileAllGeometry(3),this._needsDepth&&this._precompileAllGeometry(2),this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(5),this._precompileShadowCascades(6),this._precompileShadowCascades(5)):this._precompileShadowCascades(4)),this._shadowAccumulator.active&&this._precompileAllGeometry(4)}_renderNormals(){const e=this._normalsRequired;if(e===0)return;const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"normals",5);r.acquireDepth(13),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(Tn,!0,!0),this._renderGeometryWithNormals(3);const s=this._nodes.optional("normals",ps.FINAL,ps.COMPOSITE,ps.OPAQUE,ps.TRANSPARENT,wt.VIEWSHED);return r.retain(e+s-1),this.performanceInfo.advance(hn.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return;const i=this._nodes.produce(wt.SSAO,this._pluginInput);return this._bindParameters.ssao=i,i&&this.performanceInfo.advance(hn.SSAO),i}_precompileAllGeometry(e){const i=this._renderContext.output;this._renderContext.output=e,this._precompileOpaqueGeometry(),this._precompileTransparentGeometry(),this._plugins.precompile(6),this._plugins.precompile(7),this._renderContext.output=i}renderAllGeometry(e){this._renderContext.output=e,this._renderOpaqueAndTransparentGeometry(e),this._renderTransparentTerrain()}precompileSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.precompile(this._renderContext)}precompileOccludedSlots(e,i){for(const r of i)this._renderContext.renderOccludedMask=r,this.precompileSlots(e,...AEe);this._renderContext.renderOccludedMask=TL}renderSlots(e,...i){for(const r of i)this._bindParameters.slot=r,e.forAll(s=>{const n=s.acquireTechniques(this._renderContext);n&&s.render(this._renderContext,n)})}renderOccludedSlots(e,i){this._renderContext.renderOccludedMask=i,this.plugins.renderOccludedFlags>1&&this._plugins.render(9),this.renderSlots(e,...AEe),this._renderContext.renderOccludedMask=TL}renderHUD(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(13)}precompileViewshedShadowMap(){this._precompileAllGeometry(7)}precompileCutFill(){const i=this._renderContext.output;this._renderContext.output=8,this._plugins.precompile(0,1,6),this._renderContext.output=i}renderViewshedShadowMap(e){const{camera:i,contentCamera:r}=this._bindParameters,s=this._renderContext.output;e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,e),this.renderAllGeometry(7),this._ensureBindParametersCamera(i,r),this._bindParameters.camera.setGLViewport(this._rctx),this._renderContext.output=s}renderCutFillReferenceDepth(e){const{camera:i,contentCamera:r}=this._bindParameters,s=this._renderContext.output;e.setGLViewport(this._rctx),this._ensureBindParametersCamera(e,e),this._renderContext.output=8,this._plugins.render(0,1),this._plugins.render(6),this._ensureBindParametersCamera(i,r),i.setGLViewport(this._rctx),this._renderContext.output=s}_renderOpaqueAndTransparentGeometry(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderGeometryWithNormals(e){this._renderContext.output=e,this._plugins.render(...kYt),this._renderTransparentTerrain()}_renderGeometryWithoutNormals(e){this._renderContext.output=e,this._plugins.render(...LYt)}_precompileOpaqueGeometry(){this._plugins.precompile(...JK),this._nodes.precompile("opaque-color")}_renderOpaqueGeometry(){this._plugins.render(...JK)}_renderTransparentGeometry(){this._plugins.render(...QI)}get _hasTransparentTerrain(){return this._plugins.produces(0,6)}get _hasTransparentIntegratedMesh(){return this._plugins.produces(this._renderContext.output,7)}_renderTransparentTerrain(){const e=()=>this._plugins.render(6);if(!Ps(this._renderContext.output))return void e();const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent terrain");return this.renderToTargets(e,r,this._framebuffer.depth,Tn),r}_renderTransparentIntegratedMesh(){const e=()=>this._plugins.render(7);if(!Ps(this._renderContext.output))return void e();const i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent integrated mesh");return this.renderToTargets(e,r,this._framebuffer.depth,Tn),r}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,12)}_renderHUDVisibility(){if(!this._needsHUDVisibility)return void(this._bindParameters.hudVisibility=Lr(this._bindParameters.hudVisibility));const{width:e,height:i}=this._framebufferSize;let r=this._bindParameters.hudVisibility;r?.fbo?.width===e&&r?.fbo?.height===i||(r?.release(),r=this.fboCache.acquire(e,i,"hud visibility",4),this._bindParameters.hudVisibility=r);const s=this._bindParameters.geometryDepth;r.attachDepth(s||this._framebuffer.depth),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer([0,1,0,1]),this._plugins.render(12),r.detachDepth(),this._framebuffer.bind(),this.performanceInfo.advance(hn.HUD_VISIBILITY)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===0){const i=()=>this._plugins.render(15),r=this._framebufferSize,s=this.fboCache.acquireDepth(12,r.width,r.height,"line callouts");this.renderToTargets(i,this._framebuffer.color,s,void 0,!0,!0),s.release()}else this._plugins.render(15)}_precompileHUD(e){if(this._precompileHUDOutput(e),this._hasHighlights){const i=this._renderContext.output;this._renderContext.output=9,this._precompileHUDOutput(e),this._renderContext.output=i}}_precompileHUDOutput(e){const i=this._bindParameters.hudRenderStyle;this._bindParameters.hudRenderStyle=e,this._oitEnabled&&Ps(this._renderContext.output)?(this._bindParameters.oitPass=1,this._plugins.precompile(...XI),this._bindParameters.oitPass=2,this._plugins.precompile(...XI),this._bindParameters.oitPass=0):this._plugins.precompile(...XI),this._bindParameters.hudRenderStyle=i}_renderHUD(e,i,r){if(this._pluginsHas.hudElements){if(this._oitEnabled){const s=this._renderOIT(1,r,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,s.getTexture(),0),s.release()}else if(this._renderContext.output=r,e===0){const s=()=>this._renderHUDElements(e),n=this._framebufferSize,a=this.fboCache.acquireDepth(12,n.width,n.height,"hud");this.renderToTargets(s,this._framebuffer.color,a,void 0,!0,!0),a.release()}else i.acquireDepth(12),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===0?hn.HUD_OCCLUDED:hn.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.render(...XI)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(5,2)}_renderHighlightPrepass(){if(!this._hasHighlights)return;const{fboCache:e,_rctx:i,_bindParameters:r}=this,s=this._framebufferSize,{highlights:n}=r,a=e.acquire(s.width,s.height,"highlights",n.length>hfe?3:1);a.acquireDepth(13);const o=this._plugins.produces(9,0);return o&&this._framebuffer.color.fbo&&a.fbo&&i.blitFramebuffer(this._framebuffer.color.fbo,a.fbo,1024),i.bindFramebuffer(a.fbo),i.gl.clearBufferuiv(6144,0,[0,0,0,0]),o||i.clear(1024),this._renderContext.output=9,i.bindFramebuffer(a.fbo),O9e(i,e,s,r,()=>this._renderHighlightGeometries()),a.detachDepth(),this.performanceInfo.advance(hn.HIGHLIGHTS),a}_renderHighlightGeometries(){this._plugins.render(...FYt),this._rctx.clear(256),this._renderHUDElements(2)}_renderShadowAccumulation(e,i,r,s){this._shadowAccumulator.updateDepthRange(e),this._shadowAccumulator.accumulating&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,i,r,s)&&this.performanceInfo.advance(hn.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){this._oitEnabled&&Ps(this._renderContext.output)?(this._bindParameters.oitPass=1,this._plugins.precompile(...QI),this._bindParameters.oitPass=2,this._plugins.precompile(...QI),this._bindParameters.oitPass=0):this._plugins.precompile(...QI)}_renderOIT(e,i,r=2){const s=e===1,n=this._framebufferSize,a=s?this.fboCache.acquire(n.width,n.height,"oit hud composite"):null,o=s?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),l=this._bindParameters,u=this._renderContext.output;this._renderContext.output=i,l.oitPass=1;const d=a?"oit hud color+alpha":"oit color+alpha",f=this.fboCache.acquire(n.width,n.height,d,8),g=i===1;g&&f.acquireColor(vl,8,"oit emissive"),f.acquireColor(g?ihe:vl,7),a||f.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(f.fbo),this._rctx.clearFramebuffer([0,0,0,1]),g&&this._rctx.clearBuffer(1,oW),o(),f.detachDepth(),l.oitPass=2;const v=this.fboCache.acquire(n.width,n.height,a?"oit hud front":"oit front");return g&&v.acquireColor(vl,8,"oit emissive front"),a?v.acquireDepth(12):v.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(v.fbo),this._rctx.clearFramebuffer(Tn,!!a),o(),v.detachDepth(),l.oitPass=0,a?(this._rctx.bindFramebuffer(a.fbo),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clear(16384)):this._framebuffer.bind(),this._oitblend??=new ZZt(this._techniques),this._oitblend.blend(this._rctx,f,v,l,g,!s),a?.detachDepth(),v.release(),f.release(),this._renderContext.output=u,a}_renderOpaque(e){const i=this.plugins.produces(0,...JK);if(i){this._plugins.render(0,1);const s=this._framebuffer;s.update(n=>this._renderNodes(wt.CUTFILL_COLOR,n)),s.update(n=>this._renderNodes(wt.OPAQUE_TERRAIN,n)),s.bind(),this._plugins.render(2,3)}const r=this._framebuffer;this._renderTerrainDepth(e),r.update(s=>this._renderNodes(ps.OPAQUE,s,i)),this.fboCache.debugCallback?.(ps.OPAQUE,r.color.fbo),r.update(s=>this._renderNodes(wt.OPAQUE_ENVIRONMENT,s)),this.fboCache.debugCallback?.(wt.OPAQUE_ENVIRONMENT,r.color.fbo),this._renderEdges(1)}_renderTransparent(e,i,r){const s=this._framebuffer;s.bind(),this._renderPlugins(20,hn.VOXEL),this._renderHiddenTransparentEdges(),e&&(this._oitEnabled?this._renderOIT(0,r):this._renderTransparentGeometry()),s.update(o=>this._renderNodes(ps.TRANSPARENT,o,e)),this.fboCache.debugCallback?.(ps.TRANSPARENT,s.color.fbo),this._renderGeometryDepth(i),this._renderHUDVisibility(),i||this._plugins.render(15),this._renderEdges(0);const n=this._hasTransparentTerrain?this._renderTransparentTerrain():null;n&&(this.performanceInfo.advance(hn.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(i?this._renderLineCallouts(0):(this._rctx.bindFramebuffer(this._bindParameters.hudVisibility?.fbo),this._compositingHelper.compositeHUD(this._bindParameters,n.getTexture())),this._renderHUD(0,s.color,r))),this._bindParameters.cullAboveTerrain=!1,n&&(s.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,n.getTexture(),aA(r)?1:0),n.release(),i&&(this._renderEdges(1),e&&(this._oitEnabled?this._renderOIT(0,r):this._renderTransparentGeometry(),this.performanceInfo.advance(hn.TRANSPARENT)),this._renderEdges(0)));const a=this._hasTransparentIntegratedMesh?this._renderTransparentIntegratedMesh():null;a&&(s.bind(),this._compositingHelper.composite(this._bindParameters,a.getTexture(),aA(r)?1:0),a.release()),this._bindParameters.ssao=Lr(this._bindParameters.ssao),i&&this._renderLineCallouts(1),this._bindParameters.terrainDepthTest=!1,this._renderTransparentEnvironment()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this.performanceInfo.advance(hn.APPLY_ACCUMULATED_SHADOWS),this._framebuffer.bind(),this._plugins.render(8),this.performanceInfo.advance(hn.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(i.setName(e),this._pluginInput.set(e,i),!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}blitFBO(e,i=eP,r=!0){return this._blit??=new Ffe(this._techniques),this._blit.blit(this._rctx,e,i,this._bindParameters),this._pluginInput.set(e.name,i),r&&e.release(),i}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=gl:(Kl(PEe,this._bindParameters.camera.viewMatrix),Kl(OEe,this._bindParameters.camera.projectionMatrix),Cn(xM,PEe,OEe),Cn(xM,this._renderContext.lastFrameCamera.viewMatrix,xM),Cn(xM,this._renderContext.lastFrameCamera.projectionMatrix,xM),this._reprojectionMatrix=xM);const i=this.stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=gl,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}updateLighting(e,i,r,s){this._bindParameters.updateLighting(e,i,r,s),this._requestRender(1)}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}renderToTargets(e,i,r,s,n=!1,a=!1){i.attachDepth(r),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(s,n,a),e(),i.detachDepth()}get test(){}};c([p({readOnly:!0})],G3.prototype,"fullResolutionAtmosphere",null),c([p()],G3.prototype,"_edgeView",void 0),c([p()],G3.prototype,"updating",null),G3=c([R("esri.views.3d.webgl-engine.lib.Renderer")],G3);const kYt=[0,1,2,4],LYt=[3,5],JK=[0,1,2,3],QI=[4,5],AEe=[2,4,8],XI=[16,13,14],FYt=[4,5,2,3,6,0,1],OEe=ut(),PEe=ut(),xM=ut();function zYt(t){return e=>t.immediate.schedule(e)}let NYt=class{constructor(e){this._rctx=e,this._vao=VYt(e)}destroy(){this._vao=jt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Sr.TRIANGLES,0,3))}get test(){}};function VYt(t){const e=new Float32Array([-1,-1,3,-1,-1,3]);return new bm(t,new vn(t,Rde,e))}let jYt=class{constructor(e,i){this._rctx=e,this._layout=i,this._cache=new tz(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new bm(this._rctx,new vn(this._rctx,this._layout)),r.buffer()?.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.getByteLength("geometry").toString();this._cache.put(i,e)}},pWe=class fWe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=fWe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return id.createIndex(this._rctx,35044,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,34963),this._rctx.drawElements(Sr.POINTS,1,Di.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},REe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this.blendEquation={mode:32774,modeAlpha:32774},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=1029,this.frontFace=2305,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=513,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:1032,func:519,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[WM],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},UYt=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<mn.COUNT;)this._current.push(0)}increment(e,i,r=1){this._current[e]+=r,this._allocations?.add(i)}decrement(e,i,r=1){this._current[e]-=r,this._allocations?.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<mn.UNCOUNTED?i:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<mn.COUNT;++i){const r=this._current[i];r>0&&(e+=`${Bet(mn,i)}: ${r}
`)}}return e+=this._allocations?.resetLog(),e}},IEe=class{constructor(e,i,r){const s=i.textureFilterAnisotropic;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS);const n=r.maxAnisotropy;this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPreferredTexturePixels=r.maxPreferredTexturePixels,this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const BYt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],qYt=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","usampler1D","usampler2D","usampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],DEe=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],GYt=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var nf=999,kEe=9999,QK=0,XK=1,LEe=2,FEe=3,zEe=4,f6=5,HYt=6,WYt=7,ZYt=8,NEe=9,YYt=10,VEe=11,JYt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function QYt(){var t,e,i,r=0,s=0,n=nf,a=[],o=[],l=1,u=0,d=0,f=!1,g=!1,v="";return function(U){return o=[],U!==null?x(U.replace?U.replace(/\r\n/g,`
`):U):S()};function _(U){U.length&&o.push({type:JYt[n],data:U,position:d,line:l,column:u})}function x(U){var Q;for(r=0,i=(v+=U).length;t=v[r],r<i;){switch(Q=r,n){case QK:r=O();break;case XK:r=P();break;case LEe:r=E();break;case FEe:r=D();break;case zEe:r=j();break;case VEe:r=F();break;case f6:r=N();break;case kEe:r=B();break;case NEe:r=M();break;case nf:r=T()}Q!==r&&(v[Q]===`
`?(u=0,++l):++u)}return s+=r,v=v.slice(r),o}function S(U){return a.length&&_(a.join("")),n=YYt,_("(eof)"),o}function T(){return a=a.length?[]:a,e==="/"&&t==="*"?(d=s+r-1,n=QK,e=t,r+1):e==="/"&&t==="/"?(d=s+r-1,n=XK,e=t,r+1):t==="#"?(n=LEe,d=s+r,r):/\s/.test(t)?(n=NEe,d=s+r,r):(f=/\d/.test(t),g=/[^\w_]/.test(t),d=s+r,n=f?zEe:g?FEe:kEe,r)}function M(){return/[^\s]/g.test(t)?(_(a.join("")),n=nf,r):(a.push(t),e=t,r+1)}function E(){return t!=="\r"&&t!==`
`||e==="\\"?(a.push(t),e=t,r+1):(_(a.join("")),n=nf,r)}function P(){return E()}function O(){return t==="/"&&e==="*"?(a.push(t),_(a.join("")),n=nf,r+1):(a.push(t),e=t,r+1)}function D(){if(e==="."&&/\d/.test(t))return n=f6,r;if(e==="/"&&t==="*")return n=QK,r;if(e==="/"&&t==="/")return n=XK,r;if(t==="."&&a.length){for(;L(a););return n=f6,r}if(t===";"||t===")"||t==="("){if(a.length)for(;L(a););return _(t),n=nf,r+1}var U=a.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||U){for(;L(a););return n=nf,r}return a.push(t),e=t,r+1}function L(U){for(var Q,H,J=0;;){if(Q=DEe.indexOf(U.slice(0,U.length+J).join("")),H=DEe[Q],Q===-1){if(J--+U.length>0)continue;H=U.slice(0,1).join("")}return _(H),d+=H.length,(a=a.slice(H.length)).length}}function F(){return/[^a-fA-F0-9]/.test(t)?(_(a.join("")),n=nf,r):(a.push(t),e=t,r+1)}function j(){return t==="."||/[eE]/.test(t)?(a.push(t),n=f6,e=t,r+1):t==="x"&&a.length===1&&a[0]==="0"?(n=VEe,a.push(t),e=t,r+1):/[^\d]/.test(t)?(_(a.join("")),n=nf,r):(a.push(t),e=t,r+1)}function N(){return t==="f"&&(a.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(a.push(t),e=t,r+1):/[^\d]/.test(t)?(_(a.join("")),n=nf,r):(a.push(t),e=t,r+1)}function B(){if(/[^\d\w_]/.test(t)){var U=a.join("");return n=qYt.indexOf(U)>-1?ZYt:GYt.indexOf(U)>-1?WYt:HYt,_(a.join("")),n=nf,r}return a.push(t),e=t,r+1}}function XYt(t){var e=QYt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function KYt(t){return XYt(t)}function eJt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const KK=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function tJt(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const a=n[1].replaceAll(/\s{2,}/g," ");if(a===i)return a;if(a===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+a)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function iJt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function Kk(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,Kk(t,e,r+"_"+e[r],r);return i}function mWe(t,e,i="afterVersion"){function r(l,u){for(let d=u;d<l.length;d++){const f=l[d];if(f.type==="operator"&&f.data===";")return d}return null}function s(l){let u=-1,d=0,f=-1;for(let g=0;g<l.length;g++){const v=l[g];if(v.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(v.data)?++d:/#endif\s*.*/.test(v.data)&&--d),i!=="afterVersion"&&i!=="afterPrecision"||v.type==="preprocessor"&&v.data.startsWith("#version")&&(f=Math.max(f,g)),i==="afterPrecision"&&v.type==="keyword"&&v.data==="precision"){const _=r(l,g);if(_===null)throw new Error("precision statement not followed by any semicolons!");f=Math.max(f,_)}u<f&&d===0&&(u=g)}return u+1}const n={data:`
`,type:"whitespace"},a=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let o=s(t);a(o-1)&&t.splice(o++,0,n);for(const l of e)t.splice(o++,0,l);a(o-1)&&a(o)&&t.splice(o,0,n)}function rJt(t,e,i,r="lowp"){mWe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function sJt(t,e,i,r,s="lowp"){mWe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function nJt(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const a=t[n];if(a.type==="operator"&&(a.data==="["&&(i=n),a.data==="]")){r=n;break}a.type==="integer"&&(s=parseInt(a.data,10))}return i&&r&&t.splice(i,r-i+1),s}function jEe(t,e){if(t.startsWith("#version 300"))return t;const i=KYt(t);if(tJt(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},a={};for(let o=0;o<i.length;++o){const l=i[o];switch(l.type){case"keyword":e===35633&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===35633?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===35632&&l.data==="gl_FragColor"&&(r||(r=Kk(i,n,"fragColor"),rJt(i,r,"vec4")),l.data=r),e===35632&&l.data==="gl_FragData"){const u=nJt(i,o+1),d=Kk(i,n,"fragData");sJt(i,d,"vec4",u,"mediump"),l.data=d}else e===35632&&l.data==="gl_FragDepthEXT"&&(s||(s=Kk(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(BYt.includes(l.data)){if(e===35633&&iJt(i,o))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in a||(a[l.data]=Kk(i,n,l.data)),l.data=a[l.data]}}}for(let o=i.length-1;o>=0;--o){const l=i[o];if(l.type==="preprocessor"){const u=l.data.match(/#extension\s+(.*):/);if(u?.[1]&&KK.has(u[1].trim())){const g=i[o+1];i.splice(o,g&&g.type==="whitespace"?2:1)}const d=l.data.match(/#ifdef\s+(.*)/);d?.[1]&&KK.has(d[1].trim())&&(l.data="#if 1");const f=l.data.match(/#ifndef\s+(.*)/);f?.[1]&&KK.has(f[1].trim())&&(l.data="#if 0")}}return aJt(t,eJt(i))}function aJt(t,e){return e}const oJt=4294967295,lJt=!!ie("esri-tests-disable-gpu-memory-measurements");let cJt=class{constructor(e,i,r,s,n=new Map,a=[]){this._context=e,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=jEe(i,35633),r=jEe(r,35632),this._vShader=UEe(this._context,35633,i),this._fShader=UEe(this._context,35632,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),e.instanceCounter.increment(mn.Shader,this),ise()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=lJt?0:i.length+r.length;const o=this._context.gl,l=o.createProgram();o.attachShader(l,this._vShader),o.attachShader(l,this._fShader),s.forEach((u,d)=>o.bindAttribLocation(l,u,d)),this.hasTransformFeedbackVaryings=!!a?.length,this.hasTransformFeedbackVaryings&&o.transformFeedbackVaryings(l,a,o.SEPARATE_ATTRIBS),o.linkProgram(l),ise()&&!o.getProgramParameter(l,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(l,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[u,d]of n){const f=o.getUniformBlockIndex(l,u);f<oJt&&o.uniformBlockBinding(l,f,d)}this._glName=l,e.instanceCounter.increment(mn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){return!!this._compiled||(this._context.capabilities.parallelShaderCompile&&this.glName!=null?(this._compiled=!!this._context.gl.getProgramParameter(this.glName,37297),this._compiled):(this._compiled=!0,!0))}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(mn.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(mn.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(mn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(mn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(mn.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i,r){KI(r,i);const s=this._nameToUniform1.get(e);s!==void 0&&i===s||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i,r){kd(r,i),Bm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i,r){kd(r,i),Bm(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i,r){kd(r,i),Bm(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i,r){kd(r,i),Bm(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i,r){KI(r,i);const s=this._nameToUniform1.get(e);s!==void 0&&i===s||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i,r){kd(r,i),Bm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r,s){KI(s,i,r);const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===n[0]&&r===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),n[0]=i,n[1]=r)}setUniform2fv(e,i,r){kd(r,i),Bm(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s,n){KI(n,i,r,s);const a=this._nameToUniform3.get(e);a===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===a[0]&&r===a[1]&&s===a[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),a[0]=i,a[1]=r,a[2]=s)}setUniform3fv(e,i,r){kd(r,i);const s=this._getUniformLocation(e);s!=null&&Bm(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(s,i)}setUniform4f(e,i,r,s,n,a){KI(a,i,r,s,n);const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i,r){kd(r,i);const s=this._getUniformLocation(e);s!=null&&Bm(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(s,i)}setUniformMatrix3fv(e,i,r=!1,s){kd(s,i);const n=this._getUniformLocation(e);n!=null&&Bm(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(n,r,i)}setUniformMatrix4fv(e,i,r=!1,s){kd(s,i);const n=this._getUniformLocation(e);if(n!=null){const a=this._nameToUniformMatrix4,o=a.get(e);let l=!1;if(o){const u=i.length;if(o.length!==u)a.set(e,Array.from(i)),l=!0;else for(let d=0;d<u;++d){const f=i[d];if(o[d]!==f){for(o[d]=f;d<u;++d)o[d]=i[d];l=!0;break}}}else a.set(e,Array.from(i)),l=!0;l&&this._context.gl.uniformMatrix4fv(n,r,i)}}setUniformMatrices4fv(e,i,r=!1,s){kd(s,i);const n=this._getUniformLocation(e);n!=null&&Bm(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(n,r,i)}stop(){}};function UEe(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),ise()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===35633?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(uJt(i))),s}function uJt(t){let e=2;return t.replaceAll(`
`,()=>`
`+hJt(e++)+":")}function hJt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Bm(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const a=i[n];if(r[n]!==a){for(r[n]=a;n<s;++n)r[n]=i[n];return!0}}return!1}const KI=Bl()?(t,...e)=>kd(t,e):()=>{},kd=Bl()?(t,e)=>{if(t?.supportsNaN)return;const i=e.length;for(let r=0;r<i;++r){const s=e[r];Number.isNaN(s)&&console.error(`Got ${s} as uniform value from ${new Error().stack}`)}}:()=>{};let dJt=class{constructor(e){this._rctx=e,this._store=new Map}dispose(){this._store.forEach(e=>e.dispose()),this._store.clear()}acquire(e,i,r,s){const n=e+i+JSON.stringify(Array.from(r.entries())),a=this._store.get(n);if(a!=null)return a.ref(),a;const o=new cJt(this._rctx,e,i,r,s);return o.ref(),this._store.set(n,o),o}get test(){}},Jfe=class{constructor(){this._result=!1}dispose(){this._program=jt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},pJt=class extends Jfe{constructor(e){super(),this._rctx=e,this._helperProgram=null,ie("mac")&&ie("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:a,height:o}=i.getViewport();i.resetState();const l=new ar(1);l.wrapMode=33071,l.samplingMode=9728;const u=new U1(i,l),d=id.createIndex(this._rctx,35044,new Uint8Array([0]));i.bindFramebuffer(u),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(d,34963),i.drawElements(Sr.POINTS,1,Di.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Sr.TRIANGLES,0,258);const f=new Uint8Array(4);return u.readPixels(0,0,1,1,6408,Ns.UNSIGNED_BYTE,f),i.setViewport(s,n,a,o),i.bindFramebuffer(r),u.dispose(),d.dispose(),f[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${A.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${A.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=pWe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}};const Qfe=[new hm("position",2,Di.UNSIGNED_SHORT,0,4)],zEi=[new hm("a_pos",2,Di.BYTE,0,2)],NEi=[new hm("a_pos",2,Di.BYTE,0,4),new hm("a_tex",2,Di.BYTE,2,4)],gWe=Rp(Qfe);let fJt=class extends Jfe{constructor(e){if(super(),this._rctx=e,!e.gl||!(e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const i=`
    precision highp float;
    attribute vec2 position;

    void main() {
      gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,gWe)}_test(e){const i=this._rctx,r=new ar(1);r.wrapMode=33071,r.dataType=Ns.FLOAT,r.internalFormat=ot.RGBA32F,r.samplingMode=9728;const s=new U1(i,r),n=new vn(i,Qfe,new Uint16Array([0,0,1,0,0,1,1,1])),a=new H0(i,n);i.gl.getError(),i.useProgram(e);const o=i.getBoundFramebufferObject(),{x:l,y:u,width:d,height:f}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(a),i.drawArrays(Sr.TRIANGLE_STRIP,0,4);const g=_i({blending:qPt});i.setPipelineState(g),i.drawArrays(Sr.TRIANGLE_STRIP,0,4);const v=i.gl.getError();return i.setViewport(l,u,d,f),i.bindFramebuffer(o),a.dispose(),s.dispose(),v!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},mJt=class extends Jfe{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 position;
    varying vec2 v_uv;

    void main() {
      v_uv = position;
      gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,gWe)}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new ar(1);r.wrapMode=33071,r.samplingMode=9728;const s=new U1(i,r),n=new vn(i,Qfe,new Uint16Array([0,0,1,0,0,1,1,1])),a=new H0(i,n),o=new ar;o.samplingMode=9729,o.wrapMode=33071;const l=new qi(i,o,e4);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const u=i.getBoundFramebufferObject(),{x:d,y:f,width:g,height:v}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(16384),i.bindVAO(a),i.drawArrays(Sr.TRIANGLE_STRIP,0,4);const _=new Uint8Array(4);return s.readPixels(0,0,1,1,6408,Ns.UNSIGNED_BYTE,_),a.dispose(),s.dispose(),l.dispose(),i.setViewport(d,f,g,v),i.bindFramebuffer(u),_[0]!==255}};const e4=new Image;e4.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",e4.width=5,e4.height=5,e4.decode();let gJt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new fJt(e),this.svgPremultipliesAlpha=new mJt(e),this.drawArraysRequiresIndicesTypeReset=new pJt(e)}dispose(){this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function yJt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function vJt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function _Jt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function bJt(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function BEe(t,e,i,r,s){if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function wJt(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function xJt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let SJt=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._parallelShaderCompile=null,this._rendererInfo=null,this._disabledExtensions=i.disabledExtensions,this._debugWebGLExtensions=i.debugWebGLExtensions}get compressedTextureETC(){return this._compressedTextureETC??=yJt(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=vJt(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=_Jt(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=PYt(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=bJt(this._gl,this._disabledExtensions),this._colorBufferFloat}get textureNorm16(){return this._textureNorm16??=wJt(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=BEe(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]),this._textureFloatLinear}get parallelShaderCompile(){return this._parallelShaderCompile??=BEe(this._gl,this._disabledExtensions,"parallelShaderCompile",!1,["KHR_parallel_shader_compile"]),this._parallelShaderCompile}get loseContext(){return this._loseContext??=xJt(this._gl,this._debugWebGLExtensions),this._loseContext}get rendererInfo(){return this._rendererInfo??=Wze(this._gl),this._rendererInfo}enable(e){return this[e]}},TJt=class{constructor(e,i){this.gl=e,this.instanceCounter=new UYt,this._programCache=new dJt(this),this._transformFeedbackRequestInfo=null,this._state=new REe,this._numOfDrawCalls=0,this._numOfTriangles=0,this._options=i,this.configure(i)}configure(e){this._options=e,this._capabilities=new SJt(this.gl,e),this._parameters=new IEe(this.gl,this._capabilities,e),qi.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new REe,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new fRt({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([WM]):s.colorAttachments.length===0?this.setDrawBuffers([Zq]):this.setDrawBuffers([Hr])}}}),this.enforceState(),jt(this._driverTest),this._driverTest=new gJt(this)}updateOptions(e){this._options={...this._options,...e},this._parameters=new IEe(this.gl,this._capabilities,this._options)}dispose(){this._driverTest=jt(this._driverTest),this._programCache=jt(this._programCache),this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this.unbindBuffer(35345),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(35051),this.unbindBuffer(35052),this.unbindBuffer(36662),this.unbindBuffer(36663),this._state.textureUnitMap.length=0,this._state=null,this._capabilities=null,this._stateTracker=null,Bl()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}get programCache(){return this._programCache}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=1032,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===1032&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=1032,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(YJ+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if(s?.length!==e.length||!s.every((n,a)=>n===e[a]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==WM&&e[0]!==Zq)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(WM)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){if(e){if(16384&e){const r=this._state.drawFramebuffer?.colorAttachments;r&&this.setDrawBuffers(r),this.setColorMask(!0,!0,!0,!0)}256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const a=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],a),s|=16384}i&&(s|=256),r===!1?r=0:(r===!0&&(r=255),s|=1024),s&&this.clear(s,r)}clearBuffer(e,i,r=6144,s=void 0){this.gl.clearBufferfv(r,e,i,s)}clearBufferInteger(e,i,r=6144,s=void 0){this.gl.clearBufferiv(r,e,i,s)}clearBufferUnsignedInteger(e,i,r=6144,s=void 0){this.gl.clearBufferuiv(r,e,i,s)}drawArrays(e,i,r){if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(this._state.program?.hasTransformFeedbackVaryings==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(Bl()&&(this._numOfDrawCalls++,this._numOfTriangles+=qEe(e,r),ie("enable-feature:webgl-debug:textureReadWrite"))){const s=this._state.textureUnitMap;for(let n=0;n<s.length;n++){const a=s[n];if(a!=null&&a===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${n}`)}}this.gl.drawArrays(e,i,r),Au(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),Au(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(Bl()&&(this._numOfDrawCalls++,this._numOfTriangles+=qEe(e,i)),this.gl.drawElements(e,i,r,s),Bl()){const n=the(this.gl);if(n){const a=this.getBoundVAO(),o=a?.indexBuffer,l=a?.buffers,u={indexBuffer:o,vertexBuffers:l},d={mode:e,count:i,type:r,offset:s},f=o?.size??0,g=s+i,v=f<g?`. Buffer is too small. Attempted to draw index ${g} of ${f}`:"";console.error(`drawElements: ${n}${v}`,{args:d,vao:u})}}}drawElementsInstanced(e,i,r,s,n){this.gl.drawElementsInstanced(e,i,r,s,n),Au(this.gl)}logInfo(){Bl()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Bl()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return e?.glName==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(36160,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(36160),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===36008,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=16384,s=9728,n=0,a=0,o=e.width,l=e.height,u=0,d=0,f=i.width,g=i.height){this.bindFramebufferSeparate(e,36008,!0),this.bindFramebufferSeparate(i,36009,!0),this.gl.blitFramebuffer(n,a,o,l,u,d,f,g,r,s)}bindBuffer(e,i){if(e)switch(i??=e.bufferType,i){case 34962:this._state.vertexBuffer=mc(this.gl,e,i,this._state.vertexBuffer);break;case 34963:this._state.indexBuffer=mc(this.gl,e,i,this._state.indexBuffer);break;case 35345:this._state.uniformBuffer=mc(this.gl,e,i,this._state.uniformBuffer);break;case 35051:this._state.pixelPackBuffer=mc(this.gl,e,i,this._state.pixelPackBuffer);break;case 35052:this._state.pixelUnpackBuffer=mc(this.gl,e,i,this._state.pixelUnpackBuffer);break;case 36662:this._state.copyReadBuffer=mc(this.gl,e,i,this._state.copyReadBuffer);break;case 36663:this._state.copyWriteBuffer=mc(this.gl,e,i,this._state.copyWriteBuffer);break;case 35982:this._state.transformFeedbackBuffer=mc(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===35345?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const a=this._getBufferBinding(e,i);a!=null&&(a.buffer===r&&a.offset===s&&a.size===n||(s%this._parameters.uniformBufferOffsetAlignment===0?(this.gl.bindBufferRange(e,i,r.glName,s,n),a.buffer=r,a.offset=s,a.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(Bl()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(35345,e,i.buffer,r,s):this.bindBufferBase(35345,e,i.buffer)):this.bindBufferBase(35345,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(35345,i,null)}}unbindBuffer(e){switch(e){case 34962:this._state.vertexBuffer=mc(this.gl,null,e,this._state.vertexBuffer);break;case 34963:this._state.indexBuffer=mc(this.gl,null,e,this._state.indexBuffer);break;case 35345:this._state.uniformBuffer=mc(this.gl,null,e,this._state.uniformBuffer);break;case 35051:this._state.pixelPackBuffer=mc(this.gl,null,e,this._state.pixelPackBuffer);break;case 35052:this._state.pixelUnpackBuffer=mc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case 36662:this._state.copyReadBuffer=mc(this.gl,null,e,this._state.copyReadBuffer);break;case 36663:this._state.copyWriteBuffer=mc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e,i){if(e==null)return this._state.vertexArrayObject?.unbind(),void(this._state.vertexArrayObject=null);this._state.vertexArrayObject!==e&&(e.bind(i),this._state.vertexArrayObject=e)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(37143,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(mn.Sync,r),i.flush();do await Q9(e),s=i.clientWaitSync(r,0,0);while(s===37147);if(this.instanceCounter.decrement(mn.Sync,r),i.deleteSync(r),s===37149)throw new Error("Client wait failed")}getBoundFramebufferObject(e=36160){return e===36008?this._state.readFramebuffer:this._state.drawFramebuffer}temporaryBindFramebufferObject(e,i,r=!1){const s=this.getBoundFramebufferObject();try{this.bindFramebuffer(e,r),i()}finally{this.bindFramebuffer(s,r)}}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(34962),this.unbindBuffer(34963),this.unbindBuffer(35345),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(35051),this.unbindBuffer(35052),this.unbindBuffer(36662),this.unbindBuffer(36663);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([WM]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:e}=this;e.bindVertexArray(null);for(let r=0;r<this.parameters.maxVertexAttributes;r++)e.disableVertexAttribArray(r);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(34962,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(34963,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(35345,null);for(let r=0;r<this._parameters.maxUniformBufferBindings;r++){const s=this._state.uniformBufferBindingPoints[r];if(s!=null){const{buffer:n,offset:a,size:o}=s;n!==null?a===0&&o===0?e.bindBufferBase(35345,r,n.glName):e.bindBufferRange(35345,r,n.glName,a,o):e.bindBufferBase(35345,r,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(35051,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(35052,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(36662,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(36663,null),e.bindFramebuffer(36008,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(36008,this._state.readFramebuffer.glName),e.readBuffer(Hr)),e.bindFramebuffer(36009,this._state.drawFramebuffer?.glName??null),this._state.drawFramebuffer===null){const r=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(r??[WM])}else{const r=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(r??[Hr])}if(this._state.vertexArrayObject){const r=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(r)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?.glName??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let r=0;r<this.parameters.maxTextureImageUnits;r++){e.activeTexture(YJ+r),e.bindTexture(3553,null),e.bindTexture(34067,null),e.bindTexture(32879,null),e.bindTexture(35866,null);const s=this._state.textureUnitMap[r];s!=null&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(YJ+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}};function mc(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function qEe(t,e){switch(t){case Sr.POINTS:return 2*e;case Sr.TRIANGLES:return e/3;case Sr.TRIANGLE_STRIP:case Sr.TRIANGLE_FAN:return e-2;default:return 0}}let $Jt=class extends TJt{constructor(e,i){super(e,i),this.emptyTexture=L7e(this),this._vaoCaches=new Map,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=i.newCache,this._screen=new NYt(this)}configure(e){super.configure(e),this._newCache=e.newCache}destroy(){this._vaoCaches.forEach(e=>e.dispose()),this._vaoCaches.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}get refCount(){return this._refCount}dispose(){this.emptyTexture.dispose(),this._screen.destroy(),this._screen=null,super.dispose(),this._appleAmdDriverHelper?.dispose(),this._vaoCaches.forEach(e=>e.dispose()),this._vaoCaches.clear()}get newCache(){return this._newCache}get screen(){return this._screen}getVaoCache(e){const i=JSON.stringify(e),r=this._vaoCaches.get(i);if(r)return r;const s=new jYt(this,e);return this._vaoCaches.set(i,s),s}bindTechnique(e,i,r,s){return this.useProgram(e.program),this.setPipelineState(e.getPipeline()),e.program.bind(i),r&&(e.program.bindPass(r,i),s&&e.program.bindDraw(i,r,s)),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new pWe(this),this._appleAmdDriverHelper.run())}get isAssumedMetalDriver(){if(this._isAssumedMetalDriver==null&&(this._isAssumedMetalDriver=!!ie("ios")||!!ie("safari"),!this._isAssumedMetalDriver&&ie("mac")&&ie("chrome"))){const e=this.capabilities.rendererInfo?.getUnmaskedRenderer().toLowerCase(),i=e?.includes("apple")&&e?.includes("angle")&&e?.includes("metal");this._isAssumedMetalDriver=i??!0}return this._isAssumedMetalDriver}get test(){}},CJt=class extends hNe{constructor(e){super(e.options.deactivatedWebGLExtensions||{},e.options.debugWebGLExtensions||{},8,e.view.qualitySettings.maxTexturePixels),this.newCache=(i,r)=>e.view.resourceController.memoryController.newCache(i,r)}};function GEe(t){return!!t.update}let MJt=class{constructor(){this._updating=new Map}destroy(){this._updating.clear()}add(e){this._updating.set(e.id,new EJt(e))}remove(e){this._updating.delete(e.id)}run(){let e=!1;return this._updating.forEach(i=>{const r=i.texture.update(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e}},EJt=class{constructor(e){this.texture=e,this.previousToken=-1}},H3=class extends be{constructor(e){super({}),this._stage=e,this._textures=new Map,this._loadingCount=0,this.events=new gm,this.updater=new MJt,this._frameTask=e.view.resourceController.scheduler.registerTask(Tt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this.updater.destroy(),this._textures.forEach(e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){this.updater.run()&&this.events.emit("changed",0)}_createNewRef(e){const i=this._stage.getTexture(e);if(i==null)return null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(i)}),s=new AJt(i,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.loaded?(this._updateGLTexture(s,i.glTexture),GEe(i)&&this.updater.add(i),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._stage.renderView.renderingContext),a=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),GEe(i)&&this.updater.add(i),s),o=l=>(i.unload(),this._loadingCount--,s.loadingPromise=null,Zr(l)||re.getLogger(this).error(l),null);return Ea(n)?n.then(a,o):a(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",1)}_onTextureUnloaded(e){this._textures.delete(e.id),this.updater.remove(e)}};c([p()],H3.prototype,"_loadingCount",void 0),c([p()],H3.prototype,"_frameTask",void 0),c([p()],H3.prototype,"updating",null),H3=c([R("esri.views.3d.webgl-engine.lib.TextureRepository")],H3);let AJt=class{constructor(e,i){this._texture=e,this._release=i,this._refCount=0}get id(){return this._texture.id}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(re.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}unload(){this._texture.unload()}};function OJt(t,e){return new R9e(i=>r8t(i,t),i=>i,e)}let t4=class extends be{constructor(){super(...arguments),this._passParameters=new PJt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Rs(this._resourcesTask),this._passParameters.waveNormal=jt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=jt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=sc(async i=>{await Promise.allSettled([this._loadImageResource(e,Qs("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,Qs("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?2:1}async _loadImageResource(e,i,r,s){try{const n=await J0(i,{signal:s});ct(s);const a=new ar(n.width,n.height);a.pixelFormat=6407,a.samplingMode=9987,a.hasMipmap=!0,a.maxAnisotropy=8,r(new qi(e,a,n))}catch(n){re.getLogger(this).error("Failed to load water material normal texture.",n)}}};c([p()],t4.prototype,"_resourcesTask",void 0),c([p({type:Boolean,readOnly:!0})],t4.prototype,"updating",null),t4=c([R("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],t4);let PJt=class extends $r{},RJt=class{constructor(e,i){this.parameters=e,this.fbos=i}},IJt=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(0);const i=Eo();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d",{willReadFrequently:!0}),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:a}=e,o=this._ensureScreenshotEncodeCanvas();let l=FU(r,s,o);this._rctx.gl.readPixels(0,0,r,s,6408,Di.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(o,l,{...e,region:void 0});const u=FU(n.width,n.height,o);return Vze(l,u,!0,a.region.x,s-(a.region.y+a.region.height),a.region.width,a.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),a=FU(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,6408,Di.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),i(),this._renderScreenshotOverlay(n,a,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,{framebufferWidth:n,framebufferHeight:a,ignorePadding:o,pixelRatio:l,disableDecorations:u,olidColor:d}=i,f={width:n,height:a};fS(f,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let g=!1;const v=f.width!==s.fullWidth||f.height!==s.fullHeight,_=o&&s.pixelRatio!==l,x=v||u||_||d;let S=null,T=null;if(x){const O=s.clone();if(o){const N=eA(O.padding);for(let B=0;B<4;B++)N[B]=Math.round(N[B]/O.pixelRatio*l);O.padding=N}O.fullWidth=f.width,O.fullHeight=f.height,O.pixelRatio=l;const D=s.fovX-O.fovX,L=s.fovY-O.fovY;D<0&&D<L?O.fovX=s.fovX:L<0&&L<D&&(O.fovY=s.fovY);const F={camera:O,contentCamera:O,mode:2,alignPixelEnabled:!0,contentPixelRatio:O.pixelRatio};this._forceCameraHook(F),g=!0;const j=this._renderFunctions.renderScene(F,r,d?2:1,u);T=j.screen,S=j.olid}const M=()=>{this._rctx.bindFramebuffer(null),T?.release()};this._rctx.bindFramebuffer(T?.fbo);const E=this._readbackScreenshot(i,M);let P=null;if(d){const O=()=>{this._rctx.bindFramebuffer(null),S?.release()};this._rctx.bindFramebuffer(S?.fbo),P=this._readbackScreenshot(i,O),this._rctx.bindFramebuffer(null)}if(x&&!this._rctx.contextAttributes.alpha)for(let O=3;O<E.data.length;O+=4)E.data[O]=255;if(P&&!this._rctx.contextAttributes.alpha)for(let O=3;O<P.data.length;O+=4)P.data[O]=255;return g&&this._forceCameraHook(e.parameters),[E,P]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas??=document.createElement("canvas"),this._screenshotEncodeCanvas}},Ll=class extends be{constructor(e){super(e),this._waterTextures=new t4,this.olidRenderHelper=Ep()?new MZt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this.glow=null,this.fog=null,this.test=null;const i=e.stage;try{this._initializeContext(i)}catch(a){return void console.error("Failed to initialize context",a)}const{memoryController:r}=i.view.resourceController;this._stippleTextures=UBt(this._rctx,r),this.notifyChange("stippleTextures"),this._markerTextures=OJt(this._rctx,r),this.notifyChange("markerTextures"),this._techniques=new IWt(new RWt(this._rctx,i.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures)),this._textures=new H3(i),this.addHandles(this._textures.events.on("changed",a=>this.requestRender(a)));const s=new P9e(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender());this._compositingHelper=new CZt(this._rctx,this._techniques),this._renderer=new G3(i,s,this._techniques,this._rctx,this._compositingHelper,a=>this.requestRender(a)),this.notifyChange("renderer"),this.addHandles([X(()=>i.view.ready,a=>{a&&this._createRenderNodes()},Yt),X(()=>this.waterTextures?.updating,()=>this.requestRender(),Yt),X(()=>i.view.qualityProfile,a=>this.renderer?.updateRenderFeatures(a),bt)]);const n={renderScene:(a,o,l,u)=>this.renderer.render(a,o,l,u),requestRenderScene:a=>this.requestRender(a),prepareOverlay:()=>i.options.screenshot.prepareOverlay(),renderOverlay:(a,o,l)=>i.options.screenshot.renderOverlay(a,o,l)};this._screenshotManager=new IJt(this._rctx,n,a=>i.view.overlayManager.updateOverlays(Jl,a.camera,0)),this._registerFrameTask(i)}destroy(){const e=this.stage?.container;e?.contains(this._canvas)&&e.removeChild(this._canvas),this._frameTask=Xi(this._frameTask),this._techniques=Pe(this._techniques),this._componentObjectCollection=Pe(this._componentObjectCollection),this._set("componentObjectCollection",null),this._screenshotManager=Pe(this._screenshotManager),Pe(this.renderer),this._textures=Pe(this._textures),Pe(this.waterTextures),Pe(this.markerTextures),Pe(this.stippleTextures),this._waterTextures=null,this._markerTextures=null,this._stippleTextures=null,this._canvas=null,this._rctx=Pe(this._rctx),this._compositingHelper=null,this._renderer=null,this._set("renderer",null),this.test?.destroy()}_createRenderNodes(){const{view:e,viewingMode:i}=this.stage;new Eoe({view:e}),KL(e.spatialReference)||(i===2?(new boe({view:e}),this.glow=new bS({view:e})):XL(e.spatialReference)?(new woe({view:e}),this.glow=new bS({view:e})):(new voe({view:e}),new _oe({view:e}),this.glow=new bS({view:e}),new Coe({view:e}),this.fog=new c8({view:e}))),new F3({view:e,isEnabled:()=>this.renderer.hasSSAO}),new L2({view:e,isEnabled:()=>this.renderer.hasSMAA}),new k2({view:e}),new Fk({view:e}),new B3({view:e,viewingMode:i}),new Hk({view:e}),Ep()&&new Gk({view:e})}requestRender(e=1){switch(e){case 2:this.stage.view.state.fading=!0;case 1:this._needsUpdate=!0;case 0:this._needsRender=!0}}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,a=n){const o=s.constrainWindowSize(i,r,n*s.pixelRatio,a*s.pixelRatio),l=this._ensureLinearDepthArrayBuffer(o);this.renderer.readMainDepth(o,l);const u=(f,g,v)=>Rfe(g,f)*(v[1]-v[0])+v[0];let d=Number.MAX_VALUE;for(let f=0;f<o[2]*o[3];f++){const g=u(4*f,l,s.nearFar);d>g&&g!==s.nearFar[0]&&g!==s.nearFar[1]&&(d=g)}if(e){const f=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);f!=null&&d>f&&f!==s.nearFar[0]&&f!==s.nearFar[1]&&(d=f)}return d===Number.MAX_VALUE?void 0:d}_ensureLinearDepthArrayBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){K9e(),await this._techniques.reloadAll(),this.renderer.overlay?.reloadShaders(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=0,n=!1;const a={preRender:({time:o})=>{r=this.updating,s=this._needsUpdate?1:0,this._needsRender&&this.renderer.updateSceneDepthRange(i.camera),e.commitSyncLayers(),o=this.test?.time??o,(o-this._lastAnimationUpdate>this.renderer.animationTimestep||r||this._needsRender)&&(this.renderer.updateAnimation(i,o)&&this.requestRender(0),this._lastAnimationUpdate=o)},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,o=this.test?.time??o,this.renderer.render(i,o,0),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(0),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{this._textures.update();const l=new RJt(i,this.renderer.fboCache);o=this.test?.time??o,this._screenshotManager.update(l,o)},finish:()=>{n&&(this.renderer.finish(i.mode===2?s:1),n=!1)}};this._frameTask=Hg(a)}_initializeContext(e){const{options:i}=e,r=i.canvas??document.createElement("canvas");r.setAttribute("style","width: 100%; height:100%; display:block;"),this._canvas=r;const s={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=r.getContext("webgl2",s);if(n==null)return void re.getLogger(this).error("A WebGL2 context could not be created.");Au(n,!0),this._rctx=DJt(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&re.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested");const{container:a}=e;!this._rctx.contextAttributes.alpha&&ie("safari")>=11&&(a.style.backgroundColor="black"),a.contains(r)||a.appendChild(r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}get _viewingMode(){return this.stage.viewingMode}get stippleTextures(){return this._stippleTextures}get markerTextures(){return this._markerTextures}get waterTextures(){return this._waterTextures}getObjectAndLayerIdColor(e){return this.olidRenderHelper?.getObjectAndLayerIdColor(e)}get renderer(){return this._renderer}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new OWt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}updateQualitySettings(e){this.test?.time!=null&&(this.test.savedFadeDuration=e.fadeDuration,e.fadeDuration=0),this._rctx.updateOptions({maxPreferredTexturePixels:this.stage.view.qualitySettings.maxTexturePixels})}};function DJt(t,e){const i=new CJt(e);return new $Jt(t,i)}c([p({type:Boolean,readOnly:!0})],Ll.prototype,"updating",null),c([p({constructOnly:!0})],Ll.prototype,"stage",void 0),c([p({readOnly:!0})],Ll.prototype,"stippleTextures",null),c([p({readOnly:!0})],Ll.prototype,"markerTextures",null),c([p({readOnly:!0})],Ll.prototype,"waterTextures",null),c([p({readOnly:!0})],Ll.prototype,"olidRenderHelper",void 0),c([p()],Ll.prototype,"_textures",void 0),c([p({readOnly:!0})],Ll.prototype,"renderer",null),c([p()],Ll.prototype,"_screenshotManager",void 0),c([p()],Ll.prototype,"componentObjectCollection",null),c([p()],Ll.prototype,"_componentObjectCollection",void 0),c([p()],Ll.prototype,"_needsUpdate",void 0),c([p()],Ll.prototype,"_needsWaterReflectionUpdate",void 0),Ll=c([R("esri.views.3d.webgl-engine.parts.RenderView")],Ll);let Ld=class extends be{constructor(e){super(e),this._model=new l8,this._canCompact=ta(!1),this._layers=new Array,this._asyncChangeSet=new hoe,this._syncChangeSet=new hoe,this._layerSyncSet=new Set,this._textures=new EE(this,e.view.resourceController.scheduler),this._frameTask=e.view.resourceController.scheduler.registerTask(Tt.STAGE,this),this.addHandles(this._frameTask)}initialize(){this._renderView=new Ll({stage:this})}destroy(){this.removeAllHandles(),this._textures.destroy(),this._set("textures",null),this._renderView=Pe(this._renderView),this._set("renderView",null),this._layers.length=0,this._model=null,this._set("renderer",null),this.options.canvas=null,this._set("options",null)}get viewingMode(){return this.view.state.viewingMode}get updating(){return!this.destroyed&&!this.destroying&&(this.readyToRun||this.renderView.updating||this._frameTask.updating||this.textures.updating)}get renderView(){return this._renderView}get renderer(){return this.renderView?.renderer}get textures(){return this._textures}addTexture(e){this._model.addTexture(e),this.renderView.requestRender()}removeTexture(e){e!=null&&!this.destroyed&&this._model.hasTexture(e)&&(this._model.removeTexture(e),this.renderView.requestRender())}addTextures(e){e!=null&&(this._model.addTextures(e),this.renderView.requestRender())}removeTextures(e){e!=null&&(this._model?.removeTextures(e),this.renderView.requestRender())}forEachTexture(e){this._model.forEachTexture(e)}getTexture(e){return this._model.getTexture(e)}addLayer(e){this._layers.includes(e)||(this._model.addLayer(e),this._layers.push(e),this._model.dirtySet.layerAdded(e),this.renderView.requestRender())}removeLayer(e){e!=null&&!this.destroyed&&this._model.hasLayer(e)&&(this._model.dirtySet.layerRemoved(e),this.commitLayer(e),Uc(this._layers,e),this._model.dirtySet.assertLayerClean(e.id),this._model.removeLayer(e),this.renderView.requestRender())}getLayer(e){return this._model.getLayer(e)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get readyToRun(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty||this._canCompact.value}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),this.renderer.compact(e),this._canCompact.value=this.renderer.canCompact,!e.hasProgressed)return Oa}compact(e){return this._canCompact.value=!1,this.renderer.compact(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.commit(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forEach(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===1,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.commit(n,s?Jl:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.commit(this._syncChangeSet,Jl),this.renderView.requestRender(),e.madeProgress()),this._layers.forEach(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==0||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.commit(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("readyToRun")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forEach(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===1?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.commit(this._syncChangeSet,Jl),this.renderView.requestRender())}commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.commit(this._syncChangeSet,Jl),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}get layers(){return this._layers}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{ZCe(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Ea(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(ZCe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get test(){}};c([p({constructOnly:!0})],Ld.prototype,"view",void 0),c([p({constructOnly:!0})],Ld.prototype,"options",void 0),c([p({readOnly:!0})],Ld.prototype,"viewingMode",null),c([p({constructOnly:!0})],Ld.prototype,"container",void 0),c([p({readOnly:!0})],Ld.prototype,"updating",null),c([p({readOnly:!0})],Ld.prototype,"renderView",null),c([p({readOnly:!0})],Ld.prototype,"renderer",null),c([p({readOnly:!0})],Ld.prototype,"textures",null),c([p({readOnly:!0})],Ld.prototype,"readyToRun",null),Ld=c([R("esri.views.3d.webgl-engine.Stage")],Ld);let kJt=class{constructor(){this.position0=I(),this.position1=I(),this.faceNormal0=I(),this.faceNormal1=I(),this.componentIndex=0,this.cosAngle=0}};const _8=-1;function sAi(t,e,i){const r=t.vertices.position,s=t.vertices.componentIndex,n=uu.position0,a=uu.position1,o=uu.faceNormal0,l=uu.faceNormal1,{edges:u,normals:d}=NJt(t),f=u.length/4,g=e.allocate(f);let v=0;const _=f,x=i?.allocate(_);let S=0,T=0,M=0;i4.length=0;for(let F=0;F<f;++F){const j=4*F;r.getVec(u.data[j],n),r.getVec(u.data[j+1],a);const N=i4.pushNew();N.index=4*F,N.length=Bi(n,a)}i4.sort((F,j)=>j.length-F.length);const E=new Array,P=new Array;i4.forAll(({length:F,index:j})=>{const N=u.data[j],B=u.data[j+1],U=u.data[j+2],Q=u.data[j+3],H=Q===_8;if(r.getVec(N,n),r.getVec(B,a),H){const J=3*U;xe(o,d.data[J],d.data[J+1],d.data[J+2]),me(l,o),uu.componentIndex=s.get(N),uu.cosAngle=Le(o,l)}else{let J=3*U;if(xe(o,d.data[J],d.data[J+1],d.data[J+2]),J=3*Q,xe(l,d.data[J],d.data[J+1],d.data[J+2]),uu.componentIndex=s.get(N),uu.cosAngle=Le(o,l),FJt(uu,BJt))return;uu.cosAngle<-.9999&&me(l,o)}T+=F,M++,H||LJt(uu,GJt)?(e.write(g,v++,uu),E.push(F)):zJt(uu,yWe)&&(x&&i&&i.write(x,S++,uu),P.push(F))});const O=new Float32Array(E.reverse()),D=new Float32Array(P.reverse()),L=x&&i?{instancesData:x.slice(0,S),lodInfo:{lengths:D}}:void 0;return{regular:{instancesData:g.slice(0,v),lodInfo:{lengths:O}},silhouette:L,averageEdgeLength:T/M}}function LJt(t,e){return t.cosAngle<e}function FJt(t,e){return t.cosAngle>e}function zJt(t,e){const i=Ao(t.cosAngle);return L1(HEe,t.position1,t.position0),i*(Le(At(UJt,t.faceNormal0,t.faceNormal1),HEe)>0?-1:1)>e}function NJt(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors,s=t.vertices.position;xc.length=b8.length=0;for(let n=0;n<e;n++){const a=3*n,o=r[a],l=r[a+1],u=r[a+2],d=i[a],f=i[a+1],g=i[a+2];s.getVec(d,Ux),s.getVec(f,m6),s.getVec(g,g6),Ae(m6,m6,Ux),Ae(g6,g6,Ux),At(Ux,m6,g6),Re(Ux,Ux),b8.pushArray(Ux),(o===_8||d<f)&&(xc.push(d),xc.push(f),xc.push(n),xc.push(o)),(l===_8||f<g)&&(xc.push(f),xc.push(g),xc.push(n),xc.push(l)),(u===_8||g<d)&&(xc.push(g),xc.push(d),xc.push(n),xc.push(u))}return{edges:xc,normals:b8}}let VJt=class{constructor(){this.index=0,this.length=0}};function jJt(){i4.prune(),xc.prune(),b8.prune()}const i4=new Ai({allocator:t=>t||new VJt,deallocator:null}),xc=new Ai({deallocator:null}),b8=new Ai({deallocator:null}),uu=new kJt,UJt=I(),HEe=I(),Ux=I(),m6=I(),g6=I(),yWe=zt(4),BJt=Math.cos(yWe),qJt=zt(35),GJt=Math.cos(qJt);function eee(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function HJt(t){let e=0,i=0;for(let r=0;r<t.length;r++){const s=t[r].size;typeof s=="number"&&(e+=s,i++)}return e/i}function WEe(t,e){return typeof t=="number"?t:t?.stops?.length?HJt(t.stops):e}function WJt(t,e){if(!e)return t;const i=e.filter(a=>a.type==="size").map(a=>{const{maxSize:o,minSize:l}=a;return(WEe(o,t)+WEe(l,t))/2});let r=0;const s=i.length;if(s===0)return t;for(let a=0;a<s;a++)r+=i[a];const n=Math.floor(r/s);return Math.max(n,t)}function ZJt(t){const e=t?.renderer,i=t?.pointerType,r=i==="touch"?9:6;if(!e)return r;const s="visualVariables"in e?WJt(r,e.visualVariables):r;if(e.type==="simple")return eee(s,e.symbol);if(e.type==="unique-value"){let n=s;return e.uniqueValueInfos?.forEach(a=>{n=eee(n,a.symbol)}),n}if(e.type==="class-breaks"){let n=s;return e.classBreakInfos.forEach(a=>{n=eee(n,a.symbol)}),n}return e.type==="dot-density"||e.type,s}function YJt(t,e,i,r=new It){let s=0;if(i.type==="2d")s=e*(i.resolution??0);else if(i.type==="3d"){const d=i.overlayPixelSizeInMapUnits(t),f=i.basemapSpatialReference;s=f==null||f.equals(i.spatialReference)?e*d:Yr(f)/Yr(i.spatialReference)}const n=t.x-s,a=t.y-s,o=t.x+s,l=t.y+s,{spatialReference:u}=i;return r.xmin=Math.min(n,o),r.ymin=Math.min(a,l),r.xmax=Math.max(n,o),r.ymax=Math.max(a,l),r.spatialReference=u,r}function aAi(t,e,i){const r=i.toMap(t);return r==null?!1:YJt(r,ZJt(),i,vWe).intersects(e)}let vWe=new It;function JJt(){vWe=new It}function QJt(t){return e=>{if(t.destroyed){const r=e(Jl);return Ea(r)?r:Promise.resolve(r)}if(t.immediate)return t.immediate.schedule(e);const i="No immediate scheduler";throw console.error(i),new Error(i)}}const s9=new Set,_We=()=>re.getLogger("esri/views/support/TextureCompressionHelper");function XJt(t,e){return qi.compressionWorkerHandle??=new M9t(QJt(e)),s9.has(t)?_We().warn("Repeated texture compression worker initialization by the same view."):s9.add(t),qi.compressionWorkerHandle}function KJt(t){const e=qi.compressionWorkerHandle;e&&(s9.delete(t)||_We().warn("Unknown view attempted to destroy the texture compression worker."),s9.size||(e.destroyWorkerAndSelf(),qi.compressionWorkerHandle=null))}let w8=class extends q7{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};c([p()],w8.prototype,"components",void 0),w8=c([R("esri.views.ui.3d.DefaultUI3D")],w8);const bWe=w8;var Loe;const ZEe=Symbol(),tee=Symbol();var Yw;let rt=(Yw=class extends n4e(P4e(E4e(Vre))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._overrideDefaultEnvironmentOnly=!0,this._resolveWhenReady=[],this._resourceController=R6t(this),this.deconflictor=new qae({view:this}),this.labeler=new I2({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new h1,this.animationsEnabled=!0,this.basemapTerrain=null,this.elevationProvider=new kk({view:this}),this._canvas=null,this.constraints=new W2,this._environment=new L3,this.environmentManager=new mf,this.floors=new ke,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Hze({importAnalysisViewModule:r=>_Pt(r),view:this}),this.groundView=null,this.map=null,this._featureTileTreeClients=new n3t,this._featureTiles=null,this._featureTreeDebugger=null,this.state=new jCe({view:this}),this.slice=new Lk,this.spatialReference=null,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new bWe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this._importControllers=new Map,Pke();const i=(r=null)=>{r!=null&&r.type===4||(this._updatingChanged(),this.map?.allLayers.forEach(async s=>{try{await s.when()}catch{}this._updatingChanged()}))};this.addHandles([tn(()=>this.map?.allLayers,"after-changes",r=>i(r),{onListenerAdd:()=>i(),onListenerRemove:()=>i(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),X(()=>this.scene,r=>r?.load().catch(()=>{}))]),this.inputManager=new u4t({view:this}),this.stateManager=new on({view:this}),this.screenSizePerspective=new Ik({view:this})}initialize(){if(ie("enable-feature:esri-compress-textures")&&ie("wasm-simd")){const e=XJt(this,this.resourceController);this.addResolvingPromise(e.promise)}this.groundView=new Mh({view:this}),this._updateUpdatingMonitors(),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Yt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Yt),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>Ptt(e>0?1e3/Math.ceil(e):0),Yt),this.addHandles([X(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Ht),X(()=>({plane:this.slice.plane,isDecoration:this.slice.isDecoration}),()=>this._updateSlice(),Ht)])}destroy(){this.destroyed||(KJt(this),this.updatingHandles.removeAll(),this.basemapTerrain?.clearHandles(),this.elevationProvider.destroy(),this.ui.removeAllHandles(),this.layerViewManager.clearHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._set("analysisViewManager",Pe(this.analysisViewManager)),this._exitSurface(),this._disposeGraphicsView(),this._disposeFocusAreasView(),this.sharedSymbolResources=Pe(this.sharedSymbolResources),this._set("labeler",Pe(this.labeler)),this._set("deconflictor",Pe(this.deconflictor)),this._resourceController=Pe(this._resourceController),this._set("stateManager",Pe(this.stateManager)),this._set("inputManager",Pe(this.inputManager)),this.state.destroy(),this.highlights.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Pe(this.environmentManager)),this._set("environment",Pe(this.environment)),this.groundView=Pe(this.groundView),this.slice.destroy(),this._updatingObjectsWithProgress.length=0,this._updatingObjects.length=0,this.ui?.destroy(),this._set("ui",null),this._set("renderCanvas",null),this._set("canvas",null),this._canvas=null,this.screenSizePerspective.destroy())}get stage(){return this._stage}get renderSpatialReference(){return this.renderCoordsHelper?.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get overlayManager(){return this.basemapTerrain?.overlayManager}get camera(){return this.stateManager?.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get canvas(){return this._canvas}get center(){return this.stateManager?.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if(this.viewingMode==="global")return null;const e=this.map;let i=this._userClippingArea||p_e(e,"clippingArea");return!this._userClippingArea&&!p_e(e,"clippingEnabled")||i==null?(this._clippingArea=null,null):i instanceof It?this.spatialReference&&(i=y6(i,this.spatialReference),i==null)?(re.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(i=i.clone(),i.intersection(this._groundAndLayersExtent)==null&&(i.xmin=i.xmax,i.ymin=i.ymax),i.zmin=void 0,i.zmax=void 0,i.equals(this._clippingArea)||(this._clippingArea=i),this._clippingArea):(re.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&e!=null?re.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===1)return null;const e=this.renderSpatialReference,i=this.dataExtent;return i==null||e==null||i.spatialReference.equals(e)?i:y6(i,e)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let e=this._groundAndLayersExtent;const i=this.spatialReference||Me.WGS84,r=y6(this.clippingArea,i);r!=null&&(e=e!=null?e.intersection(r):r);const s=this._get("dataExtent");return e!=null&&e.equals(s)?s:e}get _groundAndLayersExtent(){const e=this.spatialReference||Me.WGS84;let i;const r=o=>{const l=y6(o,e);l!=null&&(i!=null?i.union(l):i=l.clone())},{basemapTerrain:s}=this;if(s?.spatialReference){const o=s.groundExtent;r(new It({xmin:o[0],ymin:o[1],zmin:0,xmax:o[2],ymax:o[3],zmax:0,spatialReference:s.spatialReference}))}const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};if(this.map?.allLayers.forEach(o=>n(o)),i==null)return null;i.hasZ?(i.zmin=Math.min(0,i.zmin??0),i.zmax=Math.max(0,i.zmax??0)):(i.zmin=0,i.zmax=0);const a=this._get("_groundAndLayersExtent");return i.equals(a)?a:i}get environment(){return this._environment}set environment(e){if(this._environment===e)return;const{_environment:i}=this;this._environment=null,i?.destroy(),this._environment=e,this.notifyChange("environment")}castEnvironment(e){return e?e instanceof L3?e:e instanceof UF?this.environment?.cloneWithWebsceneEnvironment(e)??L3.fromWebsceneEnvironment(e):en(L3,e):new L3}get extent(){return this.stateManager?.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get layerviewCollections(){return[this.basemapView?.baseLayerViews,this.basemapView?.groundLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews]}get _layerToLayerviewMapping(){return Loe._layerToLayerview}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state?.stationary??!0)}get navigating(){return this.state?.navigating??!1}get scene(){return this.map&&u6e in this.map?this.map:null}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get featureTiles(){return this._featureTiles}set qualityProfile(e){YB.isValidProfile(e)&&(YB.apply(e,this.qualitySettings),this.stage?.renderView.updateQualitySettings(this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||YB.getDefaultProfile()}_updateSlice(){this.stage!=null&&(this.stage.renderer.slice=this.slice)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?qxt(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get terrainLevel(){const e=this.basemapTerrain?.tilingScheme,{scale:i}=this;if(!e||!i)return null;const r=e.levelAtScale(i)+this.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return r<=0?null:Math.max(0,Math.min(r,s||1/0))}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?Bo.deriveUnitFromSR(e,this.spatialReference):null}get alphaCompositingEnabled(){return this._get("alphaCompositingEnabled")}set alphaCompositingEnabled(e){this._stage&&re.getLogger(this).warn("alphaCompositingEnabled cannot be changed after the view has become ready"),this._set("alphaCompositingEnabled",e)}get updating(){if(this.destroying||this.destroyed)return!1;let e=0,i=this.layerViewManager.updating,r=i?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(n=>{if(n.isFulfilled()){if(n.updating){if(i=!0,n.suspended||noe(n))return;++r,e+=n.updatingProgress}}else++r});for(const n of this._updatingObjects)n!=null&&n.updating&&(r+=.1,e+=.5*.1);for(const n of this._updatingObjectsWithProgress)n!=null&&n.updating&&(++r,e+=n.updatingProgress);const s=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(i=!!(i||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||s||this._importControllers.size>0||this.inputManager?.updating||this.map?.allLayers?.some(n=>!n.isFulfilled())),i?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=i?0:1,this._get("updatingProgress")!==e){const n=performance.now();if(e<1){const a=Math.min((n-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=i&&e<1?n:0}return i}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this.stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const e=this._predeterminedViewingMode;if(e!=null)return IQ(e);const i=this.spatialReference;return i?this.defaultsFromMap?.viewingMode!=null&&i.equals(this.defaultsFromMap.spatialReference)?IQ(this.defaultsFromMap.viewingMode):iL(i,1)?"global":"local":"global"}set viewingMode(e){this.ready?re.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get visibleArea(){return this.stateManager?.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get highlightOptions(){return this.highlights.find(({name:e})=>e===cm)??new jg}set highlightOptions(e){for(let i=0;i<this.highlights.length;++i)if(this.highlights.at(i).name===cm)return void this.highlights.items[i].assignFrom(e)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new k6t(this)}on(e,i,r,s){return this.viewEvents.on(e,i,r,s)||super.on(e,i)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,i){if(!this.ready)return re.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=kq(e)?Dq(this,e):e;return Zjt(this,r,i,this._defaultToMapOptions)}toScreen(e){if(!this.ready)return re.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const i=(e.z==null?Lg(this.elevationProvider,e):null)??0;return Jc(e,v6,this.renderSpatialReference,i),this.state.camera.projectToScreen(v6,iee),ia(iee[0],iee[1])}pixelSizeAt(e,i){if(!this.ready)return re.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!e)return 0;const r=this.renderSpatialReference;Jc(e,v6,r);const s=this.state.camera.computeScreenPixelSizeAt(v6);return i&&r!==i?s*Yr(r)/Yr(i):s}overlayPixelSizeInMapUnits(e){return this.overlayManager?.overlayPixelSizeInMapUnits(e,()=>this.pixelSizeAt(e))??1}hitTest(e,i){if(!this.ready)return re.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=kq(e)?Dq(this,e):e;return Wjt(this,r,i,this._defaultHitTestOptions)}async popupHitTest(e){return h6t(this,e)}goTo(e,i){return this.updatingHandles.addPromise(this.stateManager.goTo(e,i))}async whenAnalysisView(e){if(e.parent==null)throw new q("view:no-analysisview-for-analysis","The analysis does not exist in view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":case"viewshed":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const i=await this._completeSettings(e);await this.whenReady();const r=(await this.stage.renderView.takeScreenshot(i))[0];return(await W(async()=>{const{encode:s}=await Promise.resolve().then(()=>cI);return{encode:s}},void 0)).encode(r,i,this._pixelFormat())}async _takeScreenshot(e){const i=await this._completeSettings(e);await this.whenReady();const r=(await this.stage.renderView.takeScreenshot(i))[0];return(await W(async()=>{const{encodeData:s}=await Promise.resolve().then(()=>cI);return{encodeData:s}},void 0)).encodeData(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const i=await this._completeSettings(e);i.olidColor=!0,await this.whenReady();const r=await this.stage.renderView.takeScreenshot(i),{encodeData:s}=await W(async()=>{const{encodeData:n}=await Promise.resolve().then(()=>cI);return{encodeData:n}},void 0);return[s(r[0],this._pixelFormat()),s(r[1],this._pixelFormat())]}async _completeSettings(e){const{toRenderSettings:i,screenshotSuperSampleSettings:r}=await W(()=>Promise.resolve().then(()=>cI),void 0),s=i(e,this);return s.pixelRatio/=this.state.pixelRatio,r(s,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this.stage?.renderView.getAlpha()??!1}}get test(){}async takeScreenshotWithObjectAndLayerId(e){if(!Ep())throw new q("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");const{encode:i}=await W(()=>Promise.resolve().then(()=>cI),void 0),r=await this._completeSettings(e);r.olidColor=!0,await this.whenReady();const s=await this.stage.renderView.takeScreenshot(r),n=i(s[0],r,this._pixelFormat()),a=await this._completeSettings(e);return a.format="png",[n,i(s[1],a,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){const e=this.stage.renderView.olidRenderHelper;if(e)return e.getColorToObjectAndLayerIdMapping();throw new q("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true")}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return pTe.importLayerView(e)}hasLayerViewModule(e){return pTe.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.scene?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}getSurface(){return this.surface}async validate(){let e=Zze(this.type);const i=ie("safari");if(i&&i<9&&(e=new q("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:i})),e!=null)throw re.getLogger(this).warn("#validate()",e.message),e}get _predeterminedViewingMode(){const e=this._isOverridden("viewingMode")?this._get("viewingMode"):this.scene?.initialViewProperties?.viewingMode;return e!=null?Wne(e):null}getSpatialReferenceSupport(e,i){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(e,i,r)?{constraints:this._makeSpatialReferenceConstraints(e,i,r)}:null;const s=this._validateSpatialReferenceForViewingMode(e,i,2),n=this._validateSpatialReferenceForViewingMode(e,i,1);return s||n?s&&n?{constraints:this._makeSpatialReferenceConstraints(e,i,null)}:s?{constraints:this._makeSpatialReferenceConstraints(e,i,2)}:{constraints:this._makeSpatialReferenceConstraints(e,i,1)}:null}_validateSpatialReferenceForViewingMode(e,i,r){return!!iL(e,r)&&(i==null||!!Fwe(i)||(!WE(i)||iW(i,e,r)!=null)&&(!Lwe(i)||r!==1))}_makeSpatialReferenceConstraints(e,i,r){if(i==null)return[{spatialReference:e,viewingMode:r}];const{isWebMercator:s,isWGS84:n}=e;return Fwe(i)&&(s||n)?!n||r===2||sfe(i.tileInfo,i.fullExtent,e,1)===null?[{spatialReference:e,viewingMode:r},{spatialReference:Me.WebMercator,viewingMode:r}]:[{spatialReference:s?Me.WGS84:Me.WebMercator,viewingMode:r}]:WE(i)||Lwe(i)||!s&&!n?WE(i)&&s&&r!==1?[{spatialReference:e,viewingMode:r},{spatialReference:Me.WGS84,viewingMode:2}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:s?Me.WGS84:Me.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const i=this.getSpatialReferenceSupport(e)!=null,r=this._predeterminedViewingMode;return i||(r!=null?re.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${IQ(r)} viewing mode.`):e.isGeographic&&re.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),i}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}trackGraphicState(e){if(!e.graphic)return re.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const i=this.getViewForGraphic(e.graphic);let r=null,s=!1;const n=a=>{!s&&a!=null&&"processor"in a&&a.processor?.type==="graphics-3d"&&a.processor.graphicsCore&&(r=a.processor.graphicsCore.trackGraphicState(e))};return i!=null?n(i):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(a=>n(a),()=>{}).catch(()=>{}),bi(()=>{s=!0,r!=null&&(r.remove(),r=null)})}maskOccludee(e){if(!e)return re.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const i=this.getViewForGraphic(e);let r=null,s=!1;const n=a=>{!s&&a!=null&&pjt(a)&&(r=a.maskOccludee(e))};return i!=null?n(i):this.whenViewForGraphic(e,{waitForLayer:!0}).then(a=>n(a),()=>{}).catch(()=>{}),bi(()=>{s=!0,r!=null&&(r.remove(),r=null)})}getViewForGraphic(e){return e.layer===this?this.graphicsView:e.layer?this.allLayerViews.filter(i=>i.type!=="media-3d").find(i=>i.layer===e.layer):null}graphicChanged(e){this.graphicsView!=null&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,i){return e.layer===this?(await qu(()=>this.graphicsView),this.graphicsView):e.layer&&this.map?i&&i.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((r,s)=>{const n=this.map.allLayers.on("change",a=>{a.added.includes(e.layer)&&(n.remove(),this.whenLayerView(e.layer).then(r,s))})}):this.whenLayerView(e.layer):null}enableFeatureTiles(){const e=Symbol();return this._featureTileTreeClients.add(e),bi(()=>this._featureTileTreeClients.delete(e))}async _importModule(e,i){const r=new AbortController;this._importControllers.set(e,r),this._updatingChanged();try{const s=await eQt[e]();if(i&&(gtt(this),ct(r.signal),await i(r.signal)),this.destroyed)throw ti();return ct(r.signal),s}catch{return null}finally{this._importControllers.delete(e),this._updatingChanged()}}_abortImport(e){this._importControllers.get(e)?.abort(),this._importControllers.delete(e),this._updatingChanged()}_initBasemapTerrain(){this._set("basemapTerrain",new C3e({view:this})),this.elevationProvider.register(0,this.basemapTerrain)}_exitBasemapTerrain(){const{basemapTerrain:e,elevationProvider:i}=this;e&&(this._set("basemapTerrain",null),i.unregister(e),e.destroy())}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new $c({view:this})),this.addHandles([this.updatingHandles.add(()=>bn.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&!this._featureTreeDebugger?this.updatingHandles.addPromise(W(()=>import("./FeatureTileTree3DDebugger-DH4NQxso.js"),__vite__mapDeps([424,421]))).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&bn.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||(this._featureTreeDebugger=Pe(this._featureTreeDebugger))},bt),this.updatingHandles.add(()=>({basemapExtent:this.basemapTerrain?.extent,basemapSpatialReference:this.basemapTerrain?.spatialReference,clippingArea:this.clippingArea,featureTiles:this._featureTiles}),({basemapExtent:e,basemapSpatialReference:i,clippingArea:r,featureTiles:s})=>{if(!s)return;const n=!!e;if(r||n)if(n&&i){const a=e&&i?Pa(iF(e,i),this.spatialReference):null;s.filterExtent=r?r.intersection(a):a}else s.filterExtent=r;else s.filterExtent=null},bt),this.updatingHandles.add(()=>this._featureTileTreeClients.size>0,e=>{e?this.updatingHandles.addPromise(this._ensureFeatureTileTree()):this._featureTiles=Pe(this._featureTiles)},Ht)],ZEe),this.stateManager.init()}async _ensureFeatureTileTree(){if(this._featureTiles||this._importControllers.has("FeatureTileTree3D"))return;const e=(await this.updatingHandles.addPromise(this._importModule("FeatureTileTree3D")))?.FeatureTileTree3D;e&&(this._featureTiles=new e({renderCoordsHelper:this.renderCoordsHelper,pointsOfInterest:this.pointsOfInterest,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}),this._updatingChanged())}_exitTerrain(){this.stateManager.exit(),this.removeHandles(tee),this.removeHandles(ZEe),this._featureTiles=Pe(this.featureTiles),this._set("pointsOfInterest",Pe(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem()}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference,i=this.state.isGlobal,r=TEt(i,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",m6t.create(this.state.viewingMode,r)),i||this.addHandles(X(()=>this.basemapTerrain?.extent,s=>{const n=this.renderCoordsHelper.spatialReference;s==null||s[0]===0&&s[1]===0&&s[2]===0&&s[3]===0||!Hhe(s,this.basemapTerrain.spatialReference,YEe,n)||(this.renderCoordsHelper.extent=YEe)},Ht),tee),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(BO/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.removeHandles(tee),this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){e!=null&&e.type===4||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(i=>{i.destroyed||(this.addHandles(X(()=>[i.updating,i.updatingProgress],()=>this._updatingChanged(),Ht),"updatingMonitors"),i.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,i,r){if(!this.overlay||!this.overlay.hasVisibleItems)return r;const s=e.getContext("2d",{willReadFrequently:!0});return s.putImageData(r,0,0),this.overlay.renderCanvas(e,{disableDecorations:i}),s.getImageData(0,0,r.width,r.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n,a)=>this._renderScreenshotOverlay(s,n,a)}},i=new t6t(this.state.viewingMode,s=>this.stage.layers.forEach(s),this);this._set("sceneIntersectionHelper",i);const r=w7(this.surface);this._stage=new Ld({view:this,options:e,container:r}),this.notifyChange("stage"),this._updateSlice(),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this.stage.renderer.setParameters({highQualityTransparency:s}),Yt),this.on("pointer-move",()=>this.stage?.renderer.resetAnimation()),f$(this.stage.renderView.canvas,"webglcontextlost",s=>{this.fatalError=new q("webgl-context-lost",s.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(BO/this.renderCoordsHelper.unitInMeters),this._set("canvas",this.stage.renderView.canvas)}_exitStage(){this.sceneIntersectionHelper?.destroy(),this._set("sceneIntersectionHelper",null),this._stage=Pe(this.stage),this._set("stage",null),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(){this._exitSurface(),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new xUt({view:this,resourceController:this._resourceController})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitTerrain(),this._exitStage())}async _ensureGraphicsView(){if(this.graphicsView||this._importControllers.has("GraphicsView3D")||this.graphics.length===0)return;this.removeHandles("GraphicsView3D");const e=(await this.updatingHandles.addPromise(this._importModule("GraphicsView3D",i=>qu(()=>this.basemapTerrain?.ready,i))))?.default;e&&this._set("graphicsView",new e({view:this,getGraphics:()=>this.graphics})),this._updatingChanged()}_disposeGraphicsView(){this._abortImport("GraphicsView3D"),this.removeHandles("GraphicsView3D"),this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_disposeFocusAreasView(){this._abortImport("FocusAreasView"),this.removeHandles("FocusAreasView"),this.focusAreasView=Pe(this.focusAreasView)}async _ensureFocusAreasView(e){if(this.focusAreasView||this._importControllers.has("FocusAreasView")||e===0)return;this.removeHandles("FocusAreasView");const i=(await this.updatingHandles.addPromise(this._importModule("FocusAreasView")))?.FocusAreasView;i&&(this.focusAreasView=new i({view:this})),this._updatingChanged()}_startup(){Wne(this.viewingMode)===1&&(this._clippingArea=null),this._initSurface(),this._set("ready",!0),this.addHandles(tn(()=>this.graphics,"after-changes",()=>this._ensureGraphicsView()),"GraphicsView3D"),this._ensureGraphicsView(),this.addHandles(X(()=>this.map?.focusAreas?.areas.length??0,s=>this._ensureFocusAreasView(s),{initial:!0}),"FocusAreasView");const e=this.scene?.initialViewProperties??null,i=e?.environment;i&&(this._overrideDefaultEnvironmentOnly?Sje(this.environment,i):this.environment=this.environment.cloneWithWebsceneEnvironment(i)),this.timeExtent=e?.timeExtent,e?.analyses.applyTo(this),this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this._overrideDefaultEnvironmentOnly=!1,this.labeler.dispose(),this._disposeGraphicsView(),this._disposeFocusAreasView(),this._exitSurface(),this._set("ready",!1)}get _defaultToMapOptions(){const e={include:new Set};if(!this.map)return e;this.map.ground&&e.include.add(b1);for(const i of this.allLayerViews)t$(i.layer)&&e.include.add(i.uid);return e}get _defaultHitTestOptions(){const e={exclude:new Set};if(!this.map)return e;this.map.ground&&this.map.ground.opacity<1&&e.exclude.add(b1);for(const i of this.allLayerViews)t$(i.layer)&&i.layer.opacity<1&&e.exclude.add(i.uid);return e}static clearStatics(){ahe(),Ile(),yft(),jJt(),wkt(),QAt(),xjt(),f3t(),JJt(),gdt(),P9t(),O8t(),EDt(),UDt(),u3t(),Itt(),kWt(),Nqt(),bjt.cleanupI3SLodHandling(),Ob.cleanupTilemapCache(),jCe.cleanupViewstate(),C3e.cleanupTerrainSurface()}},Loe=Yw,Yw._layerToLayerview=Vre._layerToLayerview.concat([["view.map.ground.layers","view.groundView.layerViews"]]),Yw.type="3d",Yw);function y6(t,e){return t!=null&&Zc(t.spatialReference,e)?Pa(t,e):null}c([p()],rt.prototype,"_userClippingArea",void 0),c([p()],rt.prototype,"_resourceController",void 0),c([p()],rt.prototype,"stage",null),c([p({readOnly:!0})],rt.prototype,"deconflictor",void 0),c([p({readOnly:!0})],rt.prototype,"labeler",void 0),c([p(L5(h1,"analyses"))],rt.prototype,"analyses",void 0),c([p({type:j0,readOnly:!0})],rt.prototype,"animation",null),c([p()],rt.prototype,"animationsEnabled",void 0),c([p({readOnly:!0})],rt.prototype,"basemapTerrain",void 0),c([p({readOnly:!0})],rt.prototype,"overlayManager",null),c([p({readOnly:!0})],rt.prototype,"elevationProvider",void 0),c([p()],rt.prototype,"camera",null),c([p({type:tc})],rt.prototype,"contentCamera",null),c([p({readOnly:!0})],rt.prototype,"canvas",null),c([p({type:Ue})],rt.prototype,"center",null),c([p({type:It})],rt.prototype,"clippingArea",null),c([p({type:W2,nonNullable:!0})],rt.prototype,"constraints",void 0),c([p({type:It,readOnly:!0})],rt.prototype,"renderDataExtent",null),c([p({readOnly:!0})],rt.prototype,"tileInfo",null),c([p({type:It,readOnly:!0})],rt.prototype,"dataExtent",null),c([p({type:It,readOnly:!0})],rt.prototype,"_groundAndLayersExtent",null),c([p({type:L3})],rt.prototype,"environment",null),c([wi("environment")],rt.prototype,"castEnvironment",null),c([p({readOnly:!0})],rt.prototype,"environmentManager",void 0),c([p({type:It})],rt.prototype,"extent",null),c([p({type:ke})],rt.prototype,"floors",void 0),c([p()],rt.prototype,"screenCenter",null),c([p()],rt.prototype,"frustum",null),c([p({type:Number,readOnly:!0})],rt.prototype,"fullOpacity",void 0),c([p({readOnly:!0})],rt.prototype,"graphicsView",void 0),c([p()],rt.prototype,"analysisViewManager",void 0),c([p()],rt.prototype,"groundView",void 0),c([p({readOnly:!0})],rt.prototype,"layerviewCollections",null),c([p({type:Boolean})],rt.prototype,"initialExtentRequired",null),c([p()],rt.prototype,"defaultsFromMapSettings",null),c([p()],rt.prototype,"interacting",null),c([p()],rt.prototype,"stationary",null),c([p()],rt.prototype,"navigating",null),c([p()],rt.prototype,"map",void 0),c([p()],rt.prototype,"padding",null),c([p({type:$c,readOnly:!0})],rt.prototype,"pointsOfInterest",void 0),c([p()],rt.prototype,"_featureTiles",void 0),c([p()],rt.prototype,"featureTiles",null),c([p()],rt.prototype,"_featureTreeDebugger",void 0),c([p({constructOnly:!0})],rt.prototype,"deactivatedWebGLExtensions",void 0),c([p({constructOnly:!0})],rt.prototype,"debugWebGLExtensions",void 0),c([p({constructOnly:!0})],rt.prototype,"renderCanvas",void 0),c([p({constructOnly:!0})],rt.prototype,"state",void 0),c([p()],rt.prototype,"screenSizePerspective",void 0),c([p({readOnly:!0})],rt.prototype,"inputManager",void 0),c([p({readOnly:!0})],rt.prototype,"stateManager",void 0),c([p({type:["low","medium","high"]})],rt.prototype,"qualityProfile",null),c([p({type:YCe,get(){let t=this._get("qualitySettings");return t||(t=new YCe,YB.apply(this.qualityProfile,t)),t}})],rt.prototype,"qualitySettings",void 0),c([p()],rt.prototype,"slice",void 0),c([p({readOnly:!0})],rt.prototype,"typeSpecificPreconditionsReady",null),c([p({readOnly:!0})],rt.prototype,"renderCoordsHelper",void 0),c([p({readOnly:!0})],rt.prototype,"sceneIntersectionHelper",void 0),c([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],rt.prototype,"resolution",null),c([p({type:Number})],rt.prototype,"scale",null),c([p({readOnly:!0,type:Number})],rt.prototype,"terrainLevel",null),c([p()],rt.prototype,"heightModelInfo",null),c([p()],rt.prototype,"spatialReference",void 0),c([p({type:Boolean,value:!1})],rt.prototype,"alphaCompositingEnabled",null),c([p({constructOnly:!0})],rt.prototype,"preserveDrawingBufferEnabled",void 0),c([p({type:Boolean})],rt.prototype,"supersampleScreenshotsEnabled",void 0),c([p({readOnly:!0})],rt.prototype,"type",void 0),c([p(),wi(t=>t instanceof q7?t:g$(bWe,t))],rt.prototype,"ui",void 0),c([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],rt.prototype,"updating",null),c([p()],rt.prototype,"_updatingObjects",null),c([p()],rt.prototype,"_updatingObjectsWithProgress",null),c([p({type:Number,readOnly:!0,dependsOn:["updating"]})],rt.prototype,"updatingProgress",void 0),c([p({type:["global","local"]})],rt.prototype,"viewingMode",null),c([p({type:ys})],rt.prototype,"viewpoint",null),c([p({readOnly:!0})],rt.prototype,"visibleArea",null),c([p({type:Number})],rt.prototype,"zoom",null),c([p({type:jg})],rt.prototype,"highlightOptions",null),c([p({readOnly:!0})],rt.prototype,"quality",null),c([p({readOnly:!0})],rt.prototype,"resolutionScale",null),c([p()],rt.prototype,"focusAreasView",void 0),c([p()],rt.prototype,"_defaultToMapOptions",null),c([p()],rt.prototype,"_defaultHitTestOptions",null),rt=Loe=c([R("esri.views.SceneView")],rt);const v6=I(),iee=yn(),YEe=fi(),eQt={GraphicsView3D:()=>W(()=>import("./GraphicsView3D-CftG4XXW.js"),__vite__mapDeps([425,330,319,305,15,185,320,307,186])),FocusAreasView:()=>W(()=>import("./FocusAreasView-WjmUnNN_.js"),__vite__mapDeps([426,427,66,254,255,252,256,257,261,258,259,407,20,319,393,29,391,372,365,373,334,392])),FeatureTileTree3D:()=>W(()=>import("./FeatureTileTree3D-Bev61cEF.js"),__vite__mapDeps([428,102]))},tQt=rt;function Foe(t){t?.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{X4e(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}async function iQt(t,e={},i){await t.load(i);const r=Xh(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:a="asc",sortField:o="resource"}=e,l={query:{start:s,num:n,sortOrder:a,sortField:o,token:t.apiKey},signal:i?.signal},u=await t.portal.request(r,l);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map(({created:d,size:f,resource:g})=>({created:new Date(d),size:f,resource:t.resourceFromPath(g)}))}}async function rQt(t,e,i,r){const s=new Map;for(const{resource:a,content:o,compress:l,access:u}of e){if(!a.hasPath())throw new q(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[d,f]=wWe(a.path),g=`${d}/${l??""}/${u??""}`;s.has(g)||s.set(g,{prefix:d,compress:l,access:u,files:[]}),s.get(g).files.push({fileName:f,content:o})}await t.load(r);const n=Xh(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:a,compress:o,access:l,files:u}of s.values())for(let f=0;f<u.length;f+=25){const g=u.slice(f,f+25),v=new FormData;a&&a!=="."&&v.append("resourcesPrefix",a),o&&v.append("compress","true"),l&&v.append("access",l);let _=0;for(const{fileName:x,content:S}of g)v.append("file"+ ++_,S,x);v.append("f","json"),await t.portal.request(n,{method:"post",body:v,signal:r?.signal})}}async function sQt(t,e,i){if(!e.hasPath())throw new q("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=Xh(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null}async function nQt(t,e){await t.load(e);const i=Xh(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function wWe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function Xfe(t){const[e,i]=aQt(t),[r,s]=wWe(e);return[r,s,i]}function aQt(t){const e=Kle(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function x8(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await Si(t.url,{responseType:"blob"})).data}function oQt(t,e){if(!t.hasPath())return null;const[i,,r]=Xfe(t.path);return t.portalItem.resourceFromPath(Xh(i,e+r))}function xWe(t,e){if(!t.hasPath())return null;const[i,,r]=Xfe(t.path);return t.portalItem.resourceFromPath(Xh(i,e+r))}const DE=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:rQt,contentToBlob:x8,fetchResources:iQt,getSiblingOfSameType:oQt,getSiblingOfSameTypeI:xWe,removeAllResources:nQt,removeResource:sQt,splitPrefixFileNameAndExtension:Xfe},Symbol.toStringTag,{value:"Module"}));async function Kfe(t,e,i){const r=await SWe(t,e,i);await TWe(r,e,i)}async function lQt(t,e,i,r,s){const n=await SWe(i,r,s);await t.update({data:e}),await TWe(n,r,s)}async function SWe(t,e,i){if(!e?.resources)return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(f=>f.resource.path)),n=new Set,a=[];s.forEach(f=>{r.delete(f),t.paths.push(f)});const o=[],l=[],u=[];for(const f of e.resources.toUpdate)if(r.delete(f.resource.path),s.has(f.resource.path)||n.has(f.resource.path)){const{resource:g,content:v,finish:_}=f,x=xWe(g,I1());t.paths.push(x.path),o.push({resource:x,content:await x8(v),compress:f.compress}),_&&u.push(()=>_(x))}else{t.paths.push(f.resource.path),l.push({resource:f.resource,content:await x8(f.content),compress:f.compress});const g=f.finish;g&&u.push(()=>g(f.resource)),n.add(f.resource.path)}for(const f of e.resources.toAdd)if(t.paths.push(f.resource.path),r.has(f.resource.path))r.delete(f.resource.path);else{o.push({resource:f.resource,content:await x8(f.content),compress:f.compress});const g=f.finish;g&&u.push(()=>g(f.resource))}if(o.length||l.length){const{addOrUpdateResources:f}=await W(()=>Promise.resolve().then(()=>DE),void 0);await f(e.portalItem,o,"add",i),await f(e.portalItem,l,"update",i)}if(u.forEach(f=>f()),a.length===0)return r;const d=await vtt(a);if(ct(i),d.length>0)throw new q("save:resources","Failed to save one or more resources",{errors:d});return r}async function TWe(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await J9(r)}async function $We(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const cQt=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function eme(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:a})=>new q(s,n,a));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new q("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:a}=i;s&&(r=r.filter(({name:o})=>!(cQt.has(o)||n.includes(o)))),a&&(r=r.filter(o=>o.name!=="web-document-write:property-required"))}if(r.length>0)throw new q(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}function uQt(t){return zdt(t).some(e=>!!e.charts?.length)}const hQt=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(t=>t.toLowerCase());async function dQt(t,e,i){i??={},fQt(t,e),await qu(()=>!e.updatingFromView),await e.load(),await EWe(e),await $We(e),await MWe(t,e);const r=e.portalItem,{json:s,jsonContext:n}=await tme(e,r,t.origin);return eme(n,{errorName:`${t.name}:save`},i),await AWe(e,r),await FQt(t,e,r,s,n),await Promise.all([e.updateItemThumbnail(),Kfe(e.resourceReferences,n)]),r}async function tme(t,e,i){const r=dse(e,i,!0),s=t.write({},r);return await Promise.all(r.resources.pendingOperations),{json:s,jsonContext:r}}async function pQt(t,e,i,r){r??={};const s=mQt(t,i);await qu(()=>!e.updatingFromView),await e.load(),await EWe(e),await $We(e),await MWe(t,e);const{json:n,jsonContext:a}=await tme(e,s,t.origin);eme(a,{errorName:`${t.name}:save`},r),await _Qt(e,s);const o=e.getThumbnailState();return await zQt(t,e,s,n,a,r)&&(e.resourceReferences.portalItem=s),e.restoreThumbnailFromState(o),await Promise.all([e.updateItemThumbnail(),Kfe(e.resourceReferences,a)]),s}function fQt(t,e){if(!e.portalItem)throw new q(`${t.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");CWe(t,e.portalItem)}function CWe(t,e){if(e.type!==t.itemType)throw new q(`${t.name}:portal-item-wrong-type`,`Portal item needs to have type "${t.itemType}"`)}async function MWe(t,e){if(t.name==="linkchart")return;if(!e.basemap?.baseLayers.length)throw new q(`${t.name}:save`,"Map does not have a valid basemap with a base layer.");let i=null;if(await qu(()=>{const r=rft(e.initialViewProperties,e.basemap);return i=r.spatialReference,!r.updating}),!zr(i,e.initialViewProperties.spatialReference))throw new q(`${t.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:e.initialViewProperties.spatialReference,actual:i})}function mQt(t,e){let i=qt.from(e);return i.id&&(i=i.clone(),i.id=null),i.type||(i.type=t.itemType),i.portal||(i.portal=ze.getDefault()),CWe(t,i),i}function EWe(t){const e=[];return t.basemap&&e.push(t.basemap.load()),t.ground&&e.push(t.ground.load()),Promise.allSettled(e).then(()=>{})}async function AWe(t,e){e.extent=await OQt(t.portalItem,t.initialViewProperties.viewpoint.targetGeometry),await bQt(t,e)}const gQt=U0.JSAPI,OWe="CollectorDisabled",JEe="Collector",QEe="Data Editing",PWe="OfflineDisabled",XEe="Offline",RWe="Workforce Project",IWe="Workforce Worker",DWe="Workforce Dispatcher",yQt="Offline Map Areas",vQt="FieldMapsDisabled",KEe=U0.DEVELOPER_BASEMAP,eAe="UtilityNetwork",tAe="IPS";async function _Qt(t,e){Pc(e,OWe),Pc(e,vQt),Pc(e,U0.METADATA),Pc(e,PWe),Pc(e,yQt),Pc(e,DWe),Pc(e,RWe),Pc(e,IWe),await AWe(t,e)}async function bQt(t,e){z1(e,gQt),await wQt(t),SQt(t,e),TQt(t,e),$Qt(t,e),CQt(t,e),MQt(t,e),EQt(t,e),AQt(t,e),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}function wQt(t){const e=ime(t).map(i=>i.load()).toArray();return Promise.allSettled(e).then(()=>{})}function ime(t){return t.allLayers.concat(t.allTables)}function kWe(t){return ime(t).some(e=>e.loaded&&N4e(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&(e.type!=="subtype-group"||e.sublayers.some(i=>i.editingEnabled)))}function xQt(t){return ime(t).filter(e=>e.type!=="group").every(e=>e.loaded&&IQt(t,e))}function SQt(t,e){yw(e,OWe)||yw(e,RWe)||yw(e,IWe)||yw(e,DWe)||!kWe(t)?Pc(e,JEe):z1(e,JEe)}function TQt(t,e){kWe(t)?z1(e,QEe):Pc(e,QEe)}function $Qt(t,e){!yw(e,PWe)&&xQt(t)?z1(e,XEe):Pc(e,XEe)}function CQt(t,e){hie(t.basemap)?z1(e,KEe):Pc(e,KEe)}function MQt(t,e){t.utilityNetworks?.length?z1(e,eAe):Pc(e,eAe)}function EQt(t,e){t.ipsInfo?z1(e,tAe):Pc(e,tAe)}function AQt(t,e){ase(e,U0.CHARTS,uQt(t))}async function OQt(t,e){const i=e.clone().normalize();let r;if(i.length>1)for(const s of i)r?s.width>r.width&&(r=s):r=s;else r=i[0];return PQt(t,r)}async function PQt(t,e){const i=e.spatialReference;if(i.isWGS84)return e.clone();if(i.isWebMercator)return iS(e);const{getGeometryServiceURL:r}=await W(()=>import("./geometryServiceUtils-CNYq6r_x.js"),[]),s=await r(t),n=new Jv({geometries:[e],outSpatialReference:Me.WGS84});return(await CNe(s,n))[0]}function RQt(t){return yF(t)||t.type==="map-notes"||t.type==="route"}function IQt(t,e){return N4e(e)&&e.capabilities.operations.supportsSync||RQt(e)&&!e.portalItem||DQt(e)&&!kQt(e)&&e.spatialReference.equals(t.initialViewProperties.spatialReference)}function DQt(t){return(t.type==="tile"||t.type==="vector-tile")&&(t.capabilities.operations.supportsExportTiles||LQt(t)||C5e(t))}function kQt(t){return t.type==="vector-tile"&&Object.keys(t.sourceNameToSource).length>1}function LQt(t){return t.type==="tile"&&sst(t.url)&&hQt.some(e=>t.url?.toLowerCase().includes("/"+e+"/"))}async function FQt(t,e,i,r,s){await i.update({data:r}),LWe(t,e,i,r,s)}async function zQt(t,e,i,r,s,n){const a=e.portalItem,o={item:a,authenticated:!(!a?.id||!a.portal.user)},l=i.portal;await l.signIn();const{copyAllowed:u,itemReloaded:d}=await rme(o,l);if(o.authenticated||=d,!u)throw new q(`${t.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const f=await sme(i,o,r,n);return e.portalItem=i,LWe(t,e,i,r,s),f}async function rme(t,e){const{item:i,authenticated:r}=t;return i?.id&&i.typeKeywords?.includes("useOnly")?i.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await i.reload(),{copyAllowed:i.itemControl==="admin"||i.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function sme(t,e,i,r){const s=t.portal,{item:n}=e,{folder:a,copyAllResources:o}=r;let l=!1;if(o&&n?.id&&bRe(n.portal.url,s.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:u}=await n.fetchResources();l=!!u}if(l){const u=await n.copy({copyResources:"all",folder:a});t.id=u.id,t.portal=u.portal;const d=t.toJSON();await t.load(),t.read(d),await t.update({data:i})}else await s.user.addItem({item:t,folder:a,data:i});return l}function LWe(t,e,i,r,s){ohe.prototype.read.call(e,{version:r.version,authoringApp:r.authoringApp,authoringAppVersion:r.authoringAppVersion},{origin:t.origin,ignoreDefaults:!0,url:i.itemUrl?kn(i.itemUrl):void 0}),Foe(s),e.resourceInfo=r}const NQt=Object.freeze(Object.defineProperty({__proto__:null,createJSON:tme,initializeNewItem:sme,isCopyAllowed:rme,save:dQt,saveAs:pQt},Symbol.toStringTag,{value:"Module"}));var zoe;let S8=zoe=class extends ae{constructor(t){super(t),this.viewing=null}clone(){return new zoe({viewing:this.viewing?.clone()??null})}};c([p({type:ONe,json:{write:!0}})],S8.prototype,"viewing",void 0),S8=zoe=c([R("esri.webscene.ApplicationProperties")],S8);const VQt=S8;let T8=class extends E1{constructor(e){super(e),this.type="web-scene"}equals(e){return this.type===e.type}};c([p()],T8.prototype,"type",void 0),T8=c([R("esri.analysis.support.AnalysisOriginWebScene")],T8);const Noe=T8,jQt=["slice"];let qS=class extends ke{constructor(e){super(e),this.addHandles([this.on("after-add",i=>{this._setOrigin(i.item)}),this.on("before-remove",i=>{const{origin:r}=i.item;r?.type==="web-scene"&&this._setOrigin(i.item,null)})])}initialize(){for(const e of this.items)this._setOrigin(e)}_setOrigin(e,i=new Noe){e.origin=i}updateFrom(e){const i=e.analyses.filter(r=>iAe(r));this.removeAll(),i.length&&this.addMany(i.map(r=>(r.origin=new Noe,r.clone())))}applyTo(e){e.analyses.destroyMany(e.analyses.filter(({origin:i})=>i?.type==="web-scene")),e.analyses.addMany(this.map(i=>i.clone()))}toJSON(e){return this.items.filter(iAe).map(i=>i.toJSON(e))}};function FWe(t){return{type:qS,cast:b7,clonable:e=>new qS({items:e.items.map(i=>i.clone())}),set(e){this._set(t,ju(e,this._get(t),qS))},json:{read(e,i,r){r?.hooks?.onAfterLoad(()=>UQt(this[t],e,r))},write:{overridePolicy:e=>({enabled:e.length>0})}}}}function iAe(t){return jQt.includes(t.type)&&t.valid}async function UQt(t,e,i){if(!e)return;const r=await Promise.allSettled(e.map(s=>BQt(s,i)));for(const s of r)s.status==="fulfilled"&&t.add(s.value)}async function BQt(t,e){const i=new(await qQt[t.type]());return i.read(t,e),i}qS=c([R("esri.webscene.support.analysisUtils.WebSceneAnalysesCollection")],qS);const qQt={slice:async()=>{const{default:t}=await W(()=>import("./SliceAnalysis-l07CHL0S.js"),__vite__mapDeps([429,399]));return t}};let Cv=class extends nt(ae){constructor(e){super(e),this.analyses=new qS,this.environment=new UF,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(e){this._set("viewingMode",e)}};c([p(FWe("analyses"))],Cv.prototype,"analyses",void 0),c([p({type:UF,json:{write:{isRequired:!0}}})],Cv.prototype,"environment",void 0),c([p({type:Me,json:{default:()=>Me.WebMercator}})],Cv.prototype,"spatialReference",void 0),c([p({type:["local","global"],json:{default:"global"}})],Cv.prototype,"viewingMode",null),c([p({type:ys,json:{write:{isRequired:!0}}})],Cv.prototype,"viewpoint",void 0),c([p(uhe)],Cv.prototype,"timeExtent",void 0),Cv=c([R("esri.webscene.InitialViewProperties")],Cv);const n9=Cv;let $8=class extends nt(ae){constructor(){super(...arguments),this.text=""}};c([p({type:String,json:{write:{isRequired:!0}}})],$8.prototype,"text",void 0),$8=c([R("esri.webscene.support.Description")],$8);const C8=$8;let M8=class extends nt(ae){constructor(e){super(e),this.visible=!1}};c([p({type:Boolean,json:{default:!1,write:!0}})],M8.prototype,"visible",void 0),M8=c([R("esri.webscene.SlideLegendInfo")],M8);const GQt=M8,rAe=new ii({globalId:"global-id",objectId:"object-id"},{ignoreUnknown:!0});let E8=class extends nt(ae){constructor(e){super(e),this.type=null}};c([p({type:rAe.apiValues,readOnly:!0,json:{type:rAe.jsonValues,read:!1,write:!0}})],E8.prototype,"type",void 0),E8=c([R("esri.webscene.support.FeatureReferenceId")],E8);const nme=E8;let r4=class extends nme{constructor(e){super(e),this.type="object-id",this.value=null}};c([st({objectId:"object-id"}),p({type:["object-id"],json:{read:!1,write:{isRequired:!0}},nonNullable:!0})],r4.prototype,"type",void 0),c([p({type:[Number,String],json:{read:!0,write:{isRequired:!0}}})],r4.prototype,"value",void 0),r4=c([R("esri.webscene.support.FeatureReferenceObjectId")],r4);const zWe=r4;let s4=class extends nme{constructor(e){super(e),this.type="global-id",this.value=null}};c([st({globalId:"global-id"}),p({type:["global-id"],json:{read:!1,write:{isRequired:!0}},nonNullable:!0})],s4.prototype,"type",void 0),c([p({type:String,json:{read:!0,write:{isRequired:!0}}})],s4.prototype,"value",void 0),s4=c([R("esri.webscene.support.FeatureReferenceGlobalId")],s4);const HQt=s4,WQt={key:"type",base:nme,typeMap:{"object-id":zWe,"global-id":HQt}};let n4=class extends nt(ae){constructor(e){super(e),this.layerId=null,this.sublayerId=null}};c([p({type:String,json:{write:{isRequired:!0}},nonNullable:!0})],n4.prototype,"layerId",void 0),c([p({type:Number,json:{write:!0}})],n4.prototype,"sublayerId",void 0),n4=c([R("esri.webscene.support.LayerReference")],n4);const NWe=n4;let a4=class extends nt(ae){constructor(e){super(e),this.layerReference=new NWe,this.id=new zWe}};c([p({nonNullable:!0,json:{write:{isRequired:!0}},type:NWe})],a4.prototype,"layerReference",void 0),c([p({json:{read:!0,write:{isRequired:!0}},nonNullable:!0,types:WQt})],a4.prototype,"id",void 0),a4=c([R("esri.webscene.support.FeatureReference")],a4);const ZQt=a4,VWe=ke.ofType(ZQt);let W3=class extends nt(ae){constructor(e){super(e),this.features=new VWe,this.selectedFeatureIndex=0,this.location=null}};c([p({type:VWe,nonNullable:!0,json:{read:!0,write:{isRequired:!0}}})],W3.prototype,"features",void 0),c([p({type:Number,nonNullable:!0,json:{write:!0}})],W3.prototype,"selectedFeatureIndex",void 0),c([p({type:Ue,json:{write:{isRequired:!0}}})],W3.prototype,"location",void 0),W3=c([R("esri.webscene.support.SlidePopupInfo")],W3);const YQt=W3;let Z3=class extends nt(ae){constructor(e){super(e),this.analyses=new qS,this.legendInfo=null,this.popupInfo=null}};c([p(FWe("analyses"))],Z3.prototype,"analyses",void 0),c([p({type:GQt,json:{write:!0}})],Z3.prototype,"legendInfo",void 0),c([p({type:YQt,json:{write:!0}})],Z3.prototype,"popupInfo",void 0),Z3=c([R("esri.webscene.support.SlideElements")],Z3);const jWe=Z3;let kE=class extends nt(ae){constructor(){super(...arguments),this.lighting=new l$,this.weather=new xG}};c([p({types:RBe,json:{write:!0}})],kE.prototype,"lighting",void 0),c([p({types:Fde,json:{write:!0}})],kE.prototype,"weather",void 0),kE=c([R("esri.webscene.support.SlideEnvironment")],kE);var Voe;const JQt={type:Number,json:{type:vi,name:"transparency",read:AO,write:(t,e,i)=>{e[i]=vF(t)}}};let A8=Voe=class extends nt(ae){constructor(){super(...arguments),this.opacity=null}cloneAndApplyTo(t){return this.opacity==null||((t=t?.clone()??new V5).opacity=this.opacity),t}static fromGround(t){return new Voe({opacity:t.opacity})}};c([p(JQt)],A8.prototype,"opacity",void 0),A8=Voe=c([R("esri.webscene.support.SlideGround")],A8);const UWe=A8;let LE=class extends nt(ae){constructor(e){super(e),this.id="",this.sublayerIds=null}};c([p({type:String,json:{write:!0}})],LE.prototype,"id",void 0),c([p({type:[vi],json:{name:"subLayerIds",write:!0}})],LE.prototype,"sublayerIds",void 0),LE=c([R("esri.webscene.support.SlideVisibleLayer")],LE);let O8=class extends nt(ae){constructor(){super(...arguments),this.text=""}};c([p({type:String,json:{write:{isRequired:!0}}})],O8.prototype,"text",void 0),O8=c([R("esri.webscene.support.Title")],O8);const h5=O8;let QQt=0;const joe=ke.ofType(LE),XQt=["caption","cover","none"];let Gn=class extends nt(ae){constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+QQt++,this.title=new h5,this.description=new C8,this.hidden=!1,this.thumbnail=new jc,this.viewpoint=null,this.basemap=null,this.ground=null,this.layout="caption",this.enabledFocusAreas=null,this.environment=new kE,this.timeExtent=null,this.elements=new jWe,this.visibleLayers=new joe}destroy(){this.visibleLayers.removeAll(),this.enabledFocusAreas=null,this.basemap=null,this.thumbnail=Pe(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null,this.elements.destroy()}castTitle(e){return typeof e=="string"?new h5({text:e}):en(h5,e)}castDescription(e){return typeof e=="string"?new C8({text:e}):en(C8,e)}castThumbnail(e){return typeof e=="string"?new jc({url:e}):en(jc,e)}castBasemap(e){return mue(e)}set visibleLayers(e){this._set("visibleLayers",ju(e,this._get("visibleLayers"),joe))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof zs){const r=sAe(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(re.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}async _updateVisibleLayers(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(s=>{if(s.visible){const n=sAe(r);i.push(new LE({id:s.layer.id,sublayerIds:n}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}async updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i?.screenshot};await e.when(),this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?jF.prototype.clone.apply(e.environment.lighting):l$.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.enabledFocusAreas=new ke(e.focusAreasView?.enabledAreas.map(({id:n})=>n)??[]),this.basemap=e.map.basemap?.clone()||null,this.ground=e.map.ground?UWe.fromGround(e.map.ground):null,this.timeExtent=e.timeExtent?.clone()??null,this.elements.analyses.updateFrom(e),await this._updateVisibleLayers(e);const s=await e.takeScreenshot(r);return this.thumbnail=new jc({url:s.dataUrl}),this}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const s=GL(i,()=>r?.abort()),n=()=>{this._applyToController===r&&(this._applyToController=null),r=null,s?.remove()};try{await qu(()=>e.ready,r.signal)}catch(f){throw n(),f}if(r.signal.aborted)throw n(),ti();const a=e.resourceController.scheduler.registerTask(Tt.SLIDE);let o=!1;const l={animate:!0,...i,signal:this._applyToController.signal},u=async()=>{await Promise.all([a.schedule(async()=>o=await this._setViewpointOfInterest(e,l)),a.schedule(()=>this._applyBasemap(e,l),l.signal),a.schedule(()=>this._loadLayersWithSublayerVisibility(e))]),await Promise.all([a.schedule(()=>this._applyLayerVisibility(e),l.signal),a.schedule(()=>this._applyFocusAreaEnabled(e.map?.focusAreas.areas)),a.schedule(()=>this._applyGround(e),l.signal),a.schedule(()=>this.elements.analyses.applyTo(e),l.signal),a.schedule(()=>this._applyViewpoint(e,l),l.signal),a.schedule(()=>e.timeExtent=this.timeExtent?.clone()??null,l.signal),a.schedule(()=>e.environment.weather=this.environment.weather.clone())])},d=await Sp(e.addUpdatingPromise(u()));if(o&&(e.contentCamera=null),a.remove(),n(),d.ok===!1)throw d.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(Zr(r))throw r}e.map.basemap=cft(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_applyFocusAreaEnabled(e){if(e&&this.enabledFocusAreas)for(const i of e)i.enabled=this.enabledFocusAreas.includes(i.id)}_getLayers(e){const i=new ke;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>this.visibleLayers.find(s=>s.id===i.id)?.sublayerIds?i.load():null))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(a=>a.id===i.id);i.visible=r!=null;const s=r?.sublayerIds,n=BWe(i);s&&n&&n.forEach(a=>a.visible=s.includes(a.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i?.ignoreViewpoint||!i?.useDestinationCamera)return!1;const{toCameraAsync:r}=await W(()=>Promise.resolve().then(()=>fkt),void 0),s=await r(e,this.viewpoint);return e.contentCamera=s,s!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(s=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),s}).finally(()=>{Xi(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const s=new Date(i.date.toString()),[n,a]=this._getTime(s),[o,l]=this._getTime(r.date),u=eXt(a,l),d=e.renderCoordsHelper,f=I();d.toRenderCoords(e.camera.position,f);const g=I(),v=I();this.viewpoint.camera!=null&&d.toRenderCoords(this.viewpoint.camera.position,g);const _=new Date;return vs(()=>e.camera,x=>{d.toRenderCoords(x.position,v);const S=Mn(f,v),T=Mn(g,v);let M=0;S+T!==0&&(M=S/(S+T));const E=n+(o-n)*M,P=tXt(a,u*M);i.date=this._setTime(_,E,P)})}write(e,i){const r=super.write(e,i);return r?.elements&&Object.keys(r.elements).length===0&&delete r.elements,r}static createFrom(e,i){return new this().updateFrom(e,i)}};c([p({type:String,json:{write:{isRequired:!0}}})],Gn.prototype,"id",void 0),c([p({type:h5,json:{default:()=>new h5({text:""}),write:{isRequired:!0}}})],Gn.prototype,"title",void 0),c([wi("title")],Gn.prototype,"castTitle",null),c([p({type:C8,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],Gn.prototype,"description",void 0),c([wi("description")],Gn.prototype,"castDescription",null),c([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],Gn.prototype,"hidden",void 0),c([p({type:jc,json:{default:()=>new jc({url:""}),write:{isRequired:!0}}})],Gn.prototype,"thumbnail",void 0),c([wi("thumbnail")],Gn.prototype,"castThumbnail",null),c([p({type:ys,nonNullable:!0,json:{write:{isRequired:!0}}})],Gn.prototype,"viewpoint",void 0),c([p({type:ZE,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Gn.prototype,"basemap",void 0),c([wi("basemap")],Gn.prototype,"castBasemap",null),c([p({type:UWe,json:{write:!0}})],Gn.prototype,"ground",void 0),c([p({type:XQt,json:{write:!0,default:"caption"},nonNullable:!0})],Gn.prototype,"layout",void 0),c([p({type:joe,json:{write:{isRequired:!0}}})],Gn.prototype,"visibleLayers",null),c([wi("visibleLayers")],Gn.prototype,"castVisibleLayers",null),c([p({type:ke.ofType(String),json:{write:!0},clonable:t=>t?new ke(t.items):null})],Gn.prototype,"enabledFocusAreas",void 0),c([p({type:kE,json:{write:!0}})],Gn.prototype,"environment",void 0),c([p(uhe)],Gn.prototype,"timeExtent",void 0),c([p({type:jWe,nonNullable:!0,json:{write:!0}})],Gn.prototype,"elements",void 0),Gn=c([R("esri.webscene.Slide")],Gn);const KQt=Gn;function BWe(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function sAe(t){const e=BWe(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const Uoe=86400,nAe=43200;function eXt(t,e){let i=e-t;return i>nAe&&(i-=Uoe),i<-nAe&&(i+=Uoe),i}function tXt(t,e){return nrt(t+e,Uoe)}const Boe=ke.ofType(KQt);let P8=class extends nt(ae){constructor(e){super(e),this.slides=new Boe}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",ju(e,this._get("slides"),Boe))}};c([p({type:Boe,nonNullable:!0,json:{write:!0}}),wi(b7)],P8.prototype,"slides",null),P8=c([R("esri.webscene.Presentation")],P8);const qWe=P8;var qoe;let Y3=qoe=class extends ae{constructor(t){super(t)}clone(){return new qoe({name:this.name,path:this.path,title:this.title})}};c([p({type:String,json:{write:{isRequired:!0}}})],Y3.prototype,"name",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],Y3.prototype,"path",void 0),c([p({type:String,json:{write:{isRequired:!0}}})],Y3.prototype,"title",void 0),Y3=qoe=c([R("esri.webscene.TransportationNetwork")],Y3);const iXt=Y3;let a9=class extends MF{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.greaterEqual(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}};var aAe;const eS=new a9(1,38),rXt=()=>{const e=[],i=eS.major;for(let r=8;r<=eS.minor;r++)e.push(`${i}.${r}`);return e},ree="Web Scene";var sO;let Ar=(sO=class extends $7(fF(EF(gue))){constructor(e){super(e),this[aAe]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this._afterLoadHooks=[],this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new qWe,this.initialViewProperties=new n9,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=HL(async(i,r,s)=>{switch(i){case 0:return this._saveImpl(r);case 1:return this._saveAsImpl(s,r)}}),this._loadContext={origin:"web-scene",initiator:this,hooks:{onAfterLoad:i=>this._afterLoadHooks.push(i)}},this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{re.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(tn(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=Pe(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,s){i[r]=this._layersToJSON(e,"operational-layers",s)}get loaded(){return super.loaded}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new a9(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${eS.major}.${eS.minor}`}writeTables(e,i,r,s){const n=this._layersToJSON(e,"tables",s);n.length&&(i[r]=n)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=ece}writeGround(e,i,r,s){i[r]=e?e.write({},s):{transparency:0,layers:[]}}readInitialViewProperties(e,i,r){const{viewingMode:s,spatialReference:n}=i,a=new n9,o={...i.initialState};return n!==void 0&&(o.spatialReference=n),s!==void 0&&(o.viewingMode=s),a.read(o,r),a}get spatialReference(){return this.initialViewProperties?.spatialReference??Me.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy(),this._validateFeatureLayerSymbolVisibility()})),Promise.resolve(this)}loadAll(){return mF(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){i??=this._loadContext,i.origin="web-scene";const r=this._isAuthoringAppVersionSetByUser,s=this._isAuthoringAppSetByUser;if(Ule(this,e,n=>super.read(e,n),i),s||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const n=e.baseMap.elevationLayers.map(l=>({id:l.id})),a=this.presentation.slides,o=n.filter(l=>!a.some(u=>u.visibleLayers.some(d=>d.id===l.id)));a.forEach(l=>l.visibleLayers.addMany(o))}}_writeBasemapElevationLayers(e){const i=e.ground?.layers;!e.baseMap&&i?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=se(i))}_layersToJSON(e,i,r){const s={...r,layerContainerType:i};return e.map(n=>this._verifyWritableLayer(n,r)?n.write({},s):null).filter(n=>!!n).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i?.messages?.push(new q("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){if(this.loadStatus!=="loaded"){const n=new q("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw re.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),n}this._runLayersIdGC();const r=!i?.messages;i={messages:[],...i,origin:"web-scene"};const s=super.write(e,i);if(r){const n=i.messages?.filter(a=>a.name==="web-document-write:property-required")??[];if(n.length){const a=new q("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:n});throw re.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",n),a}}return this._writeBasemapElevationLayers(s),s}async save(e){return this._debouncedSaveOperations(0,e)}async _saveImpl(e){if(!this.portalItem)throw new q("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(this.portalItem?.type!==ree)throw new q("webscene:portal-item-wrong-type",`Portal item needs to have type "${ree}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(dse(this.portalItem,"web-scene",!0)),s=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(s,r,0,e),this._updateTypeKeywords(this.portalItem),await lQt(this.portalItem,s,this._resourceReferences,r),Foe(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(1,i,e)}async _saveAsImpl(e,i){let r=qt.from(e);if(!r)throw new q("webscene:portal-item-required","saveAs requires a portal item to save to");r.id&&(r=r.clone(),r.id=null);const s=r.portal||ze.getDefault();await this._ensureLoadBeforeSave(),r.type=ree,r.portal=s;const n=this._enableVerifyItemRelativeUrls(dse(r,"web-scene",!0)),a=this.write({},n);await Promise.all(n.resources.pendingOperations),await this._verifySaveAs(a,n,i);const o=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(r),await s.signIn();const u=this.portalItem,d={item:u,authenticated:!(!u?.id||!u.portal.user)},{copyAllowed:f,itemReloaded:g}=await rme(d,s);if(d.authenticated||=g,!f)throw new q(`${n.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const v={...i,copyAllResources:!0};return await sme(r,d,a,v)&&(this._resourceReferences.portalItem=r),await Kfe(this._resourceReferences,n),this.portalItem=r,ohe.prototype.read.call(this,{version:a.version,authoringApp:a.authoringApp,authoringAppVersion:a.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?kn(r.itemUrl):void 0}),Foe(n),o&&(this.thumbnailUrl=l?Xle(o,"w","8192"):o),n.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,i,r,s){if(!QL(this.spatialReference))throw new q("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:n,requiredPropertyChecksDisabled:a,strictSchemaValidationEnabled:o}=s||{};eme(i,{errorName:"webscene:save"},{ignoreUnsupported:n,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:a})}_verifySaveAs(e,i,r){return this._verifySave(e,i,1,r)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(){return!1}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=UF.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=e.timeExtent?.clone()??null,this.initialViewProperties.analyses.updateFrom(e),e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const s="visible";s in r&&s in r.layer&&r._isOverridden(s)&&(r.layer[s]=r[s])}if(!i.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this);(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this.updateThumbnail(e,{size:i.thumbnailSize})}async updateThumbnail(e,i){const r=TNe(e,i?.size),s=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=s.dataUrl}async _loadFromSource(){this.resourceInfo?await this._loadFromJSON(this.resourceInfo):this.portalItem?.id?await this._loadFromItem(this.portalItem):await this._loadObjectsWithLayers(),await this._afterLoad()}async _afterLoad(){for(;this._afterLoadHooks.length;){const e=this._afterLoadHooks.slice();this._afterLoadHooks.length=0,await Promise.allSettled(e.map(i=>i(this._loadContext)))}}_readAndLoadFromJSON(e){const i=this._loadContext,r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r)}_extractOperationalLayers(e){const i=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const n of e.baseMap.elevationLayers)i.push(n);const r=[],s=n=>(n.layers&&(n.layers=n.layers.filter(s)),n.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||r.push(n),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(s):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e){const i=new ke;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:r}=await W(()=>import("./layersCreator-C-Zqm3pA.js"),__vite__mapDeps([130,127,126,125,128,124])),{operationalLayers:s,operationalElevationLayers:n,basemapElevationLayers:a}=this._extractOperationalLayers(e),o=[],l={context:{...this._loadContext,layerContainerType:"operational-layers"}};if(this.portalItem&&(l.context.portal=this.portalItem.portal||ze.getDefault()),a.length>0){const u={...l,context:{...l.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",o.push(r(this.ground.layers,a,u))}if(n.length>0){const u={...l,context:{...l.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",o.push(r(i,n,u))}s&&s.length>0&&o.push(r(this.layers,s,l)),e.tables?.length&&o.push(r(this.tables,e.tables,{...l,context:{...l.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(o),await this._loadObjectsWithLayers(),this.ground.layers.addMany(i.filter(u=>u.type==="base-elevation"||u.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.groundLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const s=r.beforeSave();s&&e.push(s)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(s=>{throw new q("webscene:load-portal-item","Failed to load portal item",{error:s})}),e.type!=="Web Scene")throw new q("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r=this._loadContext;r.url=kn(e.itemUrl),r.portal=e.portal||ze.getDefault(),r.portalItem=e,r.readResourcePaths=[],await this._readAndLoadFromJSON(i),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!iL(i,1))return Promise.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||Zc(l,i)}else{if(!iL(i,2))return Promise.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const s=l=>l?.camera?.position.spatialReference??l?.targetGeometry?.spatialReference,n=e.viewpoint,a=s(n);if(a&&!r(a))return Promise.reject(new q("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:a,sceneSpatialReference:i,viewingMode:e.viewingMode}));const o=this.presentation.slides.find(l=>!r(s(l.viewpoint)));if(o){const l=s(o.viewpoint);return Promise.reject(new q("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=$yt(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateFeatureLayerSymbolVisibility(){this.sourceVersion?.greaterEqual(1,35)||this.layers.forEach(e=>{e.type==="feature"&&e.addHandles(X(()=>e.loaded,()=>{e.elevationInfo?.mode==="on-the-ground"&&e.renderer?.type==="simple"&&e.renderer.symbol?.type==="polygon-3d"&&e.renderer.symbol.symbolLayers.some(i=>i.type==="fill"&&i.material!=null&&(!i.material.color||i.material.color.a*e.opacity<ls)&&(e.loadWarnings.push(new Gu("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:e})),!0))},{once:!0,sync:!0}))})}_validateJSON(e){const i=a9.parse(e.version||"","webscene");return eS.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=Me.WebMercator.toJSON()),e}_updateTypeKeywords(e){ase(e,U0.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),ase(e,U0.DEVELOPER_BASEMAP,hie(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&hie(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Me.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?kn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,i=s=>this.allLayers.some(n=>n.id===s&&n.persistenceEnabled);e?.layers&&(e.layers=e.layers.filter(s=>i(s.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(s=>{s.visibleLayers&&(s.visibleLayers=s.visibleLayers.filter(n=>i(n.id)))})}static fromJSON(e){if(!e)throw new q("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}},aAe=u6e,sO.version=`${eS.major}.${eS.minor}`,sO);c([p({type:VQt,json:{write:!0}})],Ar.prototype,"applicationProperties",void 0),c([p({type:It,json:{read:{source:"clippingArea.geometry",reader:wp},write:{target:"clippingArea.geometry"}}})],Ar.prototype,"clippingArea",void 0),c([Ie("clippingArea")],Ar.prototype,"writeClippingArea",null),c([p({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Ar.prototype,"clippingEnabled",void 0),c([Oe("clippingEnabled",["clippingArea"])],Ar.prototype,"readClippingEnabled",null),c([Ie("clippingEnabled")],Ar.prototype,"writeClippingEnabled",null),c([p({type:xNe,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Ar.prototype,"floorInfo",void 0),c([p({type:Bo,json:{write:!0}})],Ar.prototype,"heightModelInfo",void 0),c([p({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Ar.prototype,"layers",void 0),c([Ie("layers")],Ar.prototype,"writeLayers",null),c([p({readOnly:!0,type:a9,json:{type:rXt(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Ar.prototype,"sourceVersion",void 0),c([Oe("sourceVersion",["version"])],Ar.prototype,"readSourceVersion",null),c([Ie("sourceVersion")],Ar.prototype,"writeSourceVersion",null),c([p({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],Ar.prototype,"tables",void 0),c([Ie("tables")],Ar.prototype,"writeTables",null),c([p()],Ar.prototype,"thumbnailUrl",null),c([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Ar.prototype,"authoringApp",null),c([Ie("authoringApp")],Ar.prototype,"writeAuthoringApp",null),c([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Ar.prototype,"authoringAppVersion",null),c([Ie("authoringAppVersion")],Ar.prototype,"writeAuthoringAppVersion",null),c([p({json:{write:{isRequired:!0,enabled:!0,overridePolicy:()=>({isRequired:!0,enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Ar.prototype,"ground",void 0),c([Ie("ground")],Ar.prototype,"writeGround",null),c([p({type:ke.ofType(iXt),json:{write:!0}})],Ar.prototype,"transportationNetworks",void 0),c([p({type:qWe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const s={...r,isPresentation:!0};e.presentation=t.write({},s)}}}}})],Ar.prototype,"presentation",void 0),c([p({type:n9,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new n9({viewingMode:"global",spatialReference:Me.WebMercator})}})],Ar.prototype,"initialViewProperties",void 0),c([Oe("initialViewProperties",["initialState","spatialReference","viewingMode"])],Ar.prototype,"readInitialViewProperties",null),c([p({type:Me,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Ar.prototype,"spatialReference",null),c([p({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Ar.prototype,"viewingMode",null),c([p({type:qt})],Ar.prototype,"portalItem",void 0),c([p()],Ar.prototype,"resourceInfo",void 0),c([p({type:SNe,json:{write:!0}})],Ar.prototype,"widgets",void 0),Ar=c([R("esri.WebScene")],Ar);const sXt=Ar;const nXt=aH(sXt),aXt=aH(tQt);var NT;let oXt=(NT=class extends Wo{constructor(){super(),this._containerRef=Jw(),this._mapRef=Jw(),this._uiController=new bje(this),this._cameraProperties={},this.arcgisLoadError=wje(this),this.arcgisViewReadyError=xje(this),this._map=nXt(this),this.view=aXt(this),this.allLayerViews=this.view.allLayerViews,this.alphaCompositingEnabled=this.view.alphaCompositingEnabled,this.analyses=this.view.analyses,this.autoDestroyDisabled=!1,this.basemap=this._map.basemap,this.basemapView=this.view.basemapView,this.clippingArea=this.view.clippingArea,this.constraints=this.view.constraints,this.displayFilterDisabled=this.view.displayFilterEnabled,this.environment=this.view.environment,this.fatalError=this.view.fatalError,this.floors=this.view.floors,this.graphics=this.view.graphics,this.ground=this._map.ground,this.groundView=this.view.groundView,this.highlights=this.view.highlights,this.highlightOptions=this.view.highlightOptions,this.layerViews=this.view.layerViews,this.magnifier=this.view.magnifier,this.map=this.view.map,this.navigation=this.view.navigation,this.padding=this.view.padding,this.popup=this.view.popup,this.popupDisabled=this.view.popupEnabled,this.qualityProfile=this.view.qualityProfile,this.ready=this.view.ready,this.spatialReference=this.view.spatialReference,this.suspended=this.view.suspended,this.theme=this.view.theme,this.timeExtent=this.view.timeExtent,this.updating=this.view.updating,this.viewingMode=this.view.viewingMode,this.visibleArea=this.view.visibleArea,this.arcgisViewAnalysisViewCreate=Qi(()=>this.view,"analysis-view-create"),this.arcgisViewAnalysisViewCreateError=Qi(()=>this.view,"analysis-view-create-error"),this.arcgisViewAnalysisViewDestroy=Qi(()=>this.view,"analysis-view-destroy"),this.arcgisViewChange=$a(),this.arcgisViewClick=Qi(()=>this.view,"click"),this.arcgisViewDoubleClick=Qi(()=>this.view,"double-click"),this.arcgisViewDrag=Qi(()=>this.view,"drag"),this.arcgisViewHold=Qi(()=>this.view,"hold"),this.arcgisViewImmediateClick=Qi(()=>this.view,"immediate-click"),this.arcgisViewImmediateDoubleClick=Qi(()=>this.view,"immediate-double-click"),this.arcgisViewKeyDown=Qi(()=>this.view,"key-down"),this.arcgisViewKeyUp=Qi(()=>this.view,"key-up"),this.arcgisViewLayerviewCreate=Qi(()=>this.view,"layerview-create"),this.arcgisViewLayerviewCreateError=Qi(()=>this.view,"layerview-create-error"),this.arcgisViewLayerviewDestroy=Qi(()=>this.view,"layerview-destroy"),this.arcgisViewMouseWheel=Qi(()=>this.view,"mouse-wheel"),this.arcgisViewPointerDown=Qi(()=>this.view,"pointer-down"),this.arcgisViewPointerEnter=Qi(()=>this.view,"pointer-enter"),this.arcgisViewPointerLeave=Qi(()=>this.view,"pointer-leave"),this.arcgisViewPointerMove=Qi(()=>this.view,"pointer-move"),this.arcgisViewPointerUp=Qi(()=>this.view,"pointer-up"),this.arcgisViewReadyChange=$a(),this.view.ui={components:["attribution"]}}get aria(){return this.view?.aria??null}set aria(e){this.view&&(this.view.aria=e)}get camera(){return this.view.camera}set camera(e){e3t(this.camera,e)||(this.view.camera=e)}get cameraFov(){const{view:e}=this;return e.ready?this.view.camera?.fov:this._cameraProperties.fov}set cameraFov(e){e!=null&&this._mutateCamera(i=>{i.fov=e})}get cameraHeading(){const{view:e}=this;return e.ready?e.camera?.heading:this._cameraProperties.heading}set cameraHeading(e){e!=null&&this._mutateCamera(i=>{i.heading=e})}get cameraPosition(){const{view:e}=this;if(e.ready)return e.camera?.position;const{position:i}=this._cameraProperties;return i?new Ue(i):void 0}set cameraPosition(e){const i=qhe(this.view.camera?.position,e);i&&this._mutateCamera(r=>{r.position=i})}get cameraTilt(){const{view:e}=this;return e.ready?e.camera?.tilt:this._cameraProperties.tilt}set cameraTilt(e){e!=null&&this._mutateCamera(i=>{i.tilt=e})}get center(){return this.view.center}set center(e){const i=vje(e,this.view);i&&(this.view.center=i)}get extent(){return this.view.extent}set extent(e){e&&!this.extent.equals(e)&&(this.view.extent=e)}get focusAreas(){return this.map?this.map?.focusAreas:{areas:[],style:"bright"}}set focusAreas(e){this.map&&(this.map.focusAreas=e)}get gamepad(){return this.view.input.gamepad}get interacting(){return this.view.interacting}get itemId(){return this._map.portalItem?.id}set itemId(e){fje(this._map,this),this._map.portalItem={id:e},this.view.map=this._map}get navigating(){return this.view.navigating}get performanceInfo(){return this.view.performanceInfo}get resolution(){return this.view.resolution}get scale(){return this.view.scale}set scale(e){this.view.scale=e}get stationary(){return this.view.stationary}get viewpoint(){return this.view.viewpoint}set viewpoint(e){yje(this.viewpoint,e)&&(this.view.viewpoint=e)}get zoom(){return this.view.zoom}set zoom(e){this.view.zoom=e}async addLayer(e,i){this.map?.add(e,i)}async addLayers(e,i){this.map?.addMany(e,i)}async addTable(e){this.map?.tables.add(e)}async addTables(e,i){this.map?.tables.addMany(e,i)}async closePopup(){this._uiController.closePopup()}async destroy(){await this.manager.destroy()}async goTo(e,i){return await this.view.goTo(e,i)}async hitTest(e,i){return await this.view.hitTest(e,i)}async openPopup(e){this._uiController.openPopup(e)}async takeScreenshot(e){return await this.view.takeScreenshot(e)}toMap(e,i){return this.view.toMap(e,i)}toScreen(e){return this.view.toScreen(e)}async tryFatalErrorRecovery(){this.view.tryFatalErrorRecovery()}async viewOnReady(e,i){return await this.componentOnReady(),await this.view.whenReady().then(()=>e?.()).catch(i)}async whenAnalysisView(e){return await this.view.whenAnalysisView(e)}async whenLayerView(e){return await this.view.whenLayerView(e)}loaded(){const e=this;e.el.childElem=this._mapRef.value,this.view.container??=e.el.childElem,this.map||=this._map,this.manager.onLifecycle(()=>[X(()=>this.map,i=>{i&&(this._map=i)},{initial:!0,sync:!0}),X(()=>this.view.stationary,()=>this.arcgisViewChange.emit(),{initial:!0}),X(()=>this.view.ready,i=>{i&&(this.camera=this.view.camera.clone().set(this._cameraProperties),this._cameraProperties={}),this.arcgisViewReadyChange.emit()},{initial:this.view.ready})])}_mutateCamera(e){if(!this.view.ready){e(this._cameraProperties);return}const i=this.view.camera?.clone()??new tc;e(i),this.camera=i}renderMain(){return ni`<div class=${Et(Ys.base)} ${_p(this._mapRef)}></div>`}render(){return ni`<section class=${Et(Ys.containerUI)} ${_p(this._containerRef)}>${this._uiController.render()}</section>${this.renderMain()}`}},NT.properties={_map:16,aria:0,view:32,allLayerViews:0,alphaCompositingEnabled:5,analyses:0,autoDestroyDisabled:5,basemap:1,basemapView:0,camera:0,cameraFov:9,cameraHeading:9,cameraPosition:1,cameraTilt:9,center:1,clippingArea:0,constraints:0,displayFilterDisabled:5,environment:0,extent:0,fatalError:0,floors:0,focusAreas:0,gamepad:32,graphics:0,ground:1,groundView:0,highlights:0,highlightOptions:0,interacting:32,itemId:3,layerViews:0,magnifier:0,map:0,navigating:32,navigation:0,padding:0,performanceInfo:32,popup:0,popupDisabled:5,qualityProfile:1,ready:4,resolution:32,scale:9,spatialReference:0,stationary:32,suspended:7,theme:0,timeExtent:0,updating:4,viewingMode:1,viewpoint:0,visibleArea:0,zoom:9,loadErrorSources:0},NT.styles=[mje,gje],NT);p$("arcgis-scene",oXt);const Lo="esri-elevation-profile",Na={base:`${Lo}`,refined:`${Lo}--refined`,mainContainer:`${Lo}__main-container`,promptContainer:`${Lo}__prompt-container`,header:`${Lo}__header`,zoomOutButton:`${Lo}__zoom-out-button`,clearButton:`${Lo}__clear-button`,actionButton:`${Lo}__action-button`,sketchButton:`${Lo}__sketch-button`,sketchCancelButton:`${Lo}__sketch-cancel-button`,sketchDoneButton:`${Lo}__sketch-done-button`,selectButton:`${Lo}__select-button`,selectCancelButton:`${Lo}__select-cancel-button`,chartContainer:`${Lo}__chart-container`,chartSpinner:`${Lo}__chart-spinner`,chartSpinnerVisible:`${Lo}__chart-spinner--visible`,chartSpinnerSmall:`${Lo}__chart-spinner--small`,footer:`${Lo}__footer`},lXt={base:"esri-elevation-profile-legend"},Hy="esri-elevation-profile-legend-item",Wy={base:Hy,disabled:`${Hy}--disabled`,expanded:`${Hy}--expanded`,colorIndicator:`${Hy}__color-indicator`,header:`${Hy}__header`,content:`${Hy}__content`,collapseToggle:`${Hy}__collapse-toggle`,label:`${Hy}__label`,checkbox:`${Hy}__checkbox`},eD="esri-elevation-profile-statistics",tD={base:eD,statistic:`${eD}__statistic`,statisticLabel:`${eD}__statistic__label`,statisticValue:`${eD}__statistic__value`,slopeValue:`${eD}__slope-value`},_6="esri-elevation-profile-settings",b6={base:`${_6}`,popoverContent:`${_6}__popover-content`,uniformChartScalingLabel:`${_6}__uniform-scaling-label`,uniformChartScalingCheckbox:`${_6}__uniform-scaling-checkbox`};function GWe(t){const e="metric";if(t==null)return e;const i=t.map,r=(i&&"portalItem"in i?i.portalItem?.portal:null)??ze.getDefault();switch(r.user?.units??r.units){case e:return e;case"english":return"imperial"}return nnt(t.spatialReference)??e}const cXt={readOnly:!0,get(){return GWe(this.view)}};function HWe(t,e,i,r){let s=null,n=1e3;typeof e=="number"?(n=e,r=i):(s=e??null,n=i);const a=ta(0);let o;const l=()=>{a.value=0,t.apply(r,o)},u=(...d)=>{s&&s.apply(r,d),o=d,n?a.value||(a.value=setTimeout(l,n)):l()};return u.remove=()=>{a.value&&(clearTimeout(a.value),a.value=0)},u.forceUpdate=()=>{a.value&&(clearTimeout(a.value),l())},u.hasPendingUpdates=()=>!!a.value,u}let WWe={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:WWe.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:yi(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesStyle3D:{width:3,falloff:0,innerWidth:0,innerColor:$i(0,0,0,0),renderOccluded:16},profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function rm(){return WWe}const uXt="  ",hXt={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};function ZWe(t){if(!t)return null;const e=t.wkid;if(e)return dut[e];const i=t.wkt2??t.wkt;return i?dXt(i):null}function dXt(t){const e=uut.exec(t);if(!e||e.length!==2)return null;const i=e[1].split(",");if(!i||i.length<3)return null;const r=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(r)||isNaN(s)?null:{a:r,f:s===0?0:1/s}}function cW(t){const e=ZWe(t);if(pXt(e))return e;const i=e.a*(1-e.f);return Object.assign(e,{b:i,eSq:1-(i/e.a)**2,radius:(2*e.a+i)/3,densificationRatio:1e4/((2*e.a+i)/3)})}function pXt(t){return t!=null&&"b"in t&&"eSq"in t&&"radius"in t}function w6(t,e,i){const{a:r,eSq:s}=cW(i),n=Math.sqrt(s),a=Math.sin(e[1]*Rc),o=r*e[0]*Rc;let l;return s>0?l=r*((1-s)*(a/(1-s*(a*a))-1/(2*n)*Math.log((1-n*a)/(1+n*a))))*.5:l=r*a,t[0]=o,t[1]=l,t}function F$(t){return A1(t)&&!!ZWe(t)}function fXt(t,e="square-meters"){if(t.some(a=>!F$(a.spatialReference)))throw new q("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let a=0;a<t.length;a++){const o=t[a],l=o.spatialReference,{radius:u,densificationRatio:d}=cW(l),f=u*d;i.push(mXt(o,f))}const r=[],s=[0,0],n=[0,0];for(let a=0;a<i.length;a++){const{rings:o,spatialReference:l}=i[a];let u=0;for(let d=0;d<o.length;d++){const f=o[d];w6(s,f[0],l),w6(n,f[f.length-1],l);let g=n[0]*s[1]-s[0]*n[1];for(let v=0;v<f.length-1;v++)w6(s,f[v+1],l),w6(n,f[v],l),g+=n[0]*s[1]-s[0]*n[1];u+=g}u=yi(u,"square-meters",e),r.push(u/-2)}return r}function YWe(t,e="meters"){if(!t)throw new q("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some(r=>!F$(r.spatialReference)))throw new q("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let r=0;r<t.length;r++){const s=t[r],{spatialReference:n}=s,a=s.type==="polyline"?s.paths:s.rings;let o=0;for(let l=0;l<a.length;l++){const u=a[l];let d=0;for(let f=1;f<u.length;f++){const g=u[f-1][0],v=u[f][0],_=u[f-1][1],x=u[f][1];if(_!==x||g!==v){const S=new az;BP(S,[g,_],[v,x],n),d+=S.distance}}o+=d}o=yi(o,"meters",e),i.push(o)}return i}function mXt(t,e){if(t.type!=="polyline"&&t.type!=="polygon")throw new q("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=t;if(!F$(i))throw new q("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const r=t.type==="polyline"?t.paths:t.rings,s=[],n=[0,0],a=new az;for(const l of r){const u=[];s.push(u),u.push([l[0][0],l[0][1]]);let d,f,g=l[0][0],v=l[0][1];for(let _=0;_<l.length-1;_++){if(d=l[_+1][0],f=l[_+1][1],g===d&&v===f)continue;const x=[g,v];BP(a,[g,v],[d,f],i);const{azimuth:S,distance:T}=a,M=T/e;if(M>1){for(let E=1;E<=M-1;E++)Nw(n,x,S,E*e,i),u.push(n.slice());Nw(n,x,S,(T+Math.floor(M-1)*e)/2,i),u.push(n.slice())}Nw(n,x,S,T,i),u.push(n.slice()),g=n[0],v=n[1]}}const o=g$(Me,i);return t.type==="polyline"?new gs({paths:s,spatialReference:o}):new Wr({rings:s,spatialReference:o})}let az=class{constructor(e=0,i=void 0,r=void 0){this.distance=e,this.azimuth=i,this.reverseAzimuth=r}};function Nw(t,e,i,r,s){const n=e[0],a=e[1],o=n*Rc,l=a*Rc,u=(i??0)*Rc,{a:d,b:f,f:g}=cW(s),v=Math.sin(u),_=Math.cos(u),x=(1-g)*Math.tan(l),S=1/Math.sqrt(1+x*x),T=x*S,M=Math.atan2(x,_),E=S*v,P=E*E,O=1-P,D=O*(d*d-f*f)/(f*f),L=1+D/16384*(4096+D*(D*(320-175*D)-768)),F=D/1024*(256+D*(D*(74-47*D)-128));let j,N,B,U=r/(f*L),Q=2*Math.PI;for(;Math.abs(U-Q)>1e-12;)B=Math.cos(2*M+U),j=Math.sin(U),N=Math.cos(U),Q=U,U=r/(f*L)+F*j*(B+F/4*(N*(2*B*B-1)-F/6*B*(4*j*j-3)*(4*B*B-3)));const H=T*j-S*N*_,J=Math.atan2(T*N+S*j*_,(1-g)*Math.sqrt(P+H*H)),Z=g/16*O*(4+g*(4-3*O)),K=Math.atan2(j*v,S*N-T*j*_)-(1-Z)*g*E*(U+Z*j*(B+Z*N*(2*B*B-1)));return t[0]=(o+K)/Rc,t[1]=J/Rc,t}function BP(t,e,i,r){const s=e[0]*Rc,n=e[1]*Rc,a=i[0]*Rc,o=i[1]*Rc,{a:l,b:u,f:d,radius:f}=cW(r),g=a-s,v=Math.atan((1-d)*Math.tan(n)),_=Math.atan((1-d)*Math.tan(o)),x=Math.sin(v),S=Math.cos(v),T=Math.sin(_),M=Math.cos(_);let E,P,O,D,L,F,j,N,B,U,Q=1e3,H=g;do{if(j=Math.sin(H),N=Math.cos(H),O=Math.sqrt(M*j*(M*j)+(S*T-x*M*N)*(S*T-x*M*N)),O===0)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;L=x*T+S*M*N,F=Math.atan2(O,L),B=S*M*j/O,P=1-B*B,D=L-2*x*T/P,isNaN(D)&&(D=0),U=d/16*P*(4+d*(4-3*P)),E=H,H=g+(1-U)*d*B*(F+U*O*(D+U*L*(2*D*D-1)))}while(Math.abs(H-E)>1e-12&&--Q>0);if(Q===0){const Ne=f,G=Math.acos(Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(a-s))*Ne,le=a-s,de=Math.sin(le)*Math.cos(o),Se=Math.cos(n)*Math.sin(o)-Math.sin(n)*Math.cos(o)*Math.cos(le),je=Math.atan2(de,Se);return t.azimuth=je/Rc,t.distance=G,t.reverseAzimuth=void 0,t}const J=P*(l*l-u*u)/(u*u),Z=J/1024*(256+J*(J*(74-47*J)-128)),K=u*(1+J/16384*(4096+J*(J*(320-175*J)-768)))*(F-Z*O*(D+Z/4*(L*(2*D*D-1)-Z/6*D*(4*O*O-3)*(4*D*D-3)))),ee=Math.atan2(M*Math.sin(H),S*T-x*M*Math.cos(H)),_e=Math.atan2(S*Math.sin(H),S*T*Math.cos(H)-x*M);return t.azimuth=ee/Rc,t.distance=K,t.reverseAzimuth=_e/Rc,t}function MAi(t){return F$(t)?t:Kh(t)?Me.WGS84:null}const JWe="ProfileGenerationError";let gA=class extends Error{constructor(e){super("profile could not be generated",{cause:e}),this.type=JWe}};function gXt(t){return t.type===JWe}async function yXt(t,e,i,r,s,n,a){let o,l,u;const d=t.spatialReference,f=d.isGeographic||d.isWebMercator;let g=0;if(!f){const{execute:_}=await W(()=>import("./lengthOperator-DNRmnrN5.js").then(x=>x.l),__vite__mapDeps([430,252,255,254,256,66,257,259,258]));ct(a),g=_(t,{unit:"meters"}),ct(a)}const v=1/Yr(r);if(f){await om([{source:d,dest:r},{source:d,dest:Me.WGS84}],a);const _=EXt(t);o=YWe([_],"meters")[0];const x=oAe(o,s);if(uAe(t,o,x)>n)throw new gA("too-complex");const S=lAe(_,e,i);({densifiedPath:l,distances:u}=wXt(S,x,v)),l=Pa(l,r)}else{await om([{source:d,dest:r}],a),o=g;const _=oAe(o,s);if(uAe(t,o,_)>n)throw new gA("too-complex");const x=lAe(t,e,i);({densifiedPath:l,distances:u}=bXt(x,_,v)),ct(a),l=Pa(l,r)}return{densifiedPath:l,pathLength:o*v,distances:u}}function oAe(t,e){const i=t/e.densificationMaxSamples;return Math.max(e.samplingDistance,i)}function lAe(t,e,i){if(e==null)return cAe(t);const r=t.spatialReference,s=e.mode,n=JH(e,r);let a=null;switch(i.type){case"2d":a=vXt(t,s,n);break;case"3d":a=_Xt(t,s,n,i)}return a==null?cAe(t):new gs({hasZ:!0,hasM:!1,spatialReference:r,paths:QWe(t.paths,a)})}function vXt({hasZ:t},e,i){return e==="absolute-height"?t?([r,s,n])=>[r,s,n+i]:([r,s])=>[r,s,i]:null}function _Xt({spatialReference:t,hasZ:e},i,r,{elevationProvider:s}){const n=(a,o,l,u)=>s?.getElevation(a,o,l,t,u)??0;switch(i){case"on-the-ground":return([a,o])=>[a,o,n(a,o,0,"ground")];case"absolute-height":return e?([a,o,l])=>[a,o,l+r]:([a,o])=>[a,o,r];case"relative-to-ground":return e?([a,o,l])=>[a,o,l+n(a,o,l,"ground")+r]:([a,o])=>[a,o,n(a,o,0,"ground")+r];case"relative-to-scene":return e?([a,o,l])=>[a,o,l+n(a,o,l,"scene")+r]:([a,o])=>[a,o,n(a,o,0,"scene")+r];default:return null}}function cAe(t){return t.hasZ?new gs({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:QWe(t.paths,([e,i])=>[e,i])}):t}function QWe(t,e){const i=t.length,r=new Array(i);for(let s=0;s<i;++s){const n=t[s],a=n.length,o=new Array(n.length);r[s]=o;for(let l=0;l<a;++l)o[l]=e(n[l])}return r}function ame(t){return oz(t)&&t.paths.length>0&&t.paths.every(e=>e.length>=2)}function oz(t){return t!=null&&t.type==="polyline"}function XWe(t,e,i,r,s){const{spatialReference:n,hasZ:a}=t,o={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:n,metersPerSR:Yr(n)},l=[],u=[];let d=0;for(let f=0;f<t.paths.length;++f){const g=t.paths[f],v=new Array,_=new Array;let x=0;for(let S=1;S<g.length;++S){const T=g[S-1],M=g[S],E=r(o,T,M);let P;for(P=x;P<E.distance&&!rrt(P,E.distance);P+=e)v.push(s(E,P)),_.push((d+P)*i);x=P-E.distance,d+=E.distance,v.push(M),_.push(d*i)}l[f]=v,u[f]=_}return{densifiedPath:new gs({spatialReference:n,hasZ:a,paths:l}),distances:u}}function bXt(t,e,i){const{hasZ:r}=t;return XWe(t,e,i,SXt,r?MXt:CXt)}function wXt(t,e,i){const{hasZ:r}=t;return XWe(t,e,i,xXt,r?$Xt:TXt)}function xXt(t,e,i){return t.distance=0,BP(t,e,i,t.spatialReference),t.from=e,t.to=i,t}function SXt(t,e,i){return t.from=e,t.to=i,t.distance=nm(i,e)*t.metersPerSR,t}function TXt({from:t,azimuth:e,spatialReference:i},r){return Nw([0,0],t,e,r,i)}function $Xt({from:t,to:e,azimuth:i,distance:r,spatialReference:s},n){const a=n/r,o=[0,0,yt(t[2],e[2],a)];return Nw(o,t,i,n,s),o}function CXt({from:t,to:e,distance:i},r){return Ou([0,0],t,e,r/i)}function MXt({from:t,to:e,distance:i},r){return cr([0,0,0],t,e,r/i)}function EXt(t){return F$(t.spatialReference)?t:Pa(t,Me.WGS84)}function KWe(t){return t.paths.reduce((e,i)=>e+i.length,0)}function uAe(t,e,i){return KWe(t)+Math.floor(e/i)+Math.max(0,t.paths.reduce(r=>1+r,0)-1)}function AXt(t,e){const i=t.length;if(i===0)return null;const r=t[0],s=r.sampledZ;let n=s,a=s,o=0,l=0,u=null,d=null,f=s??0,g=0,v=0,_=s!=null?1:0,x=0,S=0;const T=Yr(e),M=ed(e),E=rm().minSlopeSampleDistance/T,P=2*E,O=new hAe,D=new hAe,L=()=>{j(),O.copy(D),D.reset()},F=(N,B)=>{L(),N>0&&N-O.start<=P&&(N=O.start+E),D.restart(N,B)},j=()=>{if(O.isHole||D.isHole)return;const N=D.avgElevation-O.avgElevation,B=D.start-O.start,U=N*M,Q=B*T,H=yi(Math.atan2(U,Q),"radians","degrees");H>0?(g+=H,u=d0(u,H),x++):H<0&&(v-=H,d=d0(d,-H),S++)};r.sampledZ!=null&&F(r.distance,r.sampledZ);for(let N=1;N<i;++N){const B=t[N-1],U=t[N],Q=U.sampledZ;if(Q==null){D.isHole||L();continue}_++,f+=Q,n=ome(n,Q),a=d0(a,Q),D.isHole||U.distance-D.start>=E?F(U.distance,Q):D.insert(Q);const H=B.sampledZ;if(H!=null){const J=Q-H;J>0?o+=J:J<0&&(l-=J)}}return L(),_===0?null:{maxDistance:t[i-1].distance,minElevation:n,maxElevation:a,avgElevation:_===0?null:f/_,elevationGain:o,elevationLoss:l,maxPositiveSlope:u,maxNegativeSlope:d,avgPositiveSlope:x===0?null:g/x,avgNegativeSlope:S===0?null:v/S}}function OXt(t){const e=t.filter(wl),i=e.length;if(i===0)return null;const r=e[0];if(i===1)return r;let s=r.maxDistance,n=r.minElevation,a=r.maxElevation,o=r.maxPositiveSlope,l=r.maxNegativeSlope;for(let u=1;u<e.length;++u){const d=e[u];s=d0(s,d.maxDistance),n=ome(n,d.minElevation),a=d0(a,d.maxElevation),o=d0(o,d.maxPositiveSlope),l=d0(l,d.maxNegativeSlope)}return{maxDistance:s,minElevation:n,maxElevation:a,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:o,maxNegativeSlope:l,avgPositiveSlope:null,avgNegativeSlope:null}}function PXt(t){let e=null,i=null,r=null;for(const s of t){if(s==null)continue;const{statistics:n,spatialReference:a}=s;if(n==null)continue;const o=Yr(a);e=d0(e,see(n.maxDistance,o));const l=ed(a);r=ome(r,see(n.minElevation,l)),i=d0(i,see(n.maxElevation,l))}return{minDistance:0,maxDistance:e??0,minElevation:r??0,maxElevation:i??0}}function ome(t,e){return e==null?t:t!=null?Math.min(t,e):e}function d0(t,e){return e==null?t:t!=null?Math.max(t,e):e}function see(t,e){return t!=null&&e!=null?t*e:null}let hAe=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,i){this._start=e,this._sampleCount=1,this._totalElevation=i}insert(e){++this._sampleCount,this._totalElevation+=e}};function RXt(t,e,i=[]){if(t>=e||(i.push(t),e-t<2))return i;const r=e-1;i.push(r);const s=Goe(t+1,r);for(;;){const n=s.next();if(n.done)break;i.push(n.value)}return i}function*Goe(t,e){if(t>=e)return;const i=t+Math.floor((e-t)/2);yield i;const r=Goe(t,i),s=Goe(i+1,e);for(;;){const n=r.next(),a=s.next();if(n.done&&a.done)break;n.done||(yield n.value),a.done||(yield a.value)}}async function*IXt(t,e){const{view:i,geometry:r,elevationInfo:s,providers:n,options:a}=t,o=i.spatialReference;if(!o||r==null||!ame(r))throw new gA("invalid-geometry");const l=n.length;if(l===0)return null;const u=Math.round(a.maxTotalSamples/l);if(KWe(r)>u)throw new gA("too-complex");const d=await yXt(r,s,i,o,a,u,e);let f=0;const g=new Array(l),v=new Array(l);for(let S=0;S<l;S++){const T=NXt(d);g[S]=T,f+=T.samples.length;const M={...t,provider:n[S],result:T,densificationResult:d};v[S]=DXt(M,e)[Symbol.iterator]()}if(f>a.maxTotalSamples)throw new gA("too-complex");const _=await Promise.all(v.map(S=>{const T=S.next();return T.done===!0?Promise.resolve(null):T.value}));ct(e);for(let S=0;S<l;S++)g[S]=_[S];yield g,await Q9(t.delayAfterPreview??rm().delayAfterPreviewMillis,null,e.signal);const x=[];try{let S;do{S=!1;for(let T=0;T<l;T++){const M=v[T].next();M.done===!1&&(x.push({resultPromise:M.value,index:T}),S=!0)}}while(S)}finally{v.forEach(S=>S.return?.())}for(const{resultPromise:S,index:T}of x)g[T]=await S,ct(e),yield g;for(const S of g)S!=null&&(S.progress=1);yield g}function*DXt(t,e){const{densificationResult:i}=t,r={...t,abortOptions:e,densificationResult:i},s=RXt(0,r.result.samples.length),n=s.slice(0,r.provider.numSamplesForPreview);yield dAe(r,n,!0);const a=Let(s,r.provider.numSamplesPerChunk);for(const o of a)yield dAe(r,o,!1)}async function dAe({densificationResult:t,result:e,provider:i,queue:r,abortOptions:s,cache:n},a,o){const{densifiedPath:l,pathLength:u}=t,d=e.spatialReference,{samples:f}=e,g=[];for(let v=0;v<a.length;v++){const _=f[a[v]];g[v]=[..._.coordinate]}try{return await r.push({geometry:new Ho({spatialReference:d,points:g,hasZ:l.hasZ}),provider:i,indices:a,preview:o,result:e,queryOptions:{...rm().defaultQueryOptions(),minDemResolution:Math.round(o?u/i.numSamplesForPreview:u/f.length),cache:n}},s),{...e}}catch(v){return Zr(v)?null:hXt}}function kXt(t){return new fze({priority:Tt.ELEVATION_PROFILE,concurrency:1,scheduler:t,process:async e=>{ct(e.queryOptions);try{await LXt(e)}catch(i){Iee(i)}}})}async function LXt({geometry:t,provider:e,indices:i,preview:r,result:s,queryOptions:n}){if(i.length===0)return;const a=(await UXt(e,t,n)).geometry,{hasZ:o,points:l}=a,u=n.noDataValue,{samples:d}=s;for(let f=0;f<i.length;f++){const g=d[i[f]];if(g.isHole)continue;const v=o?l[f][2]:null;v===null||v===u?g.sampledZ=null:(s.hasZ=!0,g.sampledZ=v),g.sampled=!0}FXt(d),s.progress=r?0:s.progress+i.length/d.length,s.statistics=AXt(s.samples,s.spatialReference)}function FXt(t){const e=t.length-1;let i=0;for(let r=1;r<=e;r++)(t[r].sampled||r===e)&&(zXt(t,i,r),i=r)}function zXt(t,e,i){if(i-e===1)return;const r=t[e],s=r.sampledZ,n=t[i],a=n.sampledZ;if(s==null||a==null){for(let u=e+1;u<i;u++)t[u].sampledZ=null;return}const o=r.distance,l=n.distance-o;for(let u=e+1;u<i;u++){const d=t[u],f=(d.distance-o)/l;d.sampledZ=yt(s,a,f)}}function NXt({densifiedPath:t,distances:e}){const i=t.spatialReference,r=Xl(i),s=t.paths,n=s.length,a=[];let o=null,l=0;for(let u=0;u<n;u++){const d=s[u],f=d.length,g=e[u];for(let v=0;v<f;v++){const _=d[v],x=g[v];r&&(_[0]=sDe(_[0],r.valid[0],r.valid[1])),o&&v===0&&VXt(a,o,_,l,x),a.push(jXt(_,x)),o=_,l=x}}return{progress:0,samples:a,hasZ:!1,statistics:null,spatialReference:i}}function VXt(t,e,i,r,s){t.push(pAe(e,r)),t.push(pAe(i,s))}function jXt(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!1,isHole:!1}}function pAe(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!0,isHole:!0}}async function UXt(t,e,i){try{return await t.queryElevation(e,i)}catch{throw new gA("elevation-query-error")}}function BXt(t,e,i){if(!t||t.length===0)return;const r=t.length-1,s=t[0];if(e<=i(s))return s;const n=t[r];if(e>=i(n))return n;let a=0,o=0,l=r;for(;a<l;){o=a+Math.floor((l-a)/2);const u=t[o],d=i(u);if(d===e)return u;if(e<d){if(o>0){const f=t[o-1],g=i(f);if(e>g)return e-g>=d-e?u:f}l=o}else{if(o<r){const f=t[o+1],g=i(f);if(e<g)return e-d>=g-e?f:u}a=o+1}}return t[o]}const fAe=Symbol("line-change");let kb=class extends be{constructor(e){super(e),this._updateTask=null,this._paramsPerProfile=new Map,this._getUpdateParametersMemoized=dp((i,r,s)=>({stationary:i,visibleProfiles:r,generationParameters:s})),this._getGenerationParametersMemoized=dp((i,r,s,n,a,o,l)=>oz(r)&&ame(r)&&n!=null?{view:i,geometry:r,elevationInfo:s,options:o,queue:n,cache:a,slicePlane:l}:null),this._getElevationInfoMemoized=dp((i,r)=>({mode:i,offset:r})),this._getOptionsMemoized=dp((i,r)=>{const{densificationMaxSamples:s,maxTotalSamples:n}=rm();return{samplingDistance:i,densificationMaxSamples:Math.round(s/r),maxTotalSamples:n}}),this._updateThrottled=HWe(i=>this._update(i),rm().updateThrottleMillis)}initialize(){const e=this.viewModel;this.addHandles([X(()=>({visible:e.visible,profiles:e.profiles.toArray()}),({visible:i,profiles:r})=>{this._abortUpdate(),this._paramsPerProfile.clear(),this.removeHandles(fAe),i&&r.length!==0&&this.addHandles([...r.map(s=>Yu([s.attach(this.viewModel),s.on("change",()=>{this._invalidateProfile(s)})])),X(()=>this._updateParameters,this._updateThrottled,bt),this._updateThrottled],fAe)},bt)])}destroy(){this._paramsPerProfile.clear()}get _updateParameters(){const{viewModel:e}=this,i=e.view;return this._getUpdateParametersMemoized(i==null||i.stationary,this.viewModel.visibleProfiles,this._generationParameters)}get _generationParameters(){const{view:e,input:i,queue:r,tileCache:s}=this.viewModel;return e!=null&&e.ready?this._getGenerationParametersMemoized(e,i?.geometry,this._elevationInfo,r,s,this._options,e.type==="3d"?e.slice.plane:null):null}get _elevationInfo(){const e=this.viewModel.input,i=e?Pjt(e)?null:Hpe(e):null;return i!=null?this._getElevationInfoMemoized(i.mode,i.offset):null}get _options(){const e=this.viewModel,i=e.visibleProfiles.length;let r=e.minDemResolution??rm().defaultDemResolution;return r=parseFloat(r.toFixed(2)),this._getOptionsMemoized(r,i)}_update({stationary:e,visibleProfiles:i,generationParameters:r}){this._abortUpdate(),e&&(r!=null?this._updateTask=sc(async s=>{this.viewModel.error=null;const n=i.filter(o=>!this._isProfileValid(o,r)),a=IXt({...r,providers:n},{signal:s});try{for await(const o of a){ct(s),this._clearInvalidResults(r);for(let l=0;l<n.length;l++)n[l].result=o[l]}for(const o of n)this._paramsPerProfile.set(o,r)}catch(o){ml(o),this._abortUpdate(),this.viewModel.error=o,n.forEach(l=>{l.result=null})}}):this._clearResults())}_abortUpdate(){this._updateTask=Rs(this._updateTask)}_isProfileValid(e,i){return this._paramsPerProfile.has(e)&&this._paramsPerProfile.get(e)===i}_invalidateProfile(e){this._paramsPerProfile.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const i of this.viewModel.profiles.items)this._isProfileValid(i,e)||(i.result=null,this._paramsPerProfile.delete(i))}_clearResults(){for(const e of this.viewModel.profiles.items)e.result=null,this._paramsPerProfile.delete(e)}};c([p({nonNullable:!0})],kb.prototype,"viewModel",void 0),c([p()],kb.prototype,"_updateParameters",null),c([p()],kb.prototype,"_generationParameters",null),c([p()],kb.prototype,"_elevationInfo",null),c([p()],kb.prototype,"_options",null),kb=c([R("esri.widgets.ElevationProfile.ElevationProfileController")],kb);function qXt(t,e){if(t==null||e==null)return null;const{samples:i,spatialReference:r}=t,{distance:s,elevation:n}=e,a=Yr(r),o=ed(r),l=i.length,u=new Array(l);for(let d=0;d<l;++d){const f=i[d],g=f.sampledZ,v=f.coordinate;u[d]={x:v[0],y:v[1],z:g,distance:eZe(f.distance,a,s),elevation:J3(g,o,n)}}return u}function GXt(t,e){if(t==null||e==null||t.statistics==null||t.spatialReference==null)return null;const{distance:i,elevation:r}=e,{statistics:s,spatialReference:n}=t,a=Yr(n),o=ed(n);return{maxDistance:eZe(s.maxDistance,a,i),minElevation:J3(s.minElevation,o,r),maxElevation:J3(s.maxElevation,o,r),avgElevation:J3(s.avgElevation,o,r),elevationGain:J3(s.elevationGain,o,r),elevationLoss:J3(s.elevationLoss,o,r),maxPositiveSlope:s.maxPositiveSlope,maxNegativeSlope:s.maxNegativeSlope,avgPositiveSlope:s.avgPositiveSlope,avgNegativeSlope:s.avgNegativeSlope}}function eZe(t,e,i){return t==null?null:yi(t*e,"meters",i)}function J3(t,e,i){return t==null?null:yi(t*e,"meters",i)}let On=class extends Ju{constructor(e){super(e),this.type=null,this.id=I1(),this.title=null,this.color=new Je("#000000"),this.visible=!0,this._getSamplesMemoized=dp((i,r)=>qXt(i,r)),this._getStatisticsMemoized=dp((i,r)=>GXt(i,r)),this.viewVisualizationEnabled=!0,this.result=null,this.effectiveUnits=null,this.numSamplesForPreview=30,this.numSamplesPerChunk=200,this.chartFillEnabled=!0,this.chartStrokeWidth=1.5,this.chartStrokeOffsetY=0,this._viewModel=null}get progress(){return this.result!=null&&this.visible?this.result.progress:0}get samples(){return this._getSamplesMemoized(this.result,this.effectiveUnits)}get statistics(){return this._getStatisticsMemoized(this.result,this.effectiveUnits)}get hoveredPoint(){const e=this._viewModel?.hoveredChartPosition;return e!=null?this._getPoint(e):null}get available(){return!0}get hasZ(){const e=this.result;return e!=null&&e.hasZ}get minDemResolution(){return rm().defaultDemResolution}queryElevation(){throw new Error("not implemented")}attach(e){return this._viewModel=e,Yu([X(()=>e.effectiveUnits,i=>{this.effectiveUnits=i},bt),X(()=>[e.input],()=>this._onChange(),Ht)])}toggleVisibility(e){this.visible=e===void 0?!this.visible:e}_onChange(){this.emit("change")}_getPoint(e){const{samples:i,result:r}=this;if(i==null||r==null)return null;const s=i.length;if(s===0)return null;const n=i[s-1].distance,a=BXt(i,e*n,d=>d.distance);if(a==null)return null;const{x:o,y:l,z:u}=a;return u==null?null:new Ue({x:o,y:l,z:u,spatialReference:r.spatialReference})}};c([p({nonNullable:!0})],On.prototype,"id",void 0),c([p()],On.prototype,"title",void 0),c([p({type:Je,nonNullable:!0})],On.prototype,"color",void 0),c([p({nonNullable:!0})],On.prototype,"visible",void 0),c([p({readOnly:!0})],On.prototype,"progress",null),c([p({readOnly:!0})],On.prototype,"samples",null),c([p({readOnly:!0})],On.prototype,"statistics",null),c([p()],On.prototype,"hoveredPoint",null),c([p()],On.prototype,"viewVisualizationEnabled",void 0),c([p()],On.prototype,"available",null),c([p()],On.prototype,"result",void 0),c([p()],On.prototype,"effectiveUnits",void 0),c([p()],On.prototype,"numSamplesForPreview",void 0),c([p()],On.prototype,"numSamplesPerChunk",void 0),c([p()],On.prototype,"chartFillEnabled",void 0),c([p()],On.prototype,"chartStrokeWidth",void 0),c([p()],On.prototype,"chartStrokeOffsetY",void 0),c([p({readOnly:!0})],On.prototype,"hasZ",null),c([p({readOnly:!0})],On.prototype,"minDemResolution",null),c([p()],On.prototype,"_viewModel",void 0),On=c([R("esri.widgets.ElevationProfile.ElevationProfileLine")],On);const lz=On;function tZe(t){if(t==null)return null;if(Kdt(t))return iZe(t);const e=t.tileInfo;if(e==null)return null;const i=e.lods?.at(-1);return i==null?null:i.resolution*Yr(e.spatialReference)}function iZe(t){if(t==null)return null;const e=t.layers.items.map(HXt).filter(wl);return YOe(e)??null}function HXt(t){return t&&"tileInfo"in t?tZe(t):null}let ug=class extends lz{constructor(e){super(e),this.type="ground",this.color=new Je("#ff7f00"),this.viewVisualizationEnabled=!0,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getQueryElevationDependencies=dp((i,r)=>({ground:i,groundLayers:r}))}get available(){const e=this._ground;return e!=null&&e.layers.some(i=>i.visible)}get minDemResolution(){return iZe(this._ground)}get _queryElevationDependencies(){return this._getQueryElevationDependencies(this._ground,this._groundLayers)}get _ground(){return this._viewModel?.view?.map?.ground}get _groundLayers(){return this._ground?.layers?.toArray()??[]}async queryElevation(e,i){const r=this._queryElevationDependencies;if(r==null)throw new Error("ElevationProfileLineGround: no dependencies");const{ground:s}=r;if(s==null)throw new Error("No ground configured in the view");const n=await s.queryElevation(e,i),a=ed(e.spatialReference),o=ed(s.layers.at(0).spatialReference);if(a!==o){const l=n.geometry;l.points=l.points.map(([u,d,f])=>[u,d,f===i.noDataValue?f:f*o/a])}return n}attach(e){return Yu([super.attach(e),X(()=>this._queryElevationDependencies,()=>this._onChange())])}};c([p({type:Je,nonNullable:!0})],ug.prototype,"color",void 0),c([p()],ug.prototype,"viewVisualizationEnabled",void 0),c([p()],ug.prototype,"available",null),c([p({readOnly:!0})],ug.prototype,"minDemResolution",null),c([p()],ug.prototype,"_queryElevationDependencies",null),c([p()],ug.prototype,"_ground",null),c([p()],ug.prototype,"_groundLayers",null),ug=c([R("esri.widgets.ElevationProfile.ElevationProfileLineGround")],ug);const rZe=ug;let Mv=class extends lz{constructor(e){super(e),this.type="input",this.color=new Je("#00c8c8"),this.viewVisualizationEnabled=!1,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this.chartFillEnabled=!1,this.chartStrokeOffsetY=-1,this._getQueryElevationDependencies=dp((i,r,s,n,a)=>i?{elevationInfo:i,visibleLayers:r,view:s,stationary:n,spatialReference:a}:null)}get queryElevationDependencies(){const e=this._viewModel?.view;return e==null?null:this._getQueryElevationDependencies(this._elevationInfo,this._visibleLayers,e,e.stationary,e.spatialReference)}get available(){return!this._viewModel?.inputIsSketched}get _elevationInfo(){const e=this._viewModel?.input;return e?Hpe(e):null}get _visibleLayers(){return this._viewModel?.view?.map?.allLayers?.filter(e=>e.visible).toArray()??[]}async queryElevation(e,{noDataValue:i,signal:r}){const s=this.queryElevationDependencies;if(s==null)throw new Error("ElevationProfileLineInput: no dependencies");const{view:n,elevationInfo:a,spatialReference:o}=s;if(a.mode==="on-the-ground"&&n.type==="3d"&&o){const l=await XO.fromGeometry(e).project(o,r);if(!l)return{geometry:e,noDataValue:i};const u=n.elevationProvider;return l.coordinates.forEach(d=>{d.z=u.getElevation(d.x,d.y,0,o,"ground")??0}),{geometry:l.export(),noDataValue:i}}return{geometry:e,noDataValue:i}}attach(e){const i=()=>this._onChange();return Yu([super.attach(e),X(()=>this.queryElevationDependencies,i),tn(()=>e.elevationProvider,"elevation-change",i,{onListenerAdd:i,onListenerRemove:i})])}};c([p({type:Je,nonNullable:!0})],Mv.prototype,"color",void 0),c([p()],Mv.prototype,"viewVisualizationEnabled",void 0),c([p()],Mv.prototype,"queryElevationDependencies",null),c([p()],Mv.prototype,"available",null),c([p()],Mv.prototype,"_elevationInfo",null),c([p()],Mv.prototype,"_visibleLayers",null),Mv=c([R("esri.widgets.ElevationProfile.ElevationProfileLineInput")],Mv);const WXt=Mv;let Lb=class extends lz{constructor(e){super(e),this.type="query",this.color=new Je("#db334a"),this.viewVisualizationEnabled=!0,this.source=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return tZe(this.source)}get available(){const e=this.source;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(i=>i.visible))}queryElevation(e,i){if(!this.source)throw new Error("No source configured for the elevation profile line");return this.source.queryElevation(e,i)}attach(e){return Yu([super.attach(e),X(()=>this.source,()=>this._onChange(),Ht)])}};c([p({type:Je,nonNullable:!0})],Lb.prototype,"color",void 0),c([p()],Lb.prototype,"viewVisualizationEnabled",void 0),c([p()],Lb.prototype,"source",void 0),c([p({readOnly:!0})],Lb.prototype,"minDemResolution",null),c([p()],Lb.prototype,"available",null),Lb=c([R("esri.widgets.ElevationProfile.ElevationProfileLineQuery")],Lb);const ZXt=Lb,YXt=2e5;let Sc=class extends lz{constructor(e){super(e),this.type="view",this.color=new Je("#cf4ccf"),this.viewVisualizationEnabled=!0,this.include=null,this.exclude=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getQueryElevationDependencies=dp((i,r,s,n,a,o,l)=>({inputGraphicUid:i!=null?sZe(i):null,visibleLayers:r,maxIntersectionDistance:s,intersectOptions:n,view:a,stationary:o,spatialReference:l})),this._vecA=I(),this._vecB=I(),this._ray=$n()}get minDemResolution(){const e=this._viewModel?.view;if(e==null||e.type!=="3d")return null;const i=e.pointsOfInterest?.focus?.worldUnitsPerContentPixel;return i==null?null:i*ed(e.spatialReference)}get queryElevationDependencies(){const e=this._view;return e?this._getQueryElevationDependencies(this._viewModel?.input,this._visibleLayers,this._maxIntersectionDistance,this._intersectOptions,e,e.stationary,e.spatialReference):null}get _visibleLayers(){return this._view?.map?.allLayers?.filter(e=>e.visible).toArray()??[]}get _intersectOptions(){const e=this._view;return e==null||e.destroyed?{}:Qpe(e,{include:this.include,exclude:[...this._pointCloudLayers,...oO(this.exclude)?this.exclude:this.exclude?[this.exclude]:[]]})}get _pointCloudLayers(){const e=this._view;return e==null?[]:e.allLayerViews.toArray().filter(i=>i.layer?.type==="point-cloud").map(i=>i.layer)}get _view(){const e=this._viewModel?.view;return e!=null&&e.type==="3d"?e:null}get _maxIntersectionDistance(){const e=this._view;return e?.renderCoordsHelper?xr(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(e==null)return null;const i=new Zu(e.state.viewingMode),r=i.options;return r.hud=!1,r.invisibleTerrain=!1,r.backfacesTerrain=!1,r.selectionMode=!1,r.store=2,i}async queryElevation(e,{noDataValue:i,signal:r}){const s=this.queryElevationDependencies;if(s==null)throw new Error("ElevationProfileLineInput: no dependencies");const n=this._intersector;if(n==null)throw new Error("ElevationProfileLineInput: no view");const{intersectOptions:a,view:o,spatialReference:l}=s,u=o.renderCoordsHelper,d=o.sceneIntersectionHelper,f=this._vecA,g=this._vecA,v=this._vecB,_=this._ray;if(!l)return{geometry:e,noDataValue:i};const x=await XO.fromGeometry(e).project(l,r);if(!x)return{geometry:e,noDataValue:i};const S=x.coordinates,T=S.length;for(let M=0;M<T;++M){const E=S[M];xe(v,E.x,E.y,E.z??0),u.toRenderCoords(v,l,v),u.setAltitude(f,YXt,v);const P=tde(f,v,_);d.computeIntersection(P,n,!0,a);const O=JXt(s,n.results.all);O?(O.getIntersectionPoint(g),u.fromRenderCoords(g,g,l),E.z=g[2]):E.z=i}return{geometry:x.export(),noDataValue:i}}attach(e){const i=()=>this._onChange();return Yu([super.attach(e),X(()=>this.queryElevationDependencies,i),tn(()=>e.elevationProvider,"elevation-change",i,{onListenerAdd:i,onListenerRemove:i})])}};function JXt({view:t,inputGraphicUid:e,maxIntersectionDistance:i},r){for(const s of r){if(!s.withinDistance(i))continue;const n=qjt(s,t);if(n==null||sZe(n)!==e)return s}return null}function sZe(t){if(t.layer&&"objectIdField"in t.layer){const e=t.attributes[t.layer.objectIdField];if(e)return`o-${t.layer.id}-${e}`}return`u-${t.uid}`}c([p({type:Je,nonNullable:!0})],Sc.prototype,"color",void 0),c([p()],Sc.prototype,"viewVisualizationEnabled",void 0),c([p()],Sc.prototype,"include",void 0),c([p()],Sc.prototype,"exclude",void 0),c([p({readOnly:!0})],Sc.prototype,"minDemResolution",null),c([p()],Sc.prototype,"queryElevationDependencies",null),c([p()],Sc.prototype,"_visibleLayers",null),c([p()],Sc.prototype,"_intersectOptions",null),c([p()],Sc.prototype,"_pointCloudLayers",null),c([p()],Sc.prototype,"_view",null),c([p()],Sc.prototype,"_maxIntersectionDistance",null),c([p()],Sc.prototype,"_intersector",null),Sc=c([R("esri.widgets.ElevationProfile.ElevationProfileLineView")],Sc);const QXt=Sc,XXt={base:lz,key:"type",typeMap:{ground:rZe,input:WXt,query:ZXt,view:QXt},errorContext:"elevation-profile-line"},KXt=ke.ofType(XXt);let gg=class extends UNe(oje(zs)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new FS,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}get loaded(){return super.loaded}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}graphicChanged(e){this.emit("graphic-update",e)}};c([p({type:pg})],gg.prototype,"elevationInfo",void 0),c([p(L5(FS,"graphics"))],gg.prototype,"graphics",void 0),c([p({type:["show","hide"]})],gg.prototype,"listMode",void 0),c([p()],gg.prototype,"screenSizePerspectiveEnabled",void 0),c([p({readOnly:!0})],gg.prototype,"type",void 0),c([p({constructOnly:!0})],gg.prototype,"internal",void 0),gg=c([R("esri.layers.GraphicsLayer")],gg);function mAe(t){switch(t){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the symbol type is not supported"}return""}function eKt(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return 1;const e=t.operations?.data.type;if(!e)return 3;switch(e){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}return 0}function tKt(t){return iKt(t).result}function iKt(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return{result:1};if(!t.operations)return{result:2};const e=t.operations.data.type,i=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:0,geometry:i}:{result:3}}function rKt(t){if(t.layer?.type!=="graphics")return 1;if(t.geometry==null)return 2;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return e&&e.some(i=>i.type==="object")?0:4}function gAe(t,e,i){if(!e||!t?.map)return;const{map:r}=t;r.layers.find(n=>n===e)||r.add(e,i)}function FAi(t,e){const i=e?.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(r=>{const s=r.layer;return s===i||"sublayers"in s&&s.sublayers!=null&&s.sublayers.includes(i)})}function zAi(t){return r5e(t)||r0(t)||Adt(t)||Rdt(t)}let R8=class extends be{constructor(e){super(e),this.enabled=!1}};c([p({type:Boolean,nonNullable:!0})],R8.prototype,"enabled",void 0),R8=c([R("esri.views.interactive.sketch.SketchLabelOptions")],R8);const lme=R8;let d5=class extends be{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([p({type:String,nonNullable:!0})],d5.prototype,"mode",void 0),d5=c([R("esri.views.interactive.sketch.SketchTooltipElevationOptions")],d5);let Fl=class extends be{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"area",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"coordinates",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"direction",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"distance",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"elevation",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"header",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"helpMessage",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"orientation",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"radius",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"rotation",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"scale",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"size",void 0),c([p({type:Boolean,nonNullable:!0})],Fl.prototype,"totalLength",void 0),Fl=c([R("esri.views.interactive.sketch.SketchTooltipVisibleElements")],Fl);const nZe=Fl;let Tc=class extends be{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new d5,this.placement="auto",this.offset=null,this.visibleElements=new nZe,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([p({type:Boolean,nonNullable:!0})],Tc.prototype,"enabled",void 0),c([p()],Tc.prototype,"forceEnabled",void 0),c([p()],Tc.prototype,"effectiveEnabled",null),c([p()],Tc.prototype,"helpMessage",void 0),c([p()],Tc.prototype,"helpMessageIcon",void 0),c([p({type:Boolean,nonNullable:!0})],Tc.prototype,"inputEnabled",void 0),c([p({type:d5,nonNullable:!0})],Tc.prototype,"elevation",void 0),c([p()],Tc.prototype,"placement",void 0),c([p()],Tc.prototype,"offset",void 0),c([p({type:nZe,nonNullable:!0})],Tc.prototype,"visibleElements",void 0),c([p()],Tc.prototype,"visualVariables",void 0),c([p()],Tc.prototype,"xyMode",void 0),Tc=c([R("esri.views.interactive.sketch.SketchTooltipOptions")],Tc);const cme=Tc;let Q3=class extends be{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([p()],Q3.prototype,"length",void 0),c([p()],Q3.prototype,"verticalLength",void 0),c([p()],Q3.prototype,"area",void 0),Q3=c([R("esri.views.interactive.sketch.Units")],Q3);const o9=Q3;let Fb=class extends be{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?"relative-bilateral":"relative";case"absolute":return"absolute"}}get displayUnits(){return this._get("displayUnits")??new o9}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new o9}set inputUnits(e){this._set("inputUnits",e)}};c([p({type:String,nonNullable:!0})],Fb.prototype,"directionMode",void 0),c([p({type:Boolean,nonNullable:!0})],Fb.prototype,"relativeDirectionIsBilateral",void 0),c([p()],Fb.prototype,"effectiveDirectionMode",null),c([p({type:o9,nonNullable:!0})],Fb.prototype,"displayUnits",null),c([p({type:o9,nonNullable:!0})],Fb.prototype,"inputUnits",null),Fb=c([R("esri.views.interactive.sketch.SketchValueOptions")],Fb);const ume=Fb;let X3=class extends be{constructor(e){super(e),this.labels=new lme,this.tooltips=new cme,this.values=new ume}};c([p({nonNullable:!0,type:lme})],X3.prototype,"labels",void 0),c([p({nonNullable:!0,type:cme})],X3.prototype,"tooltips",void 0),c([p({nonNullable:!0,type:ume})],X3.prototype,"values",void 0),X3=c([R("esri.views.interactive.sketch.SketchOptions")],X3);const aZe=X3;function oZe(t,e,i){return sd(t,e,i)}function sd(t=0,e=0,i=0){return Ye(t,e,i)}function HAi(t){return t}function WAi(t){return t}function $1(t,e,i){return Ye(t,e,i)}function tP(t){const[e,i,r]=t;return t.length>3?[e,i,r,t[3]]:[e,i,r]}function nee(t){return t[3]=1|((t.length>3?t[3]:void 0)??0),t}function ZAi(t){return!!(1&((t.length>3?t[3]:void 0)??0))}function yAe(t,e,{coordinateHelper:i,elevationInfo:r},s){return t?o4(i.vectorToDehydratedPoint(t,sKt),e,r,s):null}function o4(t,e,i,r=sd()){return r[0]=t.x,r[1]=t.y,r[2]=t.z??0,e==null||(e.type==="2d"?r[2]=0:r[2]=Djt(e,t,i,u$)??0),r}function YAi(t,e,i){return i?(h6e(i,t[0],t[1],t[2],e),i):vm(t[0],t[1],t[2],e)}function vAe(t,e,{z:i,m:r},s,n){const{spatialReference:a,elevationInfo:o}=s;let l;i==null&&r==null?l=void 0:e==null||e.type==="2d"?l=i??void 0:l=BGe(e,t,a,u$,o)??0;const[u,d]=t;return n?h6e(n,u,d,l,a):n=vm(u,d,l,a),r!=null&&(n.m=r,n.hasM=!0),n}function JAi(t,e,i,r,s=sd()){const[n,a]=t;return s[0]=n,s[1]=a,t.length>3&&(s[3]=t[3]??0),i?.type!=="3d"?(s[2]=e.value,s):(s[2]=Wpe(i,n,a,e.value,r,e.elevationInfo,u$)??0,s)}const sKt=vm(0,0,0,null);let Jf=class extends ae{constructor(){super(...arguments),this.enabled=!0}};c([p({type:Boolean})],Jf.prototype,"enabled",void 0),Jf=c([R("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Jf);let Gs=class extends ae{constructor(e){super(e),this.lineSnapper=new Jf,this.parallelLineSnapper=new Jf,this.rightAngleSnapper=new Jf,this.rightAngleTriangleSnapper=new Jf,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Je([255,127,0]),this.orangeTransparent=new Je([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([p({type:Jf,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Gs.prototype,"lineSnapper",void 0),c([p({type:Jf,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Gs.prototype,"parallelLineSnapper",void 0),c([p({type:Jf,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Gs.prototype,"rightAngleSnapper",void 0),c([p({type:Jf,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Gs.prototype,"rightAngleTriangleSnapper",void 0),c([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Gs.prototype,"shortLineThreshold",void 0),c([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Gs.prototype,"distance",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Gs.prototype,"pointThreshold",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Gs.prototype,"intersectionParallelLineThreshold",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Gs.prototype,"parallelLineThreshold",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Gs.prototype,"verticalLineThresholdMeters",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Gs.prototype,"touchSensitivityMultiplier",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Gs.prototype,"pointOnLineThreshold",void 0),c([p({type:Je,nonNullable:!0})],Gs.prototype,"orange",void 0),c([p({type:Je,nonNullable:!0})],Gs.prototype,"orangeTransparent",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Gs.prototype,"lineHintWidthReference",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Gs.prototype,"lineHintWidthTarget",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Gs.prototype,"lineHintFadedExtensions",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Gs.prototype,"parallelLineHintWidth",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],Gs.prototype,"parallelLineHintLength",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],Gs.prototype,"parallelLineHintOffset",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],Gs.prototype,"rightAngleHintSize",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],Gs.prototype,"rightAngleHintOutlineSize",void 0),c([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],Gs.prototype,"satisfiesConstraintScreenThreshold",void 0),Gs=c([R("esri.views.interactive.snapping.Settings.Defaults")],Gs);const l9=new Gs;let Gv=class extends be{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new ke}};c([p({constructOnly:!0})],Gv.prototype,"layer",void 0),c([p()],Gv.prototype,"enabled",void 0),c([p()],Gv.prototype,"updating",void 0),c([p()],Gv.prototype,"availability",void 0),c([p()],Gv.prototype,"sublayerSources",void 0),Gv=c([R("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Gv);let Ga=class extends be{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new ke,this.distance=l9.distance,this.touchSensitivityMultiplier=l9.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(_Ae)&&re.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const i=e.filter(aKt),r=this._get("_effectiveFeatureSources")?.filter(_Ae)??new ke;for(const l of i){const u=r.find(d=>d.layer===l.layer.parent);if(u)u.sublayerSources.includes(l)||u.sublayerSources.add(l);else if(l.layer.parent){const d=new Gv({layer:l.layer.parent});d.sublayerSources.add(l),r.add(d)}}for(const l of r){const u=l.sublayerSources.filter(d=>!i.includes(d));l.sublayerSources.removeMany(u)}r.removeMany(r.filter(l=>l.sublayerSources.length===0));const s=e.filter(nKt),n=this._get("_effectiveFeatureSources")??new ke,{added:a,removed:o}=W8(n.toArray(),[...s,...r]);return n.removeMany(o),n.addMany(a),n}};function _Ae(t){return t.layer.type==="subtype-group"}function nKt(t){return t.layer.type!=="subtype-group"}function aKt(t){return t.layer.type==="subtype-sublayer"}c([p()],Ga.prototype,"enabled",void 0),c([p()],Ga.prototype,"enabledToggled",void 0),c([p()],Ga.prototype,"forceDisabled",void 0),c([p()],Ga.prototype,"selfEnabled",void 0),c([p()],Ga.prototype,"featureEnabled",void 0),c([p()],Ga.prototype,"gridEnabled",void 0),c([p()],Ga.prototype,"attributeRulesEnabled",void 0),c([p({type:ke.ofType(Gv)})],Ga.prototype,"featureSources",void 0),c([p()],Ga.prototype,"distance",void 0),c([p()],Ga.prototype,"touchSensitivityMultiplier",void 0),c([p({readOnly:!0})],Ga.prototype,"effectiveEnabled",null),c([p({readOnly:!0})],Ga.prototype,"effectiveGridEnabled",null),c([p({readOnly:!0})],Ga.prototype,"effectiveSelfEnabled",null),c([p({readOnly:!0})],Ga.prototype,"effectiveFeatureEnabled",null),c([p({readOnly:!0})],Ga.prototype,"_effectiveFeatureSources",null),Ga=c([R("esri.views.interactive.snapping.SnappingOptions")],Ga);const tOi=Symbol("grid-placement-graphic");function lZe(t,e){const i=t.x-e.x,r=t.y-e.y;return i*i+r*r}function iOi(t,e){return Math.sqrt(lZe(t,e))}function oKt(t,e){e.sort((i,r)=>Mn(i.targetPoint,t)-Mn(r.targetPoint,t))}function rOi({parameters:{point:t,distance:e,returnEdge:i,vertexMode:r,coordinateHelper:{spatialReference:s},filter:n},mode:a,returnZ:o,filter:l}){const u=l?.clone()??new Ct({where:"1=1"});return u.returnZ=o??a==="3d",n&&(u.geometry=n.geometry,u.distance=n.distance,u.spatialRelationship=n.spatialRelationship,u.where=$4(u.where,n.where),u.timeExtent=Cdt(u.timeExtent,n.timeExtent),u.objectIds=lKt(u.objectIds,n.objectIds)),{point:vm(t[0],t[1],t[2],s.toJSON()),mode:a,distance:e,returnEdge:i,vertexMode:r,query:u.toJSON()}}function lKt(t,e){return t||e?e?t?Array.from(APe(new Set(t),new Set(e))):e:t:null}function sOi(t,e,i){return{left:yAe(t.leftVertex.pos,e,i),right:yAe(t.rightVertex.pos,e,i)}}const bAe=Symbol("snapping-toggle");function cKt(t,e=()=>{}){const i=X(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:r,snappingOptions:s})=>{if(t.removeHandles(bAe),!r||!s)return;const n=Br.TOOL,a=[r.on("key-down",o=>{o.key!==b1e.toggle||o.repeat||(s.enabledToggled=!0,e())},n),r.on("key-up",o=>{o.key===b1e.toggle&&(s.enabledToggled=!1,e())},n),r.on("pointer-move",o=>{const l=o.native.ctrlKey;s.enabledToggled!==l&&(s.enabledToggled=l,e())},n)];t.addHandles(a,bAe)},bt);t.addHandles(i)}function nOi(t){return VU(t)&&"utilityNetworks"in t&&!!t.utilityNetworks?.length}function aOi(t){return t?.type==="line"}function aee(t,e){return t[0]*e[1]-t[1]*e[0]}function uKt(t,e,i){const r=dn(i,e)/D0(i);return Nh(t,i,r)}function oOi(t,e,i,r,s=i){return Os(GS,r,i),Os(c9,e,s),uKt(iP,c9,GS),bg(t,s,iP)}function lOi(t,e,i,r){Os(GS,e,i);const s=r/yO(GS);return em(t,i,GS,s)}function cOi(t,e){const i=t.start,r=t.end,s=e.start,n=e.end,a=Os(GS,r,i),o=Os(cZe,n,s),l=aee(a,o);if(Math.abs(l)<=dKt)return[];const u=Os(c9,i,s),d=aee(o,u)/l;return aee(a,u)/l,d>=0?[em(iP,i,a,d)]:[em(iP,i,a,d)]}function hKt(t,e,i){const r=[],s=Os(GS,t.end,t.start),n=Os(cZe,t.start,e),a=D0(s),o=2*dn(s,n),l=o*o-4*a*(D0(n)-i*i);if(l===0){const u=-o/(2*a);r.push(em(iP,t.start,s,u))}else if(l>0){const u=Math.sqrt(l),d=(-o+u)/(2*a);r.push(em(iP,t.start,s,d));const f=(-o-u)/(2*a);r.push(em(c9,t.start,s,f))}return r}const dKt=1e-6,GS=Ke(),cZe=Ke(),c9=Ke(),iP=Ke();function hme({start:t,end:e,type:i},r,s){const n=[],a=Os(cz,e,t),o=Os(uW,t,r),l=D0(a),u=2*dn(a,o),d=u*u-4*l*(D0(o)-s*s);if(d===0){const f=-u/(2*l);(i===0||f>=0)&&n.push(em(Ke(),t,a,f))}else if(d>0){const f=Math.sqrt(d),g=(-u+f)/(2*l);(i===0||g>=0)&&n.push(em(Ke(),t,a,g));const v=(-u-f)/(2*l);(i===0||v>=0)&&n.push(em(Ke(),t,a,v))}return n}function uZe(t,e){const i=t.start,r=t.end,s=Os(cz,r,i),n=xe(dW,-s[1],s[0],0),a=e.start,o=e.end,l=xi(pme,o,a),u=Le(l,n),d=xe(vZe,i[0],i[1],0),f=xi(_Ze,d,a),g=Le(f,n),v=_n();if(Math.abs(u)<v)return[];const _=Fr(bZe,a,l,g/u);if(e.type===0){const x=xi(Hoe,_,a);if(Le(x,l)<-v)return[]}if(t.type===1){const x=c7(uW,_,i);if(dn(x,s)<-v)return[]}return[Tr(_)]}function pKt(t,e){return mKt(u9(fme,e[2],t),e)}function hZe(t,e){return gZe(u9(fme,0,t),u9(_Kt,0,e)).map(([r,s])=>Cs(r,s))}function dZe(t,e,i){return fZe(t,u9(fme,t[2],e),i)}function pZe(t,e,i,r=I()){const s=Os(cz,t,e),n=yO(s);return em(r,e,s,n===0?1:i/n),r[2]=t[2],r}function fZe(t,{start:e,end:i,type:r},s=I()){const n=xi(hW,t,e),a=xi(dW,i,e),o=Le(n,a)/Le(a,a);return Fr(s,e,a,r===0?Math.max(o,0):o)}const fKt=(()=>{const t=I(),e=I(),i=I();return({start:r,end:s},{center:n,radius:a,normal:o,slicePlane:l})=>{const u=Qg(n,o,vKt);if(js(jne(u,r),0)&&js(jne(u,s),0)){Qhe(o,t,e);const f=(_,x)=>(Ae(i,x,n),oi(_,Le(i,t),Le(i,e)),_),g=hKt({start:f(cz,r),end:f(uW,s)},f1,a),v=[];for(const[_,x]of g){const S=me(I(),n);Fr(S,S,t,_),Fr(S,S,e,x),l&&!Vw(l,S)||v.push(S)}return v}const d=I();return Ije(u,r,s,d)?!js(Bi(d,n),a)||l&&!Vw(l,d)?[]:[d]:[]}})();function mZe({start:t,end:e,type:i},r,s){const n=[],a=Ae(hW,e,t),o=Os(uW,t,r),l=D0(a),u=2*dn(a,o),d=u*u-4*l*(D0(o)-s*s);if(d===0){const f=-u/(2*l);(i===1||f>=0)&&n.push(Fr(I(),t,a,f))}else if(d>0){const f=Math.sqrt(d),g=(-u+f)/(2*l);(i===1||g>=0)&&n.push(Fr(I(),t,a,g));const v=(-u-f)/(2*l);(i===1||v>=0)&&n.push(Fr(I(),t,a,v))}return n}function gZe(t,e){const i=t.start,r=t.end,s=e.start,n=e.end,a=xi(hW,r,i),o=xi(dW,n,s),l=xi(pme,s,i),u=At(vZe,a,o);if(!js(Le(l,u),0))return[];const d=r$(u);if(js(d,0))return[];const f=At(_Ze,l,o),g=Le(f,u)/d,v=Fr(bZe,i,a,g);if(t.type===0){const _=xi(Hoe,v,i);if(Le(a,_)<-_n())return[]}if(e.type===0){const _=xi(Hoe,v,s);if(Le(o,_)<-_n())return[]}return[Tr(v)]}function mKt({start:t,end:e,type:i},r){const s=xi(hW,r,t),n=xi(dW,e,t),a=At(pme,n,s),o=r$(a)/r$(n),l=_n();if(o<l)switch(i){case 1:return[Tr(r)];case 0:return Le(n,s)<-l?[]:[Tr(r)]}return[]}function dme(t,e,i,r){const[s,n]=t,[a,o]=i,l=a-s,u=o-n,d=l*l+u*u,f=Math.sqrt(d);if(f>e+r)return[];if(f<Math.abs(e-r))return[];if(js(f,0)&&js(e,r))return[];const g=(e*e-r*r+d)/(2*f),v=Math.sqrt(e*e-g*g),_=v*u/f,x=v*l/f,[S,T]=Ou(cz,t,i,g/f);return js(_,x)?[Cs(S,T)]:[Cs(S+_,T-x),Cs(S-_,T+x)]}function u9(t,e,{start:i,end:r,type:s}){return xe(t.start,i[0],i[1],e),xe(t.end,r[0],r[1],e),t.type=yKt[s],t}function yZe(t,e){return js(t[2],e[2])}function js(t,e){return yl(Math.abs(t-e),0,_n())}function gKt(t,e){return e.filter(i=>Vw(t,i))}function Vw(t,e){return tL(t,e)}const yKt={0:1,1:0},cz=Ke(),uW=Ke(),hW=I(),dW=I(),pme=I(),vZe=I(),_Ze=I(),bZe=I(),Hoe=I(),vKt=Ui(),fme={start:I(),end:I(),type:1},_Kt={start:I(),end:I(),type:1};class Dp{intersect(e){return Ev(this,e)}closestPoints(e){return[this.closestTo(e)]}}class qP extends Dp{constructor(e){super(),this.point=e}equals(e){return this===e||xf(e)&&di(this.point,e.point)}closestTo(){return tP(this.point)}}class mme extends Dp{constructor(e,i,r){super(),this.start=e,this.end=i,this.lineLike={start:e,end:i,type:r}}equals(e){return this===e||yg(e)&&this.lineLike.type===e.lineLike.type&&di(this.start,e.start)&&di(this.end,e.end)}closestTo(e){const i=sd();return fZe(e,this.lineLike,i),i}}class gme extends mme{constructor(e,i){super(e,i,1)}}class bKt extends mme{constructor(e,i){super(e,i,0)}}class wZe extends Dp{constructor(e){super(),this.constraints=e}equals(e){return this===e||Woe(e)&&E0(this.constraints,e.constraints,(i,r)=>i.equals(r))}closestTo(e){let i,r=1/0;for(const s of this.constraints){const n=s.closestTo(e),a=Mn(e,n);a<r&&(r=a,i=n)}return tP(i??e)}closestPoints(e){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(e))}}class xZe extends Dp{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||_g(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=sd();return pZe(e,this.center,this.radius,i),i}}class yme extends Dp{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||Ov(e)&&di(this.center,e.center)&&this.radius===e.radius}closestTo(e){const i=sd();return pZe(e,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new vme(tP(this.center),this.radius,$1(0,0,1))}}class vme extends Dp{constructor(e,i,r,s=void 0){super(),this.center=e,this.radius=i,this.normal=r,this.slicePlane=s}equals(e){return this===e||zb(e)&&di(this.center,e.center)&&di(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:i,radius:r}=this;ede(this.getPlane(wKt),e,oee);const s=xi(oee,oee,i),n=ea(s);if(js(n,0))return tP(e);const a=r/Math.sqrt(n),o=sd();Fr(o,i,s,a);const{slicePlane:l}=this;return l&&!Vw(l,o)?bme(l,this)?.closestTo(e)??tP(e):o}getPlane(e=Ui()){return Qg(this.center,this.normal,e)}}const oee=I(),wKt=Ui();class xKt extends Dp{constructor(e){super(),this.z=e}equals(e){return this===e||Av(e)&&this.z===e.z}closestTo(e){return $1(e[0],e[1],this.z)}getPlane(e=Ui()){return xe(wAe,0,0,this.z),Qg(wAe,L0,e)}}const wAe=I();class _me extends Dp{constructor(e,i,r){super(),this.start=e,this.end=i,this.planeLike={start:e,end:i,type:r}}equals(e){return this===e||vg(e)&&this.planeLike.type===e.planeLike.type&&di(this.start,e.start)&&di(this.end,e.end)}closestTo(e){const i=sd();return dZe(e,this.planeLike,i),i}closestEndTo(e){const{start:i,end:r}=this.planeLike;return Math.sign(dn(Os(SKt,r,i),Os(TKt,e,i)))>0?this.end:this.start}getPlane(e=Ui()){const i=me(xAe,this.end);return i[2]+=1,Fh(this.start,this.end,i,e)}getSlicePlane(e=Ui()){const{start:i,end:r,type:s}=this.planeLike;if(s===0)return;const n=xe(xAe,i[0],i[1],0),a=xe(SAe,r[0],r[1],0),o=Ae(SAe,a,n);return Qg(n,o,e),e}}const SKt=Ke(),TKt=Ke(),xAe=I(),SAe=I();class uOi extends _me{constructor(e,i){super(e,i,1)}}class SZe extends _me{constructor(e,i){super(e,i,0)}}class $Kt extends Dp{constructor(e,i){super(),this.sphere=ude(e,i),this._center=Tr(e)}equals(e){return this===e||Pv(e)&&Yje(this.sphere,e.sphere)}closestTo(e){const i=sd();return dH(this.sphere,e,i),i}get center(){return this._center}get radius(){return this.sphere[3]}}class TZe extends Dp{constructor(e,i,r){super(),this.start=e,this.end=i,this.getZ=r,this.planeLike={start:e,end:i,type:0}}equals(e){return this===e||h9(e)&&di(this.start,e.start)&&di(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return PKt(this,e)}addIfOnTheGround(e,i){for(const r of i){const s=this.getZ(r[0],r[1])??0;js(r[2],s)&&(r[2]=s,e.push(r))}}}class CKt extends Dp{constructor(e,i,r){super(),this._x=e,this._y=i,this._z=r}equals(e){return this===e||WKt(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,i,r]){return oZe(this._x??e,this._y??i,this._z??r)}}class MKt extends Dp{constructor(e,i,r,s,n){super(),this._origin=e,this._spatialReference=i,this._distanceMeters=r,this._z=s,this._directionDegrees=n}equals(e){return this===e||HKt(e)&&bq(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,i,r]){return oi(iD,e,i),bq(iD,this._origin)||this._applyDirectionAndDistance(iD),oZe(iD[0],iD[1],this._z??r)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Nw(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)AKt(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=BP(EKt,this._origin,e,this._spatialReference);Nw(e,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const iD=[0,0],EKt=new az;function AKt(t,e,i,r,s){let{azimuth:n,distance:a}=BP(OKt,e,r,s);n??=0;let o=a*Math.cos((n-i)*Rc);o=Math.max(0,o),Nw(t,e,i,o,s)}const OKt=new az;function PKt(t,e){const i=sd();return dZe(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??CZe,i}function Ev(t,e){if(Woe(t)){const i=[];for(const r of t.constraints){const s=r.intersect(e);s&&i.push(s)}return wme(i)}if(Woe(e))return Ev(e,t);if(h9(t))return TAe(t,e);if(h9(e))return TAe(e,t);if(xf(t)){const{point:i}=t;if(xf(e))return di(i,e.point)?t:void 0;const r=e.closestTo(i);return m1(r,i)?t:void 0}if(yg(t)){if(xf(e))return Ev(e,t);if(yg(e))return Qf(gZe(t.lineLike,e.lineLike));if(Av(e))return RKt(t,e);if(vg(e))return Qf(uZe(e.planeLike,t.lineLike));if(_g(e))return Qf(mZe(t.lineLike,e.center,e.radius));if(zb(e))return Qf(fKt(t.lineLike,e));if(Ov(e))return IKt(t,e);if(Pv(e))return DKt(t,e)}else if(Av(t)){if(xf(e)||yg(e))return Ev(e,t);if(Av(e))return kKt(t,e);if(vg(e))return LKt(t,e);if(_g(e))return FKt(t,e);if(zb(e))return NKt(t,e);if(Ov(e))return zKt(t,e);if(Pv(e))return VKt(t,e)}else if(vg(t)){if(xf(e)||yg(e)||Av(e))return Ev(e,t);if(vg(e))return lee(hZe(t.planeLike,e.planeLike));if(_g(e))return lee(hme(t.planeLike,e.center,e.radius));if(zb(e))return UKt(t,e);if(Ov(e))return jKt(t,e);if(Pv(e))return BKt(t,e)}else if(_g(t)){if(xf(e)||yg(e)||Av(e)||vg(e))return Ev(e,t);if(_g(e))return lee(dme(t.center,t.radius,e.center,e.radius));if(zb(e))return void 0;if(Ov(e))return qKt(t,e);if(Pv(e))return void 0}else if(zb(t)){if(xf(e)||yg(e)||Av(e)||vg(e)||_g(e))return Ev(e,t);if(zb(e))return void 0;if(Ov(e))return e.asCircle(),void 0;if(Pv(e))return void 0}else if(Ov(t)){if(xf(e)||yg(e)||Av(e)||vg(e)||_g(e)||zb(e))return Ev(e,t);if(Ov(e))return GKt(e,t);if(Pv(e))return void 0}else if(Pv(t)){if(xf(e)||yg(e)||Av(e)||vg(e)||_g(e)||Ov(e))return Ev(e,t);if(Pv(e))return void 0}}const RKt=(()=>{const t=Ui();return(e,i)=>{const{start:r,end:s}=e;if(yZe(r,s)&&js(r[2],i.z))return e;const n=sd();return Ije(i.getPlane(t),r,s,n)?new qP(n):void 0}})();function IKt({lineLike:t},{center:e,radius:i}){const r=e[2];return Qf(mZe(t,e,i).filter(s=>js(s[2],r)))}function DKt({lineLike:t},{sphere:e}){return Qf(Kje(e,t.start,t.end))}const bme=(()=>{const t=li(),e=I(),i=I();return(r,s,n)=>{const{normal:a,center:o,radius:l}=s;Qhe(a,e,i);const u=r,d=l*Le(u,e),f=l*Le(u,i);Or(t,o[0],o[1],o[2],1);const g=zhe(r,t),v=Math.hypot(d,f),_=js(v,0);if(js(jne(r,o),0)){if(_)return s;if(js(l,0))return!n||Vw(n,o)?new qP(tP(o)):void 0;At(e,u,a),Re(e,e);const D=new Array,L=Tr(o);Fr(L,L,e,l),n&&!Vw(n,L)||D.push(L);const F=Tr(o);return Fr(F,F,e,-l),n&&!Vw(n,F)||D.push(F),Qf(D)}if(_)return;const x=-g/v;if(Math.abs(x)>1||js(x,1))return;const S=Math.atan(d/f),T=Qh(x)-S,M=Math.PI-T,E=new Array,P=I();Fr(P,o,e,l*Math.cos(T)),Fr(P,P,i,l*Math.sin(T)),E.push(P);const O=I();return Fr(O,o,e,l*Math.cos(M)),Fr(O,O,i,l*Math.sin(M)),E.push(O),Qf(n?gKt(n,E):E)}})();function kKt(t,e){return js(t.z,e.z)?t:void 0}function LKt({z:t},{planeLike:e}){const[i,r]=e.start,[s,n]=e.end,a=$1(i,r,t),o=$1(s,n,t);return e.type===0?new gme(a,o):new bKt(a,o)}function FKt(t,e){const[i,r]=e.center;return new yme($1(i,r,t.z),e.radius)}function zKt(t,e){return js(e.center[2],t.z)?e:void 0}const NKt=(()=>{const t=Ui();return(e,i)=>bme(e.getPlane(t),i,i.slicePlane)})();function VKt(t,{center:e,radius:i}){const r=Math.abs(e[2]-t.z);if(r>i&&!js(r,i))return;const s=$1(e[0],e[1],t.z),n=Math.sqrt(i**2-r**2);return js(n,0)?void 0:new yme(s,n)}const jKt=(()=>{const t=Ui();return(e,{center:i,radius:r})=>{const s=hme(e.planeLike,i,r),n=i[2];e.getSlicePlane(t);const a=new Array;for(const[o,l]of s){const u=[o,l,n];Vw(t,u)&&a.push(u)}return Qf(a)}})(),UKt=(()=>{const t=Ui(),e=Ui();return(i,r)=>bme(i.getPlane(t),r,i.getSlicePlane(e))})(),BKt=(()=>{const t=Ui();return(e,{center:i,radius:r})=>{const s=e.getPlane(t),n=Ya(s,i),a=Math.abs(n);if(a>r&&!js(a,r))return;const o=Math.sqrt(r**2-n**2);if(js(o,0)){const d=sd();return ede(s,i,d),new qP(d)}const l=sd(),u=Tr(s);return Fr(l,i,u,n),new vme(l,o,u,e.getSlicePlane())}})();function qKt(t,e){const i=I0(t.center,e.center);return js(i,0)&&js(t.radius,e.radius)?e:$Ze(dme(t.center,t.radius,e.center,e.radius),e.center[2])}function GKt(t,e){if(!yZe(t.center,e.center))return;const i=I0(t.center,e.center);return js(i,0)&&js(t.radius,e.radius)?t:$Ze(dme(t.center,t.radius,e.center,e.radius),t.center[2])}function TAe(t,e){const{planeLike:i,getZ:r}=t,s=new Array;if(xf(e))t.addIfOnTheGround(s,pKt(i,e.point));else if(yg(e))t.addIfOnTheGround(s,uZe(i,e.lineLike));else if(_g(e))for(const[n,a]of hme(i,e.center,e.radius)){const o=r(n,a);o!=null&&s.push(Ye(n,a,o))}else if(vg(e)||h9(e))for(const[n,a]of hZe(i,e.planeLike)){const o=r(n,a)??CZe;s.push(Ye(n,a,o))}return Qf(s)}function lee(t){return wme(t.map(([e,i])=>{const r=$1(e,i,0),s=$1(e,i,1);return new gme(r,s)}))}function Qf(t){return wme(t.map(e=>e?new qP(e):void 0))}function $Ze(t,e){return Qf(t.map(([i,r])=>[i,r,e]))}function wme(t){if(t.length!==0)return t.length===1?t[0]??void 0:new wZe(t.filter(wl))}function Woe(t){return t instanceof wZe}function xf(t){return t instanceof qP}function yg(t){return t instanceof mme}function Av(t){return t instanceof xKt}function vg(t){return t instanceof _me}function _g(t){return t instanceof xZe}function Ov(t){return t instanceof yme}function zb(t){return t instanceof vme}function Pv(t){return t instanceof $Kt}function h9(t){return t instanceof TZe}function HKt(t){return t instanceof MKt}function WKt(t){return t instanceof CKt}const CZe=0;let GP=class{constructor(e,i,r,s){this.targetPoint=e,this.constraint=i,this.isDraped=r,this.domain=s}},MZe=class extends GP{constructor({targetPoint:e,objectId:i,constraint:r,isDraped:s}){super(e,r,s,1),this.objectId=i}},pW=class{constructor(e,i){this.isDraped=e,this.domain=i}},ey=class EZe extends pW{constructor(e,i,r,s,n=3,a=!0,o=!0){super(s,n),this.type=e,this.lineStart=i,this.lineEnd=r,this.fadeLeft=a,this.fadeRight=o}equals(e){return e instanceof EZe&&this.type===e.type&&di(this.lineStart,e.lineStart)&&di(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return Bi(this.lineStart,this.lineEnd)}},ZKt=class extends MZe{constructor(e){super({...e,isDraped:!0,constraint:new TZe(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new ey(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},YKt=class extends MZe{constructor(e){super({...e,constraint:new gme(e.edgeStart,e.edgeEnd)})}get hints(){return[new ey(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},JKt=class AZe extends pW{constructor(e,i,r=3){super(i,r),this.intersectionPoint=e}equals(e){return e instanceof AZe&&di(this.intersectionPoint,e.intersectionPoint)}},I8=class extends GP{constructor(e,i,r,s){super(e,new qP(e),s,3),this.first=i,this.second=r}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new JKt(this.targetPoint,this.isDraped,this.domain)]}},QKt=class extends GP{constructor({lineStart:e,lineEnd:i,targetPoint:r,isDraped:s}){super(r,new SZe(e,i),s,2),this._referenceLineHint=new ey(2,e,i,s,this.domain)}get hints(){return[this._referenceLineHint,new ey(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},XKt=class OZe extends pW{constructor(e,i,r,s=3){super(r,s),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof OZe&&di(this.lineStart,e.lineStart)&&di(this.lineEnd,e.lineEnd)}},KKt=class extends GP{constructor({referenceLine:e,lineStart:i,targetPoint:r,isDraped:s}){const n=Tr(i),{left:a,right:o}=e;Ae(n,$e(n,n,o),a),super(r,new SZe(i,n),s,2),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new ey(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new XKt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new ey(1,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const i={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(r=>{di(e.right,r.edge.left)&&(r.fadeLeft=!1,i.fadeRight=!1),di(e.right,r.edge.right)&&(r.fadeRight=!1,i.fadeRight=!1),di(e.left,r.edge.right)&&(r.fadeRight=!1,i.fadeLeft=!1),di(e.left,r.edge.left)&&(r.fadeLeft=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}},PZe=class RZe extends pW{constructor(e,i,r,s,n=3){super(s,n),this.previousVertex=e,this.centerVertex=i,this.nextVertex=r}equals(e){return e instanceof RZe&&di(this.previousVertex,e.previousVertex)&&di(this.centerVertex,e.centerVertex)&&di(this.nextVertex,e.nextVertex)}},eei=class extends GP{constructor({targetPoint:e,constraint:i,previousVertex:r,otherVertex:s,otherVertexType:n,isDraped:a,selfSnappingType:o,objectId:l,domain:u}){super(e,i,a,u??2),this.previousVertex=r,this.otherVertex=s,this.otherVertexType=n,this.selfSnappingType=o??0,this.objectId=l??null}get hints(){const e=this.previousVertex,i=this.otherVertexType===1?this.otherVertex:this.targetPoint,r=this.otherVertexType===1?this.targetPoint:this.otherVertex;return[new ey(0,i,r,this.isDraped,this.domain),new ey(1,e,i,this.isDraped,this.domain),new PZe(this.previousVertex,i,r,this.isDraped,this.domain)]}},tei=class extends GP{constructor({targetPoint:e,point1:i,point2:r,isDraped:s}){super(e,new xZe(cr(I(),i,r,.5),.5*nm(i,r)),s,2),this._p1=i,this._p2=r}get hints(){return[new ey(1,this.targetPoint,this._p1,this.isDraped,this.domain),new ey(1,this.targetPoint,this._p2,this.isDraped,this.domain),new PZe(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function wOi(t,e,i,r){const s=i.projectToRenderScreen(t,sei),n=i.projectToRenderScreen(e,nei);return s==null||n==null?null:(Os(r,n,s),vO(r,r),r)}function iei(t,e,i,r,s=I()){const n=me(rei,t);return n[2]=BGe(r,n,e,i)||0,r.renderCoordsHelper.toRenderCoords(n,e,s),s}const rei=I(),sei=T7(),nei=T7();function aei(t,e,i,r){return r.type==="2d"?(x6.x=t[0],x6.y=t[1],x6.spatialReference=e,r.toScreen(x6)):(iei(t,e,i,r,$Ae),r.state.camera.projectToScreen($Ae,cee),ia(cee[0],cee[1]))}const x6=vm(0,0,0,null),$Ae=I(),cee=yn();let fW;function IZe(){return!!fW&&ace()}async function oei(){if(!IZe()){const[t,e]=await Promise.all([W(()=>import("./OperatorGeodeticLength-kxkWHgcE.js"),__vite__mapDeps([431,252,432,254,255,256,66,257])),W(async()=>{const{injectPe:i}=await import("./ProjectionTransformation-ClZqX0iZ.js").then(r=>r.b5);return{injectPe:i}},__vite__mapDeps([254,255,252,256,66,257])).then(({injectPe:i})=>i),qRe()]);fW=new t.OperatorGeodeticLength,e(Ist)}}function lei(t,e,i){return fW.execute(t,e,i,null)}function cei(){return fW.supportsCurves()}const uei={geodesic:0,loxodrome:1,"great-elliptic":2,"normal-section":3,"shape-preserving":4};let xme,DZe,kZe,Sme;function Tme(){return!!xme&&IZe()}async function $me(){if(!Tme()){const[t]=await Promise.all([W(()=>import("./apiConverter-FAIJemRK.js"),__vite__mapDeps([258,252,255,254,256,66,257,259])),oei()]);xme=t.fromGeometry,DZe=t.fromSpatialReference,kZe=t.getSpatialReference,Sme=cei()}}function mW(t,e={}){const{curveType:i="geodesic",unit:r}=e,s=kZe(t);let n=lei(xme(t),DZe(s),uei[i]);return n&&r&&(n=yi(n,"meters",r)),n}const xOi=Object.freeze(Object.defineProperty({__proto__:null,execute:mW,isLoaded:Tme,load:$me,get supportsCurves(){return Sme}},Symbol.toStringTag,{value:"Module"}));function SOi(t){return F$(t)||Kh(t)}function Cme(t,e,i,...r){return F$(t)?e.apply(void 0,r):t.isWebMercator?i.apply(void 0,r):null}const hei=1e5;function dei(t){const{spatialReference:e}=t;return Cme(e,yei,vei,t)}function pei(t,e){if(!zr(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return S6[0]=t.x,S6[1]=t.y,S6[2]=t.hasZ?t.z:0,T6[0]=e.x,T6[1]=e.y,T6[2]=e.hasZ?e.z:0,LZe(S6,T6,i)}function LZe(t,e,i){return Cme(i,mei,gei,t,e,i)}const fei={geodesicLength:dei,geodesicDistanceBetweenPoints:pei,geodesicDistance:LZe};async function FZe(){return await $me(),fei}function mei(t,e,i){return Yh(BP(bei,t,e,i).distance,"meters")}function gei(t,e,i){return Yh(mW(_ei(t,e,i),{unit:"meters"}),"meters")}function yei(t){return Yh(YWe([t],"meters")[0],"meters")}function vei(t){return Yh(mW(t,{unit:"meters"}),"meters")}function _ei(t,e,i){return new gs({spatialReference:i,paths:[[[...t],[...e]]]})}const bei=new az,S6=I(),T6=I();let Sf=class extends Ju{constructor(e){super(e),this.options=new Ga,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([X(()=>{const{distance:e,touchSensitivityMultiplier:i,effectiveSelfEnabled:r,effectiveFeatureEnabled:s,effectiveGridEnabled:n}=this.options;return{selfEnabled:r,featureEnabled:s,gridEnabled:this.view.type==="2d"&&n,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:i}},(e,i)=>{i&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=sc(r=>this._updateEngines(e,i,r))},bt),X(()=>this.options,e=>{for(const i of this._engines)i.options=e},Ht)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,i,r){if(!e.viewReady)return void this._destroyEngines();i?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const s=this._engineCache,n=await Promise.allSettled([e.featureEnabled&&!s.has("feature")?this._createFeatureSnappingEngine(r):void 0,e.selfEnabled&&!s.has("self")?this._createSelfSnappingEngine(r):void 0,e.gridEnabled&&!s.has("grid")?this._createGridSnappingEngine(r):void 0]);if(r.aborted)for(const a of n)a.status==="fulfilled"&&a.value?.engine.destroy();else{for(const a of n)a.status==="fulfilled"&&a.value&&s.set(a.value.type,a.value.engine);this._engines=Array.from(s.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:i},r]=await Promise.all([W(()=>import("./SelfSnappingEngine-CRjJznmS.js"),__vite__mapDeps([433,409])),FZe()]);return ct(e),{type:"self",engine:new i({view:this.view,options:this.options,geodesicLengthMeasurementUtils:r})}}async _createGridSnappingEngine(e){const{view:i}=this;if(i.type!=="2d")return;const{GridSnappingEngine:r}=await W(()=>import("./GridSnappingEngine-yhyOyPAM.js"),__vite__mapDeps([434,172]));return ct(e),{type:"grid",engine:new r({view:i,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:i}=await W(()=>import("./FeatureSnappingEngine-9sqMlyKX.js"),__vite__mapDeps([435,183]));ct(e);const{view:r,options:s}=this,{spatialReference:n}=r;return{type:"feature",engine:new i({view:r,options:s,spatialReference:n})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:i}=this.options,r=e*i;return r*r}snap(e){return Sei(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:i,context:r}=e;this._removeVisualization();const s=this._currentMainCandidate;if(s==null)return i;const n=this._selectUpdateInput(e);if(n==null)return i;const{spatialReference:a}=r,o=Pa(n,a);if(o==null)return i;const{view:l}=this,{elevationInfo:u,visualizer:d}=r,f=[],g=o4(o,l,u),v=s.constraint.closestTo(g);if(!this._arePointsWithinScreenThreshold(g,v,r)||!hee(s,r.drawConstraints))return this._resetSnappingState(),i;s.targetPoint=nee(v),f.push(...s.hints);for(const _ of this._currentOtherActiveCandidates)hee(_,r.drawConstraints)&&(_.targetPoint=nee(v),f.push(..._.hints));return d!=null&&this.addHandles(d.draw(f,{spatialReference:a,elevationInfo:Tei(r),view:l,selfSnappingZ:r.selfSnappingZ}),uee),vAe(v,l,i,r)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:i}){switch(this._currentSnappedType){case 0:return e;case 1:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(uee)}async _snapSinglePoint({point:e,context:i,signal:r}){const{view:s}=this,{elevationInfo:n}=i,a=o4(e,s,n),o=await this._fetchCandidates(a,3,i,r);return this._createSnapResult(a,0,o,s,e,i,r)}async _snapMultiPoint({point:e,scenePoint:i,context:r,signal:s}){const{view:n}=this,{coordinateHelper:a,elevationInfo:o,spatialReference:l}=r;await om(i.spatialReference,l);const u=Pa(i,l),d=o4(u,n,o),f=await this._fetchCandidates(d,1,r,s);if(f.length>0){const _=await this._fetchCandidates(d,2,r,s);return this._createSnapResult(d,1,[...f,..._],n,u,r,s)}const g=o4(e,n,o),v=await this._fetchCandidates(g,2,r,s);return this._createSnapResult(g,0,v,n,{z:a.hasZ()&&e.hasZ?e.z??0:void 0,m:a.hasM()&&e.hasM?e.m??0:void 0},r,s)}async _fetchCandidates(e,i,r,s){return(await Promise.all(this._engines.map(n=>n.fetchCandidates(e,i,r,s)))).flat()}_createSnapResult(e,i,r,s,n,a,o){return{get valid(){return!sa(o)},apply:()=>{const{spatialReference:l}=a,{snappedPoint:u,hints:d}=this._processCandidates(e,i,r,a);return this._removeVisualization(),a.visualizer!=null&&this.addHandles(a.visualizer.draw(d,{spatialReference:l,elevationInfo:u$,view:s,selfSnappingZ:a.selfSnappingZ}),uee),vAe(u,s,n,a)}}}_processCandidates(e,i,r,s){if(r.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==i&&this._resetSnappingState(),oKt(e,r);const n=this._currentMainCandidate;if(n!=null){const a=xei(n,r);if(a>=0){if(!(r[a]instanceof I8))return this._intersectWithOtherCandidates(a,r,e,i,s);if(this._arePointsWithinScreenThreshold(e,n.targetPoint,s))return this._updateSnappingCandidate(n,i,r,s)}}return this._intersectWithOtherCandidates(0,r,e,i,s)}_intersectWithOtherCandidates(e,i,r,s,n){const{coordinateHelper:a}=n,o=i[e],l=[];for(let u=0;u<i.length;++u){if(u===e)continue;const d=i[u],f=o.constraint.intersect(d.constraint);if(f)for(const g of f.closestPoints(o.targetPoint))l.push([new I8(nee(g),o,d,d.isDraped),this._squaredScreenDistance(r,g,a)])}return l.length>0&&(l.sort((u,d)=>u[1]-d[1]),l[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(l[0][0],s,i,n):hee(o,n.drawConstraints)?this._updateSnappingCandidate(o,s,i,n):{snappedPoint:r,hints:[]}}_updateSnappingCandidate(e,i,r,s){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=i;const n=this._currentMainCandidate.targetPoint,a=[];a.push(...e.hints);for(const o of r){if(e instanceof I8){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const l=o.constraint.closestTo(n);this._squaredScreenDistance(l,n,s.coordinateHelper)<wei()&&(o.targetPoint=n,this._currentOtherActiveCandidates.push(o),a.push(...o.hints))}return{snappedPoint:n,hints:a}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,i,r){return this._squaredScreenDistance(e,i,r.coordinateHelper)<this._squaredPointProximityThreshold(r.pointer)}_squaredScreenDistance(e,i,r){return lZe(this._toScreen(e,r),this._toScreen(i,r))}_toScreen(e,i){return aei(e,i.spatialReference,u$,this.view)}get test(){}};c([p({constructOnly:!0})],Sf.prototype,"view",void 0),c([p()],Sf.prototype,"options",void 0),c([p({readOnly:!0})],Sf.prototype,"updating",null),c([p()],Sf.prototype,"_loadTask",void 0),c([p()],Sf.prototype,"_engines",void 0),c([p()],Sf.prototype,"_squaredMouseProximityThreshold",null),c([p()],Sf.prototype,"_squaredTouchProximityThreshold",null),Sf=c([R("esri.views.interactive.snapping.SnappingManager")],Sf);const uee="visualization-handle";function wei(){return l9.satisfiesConstraintScreenThreshold*l9.satisfiesConstraintScreenThreshold}function hee(t,e){return!e||e.direction==null&&e.distance==null||!(t instanceof ZKt||t instanceof YKt||t instanceof QKt||t instanceof KKt||t instanceof tei)&&(!(t instanceof eei)||e.direction==null&&t.selfSnappingType===1)}function xei(t,e){return t instanceof I8?dee(e,t.first)>=0&&dee(e,t.second)>=0?0:-1:dee(e,t)}function dee(t,e){let i=-1;for(let r=0;r<t.length;++r)if(e.constraint.equals(t[r].constraint)){i=r;break}return i}function Sei(t){return t.scenePoint!=null}function Tei({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?u$:e}function Zoe(t,e,i){i=i||2;var r,s,n,a,o,l,u,d=e&&e.length,f=d?e[0]*i:t.length,g=zZe(t,0,f,i,!0),v=[];if(!g||g.next===g.prev)return v;if(d&&(g=Aei(t,e,g,i)),t.length>80*i){r=n=t[0],s=a=t[1];for(var _=i;_<f;_+=i)(o=t[_])<r&&(r=o),(l=t[_+1])<s&&(s=l),o>n&&(n=o),l>a&&(a=l);u=(u=Math.max(n-r,a-s))!==0?1/u:0}return ML(g,v,i,r,s,u),v}function zZe(t,e,i,r,s){var n,a;if(s===Qoe(t,e,i,r)>0)for(n=e;n<i;n+=r)a=CAe(n,t[n],t[n+1],a);else for(n=i-r;n>=e;n-=r)a=CAe(n,t[n],t[n+1],a);if(a&&gW(a,a.next)){var o=a.next;AL(a),a=o}return a}function C1(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!gW(r,r.next)&&Dn(r.prev,r,r.next)!==0)r=r.next;else{var s=r.prev;if(AL(r),(r=e=s)===r.next)break;i=!0}while(i||r!==e);return e}function ML(t,e,i,r,s,n,a){if(t){!a&&n&&Dei(t,r,s,n);for(var o,l,u=t;t.prev!==t.next;)if(o=t.prev,l=t.next,n?Cei(t,r,s,n):$ei(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),AL(t),t=l.next,u=l.next;else if((t=l)===u){a?a===1?ML(t=Mei(C1(t),e,i),e,i,r,s,n,2):a===2&&Eei(t,e,i,r,s,n):ML(C1(t),e,i,r,s,n,1);break}}}function $ei(t){var e=t.prev,i=t,r=t.next;if(Dn(e,i,r)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(FE(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&Dn(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Cei(t,e,i,r){var s=t.prev,n=t,a=t.next;if(Dn(s,n,a)>=0)return!1;for(var o=s.x<n.x?s.x<a.x?s.x:a.x:n.x<a.x?n.x:a.x,l=s.y<n.y?s.y<a.y?s.y:a.y:n.y<a.y?n.y:a.y,u=s.x>n.x?s.x>a.x?s.x:a.x:n.x>a.x?n.x:a.x,d=s.y>n.y?s.y>a.y?s.y:a.y:n.y>a.y?n.y:a.y,f=Yoe(o,l,e,i,r),g=Yoe(u,d,e,i,r),v=t.prevZ,_=t.nextZ;v&&v.z>=f&&_&&_.z<=g;){if(v!==t.prev&&v!==t.next&&FE(s.x,s.y,n.x,n.y,a.x,a.y,v.x,v.y)&&Dn(v.prev,v,v.next)>=0||(v=v.prevZ,_!==t.prev&&_!==t.next&&FE(s.x,s.y,n.x,n.y,a.x,a.y,_.x,_.y)&&Dn(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;v&&v.z>=f;){if(v!==t.prev&&v!==t.next&&FE(s.x,s.y,n.x,n.y,a.x,a.y,v.x,v.y)&&Dn(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=g;){if(_!==t.prev&&_!==t.next&&FE(s.x,s.y,n.x,n.y,a.x,a.y,_.x,_.y)&&Dn(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Mei(t,e,i){var r=t;do{var s=r.prev,n=r.next.next;!gW(s,n)&&NZe(s,r,r.next,n)&&EL(s,n)&&EL(n,s)&&(e.push(s.i/i),e.push(r.i/i),e.push(n.i/i),AL(r),AL(r.next),r=t=n),r=r.next}while(r!==t);return C1(r)}function Eei(t,e,i,r,s,n){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&Fei(a,o)){var l=VZe(a,o);return a=C1(a,a.next),l=C1(l,l.next),ML(a,e,i,r,s,n),void ML(l,e,i,r,s,n)}o=o.next}a=a.next}while(a!==t)}function Aei(t,e,i,r){var s,n,a,o=[];for(s=0,n=e.length;s<n;s++)(a=zZe(t,e[s]*r,s<n-1?e[s+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),o.push(Lei(a));for(o.sort(Oei),s=0;s<o.length;s++)i=C1(i=Pei(o[s],i),i.next);return i}function Oei(t,e){return t.x-e.x}function pee(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function Pei(t,e){var i=Rei(t,e);if(!i)return e;var r=VZe(i,t),s=C1(i,i.next);let n=pee(r);return C1(n,n.next),s=pee(s),pee(e===i?s:e)}function Rei(t,e){var i,r=e,s=t.x,n=t.y,a=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=s&&o>a){if(a=o,o===s){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(s===a)return i;var l,u=i,d=i.x,f=i.y,g=1/0;r=i;do s>=r.x&&r.x>=d&&s!==r.x&&FE(n<f?s:a,n,d,f,n<f?a:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),EL(r,t)&&(l<g||l===g&&(r.x>i.x||r.x===i.x&&Iei(i,r)))&&(i=r,g=l)),r=r.next;while(r!==u);return i}function Iei(t,e){return Dn(t.prev,t,e.prev)<0&&Dn(e.next,t,t.next)<0}function Dei(t,e,i,r){var s=t;do s.z===null&&(s.z=Yoe(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,kei(s)}function kei(t){var e,i,r,s,n,a,o,l,u=1;do{for(i=t,t=null,n=null,a=0;i;){for(a++,r=i,o=0,e=0;e<u&&(o++,r=r.nextZ);e++);for(l=u;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,u*=2}while(a>1);return t}function Yoe(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Lei(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function FE(t,e,i,r,s,n,a,o){return(s-a)*(e-o)-(t-a)*(n-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(n-o)-(s-a)*(r-o)>=0}function Fei(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!zei(t,e)&&(EL(t,e)&&EL(e,t)&&Nei(t,e)&&(Dn(t.prev,t,e.prev)||Dn(t,e.prev,e))||gW(t,e)&&Dn(t.prev,t,t.next)>0&&Dn(e.prev,e,e.next)>0)}function Dn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function gW(t,e){return t.x===e.x&&t.y===e.y}function NZe(t,e,i,r){var s=C6(Dn(t,e,i)),n=C6(Dn(t,e,r)),a=C6(Dn(i,r,t)),o=C6(Dn(i,r,e));return s!==n&&a!==o||!(s!==0||!$6(t,i,e))||!(n!==0||!$6(t,r,e))||!(a!==0||!$6(i,t,r))||!(o!==0||!$6(i,e,r))}function $6(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function C6(t){return t>0?1:t<0?-1:0}function zei(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&NZe(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function EL(t,e){return Dn(t.prev,t,t.next)<0?Dn(t,e,t.next)>=0&&Dn(t,t.prev,e)>=0:Dn(t,e,t.prev)<0||Dn(t,t.next,e)<0}function Nei(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function VZe(t,e){var i=new Joe(t.i,t.x,t.y),r=new Joe(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function CAe(t,e,i,r){var s=new Joe(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function AL(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Joe(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qoe(t,e,i,r){for(var s=0,n=e,a=i-r;n<i;n+=r)s+=(t[a]-t[n])*(t[n+1]+t[a+1]),a=n;return s}Zoe.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,a=Math.abs(Qoe(t,0,n,i));if(s)for(var o=0,l=e.length;o<l;o++){var u=e[o]*i,d=o<l-1?e[o+1]*i:t.length;a-=Math.abs(Qoe(t,u,d,i))}var f=0;for(o=0;o<r.length;o+=3){var g=r[o]*i,v=r[o+1]*i,_=r[o+2]*i;f+=Math.abs((t[g]-t[_])*(t[v+1]-t[g+1])-(t[g]-t[v])*(t[_+1]-t[g+1]))}return a===0&&f===0?0:Math.abs((f-a)/a)},Zoe.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var a=0;a<e;a++)i.vertices.push(t[s][n][a]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i};function Mme(t){return QL(t)?P0(t)||Kh(t)||M5(t)||A5(t)?p3t:t:v1(t)}function Vei(t,e=d9()){return jZe(t,e)}function jei(t,e=d9()){return jZe(t,e,!1)}function jZe(t,e,i=t.hasZ){const r=Mme(t.spatialReference),s=int(r);if(s==null)return null;const n=(o,l)=>!(l.length<2)&&(xe(o,l[0],l[1],i&&l[2]||0),!0);let a=0;for(const o of t.rings){const l=o.length;if(l<3)continue;const{positionsWorldCoords:u}=e;for(;u.length<l;)u.push(I());const d=Uei,f=xe(Bei,0,0,0),g=1/l;for(let x=0;x<l;x++){if(!n(d,o[x])||!Co(d,t.spatialReference,u[x],r))return null;Fr(f,f,u[x],g)}const v=Fh(u[0],u[1],f,Oje());if(ea(v)===0)continue;for(let x=0;x<l;x++)O3t(v,f,u[x],u[x]);const _=qei(u);for(let x=0;x<_.length;x+=3)a+=X5t(u[_[x]],u[_[x+1]],u[_[x+2]])}return EH(a,s)}const Uei=I(),Bei=I();function d9(){return{positionsWorldCoords:[]}}function qei(t){return Zoe(Gei(t),[],2)}function Gei(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const r=t[i],s=2*i;e[s]=r[0],e[s+1]=r[1]}return e}const Hei=t=>({geodesicArea(e){const{spatialReference:i}=e;return Cme(i,Zei,r=>Yei(t,r),e)}});async function Wei(){const t=await W(()=>import("./geometryEngine-CBJkr_bA.js"),__vite__mapDeps([436,7,8]));return Hei(t)}function Zei(t){return EH(Math.abs(fXt([t],"square-meters")[0]),"square-meters")}function Yei(t,e){try{return EH(Math.abs(t.geodesicArea(e,"square-meters")),"square-meters")}catch{return null}}const Jei=t=>({autoAreaByElevationMode(e,i,r=d9()){if(i==="on-the-ground"){const s=t.geodesicArea(e);return s??jei(e,r)}return Vei(e,r)},autoArea2D(e,i=d9()){return this.autoAreaByElevationMode(e,"on-the-ground",i)}});let fee=null;async function M6(){return fee||(fee=Jei(await Wei())),fee}function Qei(t){return Xei(t)}function Xei(t,e){const{hasZ:i,spatialReference:r}=t,s=Mme(r);let n=0;const a=dIe(s);if(a==null)return null;const o=Eme;for(const l of t.paths){if(l.length<2)continue;const u=l.length-1;for(let d=0;d<u;++d){const f=l[d];Ka[0]=f[0],Ka[1]=f[1],Ka[2]=i?f[2]:0;const g=l[d+1];eo[0]=g[0],eo[1]=g[1],eo[2]=i?g[2]:0;const v=o(Ka,eo,r);if(v==null)return null;n+=v.value}}return Yh(n,a)}function $Oi(t,e){const{spatialReference:i}=t;return zr(i,e.spatialReference)?(Ka[0]=t.x,Ka[1]=t.y,Ka[2]=t.hasZ?t.z:0,eo[0]=e.x,eo[1]=e.y,eo[2]=e.hasZ?e.z:0,tti(Ka,eo,i)):null}function COi(t,e){const{spatialReference:i}=t;return zr(i,e.spatialReference)?(Ka[0]=t.x,Ka[1]=t.y,Ka[2]=t.hasZ?t.z:0,eo[0]=e.x,eo[1]=e.y,eo[2]=e.hasZ?e.z:0,iti(Ka,eo,i)):null}function Kei(t,e){const{spatialReference:i}=t;return zr(i,e.spatialReference)?(Ka[0]=t.x,Ka[1]=t.y,Ka[2]=t.hasZ?t.z:0,eo[0]=e.x,eo[1]=e.y,eo[2]=e.hasZ?e.z:0,Eme(Ka,eo,i)):null}function MOi(t,e){const{spatialReference:i}=t;return zr(i,e.spatialReference)?(Ka[0]=t.x,Ka[1]=t.y,Ka[2]=t.hasZ?t.z:0,eo[0]=e.x,eo[1]=e.y,eo[2]=e.hasZ?e.z:0,rti(Ka,eo,i)):null}function EOi(t){return t!=null?eti(t.hasZ?t.z:0,t.spatialReference):null}function eti(t,e){const i=pIe(e);return i!=null?Yh(t??0,i):null}function tti(t,e,i){const r=yW(t,e,i);return r!=null?{direct:Yh(r.direct,r.unit),horizontal:Yh(r.horizontal,r.unit),vertical:Yh(r.vertical,r.unit)}:null}function iti(t,e,i){const r=yW(t,e,i,0);return r!=null?Yh(r.direct,r.unit):null}function Eme(t,e,i){const r=yW(t,e,i,1);return r!=null?Yh(r.horizontal,r.unit):null}function rti(t,e,i){const r=yW(t,e,i,2);return r!=null?Yh(r.verticalSigned,r.unit):null}function yW(t,e,i,r){const s=Mme(i),n=dIe(s);if(n==null)return null;const a=e[2]-t[2];if(r===2)return{verticalSigned:a,unit:n};if(!Co(t,i,mee,s)||!Co(e,i,E6,s))return null;if(r===0)return{direct:Bi(E6,mee),unit:n};if(xe(A6,t[0],t[1],e[2]),!Co(A6,i,A6,s))return null;const o=Bi(A6,E6);return r===1?{horizontal:o,unit:n}:{direct:Bi(E6,mee),horizontal:o,vertical:Math.abs(a),unit:n}}const Ka=I(),eo=I(),mee=I(),E6=I(),A6=I();function sti(t){return{autoLength2D:e=>t.geodesicLength(e)??Qei(e),autoDistanceBetweenPoints2D:(e,i)=>t.geodesicDistanceBetweenPoints(e,i)??Kei(e,i),autoDistance2D:(e,i,r)=>(rD[0]=e[0],rD[1]=e[1],rD[2]=e.length===3?e[2]:0,sD[0]=i[0],sD[1]=i[1],sD[2]=i.length===3?i[2]:0,t.geodesicDistance(rD,sD,r)??Eme(rD,sD,r))}}async function Bx(){return sti(await FZe())}const rD=I(),sD=I();let UZe=class{constructor(e){this.layer=e}get elevationInfo(){return this.layer.elevationInfo}add(e){this.layer.add(e)}addMany(e){this.layer.addMany(e)}onGraphicsChange(e){const{layer:i}=this;return tn(()=>i.graphics,"change",r=>e(r))}has(e){return e.layer===this.layer}remove(e){this.layer.remove(e)}removeMany(e){this.layer.removeMany(e)}removeAll(){this.layer.removeAll()}};c([p()],UZe.prototype,"elevationInfo",null);let BZe=class{constructor(e){this.layer=e}get elevationInfo(){}add(e,i){(this._getSublayerForCreateTool(i)??this._getSublayerForGraphic(e))?.add(e)}addMany(e,i){if(i){const r=this._getSublayerForCreateTool(i);if(r)return void r.addMany(e)}e.forEach(r=>this._getSublayerForGraphic(r)?.add(r))}onGraphicsChange(e){const{layer:i}=this;if(i.sublayers?.length)return Yu(i.sublayers?.toArray().map(r=>tn(()=>r.graphics,"change",s=>e(s))))}has(e){const{layer:i}=this;return e.layer===i||e.sourceLayer===i||!!i.sublayers?.some(r=>e.layer===r||e.sourceLayer===r)}remove(e){this._getSublayerForGraphic(e)?.remove(e)}removeMany(e){e.forEach(i=>this._getSublayerForGraphic(i)?.remove(i))}removeAll(){this.layer.sublayers?.forEach(e=>e.removeAll())}_getSublayerForCreateTool(e){const{layer:i}=this;switch(e){case"point":return i.pointLayer;case"polyline":return i.polylineLayer;case"polygon":return i.polygonLayer;case"multipoint":return i.multipointLayer;case"text":return i.textLayer}}_getSublayerForGraphic(e){const{layer:i}=this;if(e?.geometry)switch(e.geometry.type){case"point":return e.symbol?.type==="text"?i.textLayer:i.pointLayer;case"polyline":return i.polylineLayer;case"polygon":return i.polygonLayer;case"multipoint":return i.multipointLayer}}};c([p()],BZe.prototype,"elevationInfo",null);let cl=class extends Ju{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){const{activeComponent:e}=this;if(!e)return null;switch(e.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":return e.graphicSymbol?.type==="text"?"text":e.geometryType;case"draw-3d":return e.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([p()],cl.prototype,"activeComponent",void 0),c([p()],cl.prototype,"cancelled",void 0),c([p()],cl.prototype,"history",void 0),c([p()],cl.prototype,"tool",null),c([p()],cl.prototype,"type",void 0),c([p()],cl.prototype,"canUndo",null),c([p()],cl.prototype,"canRedo",null),c([p()],cl.prototype,"onEnd",void 0),c([p()],cl.prototype,"undo",null),c([p()],cl.prototype,"redo",null),c([p()],cl.prototype,"toggleTool",void 0),c([p()],cl.prototype,"addToSelection",void 0),c([p()],cl.prototype,"removeFromSelection",void 0),cl=c([R("esri.widgets.Sketch.support.OperationHandle")],cl);let D8=class extends cl{};c([p()],D8.prototype,"activeComponent",void 0),D8=c([R("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],D8);let t0=class extends cl{};c([p()],t0.prototype,"activeComponent",void 0),t0=c([R("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],t0);function nti(t,e){return e==="freehandPolygon"||e==="freehandPolyline"?"freehand":t??(e==="rectangle"||e==="circle"?"hybrid":"click")}function ati(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";case"text":return"point";default:return t}}function MAe(t){if(t.length>1)return!1;const e=t.at(0)?.geometry;return e?.type==="point"||e?.type==="multipoint"&&e.points.length<2}const EAe={defaultZ:0},nD={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:cm},tool:"transform"},gee=Symbol(),AAe=Symbol();let _r=class extends Ju{constructor(t){super(t),this._defaultSnappingManager=null,this._internalGraphicsLayer=new gg({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._updatingHandles=new tm,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new wa({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Pu({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Rn({color:[130,130,130,1],width:2}),this.meshSymbol=new kg({symbolLayers:new ke([new jl])}),this.textSymbol=new es({text:"text"}),this.updateGraphics=new ke,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new wa({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new aZe,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{const{_layerAdapter:e}=this;if(this.removeHandles(AAe),!e)return;const i=[e.onGraphicsChange(r=>this._onLayerGraphicsChangeCallback(r)),X(()=>e.elevationInfo,r=>{r!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=r)},bt)].filter(wl);this.addHandles(i,AAe)},this._originalPopupEnabled=null,this.defaultCreateOptions=EAe,this.defaultUpdateOptions=nD,this.snappingOptions=t?.snappingManager?.options??t?.snappingOptions??new Ga}initialize(){this.addHandles([tn(()=>this.view?.map?.layers,"change",t=>{this.layer&&t.removed.includes(this.layer)&&this.cancel()}),X(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),bt),X(()=>this.view,t=>{this._defaultSnappingManager=Pe(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new Sf({view:t,options:this.snappingOptions})),t.type==="2d"?W(()=>import("./editingTools-Dg7qap7k.js"),__vite__mapDeps([437,438,375,376,439,408,271,409,316,250,251,252,253,254,255,256,66,257,258,259,260,261,410,378,340,341,342,381,382,113,440,441])):t.type==="3d"&&(W(()=>import("./editingTools-A7JRP1bO.js"),__vite__mapDeps([442,368,370,371,372,365,373,374,364,334,366,289,375,376,390,369,391,392,393,29,386,443,439,408,271,409,316,250,251,252,253,254,255,256,66,257,258,259,260,261,410,378,340,341,342,381,382,397,405,377,444,445,112,113,400,401,399,290,385,402,288,446,440])),W(()=>import("./GraphicsLayerView3D-Ci7VUdAs.js"),__vite__mapDeps([329,279,317,330,319,305,15,185,320,307,179,186]))))},bt),X(()=>this.view?.spatialReference,(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),cKt(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=Pe(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get _layerAdapter(){const{layer:t}=this;switch(t?.type){case"graphics":return new UZe(t);case"map-notes":return new BZe(t);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:t,destroyed:e}=this,i=!e&&t&&"tooltip"in t?t.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...EAe,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...nD,...t,reshapeOptions:{...nD.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...nD.highlightOptions,...t?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(t){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=Pe(this._defaultSnappingManager)),this._override("snappingManager",t);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new Sf({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const t=!(!this.view?.ready||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:r,map:s}=e;r&&this._clearCursor(),s?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),t&&this.addHandles(vs(()=>t.ready,r=>{this.removeHandles(this._viewHandlesKey),r&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},bt),i),this._set("view",t)}addGraphic(t){this._layerAdapter?.add(t)}addGraphics(t){this._layerAdapter?.addMany(t)}hasGraphic(t){return!!this._layerAdapter?.has(t)}removeGraphic(t){this._layerAdapter?.remove(t)}removeGraphics(t){this._layerAdapter?.removeMany(t)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=Rs(this._moduleLoaderAbortController),this._viewReadyAbortController=Rs(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:i}=this,r=e.toArray();this.removeGraphics(r),this.cancel(),this._emitDeleteEvent({graphics:r,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.addGraphics(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:i,layer:r}=this;if(!i||this.state==="disabled")throw r||this._logMissingLayer(),ti();if(i.activeTool!=null&&(i.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");gAe(i,this._internalGraphicsLayer);const s=await this._updatingHandles.addPromise(this._setupCreateOperation(t,e));if(s==null||this.destroyed)return void i.map?.remove(this._internalGraphicsLayer);const n=()=>{if(s===this._operationHandle){const a=this.createGraphic,o=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map?.remove(this._internalGraphicsLayer),s.cancelled||a==null||this.addGraphic(a),this._sketchContinuationFlag=!1,this.emit("create",{graphic:a,state:o?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),o||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(e?.geometryToPlace)return;this._updatingHandles.addPromise(bp(this.create(t,e)))}else l==="update"&&a&&this._updatingHandles.addPromise(bp(this.update([a])))}};s.on("complete",n),this._operationHandle=s,i.ready&&i.focus()}async place(t,e){return await t.load(),this.create("mesh",{mode:"click",hasZ:t.hasZ,geometryToPlace:t,...e})}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:i,view:r,state:s}=this;if(!r||s==="disabled")throw i||this._logMissingLayer(),ti();r.activeTool!=null&&(r.activeTool=null);const n=Array.isArray(t)?t:[t];if(t==null||!n?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some(o=>this.hasGraphic(o)?o.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0)))return;const a=await this._updatingHandles.addPromise(this._setupUpdateOperation(n,e));this.destroyed||a==null||Va(a)||(gAe(r,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,e),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){t=Array.isArray(t)?t:[t];for(const i of t)i.geometry==null||i.geometry.type==="mesh"||zr(i.geometry.spatialReference,e.spatialReference)||(Zc(i.geometry.spatialReference,e.spatialReference)||ry()||await F0(),i.geometry=Pa(i.geometry,e.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const s=[];e.map.allLayers.forEach(a=>{a.type!=="vector-tile"&&a.type!=="imagery"||s.push(a)});const n=await e.hitTest(t,{exclude:s});return u6t(n.results)}const i=[e.map.ground];e.map.allLayers.forEach(s=>{t$(s)&&i.push(s)});const r=await e.hitTest(t,{exclude:i});if(r.results.length>0){const s=r.results[0];if(s!=null&&s.type==="graphic"&&s.graphic&&(!r.ground.mapPoint||e.map.ground.opacity<1||r.ground.distance-(s.distance??0)>-Math.min(3*r.ground.distance,e.viewingMode==="global"?xr(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return s}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},Br.WIDGET)]}async _handleImmediateClick(t){const e=await t.defer(()=>this._getFirstHit(jd(t)));let i=null;if(e!=null){const r=e.graphic;this.updateGraphics.includes(r)||this.hasGraphic(r)?(t.stopPropagation(),i=r):this.view?.type!=="2d"||this._isComponentGraphic(r)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(t,e){const i=this.view;if(!i)return this._logMissingView(),null;const r={hasZ:i.type==="3d",...this.defaultCreateOptions,...e},s=await this._setupDrawGraphicTool(t,i,r);return s==null?null:(i.tools.add(s),i.activeTool=s,this._setupCreateOperationHandle(s,t))}async _setupDrawGraphicTool(t,e,i){if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const{cursor:r,defaultZ:s,hasZ:n,geometryToPlace:a,graphicProperties:o,mode:l,preserveAspectRatio:u}=i,d=nti(l,t),f=ati(t),g=i?.optionsPerTool?.has(t)?i.optionsPerTool.get(t):{},v=g?.preserveAspectRatio??u??t!=="rectangle",_={centered:t!=="rectangle"&&!(t==="circle"&&!v),cursor:r,defaultZ:s,forceUniformSize:v,graphicProperties:{...o,attributes:{...o?.attributes}},geometryToPlace:a,geometryType:f,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(t),hasZ:n,snappingManager:this.snappingManager,snapToScene:!1,view:e,...g};return e.type==="2d"?this._makeDrawGraphicTool2D(_):this._makeDrawGraphicTool3D(_)}async _makeDrawGraphicTool2D(t){const[e,i,r]=await Promise.all([this._requireModule(W(()=>import("./editingTools-Dg7qap7k.js"),__vite__mapDeps([437,438,375,376,439,408,271,409,316,250,251,252,253,254,255,256,66,257,258,259,260,261,410,378,340,341,342,381,382,113,440,441]))),M6(),Bx()]);return Va(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:lti(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:r})}async _makeDrawGraphicTool3D(t){const[e,i,r]=await Promise.all([this._requireModule(W(()=>import("./editingTools-A7JRP1bO.js"),__vite__mapDeps([442,368,370,371,372,365,373,374,364,334,366,289,375,376,390,369,391,392,393,29,386,443,439,408,271,409,316,250,251,252,253,254,255,256,66,257,258,259,260,261,410,378,340,341,342,381,382,397,405,377,444,445,112,113,400,401,399,290,385,402,288,446,440]))),M6(),Bx()]);return Va(e)||this.destroyed?null:new e.module.DrawGraphicTool3D({...t,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:r})}_setupCreateOperationHandle(t,e){const i=this.view;if(!i)return this._logMissingView(),null;let r=null;const s=t.forceUniformSize,n=t.centered,a=[i.on("key-down",l=>{if(l.key===Vn.pan)l.stopPropagation(),l.repeat||(t.enabled=!1);else if(l.key===Vn.complete)l.stopPropagation(),t.completeCreateOperation();else if(l.key!==Vn.vertexAdd||l.repeat)l.key===Vn.undo?(l.stopPropagation(),o.undo()):l.key===Vn.redo?(l.stopPropagation(),o.redo()):l.key!==Vn.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||l.repeat?l.key===Vn.center&&(l.repeat||(t.centered=!n,l.stopPropagation())):(t.forceUniformSize=!s,l.stopPropagation());else{const u=t.drawOperation.geometryType;u!=="polyline"&&u!=="polygon"&&u!=="multipoint"||(l.stopPropagation(),t.drawOperation.commitStagedVertex())}},Br.WIDGET),i.on("key-up",l=>{l.key===Vn.pan?t.enabled=!0:l.key!==Vn.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?l.key===Vn.center&&(t.centered=n,l.stopPropagation()):(t.forceUniformSize=s,l.stopPropagation())},Br.WIDGET),t.on("vertex-add",l=>{switch(r=r==null?"start":"active",l.operation){case"apply":this.emit("create",{graphic:t.graphic,state:r,tool:this.activeTool,toolEventInfo:l,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",l=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:l.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",l=>{switch(l.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:l,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",l=>{this._set("createGraphic",l.graphic),r="complete",l.aborted?o&&o.cancel():o&&o.complete()}),X(()=>this._getGraphicSymbolFromTool(e),l=>{t.graphicSymbol=l})],o=new D8({activeComponent:t,type:"create",onEnd:()=>{Om(a),i.tools?.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return o}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol;case"text":return this.textSymbol}}async _setupUpdateOperation(t,e){const{view:i}=this;if(!i)return this._logMissingView(),null;const r={...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...e?.highlightOptions}};let s=r.tool??nD.tool;if(this.removeGraphics(t),this.addGraphics(t),i.type==="3d"){if(t.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(t,r,i,s);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(t[0],r,i);case"transform":return this._setupGraphicTransform3DOperation(t,r,i)}}switch(s){case"move":return this._setupMove2DOperation(t,r,i);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(t,s,r,i);case"transform":return MAe(t)&&(s="reshape"),this._setupTransformOrReshape2DOperation(t,s,r,i)}}async _setupMove3DOperation(t,e,i,r,s=!1){const[n,a]=await Promise.all([this._requireModule(W(()=>import("./editingTools-A7JRP1bO.js"),__vite__mapDeps([442,368,370,371,372,365,373,374,364,334,366,289,375,376,390,369,391,392,393,29,386,443,439,408,271,409,316,250,251,252,253,254,255,256,66,257,258,259,260,261,410,378,340,341,342,381,382,397,405,377,444,445,112,113,400,401,399,290,385,402,288,446,440]))),Bx()]);if(Va(n))return n;const{ManipulatedObject3DGraphic:o,MoveTool3D:l}=n.module,u=new Map,d=()=>{u.forEach(_=>_.destroy()),u.clear()};for(const _ of t){const x=new o({view:i,graphic:_}),S=eKt(x);if(S!==0)return d(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${mAe(S)}).`),null;u.set(_,x)}const f=new l({view:i,enableZ:e.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:a});i.tools.add(f),f.objects.addMany(Array.from(u.values())),s||this.updateGraphics.addMany(t);const g=[],v=new t0({activeComponent:f,tool:r,type:"update",onEnd:()=>{Om(g),R6(i,f),d()},undo:()=>{PAe(this.view,f),O6(v,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{P6(v,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:_=>{this.updateGraphics.push(_);const x=new o({view:i,graphic:_});u.set(_,x),f.objects.push(x),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:_=>{const x=this.updateGraphics.indexOf(_);if(v.history.undo.forEach(T=>T.updates.splice(x,1)),v.history.redo.forEach(T=>T.updates.splice(x,1)),this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void v.complete();const S=u.get(_);S&&(f.objects.remove(S),S.destroy(),u.delete(_))},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||r!=="transform")return;const _=this.updateGraphics.at(0),x=await this._setupReshape3DOperation(_,e,i,!0);x&&!Va(x)&&(v.onEnd(),v.destroy(),this._setUpdateOperationHandle(x,e))}});return g.push(...this._getHandlesForComponent(v,e),i.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(v,_,e),Br.WIDGET),i.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(v,_)},Br.WIDGET)),v}_setupGraphicTransform3DOperation(t,e,i,r=!1){if(t.length===1&&rKt(t[0])===0){const s=t[0],n=s.geometry;if(n!=null&&(n.type==="point"||n.type==="mesh"))return this._setupPointTransform3DOperation(s,e,i);if(n!=null&&(n.type==="polygon"||n.type==="polyline"))return this._setupPolyTransform3DOperation(s,e,i,r)}return this._setupMove3DOperation(t,e,i,"transform",r)}async _setupPointTransform3DOperation(t,e,i){const r="transform",{enableRotation:s,enableScaling:n,enableZ:a}=e,o=await this._requireModule(W(()=>import("./editingTools-A7JRP1bO.js"),__vite__mapDeps([442,368,370,371,372,365,373,374,364,334,366,289,375,376,390,369,391,392,393,29,386,443,439,408,271,409,316,250,251,252,253,254,255,256,66,257,258,259,260,261,410,378,340,341,342,381,382,397,405,377,444,445,112,113,400,401,399,290,385,402,288,446,440])));if(Va(o))return o;const{TransformTool3D:l,ManipulatedObject3DGraphic:u}=o.module,d=new u({graphic:t,view:i}),f=new l({object:d,view:i,enableRotation:s,enableScaling:n,enableZ:a,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(f),this.updateGraphics.add(t);const g=[],v=new t0({activeComponent:f,tool:r,type:"update",onEnd:()=>{Om(g),R6(i,f),d.destroy()},undo:()=>{PAe(this.view,f),O6(v,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{P6(v,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),v.onEnd(),v.destroy();const x=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);Va(x)||this._setUpdateOperationHandle(x,e)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),v.complete()},toggleTool:()=>{}});return g.push(...this._getHandlesForComponent(v,e),i.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(v,_,e),Br.WIDGET),i.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(v,_)},Br.WIDGET)),v}async _setupPolyTransform3DOperation(t,e,i,r=!1){const s="transform",{enableRotation:n,enableScaling:a,enableZ:o,preserveAspectRatio:l}=e,[u,d]=await Promise.all([this._requireModule(W(()=>import("./editingTools-A7JRP1bO.js"),__vite__mapDeps([442,368,370,371,372,365,373,374,364,334,366,289,375,376,390,369,391,392,393,29,386,443,439,408,271,409,316,250,251,252,253,254,255,256,66,257,258,259,260,261,410,378,340,341,342,381,382,397,405,377,444,445,112,113,400,401,399,290,385,402,288,446,440]))),Bx()]);if(Va(u))return u;const{ManipulatedObject3DGraphic:f,ExtentTransformTool:g}=u.module,v=this.view?.inputManager?.isModifierKeyDown(Vn.constraint),_=new f({view:i,graphic:t}),x=new g({object:_,view:i,enableRotation:n,enableScaling:a,enableZ:o,preserveAspectRatio:!!l!=!!v,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});i.tools.add(x),r||this.updateGraphics.add(t);const S=[],T=new t0({activeComponent:x,tool:s,type:"update",onEnd:()=>{Om(S),R6(i,x),_.destroy()},canUndo:()=>!x.destroyed&&x.canUndo,undo:()=>{x.destroyed||(x.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!x.destroyed&&x.canRedo,redo:()=>{x.destroyed||(x.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async M=>{this.updateGraphics.add(M),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[M],removed:[],type:"selection-change"},type:"update"}),T.onEnd(),T.destroy();const E=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);Va(E)||this._setUpdateOperationHandle(E,e)},removeFromSelection:M=>{this.updateGraphics.remove(M),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[M],type:"selection-change"},type:"update"}),T.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const M=await this._setupReshape3DOperation(t,e,i,!0);M&&!Va(M)&&(T.onEnd(),T.destroy(),this._setUpdateOperationHandle(M,e))}});return S.push(...this._getHandlesForComponent(T,e),i.on("immediate-click",M=>this._getCommonUpdateOperationClickHandlers(T,M,e),Br.WIDGET),i.on("key-down",M=>this._getCommonUpdateOperationKeyDownHandlers(T,M),Br.WIDGET),i.on("key-down",M=>{M.key!==Vn.constraint||M.repeat||(x.preserveAspectRatio=!x.preserveAspectRatio,M.stopPropagation())},Br.WIDGET),i.on("key-up",M=>{M.key===Vn.constraint&&(x.preserveAspectRatio=!x.preserveAspectRatio,M.stopPropagation())},Br.WIDGET)),T}async _setupMove2DOperation(t,e,i){const r="move";this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const s=await this._getGraphicMover(t,e,i);if(Va(s))return s;const n=new t0({activeComponent:s,tool:r,type:"update",onEnd:()=>{this._clearCursor(),Om(l),Om(o),s.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const u=this.updateGraphics.toArray();O6(n,u),n.refreshComponent(),this._emitUndoEvent({graphics:u,tool:r})},redo:()=>{const u=this.updateGraphics.toArray();P6(n,u),n.refreshComponent(),this._emitRedoEvent({graphics:u,tool:r})},addToSelection:async u=>{await this._updatingHandles.addPromise(this._updateSpatialReference(u)),this.updateGraphics.push(u),s.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:u=>{const d=this.updateGraphics.indexOf(u);n.history.undo.forEach(g=>g.updates.splice(d,1)),n.history.redo.forEach(g=>g.updates.splice(d,1)),this.updateGraphics.remove(u);const f=this.updateGraphics.toArray();this.emit("update",{graphics:f,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?s.graphics=f:n.complete()}});let a=!1;const o=[i.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(n,u,e),Br.WIDGET),i.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(n,u),u.key!==Vn.constraint||u.repeat||(a=!0,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},Br.WIDGET),i.on("key-up",u=>{u.key===Vn.constraint&&a&&(a=!1,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},Br.WIDGET)],l=this._getHandlesForComponent(n,e);return n}async _setupReshape3DOperation(t,e,i,r=!1){const s="reshape",[n,a,o]=await Promise.all([this._requireModule(W(()=>import("./editingTools-A7JRP1bO.js"),__vite__mapDeps([442,368,370,371,372,365,373,374,364,334,366,289,375,376,390,369,391,392,393,29,386,443,439,408,271,409,316,250,251,252,253,254,255,256,66,257,258,259,260,261,410,378,340,341,342,381,382,397,405,377,444,445,112,113,400,401,399,290,385,402,288,446,440]))),M6(),Bx()]);if(Va(n))return n;const{ManipulatedObject3DGraphic:l,ReshapeTool3D:u}=n.module,d=new l({view:i,graphic:t}),f=tKt(d);if(f!==0)return d.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${mAe(f)}).`),null;const g=e.reshapeOptions,v=new u({view:i,object:d,enableZVertex:e.enableZ&&g?.vertexOperation==="move",enableZShape:e.enableZ&&g?.shapeOperation==="move",enableMoveObject:g?.shapeOperation==="move"||g?.shapeOperation==="move-xy",enableMidpoints:g?.edgeOperation==="split",enableEdgeOffset:g?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:o});i.tools.add(v),r||this.updateGraphics.add(d.graphic);const _=[],x=new t0({activeComponent:v,tool:s,type:"update",onEnd:()=>{Om(_),R6(i,v),d.destroy()},canUndo:()=>!v.destroyed&&v.canUndo,undo:()=>{v.destroyed||(v.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!v.destroyed&&v.canRedo,redo:()=>{v.destroyed||(v.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async S=>{this.updateGraphics.add(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[S],removed:[],type:"selection-change"},type:"update"}),x.onEnd(),x.destroy();const T=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);Va(T)||this._setUpdateOperationHandle(T,e)},removeFromSelection:S=>{this.updateGraphics.remove(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[S],type:"selection-change"},type:"update"}),x.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;x.onEnd(),x.destroy();const S=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,i,!0);Va(S)||this._setUpdateOperationHandle(S,e)}});return _.push(...this._getHandlesForComponent(x,e),i.on("immediate-click",S=>this._getCommonUpdateOperationClickHandlers(x,S,e),Br.WIDGET),i.on("key-down",S=>{this._getCommonUpdateOperationKeyDownHandlers(x,S)},Br.WIDGET)),x}async _setupTransformOrReshape2DOperation(t,e,i,r){this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const s=e==="transform"?await this._getBox(t,i,r):await this._getReshape(t,i,r);if(Va(s))return s;const n=new t0({activeComponent:s,type:"update",onEnd:()=>{Om(o),Om(a),n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{O6(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{P6(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async l=>{let u=n.activeComponent;if(u?.type==="reshape"){const d=[...this.updateGraphics,l];this.updateGraphics.removeAll(),n.onEnd(),n.destroy();const f=await this._setupTransformOrReshape2DOperation(d,"transform",i,r);if(Va(f))return;this._setUpdateOperationHandle(f,i)}else this.updateGraphics.add(l),u.graphics=this.updateGraphics.toArray(),u.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:l=>{const u=this.updateGraphics.indexOf(l);n.history.undo.forEach(f=>f.updates.splice(u,1)),n.history.redo.forEach(f=>f.updates.splice(u,1)),this.updateGraphics.remove(l);const d=this.updateGraphics.toArray();d.length===0?n.complete():MAe(d)?n.toggleTool():n.activeComponent.graphics=d,this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),u=l.geometry;if(u!=null&&(n.tool==="reshape"&&u.type==="point"||n.tool==="transform"&&u.type==="extent"))return;let d=null;n.tool==="transform"?d=await this._getReshape([l],i,r):n.tool==="reshape"&&(d=await this._getBox([l],i,r)),Va(d)||(n.activeComponent?.destroy(),n.activeComponent=d,n.activeComponent&&(Om(o),o=this._getHandlesForComponent(n,i)))}}),a=[r.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(n,l,i),Br.WIDGET),r.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,l),l.key===Vn.constraint&&!l.repeat&&n){const u=n.activeComponent;u&&u.type==="box"&&(u.preserveAspectRatio=!u.preserveAspectRatio)}},Br.WIDGET),r.on("key-up",l=>{if(l.key===Vn.constraint&&n){const u=n.activeComponent;u&&u.type==="box"&&(u.preserveAspectRatio=!u.preserveAspectRatio)}},Br.WIDGET)];let o=this._getHandlesForComponent(n,i);return n}async _getGraphicMover(t,e,i){const{enableMoveAllGraphics:r,highlightOptions:s}=e,n=await this._requireModule(W(()=>import("./GraphicMover-BygXxGrz.js").then(a=>a.G),__vite__mapDeps([447,441,342,440])));return Va(n)?n:new n.module.default({enableMoveAllGraphics:r,highlightName:s?.name,highlightsEnabled:!!s?.enabled,indicatorsEnabled:!1,graphics:t,view:i,callbacks:{onGraphicMoveStart:({dx:a,dy:o,graphic:l})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:o,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:a,dy:o,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:o,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:a,dy:o,graphic:l})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:o,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(t,e,i){const{enableRotation:r,enableScaling:s,highlightOptions:n,preserveAspectRatio:a}=e,[o,l]=await Promise.all([this._requireModule(W(()=>import("./Box-B3s24YWD.js"),__vite__mapDeps([448,341,441,342,447,440,449,408,271,409,446,445]))),Bx()]);if(Va(o))return o;const u=this.view?.inputManager?.isModifierKeyDown(Vn.constraint);return new o.module.default({graphics:t,enableRotation:r,enableScaling:s,highlightName:n?.name,highlightsEnabled:!!n?.enabled,preserveAspectRatio:!!a!=!!u,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:l,callbacks:{onMoveStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onMove:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onMoveStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScaleStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScale:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScaleStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotateStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotate:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotateStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"})}})}async _getReshape(t,e,i){const{highlightOptions:r,reshapeOptions:s}=e,n=s?.edgeOperation==="split",a=s?.shapeOperation==="move",o=!!s?.enableCreateCurveFromStraightEdge,[l,u,d]=await Promise.all([this._requireModule(W(()=>import("./Reshape-BzOjVg77.js"),__vite__mapDeps([450,258,252,255,254,256,66,257,259,438,375,376,119,112,113,443,441,342,447,440,408,271,409,444,410,445,449,340,341]))),M6(),Bx()]);return Va(l)?l:new l.module.default({enableMidpoints:n,enableMovement:a,enableCurveOnMidpoint:o,graphic:t[0],highlightName:r?.name,highlightsEnabled:!!r?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:u,automaticLengthMeasurementUtils:d,view:i,callbacks:{onReshapeStart:f=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...f},type:"update"}),onReshape:f=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...f},type:"update"}),onReshapeStop:({mover:f,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:f,type:g},type:"update"}),onMoveStart:({dx:f,dy:g,mover:v,type:_})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:g,mover:v,type:_},type:"update"}),onMove:({dx:f,dy:g,mover:v,type:_})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:g,mover:v,type:_},type:"update"}),onMoveStop:({dx:f,dy:g,mover:v,type:_})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:g,mover:v,type:_},type:"update"}),onVertexAdd:({added:f,type:g,vertices:v})=>{const _=f.map(x=>pbe(x.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:_,vertices:v,type:g},type:"update"})},onVertexRemove:({removed:f,type:g,vertices:v})=>{const _=f.map(x=>pbe(x.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:_,vertices:v,type:g},type:"update"})}}})}_getHandlesForComponent(t,e){const i=t.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:r,viewEvent:s})=>{s.native?.shiftKey&&e.multipleSelectionEnabled&&(s.stopPropagation(),t.removeFromSelection(r))}),i.on("graphic-move-start",r=>t.addToHistory(hb(r.allGraphics)))];case"box":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(t,e,r)),i.on("move-start",r=>t.addToHistory(hb(r.graphics))),i.on("rotate-start",r=>t.addToHistory(hb(r.graphics))),i.on("scale-start",r=>t.addToHistory(hb(r.graphics)))];case"reshape":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(t,e,r)),i.on("move-start",r=>t.addToHistory(hb([r.mover]))),i.on("reshape-start",r=>t.addToHistory(hb([r.graphic]))),i.on("vertex-add",r=>t.addToHistory(hb([r.oldGraphic]))),i.on("vertex-remove",r=>t.addToHistory(hb([r.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:r})=>{t.addToHistory({updates:r})}),i.events.on("move-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.objects.length>0?r.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r.dx,dy:r.dy,mover:r.objects.length>0?r.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.objects.length>0?r.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],t,e):t.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:r})=>{t.addToHistory({updates:r})}),i.events.on("translate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,angle:r.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,angle:r.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,angle:r.angle,type:"rotate"},type:"update"})}),i.events.on("scale",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.object.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r,mover:r.object.graphic},type:"update"})}),i.events.on("move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r,mover:r.object.graphic},type:"update"})}),i.events.on("vertex-add",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.events.on("vertex-remove",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,i){const{graphic:r,viewEvent:s}=i;return s.native?.shiftKey&&this.hasGraphic(r)?(s.stopPropagation(),t.removeFromSelection(r)):e.toggleToolOnClick?(s.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){this._operationHandle=t;const i=this.view?.map;this._disablePopup(e);const r=()=>{if(t===this._operationHandle){const s=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:s,state:"complete",aborted:t.cancelled,tool:n,toolEventInfo:null,type:"update"})}};t.on("complete",r)}async _getCommonUpdateOperationClickHandlers(t,e,i){const r=jd(e),s=await e.defer(()=>this._getFirstHit(r));if(s==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([s.graphic],t,i))return void e.stopPropagation();this.updateGraphics.includes(s.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,i){const r=!!i.multipleSelectionEnabled;return t.some(s=>s!=null&&!(!r||!this.hasGraphic(s))&&(this.updateGraphics.includes(s)?e.removeFromSelection(s):e.addToSelection(s),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const i=e.key;i===Vn.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):i===Vn.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):i===Vn.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&Vn.delete.includes(i)&&this._onDeleteKey(e)}_onDeleteKey(t){if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,i=this.updateGraphics.toArray();e!=null&&(e.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Pe(this._internalGraphicsLayer))}_isComponentGraphic(t){const{activeComponent:e}=this;return!(!t||e==null)&&(t.attributes?.esriSketchTool||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_clearCursor(){this.removeHandles(gee)}_displayCursor(t){this.removeHandles(gee),this.view?.container&&t!=null&&this.addHandles(this.view.acquireCursor(t,"high"),gee)}_logError(t,e,i){re.getLogger(this).error(new q(t,e,i))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const i=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}_onLayerGraphicsChangeCallback(t){if(this._operationHandle!=null){const{updateGraphics:e}=this;for(const i of t.removed)if(e.includes(i)){if(!(e.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(i)}}}get test(){}wait(){return qu(()=>!this.updating)}_disablePopupEnabled(t){return this.view?.type!=="3d"||this.updateOnGraphicClick||(t?.toggleToolOnClick??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const t=this.view;t?(Rs(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await A0(qu(()=>t?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",OAe("view"))}_logMissingLayer(){this._logError(oti,OAe("layer"))}};c([p()],_r.prototype,"_defaultSnappingManager",void 0),c([p()],_r.prototype,"_layerAdapter",null),c([p()],_r.prototype,"_operationHandle",void 0),c([p({readOnly:!0})],_r.prototype,"_updatingHandles",void 0),c([p({readOnly:!0})],_r.prototype,"activeTool",null),c([p({readOnly:!0})],_r.prototype,"activeCreateToolDrawMode",null),c([p()],_r.prototype,"activeTooltip",null),c([p({types:Vh})],_r.prototype,"activeFillSymbol",void 0),c([p()],_r.prototype,"activeLineSymbol",void 0),c([p()],_r.prototype,"activeVertexSymbol",void 0),c([p()],_r.prototype,"allowDeleteKey",void 0),c([p({readOnly:!0})],_r.prototype,"createGraphic",null),c([p()],_r.prototype,"defaultCreateOptions",null),c([p()],_r.prototype,"defaultUpdateOptions",null),c([p({type:lme,nonNullable:!0})],_r.prototype,"labelOptions",null),c([p()],_r.prototype,"layer",void 0),c([p({types:Vh})],_r.prototype,"pointSymbol",void 0),c([p({types:Vh})],_r.prototype,"polygonSymbol",void 0),c([p({types:Vh})],_r.prototype,"polylineSymbol",void 0),c([p()],_r.prototype,"meshSymbol",void 0),c([p()],_r.prototype,"textSymbol",void 0),c([p({type:Ga,nonNullable:!0})],_r.prototype,"snappingOptions",null),c([p()],_r.prototype,"snappingManager",null),c([p({readOnly:!0})],_r.prototype,"state",null),c([p({type:cme,nonNullable:!0})],_r.prototype,"tooltipOptions",null),c([p({readOnly:!0})],_r.prototype,"updateGraphics",void 0),c([p()],_r.prototype,"updateOnGraphicClick",void 0),c([p()],_r.prototype,"updating",null),c([p()],_r.prototype,"creationMode",void 0),c([p({type:ume,nonNullable:!0})],_r.prototype,"valueOptions",null),c([p({types:Vh})],_r.prototype,"vertexSymbol",void 0),c([p({value:null})],_r.prototype,"view",null),c([p({constructOnly:!0,type:aZe})],_r.prototype,"sketchOptions",void 0),_r=c([R("esri.widgets.Sketch.SketchViewModel")],_r);const oti="sketch:missing-property",OAe=t=>`Property '${t}' is missing on SketchViewModel.`;function lti(t){return t==="polygon"||t==="rectangle"||t==="circle"}function O6(t,e){qZe("undo",t.history.undo,t.history.redo,e)}function P6(t,e){qZe("redo",t.history.redo,t.history.undo,e)}function qZe(t,e,i,r){const s=e.pop();if(!s)return;const n=s.updates,a=[];r.forEach((o,l)=>{const u=n[l];u!=null&&("geometry"in u&&u.geometry!=null&&(a.push({geometry:o.geometry}),o.geometry=u.geometry),"symbol"in u&&u.symbol!=null&&(a.push({symbol:o.symbol}),o.symbol=u.symbol),"undo"in u&&(a.push(u),u[t](o)))}),i.push({updates:a})}function PAe(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function hb(t){return{updates:t.map(({geometry:e})=>e?.type==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function R6(t,e){t.tools?.remove(e),e.destroyed||e.destroy()}function Va(t){return"requireError"in t&&t.requireError==="aborted"}function cti(t){return t==="2d"?new fl({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[255,255,255,255]}]}}}):new Rn({color:[0,0,0,0]})}let Ah=class extends be{constructor(e){super(e),this.state="ready",this._pendingStartOptions=null,this._previousInputInfo=null,this._shouldRemoveLastPoint=!1,this._sketchedGraphics=new WeakSet,this._creationToolPromise=null,this._updateToolPromise=null,this._updateDisabled=!1}initialize(){this.addHandles(X(()=>({view:this.tool.viewModel.view,visible:this.tool.visible}),({view:e,visible:i})=>{e!=null&&i?this._attach(e):this._detach()},bt),"view")}destroy(){this._detach()}get canStopCreating(){const e=this._geometry,i=this._shouldRemoveLastPoint?3:2;return oz(e)&&e.paths.length>0&&e.paths[0].length>=i}get _input(){return this.tool.viewModel.input}set _input(e){this.tool.viewModel.input=e}get _geometry(){return this._input?.geometry}get _visibleAndEditable(){return this.tool.visible&&this.tool.editable}get _view(){return this.tool.viewModel.view}get test(){}start(e={mode:"sketch"}){if(!this.tool.editable)return;const i=this._view;if(i!=null&&i.ready)switch(this._pendingStartOptions=null,this._stopInteraction(),this._previousInputInfo==null&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),e.mode){case"sketch":this._set("state","creating"),this._startCreationInteraction();break;case"select":this._set("state","selecting"),this._startSelectionInteraction()}else this._pendingStartOptions=e}stop(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._clearPreviousInput()}cancel(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._restorePreviousInput()}clear(){this._stopInteractionAndUpdate(),this._set("state","ready"),this._clearPreviousInput(),this._input=null,this._pendingStartOptions=null}isSketchedGraphic(e){return e!=null&&this._sketchedGraphics.has(e)}_attach(e){this._detach();const i={mode:e.type==="3d"?"relative-to-ground":"on-the-ground",offset:null};this._graphicsLayer=new gg({listMode:"hide",internal:!0,elevationInfo:i,title:"Elevation info"});const r=cti(e.type);this._sketchVM=new _r({layer:this._graphicsLayer,view:e,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:r,activeLineSymbol:r}),this.addHandles([vs(()=>e.ready,()=>{const s=this._pendingStartOptions;s&&this.start(s)},bt),X(()=>[this._input,this._visibleAndEditable],()=>this._update(),bt),X(()=>({map:e.map,graphicsLayer:this._graphicsLayer}),({map:s,graphicsLayer:n})=>{s!=null&&n!=null&&s.add(n),this._update()},bt)],"main")}_detach(){this.removeHandles("main"),this._sketchVM=Pe(this._sketchVM),this._creationToolPromise=null,this._updateToolPromise=null;const e=this._view?.map,i=this._graphicsLayer;e!=null&&i!=null&&e.remove(i),this._graphicsLayer=Pe(this._graphicsLayer),this._shouldRemoveLastPoint=!1,this._set("state","ready")}_startCreationInteraction(){this._stopInteractionAndUpdate();const e=this._view,i=this._sketchVM;if(e==null||i==null)return;this._shouldRemoveLastPoint=!1;const r=i.on("create",n=>{const a=n.graphic;switch(n.state){case"complete":this._shouldRemoveLastPoint=!1,this._setSketchedGraphic(a),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"cancel":this.cancel();break;case"active":this._setSketchedGraphic(a),n.toolEventInfo?.type==="cursor-update"&&(this._shouldRemoveLastPoint=!0);break;case"start":this._setSketchedGraphic(a)}}),s=()=>{r.remove();const n=this.canStopCreating,a=this._geometry?.clone();i.cancel(),this._creationToolPromise=null,a!=null&&n?this._shouldRemoveLastPoint&&this._setSketchedGraphic(new ms({geometry:uti(a)})):this._input=null};this.removeHandles("interaction"),this.addHandles(bi(s),"interaction"),this._creationToolPromise=bp(i.create("polyline"))}_startReshapeInteraction(){this._stopInteraction();const e=this._view,i=this._sketchVM;if(e==null||i==null)return;const r=i.on("update",a=>{const o=a.graphics[0];switch(a.state){case"complete":this._setSketchedGraphic(o),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"active":case"start":this._setSketchedGraphic(o)}}),s=()=>{r.remove(),i.cancel(),this._updateToolPromise=null};this.removeHandles("interaction"),this.addHandles(bi(s),"interaction");const n=this._input;n&&(n.visible=!0,this._updateToolPromise=bp(i.update(n,{tool:"reshape"})))}_startSelectionInteraction(){this._stopInteraction();const e=this._view;if(e==null)return;const i=e.acquireCursor("crosshair","high");e.closePopup();let r=null;const s=bi(()=>Rs(r)),n=e.on("immediate-click",o=>{o.defer(async()=>{Rs(r),r=sc(async l=>{const{results:u}=await e.hitTest(o);ct(l);const d=u.filter(f=>f.type==="graphic").map(f=>f.graphic).find(f=>f.geometry!=null&&f.geometry.type==="polyline");d&&(o.preventDefault(),o.stopPropagation(),this._input=d,this._clearPreviousInput(),this._stopInteractionAndUpdate())}),await r.promise})},Br.TOOL),a=e.on("key-down",o=>{o.key==="Escape"&&this.cancel()});this.removeHandles("interaction"),this.addHandles([n,a,s,i],"interaction"),e.ready&&e.focus()}_stopInteraction(){this.removeHandles("interaction")}_stopInteractionAndUpdate(){this.hasHandles("interaction")&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())}_triggerUpdate(){this._set("state","ready"),this._update()}_update(){if(this._updateDisabled)return;const e=this.state;if(e!=="selecting"){if(this._visibleAndEditable){if(e==="creating"||e==="reshaping"&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState()),this._updateVisuals()}else this.stop()}_getNextState(){return this._input==null?"ready":this.isSketchedGraphic(this._input)?this.state==="creating"?"creating":this._visibleAndEditable?"reshaping":"reshaping-disabled":"selected"}_updateVisuals(){switch(this.state){case"creating":break;case"reshaping":this._startReshapeInteraction();break;case"reshaping-disabled":{this._stopInteractionAndUpdate();const e=this._input;e!=null&&this.isSketchedGraphic(e)&&(e.visible=!1);break}case"ready":case"selected":this._stopInteractionAndUpdate()}this._updateSketchedGraphic()}_storePreviousInput(e){this._previousInputInfo={graphic:e}}_restorePreviousInput(){const e=this._previousInputInfo;e!=null&&(this._clearPreviousInput(),this._input=e.graphic,this._triggerUpdate())}_clearPreviousInput(){this._previousInputInfo=null}_updateSketchedGraphic(){const e=this._graphicsLayer;if(e==null)return;const i=e.graphics,r=this._input;if(r==null||!this.isSketchedGraphic(r))return void i.removeAll();if(i.indexOf(r)===-1)i.removeAll(),i.add(r);else if(i.length!==1){const s=i.filter(n=>n!==r);i.removeMany(s)}}_setSketchedGraphic(e){e!=null&&this._sketchedGraphics.add(e),this._input=e,this._updateSketchedGraphic()}};function uti(t){if(oz(t)){const e=t.clone();return e.paths=[e.paths[0].slice(0,-1)],e}return t}c([p({nonNullable:!0})],Ah.prototype,"state",void 0),c([p({nonNullable:!0})],Ah.prototype,"tool",void 0),c([p()],Ah.prototype,"canStopCreating",null),c([p()],Ah.prototype,"_graphicsLayer",void 0),c([p()],Ah.prototype,"_sketchVM",void 0),c([p()],Ah.prototype,"_input",null),c([p()],Ah.prototype,"_geometry",null),c([p()],Ah.prototype,"_visibleAndEditable",null),c([p()],Ah.prototype,"_view",null),c([p()],Ah.prototype,"_shouldRemoveLastPoint",void 0),Ah=c([R("esri.widgets.ElevationProfile.ElevationProfileInteraction")],Ah);let k8=class extends be{constructor(e){super(e),this._implementation=null,this._loadingTask=null}initialize(){this.addHandles(X(()=>({tool:this.tool,view:this.tool.viewModel.view,visible:this.tool.visible&&!!this.tool.viewModel.view?.ready}),({tool:e,view:i,visible:r})=>{i!=null&&r?this._show(i,e):this._hide()},bt))}destroy(){this._hide()}_show(e,i){this._loadingTask=Rs(this._loadingTask),this._loadingTask=sc(async r=>{if(e.type==="2d"){const s=W(()=>import("./ElevationProfileView2D-C0ZtDvFl.js"),__vite__mapDeps([451,452,118,250,251,252,253,254,255,256,66,257,258,259,260,261])),n=(await A0(s,r)).ElevationProfileView2D;this._implementation=new n(e,i)}else if(e.type==="3d"){const s=W(()=>import("./ElevationProfileView3D-w5oUT9ou.js"),__vite__mapDeps([453,452,118,250,251,252,253,254,255,256,66,257,258,259,260,261,390,369,391,372,365,373,334,392,393,29,443])),n=(await A0(s,r)).ElevationProfileView3D;this._implementation=new n(e,i)}})}_hide(){this._loadingTask=Rs(this._loadingTask),this._implementation=Pe(this._implementation)}};c([p()],k8.prototype,"tool",void 0),k8=c([R("esri.widgets.ElevationProfile.support.ElevationProfileView")],k8);let Rv=class extends be{constructor(e){super(e),this.editable=!0,this.visible=!0,this.highlightEnabled=!0}initialize(){this.view=new k8({tool:this}),this.interaction=new Ah({tool:this})}destroy(){this.interaction.destroy(),this.view.destroy()}get state(){switch(this.interaction?.state){case"ready":return"ready";case"creating":return"creating";case"selecting":return"selecting";case"selected":return"selected";case"reshaping":case"reshaping-disabled":return"created"}}};c([p({nonNullable:!0})],Rv.prototype,"viewModel",void 0),c([p()],Rv.prototype,"view",void 0),c([p()],Rv.prototype,"interaction",void 0),c([p()],Rv.prototype,"editable",void 0),c([p()],Rv.prototype,"visible",void 0),c([p()],Rv.prototype,"highlightEnabled",void 0),Rv=c([R("esri.widgets.ElevationProfile.ElevationProfileTool")],Rv);let Mr=class extends be{constructor(t){super(t),this.view=null,this.input=null,this._getEffectiveUnitsMemoized=dp((e,i)=>({distance:e,elevation:i})),this.hoveredChartPosition=null,this.uniformChartScaling=!1,this.defaultUnit=null,this.queue=null,this._currentTileCache=null,this.error=null,this._defaultProfileLineGround=new rZe,this._userUnitOptions=null,this._userUnit=null,t?.profiles||(this.profiles=new ke([this._defaultProfileLineGround]))}initialize(){this.addHandles(X(()=>this.view,t=>{if(t==null)return void re.getLogger(this).warnOnce("no view. Widget will be disabled until a view is provided.");this.removeHandles(RAe);const e=t.type==="3d"?t.resourceController:void 0;this.queue?.destroy(),this.queue=kXt(e?.scheduler);const i=e?.addUpdatingObject(this);i&&this.addHandles(i,RAe)},bt)),this.tool=new Rv({viewModel:this}),this._controller=new kb({viewModel:this})}destroy(){this._defaultProfileLineGround=Pe(this._defaultProfileLineGround),this._controller=Pe(this._controller),this._currentTileCache=Pe(this._currentTileCache),this.tool=Pe(this.tool),this.queue=Pe(this.queue)}get profiles(){return this._get("profiles")}set profiles(t){const e=this._get("profiles"),i=t??new ke;this._set("profiles",ju(i,e))}get state(){const t=this.view;return t!=null&&t.ready?this.tool.state:"disabled"}get progress(){let t=0,e=0;for(const i of this.visibleProfiles)t++,e+=i.progress;return t>0?e/t:0}set unitOptions(t){this._userUnitOptions=t,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(t){this._userUnit=t?this._findSelectableUnit(t,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}get effectiveUnits(){const t=PXt(this.visibleProfiles.map(r=>r.result)),e=Xst(t.maxDistance,"meters",this.unit),i=Kst(t.maxElevation,"meters",this.unit);return this._getEffectiveUnitsMemoized(e,i)}get highlightEnabled(){return this.tool.highlightEnabled}set highlightEnabled(t){this.tool.highlightEnabled=t}get hasVertices(){const t=this.input?.geometry;return oz(t)&&t.paths.reduce((e,i)=>e+i.length,0)>0}get hoveredPoints(){return this.input!=null&&this.visible&&this.tool.editable?this.visibleProfiles.map(t=>{const e=t.hoveredPoint;return e!=null?{hoveredPoint:e,color:t.color}:null}).filter(wl):[]}get statistics(){return OXt(this.visibleProfiles.map(t=>t.statistics))}get chartData(){if(this.input==null)return null;const{effectiveUnits:t,progress:e,statistics:i,visibleProfiles:r,uniformChartScaling:s}=this,n=r.filter(a=>a.hasZ).map(a=>({id:a.id,type:a.type,title:a.title,color:a.color,samples:a.samples,progress:a.progress,chartFillEnabled:a.chartFillEnabled,chartStrokeWidth:a.chartStrokeWidth,chartStrokeOffsetY:a.chartStrokeOffsetY,viewVisualizationEnabled:a.viewVisualizationEnabled}));return n.length===0?null:{lines:n,effectiveUnits:t,statistics:i,refined:e===1,dynamicElevationRange:r.some(a=>a.type==="view"),uniformScaling:s}}get visibleProfiles(){return this.profiles.toArray().filter(t=>t.available&&t.visible)}get minDemResolutions(){const t=[];for(const{minDemResolution:e}of this.visibleProfiles)e!=null&&t.push(e);return t}get minDemResolution(){return YOe(this.minDemResolutions)}get errorState(){const t=this.input?.geometry;if(!ame(t))return"no-valid-input";if(this.error!=null){if(gXt(this.error))switch(this.error.cause){case"too-complex":return"too-complex";case"invalid-geometry":return"invalid-geometry";case"invalid-elevation-info":return"invalid-elevation-info";case"elevation-query-error":return"no-valid-input"}return"unknown-error"}return this.visibleProfiles.length===0?"no-visible-profiles":this.chartData==null&&this.progress===1?"refined-but-no-chart-data":"none"}get tileCache(){this._currentTileCache=Pe(this._currentTileCache);const t=this.view;if(t!=null&&t?.type==="3d"){const e=t.basemapTerrain?.elevationQueryCache;if(e!=null)return e}return this._currentTileCache==null&&(this._currentTileCache=new _9e(new Ihe(20971520))),this._currentTileCache}get visible(){return this.tool.visible}set visible(t){this.tool.visible=t}get selectAvailable(){for(const t of this.view?.map?.allLayers??[])if(t.type==="graphics"&&!t.internal&&t.graphics.some(e=>e.geometry?.type==="polyline")||"geometryType"in t&&t.geometryType==="polyline")return!0;return!!this.view?.graphics?.some(t=>t.geometry?.type==="polyline")}get inputIsSketched(){return this.tool.interaction.isSketchedGraphic(this.input)}get elevationProvider(){const t=this.view;return t!=null&&t.type==="3d"?t.elevationProvider:null}get updating(){const{progress:t}=this,e=!!this.queue?.updating;return t>0&&t<1||e}start(t){this.tool.interaction.start(t)}stop(){this.tool.interaction.stop()}cancel(){this.tool.interaction.cancel()}clear(){this.tool.interaction.clear()}_findSelectableUnit(t,e){const i=this.unitOptions;return t!=null&&i.includes(t)?t:e?this._findSelectableUnit(e):i[0]}_filteredOrAllUnits(t){const e=(t??[]).filter(i=>P5.includes(i));return e.length===0?P5.slice():e}};c([p()],Mr.prototype,"view",void 0),c([p({type:ms})],Mr.prototype,"input",void 0),c([p({type:KXt,nonNullable:!0})],Mr.prototype,"profiles",null),c([p({readOnly:!0})],Mr.prototype,"state",null),c([p({readOnly:!0})],Mr.prototype,"progress",null),c([p()],Mr.prototype,"unitOptions",null),c([p()],Mr.prototype,"unit",null),c([p({readOnly:!0})],Mr.prototype,"effectiveUnits",null),c([p()],Mr.prototype,"hoveredChartPosition",void 0),c([p()],Mr.prototype,"uniformChartScaling",void 0),c([p()],Mr.prototype,"highlightEnabled",null),c([p({readOnly:!0})],Mr.prototype,"hoveredPoints",null),c([p({readOnly:!0})],Mr.prototype,"statistics",null),c([p()],Mr.prototype,"chartData",null),c([p()],Mr.prototype,"visibleProfiles",null),c([p()],Mr.prototype,"minDemResolutions",null),c([p({readOnly:!0})],Mr.prototype,"minDemResolution",null),c([p({readOnly:!0})],Mr.prototype,"errorState",null),c([p(cXt)],Mr.prototype,"defaultUnit",void 0),c([p()],Mr.prototype,"queue",void 0),c([p()],Mr.prototype,"tileCache",null),c([p()],Mr.prototype,"tool",void 0),c([p()],Mr.prototype,"visible",null),c([p()],Mr.prototype,"error",void 0),c([p()],Mr.prototype,"selectAvailable",null),c([p()],Mr.prototype,"inputIsSketched",null),c([p()],Mr.prototype,"elevationProvider",null),c([p()],Mr.prototype,"updating",null),c([p()],Mr.prototype,"_defaultProfileLineGround",void 0),c([p()],Mr.prototype,"_userUnitOptions",void 0),c([p()],Mr.prototype,"_controller",void 0),c([p()],Mr.prototype,"_userUnit",void 0),Mr=c([R("esri.widgets.ElevationProfile.ElevationProfileViewModel")],Mr);const RAe=Symbol("updating-object"),GZe=Mr;let vf=class extends be{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};c([p()],vf.prototype,"legend",void 0),c([p()],vf.prototype,"chart",void 0),c([p()],vf.prototype,"clearButton",void 0),c([p()],vf.prototype,"settingsButton",void 0),c([p()],vf.prototype,"sketchButton",void 0),c([p()],vf.prototype,"selectButton",void 0),c([p()],vf.prototype,"unitSelector",void 0),c([p()],vf.prototype,"uniformChartScalingToggle",void 0),vf=c([R("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],vf);const HZe=vf,hti=100;let F2=class extends ym{constructor(e,i){super(e,i),this._updateLayout=r=>{const s=r.parentElement,n=r.style.display;s?.removeChild(r),document.body.appendChild(r),r.style.display="block";let a=80;for(const o of r.childNodes)o instanceof HTMLElement&&(a=Math.max(a,o.offsetWidth));document.body.removeChild(r),s?.appendChild(r),r.style.display=n,r.style.setProperty("--max-width",`${a}px`)},this._updateLayoutThrottled=HWe(this._updateLayout,hti)}loadDependencies(){return F1({icon:()=>W(()=>Promise.resolve().then(()=>EOe),void 0)})}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return Rt("div",{afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled,bind:this,class:tD.base},this._renderStatistics())}_renderStatistics(){const e=this._messages?.statistics;return e?[this._renderDistanceStatistic("maxDistance",e.maxDistance),this._renderElevationStatistic("elevationGain",e.gain),this._renderElevationStatistic("elevationLoss",e.loss),this._renderElevationStatistic("minElevation",e.minElevation),this._renderElevationStatistic("maxElevation",e.maxElevation),this._renderElevationStatistic("avgElevation",e.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",e.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",e.avgSlope)]:[]}_renderDistanceStatistic(e,i){const r=rm().formatPrecision,s=this._renderValue(e,n=>{const a=this.effectiveUnits.distance;return Mp(this._messagesUnits,n,a,r)});return this._renderStatistic(i,s)}_renderElevationStatistic(e,i){const r=rm().formatPrecision,s=this._renderValue(e,n=>{const a=this.effectiveUnits.elevation;return Mp(this._messagesUnits,n,a,r)});return this._renderStatistic(i,s)}_renderSlopeStatistic(e,i,r){const s=rm().formatPrecision,n=Rt("div",{class:tD.slopeValue,key:"slope-up"},Rt("calcite-icon",{icon:"arrow-up",scale:"s"}),this._renderValue(e,a=>pL(a,"degrees","geographic","geographic",s)),Rt("calcite-icon",{icon:"arrow-down",scale:"s"}),this._renderValue(i,a=>pL(a,"degrees","geographic","geographic",s)));return this._renderStatistic(r,n)}_renderStatistic(e,i){return Rt("div",{class:tD.statistic},Rt("label",{class:tD.statisticLabel},e),Rt("div",{class:tD.statisticValue},i))}_renderValue(e,i){const r=this.line,s=r.progress===1?r.statistics:null,n=s?.[e];return n!=null?i(n):uXt}};c([p()],F2.prototype,"effectiveUnits",void 0),c([p()],F2.prototype,"line",void 0),c([p(),gp("esri/widgets/ElevationProfile/t9n/ElevationProfile")],F2.prototype,"_messages",void 0),c([p(),gp("esri/core/t9n/Units")],F2.prototype,"_messagesUnits",void 0),F2=c([R("esri.widgets.ElevationProfile.components.Statistics")],F2);function IAe(t,{profiles:e}){const i=t.title;if(i!=null)return i;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}let _f=class extends ym{constructor(e,i){super(e,i),this.checkboxVisible=!0,this.expanded=!1}loadDependencies(){return F1({action:()=>W(()=>import("./index-KItPO4jS.js"),[]),checkbox:()=>W(()=>import("./index-CcU3pdnD.js"),[]),label:()=>W(()=>Promise.resolve().then(()=>Ame),void 0)})}initialize(){this._statistics=new F2(this._statisticsProps),this.addHandles(X(()=>this._statisticsProps,e=>this._statistics.set(e)))}destroy(){this._statistics=Pe(this._statistics)}render(){const e=this.expanded;return Rt("div",{class:this.classes(Wy.base,{[Wy.disabled]:this.disabled,[Wy.expanded]:e}),key:this},this._renderColorIndicator(),Rt("div",{class:Wy.header,key:"header"},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),e?Rt("div",{class:Wy.content,key:"content"},this._statistics.render()):null)}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return Rt("div",{class:Wy.colorIndicator,key:"color-indicator",styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const{expanded:e,messages:i}=this,r=e?i.hideDetails:i.showDetails;return Rt("calcite-action",{appearance:"transparent",bind:this,class:Wy.collapseToggle,"data-testid":"legend-toggle",icon:e?"chevron-up":"chevron-down",key:"collapse-toggle",onclick:this._onCollapseToggleClick,scale:"s",text:r,title:r})}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:e,checkboxVisible:i,disabled:r,messages:s}=this;return Rt("calcite-label",{class:Wy.label,disabled:r,key:`label-${e.id}`,layout:"inline"},i?this._renderCheckbox():null,IAe(e,s))}_renderCheckbox(){const{disabled:e,line:i,messages:r}=this,s=i.visible,n=s?r.hideProfile:r.showProfile,a=jct(n,{name:IAe(i,r)});return Rt("calcite-checkbox",{checked:s,class:Wy.checkbox,disabled:e,title:a,onCalciteCheckboxChange:()=>i.toggleVisibility()})}};c([p()],_f.prototype,"checkboxVisible",void 0),c([p()],_f.prototype,"disabled",null),c([p({nonNullable:!0})],_f.prototype,"effectiveUnits",void 0),c([p()],_f.prototype,"expanded",void 0),c([p({nonNullable:!0})],_f.prototype,"line",void 0),c([p()],_f.prototype,"messages",void 0),c([p()],_f.prototype,"onExpandedToggle",void 0),c([p()],_f.prototype,"_statistics",void 0),_f=c([R("esri.widgets.ElevationProfile.components.LegendItem")],_f);let z2=class extends ym{constructor(){super(...arguments),this._expandedLine=null}render(){const{profiles:e,messages:i,effectiveUnits:r,_expandedLine:s}=this;return Rt("div",{class:lXt.base},e.map(n=>Rt(_f,{checkboxVisible:e.length>1,effectiveUnits:r,expanded:n===s,line:n,messages:i,onExpandedToggle:()=>this._onExpandedToggle(n)})))}_onExpandedToggle(e){this._expandedLine=e===this._expandedLine?null:e}};c([p()],z2.prototype,"effectiveUnits",void 0),c([p()],z2.prototype,"messages",void 0),c([p()],z2.prototype,"profiles",void 0),c([p()],z2.prototype,"_expandedLine",void 0),z2=c([R("esri.widgets.ElevationProfile.components.Legend")],z2);const yee="esri-unit-select",vee={base:yee,label:`${yee}__label`,select:`${yee}__select`};let Nb=class extends ym{constructor(e,i){super(e,i),this._onSelectChange=r=>{this.onChange(r.currentTarget.value)}}loadDependencies(){return F1({label:()=>W(()=>Promise.resolve().then(()=>Ame),void 0),option:()=>W(()=>Promise.resolve().then(()=>xii),void 0),select:()=>W(()=>Promise.resolve().then(()=>bii),void 0)})}render(){const{messages:e,options:i,selectLabel:r,value:s,_onSelectChange:n}=this;return Rt("div",{class:vee.base,key:"units"},Rt("calcite-label",{class:vee.label},r,Rt("calcite-select",{class:vee.select,label:r,onCalciteSelectChange:n},i.map(a=>Rt("calcite-option",{key:a,selected:a===s,value:a},Jst(a)?e.systems[a]:e.units[a]?.pluralCapitalized)))))}};c([p()],Nb.prototype,"options",void 0),c([p()],Nb.prototype,"onChange",void 0),c([p()],Nb.prototype,"selectLabel",void 0),c([p()],Nb.prototype,"value",void 0),c([p(),gp("esri/core/t9n/Units")],Nb.prototype,"messages",void 0),Nb=c([R("esri.widgets.support.UnitSelect")],Nb);let Fd=class extends ym{constructor(){super(...arguments),this.messages=null,this._popoverIsOpen=!1,this._referenceElement=null,this._onUniformChartScalingChange=e=>{this.onUniformChartScalingChange(e.currentTarget.checked)}}loadDependencies(){return F1({action:()=>W(()=>import("./index-KItPO4jS.js"),[]),checkbox:()=>W(()=>import("./index-CcU3pdnD.js"),[]),label:()=>W(()=>Promise.resolve().then(()=>Ame),void 0),popover:()=>W(()=>import("./index-DTyaIIOv.js").then(e=>e.i),__vite__mapDeps([454,455,456,457,458]))})}render(){const{id:e,messages:i,visibleElements:r}=this,{unitSelector:s,uniformChartScalingToggle:n}=r;if(!i||!s&&!n)return Rt("div",{key:`${e}-empty`});const a=this._popoverIsOpen?i.hideSettings:i.showSettings;return Rt("div",{class:b6.base,key:this},Rt("calcite-action",{afterCreate:o=>{this._referenceElement=o},appearance:"transparent","data-testid":"settings-button",icon:"gear",scale:"s",text:a,title:a}),this._referenceElement?Rt("calcite-popover",{autoClose:!0,label:a,placement:"bottom-end",referenceElement:this._referenceElement,onCalcitePopoverClose:()=>{this._popoverIsOpen=!1},onCalcitePopoverOpen:()=>{this._popoverIsOpen=!0}},this._renderPopoverContent()):null)}_renderPopoverContent(){const{unitSelector:e,uniformChartScalingToggle:i}=this.visibleElements;return Rt("div",{class:b6.popoverContent},e?this._renderUnitSelector():null,i?this._renderUniformChartScalingToggle():null)}_renderUnitSelector(){const{messages:e}=this;return Rt(Nb,{key:"unit-selector-label",options:this.unitOptions,selectLabel:e?.unitSelectLabel??"",value:this.unit,onChange:this.onUnitChange})}_renderUniformChartScalingToggle(){const{messages:e}=this,i=this.uniformChartScaling,r=e?.[i?"uniformChartScalingDisable":"uniformChartScalingEnable"]??"";return Rt("calcite-label",{class:b6.uniformChartScalingLabel,key:"uniform-chart-scaling-label",layout:"inline"},Rt("calcite-checkbox",{checked:i,class:b6.uniformChartScalingCheckbox,title:r,onCalciteCheckboxChange:this._onUniformChartScalingChange}),e?.uniformChartScalingLabel)}};c([p()],Fd.prototype,"messages",void 0),c([p()],Fd.prototype,"onUniformChartScalingChange",void 0),c([p()],Fd.prototype,"onUnitChange",void 0),c([p()],Fd.prototype,"uniformChartScaling",void 0),c([p()],Fd.prototype,"unit",void 0),c([p()],Fd.prototype,"unitOptions",void 0),c([p()],Fd.prototype,"visibleElements",void 0),c([p()],Fd.prototype,"_popoverIsOpen",void 0),c([p()],Fd.prototype,"_referenceElement",void 0),Fd=c([R("esri.widgets.ElevationProfile.components.SettingsButton")],Fd);const aD=[{type:"select"},{type:"sketch"}],dti={none:null,"no-valid-input":"noProfile","no-visible-profiles":"noProfile","refined-but-no-chart-data":"noProfile","too-complex":"tooComplex","unknown-error":"unknown","invalid-geometry":"invalidGeometry","invalid-elevation-info":"invalidElevationInfo"};let cn=class extends ym{constructor(e,i){super(e,i),this.viewModel=null,this.visibleElements=new HZe,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=dp((r,s,n,a)=>({chart:r,data:s,stationary:n,messages:a})),this._onZoomOutButtonClick=()=>{this._chart?.zoomOut()},this._onClearButtonClick=()=>{this.viewModel.clear()},e?.viewModel||(this._defaultViewModel=new GZe({view:e?.view}),this.viewModel=this._defaultViewModel)}loadDependencies(){return F1({action:()=>W(()=>import("./index-KItPO4jS.js"),[]),button:()=>W(()=>Promise.resolve().then(()=>bW),void 0),loader:()=>W(()=>Promise.resolve().then(()=>Aii),void 0)})}postInitialize(){this.addHandles([X(()=>({container:this._chartContainer}),({container:e})=>{this._destroyChart(),e!=null&&this._initializeChart(e)},Yt),X(()=>this._chartUpdateParams,()=>this._updateChart(this._chartUpdateParams),Yt)])}destroy(){this._destroyChart(),this._defaultViewModel!=null&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get input(){return this.viewModel.input}set input(e){this.viewModel.input=e}get profiles(){return this.viewModel.profiles}set profiles(e){this.viewModel.profiles=e}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(e){this.viewModel.unitOptions=e}get unit(){return this.viewModel.unit}set unit(e){this.viewModel.unit=e}get icon(){return"altitude"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}get test(){return{chart:this._chart}}get _selectButtonVisible(){return this.visibleElements.selectButton===!0&&this.viewModel.selectAvailable}get _chartUpdateParams(){const e=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,e==null||e.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _profilesArray(){return this.profiles.toArray()}render(){const{viewModel:e,visible:i}=this;return Rt("div",{"aria-label":this.messages.widgetLabel,class:this.classes({[Na.base]:i,[Zh.widget]:i,[Zh.panel]:i,[Zh.widgetDisabled]:i&&e.state==="disabled",[Na.refined]:e.progress===1}),key:this},Rt("div",{bind:this,key:"content-wrapper"},i?this._renderContentForState():null))}_renderContentForState(){switch(this.viewModel.state){case"ready":case"disabled":return this._renderContentForReadyState();case"selecting":return this._renderContentForSelectingState();case"creating":return this._renderContentForCreatingState();case"selected":return this._renderContentForSelectedState();case"created":return this._renderContentForCreatedState()}}_renderContentForReadyState(){const{messages:e,visibleElements:i,_selectButtonVisible:r}=this,{sketchButton:s}=i;let n;return n=s&&r?e.readyPrompt:s?e.readyPromptCreateOnly:r?e.readyPromptSelectOnly:e.errors?.noProfile,this._renderContent({prompt:n,chart:!1,actions:aD})}_renderContentForSelectingState(){const{view:e}=this;if(e==null)return null;const i=this.messages[`selectingPrompt-${e.type}`];return this._renderContent({prompt:i,chart:!1,actions:[{type:"select-cancel"}]})}_renderContentForCreatingState(){const{view:e,viewModel:i}=this;if(e==null)return null;const r=i.hasVertices?[{type:"sketch-cancel"},{type:"sketch-done",disabled:!i.tool.interaction.canStopCreating}]:[{type:"select"},{type:"sketch",disabled:!0}];if(i.errorState==="no-valid-input"){const n=this.messages[`creatingPrompt-${e.type}`];return this._renderContent({chart:!1,actions:r,prompt:n})}const s=this._getErrorMessage();return s?this._renderContent({chart:!1,actions:r,prompt:s}):this._renderContent({chart:!0,actions:r})}_renderContentForSelectedState(){const e=this._getErrorMessage();return e?this._renderContent({chart:!1,actions:aD,prompt:e}):this._renderContent({chart:!0,actions:aD})}_renderContentForCreatedState(){const e=this._getErrorMessage();return e?this._renderContent({chart:!1,actions:aD,prompt:e}):this._renderContent({chart:!0,actions:aD})}_getErrorMessage(){const e=dti[this.viewModel.errorState];return e?this.messages?.errors?.[e]:null}_renderContent(e){const i=e.prompt!=null?this._renderPrompt(e.prompt):e.chart&&this._renderChart(),{viewModel:r}=this,s=r.input!=null;return Rt(rQ,null,Rt("header",{class:Na.header,key:"header"},this._zoomOutButtonVisible?this._renderZoomOutButton():null,this.visibleElements.clearButton&&s?this._renderClearButton():null,this.visibleElements.settingsButton?Rt(Fd,{messages:this.messages,uniformChartScaling:r.uniformChartScaling,unit:r.unit,unitOptions:r.unitOptions,visibleElements:this.visibleElements,onUniformChartScalingChange:n=>r.uniformChartScaling=n,onUnitChange:n=>r.unit=n}):null),Rt("div",{class:Na.mainContainer,key:"main-container"},i),this.visibleElements.legend?Rt(z2,{effectiveUnits:r.effectiveUnits,messages:this.messages,profiles:this._profilesArray}):null,this._renderActions(e))}_renderZoomOutButton(){const e=this.messages.zoomOut;return Rt("calcite-action",{appearance:"transparent",class:Na.zoomOutButton,"data-testid":"zoom-out-button",icon:"magnifying-glass-minus",key:"zoom-out",onclick:this._onZoomOutButtonClick,scale:"s",text:e,title:e})}_renderClearButton(){const e=this.messages.clearProfile;return Rt("calcite-action",{appearance:"transparent",class:Na.clearButton,"data-testid":"clear-button",icon:"trash",key:"clear-profile",onclick:this._onClearButtonClick,scale:"s",text:e,title:e})}_renderPrompt(e){return[Rt("div",{bind:this,class:Na.promptContainer,key:"prompt-container"},Rt("p",null,e))]}_renderChart(){if(!this.visibleElements.chart)return Rt("div",{class:Na.chartContainer,key:"empty-chart-container"});const{chartData:e,progress:i}=this.viewModel,r=this._chartIsRefined||this._canRenderChart(),s=e!=null&&i<1;return r?Rt(rQ,null,this._renderSpinner({size:r?"small":"large",visible:s}),Rt("div",{afterCreate:this._onChartContainerUpdate,afterRemoved:this._onChartContainerRemoved,afterUpdate:this._onChartContainerUpdate,bind:this,class:Na.chartContainer,key:"chart-container"})):Rt(rQ,null,this._renderSpinner({size:"large",visible:s}),Rt("div",{class:Na.chartContainer,key:"chart-container-empty"}))}_renderSpinner(e){const i=e.size==="small",r=e.visible??!0;return Rt("calcite-loader",{class:this.classes(Na.chartSpinner,i&&Na.chartSpinnerSmall,r&&Na.chartSpinnerVisible),"data-testid":"chart-spinner",inline:i,key:"spinner",label:"",scale:"s"})}_canRenderChart(){const e=this.viewModel.chartData;if(e==null)return!1;if(!this.viewModel.inputIsSketched)return e.refined;let i=0;for(const{samples:r}of e.lines)i+=r!=null?r.length:0;return e.refined||i<=rm().largeChartSamples}_renderActions({actions:e}){const i=e.map(r=>{switch(r.type){case"sketch":return this.visibleElements.sketchButton&&this._renderAction({action:r,className:Na.sketchButton,label:this.messages.sketchButtonLabel,onClick:this._onSketchButtonClick,primary:!0});case"sketch-cancel":return this.visibleElements.sketchButton&&this._renderAction({action:r,onClick:this._onCancelButtonClick,className:Na.sketchCancelButton,label:this.messagesCommon.cancel,primary:!1});case"sketch-done":return this.visibleElements.sketchButton&&this._renderAction({action:r,onClick:this._onDoneButtonClick,className:Na.sketchDoneButton,label:this.messagesCommon.done,primary:!0});case"select":return this._selectButtonVisible&&this._renderAction({action:r,onClick:this._onSelectButtonClick,className:Na.selectButton,label:this.messages.selectButtonLabel,primary:!1});case"select-cancel":return this._selectButtonVisible&&this._renderAction({action:r,onClick:this._onCancelButtonClick,className:Na.selectCancelButton,label:this.messagesCommon.cancel,primary:!1})}}).filter(Boolean);return i.length?Rt("footer",{class:Na.footer,key:"footer"},i):null}_renderAction({action:e,className:i,label:r,onClick:s,primary:n}){return Rt("calcite-button",{appearance:n?"solid":"outline-fill",bind:this,class:this.classes(Na.actionButton,i),disabled:e.disabled,key:`action-${e.type}`,onclick:s},r)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(e){const{data:i,chart:r,messages:s,stationary:n}=e;r!=null&&s!=null&&n&&this._canRenderChart()&&(r.update(e),this._chartIsRefined=i!=null&&i.refined)}_onChartContainerUpdate(e){this._chartContainer=e}_onChartContainerRemoved(e){this._chartContainer===e&&(this._chartContainer=null)}_initializeChart(e){Rs(this._chartInitTask),this._chartInitTask=sc(async i=>{const{createChart:r}=await W(()=>import("./chartUtils-CBZlw9uE.js"),__vite__mapDeps([459,460,461,462,463,464,465,466,467,468]));ct(i);const s=await r({container:e,abortOptions:{signal:i},onRangeChange:(n,a)=>{this._zoomOutButtonVisible=n!==1||a!==1},onCursorPositionChange:n=>{this.viewModel.hoveredChartPosition=n}});if(i.aborted)throw Pe(s),ti();this._chart=s,this._updateChart(this._chartUpdateParams)})}_destroyChart(){this._chartInitTask=Rs(this._chartInitTask),this._chart=Pe(this._chart),this._chartIsRefined=!1}};c([p({type:GZe})],cn.prototype,"viewModel",void 0),c([p()],cn.prototype,"view",null),c([p()],cn.prototype,"input",null),c([p()],cn.prototype,"profiles",null),c([p()],cn.prototype,"unitOptions",null),c([p()],cn.prototype,"unit",null),c([p({type:HZe,nonNullable:!0})],cn.prototype,"visibleElements",void 0),c([p()],cn.prototype,"icon",null),c([p()],cn.prototype,"label",null),c([p()],cn.prototype,"visible",null),c([p(),gp("esri/widgets/ElevationProfile/t9n/ElevationProfile")],cn.prototype,"messages",void 0),c([p(),gp("esri/t9n/common")],cn.prototype,"messagesCommon",void 0),c([p(),gp("esri/core/t9n/Units")],cn.prototype,"messagesUnits",void 0),c([p()],cn.prototype,"_chartContainer",void 0),c([p()],cn.prototype,"_chart",void 0),c([p()],cn.prototype,"_chartInitTask",void 0),c([p()],cn.prototype,"_chartIsRefined",void 0),c([p()],cn.prototype,"_zoomOutButtonVisible",void 0),c([p()],cn.prototype,"_selectButtonVisible",null),c([p()],cn.prototype,"_chartUpdateParams",null),c([p()],cn.prototype,"_chartMessages",null),c([p()],cn.prototype,"_profilesArray",null),cn=c([R("esri.widgets.ElevationProfile")],cn);const pti=cn;let WZe=class extends F9{#e;constructor(e){super(e),this.setProvisionalExports(void 0)}hostConnected(){this.component.manager.loadedCalled&&RV(this.component)}hostLoad(){this.component.manager.destroyed}hostLoaded(){const{el:e}=this.component,i=e.shadowRoot?.firstElementChild??e.firstElementChild??void 0;e.childElem??=i,this.#e=vs(()=>this.component.view!=null,()=>{this.component.arcgisReady.emit()},{once:!0,initial:!0,sync:!0}),e.isConnected&&RV(this.component)}hostDisconnected(){typeof this.component.el.childElem=="object"&&this.component.view?.ui?.remove(this.component.el.childElem),this.#e?.remove()}hostUpdate(e){e.has("position")&&this.component.el.childElem!=null&&typeof this.component.position=="string"&&RV(this.component),e.has("referenceElement")&&RV(this.component)}};const fti=(t,e)=>i=>gti(i,t);let mti=class extends Bhe{#e=new Map;#t;#i;constructor(e,i){super(e,i),new WZe(e);const r=this,s=r.instance;let n=s.viewModel,a=s.visibleElements;const o=new Proxy(this.exports,{get(l,u,d){return u==="viewModel"?n:u==="visibleElements"?a:Reflect.get(l,u,d)}});if(r.#i=s,r.instance=o,r.exports=o,n){const l={component:e,get exports(){return r.instance.viewModel}};HMt(r).set("viewModel","viewModel"),e.addController(l),n=pje(e,new WeakRef(l),CQe(e)-1,n,r.#e)}r.instance.visibleElements&&(a=r.#a(s))}hostConnected(){this.instance=this.#i,super.hostConnected()}hostLoad(){this.#t=X(()=>this.component.el.view,e=>{const i=this.instance;!("view"in i)&&typeof i.viewModel=="object"?i.viewModel.view=e:i.view=e,!("map"in i)&&typeof i.viewModel=="object"?i.viewModel.map=e?.map:i.map=e?.map},{sync:!0,initial:!0})}hostUpdate(e){e.has("closed")&&(this.instance.visible=!this.component.closed)}hostLoaded(){const{el:e}=this.component;e.childElem??=document.createElement("div"),this.instance.container=e.childElem,(this.component.el.shadowRoot??this.component.el).appendChild(this.instance.container),this.component.closed!==void 0&&this.onLifecycle(()=>X(()=>this.instance.visible,i=>this.component.closed=!i,{initial:!0}))}#a(e){return new Proxy(e.visibleElements,{get:(i,r)=>{if(typeof r=="symbol"||r in Promise.prototype)return i[r];const s=[r],n=this.#o(s);return ule(this.component,a=>{const o=a;this.component[o]=!1;let l=e.visibleElements??{},u;for(const f of s.slice(0,-1))if(typeof l[f]=="object"&&l[f]!==null)l=l[f];else{u=!!l[f];break}u===void 0&&(u=!!(l[s.slice(-1)[0]]??!0));const d=o.startsWith("hide")||o.startsWith("show")?o.startsWith("hide"):u;this.onUpdate(f=>{if(f.has(o)){const g=this.component[o];this.#l(s,g,d)}})},n)}})}#o(e){const i=new Proxy({},{get:(r,s)=>{const n=Reflect.get(r,s);return typeof s=="symbol"||s in Promise.prototype?n:(e.push(s),i)}});return i}#l(e,i,r){let s=this.instance.visibleElements??{};for(const a of e.slice(0,-1))(typeof s[a]!="object"||s[a]===null)&&(s[a]={}),s=s[a];const n=!!(r?!i:i);s[e.at(-1)]=n}hostDestroy(){this.#t?.remove(),super.hostDestroy()}};const gti=U9(mti);const yti=Sl`.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-hidden{display:none!important}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}.esri-widget--panel{min-width:300px;min-height:32px;padding:var(--esri-widget-padding);transition:max-height .25s ease-in-out;overflow-y:auto}:host{display:flex;width:550px}.esri-elevation-profile{--popover-padding: 12px 15px;--chart-height: 180px;--calcite-label-margin-bottom: 0;--actions-spacing-h: 7px;--actions-spacing-v: 6px;isolation:isolate;padding:var(--esri-widget-padding);position:relative;container-type:inline-size}.esri-widget--panel{width:100%}.esri-elevation-profile__header{flex-direction:row;justify-content:flex-end;align-items:center;display:flex}.esri-elevation-profile__footer{flex-wrap:wrap;justify-content:flex-end;align-items:center;margin-top:var(--calcite-spacing-md);display:flex}.esri-elevation-profile__footer calcite-button{min-height:var(--calcite-spacing-xxxl)}.esri-elevation-profile__action-button{width:auto;margin-inline-start:var(--actions-spacing-h)}.esri-elevation-profile__main-container{width:100%;height:var(--chart-height);flex-flow:column;display:flex;position:relative}.esri-elevation-profile__chart-container{width:100%;height:100%;position:relative}.esri-elevation-profile__prompt-container{box-sizing:border-box;text-align:center;justify-content:center;align-items:center;height:100%;margin-bottom:0;padding:var(--popover-padding);display:flex}.esri-elevation-profile__prompt-container>p{width:100%;margin:0}.esri-elevation-profile__chart-spinner{transition:opacity .15s ease-in-out;transition-delay:0;opacity:0;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.esri-elevation-profile__chart-spinner--visible{opacity:1;transition-delay:50ms}.esri-elevation-profile__chart-spinner--small{inset-inline-start:0;top:-22px;left:unset;color:var(--calcite-color-brand);transform:none}@container (width<=400px){.esri-elevation-profile .esri-component.esri-widget--panel{height:auto}.esri-elevation-profile .esri-elevation-profile__footer{flex-direction:column}.esri-elevation-profile .esri-elevation-profile__action-button{align-self:stretch;margin-inline-start:0}.esri-elevation-profile .esri-elevation-profile__action-button:not(:last-of-type){margin-bottom:var(--actions-spacing-v)}}.esri-elevation-profile-settings calcite-popover[calcite-hydrated-hidden]{inset-block-start:-999999px;inset-inline-start:-999999px}.esri-elevation-profile-settings__popover-content{padding:var(--popover-padding);color:var(--calcite-color-text-1);flex-direction:column;gap:var(--calcite-spacing-md);min-width:180px;font-size:var(--calcite-font-size-sm);display:flex}.esri-elevation-profile-legend{margin-top:6px}.esri-elevation-profile-legend-item{background:var(--calcite-color-foreground-3);position:relative}.esri-elevation-profile-legend-item:not(:last-of-type){margin-bottom:2px}.esri-elevation-profile-legend-item--disabled{filter:grayscale();opacity:.4}.esri-elevation-profile-legend-item__color-indicator{inset-inline-start:0;width:3px;height:100%;position:absolute;top:0}.esri-elevation-profile-legend-item__header{flex-direction:row;justify-content:flex-start;align-items:center;display:flex}.esri-elevation-profile-legend-item__content{padding:0 15px 12px;display:block}.esri-elevation-profile-legend-item__collapse-toggle{flex-shrink:0;width:var(--calcite-spacing-xxxl);height:var(--calcite-spacing-xxxl)}.esri-elevation-profile-legend-item__label{flex-grow:1;flex-shrink:1;min-width:0;padding-inline-start:15px}.esri-elevation-profile-statistics{--max-width: 1px;grid-template-columns:repeat(auto-fit,minmax(var(--max-width),1fr));contain:layout paint style;gap:2px 22px;width:100%;display:grid}.esri-elevation-profile-statistics__statistic{text-align:start;white-space:nowrap;width:max-content;display:block}.esri-elevation-profile-statistics__statistic__label{font-size:var(--calcite-font-size-xs);font-weight:var(--calcite-font-weight-regular)}.esri-elevation-profile-statistics__statistic__value{margin-top:-.15em;font-size:var(--calcite-font-size-xs);font-weight:var(--calcite-font-weight-semibold)}.esri-elevation-profile-statistics__slope-value{align-items:center;display:flex}.esri-elevation-profile-statistics__slope-value calcite-icon{width:var(--calcite-spacing-xl);height:var(--calcite-spacing-xl)}.esri-view-height-xsmall .esri-elevation-profile{--chart-height: 68px}.esri-elevation-profile--portrait .esri-elevation-profile-statistics{gap:6px 22px;margin-bottom:var(--calcite-spacing-md)}.esri-elevation-profile--portrait .esri-elevation-profile-statistics__statistic__value{margin-top:var(--calcite-spacing-base)}`,vti=fti(pti);var VT;let _ti=(VT=class extends Wo{constructor(){super(...arguments),this.widget=vti(this),this.viewModel=this.widget.viewModel,this.view=this.widget.view,this.autoDestroyDisabled=!1,this.effectiveUnits=this.viewModel.effectiveUnits,this.hideChart=this.widget.visibleElements.chart,this.hideClearButton=this.widget.visibleElements.clearButton,this.hideLegend=this.widget.visibleElements.legend,this.hideSelectButton=this.widget.visibleElements.selectButton,this.hideSettingsButton=this.widget.visibleElements.settingsButton,this.hideSketchButton=this.widget.visibleElements.sketchButton,this.hideUniformChartScalingToggle=this.widget.visibleElements.uniformChartScalingToggle,this.hideUnitSelector=this.widget.visibleElements.unitSelector,this.highlightEnabled=this.viewModel.highlightEnabled,this.hoveredChartPosition=this.viewModel.hoveredChartPosition,this.icon=this.widget.icon,this.input=this.widget.input,this.label=this.widget.label,this.profiles=this.widget.profiles,this.progress=this.viewModel.progress,this.state=this.viewModel.state,this.uniformChartScaling=this.viewModel.uniformChartScaling,this.unit=this.widget.unit,this.unitOptions=this.widget.unitOptions,this.arcgisPropertyChange=UOe()("input","effectiveUnits","progress","state"),this.arcgisReady=$a()}async destroy(){await this.manager.destroy()}async start(){this.widget.viewModel.start()}async stop(){this.widget.viewModel.stop()}},VT.properties={view:0,autoDestroyDisabled:5,effectiveUnits:0,hideChart:5,hideClearButton:5,hideLegend:5,hideSelectButton:5,hideSettingsButton:5,hideSketchButton:5,hideUniformChartScalingToggle:5,hideUnitSelector:5,highlightEnabled:5,hoveredChartPosition:9,icon:1,input:0,label:1,position:1,profiles:0,progress:8,referenceElement:1,state:3,uniformChartScaling:5,unit:1,unitOptions:0},VT.styles=yti,VT);p$("arcgis-elevation-profile",_ti);function uz(t,e,i,r=2,s="abbr"){return Mp(t,tpe(e,i).value,i,r,s)}function ZZe(t,e,i,r=2,s="abbr"){return GF(t,tpe(e,i).value,i,r,s)}function bti(t,e,i=2,r="abbr"){return $kt(t,e.value,e.unit,i,r)}function wti(t,e,i=2,r="abbr"){return Ckt(t,e.value,e.unit,i,r)}function xti(t,e,i=2,r="abbr"){return Mkt(t,e.value,e.unit,i,r)}function Sti(t,e,i=2,r="abbr"){return Ekt(t,e.value,e.unit,i,r)}function Tti(t,e,i=2,r="abbr"){return Ikt(t,e.value,e.unit,i,r)}function $ti(t,e,i=2,r="abbr"){return kkt(t,e.value,e.unit,i,r)}function Cti(t,e,i=2,r="abbr"){return Akt(t,e.value,e.unit,i,r)}function Mti(t,e,i=2,r="abbr"){return Okt(t,e.value,e.unit,i,r)}function Eti(t,e,i=2,r="abbr"){return Pkt(t,e.value,e.unit,i,r)}function Ati(t,e,i=2,r="abbr"){return Rkt(t,e.value,e.unit,i,r)}function Oti(t,e,i=2,r="abbr"){return Dkt(t,e.value,e.unit,i,r)}function Pti(t,e,i=2,r="abbr"){return Lkt(t,e.value,e.unit,i,r)}function HOi(t,e,i,r=JL,s=!0){return pL(t.value,t.unit,t.rotationType,e,i,r,s)}function Rti(t,e,i,r,s="abbr"){switch(r=r??2,i){case"imperial":return Cti(t,e,r,s);case"metric":return bti(t,e,r,s);default:return uz(t,e,i,r,s)}}function WOi(t,e,i,r=2,s="abbr"){switch(i){case"imperial":return Mti(t,e,r,s);case"metric":return wti(t,e,r,s);default:return ZZe(t,e,i,r,s)}}function Iti(t,e,i,r=2,s="abbr"){switch(i){case"imperial":return Eti(t,e,r,s);case"metric":return xti(t,e,r,s);default:return uz(t,e,i,r,s)}}function ZOi(t,e,i,r=2,s="abbr"){switch(i){case"imperial":return Ati(t,e,r,s);case"metric":return Sti(t,e,r,s);default:return ZZe(t,e,i,r,s)}}function Dti(t,e,i,r=2,s="abbr"){switch(i){case"imperial":return Oti(t,e,r,s);case"metric":return Tti(t,e,r,s);default:return uz(t,e,i,r,s)}}function kti(t,e,i,r=2,s="abbr"){switch(i){case"imperial":return Pti(t,e,r,s);case"metric":return $ti(t,e,r,s);default:return uz(t,e,i,r,s)}}let l4=class extends be{constructor(e){super(e)}initialize(){this.addHandles(Ice(()=>this._load())),this._load()}destroy(){this._messagesTask.abort()}async when(){await this._messagesTask.promise}_load(){return this._messagesTask!=null&&this._messagesTask.abort(),this._messagesTask=sc(()=>Gce("esri/core/t9n/Units")),this._messagesTask.promise}get _messages(){return this._messagesTask.value}formatLength(e,i,r){return this._messages?Rti(this._messages,e,e.unit,i,r):""}formatVerticalLength(e,i,r){return this._messages?Iti(this._messages,e,e.unit,i,r):""}formatArea(e,i,r){return this._messages?Dti(this._messages,e,e.unit,i,r):""}formatVolume(e,i,r){return this._messages?kti(this._messages,e,e.unit,i,r):""}formatDecimal(e,i,r){return this._messages?uz(this._messages,e,e.unit,i,r):""}formatAngleDegrees(e,i,r,s,n){return pL(e,i,r,s,n)}};c([p()],l4.prototype,"_messagesTask",void 0),c([p()],l4.prototype,"_messages",null),l4=c([R("esri.applications.Components.QuantityFormatter")],l4);const Lti=l4;const Fti=["metric","imperial"],zti=["inches","feet","yards","miles","nautical-miles","us-feet","millimeters","centimeters","decimeters","meters","kilometers"],DAe=[...Fti,...zti];function SM(t,e=!0){return e?t==null?{state:"unavailable"}:{state:"available",value:t}:{state:"invalid"}}function Nti(t,e){switch(e.type){case"length":return t.formatLength(e);case"area":return t.formatArea(e);default:return""}}function Vti(t){return t==="imperial"||t==="metric"}const jti=Sl`:host,.hint,.error,.section,.actions,.item{display:flex;flex-direction:column;gap:var(--calcite-spacing-md);animation:esri-fade-in .25s ease-in-out}.error{color:var(--calcite-color-status-danger)}.error,.hint{overflow:hidden;p{margin:0;padding:0}}.item-disabled{color:var(--calcite-color-text-1);opacity:var(--calcite-opacity-light)}.item-value{font-weight:var(--calcite-font-weight-semibold)}.actions{justify-content:center}`,p0={error:"error",hint:"hint",actions:"actions",section:"section",item:"item",itemDisabled:"item-disabled",itemTitle:"item-title",itemValue:"item-value"};var jT;let Uti=(jT=class extends Wo{constructor(){super(...arguments),this._formatter=new Lti,this.items=[],this.state="disabled",this.unsupportedLabel=""}async load(){await this._formatter.when()}render(){switch(this.state){case"unsupported":return ni`<section class=${Et(p0.error)}><p>${this.unsupportedLabel}</p></section>`;case"measuring":return ni`<section class=${Et(p0.hint)}><p>${this.hintLabel}</p></section>`;case"ready":return ni`<div class=${Et(p0.actions)}><slot name=actions></slot></div>`;default:return ni`<slot name=settings></slot>${Bti({formatter:this._formatter,items:this.items})}<div class=${Et(p0.actions)}><slot name=actions></slot></div>`}}},jT.properties={hintLabel:1,items:0,state:1,unsupportedLabel:1},jT.styles=jti,jT);function Bti(t){return ni`<section class=${Et(p0.section)}>${t.items.map(e=>qti({formatter:t.formatter,measurement:e.measurement,title:e.title}))}</section>`}function qti(t){const e=t.measurement.state==="available"?Nti(t.formatter,t.measurement.value):null,i=t.measurement.state==="unavailable";return ni`<div class=${Et({[p0.item]:!0,[p0.itemDisabled]:i})}><span class=${Et(p0.itemTitle)}>${t.title}</span><span aria-live=polite class=${Et(p0.itemValue)}>${e??"-"}</span></div>`}p$("arcgis-measurement-content",Uti);const YZe="calciteInternalLabelClick",vW="calciteInternalLabelConnected",p9="calciteInternalLabelDisconnected",kAe="calcite-label",rP=new WeakMap,p5=new WeakMap,OL=new WeakMap,f9=new WeakMap,HS=new Set,Gti=t=>{const{id:e}=t,i=e&&fle(t,{selector:`${kAe}[for="${e}"]`});if(i)return i;const r=aP(t,kAe);return!r||Hti(r,t)?null:r};function Hti(t,e){let i;const r="custom-element-ancestor-check",s=a=>{a.stopImmediatePropagation();const o=a.composedPath();i=o.slice(o.indexOf(e),o.indexOf(t))};return t.addEventListener(r,s,{once:!0}),e.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),t.removeEventListener(r,s),i.filter(a=>a!==e&&a!==t).filter(a=>a.tagName?.includes("-")).length>0}function _W(t){if(!t)return;const e=Gti(t.el);if(p5.has(e)&&e===t.labelEl||!e&&HS.has(t))return;const i=Zti.bind(t);if(e){t.labelEl=e;const r=rP.get(e)||[];r.push(t),rP.set(e,r.sort(QZe)),p5.has(t.labelEl)||(p5.set(t.labelEl,LAe),t.labelEl.addEventListener(YZe,LAe)),HS.delete(t),document.removeEventListener(vW,OL.get(t)),f9.set(t,i),document.addEventListener(p9,i)}else HS.has(t)||(i(),document.removeEventListener(p9,f9.get(t)))}function JZe(t){if(!t||(HS.delete(t),document.removeEventListener(vW,OL.get(t)),document.removeEventListener(p9,f9.get(t)),OL.delete(t),f9.delete(t),!t.labelEl))return;const e=rP.get(t.labelEl);e.length===1&&(t.labelEl.removeEventListener(YZe,p5.get(t.labelEl)),p5.delete(t.labelEl)),rP.set(t.labelEl,e.filter(i=>i!==t).sort(QZe)),t.labelEl=null}function QZe(t,e){return yKe(t.el,e.el)?-1:1}function XZe(t){return t.label||t.labelEl?.textContent?.trim()||""}function LAe(t){const e=t.detail.sourceEvent.target,i=rP.get(this),r=i.find(a=>a.el===e);if(i.includes(r))return;const n=i[0];n.disabled||n.onLabelClick(t)}function Wti(){HS.has(this)&&_W(this)}function Zti(){HS.add(this);const t=OL.get(this)||Wti.bind(this);OL.set(this,t),document.addEventListener(vW,t)}async function Yti(t){if(await t.componentOnReady(),rP.has(t))return;const i=t.ownerDocument?.getElementById(t.for);i&&requestAnimationFrame(()=>{for(const r of HS)if(r.el===i){_W(r);break}})}const Jti={container:"container"},Qti=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex}:host([alignment=start]){text-align:start}:host([alignment=end]){text-align:end}:host([alignment=center]){text-align:center}:host([scale=s]) .container{gap:.25rem;font-size:var(--calcite-font-size--2);line-height:1rem;margin-block-end:var(--calcite-label-margin-bottom, .5rem)}:host([scale=m]) .container{gap:.5rem;font-size:var(--calcite-font-size--1);line-height:1rem;margin-block-end:var(--calcite-label-margin-bottom, .75rem)}:host([scale=l]) .container{gap:.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;margin-block-end:var(--calcite-label-margin-bottom, 1rem)}:host .container{margin-inline:0px;margin-block-start:0px;inline-size:100%;line-height:1.375;color:var(--calcite-color-text-1);color:var(--calcite-label-text-color, var(--calcite-color-text-1))}:host([layout=block]) .container,:host([layout=default]) .container{display:flex;flex-direction:column}:host([layout=inline]) .container,:host([layout=inline-space-between]) .container{display:flex;flex-direction:row;align-items:center;gap:.5rem}:host([layout=inline][scale=l]) .container{gap:.75rem}:host([layout=inline-space-between]) .container{justify-content:space-between}:host([disabled])>.container{opacity:var(--calcite-opacity-disabled)}:host([disabled]) ::slotted(*[disabled]),:host([disabled]) ::slotted(*[disabled] *){--tw-bg-opacity: 1}:host([disabled]) ::slotted(calcite-input-message:not([active])){--tw-bg-opacity: 0}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([hidden]){display:none}[hidden]{display:none}`,C9=class C9 extends Wo{constructor(){super(),this.alignment="start",this.layout="default",this.scale="m",this.calciteInternalLabelClick=$a({bubbles:!1,cancelable:!1}),this.listen("click",this.labelClickHandler)}connectedCallback(){super.connectedCallback(),document.dispatchEvent(new CustomEvent(vW))}willUpdate(e){e.has("for")&&Yti(this.el)}disconnectedCallback(){super.disconnectedCallback(),document.dispatchEvent(new CustomEvent(p9))}labelClickHandler(e){window.getSelection()?.type!=="Range"&&this.calciteInternalLabelClick.emit({sourceEvent:e})}render(){return ni`<div class=${Et(Jti.container)}><slot></slot></div>`}};C9.properties={alignment:[3,{},{reflect:!0}],for:[3,{},{reflect:!0}],layout:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}]},C9.styles=Qti;let m9=C9;ty("calcite-label",m9);const Ame=Object.freeze(Object.defineProperty({__proto__:null,Label:m9},Symbol.toStringTag,{value:"Module"}));const FAe={valid:"check-circle",invalid:"exclamation-mark-triangle",idle:"information"},Xti=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{box-sizing:border-box;display:flex;block-size:auto;inline-size:100%;align-items:center;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1);opacity:1;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;margin-block-start:var(--calcite-input-message-spacing, var(--calcite-input-message-spacing-value, var(--calcite-spacing-xxs)))}.calcite-input-message-icon{pointer-events:none;display:inline-flex;flex-shrink:0;transition-property:background-color,block-size,border-color,box-shadow,color,inset-block-end,inset-block-start,inset-inline-end,inset-inline-start,inset-size,opacity,outline-color,transform;transition-duration:var(--calcite-animation-timing);transition-timing-function:ease-in-out;margin-inline-end:var(--calcite-spacing-sm)}:host([status=invalid]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-status-danger)))}:host([status=valid]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-status-success)))}:host([status=idle]) .calcite-input-message-icon{color:var(--calcite-input-message-icon-color, var(--calcite-icon-color, var(--calcite-color-brand)))}:host([scale=s]){font-size:var(--calcite-font-size--3);line-height:.75rem}:host([scale=m]){font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=l]){font-size:var(--calcite-font-size--1);line-height:1rem}:host([hidden]){display:none}[hidden]{display:none}`,Kti={inputMessageIcon:"calcite-input-message-icon"},M9=class M9 extends Wo{constructor(){super(...arguments),this.iconFlipRtl=!1,this.scale="m",this.status="idle"}connectedCallback(){super.connectedCallback(),this.requestedIcon=Eee(FAe,this.icon,this.status)}willUpdate(e){(e.has("status")&&(this.hasUpdated||this.status!=="idle")||e.has("icon"))&&(this.requestedIcon=Eee(FAe,this.icon,this.status))}render(){const e=this.el.hidden;return dOe(this.el,"calcite-hydrated-hidden",e),ni`${this.renderIcon(this.requestedIcon)}<slot></slot>`}renderIcon(e){if(e)return ni`<calcite-icon class=${Et(Kti.inputMessageIcon)} .flipRtl=${this.iconFlipRtl} .icon=${e} scale=s></calcite-icon>`}};M9.properties={icon:[3,{converter:LL},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],status:[3,{},{reflect:!0}]},M9.styles=Xti;let g9=M9;ty("calcite-input-message",g9);const JOi=Object.freeze(Object.defineProperty({__proto__:null,InputMessage:g9},Symbol.toStringTag,{value:"Module"}));const eii=["calcite-input","calcite-input-number","calcite-input-text","calcite-text-area"];function tii(t){return`${t.split("-").map((r,s)=>s===0?r:`${r[0].toUpperCase()}${r.slice(1)}`).join("")}${eii.includes(t)?"Input":"Change"}`}const Xoe="hidden-form-input";function Ome(t){return"checked"in t}const Koe=new WeakMap,Pme=new WeakSet;function iii(t,e){if(aP(e.parentElement,"[form]"))return!0;const r="calciteInternalFormComponentRegister";let s=!1;return t.addEventListener(r,n=>{s=n.composedPath().some(a=>Pme.has(a)),n.stopPropagation()},{once:!0}),e.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0})),s}function rii(t,{status:e,message:i,icon:r}){"status"in t&&(t.status=e),"validationIcon"in t&&typeof t.validationIcon!="string"&&(t.validationIcon=r),"validationMessage"in t&&!t.validationMessage&&(t.validationMessage=i)}function KZe(t){return t.nodeName==="CALCITE-RADIO-BUTTON"?aP(t,"calcite-radio-button-group"):t}const sii=new CustomEvent("calciteInvalid",{bubbles:!0,composed:!0});function zAe(t){const e=t?.target,i=e?.validationMessage,r=KZe(e?.parentElement);if(!r)return;const s=r?.nodeName?.toLowerCase(),n=s?.split("-");if(n.length<2||n[0]!=="calcite")return;t?.preventDefault(),"validity"in r&&(r.validity=e?.validity),r.dispatchEvent(sii),rii(r,{message:i,icon:!0,status:"invalid"});const a=tii(s);r.addEventListener(a,()=>{"status"in r&&(r.status="idle"),"validationIcon"in r&&(r.validationIcon===""||r.validationIcon===!0)&&(r.validationIcon=!1),"validationMessage"in r&&r.validationMessage===i&&(r.validationMessage=""),"validity"in r&&(r.validity=e?.validity)},{once:!0})}function nii(t){const{formEl:e}=t;return e?(e.addEventListener("invalid",zAe,!0),e.requestSubmit(),e.removeEventListener("invalid",zAe,!0),requestAnimationFrame(()=>{const i=e.querySelectorAll("[status=invalid]");for(const r of i)if(r?.validationMessage){r?.setFocus();break}}),!0):!1}function aii(t){t.formEl?.reset()}function oii(t){const{el:e,value:i}=t,r=eYe(t);if(!r||iii(r,e))return;t.formEl=r,t.defaultValue=i,Ome(t)&&(t.defaultChecked=t.checked);const s=lii.bind(t);r.addEventListener("reset",s),Koe.set(t.el,s),Pme.add(e)}function eYe(t){const{el:e,form:i}=t;return i?fle(e,{id:i}):aP(e,"form")}function lii(){if("status"in this&&(this.status="idle"),"validationIcon"in this&&(this.validationIcon=!1),"validationMessage"in this&&(this.validationMessage=""),Ome(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue,this.onFormReset?.()}function cii(t){const{el:e,formEl:i}=t;if(!i)return;const r=Koe.get(e);i.removeEventListener("reset",r),Koe.delete(e),t.formEl=null,Pme.delete(e)}function uii(t,e){t.defaultValue=e}const hii="calciteInternalHiddenInputInput",tYe=t=>{t.target.dispatchEvent(new CustomEvent(hii,{bubbles:!0}))},NAe=t=>t.removeEventListener("input",tYe);function dii(t){const{el:e,formEl:i,name:r,value:s}=t,{ownerDocument:n}=e,a=e.querySelectorAll(`input[slot="${Xoe}"]`);if(!i||!r){a.forEach(f=>{NAe(f),f.remove()});return}const o=Array.isArray(s)?s:[s],l=[],u=new Set;a.forEach(f=>{const g=o.find(v=>v==f.value);g!=null?(u.add(g),VAe(t,f,g)):l.push(f)});let d;o.forEach(f=>{if(u.has(f))return;let g=l.pop();g||(g=n.createElement("input"),g.ariaHidden="true",g.slot=Xoe),d||(d=n.createDocumentFragment()),d.append(g),g.addEventListener("input",tYe),VAe(t,g,f)}),d&&e.append(d),l.forEach(f=>{NAe(f),f.remove()})}function VAe(t,e,i){const{defaultValue:r,disabled:s,form:n,name:a,required:o}=t;e.defaultValue=r,e.disabled=s,e.name=a,e.required=o,e.tabIndex=-1,n?e.setAttribute("form",n):e.removeAttribute("form"),Ome(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?i||"on":""):e.value=i||"",t.syncHiddenFormInput?.(e);const l=KZe(t.el);if(l&&"validity"in l)for(const u in{...e?.validity})l.validity[u]=e.validity[u]}const pii=({component:t})=>(dii(t),ni`<slot name=${Xoe}></slot>`);const db={alignmentCenter:"internal-label-alignment--center",alignmentEnd:"internal-label-alignment--end",container:"internal-label--container",requiredIndicator:"internal-label-required--indicator",spacingBottom:"internal-label-spacing--bottom",spacingInlineEnd:"internal-label-spacing-inline--end",spacingInlineStart:"internal-label-spacing-inline--start",text:"internal-label--text"},fii=({alignmentCenter:t,bottomSpacingDisabled:e,labelText:i,onClick:r,required:s,spacingInlineEnd:n,spacingInlineStart:a,tooltipText:o})=>ni`<div class=${Et({[db.alignmentCenter]:t,[db.alignmentEnd]:!t,[db.container]:!0,[db.spacingBottom]:!e,[db.spacingInlineEnd]:n,[db.spacingInlineStart]:a})} @click=${r}><div class=${Et(db.text)}>${i}${s&&ni`<span aria-hidden=true class=${Et(db.requiredIndicator)} title=${o??sr}>*</span>`||""}</div><slot name=label-content></slot></div>`;const mii={validationContainer:"validation-container"},gii=()=>{},yii=({scale:t,status:e,id:i,icon:r,message:s,ref:n})=>ni`<div class=${Et(mii.validationContainer)} ${_p(n||gii)}><calcite-input-message aria-live=polite .icon=${r} id=${i??sr} .scale=${t} .status=${e}>${s}</calcite-input-message></div>`;const vii=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{--calcite-icon-size: 1rem;--calcite-spacing-eighth: .125rem;--calcite-spacing-quarter: .25rem;--calcite-spacing-half: .5rem;--calcite-spacing-three-quarters: .75rem;--calcite-spacing: 1rem;--calcite-spacing-plus-quarter: 1.25rem;--calcite-spacing-plus-half: 1.5rem;--calcite-spacing-double: 2rem;--calcite-menu-min-width: 10rem;--calcite-header-min-height: 3rem;--calcite-footer-min-height: 3rem}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;flex-direction:column;font-size:var(--calcite-select-font-size);font-weight:var(--calcite-internal-select-font-weight, var(--calcite-font-weight-regular))}.wrapper{position:relative;display:flex;align-items:stretch;inline-size:var(--select-width);block-size:var(--calcite-internal-select-block-size, 32px)}.wrapper:focus-within .icon,.wrapper:active .icon,.wrapper:hover .icon{color:var(--calcite-select-icon-color-hover, var(--calcite-color-text-1))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([scale=s]){--calcite-internal-select-font-size: var(--calcite-font-size--2);--calcite-select-spacing-inline: .5rem 2rem;--calcite-internal-select-icon-container-padding-inline: var(--calcite-spacing-sm);--calcite-internal-select-block-size: 24px}:host([scale=m]){--calcite-internal-select-font-size: var(--calcite-font-size--1);--calcite-select-spacing-inline: .75rem 2.5rem;--calcite-internal-select-icon-container-padding-inline: var(--calcite-spacing-md)}:host([scale=l]){--calcite-internal-select-font-size: var(--calcite-font-size-0);--calcite-select-spacing-inline: 1rem 3rem;--calcite-internal-select-icon-container-padding-inline: var(--calcite-spacing-lg);--calcite-internal-select-block-size: 44px}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}.select{margin:0;box-sizing:border-box;inline-size:100%;cursor:pointer;appearance:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border-style:solid;font-family:inherit;outline-color:transparent;font-weight:inherit;font-size:var(--calcite-select-font-size, var(--calcite-internal-select-font-size));color:var(--calcite-select-text-color, var(--calcite-color-text-2));border-color:var(--calcite-select-border-color, var(--calcite-color-border-input));border-width:var(--calcite-select-internal-border-width, var(--calcite-border-width-sm));padding-inline:var(--calcite-select-spacing-inline);padding-block:var(--calcite-internal-select-spacing-block);border-inline-end-width:0;line-height:var(--calcite-internal-select-line-height, normal);background-color:var(--calcite-select-background-color, var(--calcite-color-foreground-1));border-radius:var(--calcite-select-corner-radius, var(--calcite-corner-radius-none));box-shadow:var(--calcite-select-shadow, var(--calcite-shadow-small))}.select:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(calc(-1 * var(--calcite-spacing-base)) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}select:disabled{border-color:var(--calcite-color-border-input);--tw-bg-opacity: 1}.icon-container{pointer-events:none;position:absolute;inset-block:0px;display:flex;align-items:center;border-width:0px;border-style:solid;border-color:var(--calcite-color-border-input);background-color:transparent;color:var(--calcite-color-text-2);inset-inline-end:0px;border-start-start-radius:var(--calcite-select-corner-radius, var(--calcite-corner-radius-none));border-start-end-radius:var(--calcite-select-corner-radius, var(--calcite-corner-radius-none));border-end-start-radius:var(--calcite-select-corner-radius, var(--calcite-corner-radius-none));border-end-end-radius:var(--calcite-select-corner-radius, var(--calcite-corner-radius-none));border-color:var(--calcite-select-border-color, var(--calcite-color-border-input));border-inline-width:0 var(--calcite-select-internal-icon-border-inline-end-width, var(--calcite-border-width-sm));padding-inline:var(--calcite-internal-select-icon-container-padding-inline)}.icon-container .icon{color:var(--calcite-select-icon-color, var(--calcite-color-text-3))}:host([status=invalid]) select,:host([status=invalid]) .icon-container{border-color:var(--calcite-color-status-danger)}:host([status=invalid]) select:focus,:host([status=invalid]) .icon-container:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-status-danger);outline-offset:calc(calc(-1 * var(--calcite-spacing-base)) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.select:focus~.icon-container{border-color:transparent}.internal-label-alignment--center{align-items:center}.internal-label-alignment--end{align-items:end}.internal-label--container{display:flex;justify-content:space-between;color:var(--calcite-color-text-1)}.internal-label-required--indicator{font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-status-danger);padding-inline:var(--calcite-spacing-base)}.internal-label-required--indicator:hover{cursor:help}.internal-label--text{line-height:1}:host([scale=s]) .internal-label-spacing--bottom{margin-block-end:var(--calcite-spacing-xxs)}:host([scale=s]) .internal-label-spacing-inline--end{margin-inline-end:var(--calcite-spacing-sm)}:host([scale=s]) .internal-label-spacing-inline--start{margin-inline-start:var(--calcite-spacing-sm)}:host([scale=s]) .internal-label--text{font-size:var(--calcite-font-size--2)}:host([scale=m]) .internal-label-spacing--bottom{margin-block-end:var(--calcite-spacing-sm)}:host([scale=m]) .internal-label-spacing-inline--end{margin-inline-end:var(--calcite-spacing-sm)}:host([scale=m]) .internal-label-spacing-inline--start{margin-inline-start:var(--calcite-spacing-sm)}:host([scale=m]) .internal-label--text{font-size:var(--calcite-font-size--1)}:host([scale=l]) .internal-label-spacing--bottom{margin-block-end:var(--calcite-spacing-sm)}:host([scale=l]) .internal-label-spacing-inline--end{margin-inline-end:var(--calcite-spacing-md)}:host([scale=l]) .internal-label-spacing-inline--start{margin-inline-start:var(--calcite-spacing-md)}:host([scale=l]) .internal-label--text{font-size:var(--calcite-font-size-0)}.validation-container{display:flex;flex-direction:column;align-items:flex-start;align-self:stretch}:host([scale=m]) .validation-container,:host([scale=l]) .validation-container{padding-block-start:.5rem}:host([scale=s]) .validation-container{padding-block-start:.25rem}::slotted(input[slot=hidden-form-input]){margin:0!important;opacity:0!important;outline:none!important;padding:0!important;position:absolute!important;inset:0!important;transform:none!important;-webkit-appearance:none!important;z-index:-1!important}:host([hidden]){display:none}[hidden]{display:none}`,I6={icon:"icon",iconContainer:"icon-container",select:"select",wrapper:"wrapper"},jAe={validationMessage:"selectValidationMessage"};function D6(t){return t.tagName==="CALCITE-OPTION"}function _ii(t){return t.tagName==="CALCITE-OPTION-GROUP"}const E9=class E9 extends Wo{constructor(){super(),this.componentToNativeEl=new Map,this.mutationObserver=_5("mutation",()=>this.populateInternalSelect()),this.messages=FL(),this.focusSetter=zL()(this),this.disabled=!1,this.required=!1,this.scale="m",this.status="idle",this.validity={valid:!1,badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1},this.value=null,this.width="auto",this.calciteSelectChange=$a({cancelable:!1}),this.listen("calciteInternalOptionChange",this.handleOptionOrGroupChange),this.listen("calciteInternalOptionGroupChange",this.handleOptionOrGroupChange)}async setFocus(e){return this.focusSetter(()=>this.selectEl,e)}connectedCallback(){super.connectedCallback(),this.mutationObserver?.observe(this.el,{subtree:!0,childList:!0}),_W(this),oii(this)}willUpdate(e){e.has("value")&&(this.hasUpdated||this.value!==null)&&this.updateItemsFromValue(this.value),e.has("selectedOption")&&(this.value=this.selectedOption?.value)}updated(){V9(this)}loaded(){typeof this.value=="string"&&this.updateItemsFromValue(this.value),this.populateInternalSelect();const e=this.selectEl?.selectedOptions[0];this.selectFromNativeOption(e),uii(this,this.selectedOption?.value??"")}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),JZe(this),cii(this)}handleInternalSelectChange(){const e=this.selectEl.selectedOptions[0];this.selectFromNativeOption(e),requestAnimationFrame(()=>this.emitChangeEvent())}handleOptionOrGroupChange(e){e.stopPropagation();const i=e.target,r=this.componentToNativeEl.get(i);r&&(this.updateNativeElement(i,r),D6(i)&&i.selected&&(this.deselectAllExcept(i),this.selectedOption=i))}onLabelClick(){this.setFocus()}updateItemsFromValue(e){this.el.querySelectorAll("calcite-option").forEach(i=>i.selected=i.value===e)}updateNativeElement(e,i){if(i.disabled=e.disabled,i.label=e.label,D6(e)){const r=i;r.selected=e.selected,r.value=e.value,r.innerText=e.label}}populateInternalSelect(){const e=Array.from(this.el.children).filter(i=>i.tagName==="CALCITE-OPTION"||i.tagName==="CALCITE-OPTION-GROUP");this.clearInternalSelect(),e.forEach(i=>this.selectEl?.append(this.toNativeElement(i)))}clearInternalSelect(){this.componentToNativeEl.forEach(e=>e.remove()),this.componentToNativeEl.clear()}storeSelectRef(e){e&&(this.selectEl=e)}selectFromNativeOption(e){if(!e)return;let i;this.componentToNativeEl.forEach((r,s)=>{D6(s)&&r===e&&(s.selected=!0,i=s,this.deselectAllExcept(s))}),i&&(this.selectedOption=i)}toNativeElement(e){if(D6(e)){const i=document.createElement("option");return this.updateNativeElement(e,i),this.componentToNativeEl.set(e,i),i}if(_ii(e)){const i=document.createElement("optgroup");return this.updateNativeElement(e,i),Array.from(e.children).forEach(r=>{const s=this.toNativeElement(r);i.append(s),this.componentToNativeEl.set(e,s)}),this.componentToNativeEl.set(e,i),i}throw new Error("unsupported element child provided")}deselectAllExcept(e){this.el.querySelectorAll("calcite-option").forEach(i=>{i!==e&&(i.selected=!1)})}emitChangeEvent(){this.calciteSelectChange.emit()}renderChevron(){return ni`<div class=${Et(I6.iconContainer)}><calcite-icon class=${Et(I6.icon)} icon=chevron-down .scale=${Aw(this.scale)}></calcite-icon></div>`}render(){const{disabled:e}=this;return j9({disabled:e,children:ni`${this.labelText&&fii({labelText:this.labelText,onClick:this.onLabelClick,required:this.required,tooltipText:this.messages.required})||""}<div class=${Et(I6.wrapper)}><select aria-errormessage=${jAe.validationMessage} .ariaInvalid=${this.status==="invalid"} .ariaLabel=${XZe(this)} class=${Et(I6.select)} .disabled=${e} @change=${this.handleInternalSelectChange} .required=${this.required} ${_p(this.storeSelectRef)}><slot></slot></select>${this.renderChevron()}${pii({component:this})}</div>${this.validationMessage&&this.status==="invalid"?yii({icon:this.validationIcon,id:jAe.validationMessage,message:this.validationMessage,scale:this.scale,status:this.status}):null}`})}};E9.properties={disabled:[7,{},{reflect:!0,type:Boolean}],form:[3,{},{reflect:!0}],label:1,labelText:1,name:[3,{},{reflect:!0}],required:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],selectedOption:[0,{},{attribute:!1}],status:[3,{},{reflect:!0}],validationIcon:[3,{converter:LL},{reflect:!0}],validationMessage:1,validity:[0,{},{attribute:!1}],value:1,width:[3,{},{reflect:!0}],messageOverrides:[0,{},{attribute:!1}]},E9.styles=vii;let y9=E9;ty("calcite-select",y9);const bii=Object.freeze(Object.defineProperty({__proto__:null,Select:y9},Symbol.toStringTag,{value:"Module"}));const wii=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{display:block}:host([hidden]){display:none}[hidden]{display:none}`,A9=class A9 extends Wo{constructor(){super(...arguments),this.mutationObserver=_5("mutation",()=>{this.ensureTextContentDependentProps(),this.calciteInternalOptionChange.emit()}),this.disabled=!1,this.calciteInternalOptionChange=$a({cancelable:!1})}connectedCallback(){super.connectedCallback(),this.ensureTextContentDependentProps(),this.mutationObserver?.observe(this.el,{attributeFilter:["label","value"],characterData:!0,childList:!0,subtree:!0})}willUpdate(e){e.has("disabled")&&(this.hasUpdated||this.disabled!==!1)&&this.handlePropChange(this.disabled,e.get("disabled"),"disabled"),e.has("label")&&this.handlePropChange(this.label,e.get("label"),"label"),e.has("selected")&&this.handlePropChange(this.selected,e.get("selected"),"selected"),e.has("value")&&this.handlePropChange(this.value,e.get("value"),"value")}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect()}handlePropChange(e,i,r){(r==="label"||r==="value")&&this.ensureTextContentDependentProps(),this.calciteInternalOptionChange.emit()}ensureTextContentDependentProps(){const{el:{textContent:e},internallySetLabel:i,internallySetValue:r,label:s,value:n}=this;(!s||s===i)&&(this.label=e,this.internallySetLabel=e),(n==null||n===r)&&(this.value=e,this.internallySetValue=e)}render(){return ni`<slot>${this.label}</slot>`}};A9.properties={disabled:[7,{},{reflect:!0,type:Boolean}],label:1,selected:[7,{},{reflect:!0,type:Boolean}],value:1},A9.styles=wii;let v9=A9;ty("calcite-option",v9);const xii=Object.freeze(Object.defineProperty({__proto__:null,Option:v9},Symbol.toStringTag,{value:"Module"}));const UAe=(t,e,i)=>{const r=new Map;for(let s=e;s<=i;s++)r.set(t[s],s);return r},Sii=DL(class extends kL{constructor(t){if(super(t),t.type!==z9.CHILD)throw Error("repeat() can only be used in text expressions")}dt(t,e,i){let r;i===void 0?i=e:e!==void 0&&(r=e);const s=[],n=[];let a=0;for(const o of t)s[a]=r?r(o,a):a,n[a]=i(o,a),a++;return{values:n,keys:s}}render(t,e,i){return this.dt(t,e,i).values}update(t,[e,i,r]){const s=wXe(t),{values:n,keys:a}=this.dt(e,i,r);if(!Array.isArray(s))return this.ut=a,n;const o=this.ut??=[],l=[];let u,d,f=0,g=s.length-1,v=0,_=n.length-1;for(;f<=g&&v<=_;)if(s[f]===null)f++;else if(s[g]===null)g--;else if(o[f]===a[v])l[v]=ux(s[f],n[v]),f++,v++;else if(o[g]===a[_])l[_]=ux(s[g],n[_]),g--,_--;else if(o[f]===a[_])l[_]=ux(s[f],n[_]),NR(t,l[_+1],s[f]),f++,_--;else if(o[g]===a[v])l[v]=ux(s[g],n[v]),NR(t,s[f],s[g]),g--,v++;else if(u===void 0&&(u=UAe(a,v,_),d=UAe(o,f,g)),u.has(o[f]))if(u.has(o[g])){const x=d.get(a[v]),S=x!==void 0?s[x]:null;if(S===null){const T=NR(t,s[f]);ux(T,n[v]),l[v]=T}else l[v]=ux(S,n[v]),NR(t,s[f],S),s[x]=null;v++}else IY(s[g]),g--;else IY(s[f]),f++;for(;v<=_;){const x=NR(t,l[_+1]);ux(x,n[v]),l[v++]=x}for(;f<=g;){const x=s[f++];x!==null&&IY(x)}return this.ut=a,oOe(t,l),M0}});const iYe=VOe(utt);const Tii=Sl`.arcgis-unit-select{width:100%}.arcgis-unit-select__label{--calcite-label-margin-bottom: 0;width:100%}`,$ii="arcgis-unit-select",Cii={label:`${$ii}__label`};var UT;let Mii=(UT=class extends Wo{constructor(){super(...arguments),this.messages=iYe({}),this.options=[],this.arcgisUnitSelectChange=$a()}async destroy(){await this.manager.destroy()}render(){const{messages:e,options:i=[],selectLabel:r,value:s,arcgisUnitSelectChange:n}=this;return ni`<calcite-label class=${Et(Cii.label)}>${r}<calcite-select .label=${r} @calciteSelectChange=${a=>{n.emit(a.target.value)}}>${Sii(i,a=>a,a=>ni`<calcite-option .selected=${a===s} .value=${a}>${Vti(a)?e.systems?.[a]:e.units?.[a]?.pluralCapitalized}</calcite-option>`)}</calcite-select></calcite-label>`}},UT.properties={options:[1,{type:Array}],selectLabel:1,value:0,messageOverrides:0,label:1},UT.styles=Tii,UT);p$("arcgis-unit-select",Mii);const TM={percentage:"percentage",progressRing:"ring--progress",ring:"ring",rings:"rings",text:"text",trackRing:"ring--track"},Eii=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{position:relative;margin-inline:auto;display:flex;align-items:center;justify-content:center;opacity:1;flex-direction:column;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke-width:var(--calcite-internal-stroke-width);fill:none;transform:scale(1);padding-block:var(--calcite-loader-spacing, 4rem)}:host([scale=s]){--calcite-internal-stroke-width: 3;--calcite-internal-text-offset: var(--calcite-spacing-xxs);--calcite-internal-loader-font-size: var(--calcite-font-size--3);--calcite-internal-loader-size: 2rem;--calcite-internal-loader-size-inline: .75rem;--calcite-internal-loader-value-line-height: .625rem}:host([scale=m]){--calcite-internal-stroke-width: 6;--calcite-internal-text-offset: var(--calcite-spacing-sm);--calcite-internal-loader-font-size: var(--calcite-font-size-0);--calcite-internal-loader-size: 4rem;--calcite-internal-loader-size-inline: 1rem;--calcite-internal-loader-value-line-height: 1.375rem}:host([scale=l]){--calcite-internal-stroke-width: 8;--calcite-internal-text-offset: var(--calcite-spacing-md);--calcite-internal-loader-font-size: var(--calcite-font-size-2);--calcite-internal-loader-size: 6rem;--calcite-internal-loader-size-inline: 1.5rem;--calcite-internal-loader-value-line-height: 1.71875rem}.text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;margin-block-start:var(--calcite-loader-text-spacing, var(--calcite-internal-text-offset));font-weight:var(--calcite-loader-text-weight, var(--calcite-font-weight-normal));color:var(--calcite-loader-text-color, var(--calcite-color-text-1))}.percentage{display:block;text-align:center;font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));line-height:var(--calcite-internal-loader-value-line-height);align-self:center;color:var(--calcite-loader-text-color, var(--calcite-color-text-1))}.rings{position:relative;display:flex;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));block-size:var(--calcite-loader-size, var(--calcite-internal-loader-size))}.ring{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));block-size:var(--calcite-loader-size, var(--calcite-internal-loader-size))}.ring--track{stroke:var(--calcite-loader-track-color, var(--calcite-color-transparent-press))}.ring--progress{stroke:var(--calcite-loader-progress-color, var(--calcite-color-brand));transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([type=indeterminate]) .ring--progress{animation:loader-clockwise calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) linear infinite}:host([inline]){--calcite-internal-stroke-width: 2;position:relative;margin:0;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));min-block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));vertical-align:calc(var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline))) * -1 * .2)}:host([inline]) .rings{inset-block-start:0px;margin:0;inset-inline-start:0;inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)))}:host([inline]) .ring{inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)))}:host([inline]) .ring--progress{stroke:var(--calcite-loader-progress-color-inline, currentColor)}:host([complete]){opacity:0;transform:scale(.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1s,transform var(--calcite-internal-animation-timing-medium) linear 1s}:host([complete]) .rings{opacity:0;transform:scale(.75);transform-origin:center;transition:opacity calc(.18s * var(--calcite-internal-duration-factor)) linear .8s,transform calc(.18s * var(--calcite-internal-duration-factor)) linear .8s}:host([complete]) .percentage{color:var(--calcite-color-brand);transform:scale(1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear,transform var(--calcite-internal-animation-timing-medium) linear}@keyframes loader-clockwise{0%{transform:rotate(0)}to{transform:rotate(360deg)}}:host([hidden]){display:none}[hidden]{display:none}`,O9=class O9 extends Wo{constructor(){super(...arguments),this.messages=FL({name:null}),this.complete=!1,this.inline=!1,this.scale="m",this.text="",this.type="indeterminate",this.value=0}connectedCallback(){super.connectedCallback(),this.updateFormatter()}load(){requestAnimationFrame(()=>this.valueChangeHandler())}willUpdate(e){e.has("value")&&(this.hasUpdated||this.value!==0)&&this.valueChangeHandler(),(e.has("type")&&(this.hasUpdated||this.type!=="indeterminate")||e.has("messages"))&&this.updateFormatter()}valueChangeHandler(){this.complete=this.type.startsWith("determinate")&&this.value===100}formatValue(){return this.type!=="determinate-value"?`${this.value}`:this.formatter.format(this.value/100)}getSize(e){return{s:32,m:64,l:96}[e]}getInlineSize(e){return{s:12,m:16,l:24}[e]}updateFormatter(){this.type!=="determinate-value"||this.formatter?.resolvedOptions().locale===this.messages._lang||(this.formatter=new Intl.NumberFormat(this.messages._lang,{style:"percent"}))}render(){const{el:e,inline:i,label:r,text:s,type:n,value:a}=this,o=e.id||VXe(),l=n!=="indeterminate",u=Math.floor(a);return this.el.ariaLabel=r,this.el.ariaValueMax=l?"100":void 0,this.el.ariaValueMin=l?"0":void 0,this.el.ariaValueNow=l?u.toString():void 0,dOe(this.el,"id",o),this.el.role="progressbar",ni`<div class=${Et(TM.rings)}>${this.renderRing("track")}${this.renderRing("progress")}${!i&&l&&ni`<div class=${Et(TM.percentage)}>${this.formatValue()}</div>`||""}</div>${!i&&s&&ni`<div class=${Et(TM.text)}>${s}</div>`||""}`}renderRing(e){const{inline:i,scale:r,value:s}=this,n=i?this.getInlineSize(r):this.getSize(r),o=n*.45;let l;if(e==="progress"){const u=2*o*Math.PI,d=(this.type.startsWith("determinate")?s:24)/100*u,f=u-d;l={"stroke-dasharray":`${d} ${f}`}}return ni`<svg aria-hidden=true class=${Et({[TM.ring]:!0,[TM.trackRing]:e==="track",[TM.progressRing]:e==="progress"})} style=${AXe(l)} viewBox=${`0 0 ${n} ${n}`}>${xee`<circle cx=${n/2} cy=${n/2} r=${o??sr} />`}</svg>`}};O9.properties={complete:[7,{},{reflect:!0,type:Boolean}],inline:[7,{},{reflect:!0,type:Boolean}],label:1,scale:[3,{},{reflect:!0}],text:1,type:[3,{},{reflect:!0}],value:[9,{},{type:Number}]},O9.styles=Eii;let _9=O9;ty("calcite-loader",_9);const Aii=Object.freeze(Object.defineProperty({__proto__:null,Loader:_9},Symbol.toStringTag,{value:"Module"}));const mh={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},Oii=Sl`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;inline-size:auto;vertical-align:middle;border-radius:var(--calcite-button-corner-radius, var(--calcite-internal-button-corner-radius, 0))}:host a,:host button{--calcite-internal-button-content-margin: .5rem;--calcite-internal-button-padding-x: 7px;--calcite-internal-button-padding-y: 3px;position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;appearance:none;align-items:center;justify-content:center;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;outline-color:transparent;box-shadow:var(--calcite-button-shadow, var(--calcite-shadow-none));background-color:var(--calcite-button-background-color, var(--calcite-internal-button-background-color, var(--calcite-color-transparent)));border-block-start-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-block-start-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-block-end-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-block-end-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-inline-start-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-inline-start-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-inline-end-color:var(--calcite-button-border-color, var(--calcite-internal-button-border-inline-end-color, var(--calcite-internal-button-border-color, var(--calcite-color-transparent))));border-style:solid;border-width:var(--calcite-border-width-sm);border-radius:var(--calcite-button-corner-radius, var(--calcite-internal-button-corner-radius, 0));color:var(--calcite-button-text-color, var(--calcite-internal-button-text-color, currentColor));padding-block:var(--calcite-internal-button-padding-y);padding-inline:var(--calcite-internal-button-padding-x);transition:color var(--calcite-animation-timing) ease-in-out,background-color var(--calcite-animation-timing) ease-in-out,box-shadow var(--calcite-animation-timing) ease-in-out,outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host a:hover,:host button:hover{text-decoration-line:none}:host a:focus,:host button:focus{outline:var(--calcite-border-width-md) solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline:var(--calcite-border-width-md) solid var(--calcite-internal-color-focus);outline-offset:calc(var(--calcite-spacing-base) * calc(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host a span,:host button span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:host a calcite-loader,:host button calcite-loader{color:var(--calcite-button-loader-color, var(--calcite-internal-button-loader-color, var(--calcite-button-text-color, var(--calcite-internal-button-text-color))))}:host([round]){--calcite-internal-button-corner-radius: 50px}.content{margin-inline:var(--calcite-internal-button-content-margin)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-internal-button-content-margin: .75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-internal-button-content-margin: 1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-internal-button-content-margin)}.icon--start,.icon--end{color:var(--calcite-button-icon-color, var(--calcite-icon-color, var(--calcite-ui-icon-color)))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(.5)}to{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}to{inline-size:0;opacity:0;transform:scale(.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-internal-button-content-margin)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{--calcite-internal-button-border-color: var(--calcite-color-transparent);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([kind=brand]) button,:host([kind=brand]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{--calcite-internal-button-background-color: var(--calcite-color-brand-press)}:host([kind=danger]) button,:host([kind=danger]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-status-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{--calcite-internal-button-background-color: var(--calcite-color-status-danger-press)}:host([kind=neutral]) button,:host([kind=neutral]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-background-color: var(--calcite-color-foreground-3);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{--calcite-internal-button-background-color: var(--calcite-color-foreground-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-inverse);--calcite-internal-button-background-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{--calcite-internal-button-background-color: var(--calcite-color-inverse-press)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{--calcite-internal-button-background-color: var(--calcite-color-foreground-1);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([appearance=outline-fill]) button:hover,:host([appearance=outline-fill]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-foreground-2)}:host([appearance=outline-fill]) button:active,:host([appearance=outline-fill]) a:active{--calcite-internal-button-background-color: var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-brand-hover);--calcite-internal-button-text-color: var(--calcite-color-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{--calcite-internal-button-border-color: var(--calcite-color-brand-press);--calcite-internal-button-text-color: var(--calcite-color-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{--calcite-internal-button-border-color: var(--calcite-color-status-danger-press);--calcite-internal-button-text-color: var(--calcite-color-status-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{--calcite-internal-button-border-color: var(--calcite-color-border-1);--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-border-input)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{--calcite-internal-button-border-color: var(--calcite-color-text-3)}:host([appearance=solid][kind=neutral]) button:hover,:host([appearance=solid][kind=neutral]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-border-3)}:host([appearance=solid][kind=neutral]) button:active,:host([appearance=solid][kind=neutral]) a:active{--calcite-internal-button-background-color: var(--calcite-color-border-2)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{--calcite-internal-button-border-color: var(--calcite-color-inverse-press)}:host([appearance=outline]) button,:host([appearance=outline]) a{--calcite-internal-button-background-color: var(--calcite-color-transparent);border-style:solid;border-width:var(--calcite-button-border-size, 1px)}:host([appearance=outline]) button:hover,:host([appearance=outline]) a:hover{--calcite-internal-button-background-color: var(--calcite-color-transparent-hover)}:host([appearance=outline]) button:active,:host([appearance=outline]) a:active{--calcite-internal-button-background-color: var(--calcite-color-transparent-press)}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-brand-hover);--calcite-internal-button-text-color: var(--calcite-color-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-brand);--calcite-internal-button-text-color: var(--calcite-color-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{--calcite-internal-button-border-color: var(--calcite-color-brand-press);--calcite-internal-button-text-color: var(--calcite-color-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-status-danger-hover);--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-status-danger);--calcite-internal-button-text-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{--calcite-internal-button-border-color: var(--calcite-color-status-danger-press);--calcite-internal-button-text-color: var(--calcite-color-status-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-border-1);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-border-input)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{--calcite-internal-button-border-color: var(--calcite-color-text-3)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-border-color: var(--calcite-color-inverse);--calcite-internal-button-loader-color: var(--calcite-color-text-1)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{--calcite-internal-button-border-color: var(--calcite-color-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{--calcite-internal-button-border-color: var(--calcite-color-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{--calcite-internal-button-border-color: var(--calcite-color-inverse-press)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button,:host([appearance=outline-fill][split-child=primary]) a,:host([appearance=outline][split-child=primary]) a{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button,:host([appearance=outline-fill][split-child=secondary]) a,:host([appearance=outline][split-child=secondary]) a{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]) button,:host([appearance=transparent]) a{--calcite-internal-button-background-color: var(--calcite-color-transparent)}:host([appearance=transparent]) button:hover,:host([appearance=transparent]) button:focus,:host([appearance=transparent]) a:hover,:host([appearance=transparent]) a:focus{--calcite-internal-button-background-color: var(--calcite-color-transparent-hover)}:host([appearance=transparent]) button:active,:host([appearance=transparent]) a:active{--calcite-internal-button-background-color: var(--calcite-color-transparent-press)}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:var(--calcite-color-transparent)}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:hover{background-color:var(--calcite-color-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-color-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{--calcite-internal-button-text-color: var(--calcite-color-brand);--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{--calcite-internal-button-text-color: var(--calcite-color-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{--calcite-internal-button-text-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{--calcite-internal-button-text-color: var(--calcite-color-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{--calcite-internal-button-text-color: var(--calcite-color-status-danger);--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{--calcite-internal-button-text-color: var(--calcite-color-status-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{--calcite-internal-button-text-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{--calcite-internal-button-text-color: var(--calcite-color-status-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{--calcite-internal-button-loader-color: var(--calcite-color-status-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{--calcite-internal-button-text-color: var(--calcite-color-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{--calcite-internal-button-text-color: var(--calcite-color-text-3)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{--calcite-internal-button-text-color: var(--calcite-color-text-1);--calcite-internal-button-padding-y: 0}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button:hover,:host([appearance=transparent][kind=inverse]) a:hover{background-color:var(--calcite-color-transparent-inverse-hover)}:host([appearance=transparent][kind=inverse]) button:active,:host([appearance=transparent][kind=inverse]) a:active{background-color:var(--calcite-color-transparent-inverse-press)}:host([appearance=transparent][kind=inverse]) button calcite-loader,:host([appearance=transparent][kind=inverse]) a calcite-loader{--calcite-internal-button-text-color: var(--calcite-color-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-internal-button-padding-x: .5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-internal-button-padding-y: 3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-internal-button-padding-x: 11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-internal-button-padding-y: 7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-internal-button-padding-x: .75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-internal-button-padding-x: 15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-internal-button-padding-x: 1rem;--calcite-internal-button-padding-y: 11px}:host([scale=l]) .button-padding--shrunk{--calcite-internal-button-padding-y: 9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-internal-button-padding-x: .125rem;--calcite-internal-button-padding-y: 9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host(:is([scale=s],[scale=m],[scale=l])[width=full]) a:not(.content--slotted),:host(:is([scale=s],[scale=m],[scale=l])[width=full]) button:not(.content--slotted){inline-size:var(--calcite-container-size-content-fluid)}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-y: .625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-internal-button-padding-x: 43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-internal-button-padding-x: 2.75rem}:host([hidden]){display:none}[hidden]{display:none}`,P9=class P9 extends Wo{constructor(){super(...arguments),this.attributeWatch=YKe(["aria-expanded"],this.handleGlobalAttributesChanged),this.contentRef=Jw(),this.mutationObserver=_5("mutation",()=>this.updateHasContent()),this.resizeObserver=_5("resize",()=>this.setTooltipText()),this.focusSetter=zL()(this),this.messages=FL(),this.hasContent=!1,this.alignment="center",this.appearance="solid",this.disabled=!1,this.download=!1,this.kind="brand",this.loading=!1,this.round=!1,this.scale="m",this.splitChild=!1,this.type="button",this.width="auto"}async setFocus(e){return this.focusSetter(()=>this.childEl,e)}connectedCallback(){super.connectedCallback(),this.setupTextContentObserver(),_W(this),this.formEl=eYe(this)}async load(){this.updateHasContent()}updated(){V9(this)}loaded(){this.setTooltipText()}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),JZe(this),this.resizeObserver?.disconnect(),this.formEl=null}handleGlobalAttributesChanged(){this.requestUpdate()}updateHasContent(){this.hasContent=dKe(this.el)}setupTextContentObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}handleClick(){const{type:e}=this;this.href||(e==="submit"?nii(this):e==="reset"&&aii(this))}setTooltipText(){const{contentRef:{value:e}}=this;e&&(this.tooltipText=e.offsetWidth<e.scrollWidth&&this.el.innerText||null)}setChildEl(e){wKe(this.resizeObserver,this.childEl,e),this.childEl=e}render(){const e=this.href?"a":"button",i=this.href?H8`a`:H8`button`,r=this.loading?ni`<div class=${Et(mh.buttonLoader)}><calcite-loader class=${Et(this.loading?mh.loadingIn:mh.loadingOut)} inline .label=${this.messages.loading} .scale=${this.scale==="l"?"m":"s"}></calcite-loader></div>`:null,s=!this.iconStart&&!this.iconEnd,n=ni`<calcite-icon class=${Et({[mh.icon]:!0,[mh.iconStart]:!0})} .flipRtl=${this.iconFlipRtl==="start"||this.iconFlipRtl==="both"} .icon=${this.iconStart} .scale=${Aw(this.scale)}></calcite-icon>`,a=ni`<calcite-icon class=${Et({[mh.icon]:!0,[mh.iconEnd]:!0})} .flipRtl=${this.iconFlipRtl==="end"||this.iconFlipRtl==="both"} .icon=${this.iconEnd} .scale=${Aw(this.scale)}></calcite-icon>`,o=ni`<span class=${Et(mh.content)} ${_p(this.contentRef)}><slot></slot></span>`;return j9({disabled:this.disabled,children:WOe`<${i} .ariaBusy=${this.loading} .ariaExpanded=${this.el.ariaExpanded?this.el.ariaExpanded:null} .ariaLabel=${this.loading?this.messages.loading:XZe(this)} aria-live=polite class=${Et({[mh.buttonPadding]:s,[mh.buttonPaddingShrunk]:!s,[mh.contentSlotted]:this.hasContent,[mh.iconStartEmpty]:!this.iconStart,[mh.iconEndEmpty]:!this.iconEnd})} .disabled=${e==="button"?this.disabled:null} download=${(e==="a"?this.download===!0||this.download===""?"":this.download||null:null)??sr} href=${(e==="a"&&this.href)??sr} name=${(e==="button"&&this.name)??sr} @click=${this.handleClick} rel=${(e==="a"&&this.rel)??sr} tabindex=${(this.disabled?-1:null)??sr} target=${(e==="a"&&this.target)??sr} title=${this.tooltipText??sr} type=${(e==="button"?this.type:null)??sr} ${_p(this.setChildEl)}>${r}${this.iconStart?n:null}${this.hasContent?o:null}${this.iconEnd?a:null}</${i}>`})}};P9.properties={hasContent:[16,{},{state:!0}],tooltipText:[16,{},{state:!0}],alignment:[3,{},{reflect:!0}],appearance:[3,{},{reflect:!0}],disabled:[7,{},{reflect:!0,type:Boolean}],download:[3,{converter:LL},{reflect:!0}],form:[3,{},{reflect:!0}],href:[3,{},{reflect:!0}],iconEnd:[3,{},{reflect:!0}],iconFlipRtl:[3,{},{reflect:!0}],iconStart:[3,{},{reflect:!0}],kind:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],name:[3,{},{reflect:!0}],rel:[3,{},{reflect:!0}],round:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],splitChild:[3,{},{reflect:!0}],target:[3,{},{reflect:!0}],type:[3,{},{reflect:!0}],width:[3,{},{reflect:!0}]},P9.styles=Oii;let b9=P9;ty("calcite-button",b9);const bW=Object.freeze(Object.defineProperty({__proto__:null,Button:b9},Symbol.toStringTag,{value:"Module"}));const Pii=(t,e)=>i=>Iii(i,t);let Rii=class extends Bhe{#e=void 0;constructor(e,i){super(e,i),new WZe(this.component)}hostLoad(){this.#e=X(()=>this.component.el.view,e=>{this.instance.view=e,this.instance.map=e?.map},{sync:!0,initial:!0})}hostDestroy(){this.#e?.remove(),super.hostDestroy()}};const Iii=U9(Rii);const BAe={panel:"esri-widget--panel",widget:"esri-widget"};let Dii=0,K3=class extends iy(nt(gF(be))){constructor(e){super(e),this.id=`${Date.now().toString(16)}-analysis-${Dii++}`,this.origin=null}get parent(){return this._get("parent")}set parent(e){const i=this.parent;if(i!=null)switch(i.type){case"line-of-sight":case"dimension":case"viewshed":i.releaseAnalysis(this);break;case"2d":case"3d":i.analyses.includes(this)&&i.analyses.remove(this)}this._set("parent",e)}equals(e){return!0}};c([p({type:String,constructOnly:!0,clonable:!1})],K3.prototype,"id",void 0),c([p({clonable:!1,value:null})],K3.prototype,"parent",null),c([p({types:{key:"type",base:null,typeMap:{"web-scene":Noe}}})],K3.prototype,"origin",void 0),K3=c([R("esri.analysis.Analysis")],K3);let Vb=class extends K3{constructor(t){super(t),this.type="direct-line-measurement",this.startPoint=null,this.endPoint=null,this.unit=null}get valid(){return this.startPoint!=null&&this.endPoint!=null}clear(){this.startPoint=null,this.endPoint=null}equals(t){return this===t||super.equals(t)&&this.unit===t.unit&&Ree(this.startPoint,t.startPoint)&&Ree(this.endPoint,t.endPoint)}};c([p({type:["direct-line-measurement"]})],Vb.prototype,"type",void 0),c([p({type:Ue})],Vb.prototype,"startPoint",void 0),c([p({type:Ue})],Vb.prototype,"endPoint",void 0),c([p({type:P5,value:null})],Vb.prototype,"unit",void 0),c([p({readOnly:!0})],Vb.prototype,"valid",null),Vb=c([R("esri.analysis.DirectLineMeasurementAnalysis")],Vb);const kii=Vb;function Lii(t){return t.forceInteractive()}function Fii(t){return tpe(t,"meters").value>hei}function zii(t){return GWe(t)}function jb(t){t?.abort()}function ele(t){t?.remove()}var Nii=Object.defineProperty,Vii=Object.getOwnPropertyDescriptor,HP=(t,e,i,r)=>{for(var s=r>1?void 0:r?Vii(e,i):e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Nii(e,i,s),s};function jii(t="Aborted"){return new q("AbortError",t)}function Uii(t,e="Aborted"){if(sYe(t))throw jii(e)}function rYe(t){return t instanceof AbortSignal?t:t?.signal??void 0}function sYe(t){return rYe(t)?.aborted??!1}function nYe(t){return t?.name==="AbortError"}function Bii(t){return{ok:!0,value:t}}function qii(t){return{ok:!1,error:t}}function Gii(t){return t?.ok?t.value:null}function Hii(t){return t!=null&&!t.ok?t.error:null}function Wii(t,e){const i=rYe(t);if(i==null)return;if(i.aborted){e();return}const r=()=>e();return i.addEventListener("abort",r,{once:!0}),{remove:()=>i.removeEventListener("abort",r)}}function qAe(t,e){return new M1(t,e)}let M1=class extends be{constructor(e,i){super({}),this._abortHandle=null,this.abort=()=>{this._abortController=jb(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=Bii(s),this._cleanup()},s=>{this._result=qii(s),this._cleanup()}),this._abortHandle=Wii(i,this.abort)}get value(){return Gii(this._result)}get error(){return Hii(this._result)}get finished(){return this._result!=null}destroy(){this.abort()}_cleanup(){this._abortHandle=ele(this._abortHandle),this._abortController=null}[Symbol.dispose](){this._cleanup()}};HP([p()],M1.prototype,"value",1);HP([p()],M1.prototype,"error",1);HP([p()],M1.prototype,"finished",1);HP([p()],M1.prototype,"promise",2);HP([p()],M1.prototype,"_result",2);M1=HP([R("esri.components.asyncUtils.ReactiveTask")],M1);function Zii(t){return t.catch(e=>{if(!nYe(e))throw e})}const Yii={remove:()=>{}};function Jii(t){return t?{remove:t}:Yii}var Qii=Object.defineProperty,Xii=Object.getOwnPropertyDescriptor,Qo=(t,e,i,r)=>{for(var s=r>1?void 0:r?Xii(e,i):e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Qii(e,i,s),s};let ro=class extends be{constructor(){super({}),this.shouldForceInteractive=!0,this._ownsAnalysis=!1,this._operationState="inactive",this._loggedUnsupportedErrorMessage=!1,this._changeFromReconnect=!1,this._startUserOperation=null}initialize(){this._set("analysis",this.constructAnalysis()),this._ownsAnalysis=!0;const t=()=>{!this._changeFromReconnect&&!this._viewHasAnalysis&&(this._ownsAnalysis=!1);const e=!this._changeFromReconnect;this._changeFromReconnect=!1,e&&this._scheduleViewReconnect()};this.addHandles([vs(()=>this.view?.ready&&!this.supported,()=>{this._loggedUnsupportedErrorMessage||console.error(this.unsupportedErrorMessage)},{sync:!0,initial:!0}),X(()=>[this.analysis,this._viewHasAnalysis],t,{sync:!0}),tn(()=>this.view,"analysis-view-destroy",e=>{e.analysis===this.analysis&&t()}),X(()=>({view:this.view,ready:!!this.view?.ready,supported:this.supported}),({view:e},i)=>{const r=i?.view;e!==r&&(this._startUserOperation=jb(this._startUserOperation),this._disconnectFromView(r)),this._scheduleViewReconnect()},{sync:!0,initial:!0})])}destroy(){this._reconnectViewTask=jb(this._reconnectViewTask),this._startUserOperation=jb(this._startUserOperation),this._analysisView!=null&&(this._analysisView.visible=void 0),this._disconnectFromView(this.view),this._set("view",null),this._ownsAnalysis&&this.analysis?.destroy()}get supported(){return this.view==null||this.supportedViewType==="both"||this.view.type===this.supportedViewType}set visible(t){this._set("visible",t),this._analysisView!=null&&(this._analysisView.visible=t)}get active(){return this._startUserOperation?.state===2}get disabled(){return!this.view?.ready||!this.supported}set analysis(t){t!==this._get("analysis")&&(this._startUserOperation=jb(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(t),this._scheduleViewReconnect())}get analysisView(){return this._analysisView}get ready(){return this._analysisView!=null&&!this.connectingToView}get connectingToView(){return this._reconnectViewTask!=null}get _viewHasAnalysis(){const{view:t}=this;return t?.analyses.includes(this.analysis)===!0}get operationState(){return this._operationState}clear(){this.clearAnalysis(),this._startUserOperation=jb(this._startUserOperation)}async start(t){if(!this.visible){console.warn("Cannot start analysis when not visible");return}t?.clear!==!1&&this.clear();const e={task:null,abort:null,state:0},i=qAe(async r=>{if(e.state=1,await qu(()=>this.ready,r),e.state=2,this._analysisView==null||this.view==null)return;this._operationState="active";const s=t?.operation?.({signal:r})??this.place({signal:r});await bp(s)});return i.promise.finally(()=>{(this._startUserOperation===e||this._startUserOperation==null)&&(this._operationState="inactive")}),e.task=i,e.abort=()=>i.abort(),this._startUserOperation=e,await i.promise}stop(){this._startUserOperation=jb(this._startUserOperation)}onConnectToAnalysisView(t){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=jb(this._reconnectViewTask);const t=qAe(async e=>{try{await this._reconnectView(e)}catch(i){if(Uii(e),!nYe(i)){console.warn("Failed to use analysis in view model",i);return}throw i}finally{t===this._reconnectViewTask&&(this._reconnectViewTask=void 0)}});this._reconnectViewTask=t}async _reconnectView(t){const{view:e}=this,i=e?.ready&&this.supported,r=this.analysis;if(this._startUserOperation=GAe(this._startUserOperation),this._disconnectFromView(e),!i||e==null||r==null)return;this._ownsAnalysis&&(this._changeFromReconnect=!0,e.analyses.add(r));const s=await e.whenAnalysisView(r);if(this._analysisView=s,sYe(t)){this._startUserOperation=GAe(this._startUserOperation);return}s.visible=this.visible,this._forceInteractiveHandle=this.shouldForceInteractive?Lii(s):Jii(),this.addHandles(this._forceInteractiveHandle),this.onConnectToAnalysisView(s)}_disconnectFromView(t){t!=null&&this._ownsAnalysis&&t.analyses.includes(this.analysis)&&(this._changeFromReconnect=!0,this.analysis.clear(),t.analyses.remove(this.analysis)),this.onDisconnectFromAnalysisView(),this._forceInteractiveHandle=ele(this._forceInteractiveHandle),this._analysisView=void 0}_setExternalAnalysis(t){this._analysisView!=null&&!this._ownsAnalysis&&(this._analysisView.visible=void 0,this._forceInteractiveHandle=ele(this._forceInteractiveHandle)),this._analysisView=void 0,this._ownsAnalysis=!1,this._set("analysis",t),this._changeFromReconnect=!1}};Qo([p()],ro.prototype,"supported",1);Qo([p()],ro.prototype,"view",2);Qo([p({type:Boolean,value:!0})],ro.prototype,"visible",1);Qo([p()],ro.prototype,"active",1);Qo([p()],ro.prototype,"disabled",1);Qo([p()],ro.prototype,"analysis",1);Qo([p()],ro.prototype,"_analysisView",2);Qo([p()],ro.prototype,"shouldForceInteractive",2);Qo([p()],ro.prototype,"analysisView",1);Qo([p()],ro.prototype,"ready",1);Qo([p()],ro.prototype,"connectingToView",1);Qo([p()],ro.prototype,"_ownsAnalysis",2);Qo([p()],ro.prototype,"_viewHasAnalysis",1);Qo([p()],ro.prototype,"_reconnectViewTask",2);Qo([p()],ro.prototype,"_forceInteractiveHandle",2);Qo([p()],ro.prototype,"_operationState",2);Qo([p()],ro.prototype,"operationState",1);ro=Qo([R("esri.components.support.AnalysisViewModel")],ro);function GAe(t){return t!=null&&t.state>=2?(t.abort(),null):t}const Kii=Sl`.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-hidden{display:none!important}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}.esri-widget--panel{min-width:300px;min-height:32px;padding:var(--esri-widget-padding);transition:max-height .25s ease-in-out;overflow-y:auto}.esri-unit-select{width:100%}.esri-unit-select__label{--calcite-label-margin-bottom: 0;width:100%}:host{display:block}.esri-measurement-widget-content{padding:var(--esri-widget-padding);flex-direction:column;gap:var(--calcite-spacing-xxl);display:flex;position:relative;overflow-y:auto}.esri-measurement-widget-content__error{color:var(--calcite-color-status-danger)}.esri-measurement-widget-content__error,.esri-measurement-widget-content__hint{overflow:hidden}.esri-measurement-widget-content__error p,.esri-measurement-widget-content__hint p{margin:0;padding:0}.esri-measurement-widget-content__hint,.esri-measurement-widget-content__error,.esri-measurement-widget-content__measurement,.esri-measurement-widget-content__measurement-item{flex-direction:column;gap:var(--calcite-spacing-md);animation:.25s ease-in-out esri-fade-in;display:flex}.esri-measurement-widget-content__measurement-item--disabled{color:var(--calcite-color-border-ghost)}.esri-measurement-widget-content__measurement-item__value{font-weight:var(--calcite-font-weight-semibold)}.esri-measurement-widget-content__actions{flex-direction:column;justify-content:center;gap:var(--calcite-spacing-xs);display:flex}:host{.esri-widget--panel{min-width:0}}`;var eri=Object.defineProperty,tri=Object.getOwnPropertyDescriptor,p_=(t,e,i,r)=>{for(var s=r>1?void 0:r?tri(e,i):e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&eri(e,i,s),s};let fm=class extends ro{constructor(){super(...arguments),this.supportedViewType="3d",this.unsupportedErrorMessage="The Direct Line Measurement 3D component is only supported in 3D views."}initialize(){this.addHandles(X(()=>({analysis:this.analysis,unit:this.unit}),({analysis:t,unit:e})=>{t!=null&&(t.unit=e)},{sync:!0,initial:!0}))}get state(){return this.disabled||!this.ready?"disabled":this.operationState==="inactive"?this.analysis.valid?"measured":"ready":"measuring"}get displayState(){if(!this.supported)return"unsupported";switch(this.state){case"disabled":case"ready":return"ready";case"measuring":return this.analysis.startPoint==null?"measuring":"measured";case"measured":return"measured"}}get measurement(){const t=this.analysisView?.result,e=t?.mode??"euclidean";if(!this.analysis.valid)return{mode:e,directDistance:SM(void 0),horizontalDistance:SM(void 0),verticalDistance:SM(void 0)};const i=t?.directDistance,r=i!=null&&Fii(i);return{mode:e??"euclidean",directDistance:SM(r?void 0:i),horizontalDistance:SM(t?.horizontalDistance),verticalDistance:SM(t?.verticalDistance)}}get unitOptions(){const t=this._userUnitOptions?.filter(e=>DAe.includes(e));return t&&t.length>0?t:DAe.slice()}set unitOptions(t){this._userUnitOptions=t}get unit(){const t=this._userUnit??this.analysis.unit,e=this.unitOptions;if(t&&e.includes(t))return t;const i=this._defaultUnit;return i&&e.includes(i)?i:e[0]}set unit(t){this._userUnit=t}get _defaultUnit(){return this.view?zii(this.view):void 0}async place(t){await this.analysisView?.place(t)}clearAnalysis(){this.analysis.startPoint=null,this.analysis.endPoint=null}constructAnalysis(){return new kii}};p_([p({readOnly:!0})],fm.prototype,"state",1);p_([p({readOnly:!0})],fm.prototype,"displayState",1);p_([p({readOnly:!0})],fm.prototype,"measurement",1);p_([p()],fm.prototype,"unitOptions",1);p_([p()],fm.prototype,"_userUnitOptions",2);p_([p()],fm.prototype,"unit",1);p_([p()],fm.prototype,"_userUnit",2);p_([p({readOnly:!0})],fm.prototype,"_defaultUnit",1);fm=p_([R("components.direct-line-measurement-3d.DirectLineMeasurement3dViewModel")],fm);const iri="arcgis-direct-line-measurement-3d",rri={base:iri},sri=Pii(fm),R9=class R9 extends Wo{constructor(){super(...arguments),this.viewModel=sri(this),this.messages=iYe({name:"directline-measurement-3d",blocking:!0}),this.view=this.viewModel.view,this.analysis=this.viewModel.analysis,this.autoDestroyDisabled=!1,this.icon="measure-line",this.state=this.viewModel.state,this.unit=this.viewModel.unit,this.unitOptions=this.viewModel.unitOptions,this.arcgisPropertyChange=UOe()("analysis","state"),this.arcgisReady=$a()}async clear(){this.viewModel.clear()}async destroy(){await this.manager.destroy()}async start(){Zii(this.viewModel.start())}render(){const{messages:e,unit:i,unitOptions:r,viewModel:s}=this,{measurement:n,state:a}=s;return ni`<div aria-label=${e.componentLabel??lD} class=${Et({[rri.base]:!0,[BAe.widget]:!0,[BAe.panel]:!0})} role=presentation><arcgis-measurement-content .state=${s.displayState} .hintLabel=${e.hint} .unsupportedLabel=${e.unsupported} .items=${[{title:e.direct,measurement:n.directDistance},{title:e.horizontal,measurement:n.horizontalDistance},{title:e.vertical,measurement:n.verticalDistance}]}><arcgis-unit-select slot=settings .options=${r} .selectLabel=${e.unit} .value=${i} @arcgisUnitSelectChange=${o=>{this.unit=o.detail}}></arcgis-unit-select><calcite-button slot=actions .disabled=${a==="disabled"} @click=${this.start}>${e.newMeasurement}</calcite-button></arcgis-measurement-content></div>`}};R9.properties={view:0,analysis:0,autoDestroyDisabled:5,icon:3,label:1,position:1,referenceElement:1,state:35,unit:1,unitOptions:0},R9.styles=Kii;let w9=R9;class nri extends w9{constructor(){super(),console.warn('arcgis-directline-measurement-3d - this component is deprecated. Use the "arcgis-direct-line-measurement-3d" component instead.')}}p$("arcgis-direct-line-measurement-3d",w9);p$("arcgis-directline-measurement-3d",nri);function ari(){return Ew.jsxs("arcgis-scene",{basemap:"dark-gray-vector",viewingMode:"local",ground:"world-elevation",children:[Ew.jsx("arcgis-elevation-profile",{slot:"bottom-right"}),Ew.jsx("arcgis-direct-line-measurement-3d",{slot:"bottom-left"})]})}function ori(){return Ew.jsx(Ew.Fragment,{children:Ew.jsx(ari,{})})}SQe.createRoot(document.getElementById("root")).render(Ew.jsx(gQe.StrictMode,{children:Ew.jsx(ori,{})}));const lri=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Mde,build:bUe,cubeMapSize:nA},Symbol.toStringTag,{value:"Module"})),cri=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Ide,build:RUe},Symbol.toStringTag,{value:"Module"})),uri=Object.freeze(Object.defineProperty({__proto__:null,build:LUe},Symbol.toStringTag,{value:"Module"})),hri=Object.freeze(Object.defineProperty({__proto__:null,build:j8e,calculateAnchorPosition:ZO,fullUV:gL},Symbol.toStringTag,{value:"Module"})),dri=Object.freeze(Object.defineProperty({__proto__:null,build:Vqe},Symbol.toStringTag,{value:"Module"})),pri=Object.freeze(Object.defineProperty({__proto__:null,build:jqe,getRadius:qH},Symbol.toStringTag,{value:"Module"})),fri=Object.freeze(Object.defineProperty({__proto__:null,build:Yqe},Symbol.toStringTag,{value:"Module"})),mri=Object.freeze(Object.defineProperty({__proto__:null,build:Xqe},Symbol.toStringTag,{value:"Module"})),gri=Object.freeze(Object.defineProperty({__proto__:null,build:cGe},Symbol.toStringTag,{value:"Module"})),yri=Object.freeze(Object.defineProperty({__proto__:null,build:M9e},Symbol.toStringTag,{value:"Module"})),vri=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:ufe,build:E9e},Symbol.toStringTag,{value:"Module"})),_ri=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:ofe,blurSize:lfe,build:C9e,gridCellPixelSize:Mw,outlineSize:xL},Symbol.toStringTag,{value:"Module"})),bri=Object.freeze(Object.defineProperty({__proto__:null,build:A9e},Symbol.toStringTag,{value:"Module"})),wri=Object.freeze(Object.defineProperty({__proto__:null,build:B9e,ribbonlineNumRoundJoinSubdivisions:SL},Symbol.toStringTag,{value:"Module"})),xri=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:afe,build:$9e},Symbol.toStringTag,{value:"Module"})),Sri=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:mfe,build:Y9e},Symbol.toStringTag,{value:"Module"})),Tri=Object.freeze(Object.defineProperty({__proto__:null,build:$7e},Symbol.toStringTag,{value:"Module"})),$ri=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:D7e,ColorizerStretchUniforms:I7e,ColorizerUniforms:sW,build:k7e},Symbol.toStringTag,{value:"Module"})),Cri=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Ofe,build:q7e},Symbol.toStringTag,{value:"Module"})),Mri=Object.freeze(Object.defineProperty({__proto__:null,build:rHe},Symbol.toStringTag,{value:"Module"})),Eri=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:kfe,build:nHe},Symbol.toStringTag,{value:"Module"})),Ari=Object.freeze(Object.defineProperty({__proto__:null,build:aHe},Symbol.toStringTag,{value:"Module"})),Ori=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Lfe,build:cHe},Symbol.toStringTag,{value:"Module"})),Pri=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:nW,build:dHe},Symbol.toStringTag,{value:"Module"})),Rri=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:zfe,SimpleAtmospherePassParameters:aW,build:pHe},Symbol.toStringTag,{value:"Module"})),Iri=Object.freeze(Object.defineProperty({__proto__:null,build:AHe},Symbol.toStringTag,{value:"Module"})),Dri=Object.freeze(Object.defineProperty({__proto__:null,GlowBlurPassParameters:Ufe,build:jHe},Symbol.toStringTag,{value:"Module"})),kri=Object.freeze(Object.defineProperty({__proto__:null,GlowCompositionPassParameters:Bfe,build:UHe},Symbol.toStringTag,{value:"Module"})),Lri=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:qfe,build:BHe},Symbol.toStringTag,{value:"Module"})),Fri=Object.freeze(Object.defineProperty({__proto__:null,build:qHe},Symbol.toStringTag,{value:"Module"})),zri=Object.freeze(Object.defineProperty({__proto__:null,build:HHe},Symbol.toStringTag,{value:"Module"})),Nri=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:Gfe,build:WHe},Symbol.toStringTag,{value:"Module"})),Vri=Object.freeze(Object.defineProperty({__proto__:null,build:ZHe},Symbol.toStringTag,{value:"Module"})),jri=Object.freeze(Object.defineProperty({__proto__:null,build:YHe},Symbol.toStringTag,{value:"Module"})),Uri=Object.freeze(Object.defineProperty({__proto__:null,build:JHe},Symbol.toStringTag,{value:"Module"})),Bri=Object.freeze(Object.defineProperty({__proto__:null,build:QHe},Symbol.toStringTag,{value:"Module"})),qri=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Hfe,build:KHe},Symbol.toStringTag,{value:"Module"})),Gri=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:Wfe,build:sWe},Symbol.toStringTag,{value:"Module"})),Hri=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Zfe,build:oWe},Symbol.toStringTag,{value:"Module"})),Wri=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:nz,build:aWe},Symbol.toStringTag,{value:"Module"})),Zri=Object.freeze(Object.defineProperty({__proto__:null,build:hWe},Symbol.toStringTag,{value:"Module"})),ePi=Object.freeze(Object.defineProperty({__proto__:null,execute:mW,isLoaded:Tme,load:$me,get supportsCurves(){return Sme}},Symbol.toStringTag,{value:"Module"}));export{va as $,qi as A,Y2t as A$,Wpe as A0,MKt as A1,eti as A2,b0i as A3,DPe as A4,lme as A5,Ojt as A6,xf as A7,Bnt as A8,qnt as A9,$bt as AA,bo as AB,No as AC,ZBt as AD,sxi as AE,TX as AF,dci as AG,J5t as AH,mqe as AI,NLt as AJ,kzt as AK,Lzt as AL,mgt as AM,Zbi as AN,uci as AO,Tbi as AP,Dtt as AQ,Nsi as AR,h3t as AS,iqe as AT,Yc as AU,$P as AV,un as AW,O2t as AX,A2t as AY,Er as AZ,Yb as A_,uH as Aa,PYt as Ab,qwt as Ac,l8e as Ad,ys as Ae,U7 as Af,h0t as Ag,u8e as Ah,h8e as Ai,PFe as Aj,DFe as Ak,xvt as Al,sui as Am,Pvt as An,nui as Ao,zEi as Ap,Gyt as Aq,vFe as Ar,Aze as As,Dsi as At,SS as Au,Bhi as Av,qhi as Aw,Ghi as Ax,Hhi as Ay,fVt as Az,avt as B,Xfi as B$,uVe as B0,Af as B1,Nv as B2,Rf as B3,fze as B4,sDe as B5,_9e as B6,YOe as B7,Kdt as B8,uyt as B9,MOi as BA,g0i as BB,Oue as BC,jLt as BD,D3t as BE,PO as BF,rti as BG,VO as BH,gmi as BI,ohi as BJ,ldi as BK,tfi as BL,a_e as BM,hmi as BN,dmi as BO,Gfi as BP,lmi as BQ,kfi as BR,emi as BS,Wfi as BT,qfi as BU,x$t as BV,Hfi as BW,eSe as BX,X2e as BY,K2e as BZ,Kfi as B_,F7t as Ba,Nnt as Bb,gH as Bc,Hoi as Bd,Que as Be,Ost as Bf,uoi as Bg,ZOi as Bh,Iti as Bi,Rti as Bj,WOi as Bk,Dti as Bl,Lci as Bm,iai as Bn,tai as Bo,Qst as Bp,hwt as Bq,ktt as Br,owt as Bs,Toi as Bt,L0 as Bu,BGe as Bv,zsi as Bw,Rjt as Bx,aci as By,eKt as Bz,Ch as C,ymt as C$,GVt as C0,imi as C1,tmi as C2,Tne as C3,Lhi as C4,w$t as C5,Nhi as C6,NEi as C7,T$t as C8,khi as C9,aZt as CA,mat as CB,qat as CC,Yfi as CD,eDe as CE,Xat as CF,Gai as CG,mci as CH,zvt as CI,Bfi as CJ,smi as CK,pmi as CL,hai as CM,$Ge as CN,Qfi as CO,Jfi as CP,qd as CQ,unt as CR,cnt as CS,nai as CT,iit as CU,eoi as CV,p$t as CW,fai as CX,F1i as CY,Sot as CZ,_xe as C_,Nfi as Ca,hbt as Cb,Dhi as Cc,hhi as Cd,dhi as Ce,HVt as Cf,Vhi as Cg,jhi as Ch,Jhi as Ci,Qhi as Cj,xhi as Ck,Xhi as Cl,Khi as Cm,X_t as Cn,ibt as Co,SRt as Cp,Ahi as Cq,ket as Cr,Jg as Cs,l9t as Ct,Gze as Cu,Uhi as Cv,IHe as Cw,Hr as Cx,B_t as Cy,MRe as Cz,bSe as D,xw as D$,_di as D0,bdi as D1,w0i as D2,D7 as D3,vw as D4,$mt as D5,j5 as D6,B5 as D7,IO as D8,_mt as D9,nii as DA,aii as DB,Ssi as DC,H8 as DD,WOe as DE,usi as DF,bOe as DG,mle as DH,psi as DI,fsi as DJ,iui as DK,xfi as DL,uat as DM,_ai as DN,xai as DO,Rai as DP,bai as DQ,Sai as DR,Iai as DS,Pat as DT,K8 as DU,Sfi as DV,$fi as DW,$r as DX,u0 as DY,Tw as DZ,WF as D_,Fsi as Da,Rmt as Db,Imt as Dc,Mue as Dd,Wwt as De,ihe as Df,edi as Dg,qT as Dh,vl as Di,cdi as Dj,adi as Dk,odi as Dl,ndi as Dm,sdi as Dn,xbt as Do,Eze as Dp,Thi as Dq,Shi as Dr,_bt as Ds,ahi as Dt,Mai as Du,Hv as Dv,gte as Dw,yai as Dx,Bc as Dy,eYe as Dz,pMt as E,Lg as E$,upe as E0,WH as E1,we as E2,A as E3,zP as E4,_t as E5,Gt as E6,er as E7,Hi as E8,_i as E9,R8e as EA,rpe as EB,_l as EC,Mpe as ED,rc as EE,yp as EF,FP as EG,pS as EH,FF as EI,Ade as EJ,igt as EK,a_ as EL,egt as EM,Vxi as EN,hSi as EO,eoe as EP,Kli as EQ,Pje as ER,l6e as ES,Mme as ET,int as EU,Ugi as EV,Ngi as EW,Qhe as EX,qei as EY,X5t as EZ,$Oi as E_,n5t as Ea,Hae as Eb,Tpe as Ec,jG as Ed,Fi as Ee,US as Ef,U8e as Eg,mpe as Eh,xUe as Ei,kH as Ej,Ps as Ek,Wf as El,ue as Em,Ede as En,wUe as Eo,s5t as Ep,F4t as Eq,npe as Er,GEe as Es,xFt as Et,aL as Eu,z4t as Ev,ici as Ew,tgt as Ex,cci as Ey,z_i as Ez,EV as F,Apt as F$,u1 as F0,rai as F1,Ca as F2,Oni as F3,YCi as F4,Wei as F5,FZe as F6,VH as F7,jS as F8,Ep as F9,j9e as FA,GSi as FB,OFt as FC,J$e as FD,Xg as FE,AFt as FF,CFt as FG,Y$e as FH,oae as FI,R$e as FJ,JCi as FK,GOt as FL,_de as FM,Eti as FN,Cti as FO,xti as FP,bti as FQ,dce as FR,j1 as FS,k4t as FT,H3t as FU,Eje as FV,Coi as FW,PDt as FX,sde as FY,_3t as FZ,eze as F_,Yyi as Fa,UPt as Fb,K4t as Fc,Cje as Fd,$oi as Fe,Fgi as Ff,sy as Fg,Qce as Fh,p6e as Fi,W0 as Fj,Vs as Fk,spe as Fl,Pr as Fm,fpe as Fn,j4t as Fo,ope as Fp,nci as Fq,QCi as Fr,NBt as Fs,s8t as Ft,Z0 as Fu,Go as Fv,HF as Fw,VBt as Fx,t9 as Fy,loe as Fz,qRe as G,b3t as G$,Bpt as G0,To as G1,T1 as G2,Sze as G3,mp as G4,c1 as G5,BH as G6,Spe as G7,no as G8,Ip as G9,_Ke as GA,TFt as GB,$Ft as GC,_m as GD,hHe as GE,YF as GF,S1 as GG,CHe as GH,Tqe as GI,Sqe as GJ,jH as GK,Ki as GL,o_ as GM,PHe as GN,AWt as GO,Vfe as GP,hWt as GQ,yRt as GR,ps as GS,zyi as GT,vYt as GU,Zo as GV,zu as GW,Tl as GX,Ffe as GY,Dgi as GZ,A$e as G_,JF as Ga,Jo as Gb,yzt as Gc,q1 as Gd,Lu as Ge,wn as Gf,Nc as Gg,wt as Gh,Rnt as Gi,DL as Gj,kL as Gk,z9 as Gl,_Xe as Gm,M0 as Gn,oOe as Go,AXe as Gp,YKe as Gq,hii as Gr,_le as Gs,b5 as Gt,_si as Gu,yle as Gv,bsi as Gw,wsi as Gx,yii as Gy,msi as Gz,Si as H,YLt as H$,M1i as H0,wbi as H1,gai as H2,XOe as H3,E1i as H4,UNt as H5,hp as H6,jl as H7,Df as H8,og as H9,__i as HA,a1i as HB,hNt as HC,cNt as HD,U5t as HE,F$e as HF,b_i as HG,lNt as HH,aLt as HI,_8e as HJ,dfe as HK,Nhe as HL,fX as HM,t1i as HN,fbi as HO,H4 as HP,GRt as HQ,Fh as HR,w3t as HS,jzt as HT,eFt as HU,Wd as HV,Koi as HW,Uli as HX,ybi as HY,TLe as HZ,GLt as H_,H1 as Ha,GPt as Hb,sqe as Hc,B9 as Hd,VP as He,N8e as Hf,Zq as Hg,JFe as Hh,zxi as Hi,Cyt as Hj,FSe as Hk,f0i as Hl,sai as Hm,Cpe as Hn,tvi as Ho,h5e as Hp,Azt as Hq,Ji as Hr,Jqe as Hs,o9 as Ht,mLt as Hu,$bi as Hv,Dfi as Hw,lE as Hx,M_i as Hy,J1i as Hz,ace as I,cI as I$,x_i as I0,Bzt as I1,pbi as I2,Cbi as I3,mvi as I4,dqt as I5,Rbi as I6,pqt as I7,cFt as I8,W$e as I9,GUe as IA,fL as IB,dbi as IC,LVt as ID,SE as IE,Qae as IF,ZVt as IG,DLe as IH,Tgt as II,oxi as IJ,OVt as IK,PVt as IL,axi as IM,VVt as IN,RVt as IO,yLt as IP,rxi as IQ,nxi as IR,TCi as IS,Uqe as IT,W9t as IU,dm as IV,y1 as IW,EOe as IX,vsi as IY,goi as IZ,voi as I_,Lq as Ia,bLt as Ib,Ao as Ic,Rni as Id,Znt as Ie,mX as If,X4t as Ig,Ipe as Ih,e7t as Ii,$pe as Ij,Ape as Ik,JO as Il,GH as Im,fzt as In,HH as Io,YO as Ip,kpe as Iq,Y0 as Ir,WPt as Is,G4 as It,BQ as Iu,vLt as Iv,_Lt as Iw,fLt as Ix,Jmt as Iy,qgi as Iz,Ist as J,Fpi as J0,Kpi as J1,Dmi as J2,iMe as J3,Ame as J4,JOi as J5,Aii as J6,bW as J7,ePi as J8,v4 as K,OM as L,Zc as M,uje as N,W9 as O,Wr as P,bi as Q,ke as R,be as S,Pu as T,ms as U,Je as V,yt as W,Gl as X,kv as Y,sw as Z,c as _,IUe as a,poe as a$,Sgt as a0,es as a1,HB as a2,bSt as a3,Zr as a4,Ht as a5,Pe as a6,zs as a7,D5t as a8,bt as a9,Qmt as aA,cCe as aB,pg as aC,VGe as aD,fvi as aE,pvi as aF,Xit as aG,_Ti as aH,sbi as aI,Wli as aJ,fi as aK,xr as aL,Zoi as aM,yw as aN,Qoi as aO,qt as aP,Joi as aQ,Zg as aR,ze as aS,ml as aT,nr as aU,udi as aV,S$i as aW,ta as aX,n9t as aY,QGt as aZ,BGt as a_,xbi as aa,Y1i as ab,cm as ac,j5t as ad,Z2t as ae,A5e as af,vli as ag,R7 as ah,QO as ai,Ho as aj,Ue as ak,gs as al,vm as am,gm as an,$i as ao,S0 as ap,qc as aq,eA as ar,xe as as,I as at,$e as au,he as av,u8t as aw,_7t as ax,q5 as ay,io as az,tm as b,Nct as b$,omi as b0,umi as b1,cmi as b2,se as b3,rmi as b4,sG as b5,Pfi as b6,$7t as b7,Lfi as b8,zfi as b9,Kh as bA,QN as bB,Ece as bC,Mce as bD,AS as bE,Ace as bF,kai as bG,xFe as bH,cS as bI,rDe as bJ,ie as bK,n$ as bL,Wc as bM,rni as bN,vze as bO,Ns as bP,ot as bQ,hMt as bR,wu as bS,Oe as bT,lp as bU,uMt as bV,Ihe as bW,Ju as bX,vs as bY,Cut as bZ,roi as b_,iH as ba,lDe as bb,Ihi as bc,ebt as bd,b7t as be,re as bf,DNt as bg,FNt as bh,LNt as bi,kNt as bj,QE as bk,wO as bl,Xi as bm,Mo as bn,GL as bo,Eo as bp,ti as bq,uP as br,Ea as bs,ddi as bt,BVt as bu,ep as bv,VFe as bw,oPe as bx,Xl as by,$5 as bz,Yt as c,Rue as c$,o1 as c0,Yoi as c1,gmt as c2,coi as c3,loi as c4,k0 as c5,bmt as c6,kdt as c7,fmt as c8,Q0 as c9,eBt as cA,dSi as cB,FGe as cC,mxi as cD,M2i as cE,sfe as cF,mSi as cG,sa as cH,Smi as cI,YJt as cJ,bp as cK,gF as cL,fF as cM,tn as cN,FS as cO,wa as cP,Rn as cQ,wl as cR,om as cS,Pa as cT,IH as cU,oFt as cV,iwi as cW,Qu as cX,nc as cY,$si as cZ,vce as c_,G5e as ca,p1 as cb,Vfi as cc,Ufi as cd,jfi as ce,_$t as cf,v$t as cg,vo as ch,gt as ci,c$t as cj,c0 as ck,l$t as cl,soi as cm,ooi as cn,aoi as co,noi as cp,bue as cq,nmt as cr,amt as cs,a1 as ct,mo as cu,Ct as cv,Eyt as cw,qu as cx,ct as cy,Yci as cz,p as d,Yr as d$,EP as d0,hli as d1,$4 as d2,st as d3,Lke as d4,Zs as d5,gD as d6,Li as d7,OS as d8,Ci as d9,en as dA,Oce as dB,oci as dC,N1i as dD,zr as dE,yl as dF,Cgi as dG,R0 as dH,sc as dI,Rs as dJ,cpi as dK,to as dL,Ye as dM,Ae as dN,Ft as dO,me as dP,iIe as dQ,XFe as dR,KFe as dS,xi as dT,Bo as dU,Jci as dV,fjt as dW,ju as dX,b7 as dY,Aet as dZ,nrt as d_,AP as da,zt as db,Gu as dc,e4e as dd,dpt as de,Ai as df,$9t as dg,Co as dh,Fst as di,g1i as dj,vmi as dk,Rwe as dl,ymi as dm,d1 as dn,ii as dp,HL as dq,Yu as dr,Ugt as ds,nt as dt,Rct as du,wp as dv,gP as dw,lf as dx,Bgt as dy,ts as dz,R as e,tde as e$,MM as e0,In as e1,YRe as e2,b4 as e3,U6 as e4,Mst as e5,fpi as e6,Sf as e7,aO as e8,v9e as e9,ar as eA,f1 as eB,Ddt as eC,jgi as eD,Le as eE,Mn as eF,Rxi as eG,yn as eH,Jke as eI,Ff as eJ,Moi as eK,Igi as eL,Wde as eM,MP as eN,$n as eO,Zu as eP,b1 as eQ,Ke as eR,Hgi as eS,Ui as eT,Bgi as eU,Qg as eV,Ve as eW,zgi as eX,u$ as eY,Rw as eZ,F5t as e_,Gv as ea,Ga as eb,l9 as ec,Dai as ed,kIe as ee,$Ie as ef,Jr as eg,Mat as eh,xce as ei,$ai as ej,mmt as ek,gxi as el,Kvi as em,dL as en,e0i as eo,Wu as ep,kO as eq,At as er,Re as es,op as et,so as eu,n3t as ev,Yx as ew,Tt as ex,r2t as ey,Ce as ez,q as f,bCt as f$,di as f0,Fbi as f1,s_ as f2,pB as f3,PEt as f4,fp as f5,fH as f6,Qgi as f7,Ygi as f8,Jgi as f9,E1 as fA,F5 as fB,_8t as fC,uK as fD,Tr as fE,tTi as fF,iTi as fG,ut as fH,mG as fI,TMe as fJ,Ipt as fK,Kl as fL,f5e as fM,Pp as fN,Tkt as fO,yi as fP,AH as fQ,K9 as fR,MAi as fS,BP as fT,az as fU,Jnt as fV,Byt as fW,Nw as fX,iF as fY,vxt as fZ,mCt as f_,Lgi as fa,USi as fb,BSi as fc,_S as fd,qSi as fe,gpe as ff,nbi as fg,Xe as fh,Dbi as fi,pW as fj,lPe as fk,GCi as fl,WCi as fm,ZCi as fn,Dfe as fo,pni as fp,fni as fq,Fr as fr,qjt as fs,Qxi as ft,Jxi as fu,Ree as fv,wi as fw,JL as fx,Fc as fy,iy as fz,mt as g,_pi as g$,EF as g0,Lr as g1,cO as g2,m2t as g3,_o as g4,Ob as g5,f_e as g6,fr as g7,Jv as g8,CNe as g9,z_t as gA,ehi as gB,ihi as gC,t_ as gD,ypi as gE,kft as gF,WY as gG,Wie as gH,Fai as gI,wLe as gJ,lci as gK,wmi as gL,wP as gM,Foe as gN,jdi as gO,dse as gP,ase as gQ,U0 as gR,Pc as gS,E0 as gT,W8 as gU,N4e as gV,eme as gW,z1 as gX,$$ as gY,YSt as gZ,pxt as g_,Wo as ga,Jw as gb,FL as gc,zL as gd,$a as ge,_W as gf,oii as gg,V9 as gh,JZe as gi,cii as gj,kKe as gk,wOe as gl,j9 as gm,XZe as gn,Et as go,_p as gp,fii as gq,pii as gr,RXe as gs,lD as gt,xee as gu,ni as gv,Sl as gw,ty as gx,e_e as gy,sr as gz,H0 as h,cD as h$,pq as h0,Xh as h1,oP as h2,Q9 as h3,ra as h4,hqe as h5,Ek as h6,tli as h7,ufi as h8,aTt as h9,sAi as hA,Svi as hB,aIt as hC,bl as hD,bH as hE,KRe as hF,kue as hG,Yft as hH,wli as hI,mVt as hJ,gVt as hK,mP as hL,wGe as hM,I1i as hN,R1i as hO,_F as hP,Bu as hQ,omt as hR,Tli as hS,jh as hT,Sli as hU,_ue as hV,srt as hW,D1i as hX,ku as hY,eF as hZ,XNt as h_,eH as ha,Aut as hb,X_e as hc,Gni as hd,iSt as he,rSt as hf,sSt as hg,bpi as hh,gvt as hi,Fdt as hj,GT as hk,ofi as hl,xli as hm,A1 as hn,P0 as ho,iMt as hp,Vmi as hq,Ndt as hr,Krt as hs,kn as ht,qni as hu,f1t as hv,HCt as hw,rie as hx,Vu as hy,ksi as hz,Ua as i,fft as i$,A6e as i0,aae as i1,Lw as i2,Iu as i3,Eu as i4,Bit as i5,Sni as i6,TRe as i7,Ng as i8,Qle as i9,jue as iA,oZe as iB,qxt as iC,tOi as iD,QKt as iE,I8 as iF,sd as iG,$0t as iH,_2t as iI,rTt as iJ,est as iK,rce as iL,sTt as iM,Kfe as iN,lQt as iO,oje as iP,Bxt as iQ,yxt as iR,Fxi as iS,Dxi as iT,Lxi as iU,y2t as iV,UNe as iW,MCt as iX,g2t as iY,Kn as iZ,Ec as i_,Zni as ia,cDe as ib,Qs as ic,Gc as id,e$ as ie,lP as ig,Cle as ih,s$t as ii,Xsi as ij,Fu as ik,Os as il,WAi as im,TIe as io,fl as ip,Tp as iq,pbe as ir,_O as is,wIe as it,rJ as iu,Cai as iv,h7 as iw,wce as ix,y0i as iy,rw as iz,W as j,ry as j$,dft as j0,uft as j1,u6e as j2,lU as j3,$We as j4,mF as j5,xl as j6,y$ as j7,Tdt as j8,T5 as j9,tci as jA,hci as jB,Xw as jC,kpt as jD,gHe as jE,pHt as jF,Xli as jG,afi as jH,Br as jI,Yet as jJ,gg as jK,_r as jL,jni as jM,Wni as jN,s2e as jO,nmi as jP,lli as jQ,Tfi as jR,D1 as jS,Qa as jT,cli as jU,Rke as jV,Cfi as jW,nB as jX,oli as jY,Efi as jZ,iS as j_,l0 as ja,HT as jb,Nu as jc,I1 as jd,OCt as je,ppi as jf,gq as jg,cce as jh,GCt as ji,Mq as jj,vi as jk,ba as jl,eai as jm,Kni as jn,uei as jo,oG as jp,vle as jq,_5 as jr,gsi as js,dsi as jt,LL as ju,Eee as jv,bet as jw,_et as jx,gle as jy,Aw as jz,YU as k,Nai as k$,F0 as k0,uli as k1,_0 as k2,nee as k3,ZKt as k4,YKt as k5,$1 as k6,MZe as k7,qP as k8,A0 as k9,Rje as kA,Zoe as kB,Hli as kC,p7 as kD,zUe as kE,Hc as kF,kde as kG,Qc as kH,ki as kI,nH as kJ,put as kK,Jh as kL,oi as kM,iat as kN,VNe as kO,Kpt as kP,eft as kQ,ZGt as kR,d$ as kS,Mt as kT,Bg as kU,F$ as kV,fvt as kW,YWe as kX,Sne as kY,Ani as kZ,Fhi as k_,Ixi as ka,dp as kb,rOi as kc,ytt as kd,oKt as ke,Uc as kf,VXe as kg,dOe as kh,fle as ki,hsi as kj,Goi as kk,vdi as kl,dwt as km,rm as kn,a8e as ko,Mp as kp,_n as kq,BXt as kr,jct as ks,uXt as kt,IAe as ku,$de as kv,tnt as kw,Ust as kx,mIe as ky,ed as kz,X as l,yce as l$,Lai as l0,Lat as l1,qai as l2,Hat as l3,hte as l4,Di as l5,vn as l6,hm as l7,Sr as l8,$hi as l9,wJ as lA,XL as lB,KL as lC,yue as lD,p2 as lE,Bmi as lF,gpi as lG,fie as lH,vft as lI,efi as lJ,Nmt as lK,bli as lL,pli as lM,gli as lN,fli as lO,yli as lP,i$ as lQ,mli as lR,_li as lS,ec as lT,Qwi as lU,Jwi as lV,Axi as lW,lG as lX,ype as lY,tqe as lZ,Zl as l_,q6 as la,Bte as lb,sE as lc,a7 as ld,zai as le,v$ as lf,Wee as lg,qLe as lh,xci as li,Bh as lj,rue as lk,Wce as ll,fdt as lm,IF as ln,Csi as lo,rFt as lp,Kwi as lq,$zt as lr,iFt as ls,zh as lt,PAt as lu,Yli as lv,Zli as lw,Ak as lx,Ini as ly,_He as lz,U1 as m,Osi as m$,gO as m0,So as m1,Ql as m2,R1 as m3,KT as m4,dat as m5,b0 as m6,JKt as m7,ey as m8,XKt as m9,bbi as mA,rrt as mB,n5e as mC,Ln as mD,gl as mE,Cn as mF,Jc as mG,v1 as mH,p3t as mI,QL as mJ,fHe as mK,EO as mL,S1i as mM,Gke as mN,qNt as mO,vCe as mP,Tsi as mQ,b1i as mR,Bi as mS,ude as mT,ijt as mU,q0 as mV,kgi as mW,cEt as mX,F7 as mY,eci as mZ,vue as m_,PZe as ma,X5 as mb,Ibi as mc,Pxi as md,J9 as me,Qee as mf,bni as mg,nDe as mh,X0 as mi,jt as mj,f$ as mk,gce as ml,Tnt as mm,pl as mn,$L as mo,ia as mp,Vh as mq,fMt as mr,K3 as ms,sPe as mt,Fw as mu,QUe as mv,cte as mw,RIe as mx,P1 as my,M5 as mz,ae as n,rci as n$,Psi as n0,Asi as n1,IP as n2,TS as n3,Urt as n4,CSt as n5,Ypi as n6,qpi as n7,R4 as n8,Zv as n9,iSi as nA,yAe as nB,eei as nC,uOi as nD,aei as nE,iOi as nF,fO as nG,pF as nH,xni as nI,DO as nJ,$7 as nK,Ow as nL,Brt as nM,Wg as nN,pp as nO,Zke as nP,mKe as nQ,lsi as nR,wKe as nS,Ws as nT,Afi as nU,tNt as nV,Kqe as nW,Qzt as nX,abi as nY,dqe as nZ,Jli as n_,$St as na,Jpi as nb,Qpi as nc,VF as nd,k4e as ne,m6t as nf,TEt as ng,V6e as nh,kw as ni,qxi as nj,Hg as nk,Dwt as nl,QJt as nm,xdi as nn,qGe as no,z as np,Oxi as nq,Npi as nr,I0 as ns,aAi as nt,aZe as nu,gAe as nv,kwe as nw,Kae as nx,nOi as ny,F4e as nz,id as o,yO as o$,WTi as o0,aGe as o1,ewi as o2,Mbi as o3,pqe as o4,h$ as o5,s5e as o6,lqe as o7,UOt as o8,bn as o9,Bx as oA,_Fe as oB,$g as oC,aqe as oD,oO as oE,gni as oF,Lf as oG,nli as oH,DF as oI,Aa as oJ,ynt as oK,mO as oL,Wgi as oM,C1i as oN,Oa as oO,HWe as oP,YGe as oQ,cai as oR,sW as oS,Xbt as oT,bg as oU,T7 as oV,Nh as oW,bce as oX,vO as oY,Dg as oZ,wOi as o_,LGe as oa,rui as ob,oF as oc,s1 as od,cF as oe,pr as of,lF as og,Twe as oh,O1i as oi,kbi as oj,MS as ok,O1 as ol,Kpe as om,Sp as on,pte as oo,o7 as op,iJ as oq,VE as or,w5 as os,wle as ot,zjt as ou,GNt as ov,Ug as ow,zci as ox,Fci as oy,M6 as oz,jse as p,SKe as p$,Vgi as p0,Aje as p1,cr as p2,A7 as p3,Fjt as p4,YAi as p5,JAi as p6,ZAi as p7,iei as p8,ibi as p9,L6t as pA,YFe as pB,o$ as pC,eli as pD,gwi as pE,gFe as pF,vwi as pG,rd as pH,iBe as pI,vHe as pJ,WRt as pK,ZRt as pL,_wi as pM,Eqe as pN,fxi as pO,Hpe as pP,m0i as pQ,FAi as pR,jd as pS,mr as pT,mte as pU,ohe as pV,Xa as pW,Yni as pX,w4e as pY,mrt as pZ,uKe as p_,vbi as pa,ent as pb,ivt as pc,Nue as pd,hAt as pe,XEt as pf,Yat as pg,jai as ph,e1 as pi,H5 as pj,dhe as pk,zc as pl,TJt as pm,hNe as pn,Hle as po,ece as pp,hni as pq,IFe as pr,nF as ps,Hb as pt,vhe as pu,pn as pv,jvt as pw,Uvt as px,hUt as py,D2i as pz,u2e as q,pat as q$,nKe as q0,dni as q1,csi as q2,ysi as q3,HAi as q4,CF as q5,Khe as q6,Ph as q7,Ya as q8,l1 as q9,dwe as qA,zGe as qB,ZG as qC,LH as qD,vFt as qE,wqe as qF,Hxi as qG,f7t as qH,Sdi as qI,Tdi as qJ,kwt as qK,tIe as qL,_$ as qM,b$ as qN,VMi as qO,$He as qP,U4t as qQ,_G as qR,K4 as qS,zMi as qT,ZTi as qU,eIt as qV,rBe as qW,eBe as qX,ls as qY,v3t as qZ,A7e as q_,wr as qa,mai as qb,ide as qc,_6e as qd,KUt as qe,Jl as qf,_hi as qg,vhi as qh,yhi as qi,ghi as qj,whi as qk,bhi as ql,mhi as qm,fhi as qn,bF as qo,Eue as qp,Epi as qq,WCt as qr,GSt as qs,zCt as qt,tCt as qu,Z7 as qv,Tle as qw,Rsi as qx,$le as qy,Isi as qz,h2e as r,Nvt as r$,Iee as r0,phi as r1,cP as r2,Cf as r3,lTt as r4,WT as r5,t7 as r6,_Ct as r7,Kxt as r8,pCt as r9,lfi as rA,TVe as rB,xVe as rC,z1i as rD,mGe as rE,_Ge as rF,yGe as rG,P1i as rH,yCe as rI,V1i as rJ,wnt as rK,Ent as rL,bGe as rM,tF as rN,lai as rO,ZJt as rP,c6e as rQ,Kv as rR,aue as rS,Ysi as rT,Pft as rU,ipt as rV,Hht as rW,iVe as rX,YGt as rY,d3e as rZ,xne as r_,n2t as ra,RCt as rb,Qwe as rc,k5e as rd,iTt as re,x2t as rf,Y7 as rg,mSe as rh,Js as ri,Hse as rj,PF as rk,f2t as rl,xg as rm,tst as rn,w$ as ro,Lsi as rp,mbe as rq,mg as rr,K5 as rs,Che as rt,w2t as ru,b2t as rv,v2t as rw,TPe as rx,sni as ry,cfi as rz,cJt as s,Yai as s$,gBt as s0,yBt as s1,XO as s2,Qpe as s3,HGe as s4,Ajt as s5,n_ as s6,m$ as s7,A$ as s8,Qvi as s9,Kmt as sA,Ivi as sB,II as sC,FFt as sD,fwi as sE,$o as sF,Nwi as sG,Rp as sH,Q5 as sI,X4 as sJ,xt as sK,xze as sL,i1i as sM,g_e as sN,r0 as sO,Rdt as sP,EOi as sQ,FIe as sR,LIe as sS,Rat as sT,W6 as sU,KIe as sV,vai as sW,Sce as sX,AM as sY,Wai as sZ,Zai as s_,opi as sa,B0 as sb,rde as sc,Cp as sd,Yhe as se,Mpt as sf,Tn as sg,pyt as sh,Rle as si,cni as sj,lni as sk,L1i as sl,k1i as sm,ztt as sn,APe as so,uai as sp,hdi as sq,X3t as sr,li as ss,Is as st,jO as su,eL as sv,tEt as sw,Y8t as sx,bm as sy,Pue as sz,dJt as t,STe as t$,Pai as t0,Aai as t1,Tai as t2,lat as t3,Eai as t4,Oat as t5,uni as t6,Vai as t7,Hai as t8,Vn as t9,PSt as tA,DSt as tB,kSt as tC,HSt as tD,LSt as tE,FSt as tF,zSt as tG,NSt as tH,VSt as tI,jSt as tJ,zo as tK,Xni as tL,jL as tM,ym as tN,F1 as tO,Rt as tP,gp as tQ,rQ as tR,Zh as tS,X9e as tT,dCe as tU,f4 as tV,qLt as tW,HLt as tX,WLt as tY,ZLt as tZ,z0 as t_,zAi as ta,ES as tb,q2 as tc,hf as td,CTt as te,i2t as tf,RSt as tg,wVe as th,USt as ti,pRe as tj,wRe as tk,pP as tl,fa as tm,Fs as tn,qh as to,eMi as tp,yc as tq,BSt as tr,WSt as ts,pVe as tt,whe as tu,eG as tv,p2t as tw,Es as tx,XSt as ty,OSt as tz,g$ as u,Net as u$,_bi as u0,uHt as u1,mHe as u2,fHt as u3,yHt as u4,dHt as u5,L1 as u6,Vne as u7,C3t as u8,Xhe as u9,n1 as uA,j1i as uB,m1i as uC,JIe as uD,Bai as uE,qL as uF,$1i as uG,J8e as uH,dli as uI,BNt as uJ,tpe as uK,Yh as uL,HOi as uM,p0i as uN,v0i as uO,_0i as uP,EH as uQ,SOi as uR,yIe as uS,ehe as uT,o9t as uU,VGt as uV,w$i as uW,L$i as uX,Gpi as uY,awt as uZ,fwt as u_,um as ua,Gvi as ub,Hhe as uc,bxe as ud,aDe as ue,Jat as uf,dde as ug,jNt as uh,y1i as ui,v1i as uj,_1i as uk,zNt as ul,Wq as um,Ehi as un,Chi as uo,Mhi as up,_ze as uq,jpi as ur,Upi as us,Vpi as ut,o6e as uu,rgt as uv,U1i as uw,CNt as ux,MNt as uy,xp as uz,Me as v,$p as v$,Uni as v0,dRe as v1,e7 as v2,Hni as v3,lZe as v4,nm as v5,aOi as v6,sOi as v7,Kw as v8,art as v9,e$i as vA,jg as vB,Tbt as vC,LU as vD,Cbt as vE,eRe as vF,wg as vG,MF as vH,Vdi as vI,EVe as vJ,Lle as vK,FM as vL,fo as vM,Pmi as vN,y3 as vO,gCt as vP,Sh as vQ,U3t as vR,Lje as vS,Wvt as vT,Gi as vU,Xpi as vV,mm as vW,xRe as vX,Bet as vY,Ept as vZ,bLe as v_,Skt as va,fZe as vb,oOi as vc,KKt as vd,dn as ve,D0 as vf,em as vg,Ou as vh,lOi as vi,tei as vj,Jni as vk,hfi as vl,Uxt as vm,tG as vn,UP as vo,Ohi as vp,Rhi as vq,Phi as vr,g8e as vs,g_i as vt,kjt as vu,fG as vv,ll as vw,l_i as vx,rF as vy,Ole as vz,Ie as w,cAt as w$,gde as w0,Uh as w1,YRt as w2,tBe as w3,wG as w4,KUe as w5,nBe as w6,bG as w7,Cs as w8,Pni as w9,$Re as wA,eIe as wB,z_e as wC,DRe as wD,$me as wE,xOi as wF,bfi as wG,S$ as wH,Cg as wI,XTt as wJ,Dni as wK,O4e as wL,u6t as wM,Uyt as wN,Omt as wO,Qli as wP,Yle as wQ,Dpt as wR,l5e as wS,v0t as wT,KSi as wU,Rpt as wV,d_ as wW,Whe as wX,uLt as wY,eTi as wZ,$Le as w_,oue as wa,RRe as wb,Bni as wc,aie as wd,z6t as we,uhi as wf,zbi as wg,Nbi as wh,a5e as wi,VLt as wj,OO as wk,Lbi as wl,H$e as wm,HCi as wn,qf as wo,x4 as wp,eTt as wq,nfi as wr,sfi as ws,kxi as wt,V4 as wu,Iw as wv,AO as ww,ACt as wx,KOe as wy,Vni as wz,SFe as x,Gce as x$,y3t as x0,KEt as x1,DC as x2,gSt as x3,MVt as x4,SNt as x5,wNt as x6,Zwi as x7,Wwi as x8,V0 as x9,Djt as xA,The as xB,D2t as xC,Rce as xD,Qni as xE,N9 as xF,xsi as xG,hue as xH,CC as xI,JOe as xJ,Qte as xK,COi as xL,hei as xM,iti as xN,Kst as xO,Xst as xP,ea as xQ,zO as xR,GWe as xS,lm as xT,i8t as xU,cKt as xV,Mle as xW,Vci as xX,FWt as xY,uz as xZ,Ice as x_,Zvt as xa,q1i as xb,i2i as xc,G9e as xd,nGe as xe,gV as xf,A1i as xg,pwe as xh,sM as xi,uNt as xj,x1i as xk,Nli as xl,cLt as xm,$f as xn,Bpi as xo,EVt as xp,dl as xq,m1 as xr,Ggi as xs,jjt as xt,uG as xu,Zxi as xv,sci as xw,pai as xx,dai as xy,KCi as xz,nvt as y,VX as y$,fat as y0,P$i as y1,Afe as y2,x$i as y3,A$i as y4,C7e as y5,R$i as y6,O$i as y7,Lc as y8,D$i as y9,$Et as yA,qCi as yB,rz as yC,z7t as yD,tI as yE,Xoi as yF,V$i as yG,N$i as yH,z$i as yI,F$i as yJ,q9 as yK,QSe as yL,Uxi as yM,JH as yN,Nj as yO,XGe as yP,moi as yQ,SH as yR,Pbi as yS,oyi as yT,mni as yU,Or as yV,kg as yW,lVe as yX,cVe as yY,Sbi as yZ,qg as y_,k$i as ya,$$i as yb,M$i as yc,vLe as yd,Api as ye,NRe as yf,_1 as yg,uEt as yh,XCi as yi,ywi as yj,j7t as yk,xoi as yl,Qsi as ym,mde as yn,E5 as yo,Ywi as yp,y6e as yq,m6e as yr,O6e as ys,ww as yt,bjt as yu,Wne as yv,y6t as yw,JCe as yx,S2t as yy,Let as yz,It as z,pIe as z$,jX as z0,Z_t as z1,oVt as z2,QF as z3,sH as z4,J5 as z5,jyt as z6,na as z7,l7 as z8,Jhe as z9,Tci as zA,$ci as zB,Vf as zC,lS as zD,mw as zE,Bce as zF,Jsi as zG,Esi as zH,RFe as zI,ami as zJ,Yhi as zK,Zhi as zL,lhi as zM,chi as zN,yni as zO,FFe as zP,LO as zQ,c7 as zR,yFe as zS,SF as zT,o4 as zU,vAe as zV,CKt as zW,dIe as zX,xZe as zY,wme as zZ,xKt as z_,cOi as za,Dw as zb,Ije as zc,tL as zd,ede as ze,Xnt as zf,H6 as zg,Uai as zh,RTt as zi,V5t as zj,Ffi as zk,Whi as zl,Ofi as zm,zhi as zn,I$i as zo,J2e as zp,Oh as zq,jv as zr,xO as zs,jxt as zt,e2t as zu,t2t as zv,s2t as zw,oCt as zx,vCt as zy,Sci as zz};
