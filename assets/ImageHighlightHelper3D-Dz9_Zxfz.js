const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphicsView3D-CftG4XXW.js","assets/index-Bncuv2b3.js","assets/index-D_89hqeg.css","assets/GraphicsProcessor-CZ15vLzl.js","assets/renderingInfoUtils-DW6LSwuP.js","assets/ExtentSet-B6Zhwopb.js","assets/optimizedFeatureQueryEngineAdapter-oqjHWYWZ.js","assets/popupUtils-Bz2hj6zP.js","assets/Graphics3DObjectStates-BQM6fHkd.js","assets/highlightUtils-L6kG0T6W.js","assets/highlightOptionsUtils-BiLqICK5.js"])))=>i.map(i=>d[i]);
import{S as g,cO as d,V as u,cP as w,cQ as y,T as _,Q as c,j as m,O as v,l as f,a9 as V,cR as H,cS as G,cT as $,_ as h,d as o,e as C}from"./index-Bncuv2b3.js";import{i as P}from"./highlightUtils-e1O_WROV.js";let r=class extends g{get updating(){return this.graphicsView?.updating??!1}constructor(s){super(s),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new d,this.graphicsView=null,this.suspended=!1;const e=new u([255,255,255,1/255]);this._symbols=new Map([["point",new w({size:"2px",style:"square",color:e})],["polyline",new y({width:"2px",color:e})],["polygon",new _({outline:null,color:e})]])}highlight(s,e){const i=P(s);if(i.length===0)return c();let n,t=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then(([a,p])=>{!t&&p&&(n=this._addHighlightGraphics(p,a,e))})),c(()=>{t=!0,n?.remove()})}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(s,e,i){for(const t of e)this._highlightCounts.set(t,(this._highlightCounts.get(t)??0)+1);this.graphics.addMany(e);const n=s.highlight(e,i);return c(()=>{this._removeHighlightGraphics(e),n.remove()})}_removeHighlightGraphics(s){this.graphics.removeMany(s.filter(e=>{const i=Math.max(0,(this._highlightCounts.get(e)??0)-1);return i===0?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,i),!1)}))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=m(()=>import("./GraphicsView3D-CftG4XXW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));const{default:s}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new s({view:this.view,layer:{type:"graphics-view-3d-dummy",id:this.layer.id,uid:this.layer.uid,elevationInfo:{mode:"on-the-ground"}},getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",e),this.addHandles([v(this.graphicsView),f(()=>this.suspended,i=>{e.suspended=i},V)]),e}async _createHighlightGraphics(s){const e=s.map(({geometry:t})=>t?.spatialReference).filter(H).reduce((t,a)=>(t.length!==0&&t.at(-1)?.equals(a)||t.push(a),t),[]),i=this.view.spatialReference,n=e.map(t=>({source:t,dest:i}));try{await G(n)}catch{return[]}return s.map(t=>{const{geometry:a}=t;try{const p=a?$(a,i):null,l=t.cloneShallow();return l.geometry=p,l.symbol=this._symbols.get(p?.type),l}catch{return t}})}};h([o()],r.prototype,"graphics",void 0),h([o()],r.prototype,"graphicsView",void 0),h([o()],r.prototype,"view",void 0),h([o()],r.prototype,"layer",void 0),h([o()],r.prototype,"updatingHandles",void 0),h([o()],r.prototype,"suspended",void 0),h([o()],r.prototype,"updating",null),r=h([C("esri.views.3d.layers.support.ImageHighlightHelper3D")],r);export{r as w};
