import{aj as B,j3 as M,fg as F,jh as H,jn as k,iX as R,i$ as J,fv as K,fj as S,j5 as N,iO as Q,iP as W,fi as Z,fu as ee,jo as te,jp as se,jj as ne,j4 as oe}from"./index-DWB-5FUE.js";function U(){return{m_pGcs:new S,m_xyz:new N,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:ae,setLength:re,assign:ie}}function ae(i,e,t,n){this.m_factor=i,this.m_pGcs.assign(e),this.m_xyz.assign(n),this.m_geoLength=t}function re(i){this.m_geoLength=i}function ie(i){this.m_pGcs.assign(i.m_pGcs),this.m_xyz.assign(i.m_xyz),this.m_factor=i.m_factor,this.m_geoLength=i.m_geoLength}class ge{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,u,s){if(e.hasNonLinearSegments()&&(e=new B().execute(e,0,t.getTolerance(0),0,s)),t.isPannable()){let m=90,a=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(m*=Math.PI/180,a*=Math.PI/180),t.getCoordinateSystemType()===2){let _=null;const o=[0,0,0,0];_=t.getPECoordSys(),o[0]=0,o[1]=m,o[2]=0,o[3]=a,M.geogToProj(_,2,o),m=o[1],a=o[3]}const g=new F;e.queryEnvelope(g),g.ymin=a,g.ymax=m,e=new H().execute(e,g,t,s)}else{const m=t.getPCSHorizon();(e=new k().execute(e,m,t,s))===m&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,u,1,s)}_ExecuteIterativeApproach(e,t,n,u,s,m){const a=R();n.querySpheroidData(a);const g=a.majorSemiAxis,_=a.e2,o=n.getUnit().getUnitToBaseFactor(),T=40,j=J(U,T),w=K(T,Number.NaN),x=U(),c=U();let l;const r=[0,0,0,0],A=t.getPECoordSys(),C=new S,E=new S,y=new S,f=new S,d=new S;let V=0;const b=e.querySegmentIterator();for(;b.nextPath();)for(;b.hasNextSegment();){const v=b.nextSegment();C.assign(v.getStartXY()),E.assign(v.getEndXY()),t.getCoordinateSystemType()===2?(r[0]=C.x,r[1]=C.y,r[2]=E.x,r[3]=E.y,M.projToGeog(A,2,r),y.x=r[0]*o,y.y=r[1]*o,f.x=r[2]*o,f.y=r[3]*o):(y.setCoordsPoint2D(C),f.setCoordsPoint2D(E),y.scale(o),f.scale(o));const z=new N,D=new N;$(g,_,y,z),$(g,_,f,D);let p=G(g,z,D);x.setValues(0,y,Number.NaN,z),c.setValues(1,f,p,D),l=s,j[0].assign(c),w[0]=s;let h=0;for(;;){h>128&&ne("iterations exceeded");const X=.5*(x.m_factor+c.m_factor),I=v.getCoord2D(X);t.getCoordinateSystemType()===2?(r[0]=I.x,r[1]=I.y,M.projToGeog(A,1,r),d.x=r[0]*o,d.y=r[1]*o):(d.setCoordsPoint2D(I),d.scale(o)),y.setCoordsPoint2D(x.m_pGcs),f.setCoordsPoint2D(c.m_pGcs);const L=new N;$(g,_,d,L);const q=G(g,x.m_xyz,L),O=G(g,c.m_xyz,L);p=c.m_geoLength,Number.isNaN(p)&&(p=G(g,x.m_xyz,c.m_xyz));const P=q+O,Y=l===s&&P>=20&&Math.abs(P-p)>1e-8*(p+P);if(h+2<T&&(Y||Math.abs(P-p)>0&&l>0))c.setLength(O),j[h].assign(c),c.setValues(X,d,q,L),j[++h].assign(c),Y?(l=s,w[h]=s):(l--,w[h-1]=l,w[h]=l);else{if(V+=P,h===0)break;x.assign(c),c.assign(j[--h]),l=w[h]}}}return V}execute(e,t,n){if(t&&t.getCoordinateSystemType()!==0||Q(""),e.isEmpty()||e.getDimension()<1)return 0;let u=null;const s=t.getGCS();s!==t&&(u=W(t,s,null));const m=e.getGeometryType();if(m===Z.enumEnvelope){const a=new ee;return a.addEnvelope(e,!1),this._ExecuteShapePreservingLength(a,t,s,u,n)}if(te(m)){const a=new se;return a.addSegment(e,!0),this._ExecuteShapePreservingLength(a,t,s,u,n)}return this._ExecuteShapePreservingLength(e,t,s,u,n)}}function $(i,e,t,n){n.assign(oe(i,e,t))}function G(i,e,t){const n=i,u=new N;u.setSub(e,t);const s=u.length();return 2*n*Math.asin(s/(2*n))}export{ge as w};
