const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/loader-C8A9XVHe.js","assets/index-unbwGsqd.js","assets/index-D_89hqeg.css","assets/resourceUtils-CUEQR0hq.js"])))=>i.map(i=>d[i]);
import{pw as ee,px as te,ee as I,eg as N,m4 as V,py as re,pz as se,j as oe,pA as ne,fL as ae,fH as ie,at as F,dO as k,dN as le,pB as z,eW as ue,es as ce,p2 as me,mu as q,pC as G,ep as de,nW as L,eq as D,mL as fe,pD as O,pE as pe,pF as xe,pG as he,kL as A,mK as Te,kI as v,mx as ge,jE as be,ly as H,lz as U,my as ye,pH as we,pI as Re,pJ as W,pK as $e,pL as ve,kH as Me,om as Be,pM as Se,pN as Ae}from"./index-unbwGsqd.js";import{a as Ee}from"./devEnvironmentUtils-8WtPGj6h.js";import{o as _e,d as K}from"./vec4-Djafn1cl.js";import{o as Ie,n as Fe}from"./indexUtils-DmdZo8wC.js";import{t as E}from"./resourceUtils-CUEQR0hq.js";function M(t){if(t==null)return null;const r=t.offset!=null?t.offset:ee,o=t.rotation!=null?t.rotation:0,s=t.scale!=null?t.scale:te,c=I(1,0,0,0,1,0,r[0],r[1],1),d=I(Math.cos(o),-Math.sin(o),0,Math.sin(o),Math.cos(o),0,0,0,1),a=I(s[0],0,0,0,s[1],0,0,0,1),i=N();return V(i,d,a),V(i,c,i),i}class Oe{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class Le{constructor(r,o,s){this.name=r,this.lodThreshold=o,this.pivotOffset=s,this.stageResources=new Oe,this.numberOfVertices=0}}async function Ce(t,r){const o=J(Ee(t));if(o.fileType==="wosr"){const l=await(r.cache?r.cache.loadWOSR(o.url,r):re(o.url,r)),{engineResources:p,referenceBoundingBox:x}=se(l,r);return{lods:p,referenceBoundingBox:x,isEsriSymbolResource:!1,isWosr:!0}}let s;if(r.cache)s=await r.cache.loadGLTF(o.url,r,!!r.usePBR);else{const{loadGLTF:l}=await oe(()=>import("./loader-C8A9XVHe.js"),__vite__mapDeps([0,1,2,3]));s=await l(new ne(r.streamDataRequester),o.url,r,r.usePBR)}const c=s.model.meta?.ESRI_proxyEllipsoid,d=s.meta.isEsriSymbolResource&&c!=null&&s.meta.ESRI_webstyle==="EsriRealisticTreesStyle";d&&!s.customMeta.esriTreeRendering&&(s.customMeta.esriTreeRendering=!0,ze(s,c));const a=!!r.usePBR,i=s.meta.isEsriSymbolResource?{usePBR:a,isSchematic:!1,treeRendering:d,mrrFactors:Se}:{usePBR:a,isSchematic:!1,treeRendering:!1,mrrFactors:Ae},u={...r.materialParameters,treeRendering:d},{engineResources:e,referenceBoundingBox:n}=Pe(s,i,u,r,o.specifiedLodIndex,d);return{lods:e,referenceBoundingBox:n,isEsriSymbolResource:s.meta.isEsriSymbolResource,isWosr:!1}}function J(t){const r=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return r?{fileType:"gltf",url:r[1],specifiedLodIndex:r[4]!=null?Number(r[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function Pe(t,r,o,s,c,d){const a=t.model,i=new Array,u=new Map,e=new Map,n=a.lods.length,l=de();return a.lods.forEach((p,x)=>{const h=s.skipHighLods===!0&&(n>1&&x===0||n>3&&x===1)||s.skipHighLods===!1&&c!=null&&x!==c;if(h&&x!==0)return;const m=new Le(p.name,p.lodThreshold,[0,0,0]);p.parts.forEach(T=>{const g=h?new L({},s):je(a,T,m,r,o,u,e,s,d),{geometry:y,vertexCount:f}=Ve(T,g??new L({},s)),b=y.boundingInfo;b!=null&&x===0&&(D(l,b.bbMin),D(l,b.bbMax)),g!=null&&(m.stageResources.geometries.push(y),m.numberOfVertices+=f)}),h||i.push(m)}),{engineResources:i,referenceBoundingBox:l}}function je(t,r,o,s,c,d,a,i,u){const e=t.materials.get(r.material);if(e==null)return null;const{normal:n,color:l,texCoord0:p,tangent:x}=r.attributes,h=r.material+(n?"_normal":"")+(l?"_color":"")+(p?"_texCoord0":"")+(x?"_tangent":""),m=r.attributes.texCoord0!=null,T=r.attributes.normal!=null,g=ke(e.alphaMode);if(!d.has(h)){if(m){const $=(S,X=!1,Y=!1)=>{if(S!=null&&!a.has(S)){const _=t.textures.get(S);if(_){const w=_.data,Z=X&&!E(w)?i.compressionOptions:void 0;a.set(S,new Be(E(w)?w.data:w,{..._.parameters,preMultiplyAlpha:!E(w)&&Y,encoding:E(w)?w.encoding:void 0,compressionOptions:Z}))}}},Q=g!==1&&!u;$(e.colorTexture,Q,g!==1),$(e.normalTexture),$(e.occlusionTexture,!0),$(e.emissiveTexture),$(e.metallicRoughnessTexture,!0)}const f=O(e.color[0]),b=O(e.color[1]),C=O(e.color[2]),B=e.colorTexture!=null&&m?a.get(e.colorTexture):null,P=pe(e),j=e.normalTextureTransform?.scale!=null?e.normalTextureTransform?.scale:xe;d.set(h,new L({...s,customDepthTest:1,textureAlphaMode:g,textureAlphaCutoff:e.alphaCutoff,diffuse:[f,b,C],ambient:[f,b,C],opacity:e.alphaMode==="OPAQUE"?1:e.opacity,doubleSided:e.doubleSided,doubleSidedType:"winding-order",cullFace:e.doubleSided?0:2,hasVertexColors:!!r.attributes.color,hasVertexTangents:!!r.attributes.tangent,normalType:T?0:2,castShadows:!0,receiveShadows:e.receiveShadows,receiveAmbientOcclusion:e.receiveAmbientOcclusion,textureId:B?.id,colorMixMode:e.colorMixMode,normalTextureId:e.normalTexture!=null&&m?a.get(e.normalTexture).id:void 0,textureAlphaPremultiplied:B!=null&&!!B.parameters.preMultiplyAlpha,occlusionTextureId:e.occlusionTexture!=null&&m?a.get(e.occlusionTexture).id:void 0,emissiveTextureId:e.emissiveTexture!=null&&m?a.get(e.emissiveTexture).id:void 0,metallicRoughnessTextureId:e.metallicRoughnessTexture!=null&&m?a.get(e.metallicRoughnessTexture).id:void 0,emissiveBaseColor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],mrrFactors:P?he:[e.metallicFactor,e.roughnessFactor,s.mrrFactors[2]],isSchematic:P,colorTextureTransformMatrix:M(e.colorTextureTransform),normalTextureTransformMatrix:M(e.normalTextureTransform),scale:[j[0],j[1]],occlusionTextureTransformMatrix:M(e.occlusionTextureTransform),emissiveTextureTransformMatrix:M(e.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:M(e.metallicRoughnessTextureTransform),...c},i))}const y=d.get(h);if(o.stageResources.materials.push(y),m){const f=b=>{b!=null&&o.stageResources.textures.push(a.get(b))};f(e.colorTexture),f(e.normalTexture),f(e.occlusionTexture),f(e.emissiveTexture),f(e.metallicRoughnessTexture)}return y}function Ve(t,r){const o=t.attributes.position.count,s=Ie(t.indices||o,t.primitiveType),c=A(3*o),{typedBuffer:d,typedBufferStride:a}=t.attributes.position;Te(c,d,t.transform,3,a);const i=[["position",new v(c,s,3,!0)]];if(t.attributes.normal!=null){const e=A(3*o),{typedBuffer:n,typedBufferStride:l}=t.attributes.normal;ge(R,t.transform),be(e,n,R,3,l),H(R)&&U(e,e),i.push(["normal",new v(e,s,3,!0)])}if(t.attributes.tangent!=null){const e=A(4*o),{typedBuffer:n,typedBufferStride:l}=t.attributes.tangent;ye(R,t.transform),_e(e,n,R,4,l),H(R)&&U(e,e,4),i.push(["tangent",new v(e,s,4,!0)])}if(t.attributes.texCoord0!=null){const e=A(2*o),{typedBuffer:n,typedBufferStride:l}=t.attributes.texCoord0;Fe(e,n,2,l),i.push(["uv0",new v(e,s,2,!0)])}const u=t.attributes.color;if(u!=null){const e=new Uint8Array(4*o);u.elementCount===4?u instanceof G?K(e,u,1,255):(u instanceof we||u instanceof Re)&&K(e,u,1/255,255):(e.fill(255),u instanceof q?W(e,u.typedBuffer,1,255,4,u.typedBufferStride):(t.attributes.color instanceof $e||t.attributes.color instanceof ve)&&W(e,u.typedBuffer,1/255,255,4,t.attributes.color.typedBufferStride)),i.push(["color",new v(e,s,4,!0)])}return{geometry:new Me(r,i),vertexCount:o}}const R=N();function ke(t){switch(t){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":case null:case void 0:return 1}}function ze(t,r){for(let o=0;o<t.model.lods.length;++o){const s=t.model.lods[o];for(const c of s.parts){const d=c.attributes.normal;if(d==null)return;const a=c.attributes.position,i=a.count,u=F(),e=F(),n=F(),l=new Float32Array(4*i),p=new Float32Array(3*i),x=ae(ie(),c.transform);let h=0,m=0;for(let T=0;T<i;T++){a.getVec(T,e),d.getVec(T,u),k(e,e,c.transform),le(n,e,r.center),z(n,n,r.radius);const g=n[2],y=ue(n),f=Math.min(.45+.55*y*y,1)**fe;z(n,n,r.radius),x!==null&&k(n,n,x),ce(n,n),o+1!==t.model.lods.length&&t.model.lods.length>1&&me(n,n,u,g>-1?.2:Math.min(-4*g-3.8,1)),p[h]=n[0],p[h+1]=n[1],p[h+2]=n[2],h+=3,l[m]=f,l[m+1]=f,l[m+2]=f,l[m+3]=1,m+=4}c.attributes.normal=new q(p.buffer),c.attributes.color=new G(l.buffer)}}}const Ne=Object.freeze(Object.defineProperty({__proto__:null,fetch:Ce,parseUrl:J},Symbol.toStringTag,{value:"Module"}));export{Ne as o,M as s,Ce as z};
