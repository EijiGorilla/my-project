import{dI as _,bl as c,dH as u,cy as y,rW as g,S as m,U as v,li as f,rX as w,fb as $,r1 as b,ml as P,l as n,a9 as h,_ as d,d as p,e as D,ol as M,a6 as o}from"./index-DWB-5FUE.js";import{e as R,a as L}from"./visualizationUtils-BzAjRsx-.js";import"./AnchorElementViewModel-B-3f1BWL.js";import"./createUtils-D7JaVCA5.js";import"./distanceOperator-BsZ_4jpZ.js";import"./Distance2DCalculator-CXhBP-8I-BFhVwdhl.js";class E{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null}destroy(){this.remove()}remove(){this._highlightTask=_(this._highlightTask),this._highlightHandle=c(this._highlightHandle)}update(e){if(this.remove(),e==null||!H(e))return;const i=e.layer;this._highlightTask=u(async t=>{const a=await this._params.view.whenLayerView(i);y(t);const r=g(a)?a:null;r&&(this._highlightHandle=r.highlight(e))})}}function H(s){return s.geometry!=null&&s.geometry.type==="polyline"}let l=class extends m{constructor(s){super(s),this._chartData=null,this._graphic=new v,this._layer=new f({listMode:"hide",internal:!0,title:"Profile line"}),this._update=e=>{const{chartData:i}=e;if(i==null)return this.remove();if(!i.refined)return;const t=i.lines.find(r=>r.viewVisualizationEnabled);if(!t)return;this._graphic.geometry=R(t,e.spatialReference),this._graphic.symbol=new w({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,10],lineDashEnding:"HalfPattern",controlPointEnding:"HalfPattern"}],capStyle:"Butt",width:1.5,color:t.color.toArray()},{type:"CIMSolidStroke",capStyle:"Butt",width:2,color:$(t.color).toArray()}]}}});const a=this.view?.map?.layers;a&&!a.includes(this._layer)&&a.add(this._layer)}}initialize(){this._layer.add(this._graphic);const s=P().profileLinesUpdateThrottleMillis;let e=this._update;{const i=b(this._update,s);this.addHandles(i),e=i}this.addHandles(n(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),e,h))}destroy(){this.remove()}remove(){this.view?.map?.remove(this._layer)}update(s){this._chartData=s}};d([p()],l.prototype,"view",void 0),d([p()],l.prototype,"_chartData",void 0),l=d([D("esri.widgets.ElevationProfile.support.ProfileLine2D")],l);class x{constructor(e,i){this._handles=new M,this._inputRepresentation=new E({view:e}),this._hoveredPoints=new L({view:e}),this._profileLine=new l({view:e}),this._handles.add([n(()=>i.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),h),n(()=>{const{state:t,highlightEnabled:a,viewModel:r}=i;return{input:r.input,state:t,highlightEnabled:a}},t=>this._updateInputRepresentation(t),h),n(()=>i.viewModel.chartData,t=>this._profileLine.update(t),h),n(()=>i.viewModel.input?.geometry,()=>{this._profileLine.remove()},h)])}destroy(){this._handles=o(this._handles),this._inputRepresentation=o(this._inputRepresentation),this._hoveredPoints=o(this._hoveredPoints),this._profileLine=o(this._profileLine)}_updateInputRepresentation({input:e,state:i,highlightEnabled:t}){i==="selected"&&t?this._inputRepresentation.update(e):this._inputRepresentation.remove()}}export{x as ElevationProfileView2D};
